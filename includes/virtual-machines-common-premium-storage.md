# <a name="high-performance-premium-storage-and-managed-disks-for-vms"></a>Высокопроизводительное хранилище класса Premium и управляемые диски для виртуальных машин Azure
Хранилище Azure класса Premium обеспечивает поддержку дисков с высокой производительностью и малой задержкой для виртуальных машин с интенсивной рабочей нагрузкой ввода-вывода. Диски виртуальной машины, использующие хранилище класса Premium, хранят данные на твердотельных накопителях. Диски виртуальной машины приложения можно перенести в хранилище Azure класса Premium, чтобы использовать их быстродействие и производительность.

К виртуальной машине в Azure можно подключить несколько дисков хранилища класса Premium. При использовании нескольких дисков емкость виртуальной машины можно увеличить до 256 ТБ. С хранилищем класса Premium вы получите до 80 000 операций ввода-вывода в секунду и пропускную способность диска до 2000 МБ в секунду на виртуальную машину с очень низкой задержкой при операциях чтения.

В хранилище класса Premium Azure предлагает возможность по-настоящему удобного перемещения ресурсоемких корпоративных приложений, например Dynamics AX, Dynamics CRM, Exchange Server, SAP Business Suite и ферм SharePoint в облако. Вы можете запускать интенсивные рабочие нагрузки баз данных в таких приложениях, как SQL Server, Oracle, MongoDB, MySQL и Redis, которым требуется согласованная высокая производительность и небольшая задержка.

> [!NOTE]
> Для оптимальной работы приложения мы советуем переносить все диски виртуальных машин, требующие большого количества операций ввода-вывода в секунду, в хранилище класса Premium. Если диску не требуется обеспечивать большое число операций ввода-вывода в секунду, можно ограничить затраты, оставив его в хранилище Azure класса Standard. В хранилище класса Standard данные дисков виртуальных машин хранятся на жестких дисках, а не на твердотельных дисках.
> 

Azure предлагает два способа создания дисков хранилища класса Premium для виртуальных машин.

* **Неуправляемые диски**

    Это исходный метод. В рамках этого метода вы управляете учетными записями хранения, используемыми для хранения VHD-файлов, которые соответствуют дискам виртуальной машины. VHD-файлы хранятся в учетных записях хранения Azure как страничные BLOB-объекты. 

* **Управляемые диски**

    При выборе [управляемых дисков Azure](../articles/virtual-machines/windows/managed-disks-overview.md) управлять учетными записями хранения, используемыми для дисков виртуальной машины, будет Azure. Вы просто выбираете класс (Premium или Standard) и размер диска. Azure самостоятельно создаст диск и будет управлять им. Вам не нужно беспокоиться о размещении дисков в нескольких учетных записях хранения для соблюдения границ масштабируемости учетных записей хранения. Azure берет это на себя.

Мы советуем выбрать управляемые диски, так как они предоставляют множество возможностей.

Чтобы приступить к работе с хранилищем класса Premium, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/pricing/free-trial/). 

Сведения о миграции существующих виртуальных машин в хранилище класса Premium см. в статьях [Переключение виртуальной машины с неуправляемых на управляемые диски](../articles/virtual-machines/windows/convert-unmanaged-to-managed-disks.md) или [Как преобразовать виртуальную машину Linux с неуправляемыми дисками для использования Управляемых дисков Azure](../articles/virtual-machines/linux/convert-unmanaged-to-managed-disks.md).

> [!NOTE]
> Хранилище класса Premium доступно в большинстве регионов. Перечень доступных регионов см. в строке **Хранилище дисков** на странице [Доступность продуктов по регионам](https://azure.microsoft.com/regions/#services).
> 

## <a name="features"></a>Функции

Вот некоторые возможности хранилища класса Premium.

* **Диски хранилища класса Premium.**

    Хранилище класса Premium поддерживает диски виртуальных машин, которые можно подключить к виртуальным машинам определенных серий. Хранилище класса Premium поддерживает виртуальные машины серий DS, DSv2, GS, Ls, Fs и Esv3. Доступно семь размеров дисков: P4 (32 ГБ), P6 (64 ГБ), P10 (128 ГБ), P20 (512 ГБ), P30 (1024 ГБ), P40 (2048 ГБ) и P50 (4095 ГБ). Размеры дисков P4 и P6 в пока что поддерживаются только для службы "Управляемые диски". Каждый из них имеет свои собственные характеристики производительности. В зависимости от потребностей приложения вы можете подключить один или несколько этих дисков к виртуальной машине. В приведенном ниже разделе [Целевые показатели масштабируемости и производительности хранилища класса Premium](#scalability-and-performance-targets) мы опишем характеристики более подробно.

* **Страничные BLOB-объекты класса Premium.**

    Хранилище класса Premium поддерживает страничные BLOB-объекты, используемые для хранения постоянных неуправляемых дисков для виртуальных машин. В отличие от хранилища Azure класса Standard, хранилище класса Premium не поддерживает блочные BLOB-объекты, добавочные BLOB-объекты, файлы, таблицы и очереди. Страничные BLOB-объекты класса Premium поддерживают шесть размеров, P10–P50 и P60 (8191 ГиБ). Cтраничные BLOB-объекты уровня "Премиум" размера P60 невозможно подключать как диски виртуальной машины. 

    Любой объект, помещенный в учетную запись хранения класса Premium, будет страничным BLOB-объектом, зафиксированным в одном из поддерживаемых подготовленных размеров. Поэтому учетная запись хранилища класса Premium не предназначена для хранения мелких больших двоичных объектов.

* **Учетная запись хранилища класса Premium.**

    Чтобы начать использование хранилища класса Premium, необходимо создать соответствующую учетную запись хранения для неуправляемых дисков. Чтобы создать учетную запись хранения класса Premium, на [портале Azure](https://portal.azure.com) выберите уровень производительности **Premium**. В качестве варианта репликации выберите **локально избыточное хранилище (LRS)**. Вы также можете создать учетную запись хранилища класса Premium, установив уровень производительности **Premium_LRS**. Для изменения уровня производительности используйте следующее:
     
    - [PowerShell для службы хранилища Azure](../articles/storage/common/storage-powershell-guide-full.md#manage-the-storage-account).
    - [Azure CLI для службы хранилища Azure](../articles/storage/common/storage-azure-cli.md#manage-storage-accounts).
    - [REST API поставщика ресурсов службы хранилища Azure](https://docs.microsoft.com/rest/api/storagerp) (для развернутых служб Resource Manager) или одну из клиентских библиотек поставщика ресурсов службы хранилища Azure.

    Дополнительные сведения об ограничениях учетных записей хранилища класса Premium см. в статье [Целевые показатели масштабируемости и производительности хранилища класса Premium](#premium-storage-scalability-and-performance-targets).

* **Локально избыточное хранилище класса Premium.**

    Хранилище класса Premium поддерживает только локально избыточное хранилище в качестве варианта репликации. В локальном избыточном хранилище сохраняется три копии данных в пределах одного региона. Для регионального аварийного восстановления необходимо создать резервную копию дисков виртуальной машины в другом регионе с использованием [службы архивации Azure](../articles/backup/backup-introduction-to-azure-backup.md). Необходимо также использовать учетную запись геоизбыточного хранилища (GRS) в качестве резервного хранилища. 

    Azure использует учетную запись хранилища как контейнер для неуправляемых дисков. В том случае, если вы создаете виртуальную машину Azure, которая поддерживает хранилище класса Premium, с неуправляемыми дисками и выбираете учетную запись хранения класса Premium, ваша операционная система и диски данных хранятся в этой учетной записи.

## <a name="supported-vms"></a>Поддерживаемые виртуальные машины

Хранилище класса Premium поддерживает виртуальные машины серий B, DS, DSv2, DSv3, GS, Ls, M и Fs. С этими виртуальными машинами можно использовать диски хранилищ класса Standard и Premium. Однако нельзя использовать диски хранилища класса Premium с серией виртуальных машин, не совместимой с хранилищем этого класса.


Сведения о доступных в Azure типах и размерах для виртуальных машин Windows см. [здесь](../articles/virtual-machines/windows/sizes.md). Сведения о доступных в Azure типах и размерах для виртуальных машин Linux см. [здесь](../articles/virtual-machines/linux/sizes.md).

Ниже перечислены некоторые возможности виртуальных машин серий DS, DSv2, GS, Ls и Fs.

* **Облачная служба.**

    Виртуальные машины серии DS можно добавить в облачную службу, содержащую только виртуальные машины этой серии. Не добавляйте виртуальные машины серии DS в существующую облачную службу с машинами других серий. Можно выполнить миграцию существующих виртуальных жестких дисков в новую облачную службу, где работают только виртуальные машины серии DS. Чтобы сохранить тот же виртуальный IP-адрес для новой облачной службы с машинами серии DS, вы можете воспользоваться функцией [Зарезервированные IP-адреса](../articles/virtual-network/virtual-networks-instance-level-public-ip.md). Виртуальные машины серии GS можно добавлять в существующую облачную службу, которая поддерживает только виртуальные машины этой серии.

* **Диск операционной системы.**

    Виртуальные машины, поддерживаемые хранилищем класса Premium, можно настроить для использования дисков операционной системы как для хранилища класса Standard, так и для хранилища класса Premium. Для наилучших результатов мы советуем использовать диск ОС с хранилищем класса Premium.

* **Диски данных**

    На одной виртуальной машине, поддерживаемой хранилищем класса Premium, вы можете одновременно использовать диски хранилища класса Premium и Standard. С помощью хранилища класса Premium вы можете подготовить виртуальную машину и подключить к ней несколько дисков с постоянными данными. Если необходимо увеличить емкость и производительность тома, вы можете создать на дисках чередующийся том.

    > [!NOTE]
    > Если вы создаете чередующийся том на дисках данных хранилища класса Premium с помощью [дисковых пространств](http://technet.microsoft.com/library/hh831739.aspx), то необходимо настроить по одному столбцу для каждого используемого диска. В противном случае общая производительность чередующегося тома может быть ниже ожидаемой из-за неравномерного распределения трафика между дисками. По умолчанию в диспетчере серверов можно настроить столбцы для 8 дисков. При подключении более 8 дисков используйте PowerShell для создания тома. Укажите число столбцов вручную. В противном случае пользовательский интерфейс диспетчера сервера продолжит настраивать по 8 столбцов, даже если у вас больше дисков. Например, если у вас есть 32 диска в одном чередующемся наборе, необходимо указать 32 столбца. Чтобы указать количество столбцов, используемых виртуальным диском, можно воспользоваться параметром [NumberOfColumns](http://technet.microsoft.com/library/hh848643.aspx) командлета PowerShell *New-VirtualDisk*. Дополнительные сведения см. в статьях [Обзор дисковых пространств](http://technet.microsoft.com/library/hh831739.aspx) и [Storage Spaces Frequently Asked Questions](http://social.technet.microsoft.com/wiki/contents/articles/11382.storage-spaces-frequently-asked-questions-faq.aspx) (Часто задаваемые вопросы о дисковых пространствах).
    >
    > 

* **Кэш.**

    Виртуальные машины, поддерживаемые хранилищем класса Premium, имеют уникальные возможности кэширования, позволяющие получить улучшенные показатели пропускной способности и задержек по сравнению с показателями производительности используемых дисков хранилища класса Premium. Для дисков хранилища класса Premium вы можете настроить политику кэширования **только для чтения**, **чтение и запись** или **отсутствует**. По умолчанию для всех дисков данных класса Premium используется политика **только для чтения**, а для дисков операционной системы — политика **чтение и запись**. Для достижения оптимальной производительности приложения используйте правильные параметры кэша. Например, для дисков данных, предназначенных в основном или исключительно для чтения, включая файлы данных SQL Server, задайте политику кэширования **только для чтения**. Для дисков данных, предназначенных в основном или исключительно для записи, включая файлы журналов SQL Server, задайте политику кэширования **отсутствует**. Дополнительные сведения об оптимизации разработки с хранилищем класса Premium см. в статье [Хранилище Azure класса Premium: разработка, обеспечивающая повышенную производительность](../articles/virtual-machines/windows/premium-storage-performance.md).

* **Аналитика в Application Insights**

    Для анализа производительности виртуальной машины с использованием дисков в хранилище класса Premium включите диагностику виртуальной машины на [портале Azure](https://portal.azure.com). Дополнительные сведения см. в записи блога [Microsoft Azure Virtual Machine Monitoring with Azure Diagnostics Extension](https://azure.microsoft.com/blog/2014/09/02/windows-azure-virtual-machine-monitoring-with-wad-extension/) (Мониторинг виртуальной машины Microsoft Azure с помощью расширения диагностики Azure). 

    Для просмотра сведений о производительности дисков воспользуйтесь средствами операционной системы, такими как [системный монитор Windows](https://technet.microsoft.com/library/cc749249.aspx) для виртуальных машин Windows или команда [iostat](http://linux.die.net/man/1/iostat) для виртуальных машин Linux.

* **Производительность и пределы масштабирования виртуальной машины.**

    Каждая виртуальная машина, поддерживаемая хранилищем класса Premium, имеет пределы масштабирования и характеристики производительности, такие как число операций ввода-вывода в секунду, пропускная способность и допустимое количество подключаемых дисков. При использовании дисков хранилища класса Premium для таких виртуальных машин убедитесь, что виртуальная машина обеспечивает достаточное число операций ввода-вывода в секунду и пропускную способность для передачи трафика диска.

    Например, для виртуальной машины STANDARD_DS1 выделенная пропускная способность для обмена данными с дисками хранилища класса Premium составляет 32 МБ в секунду. Диск P10 хранилища класса Premium может обеспечивать пропускную способность 100 МБ в секунду. Скорость передачи данных для диска P10 хранилища класса Premium, подключенного к такой виртуальной машине, составляет не более 32 МБ в секунду. Она не может достигать 100 МБ в секунду, которые способен обеспечить диск P10.

    В настоящее время максимальный размер виртуальных машин серии DS — это Standard_DS15_v2, который обеспечивает пропускную способность до 960 МБ в секунду на всех дисках. Самой большой виртуальной машиной серии GS считается Standard_GS5. Она способна выдать до 2000 МБ в секунду на всех дисках.

    Эти ограничения действуют только в отношении трафика диска без учета данных, извлекаемых из кэша, и сетевого трафика. Для сетевого трафика виртуальных машин предназначен отдельный канал, который отличается от выделенного канала для дисков хранилища класса Premium.

    Актуальные сведения о максимальном количестве операций ввода-вывода в секунду и пропускной способности для виртуальных машин, поддерживаемых хранилищем класса Premium, см. в статьях о размерах виртуальных машин для [Windows](../articles/virtual-machines/windows/sizes.md) и [Linux](../articles/virtual-machines/linux/sizes.md).

    Сведения о дисках, используемых в хранилищах класса Premium, числе операций ввода-вывода в секунду и ограничениях пропускной способности см. в таблице в следующем разделе.

## <a name="scalability-and-performance-targets"></a>Целевые показатели масштабируемости и производительности хранилища
В этом разделе мы опишем целевые показатели масштабируемости и производительности, которые необходимо учитывать при использовании хранилища класса Premium.

Ниже описаны целевые показатели масштабируемости учетных записей хранения класса Premium.

| Общая емкость учетной записи | Общая пропускная способность для учетной записи локально избыточного хранилища |
| --- | --- | 
| Емкость диска: 35 ТБ <br>Емкость для моментальных снимков: 10 ТБ | До 50 гигабит в секунду для входящих<sup>1</sup> и исходящих подключений<sup>2</sup> |

<sup>1</sup> Все данные (запросы), отправляемые в учетную запись хранилища.

<sup>2</sup> Все данные (отклики), получаемые из учетной записи хранения.

Дополнительные сведения см. в статье [Целевые показатели масштабируемости и производительности службы хранилища Azure](../articles/storage/common/storage-scalability-targets.md).

В случае, если вы используете учетные записи хранилища класса Premium для неуправляемых дисков и потребности вашего приложения превышают целевые показатели масштабируемости для отдельной учетной записи хранения, рассмотрите возможность перемещения на управляемые диски. Если этот вариант вам не подходит, тогда при создании приложения настройте его на использование нескольких учетных записей хранения и распределите данные между этими учетными записями. Например, если необходимо подключить диски объемом 51 ТБ к нескольким виртуальным машинам, распределите их между двумя учетными записями хранения. Максимальный размер, поддерживаемый одной учетной записью хранилища класса Premium, составляет 35 ТБ. Объем подготовленных к работе дисков в одной учетной записи хранилища класса Premium должен составлять не более 35 ТБ.

### <a name="premium-storage-disk-limits"></a>Пределы для дисков хранилища класса Premium
Во время подготовки диска для хранилища класса Premium количество поддерживаемых им операций ввода-вывода в секунду и пропускная способность (полоса пропускания) зависят от его размера. Azure предлагает семь типов дисков для хранилища уровня "Премиум": P4 и P6 (только для службы "Управляемые диски"), а также P10, P20, P30, P40 и P50. Каждый из них отличается определенными ограничениями относительно количества операций ввода-вывода в секунду и пропускной способности, которые указаны в следующей таблице.

| Диски уровня "Премиум"  | P4    | P6    | P10   | P15   | P20   | P30   | P40   | P50   | 
|---------------------|-------|-------|-------|-------|-------|-------|-------|-------|
| Размер диска           | 32 ГБ| 64 ГБ| 128 ГБ| 256 ГБ| 512 ГБ            | 1024 ГБ (1 ТБ)    | 2048 ГБ (2 ТБ)    | 4095 ГБ (4 ТБ)    | 
| Количество операций ввода-вывода в секунду на диск       | 120   | 240   | 500   | 1100   | 2300              | 5000              | 7500              | 7500              | 
| Пропускная способность на диск | 25 МБ в секунду  | 50 МБ в секунду  | 100 МБ в секунду | 125 МБ в секунду | 150 МБ в секунду | 200 МБ в секунду | 250 МБ в секунду | 250 МБ в секунду | 

> [!NOTE]
> Убедитесь, что виртуальная машина имеет достаточную пропускную способность для поддержки трафика диска, как описано в разделе [Виртуальные машины, поддерживаемые хранилищем класса Premium](#premium-storage-supported-vms). В противном случае пропускная способность и скорость ввода-вывода при обмене данными с диском будет ограничена более низкими значениями для виртуальной машины вместо значений, указанных в предыдущей таблице.  
> 
> 

Ниже приведены некоторые важные аспекты, касающиеся целевых показателей производительности и масштабируемости хранилища класса Premium:

* **Подготовленная емкость и производительность.**

    При подготовке диска хранилища класса Premium, в отличие от хранилища класса Standard, гарантируются определенные показатели емкости, числа операций ввода-вывода в секунду и пропускной способности. Например, при создании диска P50 Azure подготавливает для него 4095 ГБ емкости хранилища, а также пропускную способность 250 МБ в секунду и 7500 операций ввода-вывода в секунду. Приложение может использовать ресурсы емкости и производительности как полностью, так и частично.

* **Размер диска**

    Служба Azure сопоставляет размер диска (округленный) с ближайшим вариантом диска хранилища Premium, как указано в таблице выше. Например, диск размером 100 ГБ классифицируется как диск P10 и поддерживает до 500 операций ввода-вывода в секунду, а также пропускную способность до 100 МБ/с. Аналогичным образом диск размером 400 ГБ классифицируется как диск P20 и поддерживает до 2300 операций ввода-вывода в секунду, а также пропускную способность до 150 МБ/с.
    
    > [!NOTE]
    > Размер существующих дисков можно легко увеличить. Например, диск размером 30 ГБ можно расширить до 128 ГБ или даже 1 ТБ. Вы также можете преобразовать диск P20 в диск P30, если вам потребуется дополнительная производительность, пропускная способность и скорость ввода-вывода. 
    > 
 
* **Объем ввода-вывода**

    Объем операций ввода-вывода составляет 256 КБ. Если размер передаваемых данных меньше 256 КБ, они считаются одной единицей операции ввода-вывода. Данные большего размера подсчитываются путем сложения размеров нескольких единиц операций ввода-вывода по 256 КБ. Например, данные операции ввода-вывода размером 1100 КБ считаются пятью единицами операций ввода-вывода.

* **Пропускная способность**

    Предельная пропускная способность включает операции записи на диск, а также все операции чтения, которые не обслуживаются кэшем. Например, каждый диск P10 имеет пропускную способность 100 МБ/с. Ниже приведено несколько примеров допустимой пропускной способности для диска P10.

    | Макс. пропускная способность на диск P10 | Операции чтения с диска без кэширования | Операции записи на диск без кэширования |
    | --- | --- | --- |
    | 100 МБ/с | 100 МБ/с | 0 |
    | 100 МБ/с | 0 | 100 МБ/с |
    | 100 МБ/с | 60 МБ/с | 40 МБ/с |

* **Попаданий в кэш.**

    Выделенная для диска пропускная способность и скорость ввода-вывода не ограничивают извлечение данных из кэша. Например, при использовании на виртуальной машине, поддерживаемой хранилищем класса Premium, диска данных, кэш которого настроен **Только для чтения**, ограничения для операций ввода-вывода в секунду и пропускной способности диска не распространяются на операции чтения данных из кэша. Это позволяет добиться очень высокой пропускной способности при работе с диском, если основная рабочая нагрузка связана с чтением. Для операций с кэшем действуют отдельные ограничения на скорость ввода-вывода и пропускную способность на уровне виртуальной машины в зависимости от ее размера. Для машин серии DS они составляют приблизительно 4000 операций ввода-вывода в секунду и 33 МБ в секунду на ядро для кэша и для операций с локальным SSD-накопителем. Для машин серии GS ограничения составляют 5000 операций ввода-вывода в секунду и 50 МБ в секунду на ядро для кэша и для операций с локальным SSD-накопителем. 

## <a name="throttling"></a>Регулирование
Регулирование может осуществляться, если количество операций ввода-вывода в секунду или пропускная способность приложения превышают ограничения, установленные для диска хранилища класса Premium, либо общий трафик по всем дискам виртуальной машины превышает установленное для нее ограничение пропускной способности. Чтобы избежать этого, рекомендуется ограничить число выполняемых операций ввода-вывода для подготовленного вами диска с учетом целевых показателей его масштабируемости и производительности, а также показателей пропускной способности дисков виртуальной машины.  

Приложение может обеспечить минимальную задержку, если оно разработано для предотвращения регулирования. Однако, если количество ожидающих операций ввода-вывода для диска слишком мало, приложение не может обеспечить максимальные уровни количества операций ввода-вывода в секунду и пропускной способности, доступные для диска.

В следующих примерах показано, как подсчитать уровни регулирования. Все расчеты основаны на размере единицы операции ввода-вывода в 256 КБ.

### <a name="example-1"></a>Пример 1
Приложение выполнило 495 операций ввода-вывода данных размером 16 КБ в секунду на диске P10. Они учитываются как 495 единиц операций ввода-вывода в секунду. При попытке ввода-вывода данных размером 2 МБ в течение этой же секунды общее количество операций ввода-вывода равно 495 + 8. Это обусловлено тем, что при операции ввода-вывода данных размером 2 МБ данные вычисляются по формуле 2048 КБ / 256 КБ = 8 единиц операций ввода-вывода, если размер единицы составляет 256 КБ. Так как сумма 495 + 8 превышает ограничение в 500 операций ввода-вывода в секунду для диска, будет выполнено регулирование.

### <a name="example-2"></a>Пример 2
Приложение выполнило 400 операций ввода-вывода данных размером 256 КБ на диске P10. Общая использованная пропускная способность равна (400 &#215; 256) / 1024 КБ = 100 МБ/с. Предельное значение пропускной способности для диска P10 составляет 100 МБ/с. Если приложение попытается выполнить больше операций ввода-вывода в течение этой же секунды, в результате превышения ограничения будет выполнено регулирование.

### <a name="example-3"></a>Пример 3
У вас виртуальная машина DS4, к которой подключены два диска P30. Каждый диск P30 рассчитан на пропускную способность до 200 МБ в секунду. Однако общая пропускная способность виртуальной машины DS4 составляет 256 МБ в секунду. Таким образом, использовать на этой машине DS4 одновременно оба диска на максимальной скорости нельзя. В данном случае можно поддерживать интенсивность трафика для одного диска на уровне 200 МБ в секунду, а для второго — 56 МБ в секунду. Если суммарный объем трафика для обоих дисков превышает 256 МБ/с, активируется регулирование.

> [!NOTE]
> Если трафик диска в основном включает операции ввода-вывода данных небольших размеров, весьма вероятно, что приложение достигнет ограничения операций ввода-вывода в секунду до ограничения пропускной способности. Однако, если трафик диска в основном включает операции ввода-вывода данных больших размеров, весьма вероятно, что приложение сначала достигнет ограничения пропускной способности вместо предельного количества операций ввода-вывода в секунду. Вы можете максимально увеличить количество операций ввода-вывода в секунду, выполняемых приложением, и его пропускную способность, выполняя операции ввода-вывода данных оптимальных размеров, а также ограничив число ожидающих операций ввода-вывода для диска.
> 

Дополнительные сведения о проектировании для достижения высокой производительности при использовании хранилища класса Premium см. [здесь](../articles/virtual-machines/windows/premium-storage-performance.md).

## <a name="snapshots-and-copy-blob"></a>Моментальные снимки и копирование BLOB-объектов

В службе хранилища VHD-файл представляется в качестве страничного BLOB-объекта. Вы можете создать моментальные снимки страничных BLOB-объектов и копировать их в другое расположение, например в другую учетную запись хранения.

### <a name="unmanaged-disks"></a>Неуправляемые диски

Создайте [добавочные моментальные снимки](../articles/virtual-machines/linux/incremental-snapshots.md) для неуправляемых дисков класса Premium таким же образом, как вы создаете моментальные снимки для хранилища класса Standard. Хранилище класса Premium поддерживает в качестве варианта репликации только локально избыточное хранилище (LRS). Мы советуем создавать моментальные снимки, а затем копировать их в учетную запись геоизбыточного хранилища класса Standard. Дополнительные сведения см. в статье [Репликация службы хранилища Azure](../articles/storage/common/storage-redundancy.md).

Если диск подключен к виртуальной машине, определенные операции API запрещены. Например, на подключенном диске невозможно выполнить операцию [Copy Blob](/rest/api/storageservices/Copy-Blob) (копирования большого двоичного объекта). Вместо этого создайте сначала моментальный снимок большого двоичного объекта, используя метод REST API [Snapshot Blob](/rest/api/storageservices/Snapshot-Blob). Затем выполните операцию [Copy Blob](/rest/api/storageservices/Copy-Blob) с моментальным снимком, чтобы скопировать подключенный диск. Кроме того, вы можете отключить диск, а затем выполнить все необходимые операции.

К моментальным снимкам больших двоичных объектов хранилища класса Premium применяются следующие ограничения.

| Ограничение хранилища класса Premium | Значение |
| --- | --- |
| Максимальное число моментальных снимков на большой двоичный объект | 100 |
| Емкость учетной записи хранения для моментальных снимков<br>(Содержит данные только в моментальных снимках. Не содержит данные в базовом большом двоичном объекте.) | 10 ТБ |
| Минимальное время между последовательными моментальными снимками | 10 минут |

Чтобы поддерживать геоизбыточные копии ваших моментальных снимков, вы можете копировать снимки из учетной записи хранения класса Premium путем использования AzCopy или Copy Blob. Дополнительные сведения см. в статьях [Приступая к работе со служебной программой командной строки AzCopy](../articles/storage/common/storage-use-azcopy.md) и [Копирование большого двоичного объекта](/rest/api/storageservices/Copy-Blob).

Подробные сведения о выполнении операций REST со страничными BLOB-объектами в учетных записях хранения класса Premium см. в статье [Использование операций службы BLOB-объектов с хранилищем Azure Premium](http://go.microsoft.com/fwlink/?LinkId=521969).

### <a name="managed-disks"></a>Управляемые диски

Моментальный снимок для управляемого диска — это копия управляемого диска, предназначенная только для чтения. Моментальный снимок хранится в качестве управляемого диска класса Standard. В настоящее время [добавочные моментальные снимки](../articles/virtual-machines/windows/incremental-snapshots.md) для управляемых дисков не поддерживаются. Дополнительные сведения о том, как создать моментальный снимок для управляемого диска, см. в статьях [Create a copy of a VHD stored as an Azure Managed Disk by using Managed Snapshots](../articles/virtual-machines/windows/snapshot-copy-managed-disk.md) (Создание копии VHD-файла, хранящегося в качестве управляемого диска Azure, с помощью управляемых моментальных снимков) для Windows или [Create a copy of a VHD stored as an Azure Managed Disk by using Managed Snapshots](../articles/virtual-machines/linux/snapshot-copy-managed-disk.md) (Создание копии VHD-файла, хранящегося в качестве управляемого диска Azure, с помощью управляемых моментальных снимков) для Linux.

Если управляемый диск подключен к виртуальной машине, определенные операции API запрещены. Например, пока диск подключен к виртуальной машине, вы не можете создать подписанный URL-адрес (SAS) для выполнения операции копирования. Вместо этого сначала создайте моментальный снимок диска, а затем копируйте его. Или отключите диск, а затем создайте подписанный URL-адрес (SAS).


## <a name="premium-storage-for-linux-vms"></a>Хранилище класса Premium для виртуальных машин Linux
Для настройки виртуальных машин Linux в хранилище класса Premium можно использовать следующие сведения.

Для всех дисков хранилища класса Premium с параметром кэширования **только для чтения** или **отсутствует** при подключении файловой системы необходимо отключить т. н. барьеры, чтобы добиться целевых показателей производительности. Барьеры в такой ситуации не нужны, так как записи на диски в хранилище класса Premium являются для этих параметров кэширования долговременными. После успешного выполнения запроса на запись данные записываются в постоянное хранилище. Отключить барьеры можно перечисленными ниже способами (выберите подходящий вариант для своей файловой системы).
  
* Если вы используете систему **reiserFS**, отключите барьеры, используя параметр подключения `barrier=none` (для их включения используйте параметр `barrier=flush`).
* Если вы используете систему **ext3/ext4**, отключите барьеры, используя параметр подключения `barrier=0` (для их включения используйте параметр `barrier=1`).
* Если вы используете систему **XFS**, отключите барьеры, используя параметр подключения `nobarrier` (для их включения используйте параметр `barrier`).
* Для дисков со значением кэша **чтение и запись** хранилища класса Premium включите барьеры для устойчивости записи.
* Чтобы сохранить метки томов после перезапуска виртуальной машины, необходимо обновить каталог /etc/fstab, указав ссылки UUID на диски. Дополнительные сведения см. в статье [Добавление управляемого диска к виртуальной машине Linux](../articles/virtual-machines/linux/add-disk.md).

Для хранилища Azure класса Premium можно использовать следующие дистрибутивы Linux. Рекомендуем вам обновить свои виртуальные машины до одной из перечисленных ниже версий (или более поздних), чтобы добиться от хранилища класса Premium максимально производительной и стабильной работы. Для некоторых из этих версий необходима последняя версия служб интеграции Linux Integration Services 4.0 для Azure. Чтобы скачать и установить дистрибутив, перейдите по ссылке, указанной в следующей таблице. По мере завершения проверки мы будем дополнять этот список новыми образами. Обратите внимание, что наши проверки этих образов продемонстрировали колебания показателей производительности, которые также зависят от особенностей рабочей нагрузки и параметров образов. Различные образы лучше подходят для разных типов рабочей нагрузки.

| Дистрибутив | Version (версия) | Поддерживаемое ядро | Сведения |
| --- | --- | --- | --- |
| Ubuntu | 12.04 | 3.2.0-75.110 или более поздней версии | Ubuntu-12_04_5-LTS-amd64-server-20150119-en-us-30GB |
| Ubuntu | 14.04 | 3.13.0-44.73 или более поздней версии | Ubuntu-14_04_1-LTS-amd64-server-20150123-en-us-30GB |
| Debian | 7.x, 8.x | 3.16.7-ckt4-1 или более поздней версии | &nbsp; |
| SUSE | SLES 12| 3.12.36-38.1 или более поздней версии| suse-sles-12-priority-v20150213 <br> suse-sles-12-v20150213 |
| SUSE | SLES 11 SP4 или более поздней версии | 3.0.101-0.63.1 или более поздней версии | &nbsp; |
| CoreOS | 584.0.0 или более поздней версии| 3.18.4 или более поздней версии | CoreOS 584.0.0 |
| CentOS | 6.5, 6.6, 6.7, 7.0 | &nbsp; | [Требуется LIS4](http://go.microsoft.com/fwlink/?LinkID=403033&clcid=0x409) <br> *См. примечание ниже* |
| CentOS | 7.1 или более поздней версии | 3.10.0-229.1.2.el7 или более поздней версии | [Рекомендуется LIS4](http://go.microsoft.com/fwlink/?LinkID=403033&clcid=0x409) <br> *См. примечание ниже* |
| Red Hat Enterprise Linux (RHEL) | 6.8 или более поздней версии, 7.2 или более поздней версии | &nbsp; | &nbsp; |
| Oracle | 6.0+, 7.2+ | &nbsp; | UEK4 или RHCK |
| Oracle | 7.0–7.1 | &nbsp; | UEK4 или RHCK с [LIS 4.1 или более поздней версии](http://go.microsoft.com/fwlink/?LinkID=403033&clcid=0x409) |
| Oracle | 6.4–6.7 | &nbsp; | UEK4 или RHCK с [LIS 4.1 или более поздней версии](http://go.microsoft.com/fwlink/?LinkID=403033&clcid=0x409) |


### <a name="lis-drivers-for-openlogic-centos"></a>Драйверы LIS для Openlogic CentOS

При использовании виртуальных машин CentOS OpenLogic для установки драйверов последней версии следует выполнить следующую команду:

```
sudo rpm -e hypervkvpd  ## (Might return an error if not installed. That's OK.)
sudo yum install microsoft-hyper-v
```

Для активации новых драйверов потребуется перезагрузка.

## <a name="pricing-and-billing"></a>Цены и выставление счетов

При использовании хранилища класса Premium счета выставляются следующим образом.

* **Размеры диска хранилища класса Premium и большого двоичного объекта.**

    Выставление счетов для хранилища класса Premium диска или большого двоичного объекта зависит от размера подготовленного диска или большого двоичного объекта. Служба Azure сопоставляет подготовленный размер (округленный) с ближайшим вариантом диска хранилища класса Premium. Дополнительные сведения см. в статье [Целевые показатели масштабируемости и производительности хранилища класса Premium](#premium-storage-scalability-and-performance-targets). Каждый диск сопоставляется с одним из поддерживаемых подготовленных размеров дисков, и за него выставляются соответствующие счета. Счета для любого подготовленного диска выставляются пропорционально с учетом часов по ежемесячной стоимости хранилища класса Premium. Например, если вы подготовили диск P10 и удалили его через 20 часов, взимается пропорциональная плата за использование диска P10 в течение 20 часов. Это происходит независимо от фактического объема данных, записанных на диск, количества операций ввода-вывода в секунду или использованной пропускной способности.

* **Моментальные снимки неуправляемых дисков класса Premium.**

    Счета за моментальные снимки неуправляемых дисков класса Premium выставляются с учетом дополнительной емкости, используемой этими снимками. Сведения о моментальных снимках см. в статье [Создание моментального снимка большого двоичного объекта](/rest/api/storageservices/Snapshot-Blob).

* **Моментальные снимки управляемых дисков класса Premium.**

    Моментальный снимок управляемого диска — это копия диска, предназначенная только для чтения. Диск хранится в виде управляемого диска класса Standard. Стоимость моментального снимка будет совпадать со стоимостью управляемого диска класса Standard. Например, если вы создадите моментальный снимок управляемого диска класса Premium с объемом 128 ГБ, то цена моментального снимка будет равна цене управляемого диска класса Standard с объемом 128 ГБ.  

* **Передача исходящих данных**

    [Передача исходящих данных](https://azure.microsoft.com/pricing/details/data-transfers/) (данных, передаваемых из центров обработки данных Azure) учитывается при определении платы за используемую пропускную способность.

Дополнительные сведения о ценах на хранилище класса Premium и поддерживаемые им виртуальные машины см. по следующим ссылкам.

* [Цены на хранилища Azure](https://azure.microsoft.com/pricing/details/storage/)
* [Виртуальные машины: цены](https://azure.microsoft.com/pricing/details/virtual-machines/)
* [Цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/)

## <a name="azure-backup-support"></a>Поддержка резервного копирования Azure 

Для регионального аварийного восстановления необходимо создать резервную копию дисков виртуальной машины в другом регионе с использованием [службы архивации Azure](../articles/backup/backup-introduction-to-azure-backup.md) и учетной записи хранения GRS в качестве хранилища архивации.

Используйте службу архивации Azure, чтобы создать задание архивации с учетом времени, политики хранения резервных копий и выполнять быстрое восстановление виртуальной машины. Резервное копирование можно использовать с управляемыми и неуправляемыми дисками. Дополнительные сведения см. в статье [Архивация виртуальных машин Azure в хранилище служб восстановления](../articles/backup/backup-azure-vms-first-look-arm.md) и разделе [Использование службы архивации Azure для виртуальных машин, запущенных на управляемых дисках](../articles/backup/backup-introduction-to-azure-backup.md#using-managed-disk-vms-with-azure-backup). 

## <a name="next-steps"></a>Дополнительная информация
Дополнительные сведения о хранилище класса Premium см. в следующих статьях: