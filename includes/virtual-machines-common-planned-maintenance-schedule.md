

## <a name="multi-and-single-instance-vms"></a>Многоэкземплярные и одноэкземплярные виртуальные машины
Для многих клиентов, работающих в Azure, критически важна возможность самостоятельно планировать, когда проводить плановое техническое обслуживание виртуальных машин, так как оно сопровождается простоем (примерно 15 минут). Можно использовать группы доступности для управления временем планового обслуживания подготовленных виртуальных машин.

Есть две возможные конфигурации для виртуальных машин, размещенных в Azure. Виртуальные машины настраиваются либо как одноэкземплярные, либо как многоэкземплярные. Если виртуальные машины находятся в группе доступности, они настраиваются как многоэкземплярные. Обратите внимание, даже одиночные виртуальные машины могут быть развернуты в группе доступности. В таком случае они будут считаться многоэкземплярными. Если виртуальные машины НЕ находятся в группе доступности, они настраиваются как одноэкземплярные.  Дополнительные сведения о группах доступности см. в статье [Manage the availability of Windows virtual machines in Azure](../articles/virtual-machines/virtual-machines-windows-manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) (Управление доступностью виртуальных машин Windows в Azure) или [Управление доступностью виртуальных машин Linux](../articles/virtual-machines/virtual-machines-linux-manage-availability.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

Плановое обновление при обслуживании одноэкземплярных и многоэкземплярных виртуальных машин выполняется раздельно. Перенастраивая виртуальные машины как одноэкземплярные (если они являются многоэкземплярными) и наоборот, вы можете управлять тем, когда они проходят плановое обслуживание. Дополнительные сведения о плановом обслуживании виртуальных машин Azure см. в статьях [Плановое обслуживание виртуальных машин Linux в Azure](../articles/virtual-machines/virtual-machines-linux-planned-maintenance.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) и [Planned maintenance for virtual machines in Azure](../articles/virtual-machines/virtual-machines-windows-planned-maintenance.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) (Плановое обслуживание виртуальных машин в Azure).

## <a name="for-multi-instance-configuration"></a>Многоэкземплярная конфигурация
Выбрать время для планового обслуживания, которое затрагивает виртуальные машины, развернутые в конфигурации группы доступности, можно, удалив эти виртуальные машины из групп доступности.

1. За семь календарных дней до планового обслуживания многоэкземплярных виртуальных машин вам отправляется электронное письмо. Идентификаторы подписок и имена затронутых многоэкземплярных виртуальных машин будут включены в текст.
2. За эти семь дней вы можете выбрать время для обновления экземпляров, удалив многоэкземплярные виртуальные машины в соответствующем регионе из групп доступности. Это изменение в конфигурации приведет к перезагрузке, так как виртуальная машина перемещается с одного физического узла, которому назначено обслуживание, на другой физический узел, который не будет обслуживаться.
3. Удалить виртуальную машину из группы доступности можно на портале Azure.

   1. На портале выберите виртуальную машину, которую нужно удалить из группы доступности.  

   2. В разделе **Параметры** щелкните **Группа доступности**.

      ![Выбор группы доступности](./media/virtual-machines-planned-maintenance-schedule/availabilitysetselection.png)

   3. В раскрывающемся меню группы доступности выберите пункт "Не входит в группу доступности".

      ![Удаление из группы](./media/virtual-machines-planned-maintenance-schedule/availabilitysetwarning.png)

   4. Щелкните **Сохранить** в верхней части страницы. Выберите **Да**, чтобы подтвердить перезапуск виртуальной машины.

   >[!TIP]
   >Можно сделать виртуальную машину многоэкземплярной позже, выбрав один из перечисленных наборов доступности.

4. Виртуальные машины, удаленные из групп доступности, будут перемещены на одноэкземплярные узлы и не будут обновлены во время планового обслуживания, затрагивающего конфигурации групп доступности.
5. После обновления виртуальных машин в группах доступности (в соответствии с расписанием в письме) следует добавить виртуальные машины обратно в соответствующие группы доступности. Став частью группы доступности, они будут повторно настроены как многоэкземплярные, после чего произойдет перегрузка. Как правило, после обновления всех многоэкземплярных машин во всей среде Azure следует обслуживание одноэкземплярных машин.

Удалить виртуальную машину из группы доступности можно также с помощью Azure PowerShell.

```
Get-AzureVM -ServiceName "<VmCloudServiceName>" -Name "<VmName>" | Remove-AzureAvailabilitySet | Update-AzureVM
```

## <a name="for-single-instance-configuration"></a>Одноэкземплярная конфигурация
Выбрать время для планового обслуживания, которое затрагивает виртуальные машины, развернутые в одноэкземплярной конфигурации, можно, добавив эти виртуальные машины в группы доступности.

Пошаговое руководство

1. За семь календарных дней до планового обслуживания одноэкземплярных виртуальных машин вам отправляется электронное письмо. Идентификаторы подписок и имена затронутых одноэкземплярных виртуальных машин будут включены в текст.
2. За эти семь дней вы можете выбрать время для перезагрузки экземпляров, добавив одноэкземплярные виртуальные машины в группы доступности в том же регионе. Это изменение в конфигурации приведет к перезагрузке, так как виртуальная машина перемещается с одного физического узла, которому назначено обслуживание, на другой физический узел, который не будет обслуживаться.
3. Следуйте приведенным здесь инструкциям для добавления существующих виртуальных машин в группы доступности с помощью портала Azure и Azure PowerShell. (См. пример для Azure PowerShell в конце этого раздела.)
4. Когда эти виртуальные машины будут перенастроены как многоэкземплярные, они будут исключены из планового обслуживания одноэкземплярных виртуальных машин.
5. После обновления одноэкземплярных виртуальных машин (в соответствии с расписанием в письме) можно удалить виртуальные машины из групп доступности. Они будут повторно настроены как одноэкземплярные.

Добавить виртуальную машину в группу доступности можно также с помощью Azure PowerShell:

    Get-AzureVM -ServiceName "<VmCloudServiceName>" -Name "<VmName>" | Set-AzureAvailabilitySet -AvailabilitySetName "<AvSetName>" | Update-AzureVM

<!--Anchors-->



<!--Link references-->
[Virtual Machines Manage Availability]: virtual-machines-windows-tutorial.md
[Understand planned versus unplanned maintenance]: virtual-machines-manage-availability.md#Understand-planned-versus-unplanned-maintenance/
