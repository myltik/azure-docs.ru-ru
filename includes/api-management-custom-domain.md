## <a name="how-apim-proxy-server-responds-with-ssl-certificates-in-the-tls-handshake"></a>Как прокси-сервер APIM отвечает с использованием SSL-сертификатов в подтверждении TLS

### <a name="clients-calling-with-sni-header"></a>Клиенты, осуществляющие вызов с заголовком SNI
Если у клиента один или несколько личных доменов настроены для использования прокси-сервера, APIM может отвечать на HTTPS-запросы из пользовательских доменов (например, contoso.com) и доменов по умолчанию (например, apim-service-name.azure-api.net). На основе информации в заголовке указания имени сервера (SNI) APIM отвечает с использованием соответствующего сертификата сервера.

### <a name="clients-calling-without-sni-header"></a>Клиенты, осуществляющие вызов без заголовка SNI
Если пользователь применяет клиент, который не отправляет заголовок [SNI](https://tools.ietf.org/html/rfc6066#section-3), APIM создает ответы на основе следующей логики:

* Если в службе есть только один личный домен, который настроен для использования прокси-сервера, сертификат по умолчанию является сертификатом, выданным прокси-серверу личного домена.
* Если в службе настроено несколько личных доменов для прокси-сервера (поддерживается только на уровне **Премиум**), клиент может указать сертификат по умолчанию. Чтобы установить сертификат по умолчанию, для свойства [defaultSslBinding](https://docs.microsoft.com/rest/api/apimanagement/apimanagementservice/createorupdate#hostnameconfiguration) нужно задать значение true ("defaultSslBinding":"true"). Если клиент не задал свойство, сертификатом по умолчанию является сертификат, выданный домену прокси-сервера по умолчанию по адресу *.azure-api.net.

## <a name="support-for-putpost-request-with-large-payload"></a>Поддержка запросов PUT/POST с большим объемом полезных данных

Прокси-сервер APIM поддерживает запросы с большим объемом полезных данных при использовании клиентских сертификатов в HTTPS (например, если полезных данных больше 40 КБ). Чтобы предотвратить зависание запроса сервера, клиенты могут задать свойство ["negotiateClientCertificate": "true"](https://docs.microsoft.com/rest/api/apimanagement/ApiManagementService/CreateOrUpdate#hostnameconfiguration) на узле прокси-сервера. Если свойство имеет значение true, сертификат клиента запрашивается во время подключения SSL/TLS перед обменом HTTP-запросами. Так как этот параметр применяется на уровне **имени узла прокси-сервера**, все запросы на подключение запрашивают сертификат клиента. Клиенты могут настроить до 20 личных доменов для прокси-сервера (поддерживается только на уровне **Премиум**) и обойти это ограничение.

