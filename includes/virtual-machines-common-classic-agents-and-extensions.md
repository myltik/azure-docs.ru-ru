

Расширения ВМ можно использовать в следующих целях.

* Изменение функций безопасности и идентификации, в том числе сброс значений учетных записей и использование защиты от вредоносных программ.
* Запуск, остановка и настройка функций мониторинга и диагностики.
* Сброс или установка функций подключения, например RDP и SSH.
* Диагностика и мониторинг виртуальных машин, а также управление ими.

Также существует множество других функций. Новые функции расширений виртуальных машин выпускаются регулярно. В этой статье описываются агенты виртуальной машины Azure для Windows и Linux, а также их поддержка работы расширений виртуальных машин. Список расширений виртуальных машин, в котором указаны категории компонентов, приводится в статье [Обзор расширений и компонентов виртуальной машины](../articles/virtual-machines/extensions/features-windows.md).

## <a name="azure-vm-agents-for-windows-and-linux"></a>Агенты виртуальной машины Azure для Windows и Linux
Агент виртуальной машины Azure — это защищенный и нетребовательный к ресурсам процесс, который устанавливает, настраивает и удаляет расширения ВМ на экземплярах виртуальных машин Azure. Агент ВМ выполняет роль локальной службы безопасности виртуальной машины Azure. Расширения, которые загружает агент, отвечают за определенные функции для повышения производительности во время работы экземпляра.

Существует два агента виртуальной машины Azure: для виртуальных машин Windows и для виртуальных машин Linux.

Если необходимо, чтобы экземпляр виртуальной машины использовал одно или несколько расширений, на этом экземпляре должен быть установлен агент виртуальной машины. Образ виртуальной машины, созданный с помощью портала Azure, и образ из **Marketplace** автоматически устанавливает агент виртуальной машины в процессе создания. Если на экземпляре виртуальной машины отсутствует агент виртуальной машины, его можно установить после создания экземпляра виртуальной машины. Также можно установить агент в пользовательский образ виртуальной машины, а затем отправить этот образ.

> [!IMPORTANT]
> Агенты виртуальной машины представляют собой очень простые службы, обеспечивающие защищенное администрирование экземпляров виртуальных машин. Возможны ситуации, в которых вы захотите отключить агент виртуальной машины. В этом случае следует создать виртуальную машину, в которой не установлен агент виртуальной машины, с помощью PowerShell или Azure CLI. Агент виртуальной машины можно удалить физически, но при этом реакция на события расширений виртуальных машин на этом экземпляре будет неопределенной. Таким образом, удаление установленного агента виртуальной машины не поддерживается.
>

Агент ВМ включается в следующих ситуациях.

* При создании экземпляра виртуальной машины с помощью портала Azure с использованием образа из **Marketplace**.
* Когда вы создаете экземпляр виртуальной машины с помощью командлета [New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx) или [New-AzureQuickVM](https://msdn.microsoft.com/library/azure/dn495183.aspx). Вы можете создать виртуальную машину и без агента виртуальной машины. Для этого добавьте в командлет [Add-AzureProvisioningConfig](https://msdn.microsoft.com/library/azure/dn495299.aspx) параметр **–DisableGuestAgent**.

* Если агент виртуальной машины скачивается и устанавливается вручную на существующий экземпляр виртуальной машины и для параметра **ProvisionGuestAgent** задано значение **true**. Этот метод можно использовать для агентов Windows и Linux с помощью команды PowerShell или вызова REST. (Если вы не установите значение **ProvisionGuestAgent** после установки агента виртуальной машины вручную, добавление агента виртуальной машины не будет обнаружено.) В следующем примере кода показано, как вы можете это сделать с помощью PowerShell, когда аргументы `$svc` и `$name` уже определены.

      $vm = Get-AzureVM –ServiceName $svc –Name $name
      $vm.VM.ProvisionGuestAgent = $TRUE
      Update-AzureVM –Name $name –VM $vm.VM –ServiceName $svc

* При создании образа виртуальной машины, который включает в себя установленный агент виртуальной машины. После создания образа с агентом можно отправить этот образ в Azure. Для виртуальной машины Windows вы можете установить агент, скачав [MSI-файл агента виртуальной машины Windows](http://go.microsoft.com/fwlink/?LinkID=394789) . Для виртуальной машины Linux установить агент виртуальной машины можно из репозитория GitHub, расположенного по адресу <https://github.com/Azure/WALinuxAgent>. Дополнительные сведения об установке агента виртуальной машины в Linux можно найти в [руководстве пользователя по агенту виртуальной машины Linux для Azure](../articles/virtual-machines/extensions/agent-linux.md).

> [!NOTE]
> В PaaS агент виртуальной машины называется **WindowsAzureGuestAgent** и всегда доступен в виртуальных машинах с веб-ролью и рабочей ролью. (Дополнительные сведения можно найти в записи блога [Azure Role Architecture](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx) (Архитектура ролей Azure).) Теперь агент виртуальной машины для виртуальных машин с ролями может добавлять расширения в виртуальные машины облачных служб таким же образом, как и в постоянные виртуальные машины. Главное отличие расширений для виртуальных машин с ролями от расширений для постоянных виртуальных машин заключается в способе их добавления. Для виртуальных машин с ролями расширения сначала добавляются в облачную службу, а затем в развертывания в облачной службе.
>
> Используйте командлет [Get AzureServiceAvailableExtension](https://msdn.microsoft.com/library/azure/dn722498.aspx) , чтобы получить список всех доступных расширений для виртуальных машин с ролями.
>
>

## <a name="find-add-update-and-remove-vm-extensions"></a>Поиск, добавление, обновление и удаление расширений виртуальной машины
Дополнительные сведения об этих задачах можно найти в статье [Управление расширениями виртуальной машины](../articles/virtual-machines/windows/classic/manage-extensions.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).
