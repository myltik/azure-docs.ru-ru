---
title: Настройка обмена сообщениями с помощью служебной шины Azure в Azure Logic Apps | Документация Майкрософт
description: Отправка и получение сообщений в приложениях логики с помощью служебной шины Azure
services: logic-apps
documentationcenter: ''
author: ecfan
manager: jeconnoc
editor: ''
tags: connectors
ms.assetid: d6d14f5f-2126-4e33-808e-41de08e6721f
ms.service: logic-apps
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: logic-apps
ms.date: 02/06/2018
ms.author: ladocs
ms.openlocfilehash: aa6ab10dded541b352bdb7c8c3a47dbbbfe6a15c
ms.sourcegitcommit: 6f6d073930203ec977f5c283358a19a2f39872af
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "35295474"
---
# <a name="send-and-receive-messages-with-the-azure-service-bus-connector"></a>Отправка и получение сообщений с помощью соединителя служебной шины Azure

Для отправки и получения сообщений подключитесь к [служебной шине Azure](https://azure.microsoft.com/services/service-bus/). Вы можете выполнять такие действия, как отправка в очередь, отправка в раздел, получение из очереди и получение из подписки. Дополнительные сведения см. в статьях [Обмен сообщениями через служебную шину: гибкая доставка данных в облаке](../service-bus-messaging/service-bus-messaging-overview.md) и [Модель ценообразования приложений логики](../logic-apps/logic-apps-pricing.md).

## <a name="prerequisites"></a>предварительным требованиям

Для использования соединителя служебной шины необходимы следующие компоненты (они должны находиться в одной подписке Azure):

* [пространство имен служебной шины и сущность обмена сообщениями, например очередь;](../service-bus-messaging/service-bus-create-namespace-portal.md)
* [приложение логики.](../logic-apps/quickstart-create-first-logic-app-workflow.md)

<a name="permissions-connection-string"></a>

## <a name="connect-to-azure-service-bus"></a>Подключение к служебной шине Azure

Чтобы приложение логики получило доступ к любой службе, следует создать [*подключение*](./connectors-overview.md) между приложением логики и службой (если вы еще не сделали это). Такое подключение предоставит приложению логики права на доступ к данным. Чтобы приложение логики могло получать доступ к учетной записи служебной шины, проверьте свои разрешения.

1. Войдите на [портал Azure](https://portal.azure.com "Портал Azure"). 

2. Перейдите в *пространство имен* служебной шины вместо определенной сущности обмена сообщениями. На странице пространства имен в разделе **Параметры** выберите **Политики общего доступа**. В разделе **Утверждения** убедитесь, что у вас есть разрешения на **управление** для этого пространства имен.

   ![Управление разрешениями для пространства имен служебной шины](./media/connectors-create-api-azure-service-bus/azure-service-bus-namespace.png)

3. Если вы хотите ввести сведения о подключении позже, получите строку подключения для пространства имен служебной шины. Выберите **RootManageSharedAccessKey**. Теперь нажмите кнопку копирования рядом со строкой подключения первичного ключа. Сохраните строку подключения для дальнейшего использования.

   ![Копирование строки подключения к пространству имен служебной шины](./media/connectors-create-api-azure-service-bus/find-service-bus-connection-string.png)

   > [!TIP]
   > Чтобы проверить, относится ли строка подключения к пространству имен служебной шины или к определенной сущности, найдите в ней параметр `EntityPath`. Если в строке подключения есть такой параметр, значит она относится к определенной сущности, и ее нельзя использовать в приложении логики.

## <a name="trigger-workflow-when-your-service-bus-gets-new-messages"></a>Запуск рабочего процесса при получении нового сообщения служебной шиной

[*Триггер*](../logic-apps/logic-apps-overview.md#logic-app-concepts) — это событие, которое запускает рабочий процесс приложения логики. Чтобы рабочий процесс запускался при отправке нового сообщения в служебную шину, добавьте триггер для обнаружения сообщений, сделав следующее.

1. На [портале Azure](https://portal.azure.com "портал Azure ") перейдите к существующему приложению логики или создайте пустое приложение логики.

2. В поле поиска конструктора Logic Apps введите в качестве фильтра "служебная шина". Выберите соединитель **служебной шины**. 

   ![Выбор соединителя служебной шины](./media/connectors-create-api-azure-service-bus/select-service-bus-connector.png) 

3. Выберите триггер, который хотите использовать. Например, для запуска приложения логики при отправке нового элемента в очередь служебной шины выберите триггер **Служебная шина — при получении сообщения в очереди (автозавершение)**.

   ![Выбор триггера служебной шины](./media/connectors-create-api-azure-service-bus/select-service-bus-trigger.png)

   > [!NOTE]
   > Некоторые триггеры возвращают одно или несколько сообщений, например триггер *Служебная шина — при поступлении одного или нескольких сообщений в очередь (автозавершение)*.
   > Когда такие триггеры срабатывают, они возвращают от одного до нескольких сообщений. Количество сообщений определяется в свойстве триггера **Максимальное число сообщений**.

   1. Если у вас еще нет подключения к пространству имен служебной шины, вам будет предложено создать такое подключение. Назовите подключение и выберите пространство имен служебной шины.

      ![Создание подключения к служебной шине](./media/connectors-create-api-azure-service-bus/create-service-bus-connection-1.png)

      Чтобы ввести строку подключения вручную, выберите **Вручную введите сведения о подключении**. 
      Сведения о том, как найти строку подключения, см. разделе [Подключение к служебной шине](#permissions-connection-string).
      

   2. Теперь выберите нужную политику служебной шины и нажмите кнопку **Создать**.

      ![Создание подключения к служебной шине, часть 2](./media/connectors-create-api-azure-service-bus/create-service-bus-connection-2.png)

4. Выберите очередь служебной шины и настройте интервал и частоту проверки очереди.

   ![Выбор очереди служебной шины, настройка интервала проверки](./media/connectors-create-api-azure-service-bus/select-service-bus-queue.png)

   > [!NOTE]
   > Все триггеры служебной шины имеют **длинный интервал опроса**. Это значит, что после срабатывания триггер обрабатывает все сообщения, после чего в течение 30 секунд ожидает на появление новых событий в очереди или подписке раздела.
   > Если на протяжении 30 секунд новые сообщения не поступают, триггер больше не срабатывает. В противном случае триггер продолжит считывать сообщения, пока очередь или подписка раздела не опустеет.
   > Следующий опрос триггера основывается на интервале повторения, установленном в свойствах триггера.

5. Сохраните приложение логики. На панели инструментов конструктора нажмите кнопку **Сохранить**.

Теперь, когда приложение логики проверяет выбранную очередь и находит новое сообщение, триггер запускает действия в приложении логики для найденного сообщения.

## <a name="send-messages-from-your-logic-app-to-your-service-bus"></a>Отправка сообщений из приложения логики в служебную шину

[*Действие*](../logic-apps/logic-apps-overview.md#logic-app-concepts) — это задание, выполняемое рабочим процессом приложения логики. После добавления триггера в приложение логики вы можете добавить действие, выполняющее операции с данными, созданными этим триггером. Чтобы отправить сообщение из приложения логики в сущность обмена сообщениями служебной шины, выполните следующее.

1. В конструкторе Logic Apps выберите для триггера пункты **+ Новый шаг** > **Добавить действие**.

2. В поле поиска введите "служебная шина" в качестве фильтра. Выберите соединитель **служебной шины**.

   ![Выбор соединителя служебной шины](./media/connectors-create-api-azure-service-bus/select-service-bus-connector-for-action.png) 

3. Выберите это действие: **Служебная шина — отправить сообщение**.

   ![Выбор действия "Служебная шина — отправить сообщение"](./media/connectors-create-api-azure-service-bus/select-service-bus-send-message-action.png)

4. Выберите для отправки сообщения сущность обмена сообщениями, которая является именем очереди или раздела. Затем введите содержимое сообщения и другие сведения.

   ![Выбор сущности обмена сообщениями и ввод сведений о сообщении](./media/connectors-create-api-azure-service-bus/service-bus-send-message-details.png)    

5. Сохраните приложение логики. 

Теперь у вас есть настроенное действие для отправки сообщений из приложения логики. 

## <a name="connector-specific-details"></a>Сведения о соединителях

Дополнительные сведения о триггерах и действиях, определенных файлом Swagger, и о любых ограничениях см. в статье [Event Hubs](/connectors/servicebus/) (Концентраторы событий).

## <a name="get-support"></a>Получение поддержки

* Если у вас возникли вопросы, то посетите [форум Azure Logic Apps](https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurelogicapps).
* Отправить идею по поводу возможности или проголосовать за нее вы можете на [сайте отзывов пользователей Logic Apps](http://aka.ms/logicapps-wish).

## <a name="next-steps"></a>Дополнительная информация

* Дополнительные сведения о других соединителях для приложений логики Azure см. в статье [Список соединителей](../connectors/apis-list.md).