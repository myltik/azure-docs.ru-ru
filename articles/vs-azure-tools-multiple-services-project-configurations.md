---
title: Настройка проекта Azure с помощью нескольких конфигураций службы | Документация Майкрософт
description: Сведения о настройка проекта облачной службы Azure путем изменения файлов ServiceDefinition.csdef, ServiceConfiguration.Local.cscfg и ServiceConfiguration.Cloud.cscfg.
services: visual-studio-online
author: ghogen
manager: douge
assetId: a4fb79ed-384f-4183-9f74-5cac257206b9
ms.prod: visual-studio-dev15
ms.technology: vs-azure
ms.workload: azure
ms.topic: conceptual
ms.date: 11/11/2017
ms.author: ghogen
ms.openlocfilehash: 9047d7a8a6efdd41a48b6fa83b43a8c87d05d1de
ms.sourcegitcommit: fa493b66552af11260db48d89e3ddfcdcb5e3152
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2018
ms.locfileid: "31798547"
---
# <a name="configuring-your-azure-project-in-visual-studio-to-use-multiple-service-configurations"></a>Настройка проекта Azure в Visual Studio для использования нескольких конфигураций служб

В Visual Studio проект облачной службы Azure включает в себя три файла конфигурации: `ServiceDefinition.csdef`, `ServiceConfiguration.Local.cscfg`, `ServiceConfiguration.Cloud.cscfg`.

- Файл `ServiceDefinition.csdef` развертывается в Azure для описания требований к облачной службе и ее ролям, а также для предоставления параметров, применимых ко всем экземплярам. Параметры могут считываться в среде выполнения с помощью API среды выполнения размещения службы Azure. Этот файл можно обновить в Azure, только когда облачная служба остановлена.
- Файлы `ServiceConfiguration.Local.cscfg` и `ServiceConfiguration.Cloud.cscfg` предоставляют значения для параметров в файле определения и указывают количество экземпляров для запуска каждой из ролей. В файле Local содержатся значения, используемые в отладке. Файл Cloud предоставляет параметры для среды сервера и развертывается в Azure как `ServiceConfiguration.cscfg`. Этот файл нельзя обновить, пока облачная служба работает в Azure.

Изменение параметров конфигурации и управление ими осуществляется в Visual Studio с помощью страниц свойств применимой роли (щелкните роль правой кнопкой мыши и выберите **Свойства** или дважды щелкните роль). Изменения могут быть распространены на любую конфигурацию, выбранную в раскрывающемся меню **Настройка службы**. Свойства рабочих ролей и веб-ролей схожи, за исключением того, что описано в следующих разделах.

![VS_Solution_Explorer_Roles_Properties](./media/vs-azure-tools-multiple-services-project-configurations/IC784076.png)

Сведения о базовых схемах для файлов определения службы и конфигурации службы см. в статьях о [схеме XML (CSDEF-файл)](cloud-services/schema-csdef-file.md) и [схеме XML (CSCFG-файл)](cloud-services/schema-cscfg-file.md). Дополнительные сведения о конфигурации службы см. в статье [Настройка облачных служб](cloud-services/cloud-services-how-to-configure-portal.md).


## <a name="configuration-page"></a>Страница «Конфигурация»

### <a name="service-configuration"></a>Конфигурация службы

Позволяет выбрать, на какой файл `ServiceConfiguration.*.cscfg` влияют изменения. По умолчанию это файл Local и Cloud. Вы можете использовать команду **Управление...** для копирования, переименования или удаления файлов конфигурации. Эти файлы будут добавлены в ваш проект облачной службы и появятся в **обозревателе решений**. Однако переименовать или удалить конфигурации можно только с помощью текущего элемента управления.

### <a name="instances"></a>Экземпляры

Укажите для свойства **Число экземпляров** количество экземпляров, которые служба должна запустить для этой роли.

Укажите для свойства **Размер виртуальной машины** значение **Очень мелкий**, **Мелкий**, **Средний**, **Большой** или **Очень крупный**.  Дополнительные сведения см. в статье [Размеры для облачных служб](cloud-services/cloud-services-sizes-specs.md).

### <a name="startup-action-web-role-only"></a>Действие при запуске (только веб-роли)

Задайте это свойство, чтобы указать, что при запуске отладки программа Visual Studio должна запускать веб-браузер для конечных точек HTTP, HTTPS или конечных точек обоих типов.

**Параметр конечной точки HTTPS** доступен, только если конечная точка HTTPS уже определена для вашей роли. Вы можете определить конечную точку HTTPS на странице свойств **Конечные точки** .

Если вы уже добавили конечную точку HTTPS, параметр конечной точки HTTPS включен по умолчанию. Теперь после того, как вы начнете отладку,и при условии, что оба параметра запуска включены, Visual Studio запустит браузер для этой конечной точки, как и браузер для конечной точки HTTP.

### <a name="diagnostics"></a>Диагностика

По умолчанию для веб-роли включена диагностика. Облачная служба проекта Azure и учетная запись хранения настраиваются для использования локального эмулятора хранения. Когда все будет готово к развертыванию в Azure, нажмите кнопку конструктора (**...**), чтобы использовать хранилище Azure. Данные диагностики можно перенести в учетную запись хранения по требованию или по автоматически заданному расписанию. Дополнительные сведения о системе диагностики Azure см. в статье [Включение диагностики в облачных службах и виртуальных машинах Azure](cloud-services/cloud-services-dotnet-diagnostics.md).

## <a name="settings-page"></a>Страница «Параметры»

На странице **Параметры** можно добавлять параметры в конфигурацию в виде пары "имя — значение". С помощью кода, который выполняется в роли, и классов, предоставляемых [управляемой библиотекой Azure ](http://go.microsoft.com/fwlink?LinkID=171026), в частности метода [GetConfigurationSettingValue](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.getconfigurationsettingvalue.aspx), можно считывать значения параметров конфигурации во время его выполнения.

### <a name="configuring-a-connection-string-for-a-storage-account"></a>Настройка строки подключения для учетной записи хранения

Строка подключения — параметр, который предоставляет сведения о подключении и проверке подлинности для эмулятора хранения или учетной записи хранения Azure. Каждый раз, когда код в роли получает доступ к хранилищу Azure (большим двоичным объектам, очередям или таблицам), ему нужна строка подключения.

> [!Note]
> В строке подключения для учетной записи хранения Azure должен использоваться определенный формат (см. статью [Настройка строк подключения службы хранилища Azure](storage/common/storage-configure-connection-string.md)).

Строку подключения можно настроить на использование локального хранилища (при необходимости), а затем, развернув приложение в облачной службе, настроить строку подключения для учетной записи хранения Azure. Неправильная установка строки подключения может привести к тому, что ваша роль не запустится или зациклится на состояниях инициализации, занятости и остановки.

Для создания строки подключения выберите **Добавить настройку** и установите значение "Строка подключения" в качестве **типа**.

Для новой или имеющейся строки подключения выберите **...*** справа от поля **Значение**, чтобы открыть диалоговое окно **Создание строки подключения к хранилищу**:

1. Для выбора учетной записи хранилища из подписки в разделе **Connect using** (Подключение с помощью) выберите параметр **Ваша подписка**. Затем Visual Studio автоматически получит учетные данные хранилища из файла `.publishsettings`.
1. Выбрав элемент **Manually entered credentials** (Введенные вручную учетные данные), вы сможете указать имя и ключ учетной записи с использованием информации с портала Azure. Чтобы скопировать ключ учетной записи, сделайте следующее. Перейдите к учетной записи хранения портала Azure и выберите **Управление ключами**.
    2. Чтобы скопировать ключ учетной записи, перейдите к учетной записи хранилища на портале Azure, выберите **Параметры > Ключи доступа**, и нажмите соответствующую кнопку, чтобы скопировать в буфер обмена первичный ключ доступа.
1. Выберите один из вариантов соединения. В разделе **Specify custom endpoints** (Указать пользовательские конечные точки) нужно указать определенные URL-адреса для больших двоичных объектов, таблиц и очередей. Пользовательские конечные точки позволяют использовать [пользовательские домены](storage/blobs/storage-custom-domain-name.md) для более точного управления доступом. См. статью [Настройка строк подключения службы хранилища Azure](./storage/common/storage-configure-connection-string.md).
1. Чтобы обновить конфигурацию с использованием новой строки подключения, выберите **OK**, а затем — **Файл > Сохранить**.

Публикуя приложения в Azure следующий раз, выберите для строки подключения ту конфигурацию службы, которая содержит учетную запись хранения Azure. После публикации приложения убедитесь, что оно работает со службами хранилища Azure так, как и ожидалось.

Дополнительные сведения об обновлении конфигураций служб см. в разделе [Управление строками подключения для учетных записей хранения](vs-azure-tools-configure-roles-for-cloud-service.md#manage-connection-strings-for-storage-accounts).

## <a name="endpoints-page"></a>Страница «Конечные точки»

Обычно для веб-роли настроена одна конечная точка HTTP на порте 80. С другой стороны, для рабочей роли можно настроить любое количество конечных точек HTTP, HTTPS или TCP. Конечные точки могут быть входными конечными точками, доступными для внешних клиентов, или внутренними конечными точками, доступными для других ролей, которые выполняются в службе.

- Чтобы предоставить доступ к конечной точке HTTP внешним клиентам и веб-браузерам, измените тип конечной точки на «входная» и укажите имя и номер общего порта.
- Чтобы предоставить доступ к конечной точке HTTPS внешним клиентам и веб-браузерам, измените тип конечной точки на **входная**и укажите имя, номер общего порта, а также имя сертификата управления. Необходимо определить сертификат на странице свойств **Сертификаты**, прежде чем указывать сертификат управления. 
- Чтобы предоставить другим ролям в облачной службе внутренний доступ к конечной точке, измените тип конечной точки на «внутренняя» и укажите имя и возможные частные порты для этой конечной точки.

## <a name="local-storage-page"></a>Страница «Локальное хранилище»

На странице свойств **Локальное хранилище** вы можете зарезервировать для роли один или несколько локальных ресурсов хранилища. Локальный ресурс хранилища — это зарезервированный каталог в файловой системе виртуальной машины Azure, на которой выполняется экземпляр роли.

## <a name="certificates-page"></a>Страница «Сертификаты»

Страница свойств **Сертификаты** позволяет добавить сведения о сертификатах в конфигурацию службы. Обратите внимание, что сертификаты не добавляются в пакет вместе со службой. Их необходимо отдельно передавать в Azure с помощью [портала Azure](http://portal.azure.com).

При добавлении сертификата на этой странице в конфигурацию службы добавляются сведения о сертификатах. Сертификаты не добавляются в пакет вместе со службой. Их необходимо отдельно передавать с помощью портала Azure.

Чтобы связать сертификат с ролью, укажите имя сертификата. Это имя используется для ссылки на сертификат при настройке конечной точки HTTPS на странице **Конечные точки**. Затем выберите тип хранилища сертификатов (**Локальный компьютер** или **Текущий пользователь**) и укажите имя хранилища. Наконец, введите отпечаток сертификата. Если сертификат находится в хранилище текущего пользователя или в личном хранилище, вы можете ввести отпечаток сертификата, выбрав сертификат из заполненного списка. Если он находится в другом месте, введите значение отпечатка вручную.

Когда вы добавляете сертификат из хранилища сертификатов, любые промежуточные сертификаты автоматически добавляются в параметры конфигурации. Кроме того, эти промежуточные сертификаты следует передать в Azure, чтобы правильно настроить службу для использования протокола SSL.

Все сертификаты управления, связанные со службой, применяются к службе только в том случае, если она работает в облаке. Если служба работает в локальной среде разработки, используется стандартный сертификат, управляемый с помощью эмулятора вычислений.
