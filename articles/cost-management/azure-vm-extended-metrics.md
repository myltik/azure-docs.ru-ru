---
title: Добавление расширенных метрик для виртуальных машин Azure | Документация Майкрософт
description: В этой статье описывается, как включить и настроить расширенные метрики диагностики для виртуальных машин Azure.
services: cost-management
keywords: ''
author: bandersmsft
ms.author: banders
ms.date: 06/07/2018
ms.topic: conceptual
ms.service: cost-management
manager: dougeby
ms.custom: ''
ms.openlocfilehash: 58245478cf49c030c435b487e233bbc893a2b9a3
ms.sourcegitcommit: 6f6d073930203ec977f5c283358a19a2f39872af
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "35296362"
---
# <a name="add-extended-metrics-for-azure-virtual-machines"></a>Добавление расширенных метрик для виртуальных машин Azure

Служба "Управление затратами" использует данные метрик виртуальных машин Azure, чтобы показать подробные сведения о ресурсах. Кроме того, эти данные, также называемые счетчиками производительности, используются службой для создания отчетов. Тем не менее служба "Управление затратами" не собирает все данные метрик Azure из гостевых виртуальных машин автоматически — для этого необходимо включить коллекцию метрик. В этой статье описывается, как включить и настроить дополнительные метрики диагностики для виртуальных машин Azure.

После включения коллекции метрик вы можете:

- узнавать, когда виртуальные машины достигают ограничений ресурсов памяти, диска и ЦП;
- обнаруживать тенденции и аномалии потребления;
- управлять расходами, изменяя размеры в соответствии с потреблением;
- получать рекомендации по выбору размера с учетом рентабельности из службы "Управление затратами".

Например, вам может потребоваться отслеживать процент используемой памяти и загрузки ЦП виртуальных машин Azure. Для этого используются такие метрики виртуальной машины Azure, как _Загрузка ЦП [узел]_ и _Процент памяти [гость]_.

## <a name="verify-that-metrics-are-enabled-on-vms"></a>Проверка того, что на виртуальных машинах включены метрики

1. Войдите на портал Azure по адресу http://portal.azure.com.
2. В разделе **Виртуальные машины** выберите виртуальную машину, а затем в разделе **Мониторинг** выберите **Метрики**. Отобразится список доступных метрик.
3. Выберите несколько метрик, и на графике отобразятся их данные.  
    ![Пример метрики. Загрузка ЦП на узле](./media/azure-vm-extended-metrics/metric01.png)

В предыдущем примере для узлов доступен ограниченный набор стандартных метрик и недоступны метрики памяти. Метрики памяти относятся к расширенным метрикам. Чтобы включить расширенные метрики, необходимо выполнить некоторые дополнительные действия. Они приведены в следующем разделе.

## <a name="enable-extended-metrics-in-the-azure-portal"></a>Включение расширенных метрик на портале Azure

Стандартные метрики являются метриками главного компьютера. Метрика _Загрузка ЦП [узел]_ — это один из примеров. Существуют также базовые метрики для гостевых виртуальных машин, которые также называются расширенными метриками. К примерам расширенных метрик относятся _Процент памяти [гость]_ и _Доступная память [гость]_.

Включить расширенные метрики достаточно просто. Включите мониторинг на уровне гостя для каждой виртуальной машины. При включении мониторинга на уровне гостя на виртуальную машину устанавливается агент диагностики Azure. Следующий процесс одинаков для классических и обычных виртуальных машин с ОС Windows и Linux.

### <a name="enable-guest-level-monitoring-on-existing-vms"></a>Включение мониторинга на гостевом уровне в имеющихся виртуальных машинах

1. В разделе **Виртуальные машины** просмотрите список виртуальных машин и выберите нужную.
2. В разделе **Мониторинг** выберите **Метрики**.
3. Щелкните **Параметры диагностики**.
4. На странице параметров диагностики щелкните **Включить мониторинг на гостевом уровне**. Для виртуальной машины Linux требуется имеющаяся учетная запись хранения. Если вы не выберете учетную запись хранения для виртуальной машины Windows, она будет создана автоматически.  
    ![Включение мониторинга на гостевом уровне](./media/azure-vm-extended-metrics/enable-guest-monitoring.png)
5. Через несколько минут агент диагностики Azure будет установлен на виртуальную машину. Обновите страницу, и в списке доступных метрик появятся гостевые метрики.  
    ![Расширенные метрики](./media/azure-vm-extended-metrics/extended-metrics.png)

### <a name="enable-guest-level-monitoring-on-new-vms"></a>Включение мониторинга на гостевом уровне в новых виртуальных машинах

При создании новых виртуальных машин нужно выбрать **диагностику гостевой ОС**. Для виртуальной машины Linux требуется имеющаяся учетная запись хранения. Если вы не выберете учетную запись хранения для виртуальной машины Windows, она будет создана автоматически.

![Включение диагностики гостевой ОС](./media/azure-vm-extended-metrics/new-enable-diag.png)

## <a name="resource-manager-credentials"></a>Учетные данные Resource Manager

После включения расширенных метрик убедитесь, что служба "Управление затратами" имеет доступ к [учетным данным Resource Manager](activate-subs-accounts.md). Они нужны ей для сбора и отображения данных о производительности виртуальных машин. Они также используются для создания рекомендаций по оптимизации затрат. Службе "Управление затратами" требуются данные о производительности из экземпляра по крайней мере за три дня, чтобы определить, целесообразно ли уменьшение размера.

## <a name="enable-vm-metrics-with-a-script"></a>Включение метрик виртуальной машины с помощью скрипта

Вы можете включить метрики виртуальной машины с помощью скриптов Azure PowerShell. Если у вас много виртуальных машин, для которых необходимо включить метрики, можно использовать скрипт для автоматизации процесса. Примеры скриптов находятся в GitHub на странице о [включении диагностики Azure](https://github.com/Cloudyn/azure-enable-diagnostics).

## <a name="view-azure-performance-metrics"></a>Просмотр метрик производительности Azure

Чтобы просмотреть метрики производительности своих экземпляров Azure на портале Cloudyn, выберите **Ресурсы** > **Вычисления** > **Instance Explorer** (Обозреватель экземпляров). В списке экземпляров виртуальных машин разверните экземпляр, а затем разверните ресурс, чтобы просмотреть подробные сведения.

![Обозреватель экземпляра](./media/azure-vm-extended-metrics/instance-explorer.png)

## <a name="next-steps"></a>Дополнительная информация

- Если доступ к API Azure Resource Manager в учетных записях еще не включен, перейдите к разделу [Активация подписок и учетных записей Azure с помощью службы "Управление затратами Azure"](activate-subs-accounts.md).
