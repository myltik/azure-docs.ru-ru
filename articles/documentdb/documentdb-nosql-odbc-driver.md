---
title: "Подключение к DocumentDB Azure с помощью инструментов бизнес-аналитики | Документация Майкрософт"
description: "Узнайте, как создавать таблицы и представления с помощью драйвера ODBC для Azure DocumentDB, чтобы просматривать нормализованные данные в программном обеспечении для бизнес-аналитики и анализа данных."
keywords: "ODBC, драйвер ODBC"
services: documentdb
author: mimig1
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 9967f4e5-4b71-4cd7-8324-221a8c789e6b
ms.service: documentdb
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: rest-api
ms.topic: article
ms.date: 03/27/2017
ms.author: mimig
translationtype: Human Translation
ms.sourcegitcommit: 6e0ad6b5bec11c5197dd7bded64168a1b8cc2fdd
ms.openlocfilehash: 5f712c7fa9b6ee06f7c89de40ba4227a925a35ce
ms.lasthandoff: 03/28/2017


---

# <a name="connect-to-documentdb-using-bi-analytics-tools-with-the-odbc-driver"></a>Подключение к DocumentDB с помощью драйвера ODBC с использованием инструментов бизнес-аналитики

Драйвер ODBC для DocumentDB позволяет подключаться к DocumentDB с помощью инструментов бизнес-аналитики, таких как SQL Server Integration Services, Power BI Desktop и Tableau, а также анализировать данные DocumentDB и создавать их визуализации в этих решениях.

Драйвер ODBC для DocumentDB совместим с ODBC 3.8 и поддерживает синтаксис ANSI SQL-92. Он обеспечивает широкие возможности для ренормализации данных в DocumentDB. Используя драйвер, вы можете представить данные в DocumentDB в виде таблиц и представлений. Драйвер позволяет выполнять операции SQL с таблицами и представлениями, включая группирование по запросам, вставкам, обновлениям и удалениям.

## <a name="why-do-i-need-to-normalize-my-data"></a>Причины для нормализации данных
DocumentDB — это база данных NoSQL, поэтому она обеспечивает возможность быстрой разработки приложений, позволяя им выполнять итерацию модели данных в режиме реального времени, не придерживаясь строгой схемы. Отдельная база данных DocumentDB может содержать документы JSON разной структуры. Это отлично подходит для быстрой разработки приложений. Однако если вам нужно проанализировать данные и создать отчеты на их основе, используя инструменты для анализа данных и бизнес-аналитики, часто данные необходимо сделать плоскими и применить к ним определенную схему.

Именно в этом вам поможет драйвер ODBC. С помощью драйвера ODBC теперь можно ренормализировать данные в DocumentDB в таблицы и представления в соответствии с требованиями к анализу данных и созданию отчетов. Ренормализированные схемы не влияют на базовые данные, и разработчики не обязаны им следовать. Эти схемы просто позволяют использовать совместимые с ODBC инструменты для доступа к данным. База данных DocumentDB придется по душе не только разработчикам, но и специалистам по анализу данных.

Теперь давайте приступим к работе с драйвером ODBC.

## <a id="install"></a>Шаг 1. Установка драйвера ODBC для DocumentDB

1. Скачайте драйверы для своей среды:

    * [Microsoft Azure DocumentDB ODBC 64-bit.msi](https://aka.ms/documentdb-odbc-64x64) для 64-разрядной версии Windows;
    * [Microsoft Azure DocumentDB ODBC 32x64-bit.msi](https://aka.ms/documentdb-odbc-32x64) для 32-разрядной версии на 64-разрядной версии Windows;
    * [Microsoft Azure DocumentDB ODBC 32-bit.msi](https://aka.ms/documentdb-odbc-32x32) для 32-разрядной версии Windows.

    Запустите MSI-файл локально. После этого запустится **мастер установки драйвера ODBC для Microsoft Azure DocumentDB**. 
2. Завершите работу с мастером установки, введя значения по умолчанию для установки драйвера ODBC.
3. Откройте приложение **Администратор источников данных ODBC** на компьютере. Для этого в поле поиска Windows введите **Источники данных ODBC**. 
    Чтобы убедиться, что драйвер установлен, щелкните вкладку **Драйверы**, на которой должен отображаться **драйвер ODBC для Microsoft DocumentDB**.

    ![Администратор источников данных ODBC для DocumentDB](./media/documentdb-nosql-odbc-driver/documentdb-nosql-odbc-driver.png)

## <a id="connect"></a>Этап 2. Подключение к базе данных DocumentDB

1. [Установив драйвер ODBC для DocumentDB ](#install), в окне **Администратор источников данных ODBC** нажмите кнопку **Добавить**. Вы можете создать пользовательское или системное имя источника данных. В этом примере мы создаем пользовательское имя источника данных.
2. В окне **Создание нового источника данных** выберите **Microsoft DocumentDB ODBC Driver** (Драйвер ODBC для Microsoft DocumentDB), а затем нажмите кнопку **Готово**.
3. В окне **DocumentDB ODBC Driver SDN Setup** (Настройка имени источника данных драйвера ODBC для DocumentDB) укажите следующие сведения: 

    ![Окно DocumentDB ODBC Driver SDN Setup (Настройка имени источника данных драйвера ODBC для DocumentDB)](./media/documentdb-nosql-odbc-driver/documentdb-nosql-odbc-driver-dsn-setup.png)
    - **Имя источника данных** — понятное имя для источника данных ODBC. Это имя является уникальным для учетной записи DocumentDB, так что при наличии нескольких учетных записей давайте ей правильное имя.
    - **Описание** — краткое описание источника данных.
    - **Узел** — URI учетной записи DocumentDB. Его можно получить в колонке "Ключи" DocumentDB на портале Azure, как показано на следующем снимке экрана. 
    - **Ключ доступа** — первичный или вторичный ключ для чтения и записи или только для чтения из колонки "Ключи" DocumentDB на портале Azure, как показано на следующем снимке экрана. Мы рекомендуем использовать ключ только для чтения, если имя источника данных используется для обработки данных, предназначенных только для чтения, и создания отчетов на их основе.
    ![Колонка "Ключи" DocumentDB](./media/documentdb-nosql-odbc-driver/documentdb-nosql-odbc-driver-keys.png)
    - **Encrypt Access Key for** (Зашифровать ключ доступа для). Выберите лучший вариант исходя из того, кто использует этот компьютер. 
4. Нажмите кнопку **Проверка**, чтобы убедиться, что вы можете подключиться к своей учетной записи DocumentDB. 
5. Нажмите кнопку **Дополнительные параметры** и задайте следующие значения:
    - **Query Consistency** (Согласованность запросов). Выберите [уровень согласованности](documentdb-consistency-levels.md) операций. Значение по умолчанию — "Сеанс".
    - **Число повторных попыток.** Введите число повторных попыток выполнения операции, если первоначальный запрос не был выполнен из-за регулирования службы.
    - **Schema File** (Файл схемы). Здесь можно выбрать один из нескольких вариантов.
        - По умолчанию (если не указывать здесь сведения) драйвер сканирует данные первой страницы для всех коллекций для определения схемы каждой коллекции. Этот процесс известен как сопоставление коллекций. Так как файл схемы не определен, драйверу приходится выполнять сканирование для каждого сеанса. При этом запуск приложения с использованием имени источника данных может стать дольше. Мы рекомендуем связывать файл схемы для имени источника данных.
        - Если у вас есть файл схемы (созданный с помощью [редактора схем](#schema-editor)), нажмите кнопку **Обзор**, перейдите к файлу, нажмите кнопку **Сохранить** и **ОК**.
        - Если нужно создать схему, нажмите кнопку **ОК**, а затем в главном окне нажмите кнопку **Редактор схем**. Перейдите к сведениям [редактора схем](#schema-editor). Создавая файл схемы, не забудьте вернуться к окну **Дополнительные параметры**, чтобы добавить новый файл схемы.

6. Когда вы завершите настройку и закроете окно **DocumentDB ODBC Driver DSN Setup** (Настройка имени источника данных драйвера ODBC для DocumentDB), новое пользовательское имя источника данных будет добавлено на соответствующую вкладку.

    ![Новое имя источника данных ODBC для DocumentDB на вкладке "DSN пользователя"](./media/documentdb-nosql-odbc-driver/documentdb-nosql-odbc-driver-user-dsn.png)

## <a id="#collection-mapping"></a>Шаг 3. Создание определения схемы с использованием метода сопоставления коллекций

Существует два типа методов выборки, которые можно использовать: **сопоставление коллекций** и **таблицы-разделители**. В сеансе выборки могут использоваться оба метода выборки, но в каждой коллекции можно использовать только один из них. Выполнив приведенные ниже действия, можно создать схему для данных в одной или нескольких коллекциях, используя метод сопоставления коллекций. При использовании этого метода выборки извлекаются данные на странице коллекции для определения структуры данных. Коллекция переносится в таблицу на стороне ODBC. Этот метод выборки действует эффективно и быстро при использовании однородных данных в коллекции. Если коллекция содержит разнородные данные, мы рекомендуем использовать [метод сопоставления таблиц-разделителей](#table-mapping), так как это более надежный метод выборки, позволяющий определить структуру данных в коллекции. 

1. Выполнив шаги 1–4 в разделе [Подключение к базе данных DocumentDB](#connect), нажмите кнопку **Редактор схем** в окне **DocumentDB ODBC Driver DSN Setup** (Настройка имени источника данных драйвера ODBC для DocumentDB).

    ![Кнопка "Редактор схем" в окне DocumentDB ODBC Driver DSN Setup (Настройка имени источника данных драйвера ODBC для DocumentDB)](./media/documentdb-nosql-odbc-driver/documentdb-nosql-odbc-driver-schema-editor.png)
2. В окне **Редактор схем** нажмите кнопку **Создать**.
    Появится окно **Generate Schema** (Создание схемы) со всеми коллекциями в учетной записи DocumentDB. 
3. Выберите одну или несколько коллекций для выборки и щелкните **Sample** (Выборка). 
4. На вкладке **Design View** (Конструктор) представлены базы данных, схемы и таблицы. В табличном представлении отображается набор свойств, связанных с именами столбцов ("Имя SQL", "Имя источника" и т. д.).
    Вы можете изменить имя, тип и длину SQL (если применимо), масштаб (если применимо), точность (если применимо) и параметр, допускающий значение null, для каждого столбца.
    - Для параметра **Скрыть столбец** можно задать значение **true**, если необходимо исключить этот столбец из результатов запроса. Столбцы, для параметра "Скрыть столбец" которых задано значение true, не возвращаются для выбора и проекции, несмотря на то, что они по-прежнему являются частью схемы. Например, можно скрыть все обязательные системные свойства DocumentDB, начинающиеся со знака "_".
    - Столбец **Идентификатор** — это единственное поле, которое нельзя скрыть, так как оно используется в качестве первичного ключа в нормализованной схеме. 
5. Завершив определение схемы, щелкните **Файл** | **Сохранить**, перейдите в каталог, чтобы сохранить схему, и нажмите кнопку **Сохранить**.

    Если в будущем нужно использовать эту схему с именем источника данных, откройте окно DocumentDB ODBC Driver DSN Setup (Настройка имени источника данных драйвера ODBC для DocumentDB) (в приложении "Администратор источников данных ODBC"), нажмите кнопку "Дополнительные параметры" и, используя поле Schema File (Файл схемы), перейдите к сохраненной схеме. При сохранении файла схемы в существующем имени источника данных изменяется DSN-соединение в соответствии с данными и структурой, определенными схемой.

## <a id="table-mapping"></a>Шаг 4. Создание определения схемы с использованием метода таблиц-разделителей

Существует два типа методов выборки, которые можно использовать: **сопоставление коллекций** и **таблицы-разделители**. В сеансе выборки могут использоваться оба метода выборки, но в каждой коллекции можно использовать только один из них. 

Выполнив следующие действия, можно создать схему для данных в одной или нескольких коллекциях, используя метод **таблиц-разделителей**. Мы рекомендуем использовать этот метод выборки, если коллекции содержат разнородные данные. С помощью этого метода можно ограничить выборку набором атрибутов и соответствующими значениями. Например, если документ содержит свойство "Тип", можно ограничить выборку значениями этого свойства. В результате выборки вы получите набор таблиц для каждого значения выбранного типа. Например, если выбрать значение "Автомобиль", будет создана таблица со сведениями об автомобилях, а если выбрать значение "Самолет", будет создана таблица со сведениями о самолетах.

1. Выполнив шаги 1–4 в разделе [Подключение к базе данных DocumentDB](#connect), нажмите кнопку **Редактор схем** в окне DocumentDB ODBC Driver DSN Setup (Настройка имени источника данных драйвера ODBC для DocumentDB).
2. В окне **Редактор схем** нажмите кнопку **Создать**.
    Появится окно **Generate Schema** (Создание схемы) со всеми коллекциями в учетной записи DocumentDB. 
3. Выберите коллекцию на вкладке **Представление-пример** в столбце **Определение сопоставления** для коллекции и щелкните **Изменить**. Затем в окне **Mapping Definition** (Определение сопоставления) выберите метод **Table Delimiters** (Таблицы-разделители). После этого выполните описанные ниже действия.

    а. В поле **Атрибуты** введите имя свойства разделителя. Это свойство документа, которым нужно ограничить выборку (например, "Город"). Затем нажмите клавишу ВВОД. 

    b. Если требуется ограничить выборку только конкретными значениями введенного атрибута, выберите атрибут в списке, а затем введите значение в поле **Значение**, например "Сиэтл", и нажмите клавишу ВВОД. Вы можете добавить еще несколько значений для атрибутов. При вводе значения убедитесь, что выбран правильный атрибут.

    Например, если добавить значение "Город" для **атрибута** и при этом нужно, чтобы таблица содержала только строки со значением города Нью-Йорк и Дубаи, в поле "Атрибуты" следует ввести "Город", а "Нью-Йорк" и "Дубаи" — в поле **Значения**.
4. Нажмите кнопку **ОК**. 
5. Завершив работу с определениями сопоставлений для коллекций, по которым нужно выполнить выборку, в окне **Редактор схем** щелкните **Sample** (Выборка).
     Вы можете изменить имя, тип и длину SQL (если применимо), масштаб (если применимо), точность (если применимо) и параметр, допускающий значение null, для каждого столбца.
    - Для параметра **Скрыть столбец** можно задать значение **true**, если необходимо исключить этот столбец из результатов запроса. Столбцы, для параметра "Скрыть столбец" которых задано значение true, не возвращаются для выбора и проекции, несмотря на то, что они по-прежнему являются частью схемы. Например, можно скрыть все обязательные системные свойства DocumentDB, начинающиеся со знака "_".
    - Столбец **Идентификатор** — это единственное поле, которое нельзя скрыть, так как оно используется в качестве первичного ключа в нормализованной схеме. 
6. Завершив определение схемы, щелкните **Файл** | **Сохранить**, перейдите в каталог, чтобы сохранить схему, и нажмите кнопку **Сохранить**.
7. В окне **DocumentDB ODBC Driver DSN Setup** (Настройка имени источника данных драйвера ODBC для DocumentDB) нажмите кнопку **Дополнительные параметры**. Затем в поле **Schema File** (Файл схемы) перейдите к сохраненному файлу схемы и нажмите кнопку **ОК**. Нажмите кнопку **ОК** еще раз, чтобы сохранить имя источника данных. Таким образом сохраняется схема, созданная для имени источника данных. 

## <a name="optional-creating-views"></a>Создание представлений (необязательно)
В ходе выборки можно определять и создавать представления. Эти представления аналогичны представлениям SQL. Они доступны только для чтения и ограничены выбранными элементами и проекциями определенной базы данных DocumentDB SQL. 

Чтобы создать представление данных, в окне **Редактор схем** в столбце **Определения представлений** щелкните **Добавить** в строке коллекции для выборки. Затем в окне **Определения представлений** сделайте следующее:
1. Щелкните **Создать**, введите имя представления, например EmployeesfromSeattleView, и нажмите кнопку **ОК**.
2. В окне **Изменить представление** введите запрос DocumentDB. Это должен быть SQL-запрос DocumentDB, например `SELECT c.City, c.EmployeeName, c.Level, c.Age, c.Gender, c.Manager FROM c WHERE c.City = “Seattle”`. Затем нажмите кнопку **ОК**.

Количество создаваемых представлений не ограничено. Завершив определение представлений, можно приступить к выборке данных. 

## <a name="step-5-view-your-data-in-bi-tools-such-as-power-bi-desktop"></a>Шаг 5. Просмотр данных в инструментах бизнес-аналитики (Power BI Desktop)

Используя новое имя источника данных, можно подключиться к DocumentDB с помощью любых инструментов, совместимых с ODBC. На этом шаге показано, как подключиться к Power BI Desktop и создать визуализацию Power BI.

1. Откройте Power BI Desktop.
2. Щелкните **Получить данные**.
3. В окне **Получить данные** щелкните **Другие** | **ODBC** | **Подключиться**.
4. В окне **Из ODBC** выберите созданное имя источника данных и нажмите кнопку **ОК**. Поля на вкладке **Дополнительные параметры** можно не заполнять.
5. В окне **Access a data source using an ODBC driver** (Получение доступа к источнику данных с помощью драйвера ODBC) выберите параметр **По умолчанию или пользовательский** и щелкните **Подключиться**. Не нужно добавлять **свойства строки подключения учетных данных**.
6. В окне **Навигатор** на панели слева разверните базу данных, схему и выберите таблицу. В область результатов данные добавляются по созданной схеме.
7. Чтобы визуализировать данные в Power BI Desktop, установите флажок рядом с именем таблицы и щелкните **Загрузить**.
8. В Power BI Desktop слева выберите вкладку "Данные" ![вкладка "Данные" в Power BI Desktop,](./media/documentdb-nosql-odbc-driver/documentdb-nosql-odbc-driver-data-tab.png) чтобы убедиться, что данные импортированы.
9. Теперь с помощью Power BI можно создавать визуальные элементы. Для этого щелкните вкладку "Отчет" ![вкладка "Отчет" в Power BI Desktop](./media/documentdb-nosql-odbc-driver/documentdb-nosql-odbc-driver-report-tab.png), выберите **Новый визуальный объект** и настройте элемент. Дополнительные сведения о создании визуализаций в Power BI Desktop см. в статье [Типы визуализаций в Power BI](https://powerbi.microsoft.com/documentation/powerbi-service-visualization-types-for-reports-and-q-and-a/).

## <a name="troubleshooting"></a>Устранение неполадок

Если появляется следующая ошибка, убедитесь, что значения параметров **Узел** и **Ключ доступа**, скопированные на портале Azure на [шаге 2](#connect), правильные, и повторите попытку. Чтобы скопировать значения без ошибок, нажмите кнопки копирования справа от значений параметров **Узел** и **Ключ доступа** на портале Azure.

    [HY000]: [Microsoft][DocumentDB] (401) HTTP 401 Authentication Error: {"code":"Unauthorized","message":"The input authorization token can't serve the request. Please check that the expected payload is built as per the protocol, and check the key being used. Server used the following payload to sign: 'get\ndbs\n\nfri, 20 jan 2017 03:43:55 gmt\n\n'\r\nActivityId: 9acb3c0d-cb31-4b78-ac0a-413c8d33e373"}`

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о DocumentDB см. в разделе [Что такое DocumentDB?](documentdb-introduction.md).

