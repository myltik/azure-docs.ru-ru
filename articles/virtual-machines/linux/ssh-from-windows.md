---
title: Использование ключей SSH для Windows для подключения к виртуальным машинам Linux | Документация Майкрософт
description: Узнайте, как создавать и использовать ключи SSH на компьютере Windows для подключения к виртуальной машине Linux в Azure.
services: virtual-machines-linux
documentationcenter: ''
author: dlepow
manager: jeconnoc
editor: ''
tags: azure-service-management,azure-resource-manager
ms.assetid: 2cacda3b-7949-4036-bd5d-837e8b09a9c8
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 03/08/2017
ms.author: danlep
ms.openlocfilehash: fcc2365c3b41fb69492aa68bf7c48c2d3b8ee5f3
ms.sourcegitcommit: 5b2ac9e6d8539c11ab0891b686b8afa12441a8f3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
# <a name="how-to-use-ssh-keys-with-windows-on-azure"></a>Использование ключей SSH с Windows в Azure
> [!div class="op_single_selector"]
> * [Windows](ssh-from-windows.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
> * [Linux или Mac](mac-create-ssh-keys.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
>
>

При подключении к виртуальным машинам Linux в Azure необходимо использовать [шифрование с открытым ключом](https://wikipedia.org/wiki/Public-key_cryptography), которое обеспечивает белее высокий уровень безопасности при входе на виртуальные машины Linux. Этот процесс предполагает обмен открытыми и закрытыми ключами с использованием команды Secure Shell (SSH), что позволяет аутентифицировать себя, не вводя имя пользователя и пароль. Пароли подвержены атакам методом подбора, особенно на виртуальных машинах с подключением к Интернету, таких как веб-серверы. В этой статье приведены общие сведения о ключах SSH, а также о том, как создать соответствующие ключи на компьютере Windows.

## <a name="overview-of-ssh-and-keys"></a>Общие сведения о SSH и ключах
На виртуальную машину Linux можно безопасно войти с использованием открытых и закрытых ключей.

* **Открытый ключ** хранится на виртуальной машине Linux или в любой другой службе, для которой требуется шифрование с открытым ключом.
* **Закрытый ключ** предоставляется виртуальной машине Linux при входе в систему для проверки подлинности. Его нужно защищать и нельзя никому предоставлять.

Открытые и закрытые ключи можно использовать на нескольких виртуальных машинах или в нескольких службах. Не нужно выделять пару ключей для каждой виртуальной машины или службы, к которой необходим доступ. Дополнительные сведения о шифровании с открытым ключом см. [здесь](https://wikipedia.org/wiki/Public-key_cryptography).

SSH — это протокол зашифрованного подключения, позволяющий безопасно входить в систему через незащищенные соединения. Это протокол подключения по умолчанию для виртуальных машин Linux, размещенных в Azure. Хотя протокол SSH и обеспечивает зашифрованное подключение, при использовании соединений SSH пароль виртуальной машины все равно не защищен от атак методом подбора. Более безопасный и предпочтительный метод подключения к виртуальной машине по протоколу SSH заключается в использовании открытых и закрытых ключей, также известных как ключи SSH.

Если вам не нужно использовать эти ключи для входа на виртуальную машину Linux, можно по-прежнему использовать пароль. Этого достаточно для виртуальных машин без интернет-доступа. Но пользователь по-прежнему должен управлять паролями каждой своей виртуальной машины, а также вводить соответствующие политики паролей и предоставлять рекомендации, к примеру, в отношении минимальной длины паролей и частоты их обновления. Использование ключей SSH упрощает управление отдельными учетными данными на нескольких виртуальных машинах.

## <a name="windows-packages-and-ssh-clients"></a>Пакеты Windows и SSH-клиенты
Пользователи могут подключаться к виртуальным машинам Linux в Azure и управлять ими с помощью **SSH-клиента**. Но на компьютерах Windows, как правило, SSH-клиент не установлен. В юбилейном обновлении Windows 10 добавлен компонент Bash для Windows, а последняя версия Windows 10 Creators Update содержит дополнительные обновления. Эта подсистема Windows для Linux позволяет запускать и использовать такие служебные программы, как SSH-клиент, в собственной оболочке Bash. Это позволяет выполнять инструкции из любой документации по Linux, например из раздела [Как создать и использовать пару из открытого и закрытого ключей SSH для виртуальных машин Linux в Azure](mac-create-ssh-keys.md). Bash для Windows находится на стадии разработки, и сейчас доступен бета-выпуск. Дополнительные сведения о Bash для Windows см. в записи блога [Bash on Ubuntu on Windows](https://msdn.microsoft.com/commandline/wsl/about) (Bash для Ubuntu в Windows).

Если вы хотите использовать не Bash для Windows, а другой инструмент, то можете установить общие SSH-клиенты Windows, включенные в следующие пакеты:

* [Git для Windows](https://git-for-windows.github.io/);
* [PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/);
* [MobaXterm](http://mobaxterm.mobatek.net/)
* [Cygwin](https://cygwin.com/)


## <a name="which-key-files-do-you-need-to-create"></a>Какие файлы ключей необходимо создать?
В Azure необходимо использовать по крайней 2048-разрядные открытые и закрытые ключи в формате **ssh-rsa**. Если для управления ресурсами Azure используется классическая модель развертывания, также необходимо создать ключ формата PEM (`.pem`-файла).

Ниже приведены сценарии развертывания и типы используемых в них файлов.

1. Ключи **ssh-rsa** нужны для любого развертывания с использованием [портала Azure](https://portal.azure.com), а также для развертываний Resource Manager с помощью [интерфейса командной строки Azure](../../cli-install-nodejs.md).
   * Обычно эти ключи нужны большинству пользователей.
2. `.pem`-файл нужен для создания виртуальных машин с помощью классической модели развертывания. Эти ключи поддерживаются в классической модели развертывания при использовании [портала Azure](https://portal.azure.com) или [Azure CLI](../../cli-install-nodejs.md).
   * Дополнительные ключи и сертификаты нужно создавать только для управления ресурсами, созданными с использованием классической модели развертывания.

## <a name="install-git-for-windows"></a>Установка Git для Windows
В предыдущем разделе указаны несколько пакетов, содержащих средство `openssl` для Windows. Это средство используется для создания открытых и закрытых ключей. В следующих примерах приведены инструкции по установке и использованию средства **Git для Windows**, но вы можете использовать любой из указанных пакетов. **Git для Windows** предоставляет доступ к дополнительным средствам и служебным программам с открытым кодом ([OSS](https://en.wikipedia.org/wiki/Open-source_software)), полезным при работе с виртуальными машинами Linux.

1. Скачайте и установите **Git для Windows** из следующего расположения: [https://git-for-windows.github.io/](https://git-for-windows.github.io/).
2. Во время установки примите параметры по умолчанию (при необходимости их можно изменить).
3. Запустите**Git Bash** (**меню "Пуск"** > **Git** > **Git Bash**). Консоль будет выглядеть примерно следующим образом:

    ![Оболочка Bash Git для Windows](./media/ssh-from-windows/git-bash-window.png)

## <a name="create-a-private-key"></a>Создание закрытого ключа
1. В окне **Git Bash** используйте `openssl.exe`, чтобы создать закрытый ключ. В следующем примере создается ключ с именем `myPrivateKey` и сертификат `myCert.pem`.

    ```bash
    openssl.exe req -x509 -nodes -days 365 -newkey rsa:2048 \
        -keyout myPrivateKey.key -out myCert.pem
    ```

    Результат должен быть аналогичным приведенному ниже:

    ```bash
    Generating a 2048 bit RSA private key
    .......................................+++
    .......................+++
    writing new private key to 'myPrivateKey.key'
    -----
    You are about to be asked to enter information that will be incorporated
    into your certificate request.
    What you are about to enter is what is called a Distinguished Name or a DN.
    There are quite a few fields but you can leave some blank
    For some fields there will be a default value,
    If you enter '.', the field will be left blank.
    -----
    Country Name (2 letter code) [AU]:
    ```

   Если bash сообщает об ошибке, попробуйте открыть новое окно **Git Bash** с повышенными привилегиями. Затем повторно выполните команду `openssl`.

2. В ответ на запросы укажите название страны, расположение, название организации и т. д.
3. Новый закрытый ключ и сертификат будут созданы в текущей рабочей папке. В целях обеспечения безопасности, чтобы у посторонних пользователей не было доступа к закрытому ключу, для него необходимо задать разрешения.

    ```bash
    chmod 0600 myPrivateKey.key
    ```

4. В [следующем разделе](#create-a-private-key-for-putty) представлены сведения о просмотре и использовании открытого ключа с помощью PuTTYgen, а также о создании закрытого ключа для подключения к виртуальной машине Linux по протоколу SSH с помощью PuTTY. Следующая команда создает файл открытого ключа с именем `myPublicKey.key`, который можно сразу использовать:

    ```bash
    openssl.exe rsa -pubout -in myPrivateKey.key -out myPublicKey.key
    ```

5. Чтобы управлять классическими ресурсами, преобразуйте `myCert.pem` в `myCert.cer` (сертификат X509 в кодировке DER). Это действие необязательное и требуется, только если нужно управлять устаревшими классическими ресурсами.

    Преобразуйте сертификат с помощью следующей команды:

    ```bash
    openssl.exe  x509 -outform der -in myCert.pem -out myCert.cer
    ```

## <a name="create-a-private-key-for-putty"></a>Создание закрытого ключа для PuTTY
PuTTY — это общераспространенный SSH-клиент для Windows. Вы можете использовать любой необходимый SSH-клиент. Для поддержки клиента PuTTY необходимо создать ключ еще одного типа, закрытый ключ PuTTY (PPK). Если вы не хотите использовать PuTTY, пропустите этот раздел.

В следующем примере создается этот дополнительный закрытый ключ специально для PuTTY.

1. Используйте **Git Bash**, чтобы преобразовать свой закрытый ключ в закрытый ключ RSA, который распознается PuTTYgen. В следующем примере создается ключ с именем `myPrivateKey_rsa` на основе имеющегося ключа `myPrivateKey`.

    ```bash
    openssl rsa -in ./myPrivateKey.key -out myPrivateKey_rsa
    ```

    В целях обеспечения безопасности, чтобы у посторонних пользователей не было доступа к закрытому ключу, для него необходимо задать разрешения.

    ```bash
    chmod 0600 myPrivateKey_rsa
    ```
2. Скачайте и запустите PuTTYgen из следующего расположения: [http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html).
3. Выберите меню **File** (Файл) > **Load a Private Key** (Загрузить закрытый ключ).
4. Найдите свой закрытый ключ (в предыдущем примере — `myPrivateKey_rsa`). При запуске **Git Bash** по умолчанию используется каталог `C:\Users\%username%`. Измените фильтр файлов, чтобы отобразить **все файлы (\*.\*)**.

    ![Загрузка имеющегося закрытого ключа в PuTTYgen](./media/ssh-from-windows/load-private-key.png)
5. Щелкните **Открыть**. Появится запрос, который указывает, что ключ успешно импортирован.

    ![Ключ успешно импортирован в PuTTYgen](./media/ssh-from-windows/successfully-imported-key.png)
6. Нажмите кнопку **OK** (ОК), чтобы закрыть запрос.
7. Открытый ключ отображается в верхней части окна **PuTTYgen**. Скопируйте этот открытый ключ и вставьте его на портале Azure или в шаблон Azure Resource Manager при создании виртуальной машины Linux. Кроме того, нажав кнопку **Save public key** (Сохранить открытый ключ), вы сохраните копию ключа на компьютере.

    ![Сохранение файла PuTTY с открытым ключом](./media/ssh-from-windows/save-public-key.png)

    В следующем примере показано, как скопировать и вставить открытый ключ на портале Azure при создании виртуальной машины Linux. Открытый ключ, как правило, хранится в каталоге `~/.ssh/authorized_keys` на новой виртуальной машине.

    ![Использование открытого ключа при создании виртуальной машины на портале Azure](./media/ssh-from-windows/use-public-key-azure-portal.png)
8. Вернитесь к **PuTTYgen** и нажмите кнопку **Save private Key** (Сохранить закрытый ключ):

    ![Сохранение файла PuTTY с закрытым ключом](./media/ssh-from-windows/save-ppk-file.png)

   > [!WARNING]
   > Появится запрос на продолжение работы без ввода парольной фразы для ключа. Парольная фраза представляет собой пароль, прикрепленный к закрытому ключу. Даже если другой пользователь получит доступ к вашему закрытому ключу, он не сможет пройти проверку подлинности с помощью одного только ключа. Ему потребуется также парольная фраза. Если не создать парольную фразу, пользователь, получивший ваш закрытый ключ, сможет войти на любую виртуальную машину или в службу, использующую этот ключ. Мы рекомендуем создать ее. Однако если вы забудете парольную фразу, восстановить ее будет невозможно.
   >
   >

    Чтобы ввести парольную фразу, щелкните **No** (Нет), введите ее в главном окне PuTTYgen, а затем снова нажмите кнопку **Save private key** (Сохранить закрытый ключ). Или же щелкните **Yes** (Да), чтобы продолжить без парольной фразы.
9. Введите имя PPK-файла и расположение, в котором его нужно сохранить.

## <a name="use-putty-to-ssh-to-a-linux-machine"></a>Использование PuTTY для подключения к компьютеру Linux по протоколу SSH
Отметим еще раз, PuTTY — это общераспространенный SSH-клиент для Windows. Вы можете использовать любой необходимый SSH-клиент. Шаги ниже описывают, как использовать закрытый ключ для аутентификации на виртуальной машине Azure по протоколу SSH. В других SSH-клиентах выполняются аналогичные шаги относительно загрузки закрытого ключа для проверки подлинности подключения SSH.

1. Скачайте и запустите PuTTY из следующего расположения: [http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html).
2. Введите имя узла или IP-адрес виртуальной машины на портале Azure.

    ![Открытие нового подключения PuTTY](./media/ssh-from-windows/putty-new-connection.png)
3. Прежде чем нажать **Open** (Открыть) щелкните узел **Connection** (Подключение)  > **SSH** > вкладка **Auth** (Проверка подлинности). Укажите закрытый ключ.

    ![Выбор закрытого ключа PuTTY для проверки подлинности](./media/ssh-from-windows/putty-auth-dialog.png)
4. Щелкните **Открыть** , чтобы подключится к виртуальной машине.

## <a name="next-steps"></a>Дополнительная информация
Открытые и закрытые ключи можно также создавать в [OS X и Linux](mac-create-ssh-keys.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

Дополнительные сведения о Bash для Windows и преимуществах средств OSS на компьютере Windows см. в записи блога [Bash on Ubuntu on Windows](https://msdn.microsoft.com/commandline/wsl/about) (Bash для Ubuntu в Windows).

Если при подключении к виртуальным машинам Linux по протоколу SSH возникают проблемы, см. статью [Устранение неполадок с SSH-подключением к виртуальной машине Azure Linux](troubleshoot-ssh-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).
