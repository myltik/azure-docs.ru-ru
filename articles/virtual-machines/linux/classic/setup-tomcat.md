---
title: Настройка Apache Tomcat на виртуальной машине Linux | Документация Майкрософт
description: Сведения о настройке Apache Tomcat7 с помощью виртуальной машины Azure под управлением Linux.
services: virtual-machines-linux
documentationcenter: ''
author: NingKuang
manager: jeconnoc
editor: ''
tags: azure-service-management
ms.assetid: 45ecc89c-1cb0-4e80-8944-bd0d0bbedfdc
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 12/15/2015
ms.author: ningk
ms.openlocfilehash: 161a56a019f8c2c8ce5e3890e73ad5c5710e7b82
ms.sourcegitcommit: 6fcd9e220b9cd4cb2d4365de0299bf48fbb18c17
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2018
ms.locfileid: "30841621"
---
# <a name="set-up-tomcat7-on-a-linux-virtual-machine-with-azure"></a>Настройка Tomcat7 на виртуальной машине Linux с использованием Azure
Apache Tomcat (или просто Tomcat, ранее также именуемый Jakarta Tomcat) — это веб-сервер с открытым исходным кодом и контейнер сервлетов, разработанный Apache Software Foundation (ASF). Tomcat реализует спецификации технологий Java Servlet и JavaServer Pages (JSP) от Sun Microsystems, а также обеспечивает чистую среду HTTP-веб-серверов Java для выполнения Java-кода. При самой простой конфигурации Tomcat запускается с помощью одного процесса в операционной системе. Этот процесс запускает виртуальную машину Java. Каждый HTTP-запрос браузера к серверу Tomcat обрабатывается как отдельный поток в рамках процесса Tomcat.  

> [!IMPORTANT]
> В Azure предлагаются две модели развертывания для создания ресурсов и работы с ними: [модель Azure Resource Manager и классическая модель](../../../resource-manager-deployment-model.md). В этой статье рассматривается использование классической модели развертывания. Для большинства новых развертываний рекомендуется использовать модель Resource Manager. Сведения о том, как использовать шаблон Resource Manager для развертывания виртуальной машины Ubuntu с Open JDK и Tomcat, см. [в этой статье](https://azure.microsoft.com/documentation/templates/openjdk-tomcat-ubuntu-vm/).
> [!INCLUDE [virtual-machines-common-classic-createportal](../../../../includes/virtual-machines-classic-portal.md)]

В этой статье показано, как установить Tomcat7 в образе Linux и развернуть его в службе Azure.  

Вы узнаете:  

* как создать виртуальную машину в Azure.
* как подготовить виртуальную машину для Tomcat7;
* как установить Tomcat7.

Предполагается, что у вас уже есть подписка Azure.  В противном случае вы можете оформить подписку на бесплатную пробную версию на [веб-сайте Azure](https://azure.microsoft.com/). Если у вас есть подписка MSDN, сведения о специальных ценах Microsoft Azure на MSDN, MPN и Bizspark см. на [этой странице](https://azure.microsoft.com/pricing/member-offers/msdn-benefits/?c=14-39). Дополнительные сведения о службе Azure см. в статье [Что такое Azure?](https://azure.microsoft.com/overview/what-is-azure/)

В этой статье предполагается, что вы располагаете достаточными знаниями по работе с Tomcat и Linux.  

## <a name="phase-1-create-an-image"></a>Этап 1. Создание образа
На этом этапе вы создадите виртуальную машину с помощью образа Linux в Azure.  

### <a name="step-1-generate-an-ssh-authentication-key"></a>Шаг 1. Создание ключа проверки подлинности SSH
SSH — это важный инструмент для системных администраторов. Однако для настройки безопасности доступа не рекомендуется использовать пароль, определенный пользователем. Злоумышленники могут взломать ненадежный пароль и проникнуть в вашу систему, использовав имя пользователя.

Хорошая новость заключается в том, что вы можете предоставлять удаленный доступ, не беспокоясь о надежности паролей. Этот метод состоит в проверке подлинности с асимметричным шифрованием. Пользователь проходит проверку подлинности с помощью своего закрытого ключа. Вы можете даже заблокировать учетную запись пользователя, чтобы запретить проверку пароля.

Кроме того, при использовании этого метода для входа на разные серверы не нужны разные пароли. Вы можете пройти проверку подлинности с помощью личного закрытого ключа для всех серверов, благодаря чему не нужно запоминать несколько паролей.



Выполните следующие действия, чтобы создать ключ проверки подлинности SSH.

1. Скачайте и установите PuTTYgen из следующего расположения: [http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html).
2. Запустите Puttygen.exe.
3. Нажмите кнопку **Создать** , чтобы создать ключи. В процессе вы можете увеличить степень случайности, двигая указатель мыши в пустой области окна.  
   ![Снимок экрана с окном генератора ключей PuTTY, где отображается кнопка Generate (Создать)][1]
4. После завершения процесса создания новый открытый ключ отобразится в средстве Puttygen.exe.  
   ![Снимок экрана с окном генератора ключей PuTTY, где отображается новый открытый ключ и кнопка Save private key (Сохранить закрытый ключ)][2]
5. Выберите и скопируйте открытый ключ и сохраните его в файле с именем publicKey.pem. Не щелкайте **Сохранить открытый ключ**, так как формат файла сохраненного открытого ключа отличается от необходимого открытого ключа.
6. Нажмите кнопку **Save private key** (Сохранить закрытый ключ) и сохраните его в файл с именем privateKey.ppk.

### <a name="step-2-create-the-image-in-the-azure-portal"></a>Шаг 2. Создание образа на портале Azure
1. На [портале](https://portal.azure.com/) на панели задач щелкните **Создать ресурс**, чтобы создать образ. Затем выберите требуемый образ Linux. В этом примере используется образ Ubuntu 14.04.
![Снимок экрана, где отображается расположение кнопки "Создать" на портале][3]

2. В поле **Имя узла** укажите имя URL-адреса, с помощью которого интернет-клиенты будут получать доступ к этой виртуальной машине. Определите последнюю часть DNS-имени, например tomcatdemo, после чего в службе Azure будет создан URL-адрес lampdemo.cloudapp.net.  

3. В поле **SSH Authentication Key** (Ключ аутентификации SSH) скопируйте значение ключа из файла publicKey.pem, который содержит открытый ключ, созданный с помощью средства PuTTYgen.  
![Поле SSH Authentication Key (Ключ проверки подлинности SSH) на портале][4]

4. При необходимости настройте другие параметры и нажмите кнопку **Создать**.  

## <a name="phase-2-prepare-your-virtual-machine-for-tomcat7"></a>Этап 2. Подготовка виртуальной машины для Tomcat7
На этом этапе вы настроите конечную точку для трафика Tomcat и подключитесь к новой виртуальной машине.

### <a name="step-1-open-the-http-port-to-allow-web-access"></a>Шаг 1. Открытие HTTP-порта для разрешения веб-доступа
Конечные точки в Azure состоят из протокола (TCP или UDP), а также общего и частного порта. Частный порт — это порт, который прослушивает служба на виртуальной машине. Общий порт — это порт, который облачная служба Azure прослушивает извне на наличие интернет-трафика.  

TCP-порт 8080 — номер порта по умолчанию, который использует Tomcat для прослушивания. Открытие этого порта с помощью конечной точки Azure обеспечивает вам и другим интернет-клиентам доступ к страницам Tomcat.  

1. На портале щелкните **Обзор** > **Виртуальная машина** и выберите созданную виртуальную машину.  
   ![Снимок экрана, где отображается каталог виртуальных машин][5]
2. Чтобы добавить к виртуальной машине конечную точку, щелкните поле **Конечные точки** .
   ![Снимок экрана, где отображается плитка "Конечные точки"][6]
3. Щелкните **Добавить**.  

   1. Введите имя конечной точки в поле **Конечная точка** и значение 80 в поле **Общий порт**.  

      Если задать значение 80, вам не нужно будет добавлять номер порта в URL-адрес, по которому вы получаете доступ к Tomcat. Например, http://tomcatdemo.cloudapp.net.    

      Если ему присвоено другое значение, например 81, необходимо добавить номер порта в URL-адрес для доступа к Tomcat. Например, http://tomcatdemo.cloudapp.net:81/.
   2. Введите 8080 в поле **Частный порт**. По умолчанию Tomcat прослушивает TCP-порт 8080. Если вы изменили значение по умолчанию для прослушивающего порта Tomcat, обновите **частный порт**, чтобы он совпадал с прослушивающим портом Tomcat.  
      ![Снимок экрана пользовательского интерфейса, где отображается команда "Добавить" и поля "Общий порт" и "Частный порт"][7]
4. Нажмите кнопку **ОК** , чтобы добавить конечную точку к своей виртуальной машине.

### <a name="step-2-connect-to-the-image-you-created"></a>Шаг 2. Подключение к созданному образу
Вы можете выбрать любой инструмент SSH для подключения к своей виртуальной машине. В этом примере мы используем средство PuTTY.  

1. Получите DNS-имя вашей виртуальной машины на портале.
    1. Щелкните **Обзор** > **Виртуальные машины**.
    2. Выберите имя виртуальной машины и щелкните **Свойства**.
    3. Чтобы получить DNS-имя, выберите плитку **Свойства** и найдите поле **Имя домена**.  

2. Получите номер порта для подключений по протоколу SSH в поле **SSH**.  
![Снимок экрана, где отображается номер порта SSH-подключения][8]

3. Скачайте [PuTTY](http://www.putty.org/).  

4. После скачивания запустите исполняемый файл Putty.exe. В конфигурации PuTTY настройте основные параметры, указав имя узла и номер порта, полученные в свойствах виртуальной машины.   
![Снимок экрана с конфигурацией PuTTY, где отображаются значения полей "Имя узла" и "Порт"][9]

5. Чтобы указать расположение файла privateKey.ppk, в левой области выберите **Подключения** > **SSH** > **Проверка подлинности** и нажмите кнопку **Обзор**. Файл privateKey.ppk содержит закрытый ключ, созданный ранее с помощью средства PuTTYgen в разделе "Этап 1. Создание образа" этой статьи.  
![Снимок экрана, где отображается иерархия каталогов подключения и кнопка "Обзор"][10]

6. Щелкните **Открыть**. Может отобразиться оповещение в окне сообщения. Если вы настроили DNS-имя и номер порта правильно, нажмите кнопку **Да**.
![Снимок экрана, на котором отображается уведомление][11]

7. Затем вам будет предложено ввести имя пользователя.  
![Снимок экрана, на котором показано, где нужно ввести имя пользователя][12]

8. Введите имя пользователя, которое использовалось ранее для создания виртуальной машины в разделе "Этап 1. Создание образа" этой статьи. Вы увидите что-то вроде этого:   
![Снимок экрана с подтверждением проверки подлинности][13]

## <a name="phase-3-install-software"></a>Этап 3. Установка программного обеспечения
На этом этапе необходимо установить среду выполнения Java, пакет Tomcat7 и другие компоненты Tomcat7.  

### <a name="java-runtime-environment"></a>Среда выполнения Java
Программное обеспечение Tomcat написано на языке Java. Есть два вида комплектов Java Development Kit (JDK) — OpenJDK и Oracle JDK. Вы можете выбрать наиболее подходящий из них.  

> [!NOTE]
> В обоих видах JDK для классов в Java API используются почти одинаковые коды, но код для виртуальной машины отличается. В OpenJDK, как правило, используются открытые библиотеки, а в Oracle JDK — закрытые библиотеки. В Oracle JDK доступно больше классов и в нем исправлены некоторые ошибки. К тому же Oracle JDK работает стабильнее, чем OpenJDK.

#### <a name="install-openjdk"></a>Установка OpenJDK  

Чтобы скачать OpenJDK, выполните следующую команду:   

    sudo apt-get update  
    sudo apt-get install openjdk-7-jre  


* Чтобы создать каталог, в котором будут содержаться файлы JDK:  

        sudo mkdir /usr/lib/jvm  
* Чтобы извлечь файлы JDK в каталог /usr/lib/jvm/:  

        sudo tar -zxf jdk-8u5-linux-x64.tar.gz  -C /usr/lib/jvm/

#### <a name="install-oracle-jdk"></a>Установка Oracle JDK


Чтобы скачать Oracle JDK на веб-сайте Oracle, выполните следующую команду:  

     wget --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jdk/8u5-b13/jdk-8u5-linux-x64.tar.gz  
* Чтобы создать каталог, в котором будут содержаться файлы JDK:  

        sudo mkdir /usr/lib/jvm  
* Чтобы извлечь файлы JDK в каталог /usr/lib/jvm/:  

        sudo tar -zxf jdk-8u5-linux-x64.tar.gz  -C /usr/lib/jvm/  
* Чтобы задать Oracle JDK в качестве виртуальной машины Java по умолчанию, выполните следующую команду:  

        sudo update-alternatives --install /usr/bin/java java /usr/lib/jvm/jdk1.8.0_05/bin/java 100  

        sudo update-alternatives --install /usr/bin/javac javac /usr/lib/jvm/jdk1.8.0_05/bin/javac 100  

#### <a name="confirm-that-java-installation-is-successful"></a>Убедитесь, что установка Java выполнена успешно.
Вы можете использовать подобную команду, чтобы проверить, правильно ли установлена среда выполнения Java:  

    java -version  

Если вы установили OpenJDK, вы увидите примерно следующее сообщение: ![Сообщение об успешной установке OpenJDK][14]

Если вы установили Oracle JDK, вы увидите примерно следующее сообщение: ![Сообщение об успешной установке Oracle JDK][15]

### <a name="install-tomcat7"></a>Установка Tomcat7
Чтобы установить Tomcat7, выполните следующую команду:  

    sudo apt-get install tomcat7  

Если вы не используете Tomcat7, воспользуйтесь соответствующим вариантом этой команды.  

#### <a name="confirm-that-tomcat7-installation-is-successful"></a>Убедитесь, что Tomcat7 успешно установлен.
Чтобы убедиться в успешной установке Tomcat7, выберите имя DNS-сервера, на котором установлен Tomcat. В качестве примера в этой статье используется URL-адрес http://tomcatexample.cloudapp.net/. Если вы видите подобное сообщение, Tomcat7 установлен правильно.
![Сообщение об успешной установке Tomcat7][16]

### <a name="install-other-tomcat7-components"></a>Установка других компонентов Tomcat7
Существуют другие дополнительные компоненты Tomcat, которые вы можете установить.  

Получить список всех доступных компонентов можно с помощью команды **sudo apt-cache search tomcat7**. Чтобы установить некоторые полезные компоненты, используйте следующие команды:  

    sudo apt-get install tomcat7-admin      #admin web applications

    sudo apt-get install tomcat7-user         #tools to create user instances  

## <a name="phase-4-configure-tomcat7"></a>Этап 4. Настройка Tomcat7
На этом этапе вы узнаете о том, как управлять Tomcat.

### <a name="start-and-stop-tomcat7"></a>Запуск и остановка Tomcat7
При установке пакета Tomcat7 сервер Tomcat7 запускается автоматически. Вы также можете запустить его, выполнив следующую команду:   

    sudo /etc/init.d/tomcat7 start

Чтобы остановить Tomcat7, выполните следующую команду:

    sudo /etc/init.d/tomcat7 stop

Чтобы просмотреть состояние Tomcat7, выполните следующую команду:

    sudo /etc/init.d/tomcat7 status

Чтобы перезапустить службы Tomcat, выполните следующую команду: 

    sudo /etc/init.d/tomcat7 restart

### <a name="tomcat7-administration"></a>Администрирование Tomcat7
Вы можете изменить файл конфигурации пользователя Tomcat, чтобы настроить учетные данные администратора. Используйте следующую команду:  

    sudo vi  /etc/tomcat7/tomcat-users.xml   

Вот пример:   
![Снимок экрана, где отображаются выходные данные команды sudo vi][17]  

> [!NOTE]
> Создайте надежный пароль для имени пользователя администратора.  

Изменив этот файл, перезапустите службы Tomcat7 с помощью следующей команды, чтобы изменения вступили в силу:  

    sudo /etc/init.d/tomcat7 restart  

Откройте браузер и введите URL-адрес **http://<your tomcat server DNS name>/manager/html**. В качестве примера в этой статье используется URL-адрес http://tomcatexample.cloudapp.net/manager/html.  

После подключения должен появиться результат, аналогичный следующему:   
![Снимок экрана, где отображается диспетчер веб-приложений Tomcat][18]

## <a name="common-issues"></a>Распространенные проблемы
### <a name="cant-access-the-virtual-machine-with-tomcat-and-moodle-from-the-internet"></a>Не удается получить доступ к виртуальной машине с Tomcat и Moodle из Интернета
#### <a name="symptom"></a>Симптом  
  Tomcat работает, но в браузере не отображается страница Tomcat по умолчанию.
#### <a name="possible-root-cause"></a>Возможная основная причина   

  * Прослушивающий порт Tomcat отличается от частного порта конечной точки виртуальной машины, предназначенного для трафика Tomcat.  

     Проверьте параметры конечных точек общего и частного портов и убедитесь, что частный порт совпадает с прослушивающим портом Tomcat. Дополнительные инструкции по настройке конечных точек см. в разделе "Этап 1. Создание образа" этой статьи.  

     Чтобы выяснить, какой порт прослушивает Tomcat, откройте файл /etc/httpd/conf/httpd.conf (выпуск Red Hat) или /etc/tomcat7/server.xml (выпуск Debian). По умолчанию Tomcat прослушивает порт 8080. Вот пример:   

        <Connector port="8080" protocol="HTTP/1.1"  connectionTimeout="20000"   URIEncoding="UTF-8"            redirectPort="8443" />  

     Если вы используете виртуальную машину Debian или Ubuntu и вам необходимо изменить порт, который прослушивает Tomcat по умолчанию (например, 8081), вам следует открыть также порт для операционной системы. Сначала откройте профиль, выполнив следующую команду:  

        sudo vi /etc/default/tomcat7  

     Раскомментируйте последнюю строку и измените «no» на «yes».  

        AUTHBIND=yes
  2. Брандмауэр отключил прослушивающий порт Tomcat.

     Страница по умолчанию Tomcat отображается только на локальном узле. Скорее всего, проблема состоит в том, что порт, который прослушивает Tomcat, блокируется брандмауэром. Для просмотра веб-страницы можно использовать средство w3m. Следующие команды позволяют установить программу w3m и перейти на страницу Tomcat по умолчанию.  


        sudo yum  install w3m w3m-img


        w3m http://localhost:8080  
#### <a name="solution"></a>Решение

  * Если прослушивающий порт Tomcat отличается от частного порта конечной точки виртуальной машины, предназначенного для трафика, необходимо изменить частный порт, чтобы он совпал с прослушивающим портом Tomcat.   
  2. Если проблема вызвана брандмауэром или программой iptables, добавьте следующие строки в /etc/sysconfig/iptables. Вторая строка требуется только для трафика https:  

      -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT

      A INPUT -p tcp -m tcp --dport 443 -j ACCEPT  

     > [!IMPORTANT]
     > Убедитесь, что предыдущие строки расположены над всеми строками, которые глобально ограничивают доступ, например: A INPUT -j REJECT --reject-with icmp-host-prohibited



Чтобы перезагрузить iptables, выполните такую команду:

    service iptables restart

Протестировано в CentOS 6.3.

### <a name="permission-denied-when-you-upload-project-files-to-varlibtomcat7webapps"></a>Во время передачи файлов проекта в папку /var/lib/tomcat7/webapps/ вам отказано в доступе.
#### <a name="symptom"></a>Симптом
  Если вы используете любой SFTP-клиент (такой как FileZilla) для подключения к своей виртуальной машине и переходите в папку /var/lib/tomcat7/webapps/ для публикации своего сайта, отображается сообщение об ошибке следующего вида:  

     status:    Listing directory /var/lib/tomcat7/webapps
     Command:    put "C:\Users\liang\Desktop\info.jsp" "info.jsp"
     Error:    /var/lib/tomcat7/webapps/info.jsp: open for write: permission denied
     Error:    File transfer failed
#### <a name="possible-root-cause"></a>Возможная основная причина
  У вас нет разрешения на доступ к папке /var/lib/tomcat7/.  
#### <a name="solution"></a>Решение  
  Необходимо получить разрешение из учетной записи root. Можно изменить владельца этой папки из корневой папки на имя пользователя, которое использовалось при подготовке машины. Ниже приведен пример с именем учетной записи azureuser:  

     sudo chown azureuser -R /var/lib/tomcat7/webapps

  Кроме того, используйте параметр -R, чтобы применить разрешения для всех файлов в каталоге.  

  Эта команда также работает для каталогов. Параметр -R изменяет разрешения для всех файлов и каталогов в каталоге. Вот пример:   

     sudo chown -R username:group directory  

  Эта команда изменяет владельца (как пользователя, так и группу) для всех файлов и каталогов, находящихся внутри каталога.  

  Следующая команда изменяет только разрешения для каталога папки. Файлы и папки внутри каталога не изменяются.  

     sudo chown username:group directory

[1]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-01.png
[2]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-02.png
[3]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-03.png
[4]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-04.png
[5]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-05.png
[6]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-06.png
[7]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-07.png
[8]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-08.png
[9]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-09.png
[10]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-10.png
[11]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-11.png
[12]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-12.png
[13]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-13.png
[14]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-14.png
[15]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-15.png
[16]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-16.png
[17]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-17.png
[18]:media/setup-tomcat/virtual-machines-linux-setup-tomcat7-linux-18.png
