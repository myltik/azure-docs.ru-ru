---
title: Подключение к виртуальной машине под управлением Linux в Azure с помощью удаленного рабочего стола | Документация Майкрософт
description: Узнайте, как установить и настроить удаленный рабочий стол (xrdp) для подключения к виртуальной машине Linux в Azure с помощью графических средств.
services: virtual-machines-linux
documentationcenter: ''
author: iainfoulds
manager: jeconnoc
editor: ''
ms.assetid: ''
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 12/15/2017
ms.author: iainfou
ms.openlocfilehash: c47822bebdc8b3cc8896fe56b8f9a4ce317495c3
ms.sourcegitcommit: b6319f1a87d9316122f96769aab0d92b46a6879a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2018
ms.locfileid: "34364307"
---
# <a name="install-and-configure-remote-desktop-to-connect-to-a-linux-vm-in-azure"></a>Установка и настройка удаленного рабочего стола для подключения к виртуальной машине Linux в Azure
Управление виртуальными машинами Linux в Azure обычно осуществляется из командной строки с помощью подключения Secure Shell (SSH). Если вы только начинаете работу с Linux или хотите быстро устранить неполадки, проще всего использовать удаленный рабочий стол. В этой статье описывается установка и настройка среды рабочего стола ([xfce](https://www.xfce.org)) и удаленного рабочего стола ([xrdp](http://www.xrdp.org)) для виртуальной машины Linux с помощью модели развертывания Resource Manager.


## <a name="prerequisites"></a>предварительным требованиям
Для работы с этой статьей требуется существующая виртуальная машина Ubuntu 16.04 LTS в Azure. Если требуется создать виртуальную машину, используйте один из следующих методов:

- [Azure CLI 2.0](quick-create-cli.md);
- [портал Azure](quick-create-portal.md).


## <a name="install-a-desktop-environment-on-your-linux-vm"></a>Установка среды рабочего стола на виртуальной машине Linux
На большинстве виртуальных машин Linux в Azure по умолчанию не установлена среда рабочего стола. Управление виртуальными машинами Linux обычно осуществляется через SSH-подключения, а не с помощью рабочего стола. В Linux можно использовать различные среды рабочего стола. Выбранная среда рабочего стола может занимать 1–2 ГБ места на диске, а для установки и настройки всех необходимых пакетов может потребоваться 5–10 минут.

С помощью приведенного ниже примера кода можно установить упрощенную среду рабочего стола [xfce4](https://www.xfce.org/) на виртуальной машине Ubuntu 16.04 LTS. Команды для других дистрибутивов незначительно отличаются. Например, для установки на виртуальной машине Red Hat Enterprise Linux используйте `yum` и настройте соответствующие правила `selinux`, а для установки на виртуальной машине SUSE используйте `zypper`.

Сначала установите SSH-подключение к виртуальной машине. Следующий пример подключается к виртуальной машине *myvm.westus.cloudapp.azure.com* с помощью имени пользователи *azureuser*.

```bash
ssh azureuser@myvm.westus.cloudapp.azure.com
```

Если вы используете Windows и нуждаетесь в дополнительных сведениях об использовании SSH, см. статью [Использование SSH с Windows в Azure](ssh-from-windows.md).

Затем установите xfce с помощью `apt` следующим образом:

```bash
sudo apt-get update
sudo apt-get install xfce4
```

## <a name="install-and-configure-a-remote-desktop-server"></a>Установка и настройка сервера удаленных рабочих столов
После установки среды рабочего стола настройте службу удаленного рабочего стола для прослушивания входящих подключений. [xrdp](http://xrdp.org) — это сервер RDP с открытым исходным кодом, доступный в большинстве дистрибутивов Linux и совместимый с xfce. Установите xrdp на виртуальной машине Ubuntu следующим образом:

```bash
sudo apt-get install xrdp
```

Укажите, какую среду рабочего стола должен использовать сервер xrdp при запуске сеанса. Настройте xrdp для использования xfce в качестве среды рабочего стола с помощью следующего кода:

```bash
echo xfce4-session >~/.xsession
```

Перезапустите службу xrdp, чтобы изменения вступили в силу:

```bash
sudo service xrdp restart
```


## <a name="set-a-local-user-account-password"></a>Настройка пароля локальной учетной записи пользователя
Если вы создали пароль для учетной записи пользователя при создании виртуальной машины, пропустите этот шаг. Если вы используете только проверку подлинности с помощью ключа SSH и пароль локальной учетной записи не задан, укажите пароль, прежде чем использовать xrdp для входа на виртуальную машину. xrdp не принимает ключи SSH для проверки подлинности. В следующем примере задается пароль для учетной записи пользователя *azureuser*.

```bash
sudo passwd azureuser
```

> [!NOTE]
> После указания пароля конфигурация SSHD не обновится таким образом, чтобы разрешить вход с помощью пароля, если такая возможность в настоящее время не настроена. С точки зрения безопасности лучше подключиться к виртуальной машине через туннель SSH с помощью проверки подлинности на основе ключа, а затем подключиться к xrdp. В таком случае можно пропустить следующий шаг по созданию правила группы безопасности сети, разрешающего трафик с удаленного рабочего стола.


## <a name="create-a-network-security-group-rule-for-remote-desktop-traffic"></a>Создание правила группы безопасности сети, разрешающего трафик с удаленного рабочего стола
Чтобы трафик с удаленного рабочего стола мог поступать на виртуальную машину Linux, необходимо создать правило группы безопасности сети, разрешающее использовать протокол TCP на порту 3389 для доступа к виртуальной машине. Дополнительные сведения о правилах групп безопасности сети см. в статье [Безопасность сети](../../virtual-network/security-overview.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). Вы также можете [создать правило группы безопасности сети с помощью портала Azure](../windows/nsg-quickstart-portal.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

В следующем примере создается правило группы безопасности сети с именем [az vm open-port](/cli/azure/vm#az_vm_open_port) на порту *3389*.

```azurecli
az vm open-port --resource-group myResourceGroup --name myVM --port 3389
```


## <a name="connect-your-linux-vm-with-a-remote-desktop-client"></a>Подключение к виртуальной машине Linux с помощью клиента удаленного рабочего стола
Откройте локальный клиент удаленного рабочего стола и подключитесь с помощью IP-адреса или DNS-имени виртуальной машины Linux. Введите имя пользователя и пароль для учетной записи пользователя на виртуальной машине:

![Подключение к xrdp с помощью клиента удаленного рабочего стола](./media/use-remote-desktop/remote-desktop-client.png)

После проверки подлинности загрузится среда рабочего стола xfce. Она будет выглядеть примерно так:

![Среда рабочего стола xfce при подключении через xrdp](./media/use-remote-desktop/xfce-desktop-environment.png)


## <a name="troubleshoot"></a>Устранение неполадок
Если не удается подключиться к виртуальной машине Linux с помощью клиента удаленного рабочего стола, используйте `netstat` на виртуальной машине Linux, чтобы убедиться, что она прослушивает RDP-подключения:

```bash
sudo netstat -plnt | grep rdp
```

В следующем примере показана виртуальная машина, прослушивающая TCP-порт 3389, как и ожидалось:

```bash
tcp     0     0      127.0.0.1:3350     0.0.0.0:*     LISTEN     53192/xrdp-sesman
tcp     0     0      0.0.0.0:3389       0.0.0.0:*     LISTEN     53188/xrdp
```

Если служба *xrdp-sesman* не выполняет прослушивание, перезапустите службу на виртуальной машине Ubuntu следующим образом:

```bash
sudo service xrdp restart
```

Просмотрите журналы в папке */var/log* на виртуальной машине Ubuntu, чтобы узнать, почему служба не отвечает. Вы также можете проверять системный журнал на предмет ошибок во время попыток подключения к удаленному рабочему столу:

```bash
tail -f /var/log/syslog
```

В других дистрибутивах Linux, например Red Hat Enterprise Linux и SUSE, способы перезапуска служб и расположение файла журнала могут отличаться.

Если ответ не поступает в клиент удаленного рабочего стола, а события не отображаются в системном журнале, это означает, что трафик с удаленного рабочего стола не достигает виртуальной машины. Проверьте правила групп безопасности сети и убедитесь, что в их числе есть правило, разрешающее трафик по протоколу TCP через порт 3389. Дополнительные сведения см. в статье [Устранение проблем с подключением к приложениям на виртуальных машинах Linux в Azure](../windows/troubleshoot-app-connection.md).


## <a name="next-steps"></a>Дополнительная информация
Дополнительные сведения о создании и использовании ключей SSH на виртуальных машинах Linux см. в статье [Создание пары из открытого и закрытого ключей SSH для виртуальных машин Linux](mac-create-ssh-keys.md).

Сведения об использовании SSH в Windows см. в статье [Использование SSH с Windows в Azure](ssh-from-windows.md).

