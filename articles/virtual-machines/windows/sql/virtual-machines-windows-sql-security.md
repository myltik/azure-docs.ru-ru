---
title: Вопросы безопасности SQL Server в Azure | Документация Майкрософт
description: В этом разделе приведены общие указания по обеспечению безопасности сервера SQL Server, работающего на виртуальной машине Azure.
services: virtual-machines-windows
documentationcenter: na
author: rothja
manager: craigg
editor: ''
tags: azure-service-management
ms.assetid: d710c296-e490-43e7-8ca9-8932586b71da
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 03/23/2018
ms.author: jroth
ms.openlocfilehash: b91638b6b76675711150323bee4aa9ad9d9a73d1
ms.sourcegitcommit: d74657d1926467210454f58970c45b2fd3ca088d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="security-considerations-for-sql-server-in-azure-virtual-machines"></a>Вопросы безопасности SQL Server на виртуальных машинах Azure

Этот раздел содержит общие рекомендации по безопасности, которые помогут обеспечить безопасный доступ к экземплярам SQL Server на виртуальной машине Azure.

Azure соответствует ряду отраслевых норм и стандартов, которые позволяют создать совместимое с SQL Server решение, работающее на виртуальной машине. Сведения о соответствии нормам Azure см. в [центре управления безопасностью Azure](https://azure.microsoft.com/support/trust-center/).

[!INCLUDE [learn-about-deployment-models](../../../../includes/learn-about-deployment-models-both-include.md)]

## <a name="control-access-to-the-sql-vm"></a>Управление доступом к виртуальной машине SQL

При создании виртуальной машины SQL Server следует предусмотреть тщательный контроль доступа к ней и серверу SQL Server. В общем случае следует:

- предоставить доступ к серверу SQL Server только приложениям и клиентам, которым он необходим;
- придерживаться рекомендаций по управлению учетными записями пользователей и паролями.

В следующих разделах приводятся соответствующие рекомендации, которые вы сможете обдумать.

## <a name="secure-connections"></a>Защита подключений

При создании виртуальной машины SQL Server с помощью образа из коллекции доступен параметр **Подключение SQL Server**, позволяющий выбрать одно из трех значений: **Локальное (только в виртуальной машине)**, **Частное (в виртуальной сети)** или **Общий доступ в Интернет**.

![Подключение к серверу SQL Server](./media/virtual-machines-windows-sql-security/sql-vm-connectivity-option.png)

Чтобы обеспечить максимальную безопасность, выберите наиболее строгий вариант, подходящий для вашего сценария. Например, если приложение, которое обращается к серверу SQL Server, работает на той же виртуальной машине, то наиболее безопасным является **локальное подключение**. Если вы используете приложение Azure, которому требуется доступ к серверу SQL Server, то **частное подключение** позволит защитить обмен данными с сервером SQL Server, осуществляя его только в пределах указанной [виртуальной сети Azure](../../../virtual-network/virtual-networks-overview.md). Если требуется **общий** доступ к виртуальной машине SQL Server (из Интернета), то обязательно придерживайтесь рекомендаций в этом разделе, чтобы уменьшить контактную зону для атак.

Выбранные параметры на портале используют правила безопасности для входящего трафика [группы безопасности сети](../../../virtual-network/virtual-networks-nsg.md) (NSG) виртуальной машины, чтобы разрешить или запретить сетевой трафик к виртуальной машине. Можно изменить существующие или создать новые правила входящего трафика NSG, чтобы разрешить трафик на порт SQL Server (по умолчанию — 1433). Можно также указать конкретные IP-адреса, которым разрешен обмен данными через этот порт.

![Правила группы безопасности сети](./media/virtual-machines-windows-sql-security/sql-vm-network-security-group-rules.png)

Помимо правил NSG, ограничивающих сетевой трафик, можно также использовать брандмауэр Windows на виртуальной машине.

Если применяются конечные точки в классической модели развертывания, удалите все неиспользуемые конечные точки в виртуальной машине. Инструкции по использованию списков ACL в конечных точках см. в разделе [Управление ACL для конечной точки](../classic/setup-endpoints.md#manage-the-acl-on-an-endpoint). Это не требуется для виртуальных машин, которые используют Resource Manager.

Наконец, рассмотрите возможность включения шифрования подключений к экземпляру ядра СУБД SQL Server на виртуальной машине Azure. Настройте новый экземпляр SQL Server с подписанным сертификатом. Дополнительные сведения см. в статьях [Включение шифрования соединений в ядре СУБД](https://docs.microsoft.com/sql/database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine) и [Синтаксис строки подключения](https://msdn.microsoft.com/library/ms254500.aspx).

## <a name="use-a-non-default-port"></a>Использование нестандартного порта

По умолчанию сервер SQL Server ожидает передачи данных через стандартный порт 1433. Чтобы повысить безопасность, настройте сервер SQL Server для ожидания передачи данных через нестандартный порт, например 1401. Если вы подготавливаете образ SQL Server из коллекции на портале Azure, то можете указать этот порт в колонке **Параметры SQL Server**.

Существуют два способа настроить его после подготовки.

- Для виртуальных машин Resource Manager можно выбрать **Конфигурация SQL Server** в колонке "Обзор" виртуальной машины. Это даст возможность изменить номер порта.

  ![Изменение TCP-порта на портале](./media/virtual-machines-windows-sql-security/sql-vm-change-tcp-port.png)

- Для классических виртуальных машин или виртуальных машин SQL Server, которые не были подготовлены с помощью портала, можно вручную настроить порт, подключившись к ним удаленно. Инструкции по настройке приведены в разделе [Configure a Server to Listen on a Specific TCP Port](https://docs.microsoft.com/sql/database-engine/configure-windows/configure-a-server-to-listen-on-a-specific-tcp-port) (Настройка сервера для ожидания передачи данных через определенный TCP-порт). Если вы используете этот ручной способ, необходимо также добавить правило брандмауэра Windows, чтобы разрешить входящий трафик для этого TCP-порта.

> [!IMPORTANT]
> Указание нестандартного порта имеет смысл, если порт SQL Server открыт для общих подключений из Интернета.

Если сервер SQL Server ожидает передачи данных через нестандартный порт, его необходимо указывать при подключении. Например, рассмотрим ситуацию, когда IP-адрес сервера SQL Server — 13.55.255.255 и он ожидает передачи данных через порт 1401. Чтобы подключиться к серверу SQL Server, в строке подключения следует указать `13.55.255.255,1401`.

## <a name="manage-accounts"></a>Управление учетными записями

Вы бы не хотели, чтобы злоумышленники смогли легко угадать имена учетных записей или паролей. Воспользуйтесь следующими советами.

- Создайте уникальную локальную учетную запись администратора с именем, отличным от **Administrator**.

- Используйте сложные надежные пароли для всех учетных записей. Дополнительные сведения о том, как создать надежный пароль, см. в статье [Создание надежного пароля](https://support.microsoft.com/instantanswers/9bd5223b-efbe-aa95-b15a-2fb37bef637d/create-a-strong-password).

- По умолчанию во время настройки виртуальной машины SQL Server в Azure выбирается проверка подлинности Windows. Следовательно, имя для входа **SA** отключается, а пароль назначается в ходе настройки. Мы рекомендуем не использовать и не включать имя для входа **SA**. Если вам необходимо имя для входа SQL, используйте одну из следующих стратегий.

  - Создайте учетную запись SQL с уникальным именем, являющуюся участником роли **sysadmin**. Этого можно сделать на портале, включив **аутентификацию SQL** во время подготовки.

    > [!TIP] 
    > Если не включить аутентификацию SQL во время подготовки, необходимо будет вручную изменить режим аутентификации на **Проверка подлинности SQL Server и Windows**. Дополнительные сведения см. в статье [Изменение режима проверки подлинности сервера](https://docs.microsoft.com/sql/database-engine/configure-windows/change-server-authentication-mode).

  - Если необходимо использовать имя для входа **SA**, включите его после подготовки и задайте для него новый надежный пароль.

## <a name="follow-on-premises-best-practices"></a>Рекомендации по локальной среде

Помимо рекомендаций, описанных в этом разделе, мы советуем изучить рекомендации по обеспечению безопасности в локальной среде и применить их, где это уместно. Дополнительные сведения см. в статье [Вопросы безопасности при установке SQL Server](https://docs.microsoft.com/sql/sql-server/install/security-considerations-for-a-sql-server-installation).

## <a name="next-steps"></a>Дальнейшие действия

Если вам также интересны рекомендации по повышению производительности, ознакомьтесь со статьей [Рекомендации по оптимизации производительности SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-performance.md).

Другие темы, связанные с запуском SQL Server на виртуальных машинах Azure, рассматриваются в статье [Приступая к работе с SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-server-iaas-overview.md). Если у вас есть вопросы по виртуальным машинам SQL Server, см. раздел [часто задаваемых вопросов](virtual-machines-windows-sql-server-iaas-faq.md).

