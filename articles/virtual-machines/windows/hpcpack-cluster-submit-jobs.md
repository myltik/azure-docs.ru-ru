---
title: Отправка заданий в кластер пакета HPC в Azure | Документация Майкрософт
description: Узнайте, как настроить локальный компьютер для отправки заданий в кластер на основе пакета HPC в Azure.
services: virtual-machines-windows
documentationcenter: ''
author: dlepow
manager: jeconnoc
editor: ''
tags: azure-resource-manager,azure-service-management,hpc-pack
ms.assetid: 78f6833c-4aa6-4b3e-be71-97201abb4721
ms.service: virtual-machines-windows
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-multiple
ms.workload: big-compute
ms.date: 10/14/2016
ms.author: danlep
ms.openlocfilehash: 263946c1a1bd792b2f23a55388b73a82ddad0000
ms.sourcegitcommit: 5b2ac9e6d8539c11ab0891b686b8afa12441a8f3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
# <a name="submit-hpc-jobs-from-an-on-premises-computer-to-an-hpc-pack-cluster-deployed-in-azure"></a>Отправка заданий HPC c локального компьютера в кластер на основе пакета HPC, развернутый в Azure
[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

Настройте локальный клиентский компьютер для отправки заданий в кластер [пакета Microsoft HPC](https://technet.microsoft.com/library/cc514029) в Azure. В этой статье показано, как настроить локальный компьютер с клиентскими инструментами для отправки заданий по протоколу HTTPS в кластер, размещенный в Azure. Таким образом несколько пользователей кластера могут отправлять задания в облачный кластер пакета HPC, не подключаясь непосредственно к виртуальной машине головного узла и не обращаясь к подписке Azure.

![Отправка задания в кластер в Azure][jobsubmit]

## <a name="prerequisites"></a>предварительным требованиям
* **Головной узел пакета HPC развернут на виртуальной машине Azure**. Рекомендуется развернуть головной узел и кластер с помощью автоматизированных инструментов, таких как [шаблон быстрого запуска Azure](https://azure.microsoft.com/documentation/templates/) или [сценарий Azure PowerShell](classic/hpcpack-cluster-powershell-script.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json). Для выполнения инструкций в этой статье требуется DNS-имя головного узла, а также учетные данные администратора кластера.
* **Клиентский компьютер**. Требуется клиентский компьютер под управлением Windows или Windows Server, который поддерживает запуск клиентских служебных программ для пакета HPC (ознакомьтесь с [требованиями к системе](https://technet.microsoft.com/library/dn535781.aspx)). Если вы не планируете выполнять задачи помимо отправки задач через веб-портал или REST API для пакета HPC, то можете использовать любой клиентский компьютер.
* **Установочный носитель пакета HPC**. Чтобы установить клиентские служебные программы пакета HPC, скачайте бесплатный установочный пакет для последней версии пакета HPC (HPC 2012 R2) из [Центра загрузки Майкрософт](http://go.microsoft.com/fwlink/?LinkId=328024). Скачайте ту же версию пакета HPC, что установлена на виртуальной машине головного узла.

## <a name="step-1-install-and-configure-the-web-components-on-the-head-node"></a>Шаг 1. Установка и настройка веб-компонентов на головном узле
Чтобы отправлять задания в кластер через интерфейс REST по протоколу HTTPS, убедитесь, что на головном узле пакета HPC настроены веб-компоненты пакета HPC. Если они не установлены, то сначала установите веб-компоненты, запустив файл установки HpcWebComponents.msi. Затем настройте компоненты, запустив скрипт HPC PowerShell **Set-HPCWebComponents.ps1**.

Подробные инструкции см. в разделе [Установка веб-компонентов пакета Microsoft HPC](http://technet.microsoft.com/library/hh314627.aspx).

> [!TIP]
> Некоторые шаблоны быстрого запуска Azure для пакета HPC устанавливают и настраивают веб-компоненты автоматически. При создании кластера с помощью [сценария развертывания пакета HPC по модели IaaS](classic/hpcpack-cluster-powershell-script.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json) можно установить и настроить веб-компоненты в рамках развертывания.
> 
> 

**Установка веб-компонентов**

1. Подключитесь к виртуальной машине головного узла, используя учетные данные администратора кластера.
2. Запустите файл HpcWebComponents.msi из папки установки пакета HPC на головном узле.
3. Установите веб-компоненты, следуя инструкциям мастера.

**Настройка веб-компонентов**

1. Запустите HPC PowerShell от имени администратора на головном узле.
2. Чтобы изменить каталог на папку со скриптом настройки, выполните следующую команду:
   
    ```powershell
    cd $env:CCP_HOME\bin
    ```
3. Чтобы настроить интерфейс REST и запустить веб-службу HPC, выполните следующую команду:
   
    ```powershell
    .\Set-HPCWebComponents.ps1 –Service REST –enable
    ```
4. При появлении соответствующего запроса выберите сертификат, который соответствует открытому DNS-имени головного узла. Например, при развертывании виртуальной машины головного узла с помощью классической модели имя сертификата имеет вид CN=&lt;*DNS-имя_головного_узла*&gt;.cloudapp.net. При использовании модели развертывания с помощью Resource Manager имя сертификата имеет вид CN=&lt;*DNS-имя_головного_узла*&gt;.&lt;*регион*&gt;.cloudapp.azure.com.
   
   > [!NOTE]
   > Позже этот сертификат будет выбран вами для отправки заданий на головной узел с локального компьютера. Не выбирайте и не настраивайте сертификат, который соответствует имени компьютера головного узла в домене Active Directory (например, CN=*MyHPCHeadNode.HpcAzure.local*).
   > 
   > 
5. Чтобы настроить веб-портал для отправки заданий, введите следующую команду:
   
    ```powershell
    .\Set-HPCWebComponents.ps1 –Service Portal -enable
    ```
6. После завершения выполнения сценария остановите и перезапустите службу планировщика заданий HPC, используя следующие команды.
   
    ```powershell
    net stop hpcscheduler
    net start hpcscheduler
    ```

## <a name="step-2-install-the-hpc-pack-client-utilities-on-an-on-premises-computer"></a>Шаг 2. Установка клиентских служебных программ для пакета HPC на локальном компьютере
Если требуется установить клиентские служебные программы пакета HPC на свой компьютер, скачайте файлы установки пакета HPC (полная установка) из [Центра загрузки Майкрософт](http://go.microsoft.com/fwlink/?LinkId=328024). При запуске инсталляции выберите вариант установки **HPC Pack client utilities** (Клиентские служебные программы для пакета HPC).

Чтобы использовать клиентские инструменты пакета HPC для отправки заданий на виртуальную машину головного узла, нужно также экспортировать сертификат с головного узла и установить его на клиентском компьютере. Сертификат должен быть в формате CER.

**Экспорт сертификата с головного узла**

1. На головном узле добавьте оснастку «Сертификаты» на консоль управления для учетной записи локального компьютера. Инструкции по добавлению оснастки см. в статье [Добавление оснастки "Сертификаты" в консоль MMC](https://technet.microsoft.com/library/cc754431.aspx).
2. В дереве консоли разверните **Сертификаты — локальный компьютер** > **Личные** и щелкните **Сертификаты**.
3. Найдите сертификат, настроенный для веб-компонентов пакета HPC при работе с разделом [Шаг 1. Установка и настройка веб-компонентов на головном узле](#step-1:-install-and-configure-the-web-components-on-the-head-node) (например, CN=&lt;*DNS-имя_головного_узла*&gt;.cloudapp.net).
4. Щелкните сертификат правой кнопкой мыши и выберите **Все задачи** > **Экспорт**.
5. В мастере экспорта сертификатов нажмите кнопку **Далее** и убедитесь, что выбран параметр **Нет, не экспортировать закрытый ключ**.
6. Выполните оставшиеся шаги мастера, чтобы экспортировать сертификат X.509 в кодировке DER (файл с расширением CER).

**Импорт сертификата на клиентский компьютер**

1. Скопируйте экспортированный с головного узла сертификат в папку на клиентском компьютере.
2. На клиентском компьютере запустите файл certmgr.msc.
3. В диспетчере сертификатов разверните **Сертификаты — текущий пользователь** > **Доверенные корневые центры сертификации**, щелкните правой кнопкой мыши **Сертификаты** и щелкните **Все задачи** > **Импорт**.
4. В мастере импорта сертификатов нажмите кнопку **Далее** и следуйте указаниям для импорта сертификата, экспортированного с головного узла в хранилище доверенных корневых центров сертификации.

> [!TIP]
> Вы можете увидеть предупреждение о безопасности, так как центр сертификации на головном узле не распознается клиентским компьютером. Для целей тестирования можно проигнорировать это предупреждение и завершить импорт сертификата.
> 
> 

## <a name="step-3-run-test-jobs-on-the-cluster"></a>Шаг 3. Запуск тестовых заданий в кластере
Чтобы проверить конфигурацию, попробуйте запустить задания для кластера в Azure с локального компьютера. Вы можете использовать для отправки заданий в кластер инструменты пользовательского интерфейса или команды командной строки для пакета HPC. Также для отправки заданий можно использовать веб-портал.

**Выполнение команд отправки заданий на клиентском компьютере**

1. На клиентском компьютере, на котором установлены клиентские служебные программы пакета HPC, откройте окно командной строки.
2. Введите тестовую команду. Например, чтобы получить список всех заданий в кластере, введите команду, подобную одной из следующих, в зависимости от полного DNS-имени головного узла:
   
    ```command
    job list /scheduler:https://<HeadNodeDnsName>.cloudapp.net /all
    ```
   
    или
   
    ```command
    job list /scheduler:https://<HeadNodeDnsName>.<region>.cloudapp.azure.com /all
    ```
   
   > [!TIP]
   > В качестве URL-адреса планировщика используйте полное DNS-имя головного узла, а не его IP-адрес. Если указать IP-адрес, появится сообщение об ошибке "Сертификат сервера должен либо иметь допустимую цепочку доверия, либо находиться в доверенном корневом хранилище".
   > 
   > 
3. При появлении соответствующего запроса укажите имя пользователя (в формате &lt;доменное_имя&gt;\\&lt;имя_пользователя&gt;) и пароль администратора кластера HPC или другого настроенного пользователя кластера. Вы можете сохранить учетные данные локально для выполнения других операций с заданиями.
   
    Появится список заданий.

**Использование диспетчера заданий HPC на клиентском компьютере**

1. Если вы не сохранили доменные учетные данные пользователя кластера при отправке задания, то можете добавить их в диспетчере учетных данных.
   
    a. В панели управления на клиентском компьютере запустите диспетчер учетных данных.
   
    Б. Щелкните **Учетные данные Windows** > **Добавить общие учетные данные**.
   
    c. Укажите адрес в Интернете (например, https://&lt;DNS-имя_головного_узла&gt;.cloudapp.net/HpcScheduler или https://&lt;DNS-имя_головного_узла&gt;.&lt;регион&gt;.cloudapp.azure.com/HpcScheduler), имя пользователя (&lt;доменное_имя&gt;\\&lt;имя_пользователя&gt;) и пароль администратора кластера или другого настроенного пользователя кластера.
2. Запустите диспетчер заданий HPC на клиентском компьютере.
3. В диалоговом окне **Select Head Node** (Выбор головного узла) введите URL-адрес головного узла в Azure (например, https://&lt;DNS-имя_головного_узла&gt;. cloudapp.net или https://&lt;DNS-имя_головного_узла&gt;.&lt;регион&gt;.cloudapp.azure.com).
   
    Откроется диспетчер заданий HPC, в котором будут перечислены задания на головном узле.

**Использование веб-портала на головном узле**

1. Запустите веб-браузер на клиентском компьютере и введите один из следующих адресов в соответствии с полным DNS-именем головного узла.
   
    ```
    https://<HeadNodeDnsName>.cloudapp.net/HpcPortal
    ```
   
    или
   
    ```
    https://<HeadNodeDnsName>.<region>.cloudapp.azure.com/HpcPortal
    ```
2. В появившемся диалоговом окне введите учетные данные администратора кластера HPC. (Вы также можете добавить пользователей кластера в разных ролях. Ознакомьтесь со статьей [Managing Cluster Users](https://technet.microsoft.com/library/ff919335.aspx)(Управление пользователями кластера.)
   
    Откроется веб-портал со списком заданий.
3. Чтобы отправить тестовое задание, которое возвращает строку «Hello World» из кластера, щелкните **Создать задание** в панели навигации слева.
4. На странице **New Job** (Новое задание) в разделе **From submission pages** (Со страниц отправки) щелкните **HelloWorld**. Откроется страница отправки задания.
5. Нажмите кнопку **Submit**(Отправить). При появлении запроса введите доменные учетные данные администратора кластера HPC. Задание будет отправлено, а идентификатор задания появится на странице **My Jobs** (Мои задания).
6. Чтобы просмотреть результаты отправленного задания, щелкните идентификатор задания и нажмите кнопку **View Tasks** (Просмотреть задачи), чтобы увидеть результаты выполнения команды (в разделе **Output** (Выходные данные)).

## <a name="next-steps"></a>Дополнительная информация
* Вы также можете отправлять задания в кластер Azure с помощью [интерфейса REST API для пакета HPC](http://social.technet.microsoft.com/wiki/contents/articles/7737.creating-and-submitting-jobs-by-using-the-rest-api-in-microsoft-hpc-pack-windows-hpc-server.aspx).
* Если нужно отправлять задания в кластер из клиента Linux, изучите пример на языке Python, описанный в статье [HPC Pack 2012 R2 SDK and Sample Code](https://www.microsoft.com/download/details.aspx?id=41633)(Пакет SDK для HPC Pack 2012 R2 и пример кода).

<!--Image references-->
[jobsubmit]: ./media/virtual-machines-windows-hpcpack-cluster-submit-jobs/jobsubmit.png
