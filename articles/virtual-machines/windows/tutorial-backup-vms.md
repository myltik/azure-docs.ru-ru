---
title: Руководство. Резервное копирование виртуальных машин Windows на портале Azure | Документация Microsoft
description: Из этого руководства вы узнаете, как защитить виртуальные машины Windows с помощью портала Azure и службы Azure Backup.
services: virtual-machines-windows
documentationcenter: virtual-machines
author: cynthn
manager: jeconnoc
editor: tysonn
tags: azure-resource-manager
ms.assetid: ''
ms.service: virtual-machines-windows
ms.devlang: na
ms.topic: tutorial
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 07/27/2017
ms.author: cynthn
ms.custom: mvc
ms.openlocfilehash: 6ae014597a89c75e4426715227bbb19f1e98a438
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
ms.locfileid: "32189295"
---
# <a name="tutorial-back-up-and-restore-files-for-windows-virtual-machines-in-azure"></a>Руководство по резервному копированию и восстановлению файлов для виртуальных машин Windows в Azure

Для защиты данных можно создавать архивы с регулярным интервалом. Служба архивации Azure создает точки восстановления, которые хранятся в геоизбыточных хранилищах восстановления. Используя точку восстановления, можно восстановить всю виртуальную машину или определенные файлы. В этой статье описана процедура восстановления одного файла на виртуальной машине с Windows Server и IIS. Если у вас еще нет виртуальной машины, создайте ее, используя сведения, приведенные в статье [Быстрое создание виртуальной машины с ОС Windows](quick-create-portal.md). Из этого руководства вы узнаете, как выполнить следующие задачи:

> [!div class="checklist"]
> * Создание архива виртуальной машины
> * Планирование ежедневной архивации
> * Восстановление файла из архива

## <a name="backup-overview"></a>Обзор службы архивации

Служба архивации Azure запускает задание архивации. При этом расширение архивации создает моментальный снимок. Служба архивации Azure использует расширение _VMSnapshot_. Расширение устанавливается во время первой архивации виртуальной машины, если виртуальная машина запущена. Если виртуальная машина не запущена, служба резервного копирования создает моментальный снимок базового хранилища (так как операции записи в приложении не выполняются, пока виртуальная машина остановлена).

Во время создания моментального снимка виртуальных машин Windows служба архивации координируется со службой теневого копирования томов (VSS), что позволяет создать согласованный моментальный снимок дисков виртуальной машины. После создания моментального снимка службой архивации Azure данные передаются в хранилище. Для повышения эффективности служба анализирует блоки данных и передает только те из них, которые были изменены с момента предыдущего резервного копирования.

После передачи данных служба удаляет моментальный снимок и создает точку восстановления.


## <a name="create-a-backup"></a>Создание резервной копии
Создайте простую операцию ежедневной архивации в хранилище служб восстановления. 

1. Войдите на [портале Azure](https://portal.azure.com/).
2. В меню слева выберите **Виртуальные машины**. 
3. В этом списке выберите нужную виртуальную машину для архивации.
4. В колонке виртуальной машины в разделе **Параметры** щелкните **Архивация**. Откроется колонка **Включение архивации**.
5. В **хранилище служб восстановления** щелкните **Создать** и укажите имя нового хранилища. Новое хранилище создается в той же группе ресурсов и в том же расположении, что и виртуальная машина.
6. Щелкните **Политика архивации**. Для этого примера оставьте значения по умолчанию и нажмите кнопку **ОК**.
7. В колонке **Включение архивации** щелкните **Включить архивацию**. При этом создается задание ежедневной архивации на основе расписания по умолчанию.
10. Для создания начальной точки восстановления в колонке **Архивация** щелкните **Создать архив**.
11. В колонке **Создать архив** щелкните значок календаря и с помощью элементов управления календарем выберите последний день сохранения этой точки восстановления, а затем нажмите кнопку **Архивировать**.
12. В колонке **Архивация** виртуальной машины вы увидите количество выполненных точек восстановления.

    ![Точки восстановления](./media/tutorial-backup-vms/backup-complete.png)
    
Первая архивация длится около 20 минут. После завершения архивации перейдите к следующей части этого руководства.

## <a name="recover-a-file"></a>восстановление файла;

Если вы случайно удалили файл или внесли в него ненужные изменения, его можно восстановить из резервного хранилища, используя функцию восстановления файлов. Восстановление файлов запускает скрипты на виртуальной машине, чтобы подключить точку восстановления в качестве локального диска. Эти диски остаются подключенными в течение 12 часов, чтобы вы могли скопировать файлы из точки восстановления и восстановить их на виртуальной машине.  

В этом примере показано, как восстановить файл изображения, которое используется на веб-странице IIS по умолчанию. 

1. Откройте браузер и введите IP-адрес виртуальной машины в адресной строке. Откроется веб-страница IIS по умолчанию.

    ![Веб-страница IIS по умолчанию](./media/tutorial-backup-vms/iis-working.png)

2. Подключитесь к виртуальной машине.
3. На виртуальной машине откройте **Проводник**, перейдите в папку \inetpub\wwwroot и удалите файл **iisstart.png**.
4. На локальном компьютере обновите окно браузера, чтобы убедиться, что изображение на веб-странице IIS по умолчанию отсутствует.

    ![Веб-страница IIS по умолчанию](./media/tutorial-backup-vms/iis-broken.png)

5. На локальном компьютере откройте новую вкладку и перейдите на [портал Azure](https://portal.azure.com).
6. В меню слева выберите **Виртуальные машины** и выберите виртуальную машину из списка.
8. В колонке виртуальной машины в разделе **Параметры** щелкните **Архивация**. Откроется колонка **Архивация**. 
9. В меню в верхней части колонки выберите **Восстановление файлов**. Откроется колонка **Восстановление файлов**.
10. В разделе **Шаг 1. Выбор точки восстановления** выберите точку восстановления из раскрывающегося списка.
11. В разделе **Шаг 2. Скачивание скрипта для просмотра и восстановления файлов** нажмите кнопку **Скачать исполняемый файл**. Сохраните файл в папку **Загрузки**.
12. На локальном компьютере откройте **Проводник**, перейдите в папку **Загрузки** папку и скопируйте скачанный EXE-файл. В качестве префикса имени файла используется имя виртуальной машины. 
13. Вставьте EXE-файл на рабочий стол виртуальной машины (через подключение RDP). 
14. Перейдите на рабочий стол виртуальной машины и дважды щелкните EXE-файл. Откроется командная строка. После этого подключите точку восстановления как общую папку, к которой у вас есть доступ. После создания общей папки введите **q**, чтобы закрыть командную строку.
15. В виртуальной машине откройте **Проводник** и затем откройте диск, который использовался для общей папки.
16. Перейдите в каталог \inetpub\wwwroot, скопируйте файл **iisstart.png** из общей папки и вставьте его в папку \inetpub\wwwroot. Например, скопируйте файл F:\inetpub\wwwroot\iisstart.png и вставьте его в папку C:\inetpub\wwwroot, чтобы восстановить этот файл.
17. На локальном компьютере откройте вкладку браузера с подключением к IP-адресу виртуальной машины, на которой открыта веб-страница IIS по умолчанию. Нажмите CTRL+F5, чтобы обновить страницу в браузере. Вы увидите, что изображение снова появилось.
18. На локальном компьютере вернитесь к вкладке портала Azure в браузере и в разделе **Шаг 3. Отключение дисков после восстановления** нажмите кнопку **Отключить диски**. Если вы забудете сделать это, соединение с точкой подключения будет автоматически закрыто через 12 часов. После этих 12 часов для создания нового соединения с точкой подключения потребуется скачать новый скрипт.


## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * Создание архива виртуальной машины
> * Планирование ежедневной архивации
> * Восстановление файла из архива

Перейдите к следующему руководству, чтобы узнать о мониторинге виртуальных машин.

> [!div class="nextstepaction"]
> [Управление виртуальными машинами](tutorial-govern-resources.md)









