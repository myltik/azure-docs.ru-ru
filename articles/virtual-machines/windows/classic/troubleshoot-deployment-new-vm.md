---
title: Устранение неполадок, возникающих при развертывании виртуальных машин Windows с помощью классической модели | Документация Майкрософт
description: Устранение неполадок, возникающих при создании виртуальной машины Windows в Azure с помощью классической модели развертывания
services: virtual-machines-windows
documentationcenter: ''
author: JiangChen79
manager: felixwu
editor: ''
tags: top-support-issue
ms.assetid: 9f01d237-ba39-4c32-b72d-18f5f505d43a
ms.service: virtual-machines-windows
ms.workload: na
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: troubleshooting
ms.date: 11/03/2016
ms.author: cjiang
ms.openlocfilehash: 5a1ad33bd8c287910458d26a96858e85c689fb16
ms.sourcegitcommit: adf6a4c89364394931c1d29e4057a50799c90fc0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/09/2017
ms.locfileid: "24056667"
---
# <a name="troubleshoot-classic-deployment-issues-with-creating-a-new-windows-virtual-machine-in-azure"></a>Устранение неполадок в классическом развертывании при создании виртуальной машины Windows в Azure
[!INCLUDE [virtual-machines-troubleshoot-deployment-new-vm-selectors](../../../../includes/virtual-machines-windows-troubleshoot-deployment-new-vm-selectors-include.md)]

[!INCLUDE [virtual-machines-troubleshoot-deployment-new-vm-opening](../../../../includes/virtual-machines-troubleshoot-deployment-new-vm-opening-include.md)]

> [!IMPORTANT] 
> В Azure предлагаются две модели развертывания для создания ресурсов и работы с ними: [модель Resource Manager и классическая модель](../../../resource-manager-deployment-model.md). В этой статье рассматривается использование классической модели развертывания. Для большинства новых развертываний Майкрософт рекомендует использовать модель диспетчера ресурсов. Версия этой статьи для модели развертывания с помощью Resource Manager доступна [здесь](../../virtual-machines-windows-troubleshoot-deployment-new-vm.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).
> [!INCLUDE [virtual-machines-common-classic-createportal](../../../../includes/virtual-machines-classic-portal.md)]

[!INCLUDE [support-disclaimer](../../../../includes/support-disclaimer.md)]

## <a name="collect-audit-logs"></a>Сбор журналов аудита
Для устранения неполадок прежде всего соберите журналы аудита, чтобы определить ошибку, связанную с этой проблемой.

На портале Azure последовательно выберите **Обзор** > **Виртуальные машины** > *имя вашей виртуальной машины Windows* > **Настройки** > **Журналы аудита**.

[!INCLUDE [virtual-machines-troubleshoot-deployment-new-vm-issue1](../../../../includes/virtual-machines-troubleshoot-deployment-new-vm-issue1-include.md)]

[!INCLUDE [virtual-machines-windows-troubleshoot-deployment-new-vm-table](../../../../includes/virtual-machines-windows-troubleshoot-deployment-new-vm-table.md)]

**Да.** Если универсальная ОС Windows передается и (или) записывается как универсальный диск, ошибки не возникают. Аналогичным образом, если специализированная ОС Windows передается и (или) записывается как специализированный диск, ошибки не возникают.

**Ошибки передачи:**

**Нет<sup>1</sup>.** Если универсальная ОС Windows передается как специализированный диск, отобразится ошибка времени ожидания подготовки, а виртуальная машина зависнет на этапе первого запуска.

**Нет <sup>2</sup>.** Если специализированная ОС Windows передается как универсальный диск, отобразится ошибка подготовки, а виртуальная машина задержится на этапе первого запуска, так как она запускается с исходными именем компьютера, именем пользователя и паролем.

**Способы устранения:**

Чтобы устранить обе ошибки, передайте исходный виртуальный жесткий диск, доступный в локальной среде, с тем же параметром (универсальный или специализированный), который установлен для операционной системы. Чтобы передать диск как универсальный, сначала обязательно выполните команду sysprep. Дополнительные сведения см. в разделе [Создание и отправка виртуального жесткого диска Windows Server в Azure](createupload-vhd.md).

**Ошибки записи:**

**Нет <sup>3</sup>.** Если универсальная ОС Windows записывается как специализированный диск, отобразится ошибка времени ожидания подготовки, так как исходная виртуальная машина отмечена как универсальная и непригодная к использованию.

**Нет <sup>4</sup>.** Если специализированная ОС Windows записывается как универсальный диск, отобразится ошибка подготовки, так как новая виртуальная машина запускается с исходными именем компьютера, именем пользователя и паролем. Кроме того, исходная виртуальная машина отмечена как специализированная и непригодна к использованию.

**Способы устранения:**

Чтобы устранить обе ошибки, удалите на портале текущий образ и [заново запишите его с текущих виртуальных жестких дисков](capture-image.md) с тем же параметром (универсальный или специализированный), который установлен для операционной системы.

## <a name="issue-custom-gallery-marketplace-image-allocation-failure"></a>Проблема: ошибка выделения (пользовательский образ, образ из коллекции или Marketplace)
Такая ошибка возникает в ситуациях, когда запрос на новую виртуальную машину направляется в кластер, который не поддерживает запрашиваемый размер виртуальной машины или не располагает свободным пространством для выполнения запроса. Нельзя сочетать виртуальные машины разных серий в одной облачной службе. Если вы попытаетесь создать новую виртуальную машину такого размера, который не поддерживается вашей облачной службой, запрос вычислений завершится ошибкой.

В зависимости от ограничений, которые существуют для используемой облачной службы, может возникнуть ошибка, вызванная одной из двух причин.

**Причина 1.** Облачная служба прикреплена к конкретному кластеру или связана с территориальной группой, то есть опосредованно прикреплена к конкретному кластеру. В этом случае все запросы новых вычислительных ресурсов в этой территориальной группе выполняются в том же кластере, в котором размещены существующие ресурсы. Но если этот кластер не поддерживает запрошенный размер виртуальной машины или не имеет достаточно свободного места, возникает ошибка выделения. Это не зависит от того, создаются ли новые ресурсы на основе новой облачной службы или существующей облачной службы.

**Способ устранения 1.**

* Создайте новую облачную службу и свяжите ее с регионом или виртуальной сетью на основе региона.
* Создайте новую виртуальную машину в этой облачной службе.
  Если при попытке создания облачной службы появляется сообщение об ошибке, повторите попытку позже или измените регион для облачной службы.

> [!IMPORTANT]
> Если вы безуспешно пытались создать новую виртуальную машину в существующей облачной службе, а затем вынужденно создали новую облачную службу для новой виртуальной машины, позднее вы можете объединить все виртуальные машины в одной облачной службе. Для этого удалите виртуальные машины в существующей облачной службе и заново создайте их из дисков в новой облачной службе. Не забывайте, что новая облачная служба будет иметь новое имя и новый виртуальный IP-адрес. Следовательно, эти данные потребуется обновить для всех зависимостей, которые используют эту информацию о существующей облачной службе.
> 
> 

**Причина 2.** Облачная служба прикреплена к виртуальной сети, которая связана с территориальной группой, то есть облачная служба опосредованно прикреплена к конкретному кластеру. Тогда все запросы новых вычислительных ресурсов в этой территориальной группе выполняются в том же кластере, в котором размещены существующие ресурсы. Но если этот кластер не поддерживает запрошенный размер виртуальной машины или не имеет достаточно свободного места, возникает ошибка выделения. Это не зависит от того, создаются ли новые ресурсы на основе новой облачной службы или существующей облачной службы.

**Способ устранения 2.**

* Создайте региональную виртуальную сеть.
* Создайте виртуальную машину в этой виртуальной сети.
* [Подключите существующую виртуальную сеть](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/) к новой виртуальной сети. См. дополнительные сведения о [региональных виртуальных сетях](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/). Кроме того, вы можете [перенести виртуальную сеть на основе территориальной группы в региональную виртуальную сеть](https://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/), а затем создать в ней виртуальную машину.

## <a name="next-steps"></a>Дополнительная информация
При возникновении проблем во время запуска остановленной виртуальной машины Windows или в случае изменения размера существующей виртуальной машины Windows в Azure см. раздел [Устранение неполадок в классическом развертывании при перезагрузке или изменении размера существующей виртуальной машины Windows в Azure](virtual-machines-windows-classic-restart-resize-error-troubleshooting.md).

