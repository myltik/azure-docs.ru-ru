---
title: "Обслуживание с перезапуском виртуальных машин Windows в Azure | Документация Майкрософт"
description: "Обслуживание с перезапуском виртуальных машин Windows."
services: virtual-machines-windows
documentationcenter: 
author: 
manager: timlt
editor: 
tags: azure-service-management,azure-resource-manager
ms.assetid: 
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 03/27/2017
ms.author: 
translationtype: Human Translation
ms.sourcegitcommit: eeb56316b337c90cc83455be11917674eba898a3
ms.openlocfilehash: b95a5bd216a6d9cdd6ae6ba8e849d0bf4be71fe5
ms.lasthandoff: 04/03/2017


---

# <a name="impactful-maintenance-for-virtual-machines"></a>Обслуживание с перезапуском виртуальных машин

Иногда во время планового технического обслуживания базовой инфраструктуры требуется перезагрузка виртуальных машин. Так как это влияет на доступность виртуальных машин, размещенных в Azure, вы можете использовать следующие функции:

-   отправка уведомления об обслуживании не менее чем за 30 дней;

-   видимость периодов обслуживания для каждой виртуальной машины;

-   гибкость и управляемость при задании точного времени для обслуживания, влияющего на доступность виртуальных машин.

Обслуживание в Microsoft Azure выполняется в режиме итераций. Чтобы снизить риски, связанные с развертыванием новых возможностей и исправлений, начальные итерации имеют меньшую область действия. Последующие итерации могут охватывать несколько регионов (никогда из той же пары регионов). Виртуальная машина входит в одну итерацию обслуживания. Если итерация прерывается, то оставшиеся виртуальные машины будут включены в будущие итерации.

Итерация планового обслуживания имеет два этапа: период упреждающего обслуживания и период планового обслуживания.

**Период упреждающего обслуживания** — период, который обеспечивает вас возможностью начать обслуживание ваших виртуальных машин. Вы можете определить, когда ваша виртуальная машина будет затронута, последовательность обновления и время между обслуживаем каждой виртуальной машины. Вы можете запросить у своих виртуальных машин информацию, когда запланировано их обслуживание, и проверить результат последнего инициированного запроса на обслуживание.

**Период планового обслуживания** — период, когда Azure проводит обслуживание ваших виртуальных машин по расписанию. В течение этого периода времени, который наступает после периода упреждающего обслуживания, вы все еще можете запрашивать окно обслуживания, но больше не можете им управлять.

## <a name="availability-considerations-during-planned-maintenance"></a>Вопросы доступности во время планового обслуживания 

### <a name="paired-regions"></a>Пары регионов

Каждый регион Azure образует пару с другим регионом в пределах той же географической территории. Эти два региона формируют пару регионов. При выполнении обслуживания Azure обновляет экземпляры виртуальной машины только в одном регионе пары. Например, при обновлении виртуальных машин в северо-центральном регионе США Azure не будет одновременно обновлять виртуальные машины в юго-центральном регионе США. Это обновление будет запланировано на отдельное время с включением отработки отказа или балансировки нагрузки между регионами. Однако в других регионах, например в Северной Европе, обслуживание может происходить одновременно с обслуживанием в восточной части США.
Узнайте больше о [парах регионов Azure](https://docs.microsoft.com/azure/best-practices-availability-paired-regions).

### <a name="single-instance-vms-vs-availability-set-or-vm-scale-set"></a>Одноэкземплярные виртуальные машины, группы доступности и масштабируемый набор виртуальных машин

При развертывании рабочей нагрузки с использованием виртуальных машин в Azure вы можете добавить их в группу доступности для обеспечения высокой доступности приложения. Эта конфигурация обеспечит доступность по крайней мере одной виртуальной машины во время обслуживания или при сбое.

Отдельные виртуальные машины в группе доступности могут быть распределены между максимум 20 доменами обновления. Во время планового обслуживания в конкретный момент времени всегда затрагивается только один домен обновления. При этом порядок, в котором затрагиваются домены обновления, может быть непоследовательным. Для одноэкземплярных виртуальных машин (которые не входят в группу доступности) невозможно спрогнозировать или определить, какие и сколько виртуальных машин будут затронуты обслуживанием.

Масштабируемые наборы виртуальных машин относятся к вычислительным ресурсам Azure, которые позволяют развертывать и администрировать идентичные виртуальные машины как единый ресурс.
Масштабируемый набор предоставляет те же возможности, что и при использовании группы доступности, с помощью доменов обновления. 

Дополнительные сведения о настройке виртуальных машин для обеспечения высокой доступности см. в [*этой статье*](../linux/manage-availability.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

### <a name="scheduled-events"></a>Запланированные события

Служба метаданных Azure позволяет получать сведения о виртуальной машине, размещенной в Azure. Одна из категорий такой информации — запланированные события. Сведения о предстоящих событиях (например, перезагрузках) позволяют приложениям подготовиться к ним и уменьшить влияние на работу.

Дополнительные сведения см. в статье [Служба метаданных Azure. Запланированные события (предварительная версия)](../virtual-machines-scheduled-events.md).

## <a name="maintenance-discovery-and-notifications"></a>Видимость обслуживания и уведомления о нем

Пользователи могут видеть расписание обслуживания на уровне отдельных виртуальных машин. Вы можете запрашивать информацию о периодах упреждающего и планового обслуживания с помощью портала Azure, API, PowerShell или интерфейса командной строки. Кроме того, вы получите уведомление по электронной почте в случае, если одна или несколько ваших виртуальных машин будут затронуты во время процесса.

Этапы и упреждающего, и планового обслуживания начинаются с уведомления. Вы получите по одному уведомлению в каждой подписке Azure. По умолчанию уведомление отправляется администратору и соадминистратору подписки. Вы также можете настроить аудиторию для уведомления об обслуживании.

### <a name="view-the-maintenance-window-in-the-portal"></a>Просмотр окна обслуживания на портале 

На портале Azure можно увидеть, на каких виртуальных машинах запланировано обслуживание.

1.  Войдите на портал Azure.

2.  Щелкните и откройте колонку **Виртуальные машины**.

3.  Щелкните **Столбцы**, чтобы открыть список доступных для выбора столбцов.

4.  Выберите и добавьте столбцы **Окно обслуживания**. Для виртуальных машин з запланированным обслуживанием отображаются окна обслуживания. После завершения или прерывания обслуживания окно обслуживания больше не отображается.

### <a name="query-maintenance-details-using-the-azure-api"></a>Запрос сведений об обслуживании с помощью Azure API

Воспользуйтесь [командой получения API сведения о виртуальной машине](https://docs.microsoft.com/rest/api/compute/virtualmachines/virtualmachines-get) для получения представления экземпляра, где можно просмотреть информацию об обслуживании на отдельной виртуальной машине. Ответ будет содержать следующие элементы:

  - isCustomerInitiatedMaintenanceAllowed. Указывает, можно ли запускать упреждающее повторное развертывание на виртуальной машине.

  - preMaintenanceWindowStartTime. Время начала периода упреждающего обслуживания.

  - preMaintenanceWindowStartTime. Время окончания периода упреждающего обслуживания. По истечении этого времени вы больше не сможете инициировать обслуживание на этой виртуальной машине.
    
  - maintenanceWindowStartTime. Время начала периода планового обслуживания, когда ваша виртуальная машина будет затронута.

  - maintenanceWindowEndTime. Время окончания периода планового обслуживания.
  
  - lastOperationResultCode. Показывает результат последней операции повторного развертывания обслуживания.
 
  - lastOperationResultMessage. Сообщение, которое описывает результат вашей последней операции повторного развертывания обслуживания.

## <a name="pre-emptive-redeploy"></a>Упреждающее повторное развертывание

Упреждающее повторное развертывание позволяет контролировать время обслуживания ваших виртуальных машин в Azure. Плановое обслуживание начинается с периода упреждающего обслуживания. Тогда вы можете решить, когда каждая из ваших виртуальных машин будет перезагружена. Ниже приведены примеры использования, когда такая функциональность полезна:

-   Обслуживание необходимо согласовать с конечным клиентом.

-   Предлагаемого Azure периода планового обслуживания недостаточно.
    Это может произойти, если период обслуживания придется на самое загруженное время недели или будет слишком долгим.

-   Вам потребуется значительное время или определенная последовательность между обслуживанием двух виртуальных машин при работе с приложениями с несколькими экземплярами или уровнями.

Когда вы вызываете упреждающее повторное развертывание на виртуальной машине, оно перемещает виртуальную машину на уже обновленный узел, где она снова включается со всеми вашими параметрами конфигурации и связанными ресурсами. При этом временный диск будет удален, а связанные с виртуальным сетевым интерфейсом динамические IP-адреса будут обновлены.

Упреждающее повторное развертывание выполняется один раз для каждой виртуальной машины. Если во время процесса возникнет ошибка, операция прервется. Виртуальная машина не будет затронута и будет исключена из итерации планового обслуживания. Позднее с вами свяжутся с новым расписанием и предложат новую возможность запланировать и определить порядок обслуживания ваших виртуальных машин.
