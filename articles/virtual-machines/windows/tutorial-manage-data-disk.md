---
title: "Управление дисками Azure с помощью Azure PowerShell | Документы Майкрософт"
description: "Руководство по управлению дисками Azure с помощью Azure PowerShell."
services: virtual-machines-windows
documentationcenter: virtual-machines
author: neilpeterson
manager: timlt
editor: tysonn
tags: azure-service-management
ms.assetid: 
ms.service: virtual-machines-windows
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure
ms.date: 05/02/2017
ms.author: nepeters
ms.translationtype: Human Translation
ms.sourcegitcommit: 5e92b1b234e4ceea5e0dd5d09ab3203c4a86f633
ms.openlocfilehash: a7511a35a7b186fc424088e7ff5cbc933d325712
ms.contentlocale: ru-ru
ms.lasthandoff: 05/10/2017

---

# <a name="manage-azure-disks-with-powershell"></a>Управление дисками Azure с помощью PowerShell

Виртуальные машины Azure хранят операционную систему, приложения и данные на дисках. При создании виртуальной машины важно выбрать размер диска и конфигурацию в соответствии с ожидаемой рабочей нагрузкой. В этом руководстве рассматривается развертывание дисков виртуальных машин и управление ими. Здесь содержатся сведения о:

> [!div class="checklist"]
> * дисках ОС и временных дисках;
> * Диски данных
> * дисках уровня "Стандартный" и "Премиум";
> * производительности дисков;
> * присоединении и подготовке дисков данных.

Для работы с этим руководством требуется модуль Azure PowerShell версии не ниже 3.6. Чтобы узнать версию, выполните команду ` Get-Module -ListAvailable AzureRM`. Если вам необходимо выполнить обновление, см. статью [об установке и настройке модуля Azure PowerShell](/powershell/azure/install-azurerm-ps).

## <a name="default-azure-disks"></a>Диски Azure по умолчанию

При создании виртуальной машины Azure к ней автоматически подключаются два диска. 

**Диск операционной системы**. Размер дисков операционной системы может составлять до 1 ТБ. Это диски, содержащие операционную систему виртуальной машины.  Для диска ОС по умолчанию назначается буква *c*. Конфигурация кэширования диска ОС оптимизирована для производительности операционной системы. На диске ОС **не должны** размещаться приложения или данные. Для приложений и данных используйте диск данных, который описан далее в этой статье.

**Временный диск**. Временные диски используют твердотельные накопители, расположенные на том же узле Azure, что и виртуальная машина. Временные диски обладают высокой производительностью и могут быть использованы для таких операций, как обработка временных данных. Тем не менее, если виртуальная машина перемещается на новый узел, удаляются все данные, хранящиеся на временном диске. Размер временного диска определяется размером виртуальной машины. Для временных дисков по умолчанию назначается буква *d*.

### <a name="temporary-disk-sizes"></a>Размеры временных дисков

| Тип | Размер виртуальной машины | Максимальный размер временного диска (ГБ) |
|----|----|----|
| [Универсальные](sizes-general.md) | Серии A и D | 800 |
| [Оптимизированные для вычислений](sizes-compute.md) | Серия F | 800 |
| [Оптимизированные для памяти](../virtual-machines-windows-sizes-memory.md) | Серии D и G | 6144 |
| [Оптимизированные для хранилища](../virtual-machines-windows-sizes-storage.md) | Серия L | 5630 |
| [GPU](sizes-gpu.md) | Серия N | 1440 |
| [Высокопроизводительные](sizes-hpc.md) | Серии A и H | 2000 |

## <a name="azure-data-disks"></a>Диски данных Azure

Вы можете добавить дополнительные диски данных, чтобы установить приложения и хранить данные. Диски данных следует использовать в любой ситуации, где требуется надежное хранилище данных, обеспечивающее высокую скорость реагирования. Максимальная емкость каждого диска данных составляет 1 ТБ. Размер виртуальной машины определяет, сколько дисков данных можно к ней подключить. Для каждого ядра виртуальной машины можно подключить два диска данных. 

### <a name="max-data-disks-per-vm"></a>Максимальное число дисков данных на виртуальную машину

| Тип | Размер виртуальной машины | Максимальное число дисков данных на виртуальную машину |
|----|----|----|
| [Универсальные](sizes-general.md) | Серии A и D | 32 |
| [Оптимизированные для вычислений](sizes-compute.md) | Серия F | 32 |
| [Оптимизированные для памяти](../virtual-machines-windows-sizes-memory.md) | Серии D и G | 64 |
| [Оптимизированные для хранилища](../virtual-machines-windows-sizes-storage.md) | Серия L | 64 |
| [GPU](sizes-gpu.md) | Серия N | 48 |
| [Высокопроизводительные](sizes-hpc.md) | Серии A и H | 32 |

## <a name="vm-disk-types"></a>Типы дисков виртуальной машины

В Azure предоставляются диски двух типов.

### <a name="standard-disk"></a>Диск уровня "Стандартный"

Хранилище класса Standard использует жесткие диски и обеспечивает экономичное хранилище с достаточной производительностью. Эти диски идеально подходят для экономных рабочих нагрузок разработки и тестирования.

### <a name="premium-disk"></a>Диск уровня "Премиум"

Диски уровня "Премиум" используют высокопроизводительные твердотельные накопители с низкой задержкой. Они идеально подходят для виртуальных машин, выполняющих производственную рабочую нагрузку. Хранилище уровня "Премиум" поддерживает виртуальные машины серий DS, DSv2, GS и FS. Диски уровня "Премиум" бывают трех типов: P10, P20, P30. Размер диска определяет его тип. При выборе размер диска округляется в большую сторону до следующего типа. Например, если размер меньше 128 ГБ, диска будет относиться к типу P10, от 129 до 512 ГБ — P20, более 512 ГБ — P30. 

### <a name="premium-disk-performance"></a>Производительность диска уровня "Премиум"

|Тип диска хранилища уровня "Премиум" | P10 | P20 | P30 |
| --- | --- | --- | --- |
| Размер диска (округленный в большую сторону) | 128 ГБ | 512 ГБ | 1024 ГБ (1 ТБ) |
| Количество операций ввода-вывода в секунду на диск | 500 | 2300 | 5 000 |
Пропускная способность на диск | 100 МБ/с | 150 МБ/с | 200 МБ/с |

Хотя в таблице выше указано максимальное число операций ввода-вывода в секунду на диск, можно обеспечить более высокий уровень производительности, применив чередование нескольких дисков данных. Например, к виртуальной машине Standard_GS5 можно подключить 64 диска данных. Если каждый из этих дисков относится к размеру P30, можно добиться производительности до 80 000 операций ввода-вывода в секунду. Дополнительные сведения о максимальных количествах операций ввода-вывода в секунду для виртуальных машин см. в разделе [Размеры виртуальных машин Linux](./sizes.md).

## <a name="create-and-attach-disks"></a>Создание и подключение дисков

Для выполнения примера в этом руководстве требуется виртуальная машина. Этот [пример сценария](../scripts/virtual-machines-windows-powershell-sample-create-vm.md) позволяет создать ее при необходимости. При работе с примером по мере необходимости заменяйте имена групп ресурсов и виртуальных машин.

Создайте начальную конфигурацию, выполнив команду [New-AzureRmDiskConfig](/powershell/module/azurerm.compute/new-azurermdiskconfig). В следующем примере настраивается диск размером 128 ГБ.

```powershell
$diskConfig = New-AzureRmDiskConfig -Location EastUS -CreateOption Empty -DiskSizeGB 128
```

Создайте диск данных с помощью команды [New-AzureRmDisk](/powershell/module/azurerm.compute/new-azurermdisk).

```powershell
$dataDisk = New-AzureRmDisk -ResourceGroupName myResourceGroup -DiskName myDataDisk -Disk $diskConfig
```

Получите виртуальную машину, в которую вы хотите добавить диск данных, выполнив команду [Get-AzureRmVM](/powershell/module/azurerm.compute/get-azurermvm):

```powershell
$vm = Get-AzureRmVM -ResourceGroupName myResourceGroup -Name myVM
```

Добавьте диск данных в конфигурацию виртуальной машины с помощью команды [Add-AzureRmVMDataDisk](/powershell/module/azurerm.compute/add-azurermvmdatadisk).

```powershell
$vm = Add-AzureRmVMDataDisk -VM $vm -Name myDataDisk -CreateOption Attach -ManagedDiskId $dataDisk.Id -Lun 1
```

Обновите виртуальную машину с помощью команды [Update-AzureRmVM](/powershell/module/azurerm.compute/add-azurermvmdatadisk).

```powershell
Update-AzureRmVM -ResourceGroupName myResourceGroup -VM $vm
```

## <a name="prepare-data-disks"></a>Подготовка дисков данных

После подключения диска к виртуальной машине нужно настроить операционную систему для его использования. В примере ниже показано, как вручную настроить первый диск, добавляемый в виртуальную машину. Этот процесс можно автоматизировать с помощью [расширения настраиваемых сценариев](./tutorial-automate-vm-deployment.md).

### <a name="manual-configuration"></a>Настройка вручную

Создайте RDP-подключение к виртуальной машине. Откройте PowerShell и выполните этот сценарий.

```powershell
Get-Disk | Where partitionstyle -eq 'raw' | `
Initialize-Disk -PartitionStyle MBR -PassThru | `
New-Partition -AssignDriveLetter -UseMaximumSize | `
Format-Volume -FileSystem NTFS -NewFileSystemLabel "myDataDisk" -Confirm:$false
```

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы ознакомились с дисками виртуальных машин, а именно с:

> [!div class="checklist"]
> * дисками ОС и временными дисками;
> * Диски данных
> * дисками уровня "Стандартный" и "Премиум";
> * производительностью дисков;
> * присоединением и подготовкой дисков данных.

Перейдите к следующему руководству, чтобы узнать об автоматической настройке виртуальных машин.

> [!div class="nextstepaction"]
> [Автоматизация настройки виртуальной машины](./tutorial-automate-vm-deployment.md)

