---
title: Что такое диспетчер трафика | Документация Майкрософт
description: Эта статья поможет понять, что такое диспетчер трафика и насколько он подходит для маршрутизации трафика вашего приложения
services: traffic-manager
documentationcenter: ''
author: kumudd
manager: timlt
editor: ''
ms.assetid: 75d5ff9a-f4b9-4b05-af32-700e7bdfea5a
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/15/2017
ms.author: kumud
ms.openlocfilehash: 50d7f14d0d4234ee98d8a46e903b5f916cb02fab
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
ms.locfileid: "23111832"
---
# <a name="overview-of-traffic-manager"></a>Обзор диспетчера трафика

Диспетчер трафика Microsoft Azure позволяет управлять распределением пользовательского трафика между конечными точками службы в разных центрах обработки данных. К конечным точкам службы, поддерживаемым диспетчером трафика Azure, относятся виртуальные машины, веб-приложения и облачные службы Azure. Можно также использовать диспетчер трафика Azure для внешних конечных точек, не относящихся к среде Azure.

Диспетчер трафика использует службу доменных имен (DNS) для направления клиентских запросов к наиболее подходящей конечной точке в зависимости от метода маршрутизации трафика и работоспособности конечных точек. Диспетчер трафика предоставляет целый ряд [методов маршрутизации трафика](traffic-manager-routing-methods.md) и [параметров мониторинга конечных точек](traffic-manager-monitoring.md), подходящих для приложений с различными потребностями и моделями автоматической отработки отказа. Диспетчер трафика устойчив к сбоям, включая сбой всего региона Azure.

## <a name="traffic-manager-benefits"></a>Преимущества диспетчера трафика

Диспетчер трафика позволяет решать указанные ниже задачи.

* **Повышение доступности критически важных приложений.**

    Диспетчер трафика обеспечивает высокую доступность для приложений за счет мониторинга конечных точек и автоматической отработки отказа при выходе конечной точки из строя.

* **Улучшение отклика высокопроизводительных приложений.**

    Платформа Azure позволяет размещать облачные службы и веб-сайты в распределенных по всему миру центрах данных. Диспетчер трафика уменьшает время отклика приложений, направляя трафик к конечной точке с наименьшим значением задержки сети для клиента.

* **Обслуживание без простоя.**

    Вы можете выполнять операции запланированного обслуживания приложений без простоев. Во время обслуживания диспетчер трафика направляет трафик к альтернативным конечным точкам.

* **Объединение локальных и облачных приложений.**

    Диспетчер трафика поддерживает внешние конечные точки, не относящиеся к Azure, что позволяет использовать его в гибридных облачных и локальных развертываниях, включая сценарии пакетной передачи данных в облако, миграции в облако и отработки отказа в облако.

* **Распределение трафика крупных, сложных развертываний.**

    Используя [вложенные профили диспетчера](traffic-manager-nested-profiles.md), можно объединить методы маршрутизации трафика, чтобы создать комплексные и гибкие правила для поддержки потребностей более крупных и сложных развертываний.

## <a name="how-traffic-manager-works"></a>Как работает диспетчер трафика

Диспетчер трафика Azure позволяет управлять распределением трафика между конечными точками приложения. Конечная точка — это любая служба, размещенная в среде Azure или за ее пределами, с доступом в Интернет.

Диспетчер трафика предоставляет два основных преимущества.

1. Распределение трафика в соответствии с одним из нескольких [методов маршрутизации трафика](traffic-manager-routing-methods.md)
2. [Постоянный мониторинг работоспособности конечной точки](traffic-manager-monitoring.md) и автоматический переход на другой ресурс при сбое конечных точек.

Когда клиент пытается подключиться к службе, он должен сначала разрешить IP-адрес этой службы по ее DNS-имени. Затем клиент подключается к этому IP-адресу для доступа к службе.

**Самое главное — понимать, как диспетчер трафика работает на уровне DNS.**  Диспетчер трафика с помощью службы DNS направляет клиентов к разным конечным точкам службы, используя правила маршрутизации трафика. Клиент **напрямую** подключается к выбранной конечной точке. Диспетчер трафика не выполняет функции прокси-сервера или шлюза. Диспетчер трафика не может отслеживать трафик, проходящий между клиентом и службой.

### <a name="traffic-manager-example"></a>Пример диспетчера трафика

Корпорация Contoso разработала новый партнерский портал. URL-адрес для этого портала — https://partners.contoso.com/login.aspx. Приложение размещается в трех регионах Azure. Чтобы повысить доступность и общую производительность, компания использует диспетчер трафика, который направляет запросы клиентов в ближайшую доступную конечную точку.

Чтобы добиться такой конфигурации, сделайте следующее:

1. Развертывается три экземпляра службы. Этим развертываниям присваиваются DNS-имена contoso-us.cloudapp.net, contoso-eu.cloudapp.net и contoso-asia.cloudapp.net.
2. Создайте профиль диспетчера трафика с именем contoso.trafficmanager.net и настройте в этом профиле маршрутизацию трафика по производительности между тремя конечными точками.
* Для личного домена (partners.contoso.com) настройте запись CNAME в DNS, которая указывает на contoso.trafficmanager.net.

![Конфигурация DNS диспетчера трафика][1]

> [!NOTE]
> При использовании личного домена с диспетчером трафика Azure необходимо использовать запись CNAME для связи личного доменного имени с доменным именем диспетчера трафика. Стандарты DNS не позволяют создавать записи CNAME для корневой вершины домена. Поэтому вы не сможете создать запись CNAME для contoso.com (такой адрес иногда называют "голым" доменом). Запись CNAME можно создать только для поддомена contoso.com (например, www.contoso.com). Чтобы решить эту проблему, мы рекомендуем использовать простое перенаправление HTTP с адреса contoso.com на любой другой адрес, например www.contoso.com.

### <a name="how-clients-connect-using-traffic-manager"></a>Как клиенты могут подключаться с помощью диспетчера трафика

Когда пользователь в рамках описанной конфигурации запрашивает страницу https://partners.contoso.com/login.aspx, его клиент выполняет следующие действия, чтобы разрешить имя DNS и установить подключение.

![Установка подключения с помощью диспетчера трафика][2]

1. Клиент отправляет запрос DNS рекурсивной службе DNS для разрешения имени partners.contoso.com. (Рекурсивная (локальная) служба DNS сама не размещает информацию о доменах. Она просто освобождает клиента от необходимости взаимодействия через Интернет с полномочными службами DNS для разрешения DNS-имени.)
2. Чтобы разрешить имя DNS, рекурсивная служба DNS находит серверы доменных имен для домена contoso.com. Затем она обращается к этим серверам доменных имен и запрашивает запись DNS для имени partners.contoso.com. DNS-серверы, связанные с доменом contoso.com, возвращают запись CNAME, которая указывает на contoso.trafficmanager.net.
3. Рекурсивная служба DNS находит серверы доменных имен для домена trafficmanager.net, которые входят в службу диспетчера трафика Azure. Затем служба DNS отправляет этим серверам запрос на запись DNS для имени contoso.trafficmanager.net.
4. Серверы имен диспетчера трафика получают запрос. Они выбирают конечную точку, учитывая следующее:

    - состояние каждой конечной точки (отключенные конечные точки не возвращаются);
    - работоспособность каждой конечной точки, определенная с помощью средства проверки работоспособности диспетчера трафика. Дополнительные сведения см. в статье [Мониторинг и отработка отказов конечной точки диспетчера трафика](traffic-manager-monitoring.md).
    - выбранный метод маршрутизации трафика. Дополнительные сведения см. в статье [Методы маршрутизации трафика диспетчером трафика](traffic-manager-routing-methods.md).

5. Возвращается запись DNS CNAME с именем выбранной конечной точки. В нашем примере это — contoso-us.cloudapp.net.
6. Теперь рекурсивная служба DNS находит серверы доменных имен для домена cloudapp.net. Она обращается к этим серверам доменных имен и запрашивает запись DNS для contoso-us.cloudapp.net. Возвращается запись DNS A, которая содержит IP-адрес конечной точки службы, размещенной в США.
7. Рекурсивная служба DNS объединяет полученные результаты и возвращает клиенту один ответ DNS.
8. Клиент получает информацию DNS и подключается к указанному IP-адресу. Клиент подключается к конечной точке службы приложения напрямую, а не через диспетчер трафика. Так как это конечная точка HTTPS, клиент выполняет необходимое подтверждение SSL/TLS и отправляет запрос HTTP GET на получение страницы /login.aspx.

Рекурсивная служба DNS кэширует все полученные ответы DNS. Сопоставитель DNS на клиентском устройстве также кэширует результат. Это позволяет быстрее отвечать на последующие запросы DNS, используя данные из кэша, а не результаты запросов к другим серверам доменных имен. Длительность хранения записей DNS в кэше определяется свойством time-to-live (срок жизни, TTL). Чем меньше это значение, тем быстрее запись в кэше будет считаться истекшей, следовательно, сервера доменных имен, используемые диспетчером трафика, будут получать больше запросов. Более высокие значения приведут к тому, что при сбое конечной точки потребуется больше времени, чтобы переключить трафик на другие конечные точки. Диспетчер трафика позволяет настраивать срок жизни, используемый в ответах службы доменных имен (DNS) диспетчера трафика, в диапазоне от 0 до 2 147 483 647 секунд (максимальный диапазон в соответствии с [RFC-1035](https://www.ietf.org/rfc/rfc1035.txt)), позволяя вам выбрать значение, которое лучше всего соответствует требованиям приложения.

## <a name="pricing"></a>Цены

Сведения о ценах см. на [странице с ценами на диспетчер трафика](https://azure.microsoft.com/pricing/details/traffic-manager/).

## <a name="faq"></a>Часто задаваемые вопросы

Ответы на часто задаваемые вопросы о диспетчере трафика Azure см. в статье [Диспетчер трафика Azure: вопросы и ответы](traffic-manager-FAQs.md).

## <a name="next-steps"></a>Дополнительная информация

См. дополнительные сведения в статье [Мониторинг и отработка отказов конечной точки диспетчера трафика](traffic-manager-monitoring.md).

См. дополнительные сведения в статье [Методы маршрутизации трафика диспетчером трафика](traffic-manager-routing-methods.md).

Дополнительные сведения о некоторых других ключевых [сетевых возможностях](../networking/networking-overview.md) Azure.

<!--Image references-->
[1]: ./media/traffic-manager-how-traffic-manager-works/dns-configuration.png
[2]: ./media/traffic-manager-how-traffic-manager-works/flow.png

