---
title: Настройка отчетов для службы Azure Backup
description: В этой статье рассматривается настройка отчетов Power BI для службы Azure Backup с помощью хранилища служб восстановления.
services: backup
author: JPallavi
manager: vijayts
ms.service: backup
ms.topic: conceptual
ms.date: 11/10/2017
ms.author: pajosh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: b645d12255ab2bd6c3747eb966b2a6ecc3e284b3
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34605235"
---
# <a name="configure-azure-backup-reports"></a>Настройка отчетов службы Azure Backup
В этой статье рассматривается настройка отчетов службы Azure Backup с помощью хранилища служб восстановления и доступ к этим отчетам с помощью Power BI. После выполнения этих действий можно непосредственно перейти в Power BI для просмотра всех отчетов, их настройки и создания. 

## <a name="supported-scenarios"></a>Поддерживаемые сценарии использования.
1. Отчеты службы Azure Backup поддерживаются для резервного копирования виртуальных машин Azure, а также резервного копирования файлов или папок в облако с помощью агента служб восстановления Microsoft Azure.
2. Отчеты для Azure SQL, DPM и Azure Backup Server в настоящее время не поддерживаются.
3. Отчеты можно просматривать по всем хранилищам и подпискам, если та же учетная запись хранения настроена для всех хранилищ. Выбранная учетная запись хранения должна находиться в том же регионе, что и хранилище служб восстановления.
4. В Power BI частота запланированного обновления для отчетов составляет 24 часа. Также можно выполнить ad-hoc-обновление отчетов в Power BI. В этом случае для подготовки отчетов используются последние данные в пользовательской учетной записи хранения. 
5. Отчеты Azure Backup пока не поддерживаются в национальных облаках.

## <a name="prerequisites"></a>предварительным требованиям
1. Создайте [учетную запись хранения Azure](../storage/common/storage-create-storage-account.md#create-a-storage-account), чтобы настроить ее для отчетов. Эта учетная запись используется для хранения данных, связанных с отчетами.
2. [Создайте учетную запись Power BI](https://powerbi.microsoft.com/landing/signin/) для просмотра, настройки и создания собственных отчетов с помощью портала Power BI.
3. Зарегистрируйте поставщик ресурсов **Microsoft.Insights**, если вы еще этого не сделали, с помощью подписки учетной записи хранения и подписки хранилища служб восстановления, чтобы передавать данные отчетов в учетную запись хранения. Чтобы сделать то же самое, перейдите на портал Azure, выберите "Подписки > Поставщики ресурсов " и проверьте наличие этого поставщика, чтобы зарегистрировать его. 

## <a name="configure-storage-account-for-reports"></a>Настройка учетной записи хранения для отчетов
Выполните следующие действия, чтобы настроить учетную запись хранения для хранилища служб восстановления с помощью портала Azure. Это одноразовая настройка. После настройки учетной записи хранения можно напрямую перейти в Power BI, чтобы просмотреть содержимое пакетов и использовать отчеты.
1. Если хранилище служб восстановления уже открыто, перейдите к следующему шагу. Если хранилище служб восстановления не открыто, на портале Azure щелкните **Все службы**.

   * В списке ресурсов введите **Службы восстановления**.
   * Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Когда появится пункт **Хранилища служб восстановления**, щелкните его.

      ![Создание хранилища служб восстановления — шаг 1](./media/backup-azure-vms-encryption/browse-to-rs-vaults.png) <br/>

     После этого отобразится список хранилищ служб восстановления, в котором нужно выбрать хранилище.

     Затем откроется панель мониторинга выбранного хранилища.
2. В списке элементов, которые отображаются в хранилище, в разделе "Мониторинг и отчеты" щелкните **Backup Reports** (Отчеты резервного копирования), чтобы настроить учетную запись хранения для отчетов.

      ![Шаг 2. Выбор пункта меню Backup Reports (Отчеты резервного копирования)](./media/backup-azure-configure-reports/backup-reports-settings.PNG)
3. В колонке отчетов резервного копирования выберите ссылку **Параметры диагностики**. Откроется окно параметров диагностики, которое используется для отправки данных в клиентскую учетную запись хранения.

      ![Включение диагностики, шаг 3](./media/backup-azure-configure-reports/backup-azure-configure-reports.png)
4. Щелкните ссылку **Включить диагностику**. Откроется окно настройки учетной записи хранения. 

      ![Включение диагностики, шаг 4](./media/backup-azure-configure-reports/enable-diagnostics.png)
5. В поле **Имя** введите имя параметра и установите флажок **Архивировать в учетной записи хранения**, чтобы данные отчетов начали поступать в учетную запись хранения.

      ![Включение диагностики, шаг 5](./media/backup-azure-configure-reports/select-setting-name.png)
6. Щелкните "Учетная запись хранения", выберите соответствующую подписку и учетную запись хранения для хранения данных отчетов, а затем нажмите кнопку **ОК**.

      ![Шаг 6. Выбор учетной записи хранения](./media/backup-azure-configure-reports/select-subscription-sa.png)
7. В разделе "Журнал" установите флажок **AzureBackupReport** и, перемещая ползунок, выберите период хранения этих данных. Данные отчетов будут удерживаться в учетной записи хранения в течение периода, выбранного с помощью этого ползунка.

      ![Сохранение учетной записи хранения, шаг 7](./media/backup-azure-configure-reports/save-diagnostic-settings.png)
8. Просмотрите все изменения и нажмите кнопку **Сохранить** в верхней части страницы, как показано на приведенном выше рисунке. Теперь все изменения сохранены и учетная запись хранения настроена для хранения данных отчетов.

9. В таблице параметров диагностики теперь должен отображаться новый параметр, активированный для хранилища. Если он не отображается, обновите таблицу.

      ![Просмотр параметра диагностики, шаг 9](./media/backup-azure-configure-reports/diagnostic-setting-row.png)

> [!NOTE]
> Когда вы настроите отчеты, путем сохранив учетную запись хранения, **подождите 24 часа**, пока не завершится принудительная начальная отправка данных. Импортировать пакет содержимого Azure Backup в Power BI следует только после этого. Дополнительные сведения см. в разделе с [вопросами и ответами](#frequently-asked-questions). 
>
>

## <a name="view-reports-in-power-bi"></a>Просмотр отчетов в Power BI 
После настройки учетной записи хранения для отчетов с помощью хранилища служб восстановления данные отчетов начнут поступать примерно через 24 часа. Через 24 часа после настройки учетной записи хранения выполните следующие действия, чтобы просмотреть отчеты в Power BI:
1. Войдите в [Power BI](https://powerbi.microsoft.com/landing/signin/).
2. Щелкните **Get Data** (Получить данные) и выберите **Получить** в разделе **Службы** в библиотеке пакетов содержимого. Выполните действия, указанные в статье [Подключение к службам с помощью пакетов содержимого для Power BI](https://powerbi.microsoft.com/en-us/documentation/powerbi-content-packs-services/).

     ![Импорт пакета содержимого](./media/backup-azure-configure-reports/content-pack-import.png)
3. Введите **Azure Backup** в строке поиска и щелкните **Get it now** (Получить сейчас).

      ![Получение пакета содержимого](./media/backup-azure-configure-reports/content-pack-get.png)
4. Введите имя учетной записи хранения, настроенной на шаге 5 выше, и нажмите кнопку **Далее**.

    ![Ввод имени учетной записи хранения](./media/backup-azure-configure-reports/content-pack-storage-account-name.png)    
5. Введите ключ для этой учетной записи хранения. [Ключи учетных записей хранения можно просматривать и копировать](../storage/common/storage-create-storage-account.md#manage-your-storage-account), перейдя к своей учетной записи хранения на портале Azure. 

     ![Ввод учетной записи хранения](./media/backup-azure-configure-reports/content-pack-storage-account-key.png) <br/>
     
6. Нажмите кнопку **Войти**. После успешного входа появится уведомление **Импорт данных**.

    ![Импорт пакета содержимого](./media/backup-azure-configure-reports/content-pack-importing-data.png) <br/>
    
    Через некоторое время после завершения импорта появится уведомление **Успешно**. Если в учетной записи хранения большой объем данных, импорт пакета содержимого может занять чуть больше времени.
    
    ![Успешный импорт пакета содержимого](./media/backup-azure-configure-reports/content-pack-import-success.png) <br/>
    
7. После успешного импорта данных пакет содержимого **Azure Backup** появится в колонке **Приложения** в области навигации. Теперь панель мониторинга службы Azure Backup, отчеты и наборы данных отображаются в списке с желтой звездочкой, обозначающей только что импортированные отчеты. 

     ![Пакет содержимого службы Azure Backup](./media/backup-azure-configure-reports/content-pack-azure-backup.png) <br/>
     
8. Выберите в разделе панелей мониторинга панель **Azure Backup**, где отображается набор закрепленных ключевых отчетов.

      ![Панель мониторинга службы Azure Backup](./media/backup-azure-configure-reports/azure-backup-dashboard.png) <br/>
9. Чтобы просмотреть полный набор отчетов, щелкните любой отчет на панели мониторинга.

      ![Работоспособность задания службы Azure Backup](./media/backup-azure-configure-reports/azure-backup-job-health.png) <br/>
10. Щелкните каждую вкладку в отчетах, чтобы посмотреть отчеты в этой области.

      ![Вкладки с отчетами службы Azure Backup](./media/backup-azure-configure-reports/reports-tab-view.png)


## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы
1. **Как проверить, начали ли данные отчетов поступать в учетную запись хранения?**
    
    Вы можете перейти к настроенной учетной записи хранения и выбрать контейнеры. Если в контейнере есть запись insights-logs-azurebackupreport, это указывает, что данные отчетов начали поступать.

2. **Что такое частота принудительной отправки данных в учетную запись хранения и пакет содержимого службы Azure Backup в Power BI?**

   Для новых пользователей потребуется около 24 часов для принудительной отправки данных в учетную запись хранения. По завершении первоначальной принудительной отправки данные обновляются с частотой, показанной на приведенном ниже изображении. 
      * Данные, связанные с **заданиями, оповещениями, элементами архивации, хранилищами, защищенными серверами и политиками**, передаются учетной записи хранения клиента по мере их записи.
      * Данные, связанные с **хранилищем**, отправляются в учетную запись хранения клиента каждые 24 часа.
   
    ![Частота принудительной отправки данных отчетов службы Azure Backup](./media/backup-azure-configure-reports/reports-data-refresh-cycle.png)

  Power BI имеет [запланированное обновление один раз в день](https://powerbi.microsoft.com/documentation/powerbi-refresh-data/#what-can-be-refreshed). Вы можете вручную обновить данные в Power BI для пакета содержимого.

3. **Как долго можно хранить отчеты?** 

   При настройке учетной записи хранения можно выбрать срок хранения данных отчетов (с помощью шага 6 в разделе настройки учетной записи хранения для отчетов выше). Кроме того, можно [анализировать отчеты в Excel](https://powerbi.microsoft.com/documentation/powerbi-service-analyze-in-excel/) и сохранять их на более длительный период удержания в соответствии со своими потребностями. 

4. **Можно ли увидеть все свои данные в отчетах после настройки учетной записи хранения?**

   Все данные, созданные после **настройки учетной записи хранения**, будут принудительно отправлены в учетную запись хранения и будут доступны в отчетах. Однако, **выполняющиеся задания не отправляются** в отчеты. Они будут отправлены после завершения или сбоя.

5. **Если учетная запись хранения уже настроена для отчетов, можно ли изменить конфигурацию, чтобы использовать другую учетную запись хранения?** 

   Да, вы можете изменить конфигурацию, чтобы указать другую учетную запись хранения. Необходимо использовать новую настроенную учетную запись хранения при подключении к пакету содержимого службы Azure Backup. Кроме того, после настройки другой учетной записи хранения в нее будут отправляться новые данные. Однако более старые данные (до изменения конфигурации) будут оставаться в старой учетной записи хранения.

6. **Можно ли просмотреть отчеты по всем хранилищам и подпискам?** 

   Да, можно настроить одну и ту же учетную запись хранения для всех хранилищ, чтобы просматривать отчеты по нескольким хранилищам. Кроме того, можно настроить ту же учетную запись хранения для хранилищ между подписками. Затем эту учетную запись хранения можно использовать при подключении к пакету содержимого службы Azure Backup в Power BI для просмотра отчетов. Однако, выбранная учетная запись хранения должна находиться в том же регионе, что и хранилище служб восстановления.
   
## <a name="troubleshooting-errors"></a>Устранение ошибок
| Сведения об ошибке | Способы устранения: |
| --- | --- |
| После настройки учетной записи хранения для отчетов по резервному копированию для параметра **Учетная запись хранения** по-прежнему отображается значение **Не настроено**. | Если вы успешно настроили учетную запись хранения, данные отчетов будут поступать, несмотря на эту проблему. Чтобы устранить эту проблему, перейдите на портал Azure и последовательно выберите "Все службы" > "Параметры диагностики" > "RS vault" (Хранилище RS) > "Настройка параметра". Удалите настроенный ранее параметр и создайте новый параметр в той же колонке. На этот раз в поле **Имя** укажите значение **service**. Теперь настроенная учетная запись хранения должна отобразиться. |
|После импорта пакета содержимого Azure Backup в Power BI возникает ошибка **404 — контейнер не найден**. | Как рекомендуется в этом документе, необходимо подождать 24 часа после настройки отчетов в хранилище служб восстановления, чтобы они правильно отображались в Power BI. При попытке обратиться к этим отчетам до того, как пройдут 24 часа, возникнет эта ошибка, так как будут отсутствовать полные данные для просмотра действительных отчетов. |

## <a name="next-steps"></a>Дополнительная информация
Теперь, когда вы настроили учетную запись хранения и импортировали пакет содержимого службы Azure Backup, нужно настроить эти отчеты и использовать модель данных отчетов для создания отчетов. Дополнительные сведения см. в следующих статьях.

* [Using Azure Backup reporting data model](backup-azure-reports-data-model.md) (Использование модели данных отчетов службы Azure Backup)
* [О фильтрах и выделении в отчетах Power BI](https://powerbi.microsoft.com/documentation/powerbi-service-about-filters-and-highlighting-in-reports/)
* [Создание отчета Power BI путем импорта набора данных](https://powerbi.microsoft.com/documentation/powerbi-service-create-a-new-report/)

