---
title: Часто задаваемые вопросы о Центрах уведомлений Azure | Документация Майкрософт
description: Часто задаваемые вопросы по разработке и реализации решений в концентраторах уведомлений
services: notification-hubs
documentationcenter: mobile
author: dimazaid
manager: kpiteira
editor: spelluru
keywords: отправка push-уведомлений, push-уведомления, push-уведомления iOS, push-уведомления android, push-уведомления ios, push-уведомления android
ms.assetid: 7b385713-ef3b-4f01-8b1f-ffe3690bbd40
ms.service: notification-hubs
ms.workload: mobile
ms.tgt_pltfrm: mobile-multiple
ms.devlang: multiple
ms.topic: article
ms.date: 04/14/2018
ms.author: dimazaid
ms.openlocfilehash: fbdb52b1b2dee682021fd822d584551f41f723ff
ms.sourcegitcommit: e221d1a2e0fb245610a6dd886e7e74c362f06467
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2018
ms.locfileid: "33778517"
---
# <a name="push-notifications-with-azure-notification-hubs-frequently-asked-questions"></a>Часто задаваемые вопросы об отправке push-уведомлений с помощью Центров уведомлений Azure
## <a name="general"></a>Общие сведения
### <a name="what-is-the-resource-structure-of-notification-hubs"></a>Какую структуру ресурсов используют Центры уведомлений?

Центры уведомлений Azure имеют два уровня ресурсов — это узлы и пространства имен. Узел — это отдельный ресурс для отправки, который содержит сведения об операциях отправки между платформами для одного приложения. Пространство имен содержит несколько узлов одного региона.

Мы советуем сопоставлять одно пространство имен с одним приложением. В пространство имен можно включить рабочий центр, который работает с основным приложением, тестовый центр для работы с тестовым приложением и т. д.

### <a name="what-is-the-price-model-for-notification-hubs"></a>Как определяется цена на концентраторы уведомлений?
Последние сведения о тарифах можно найти на странице [цен на Центры уведомлений]. Счета за Центры уведомлений выставляются на уровне пространства имен (определение пространства имен дано в разделе "Какую структуру ресурсов используют Центры уведомлений?"). Центры уведомлений поддерживают три ценовые категории:

* Уровень **Бесплатный**. Это хороший выбор для изучения возможностей отправки, но мы не советуем использовать его для рабочих приложений. На каждое пространство имен поддерживается до 500 устройств и до 1 млн уведомлений в месяц без соглашений об уровне обслуживания.
* **Базовый**. Для небольших рабочих приложений можно выбрать этот уровень или уровень "Стандартный". На каждое пространство имен поддерживается до 200 тысяч устройств и до 10 млн операций отправки в месяц в качестве базового тарифа. Кроме того, предусмотрены возможности для увеличения квот.
* Уровень **Стандартный**. Рекомендуемый вариант для средних и крупных рабочих приложений. На каждое пространство имен поддерживается до 10 млн устройств и до 10 млн операций отправки в месяц в качестве базового тарифа. Также предусмотрены возможности для увеличения квот и предоставляются широкие возможности для телеметрии.

Возможности уровня "Стандартный":
* **Расширенная телеметрия.** Центры уведомлений предоставляют телеметрию по каждому сообщению, которая позволяет отслеживать push-запросы и информацию о системе отправки уведомлений платформы для отладки.
* **Многопользовательский режим.** Вы можете управлять учетными данными для системы отправки уведомлений платформы на уровне пространства имен. Эта возможность позволяет легко распределять между клиентами узлы в одном пространстве имен.
* **Запланированная отправка**. Вы можете запланировать отправку уведомлений в любое время.

### <a name="what-is-the-notification-hubs-sla"></a>Что такое соглашение об уровне обслуживания для концентраторов уведомлений?
Для уровней Центров уведомлений "Базовый" и "Стандартный" мы гарантируем, что как минимум 99,9 % времени правильно настроенные приложения смогут отправлять push-уведомления или выполнять операции управления регистрацией. Дополнительные сведения о соглашении об уровне обслуживания Центров уведомлений см. на [этой странице](https://azure.microsoft.com/support/legal/sla/notification-hubs/).

> [!NOTE]
> Так как push-уведомления зависят от систем отправки уведомлений платформы сторонних поставщиков (например, Apple APNS и Google FCM), в соглашениях об уровне обслуживания не предусмотрено никаких гарантий по доставке этих сообщений. После того как Центр уведомлений передаст пакеты системам отправки уведомлений платформы (с поддержкой соглашений об уровне обслуживания), непосредственная доставка push-уведомлений возлагается на эти системы (без поддержки соглашений об уровне обслуживания).

### <a name="which-customers-are-using-notification-hubs"></a>Какие клиенты используют концентраторы уведомлений
Центры уведомлений использует множество клиентов. Далее перечислены несколько самых значимых из них:

* Sochi 2014 — сотни групп интересов, более 3 миллионов устройств, более 150 миллионов уведомлений, отправленных за 2 недели ([анализ примера — Sochi]);
* Skanska — [анализ примера: Skanska];
* Seattle Times — [анализ примера: Seattle Times];
* Mural.ly — [анализ примера: Mural.ly];
* 7Digital — [анализ примера: 7Digital];
* приложения Bing — десятки миллионов устройств, отправляющих 3 миллиона уведомлений ежедневно.

### <a name="how-do-i-upgrade-or-downgrade-my-hub-or-namespace-to-a-different-tier"></a>Как мне повысить или понизить уровень для узла или пространства имен?
Перейдите на **[портал Azure ]** > **Notification Hubs Namespaces** (Пространства имен Центров уведомлений) или **Центры уведомлений**. Выберите ресурс, который требуется обновить, и перейдите на **страницу цен**. Обратите внимание на следующие требования:

* Новая ценовая категория будет применяться ко *всем* узлам в пространстве имен, с которыми вы работаете.
* Если при снижении уровня будет превышен лимит на число устройств, установленный для нового уровня, такое изменение вступит в силу только тогда, когда вы удалите все лишние устройства.


## <a name="design-and-development"></a>Проектирование и разработка
### <a name="which-server-side-platforms-do-you-support"></a>Какие платформы на стороне сервера вы поддерживаете?
Серверные пакеты SDK доступны для .NET, Java, Node.js, PHP и Python. API Центров уведомлений основан на интерфейсах REST, поэтому вы можете работать непосредственно с REST API. Это удобно, если вы используете сразу несколько платформ или хотите избежать дополнительных зависимостей. Дополнительные сведения см. на странице [Отправка push-уведомлений с помощью центров уведомлений Azure в iOS].

### <a name="which-client-platforms-do-you-support"></a>Какие клиентские платформы вы поддерживаете?
Push-уведомления поддерживаются на платформах [iOS](notification-hubs-ios-apple-push-notification-apns-get-started.md), [Android](notification-hubs-android-push-notification-google-gcm-get-started.md), [Windows Universal](notification-hubs-windows-store-dotnet-get-started-wns-push-notification.md), [Windows Phone](notification-hubs-windows-mobile-push-notifications-mpns.md), [Kindle](notification-hubs-kindle-amazon-adm-push-notification.md), [Android China (через Baidu)](notification-hubs-baidu-china-android-notifications-get-started.md), Xamarin ([iOS](xamarin-notification-hubs-ios-push-notification-apns-get-started.md) и [Android](xamarin-notification-hubs-push-notifications-android-gcm.md)), [приложения Chrome](notification-hubs-chrome-push-notifications-get-started.md) и [Safari](https://github.com/Azure/azure-notificationhubs-samples/tree/master/PushToSafari). Дополнительные сведения см. на странице [Отправка push-уведомлений с помощью центров уведомлений Azure в iOS].

### <a name="do-you-support-text-message-email-or-web-notifications"></a>Поддерживаются ли уведомления по SMS и электронной почте, а также веб-уведомления?
Центы уведомлений в первую очередь созданы для отправки уведомлений в мобильные приложения и не поддерживают отправку электронных писем или текстовых сообщений. Но с помощью [мобильных приложений] вы можете интегрировать сторонние платформы, которые предоставляют такие возможности, с Центрами уведомлений, отправляющими системные push-уведомления.

Кроме того, Центры уведомлений также не предоставляют возможность отправки push-уведомлений в браузере по умолчанию. Клиенты могут внедрить эту функцию с помощью SignalR на базе поддерживаемых серверных платформ. Если вы хотите отправлять уведомления в приложения браузера в "песочнице" Chrome, ознакомьтесь со статьей [Отправка push-уведомлений в приложения Chrome с помощью Центров уведомлений Azure].

### <a name="how-are-mobile-apps-and-azure-notification-hubs-related-and-when-do-i-use-them"></a>Как связаны мобильные приложения и Центры уведомлений Azure, и в каких случаях их нужно использовать?
Если у вас есть серверная часть мобильного приложения и вам требуется добавить только возможность для отправки push-уведомлений, используйте для этого Центры уведомлений Azure. Если вам требуется настроить серверную часть мобильного приложения с нуля, следует использовать компонент мобильных приложений службы приложений Azure. Мобильные приложения автоматически подготавливают Центр уведомлений, чтобы вы могли легко отправлять push-уведомления из серверной части мобильного приложения. Цена за использование мобильных приложений включает базовую стоимость использования Центра уведомлений. Вы платите только при превышении количества отправляемых push-уведомлений. Дополнительные сведения о стоимости см. на странице [с ценами на службу приложений].

### <a name="how-many-devices-can-i-support-if-i-send-push-notifications-via-notification-hubs"></a>Сколько устройств может поддерживаться при отправке push-уведомлений через концентраторы уведомлений?
Сведения о поддерживаемых устройствах см. на странице с [цен на Центры уведомлений].

Если необходима поддержка более 10 млн зарегистрированных устройств, [свяжитесь с нами](https://azure.microsoft.com/overview/contact-us/) напрямую и мы поможем вам расширить решение.

### <a name="how-many-push-notifications-can-i-send-out"></a>Сколько push-уведомлений я могу отправить?
В зависимости от выбранной категории Центры уведомлений Azure автоматически выполняют масштабирование на основе количества уведомлений, проходящих через систему.

> [!NOTE]
> Цены зависят от количества доставленных push-уведомлений. Ознакомьтесь с ограничениями для категорий на странице [цен на Центры уведомлений].
> 
> 

Наши клиенты отправляют миллионы push-уведомлений в день с помощью Центров уведомлений. Пока вы используете Центры уведомлений Azure, вам не нужно предпринимать специальные действия для масштабирования решения по отправке push-уведомлений.

### <a name="how-long-does-it-take-for-sent-push-notifications-to-reach-my-device"></a>Как скоро push-уведомления доставляются на мое устройство?
При обычном использовании с более или менее согласованной входящей нагрузкой даже Центры уведомлений Azure могут обрабатывать по крайней мере *1 миллион отправленных push-уведомлений в минуту*. Такая скорость может меняться в зависимости от количества тегов, характера входящих данных и других внешних факторов.

В течение предполагаемого времени доставки служба подсчитывает целевые объекты для соответствующей платформы и направляет сообщения службам push-уведомлений (PNS) на основе зарегистрированных тегов или выражений тегов. Службы PNS отвечают за отправку уведомлений на устройство.

Они не предоставляют никаких гарантий по доставке уведомлений, предусмотренных соглашением об уровне обслуживания. Однако подавляющая часть рush-уведомлений доставляется на устройства в течение нескольких минут (как правило, в диапазоне 10 минут) с момента их отправки в Центры уведомлений. Для отправки нескольких уведомлений может потребоваться больше времени.

> [!NOTE]
> Кроме того, в Центрах уведомлений Azure предусмотрена политика для удаления любых рush-уведомлений, которые не были доставлены в PNS в течение 30 минут. Эта задержка может произойти по ряду причин, чаще всего потому, что служба PNS регулирует работу приложения.
> 
> 

### <a name="is-there-any-latency-guarantee"></a>Предоставляются ли какие-либо гарантии по задержкам?
Из-за характера доставки push-уведомлений (они доставляются внешней службой PNS для определенной платформы) гарантии по задержкам не предоставляются. Как правило, большая часть рush-уведомлений доставляется в течение нескольких минут.

### <a name="what-do-i-need-to-consider-when-designing-a-solution-with-namespaces-and-notification-hubs"></a>Что следует учитывать при разработке решения в пространствах имен и Центрах уведомлений?
#### <a name="mobile-appenvironment"></a>Мобильное приложение и среда
* Используйте один Центр уведомлений для мобильного приложения в среде.
* В мультитенантном сценарии для каждого клиента должен быть отдельный Центр.
* Никогда не используйте один и тот же Центр уведомлений в тестовой и рабочей средах, так как это может вызвать проблемы при отправке уведомлений. (Apple предлагает конечные точки Sandbox и Production Push с отдельными учетными данными для каждой из них.)
* По умолчанию тестовые уведомления можно отправлять на зарегистрированные устройства с портала Azure или с помощью интегрированного компонента Azure в Visual Studio. Существует пороговое значение в 10 устройств, которые случайным образом выбираются из пула регистрации.

> [!NOTE]
> Если для Центра был изначально настроен сертификат "песочницы" Apple, а затем — сертификат рабочей среды Apple, исходные маркеры устройств станут недействительными, что может привести к сбою отправки push-уведомлений. Используйте рабочую и тестовую среду по отдельности и разные Центры для разных сред.
> 
> 

#### <a name="pns-credentials"></a>Учетные данные PNS
При регистрации мобильного приложения на портале разработчиков платформы (например, Apple или Google) вы получаете идентификатор приложения и маркеры безопасности. Серверная часть приложения предоставляет эти маркеры службам PNS, чтобы они могли отправлять push-уведомления на устройства. Маркеры безопасности могут быть представлены в виде сертификатов (например, Apple iOS или Windows Phone) или ключей безопасности (например, Google Android или Windows). Их требуется настроить в Центрах уведомлений. Как правило, настройка осуществляется на уровне Центров уведомлений, а также на уровне пространства имен в мультитенантном сценарии.

#### <a name="namespaces"></a>Пространства имен
Пространства имен могут также использоваться для группирования развертываний. Кроме того, с их помощью можно представить все Центры уведомлений для всех клиентов одного приложения в мультитенантном сценарии.

#### <a name="geo-distribution"></a>Географическое распределение
Географическое распределение не всегда является критически важным для push-уведомлений. Различные службы PNS (например, APNS или GCM), которые доставляют push-уведомления на устройства, распределены неравномерно.

Однако при наличии приложения, которое используется глобально, вы можете создать Центры в разных пространствах имен с помощью службы Центров уведомлений в разных регионах Azure по всему миру.

> [!NOTE]
> Мы не рекомендуем использовать этот подход, так как это приведет к увеличению затрат на управление, в частности на регистрацию. Используйте этот подход только в случае крайней необходимости.
> 
> 

### <a name="should-i-do-registrations-from-the-app-back-end-or-directly-through-client-devices"></a>Где следует выполнять регистрацию: в серверной части приложения или непосредственно на клиентских устройствах?
Выполняйте регистрацию в серверной части приложения в тех случаях, когда необходимо выполнить проверку подлинности клиента перед созданием регистрации или при наличии тегов, которые должны быть созданы и изменены серверной частью приложения на основе определенной логики приложения. Дополнительные сведения см. в статьях [Регистрация из внутренней службы приложения] и [Управление регистрацией].

### <a name="what-is-the-push-notification-delivery-security-model"></a>Какая модель безопасности доставки push-уведомлений используется?
Центры уведомлений Azure используют модель безопасности на основе [подписанного URL-адреса](../storage/common/storage-dotnet-shared-access-signature-part-1.md). Маркеры подписанного URL-адреса можно использовать на уровне корневого пространства имен или на детализированном уровне Центров уведомлений. Для этих маркеров подписанного URL-адреса можно задать различные правила авторизации, например разрешения для отправки сообщений или прослушивания уведомлений. Дополнительные сведения см. в документе о [модели безопасности Центров уведомлений].

### <a name="how-should-i-handle-sensitive-payload-in-push-notifications"></a>Как обрабатываются конфиденциальные полезные данные в push-уведомлениях?
Все уведомления доставляются на целевые устройства службами PNS платформы. При отправке уведомления в Центр уведомлений Azure оно обрабатывается и передается в соответствующую службу PNS.

Передача уведомлений от отправителя в Центры уведомлений Azure и в службу PNS осуществляется по протоколу HTTPS.

> [!NOTE]
> Центры уведомлений Azure никак не регистрируют полезные данные сообщений.
> 
> 

Для отправки конфиденциальных полезных данных мы советуем использовать шаблон безопасных push-уведомлений. Отправитель посылает уведомление для проверки связи с идентификатором сообщения на устройство без конфиденциальных полезных данных. Когда приложение на устройстве получает эти полезные данные, оно может напрямую вызвать безопасный API, чтобы получить информацию о сообщении. Руководство по реализации этой схемы см. на странице [Безопасные push-уведомления посредством центров уведомлений Azure].

## <a name="operations"></a>Операции
### <a name="what-support-is-provided-for-disaster-recovery"></a>Какая поддержка предоставляется для аварийного восстановления?
Мы предоставляем аварийное восстановление метаданных со своей стороны (имя Центра уведомлений, строка подключения и другие важные данные). В случае аварийного восстановления данные регистрации являются *единственным утерянным сегментом* инфраструктуры Центров уведомлений. Поэтому вам потребуется способ, позволяющий повторно заполнить новый Центр этими данными после восстановления.

1. Создайте дополнительный Центр уведомлений в другом центре обработки данных. Мы советуем создать его с самого начала, так как это позволит предотвратить влияние на возможности управления в случае аварийного восстановления. Его можно создать непосредственно при аварийном восстановлении.

2. Заполните дополнительный Центр уведомлений данными регистрации из основного Центра уведомлений. Мы не рекомендуем хранить регистрации в обоих центрах или мгновенно синхронизировать их по мере поступления, так как это приводит к негативным последствиям из-за специфического характера регистраций, срок действия которых истекает в зависимости от службы PNS. Центры уведомлений удаляют их по мере получения отзывов службы PNS о регистрациях с истекшим сроком действия или недействительных регистрациях.  

Существует две рекомендации для использования серверной части приложения:

* Используйте серверную часть приложения, которая хранит заданный набор регистраций со своей стороны, а затем выполняет массовою вставку в дополнительный Центр уведомлений.

* Или используйте серверную часть приложения, которая получает регулярный дамп регистраций из основного Центра уведомлений в качестве резервной копии, а затем выполняет массовою вставку в дополнительный Центр уведомлений.

> [!NOTE]
> Функции экспорта и импорта регистраций, доступные для уровня "Стандартный", описаны в документе [Практическое руководство. Массовый экспорт и изменение регистраций].
> 
> 

Если у вас нет серверной части, при запуске приложений на устройствах они создадут новую регистрацию в дополнительном Центре уведомлений. В конечном итоге этот Центр уведомлений зарегистрирует все активные устройства.

В течение определенного периода времени устройства, на которых не открыты приложения, не будут получать уведомления.

### <a name="is-there-audit-log-capability"></a>Предусмотрена ли возможность ведения журнала аудита?
Все операции по управлению Центрами уведомлений регистрируются в журналах операций, которые представлены на [портал Azure ].

## <a name="monitoring-and-troubleshooting"></a>Мониторинг и устранение неполадок
### <a name="what-troubleshooting-capabilities-are-available"></a>Какие возможности для устранения неполадок доступны?
Центры уведомлений Azure предоставляют несколько функциональных возможностей для устранения неполадок, особенно в наиболее распространенном случае удаления уведомлений. Дополнительные сведения см. в техническом документе [Центры уведомлений Azure — рекомендации по диагностике].

### <a name="what-telemetry-features-are-available"></a>Какие телеметрические функции доступны?
Центры уведомлений Microsoft Azure позволяют просматривать данные телеметрии на [портал Azure ]. Дополнительные сведения о доступных метриках в Центрах уведомлений см. на [этой странице].

> [!NOTE]
> Успешная доставка уведомлений означает только то, что push-уведомления доставлены во внешнюю службу PNS (например, APNS для Apple или GCM для Google). Службы PNS отвечают за доставку уведомлений на целевые устройства. Как правило, служба PNS не предоставляет метрики доставки третьим лицам.  
> 
> 

Центры уведомлений также предоставляют возможность экспортировать данные телеметрии программным путем (на уровне "Стандартный"). Дополнительные сведения см. в статье [Fetch Notification Hubs Telemetry Programmatically] (Получение данных телеметрии Центров уведомлений программным путем).

[портал Azure ]: https://portal.azure.com
[цен на Центры уведомлений]: http://azure.microsoft.com/pricing/details/notification-hubs/
[Notification Hubs SLA]: http://azure.microsoft.com/support/legal/sla/
[Анализ примера — Sochi]: https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=7942
[анализ примера: Skanska]: https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=5847
[анализ примера: Seattle Times]: https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=8354
[анализ примера: Mural.ly]: https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=11592
[анализ примера: 7Digital]: https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=3684
[Отправка push-уведомлений с помощью центров уведомлений Azure в iOS]: https://msdn.microsoft.com/library/azure/dn530746.aspx
[Отправка push-уведомлений с помощью центров уведомлений Azure в iOS]: http://azure.microsoft.com/documentation/articles/notification-hubs-ios-get-started/
[Отправка push-уведомлений в приложения Chrome с помощью Центров уведомлений Azure]: http://azure.microsoft.com/documentation/articles/notification-hubs-chrome-get-started/
[Mobile Services Pricing]: http://azure.microsoft.com/pricing/details/mobile-services/
[Регистрация из внутренней службы приложения]: https://msdn.microsoft.com/library/azure/dn743807.aspx
[Управление регистрацией]: https://msdn.microsoft.com/library/azure/dn530747.aspx
[модели безопасности Центров уведомлений]: https://msdn.microsoft.com/library/azure/dn495373.aspx
[Безопасные push-уведомления посредством центров уведомлений Azure]: http://azure.microsoft.com/documentation/articles/notification-hubs-aspnet-backend-ios-secure-push/
[Центры уведомлений Azure — рекомендации по диагностике]: http://azure.microsoft.com/documentation/articles/notification-hubs-diagnosing/
[этой странице]: https://msdn.microsoft.com/library/dn458822.aspx
[Fetch Notification Hubs Telemetry Programmatically]: https://github.com/Azure/azure-notificationhubs-samples/tree/master/FetchNHTelemetryInExcel (Получение данных телеметрии Центров уведомлений программным путем)
[Практическое руководство. Массовый экспорт и изменение регистраций]: https://msdn.microsoft.com/library/dn790624.aspx
[портал Azure]: https://portal.azure.com
[complete samples]: https://github.com/Azure/azure-notificationhubs-samples
[мобильных приложений]: https://azure.microsoft.com/services/app-service/mobile/
[с ценами на службу приложений]: https://azure.microsoft.com/pricing/details/app-service/
