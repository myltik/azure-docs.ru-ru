---
title: Шаблоны
description: В этом разделе описываются шаблоны для центров уведомлений Azure.
services: notification-hubs
documentationcenter: .net
author: dimazaid
manager: kpiteira
editor: spelluru
ms.assetid: a41897bb-5b4b-48b2-bfd5-2e3c65edc37e
ms.service: notification-hubs
ms.workload: mobile
ms.tgt_pltfrm: mobile-multiple
ms.devlang: multiple
ms.topic: article
ms.date: 04/14/2018
ms.author: dimazaid
ms.openlocfilehash: 3e587bdf0efc7c5b416183640abb19286a5cff31
ms.sourcegitcommit: e221d1a2e0fb245610a6dd886e7e74c362f06467
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2018
ms.locfileid: "33776657"
---
# <a name="templates"></a>Шаблоны
## <a name="overview"></a>Обзор
Шаблоны позволяют клиентскому приложению определять точный формат уведомлений, которые оно будет получать. С помощью шаблонов приложение получает несколько преимуществ, включая следующие:

* Серверная часть, не зависящая от платформы
* Персонализированные уведомления
* Независимость от версии клиента
* Простая локализация

В этом разделе приводится два подробных примера использования шаблонов для отправки платформонезависимых уведомлений, предназначенных для всех устройств на разных платформах, и для персонализации широковещательного уведомления для каждого устройства.

## <a name="using-templates-cross-platform"></a>Использование шаблонов для разных платформ
Стандартный способ отправки push-уведомлений заключается в отправке полезных данных в службу уведомлений платформы (WNS, APNS) для каждого уведомления. Например, для отправки предупреждения службе APNS полезными данными будет объект JSON следующего вида:

    {"aps": {"alert" : "Hello!" }}

Для отправки аналогичного всплывающего сообщения в приложении Магазина Windows полезными данными XML будет:

    <toast>
      <visual>
        <binding template=\"ToastText01\">
          <text id=\"1\">Hello!</text>
        </binding>
      </visual>
    </toast>

Аналогичные полезные данные можно создавать для платформ MPNS (Windows Phone) и GCM (Android).

Это требование заставляет серверную часть приложения формировать разные полезные данные для каждой платформы, а также возлагает на нее ответственность за часть уровня представления данных в приложении. К некоторым вопросам относятся локализация и графические макеты (особенно для приложений Магазина Windows, которые содержат уведомления для плиток различных типов).

Шаблон центра уведомлений позволяет клиентскому приложению создавать специальные регистрации (называются шаблонными регистрациями), которые содержат не только набор тегов, но и шаблон. Шаблон центра уведомлений позволяет клиентскому приложению связывать устройства с шаблонами, независимо от того, работаете ли вы с установкой (рекомендуется) или регистрацией. В предыдущих примерах полезных данных единственным фрагментом, не зависящим от платформы, является само сообщение "Hello!". Шаблон — это набор инструкций для центра уведомлений о форматировании платформонезависимых сообщений для регистрации конкретного клиентского приложения. В предыдущем примере платформонезависимым сообщением является одно свойство: **message = Hello!**.

На следующем рисунке показан этот процесс.

![](./media/notification-hubs-templates/notification-hubs-hello.png)

Шаблон для регистрации клиентского приложения iOS выглядит следующим образом:

    {"aps": {"alert": "$(message)"}}

Соответствующий шаблон для клиентского приложения Магазина Windows:

    <toast>
        <visual>
            <binding template=\"ToastText01\">
                <text id=\"1\">$(message)</text>
            </binding>
        </visual>
    </toast>

Обратите внимание, что фактическое сообщение меняется на выражение $(message). Это выражение предписывает центру уведомлений всякий раз, когда он отправляет сообщение для данной регистрации, создавать сообщение в соответствии с этим выражением и параметрами из общего значения.

При работе с установками ключ "шаблона" установки содержит объект JSON для нескольких шаблонов. При работе с регистрациями клиентское приложение может создавать несколько регистраций для использования нескольких шаблонов. Например, шаблон для предупреждений и шаблон для обновления плиток. Клиентские приложения также могут использовать комбинацию собственных регистраций (регистраций без шаблона) и регистраций с шаблонами.

Центр уведомлений отправляет одно уведомление для каждого шаблона, не учитывая, принадлежат ли они одному клиентскому приложению. Это поведение может использоваться для преобразования платформонезависимых уведомлений в серию уведомлений. Например, одно платформонезависимое сообщение для центра уведомлений может быть автоматически преобразовано во всплывающее предупреждение и обновление элемента, не требуя участия серверной части. Некоторые платформы (например, iOS) могут сворачивать несколько уведомлений для одного устройства, если они отправляются в течение короткого периода времени.

## <a name="using-templates-for-personalization"></a>Использование шаблонов для персонализации
Еще одним преимуществом использования шаблонов является возможность использования центров уведомлений для персонализации уведомлений по отдельным регистрациям. Например, рассмотрим погодное приложение, которое отображает плитку с погодными условиями в определенном месте. Пользователь может выбрать между отображением градусов Цельсия или Фаренгейта и прогноз на один или на пять дней. С помощью шаблонов каждая установка клиентского приложения может зарегистрировать необходимый для себя формат (1 день и шкала Цельсия, 1 день и шкала Фаренгейта, 5 дней и шкала Цельсия, 5 дней и шкала Фаренгейта), а его серверная часть будет отправлять одно сообщение со всеми данными, необходимыми для заполнения шаблонов (например, пятидневный прогноз с градусами Цельсия и Фаренгейта).

Шаблон для прогноза погоды на один день и шкалой Цельсия выглядит следующим образом:

    <tile>
      <visual>
        <binding template="TileWideSmallImageAndText04">
          <image id="1" src="$(day1_image)" alt="alt text"/>
          <text id="1">Seattle, WA</text>
          <text id="2">$(day1_tempC)</text>
        </binding>  
      </visual>
    </tile>

Сообщение, отправляемое в центр уведомлений, содержит следующие свойства:

<table border="1">

<tr><td>day1_image</td><td>day2_image</td><td>day3_image</td><td>day4_image</td><td>day5_image</td></tr>

<tr><td>day1_tempC</td><td>day2_tempC</td><td>day3_tempC</td><td>day4_tempC</td><td>day5_tempC</td></tr>

<tr><td>day1_tempF</td><td>day2_tempF</td><td>day3_tempF</td><td>day4_tempF</td><td>day5_tempF</td></tr>
</table><br/>

С помощью этого шаблона серверная часть отправляет только одно сообщение без необходимости хранить персональные параметры для пользователей приложения. На следующем рисунке показана схема работы.

![](./media/notification-hubs-templates/notification-hubs-registration-specific.png)

## <a name="how-to-register-templates"></a>Регистрация шаблонов
Регистрация шаблонов с помощью механизма установок (рекомендуется) или регистраций описывается в статье [Управления регистрацией](notification-hubs-push-notification-registration-management.md).

## <a name="template-expression-language"></a>Язык выражений шаблонов
В шаблоны можно использовать только форматы документов XML или JSON. Кроме того, выражения можно размещать только в определенных местах. Например, атрибуты узла или значения для XML и значения строковых свойств для JSON.

В следующей таблице показан синтаксис, используемый в шаблонах:

| Выражение | ОПИСАНИЕ |
| --- | --- |
| $(prop) |Ссылка на свойство события с заданным именем. В именах свойств регистр не учитывается. Значением этого выражения является текстовое значение свойства или пустая строка, если свойство не существует. |
| $(prop, n) |То же, что выше, но текст обрезается до n символов, например, выражение $(title, 20) сокращает содержимое свойства title до 20 символов. |
| .(prop, n) |То же, что выше, но к тексту добавляются три точки, поскольку он является сокращенным. Общий размер сокращенной строки и суффикса не превышает n символов. (title, 20) с исходным свойством "Это строка заголовка" превращается в **Это строка заголо...** |
| %(prop) |Аналогично $(name), за исключением того, что выходные данные имеют формат URI. |
| #(prop) |Используется в шаблонах JSON (например, для шаблонов iOS и Android).<br><br>Это выражение работает так же, как $(prop), указанное выше, за исключением случаев использования в шаблонах JSON (например, в шаблонах Apple). В этом случае, если функция не заключена в "{‘,’}" (например, ‘myJsonProperty’ : ‘#(name)’) и имеет значением число в формате Javascript, например регулярное выражение (0&#124;(&#91;1-9&#93;&#91;0-9&#93;*))(\.&#91;0-9&#93;+)?((e&#124;E)(+&#124;-)?&#91;0-9&#93;+)?, то результат JSON является числом.<br><br>Например, ‘badge : ‘#(name)’ становится ‘badge’ : 40 (а не ‘40‘). |
| ‘text’ или “text” |Литерал. Литералы содержат произвольный текст, заключенный в одинарные или двойные кавычки. |
| expr1 + expr2 |Оператор объединения, объединяющий два выражения в одну строку. |

Выражения могут быть любого из перечисленных выше видов.

При использовании конкатенации все выражение должно быть заключено в {}. Например, {$(prop) + ‘ - ’ + $(prop2)}. |

Например, ниже представлен недопустимый шаблон XML.

    <tile>
      <visual>
        <binding $(property)>
          <text id="1">Seattle, WA</text>
        </binding>  
      </visual>
    </tile>


Как было сказано ранее, при использовании конкатенации выражения должны быть заключены в квадратные скобки. Например: 

    <tile>
      <visual>
        <binding template="ToastText01">
          <text id="1">{'Hi, ' + $(name)}</text>
        </binding>  
      </visual>
    </tile>

