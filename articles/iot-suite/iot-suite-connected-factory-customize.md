---
title: "Настройка подключенной фабрики Azure IoT Suite | Документация Майкрософт"
description: "Описание настройки поведения предварительно настроенного решения подключенной фабрики."
services: 
suite: iot-suite
documentationcenter: 
author: dominicbetts
manager: timlt
editor: 
ms.assetid: 
ms.service: iot-suite
ms.devlang: c#
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/04/2017
ms.author: dobett
ms.translationtype: Human Translation
ms.sourcegitcommit: 09f24fa2b55d298cfbbf3de71334de579fbf2ecd
ms.openlocfilehash: ec4b2808e6984821200be182183e53b69887b912
ms.contentlocale: ru-ru
ms.lasthandoff: 06/07/2017


---
# <a name="customize-how-the-connected-factory-solution-displays-data-from-your-opc-ua-servers"></a>Настройка отображения данных серверов на основе унифицированной архитектуры OPC решением подключенной фабрики

## <a name="introduction"></a>Введение

Решение подключенной фабрики агрегирует и отображает данные с серверов OPC UA, подключенных к решению. В решении можно просматривать и отправлять команды на серверы OPC UA. Дополнительные сведения об OPC UA см. в разделе [Часто задаваемые вопросы][lnk-faq].

Примеры агрегированных данных в решении включают общую эффективность оборудования (OEE) и ключевые показатели эффективности (KPI), которые можно просмотреть на панели мониторинга на уровне станции, линии и фабрики. На следующем рисунке показаны значения OEE и KPI для станции **сборки** на **производственной линии 1** фабрики в **Мюнхене**:

![Пример значений OEE и KPI в решении][img-oee-kpi]

Решение позволяет просматривать подробные сведения об определенных элементах данных с серверов OPC UA, называемых *станциями*. На следующем рисунке показаны графики количества произведенных элементов на конкретной станции:

![Графики количества произведенных элементов][img-manufactured-items]

Если выбрать один из графиков, можно просмотреть более подробные данные с помощью Time Series Insights (TSI):

![Просмотр данных с помощью Time Series Insights][img-tsi]

Содержание статьи

- Доступность данных для различных представлений в решении.
- Настройка способа отображения данных в решении.

## <a name="data-sources"></a>Источники данных

Решение подключенной фабрики отображает данные с серверов OPC UA, подключенных к решению. Установка по умолчанию содержит несколько серверов OPC UA, на которых запущено моделирование фабрики. В решение можно добавить собственные серверы OPC UA, [подключенные через шлюз][lnk-connect-cf].

На панели мониторинга можно просмотреть элементы данных, передаваемых подключенным сервером OPC UA в решение:

1. Перейдите к представлению **выбора сервера OPC UA**:

    ![Переход к представлению выбора сервера OPC UA][img-select-server]

1. Выберите сервер и нажмите кнопку **Подключить**. Щелкните **Продолжить** при появлении предупреждения системы безопасности.

    > [!NOTE]
    > Это предупреждение отображается только один раз для каждого сервера и устанавливает отношение доверия между панелью мониторинга решения и сервером.

1. Теперь можно просмотреть элементы данных, которые сервер может отправлять в решение. Элементы, которые отправляются в решение, имеют зеленый флажок:

    ![Опубликованные элементы][img-published]

1. Если вы являетесь *администратором* решения, вы можете опубликовать элемент данных, чтобы сделать его доступным в решении подключенной фабрики. Имея права администратора, можно также изменять значение элементов данных и вызывать методы на сервере OPC UA.

## <a name="map-the-data"></a>Сопоставление данных

Решение подключенной фабрики сопоставляет и объединяет опубликованные элементы данных с сервера OPC UA для различных представлений в решении. Подключенная фабрика развертывается в учетную запись Azure при подготовке решения. В решении подключенной фабрики Visual Studio сведения о сопоставлении хранятся в JSON-файле. Вы можете просматривать и изменять этот файл конфигурации JSON в решении подключенной фабрики Visual Studio и развертывать его повторно.

Файл конфигурации можно использовать для:

- изменения существующих имитаций фабрик, производственных линий и станций;
- сопоставления данных физических серверов OPC UA, подключаемых к решению.

Чтобы клонировать копию решения подключенной фабрики Visual Studio, используйте следующую команду git:

`git clone https://github.com/Azure/azure-iot-connected-factory.git`

Файл **ContosoTopologyDescription.json** определяет сопоставление элементов данных сервера OPC UA с представлениями на панели мониторинга решения подключенной фабрики. Этот файл конфигурации находится в папке **Contoso\Topology** в проекте **WebApp** Visual Studio.

Содержимое JSON-файла упорядочено в виде иерархии узлов фабрики, производственной линии и станции. Эта иерархия определяет иерархию навигации на панели мониторинга решения подключенной фабрики. Значения в каждом узле иерархии определяют сведения, отображаемые на панели мониторинга. Например, JSON-файл содержит следующие значения для фабрики в Мюнхене:

```json
"Guid": "73B534AE-7C7E-4877-B826-F1C0EA339F65",
"Name": "Munich",
"Description": "Braking system",
"Location": {
    "City": "Munich",
    "Country": "Germany",
    "Latitude": 48.13641,
    "Longitude": 11.57754
},
"Image": "munich.jpg"
```

В этом представлении на панели мониторинга отображаются имя, описание и расположение:

![Данные Мюнхена на панели мониторинга][img-munich]

Каждая фабрика, производственная линия и станция имеют свойство изображений. Эти файлы JPEG находятся в папке **Content\img** в проекте **WebApp**. Они отображаются на панели мониторинга подключенной фабрики.

Каждая станция содержит несколько подробных свойств, определяющих сопоставления на основе элементов данных OPC UA. Эти свойства описаны в следующих разделах.

### <a name="opcuri"></a>OpcUri

Значение **OpcUri** представляет собой URI приложения OPC UA, однозначно определяющий сервер OPC UA. Например, значение **OpcUri** станции сборки на производственной линии 1 в Мюнхене выглядит следующим образом: **urn:scada2194:ua:munich:productionline0:assemblystation**.

Идентификаторы URI подключенных серверов OPC UA можно просмотреть на панели мониторинга решения:

![Представление идентификаторов URI сервера OPC UA][img-server-uris]

### <a name="simulation"></a>Моделирование

Сведения в **моделируемом** узле относятся к имитации OPC UA, выполняемой на серверах OPC UA, подготавливаемых по умолчанию. Он не используется для физических серверов OPC UA.

### <a name="kpi1-and-kpi2"></a>Kpi1 и Kpi2

Эти узлы описывают, как данные, полученные от станции, добавляются к двум значениям KPI на панели мониторинга. В развертывании по умолчанию эти значения KPI являются единицами в час и расходом энергии в кВт в час. Решение вычисляет значения KPI на уровне станции и агрегирует их на уровнях фабрики и производственной линии.

Каждый показатель KPI имеет минимальное, максимальное и целевое значение. Каждое значение KPI может также определить действия оповещений для выполнения в решении подключенной фабрики. В следующем фрагменте показаны определения KPI для станции сборки на производственной линии 1 в Мюнхене.

```json
"Kpi1": {
  "Minimum": 150,
  "Target": 300,
  "Maximum": 600
},
"Kpi2": {
  "Minimum": 50,
  "Target": 100,
  "Maximum": 200,
  "MinimumAlertActions": [
    {
      "Type": "None"
    }
  ]
}
```

На следующем снимке экрана показаны данные KPI на панели мониторинга.

![Данные KPI на панели мониторинга][lnk-kpi]

### <a name="opcnodes"></a>OpcNodes

Узлы **OpcNodes** определяют опубликованные элементы данных с сервера OPC UA и указывают способ обработки данных.

Значение **NodeId** определяет конкретный NodeID унифицированной архитектуры OPC сервера OPC UA. Первый узел на станции сборки производственной линии 1 в Мюнхене имеет значение **ns=2;i=385**. Значение **NodeId** указывает элемент данных, который нужно считать с сервера OPC UA, а **SymbolicName** представляет понятное имя для этих данных, отображаемое на панели мониторинга.

В следующей таблице приведены другие значения, связанные с каждым узлом:

| Значение | Описание |
| ----- | ----------- |
| релевантности  | Значения KPI и OEE, на которые влияют эти данные. |
| OpCode     | Способ агрегирования данных. |
| Units      | Единицы измерения, используемые на панели мониторинга.  |
| Visible    | Следует ли отображать это значение на панели мониторинга. Некоторые значения используются в вычислениях, но не отображаются.  |
| Максимальная    | Максимальное значение, которое инициирует оповещение на панели мониторинга. |
| MaximumAlertActions | Действия, предпринимаемые в ответ на оповещение. Например, отправка команды на станцию. |
| ConstValue | Значение константы, используемое в вычислениях. |

## <a name="deploy-the-changes"></a>Развертывание изменений

После внесения изменений в файл **ContosoTopologyDescription.json** необходимо повторно развернуть решение подключенной фабрики в свою учетную запись Azure.

Репозиторий **azure-iot-connected-factory** содержит скрипт PowerShell **build.ps1**, который можно использовать, чтобы повторно создать и развернуть решение.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о предварительно настроенном решении подключенной фабрики см. в следующих статьях:

* [Пошаговое руководство по работе с настроенным решением для удаленного мониторинга][lnk-rm-walkthrough]
* [Развертывание шлюза для подключенной фабрики][lnk-connect-cf]
* [Разрешения на сайте azureiotsuite.com][lnk-permissions]
* [Часто задаваемые вопросы об IoT Suite][lnk-faq]


[img-oee-kpi]: ./media/iot-suite-connected-factory-customize/oeenadkpi.png
[img-manufactured-items]: ./media/iot-suite-connected-factory-customize/manufactured.png
[img-tsi]: ./media/iot-suite-connected-factory-customize/tsi.png
[img-select-server]: ./media/iot-suite-connected-factory-customize/selectserver.png
[img-published]: ./media/iot-suite-connected-factory-customize/published.png
[img-munich]: ./media/iot-suite-connected-factory-customize/munich.png
[img-server-uris]: ./media/iot-suite-connected-factory-customize/serveruris.png
[lnk-kpi]: ./media/iot-suite-connected-factory-customize/kpidisplay.png

[lnk-rm-walkthrough]: iot-suite-connected-factory-sample-walkthrough.md
[lnk-connect-cf]: iot-suite-connected-factory-gateway-deployment.md
[lnk-permissions]: iot-suite-permissions.md
[lnk-faq]: iot-suite-faq.md
