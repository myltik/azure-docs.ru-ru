---
title: Подготовка виртуального массива StorSimple в Hyper-V | Документация Майкрософт
description: Второе руководство по развертыванию виртуального массива StorSimple посвящено подготовке виртуального массива в Hyper-V.
services: storsimple
documentationcenter: NA
author: alkohli
manager: timlt
editor: ''
ms.assetid: 4354963c-e09d-41ac-9c8b-f21abeae9913
ms.service: storsimple
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 03/15/2017
ms.author: alkohli
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: bad431c8958f7d381bb9c0410caa3a57c6e75c19
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
ms.locfileid: "23111082"
---
# <a name="deploy-storsimple-virtual-array---provision-in-hyper-v"></a>Развертывание виртуального массива StorSimple — подготовка в Hyper-V
![](./media/storsimple-virtual-array-deploy2-provision-hyperv/hyperv4.png)

## <a name="overview"></a>Обзор
В этом руководстве описано, как подготовить виртуальный массив StorSimple в главной системе, в которой выполняется Hyper-V на платформе Windows Server 2012 R2, Windows Server 2012 или Windows Server 2008 R2. Сведения, приведенные в этой статье, относятся к развертыванию виртуальных массивов StorSimple на портале Azure, а также в облаке Microsoft Azure для государственных организаций.

Чтобы подготовить и настроить виртуальный массив, требуются права администратора. Подготовка и начальная настройка могут занять около 10 минут.

## <a name="provisioning-prerequisites"></a>Предварительные требования к подготовке
Ниже приведены предварительные требования для подготовки виртуального массива в главной системе, в которой выполняется Hyper-V на платформе Windows Server 2012 R2, Windows Server 2012 или Windows Server 2008 R2.

### <a name="for-the-storsimple-device-manager-service"></a>Предварительные требования для службы диспетчера устройств StorSimple
Перед тем как начать, убедитесь в следующем.

* Выполнены все инструкции из статьи [Deploy StorSimple Virtual Array — Prepare the portal](storsimple-virtual-array-deploy1-portal-prep.md).
* Образ виртуального массива для Hyper-V скачан с портала Azure. Дополнительные сведения см. в разделе **Step 3: Download the virtual array image** (Шаг 3. Скачивание образа виртуального массива) руководства по [подготовке портала к развертыванию виртуального массива StorSimple](storsimple-virtual-array-deploy1-portal-prep.md).

  > [!IMPORTANT]
  > Программное обеспечение, выполняемое на виртуальном массиве StorSimple, можно использовать только со службой диспетчера устройств StorSimple.
  >
  >

### <a name="for-the-storsimple-virtual-array"></a>Предварительные требования для виртуального массива StorSimple
Перед развертыванием виртуального массива выполните указанные ниже условия.

* У вас должен быть доступ к главной системе, в которой выполняется Hyper-V на платформе Windows Server 2008 R2 или более поздней версии, которую можно использовать для подготовки устройства.
* Главная система должна быть в состоянии выделить указанный ниже объем ресурсов для подготовки виртуального массива.

  * Не менее 4 ядер.
  * Не менее 8 ГБ ОЗУ. Если планируется настроить виртуальный массив как файловый сервер, то 8 ГБ ОЗУ обеспечат поддержку до 2 млн файлов. Для поддержки 2–4 млн файлов потребуется 16 ГБ ОЗУ.
  * Один сетевой интерфейс.
  * Виртуальный диск данных размером 500 ГБ.

### <a name="for-the-network-in-the-datacenter"></a>Сеть в центре обработки данных
Перед началом работы изучите сетевые требования для развертывания виртуального массива StorSimple и соответствующим образом настройте сеть центра обработки данных. Дополнительные сведения см. в разделе [Требования к сети](storsimple-ova-system-requirements.md#networking-requirements).

## <a name="step-by-step-provisioning"></a>Пошаговая подготовка
Чтобы подготовить виртуальный массив и подключиться к нему, сделайте следующее:

1. Убедитесь, что главная система обладает достаточным объемом ресурсов для соответствия минимальным требованиям к подготовке виртуального массива.
2. Подготовьте виртуальный массив в низкоуровневой оболочке.
3. Запустите виртуальный массив и получите IP-адрес.

В следующих разделах отдельно рассматривается каждый шаг.

## <a name="step-1-ensure-that-the-host-system-meets-minimum-virtual-array-requirements"></a>Шаг 1. Обеспечение соответствия главной системы минимальным требованиям к подготовке виртуального массива
Для создания виртуального массива вам потребуются:

* Роль Hyper-V, установленная в ОС Windows Server 2012 R2, Windows Server 2012 или Windows Server 2008 R2 с пакетом обновления 1 (SP1).
* диспетчер Microsoft Hyper-V в клиенте Microsoft Windows, подключенном к главной системе.

Убедиться, что оборудование (главная система), на котором создается виртуальный массив, располагает указанными ниже ресурсами для подготовки виртуального массива.

* Не менее 4 ядер.
* Не менее 8 ГБ ОЗУ. Если планируется настроить виртуальный массив как файловый сервер, то 8 ГБ ОЗУ обеспечат поддержку до 2 млн файлов. Для поддержки 2–4 млн файлов потребуется 16 ГБ ОЗУ.
* Один сетевой интерфейс.
* Виртуальный диск размером 500 ГБ для системных данных.

## <a name="step-2-provision-a-virtual-array-in-hypervisor"></a>Шаг 2. Подготовка виртуального массива в низкоуровневой оболочке
Для подготовки устройства в низкоуровневой оболочке выполните указанные ниже действия.

#### <a name="to-provision-a-virtual-array"></a>Подготовка виртуального массива
1. На узле Windows Server скопируйте образ виртуального массива на локальный диск. Это образ (VHD- или VHDX-файл), который вы скачали с портала Azure. Запишите расположение, в которое был скопирован образ, так как он потребуется вам позднее.
2. Откройте **диспетчер сервера**. В верхнем правом углу выберите **Сервис**, а затем — **Диспетчер Hyper-V**.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image1.png)  

   Если вы используете Windows Server 2008 R2, откройте диспетчер Hyper-V. В диспетчере сервера щелкните **Роли > Hyper-V > Диспетчер Hyper-V**.
3. В **диспетчере Hyper-V** на панели областей щелкните правой кнопкой мыши узел системы, чтобы открыть контекстное меню, затем выберите **Создать** > **Виртуальная машина**.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image2.png)
4. На странице **Перед началом работы** мастера создания виртуальной машины нажмите кнопку **Далее**.
5. На странице **Указание имени и расположения** введите **имя** виртуального массива. Нажмите кнопку **Далее**.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image4.png)
6. На странице **Укажите поколение** выберите тип образа устройства и нажмите кнопку **Далее**. Эта страница не отобразится, если вы используете Windows Server 2008 R2.

   * Выберите **Поколение 2** , если в скачали VHDX-файл образа для Windows Server 2012 или более поздней версии.
   * Выберите **Поколение 1** , если в скачали VHD-файл образа для Windows Server 2008 R2 или более поздней версии.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image5.png)
7. На странице **Выделить память** для параметра **Память при запуске** укажите по меньшей мере **8192 МБ**. Не включайте динамическую память. Нажмите кнопку **Далее**.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image6.png)  
8. На странице **Настройка сети** укажите виртуальный коммутатор, подключенный к Интернету, и нажмите кнопку **Далее**.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image7.png)
9. На странице **Подключить виртуальный жесткий диск** выберите **Использовать существующий виртуальный жесткий диск**, укажите расположение образа виртуального массива (VHDX- или VHD-файл) и нажмите кнопку **Далее**.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image8m.png)
10. Просмотрите информацию на странице **Сводка**. Для создания виртуальной машины нажмите кнопку **Готово**.

    ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image9.png)
11. В соответствии с минимальными требованиями необходимо 4 ядра. Чтобы добавить 4 виртуальных процессора, выберите в окне **Диспетчер Hyper-V** главную систему. В области справа в списке **Виртуальные машины** найдите только что созданную виртуальную машину. Выберите и щелкните правой кнопкой мыши имя виртуальной машины, затем выберите **Параметры**.

    ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image10.png)
12. В области слева на странице **Параметры** щелкните **Процессор**. В области справа установите для параметра **Количество виртуальных процессоров** значение 4 (или больше). Нажмите кнопку **Применить**.

    ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image11.png)
13. В соответствии с минимальными требованиями также необходимо добавить виртуальный диск данных размером 500 ГБ. На странице **Параметры** :

    1. В области слева выберите **Контроллер SCSI**.
    2. В области справа выберите **Жесткий диск** и щелкните **Добавить**.

    ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image12.png)
14. На странице **Жесткий диск** выберите параметр **Виртуальный жесткий диск** и нажмите кнопку **Создать**. Запустится **мастер создания виртуального жесткого диска**.

    ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image13.png)
15. На странице **Перед началом работы** мастера создания виртуального жесткого диска нажмите кнопку **Далее**.
16. На странице **Выбор формата диска** примите выбор формата **VHDX** по умолчанию. Нажмите кнопку **Далее**. Если вы используете Windows Server 2008 R2, то этот экран не отображается.

    ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image15.png)
17. На странице **Выбор типа диска** задайте для типа виртуального жесткого диска значение **Динамически расширяемый** (рекомендуется). Диск будет работать и при выборе параметра **Фиксированный размер**, но может потребоваться много времени. Параметр **Разностный** использовать не рекомендуется. Нажмите кнопку **Далее**. Значение **Динамически расширяемый** используется по умолчанию в Windows Server 2012 R2 и Windows Server 2012. В Windows Server 2008 R2 значение по умолчанию — **Фиксированный размер**.

    ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image16.png)
18. На странице **Указание имени и расположения** введите **имя** и **расположение** (к нему можно перейти с помощью обзора) диска данных. Нажмите кнопку **Далее**.

    ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image17.png)
19. На странице **Настройка диска** выберите параметр **Создать пустой виртуальный жесткий диск** и укажите размер **500 ГБ** (или больше). Минимальный размер диска — 500 ГБ, но можно подготовить диск большего размера. Обратите внимание, что после подготовки размер диска изменить нельзя. Дополнительные сведения о размере подготавливаемого диска см. в соответствующем разделе [документа с рекомендациями](storsimple-ova-best-practices.md). Нажмите кнопку **Далее**.

    ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image18.png)
20. На странице **Сводка** просмотрите сведения о виртуальном диске данных и, если они соответствуют требованиям, нажмите кнопку **Готово** для создания диска. Мастер закроется, и виртуальный жесткий диск будет добавлен на компьютер.

    ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image19.png)
21. Вернитесь на страницу **Параметры**. Нажмите кнопку **ОК**, чтобы закрыть страницу **Параметры** и вернуться к окну диспетчера Hyper-V.

    ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image20.png)

## <a name="step-3-start-the-virtual-array-and-get-the-ip"></a>Шаг 3. Запуск виртуального массива и получение IP-адреса
Чтобы запустить виртуальный массив и подключиться к нему, сделайте следующее.

#### <a name="to-start-the-virtual-array"></a>Запуск виртуального массива
1. Запустите виртуальный массив.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image21.png)
2. После запуска выберите устройство, щелкните правой кнопкой мыши и выберите **Подключить**.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image22.png)
3. Подготовка устройства может занять 5–10 минут. На консоли отображается сообщение о состоянии, указывающее на ход выполнения. Как только устройство будет готово к работе, перейдите в меню **Действие**. Чтобы войти в виртуальный массив, нажмите клавиши `Ctrl + Alt + Delete`. По умолчанию используются имя пользователя *StorSimpleAdmin* и пароль *Password1*.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image23.png)
4. В целях безопасности срок действия пароля администратора устройства истекает после первого входа в систему. Вам будет предложено изменить пароль.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image24.png)

   Введите пароль длиной не менее 8 символов. Он должен содержать по крайней мере 3 из 4 указанных далее типов символов: прописные буквы, строчные буквы, цифры и специальные символы. Повторно введите пароль для подтверждения. Вы получите уведомление об изменении пароля.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image25.png)
5. После изменения пароля виртуальный массив может перезапуститься. Подождите, пока устройство запустится.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image26.png)

    Возможно, отобразится консоль устройства Windows PowerShell с индикатором выполнения.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image27.png)
6. Шаги 6–8 применяются только при загрузке в среде без DHCP. Если вы работаете в среде DHCP, пропустите эти шаги и перейдите к шагу 9. Если устройство загружено в среде без DHCP, отобразится следующий экран.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image28m.png)

    Теперь необходимо настроить сеть.
7. Используйте команду `Get-HcsIpAddress`, чтобы получить список сетевых интерфейсов, включенных в виртуальном массиве. Если на устройстве включен один сетевой интерфейс, по умолчанию ему назначается имя `Ethernet`.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image29m.png)
8. Для настройки сети используйте командлет `Set-HcsIpAddress` . Как в этом примере:

    `Set-HcsIpAddress –Name Ethernet –IpAddress 10.161.22.90 –Netmask 255.255.255.0 –Gateway 10.161.22.1`

    ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image30.png)
9. По завершении начальной установки и загрузки устройства отобразится текст его баннера. Для управления устройством запишите IP-адрес и URL-адрес, отображающиеся в тексте баннера. Этот IP-адрес используется для подключения к веб-интерфейсу виртуального массива, а также для выполнения локальной установки и регистрации.

   ![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image31m.png)
10. (Необязательно.) Выполните этот шаг только в том случае, если вы развертываете устройство в облаке для государственных организаций. Теперь на устройстве нужно включить режим FIPS (федеральный стандарт обработки информации США). Стандарт FIPS 140 определяет криптографические алгоритмы, утвержденные для использования в компьютерных системах федеральной власти США для защиты конфиденциальных данных.

    1. Чтобы включить режим FIPS, выполните следующий командлет.

        `Enable-HcsFIPSMode`
    2. Перезагрузите устройство после включения режима FIPS, чтобы криптографические проверки вступили в силу.

       > [!NOTE]
       > Можно включить или отключить режим FIPS на устройстве. Поочередное использование устройства в режиме FIPS и без него без перезагрузки не поддерживается.
       >
       >

Если устройство не соответствует минимальным требованиям для конфигурации, в тексте баннера отобразится следующее сообщение об ошибке (см. ниже). Измените конфигурацию устройства и приведите его ресурсы в соответствие минимальным требованиям. Затем можно выполнить перезапуск и установить подключение к устройству. Минимальные требования к конфигурации см. в разделе [Шаг 1. Обеспечение соответствия главной системы минимальным требованиям к подготовке виртуального массива](#step-1-ensure-that-the-host-system-meets-minimum-virtual-device-requirements).

![](./media/storsimple-virtual-array-deploy2-provision-hyperv/image32.png)

При возникновении любой другой ошибки во время начальной настройки с помощью локального веб-интерфейса см. сведения о соответствующих рабочих процессах.

* Выполните диагностические тесты для [устранения неполадок при настройке веб-интерфейса](storsimple-ova-web-ui-admin.md#troubleshoot-web-ui-setup-errors).
* [Создайте пакет журнала и просмотрите файлы журнала](storsimple-ova-web-ui-admin.md#generate-a-log-package).

## <a name="next-steps"></a>Дополнительная информация
* [Deploy StorSimple Virtual Array - Set up as file server (Preview) (Развертывание виртуального массива StorSimple — настройка в качестве файлового сервера (предварительная версия))](storsimple-virtual-array-deploy3-fs-setup.md)
* [Deploy StorSimple Virtual Array – Set up your virtual device as an iSCSI server (preview) (Развертывание виртуального массива StorSimple — настройка в качестве сервера iSCSI (предварительная версия))](storsimple-virtual-array-deploy3-iscsi-setup.md)
