---
title: "Настройка MPIO для устройства StorSimple | Документация Майкрософт"
description: "В этой статье описывается настройка функции Multipath I/O (MPIO) для устройства StorSimple, подключенного к узлу под управлением Windows Server 2012 R2."
services: storsimple
documentationcenter: 
author: alkohli
manager: timlt
editor: 
ms.assetid: 879fd0f9-c763-4fa0-a5ba-f589a825b2df
ms.service: storsimple
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 03/27/2017
ms.author: alkohli
translationtype: Human Translation
ms.sourcegitcommit: 6e0ad6b5bec11c5197dd7bded64168a1b8cc2fdd
ms.openlocfilehash: 7b484c27157bd0a261adbf81d66b73a78e252955
ms.lasthandoff: 03/28/2017


---
# <a name="configure-multipath-io-for-your-storsimple-device"></a>Настройка функции Multipath I/O для устройства StorSimple
Корпорация Майкрософт встроила в Windows Server поддержку функции Multipath I/O (MPIO) для создания высокодоступных и отказоустойчивых SAN-конфигураций. С помощью избыточных компонентов физических путей — адаптеров, кабелей и коммутаторов — функция MPIO создает логические пути между сервером и устройством хранения. Если возникает сбой компонента, который вызывает отказ логического пути, многопутевая логика использует альтернативный путь для ввода-вывода, а приложения при этом сохранят доступ к данным. Кроме того, в зависимости от конфигурации MPIO также может повысить производительность путем повторной балансировки нагрузки по всем путям. Дополнительные сведения см. в статье [Обзор многопутевого ввода-вывода](https://technet.microsoft.com/library/cc725907.aspx "Общие сведения о MPIO и компоненты").  

Для высокого уровня доступности решения StorSimple следует настроить MPIO для устройства StorSimple. Если MPIO устанавливается на базовых серверах, работающих под управлением Windows Server 2012 R2, серверы смогут выдержать сбой канала, сети или интерфейса. 

MPIO представляет собой дополнительный компонент, который по умолчанию не устанавливается в Windows Server. Его необходимо устанавливать в качестве отдельного компонента через диспетчер сервера. В этом разделе рассматриваются действия, которые необходимо выполнить для установки и использования функции MPIO на узле под управлением Windows Server 2012 R2, который подключен к физическому устройству StorSimple.

> [!NOTE]
> **Эта процедура применима только к серии StorSimple 8000. В настоящее время MPIO не поддерживается для виртуального устройства StorSimple.**
> 
> 

Чтобы настроить MPIO на устройстве StorSimple, выполните следующие действия.

* Шаг 1. Установка MPIO на узле Windows Server
* Шаг 2. Настройка MPIO для томов StorSimple
* Шаг 3. Подключение томов StorSimple на узле
* Шаг 4. Настройка MPIO для обеспечения высокого уровня доступности и балансировки нагрузки

В следующих разделах каждое действие рассматривается более подробно.

## <a name="step-1-install-mpio-on-the-windows-server-host"></a>Шаг 1. Установка MPIO на узле Windows Server
Чтобы установить этот компонент на узле Windows Server, выполните следующую процедуру.

#### <a name="to-install-mpio-on-the-host"></a>Установка MPIO на узле
1. Откройте диспетчер сервера на узле Windows Server. По умолчанию диспетчер сервера запускается, когда член группы администраторов выполняет вход на компьютер под управлением Windows Server 2012 R2 или Windows Server 2012. Если диспетчер сервера не открыт, щелкните **Пуск > Диспетчер сервера**.
   ![Диспетчер сервера](./media/storsimple-configure-mpio-windows-server/IC740997.png)
2. Выберите **Диспетчер сервера > Панель мониторинга > Добавить роли и компоненты**. Запустится мастер **Добавление ролей и компонентов** .
   ![Мастер добавления ролей и компонентов 1](./media/storsimple-configure-mpio-windows-server/IC740998.png)
3. В мастере **Добавление ролей и компонентов** выполните следующие действия.
   
   * На странице **Перед началом работы** нажмите кнопку **Далее**.
   * На странице **Выбор типа установки** выберите вариант по умолчанию **Установка ролей или компонентов**. Выберите **Далее**.![Мастер добавления ролей и компонентов 2](./media/storsimple-configure-mpio-windows-server/IC740999.png)
   * На странице **Выбор целевого сервера** выберите **Select a server from the server pool** (Выбор сервера из пула серверов). Сервер должен быть найден автоматически. Нажмите кнопку **Далее**.
   * На странице **Выбор ролей сервера** нажмите кнопку **Далее**.
   * На странице **Выбор компонентов** выберите **Многопутевой ввод-вывод** и нажмите кнопку **Далее**.![Мастер добавления ролей и компонентов 5](./media/storsimple-configure-mpio-windows-server/IC741000.png)
   * На странице **Подтверждение установки компонентов** подтвердите выбранные компоненты и установите флажок **Автоматический перезапуск конечного сервера, если требуется**, как показано ниже. Нажмите кнопку **Установить**.![Мастер добавления ролей и компонентов 8](./media/storsimple-configure-mpio-windows-server/IC741001.png)
   * После завершения установки появится уведомление. Нажмите кнопку **Закрыть**, чтобы закрыть мастер.![Мастер добавления ролей и компонентов 9](./media/storsimple-configure-mpio-windows-server/IC741002.png)

## <a name="step-2-configure-mpio-for-storsimple-volumes"></a>Шаг 2. Настройка MPIO для томов StorSimple
MPIO необходимо настроить для идентификации томов StorSimple. Чтобы настроить MPIO для распознавания томов StorSimple, выполните следующие действия.

#### <a name="to-configure-mpio-for-storsimple-volumes"></a>Настройка MPIO для томов StorSimple
1. Откройте раздел **Конфигурация MPIO**. Выберите **Диспетчер сервера > Панель мониторинга > Сервис > MPIO**.
2. В диалоговом окне **MPIO Properties** (Свойства MPIO) выберите вкладку **Обнаружение многопутевых устройств**.
3. Выберите **Добавить поддержку для iSCSI-устройств** и нажмите кнопку **Добавить**.  
   ![Свойства MPIO. Обнаружение путей](./media/storsimple-configure-mpio-windows-server/IC741003.png)
4. При появлении запроса перезагрузите сервер.
5. В диалоговом окне **MPIO Properties** (Свойства MPIO) перейдите на вкладку **Устройства Multipath I/O**. Щелкните **Добавить**.
    </br>![Свойства MPIO. Устройства Multipath I/O](./media/storsimple-configure-mpio-windows-server/IC741004.png)
6. В диалоговом окне **Добавление поддержки многопутевого ввода-вывода** в разделе **Код оборудования** введите серийный номер устройства. Серийный номер устройства можно узнать с помощью службы диспетчера StorSimple и на вкладке **Устройства > Панель мониторинга**. Серийный номер устройства отображается в правой области **Краткий обзор** панели мониторинга устройства.
    </br>![Добавление поддержки MPIO](./media/storsimple-configure-mpio-windows-server/IC741005.png)
7. При появлении запроса перезагрузите сервер.

## <a name="step-3-mount-storsimple-volumes-on-the-host"></a>Шаг 3. Подключение томов StorSimple на узле
После настройки MPIO на сервере Windows тома, созданные на устройстве StorSimple, можно будет подключить и они смогут воспользоваться преимуществами MPIO для обеспечения избыточности. Чтобы подключить том, выполните следующие действия.

#### <a name="to-mount-volumes-on-the-host"></a>Подключение томов на узле
1. Откройте окно **Свойства инициатора iSCSI** на узле Windows Server. Выберите **Диспетчер серверов > Панель мониторинга > Сервис > Инициатор iSCSI**.
2. В диалоговом окне **iSCSI Initiator Properties** (Свойства инициатора iSCSI) перейдите на вкладку "Обнаружение" и нажмите кнопку **Обнаружение целевого портала**.
3. В диалоговом окне **Обнаружение целевого портала** выполните следующие действия.
   
   * Введите IP-адрес порта DATA для устройства StorSimple (например, введите "DATA 0").
   * Щелкните **ОК** для возврата в диалоговое окно **iSCSI Initiator Properties** (Свойства инициатора iSCSI).
     
     > [!IMPORTANT]
     > **При использовании частной сети для подключения iSCSI введите IP-адрес порта данных, подключенного к частной сети.**
     > 
     > 
4. Повторите шаги 2–3 для установки второго сетевого интерфейса (например, DATA 1) на устройстве. Помните, что эти интерфейсы должны поддерживать iSCSI. Дополнительные сведения об этом см. в разделе [Изменение сетевых интерфейсов](storsimple-modify-device-config.md#modify-network-interfaces).
5. Перейдите на вкладку **Целевые объекты** в диалоговом окне **iSCSI Initiator Properties** (Свойства инициатора iSCSI). На вкладке **Обнаруженные целевые объекты**должен быть целевой IQN устройства StorSimple.

   ![Вкладка "Свойства целевых объектов инициатора iSCSI"](./media/storsimple-configure-mpio-windows-server/IC741007.png)
   
6. Щелкните **Подключение** для установления сеанса iSCSI с устройством StorSimple. Появится диалоговое окно **Подключение к целевому объекту** .
7. В диалоговом окне **Подключение к конечному объекту** установите флажок **Включить поддержку многопутевых накопителей**. Нажмите кнопку **Дополнительно**.
8. В диалоговом окне **Дополнительные параметры** выполните следующие действия.                                        
   
   * В раскрывающемся списке **Локальный адаптер** выберите **Microsoft iSCSI инициатор**.
   * Из раскрывающегося списка **IP-адрес инициатора** выберите IP-адрес узла.
   * Из раскрывающегося списка **Целевой IP-адрес портала** выберите IP-адрес интерфейса устройства.
   * Щелкните **ОК** для возврата в диалоговое окно **iSCSI Initiator Properties** (Свойства инициатора iSCSI).
9. Щелкните **Свойства**. В диалоговом окне **Свойства** нажмите кнопку **Добавить сеанс**.
10. В диалоговом окне **Подключение к конечному объекту** установите флажок **Включить поддержку многопутевых накопителей**. Нажмите кнопку **Дополнительно**.
11. В диалоговом окне **Дополнительные параметры** выполните следующие действия.                                        
    
    * В раскрывающемся списке **Локальный адаптер** выберите "Инициатор iSCSI (Майкрософт)".
    * Из раскрывающегося списка **IP-адрес инициатора** выберите IP-адрес узла. В данном случае выполняется подключение двух сетевых интерфейсов на устройстве к одному сетевому интерфейсу на узле. Таким образом, этот интерфейс является таким же, как для первого сеанса.
    * Из раскрывающегося списка **Целевой IP-адрес портала** выберите IP-адрес для второго интерфейса данных устройства.
    * Щелкните **ОК** для возврата в диалоговое окно "Свойства инициатора iSCSI". В целевой объект был добавлен второй сеанс.
12. Откройте **Управление компьютером**, для чего выберите **Диспетчер серверов > Панель мониторинга > Управление компьютером**. В левой области щелкните **Хранилище > Управление дисками**. Тома, созданные на устройстве StorSimple, видимом для этого узла, будут отображены на вкладке **Управление дисками** в качестве новых дисков.
13. Инициализируйте диск и создайте новый том. При форматировании выберите размер блока 64 КБ.
    ![Управление дисками](./media/storsimple-configure-mpio-windows-server/IC741008.png)
14. В разделе **Управление дисками** щелкните правой кнопкой мыши **Диск** и выберите **Свойства**.
15. В диалоговом окне модели StorSimple #### **Multi-Path Disk Device Properties** (Свойства устройства многопутевого диска) перейдите на вкладку **MPIO**.
    ![Свойства многопутевого диска StorSimple 8100.](./media/storsimple-configure-mpio-windows-server/IC741009.png)
16. В разделе **Имя DSM** щелкните **Сведения** и убедитесь, что заданы параметры по умолчанию. Используются следующие параметры по умолчанию.
    
    * Период проверки пути = 30.
    * Счетчик попыток = 3.
    * Период удаления PDO = 20.
    * Интервал попытки = 1.
    * Проверка пути включена = флажок снят.

> [!NOTE]
> **Не изменяйте параметры по умолчанию.**


## <a name="step-4-configure-mpio-for-high-availability-and-load-balancing"></a>Шаг 4. Настройка MPIO для обеспечения высокого уровня доступности и балансировки нагрузки
Чтобы реализовать высокий уровень доступности и балансировку нагрузки на основе нескольких путей ввода-вывода, необходимо вручную добавить несколько сеансов, чтобы объявить о наличии разных путей. Например, если узел имеет два интерфейса, подключенные к SAN, и устройство имеет два интерфейса, подключенные к SAN, потребуется четыре сеанса с настроенными путями (потребуется только два сеанса, если каждый интерфейс DATA и интерфейс узла находятся в разных подсетях IP и не поддерживают маршрутизацию).

**Мы рекомендуем использовать по крайней мере 4 активных параллельных сеанса между устройством и узлом приложения.** Это можно сделать, включив 4 сетевых интерфейса в системе Windows Server. Используйте физические сетевые интерфейсы или сетевые технологии виртуализации на уровне оборудования или операционной системы на узле Windows Server. При наличии двух сетевых интерфейсов на устройстве эта конфигурация образует 8 сеансов, 4 из которых которые будут активными (подключенными к активному контроллеру), а 4 — пассивными (подключенными к пассивному контроллеру). Такая конфигурация позволяет оптимизировать пропускную способность устройства и облака.

> [!IMPORTANT]
> **Рекомендуется не смешивать сетевые интерфейсы 1 и 10 GbE. При использовании двух сетевых интерфейсов оба интерфейса должны иметь одинаковый тип.**

Далее рассматривается добавление сеансов для случая, когда устройство StorSimple с двумя сетевыми интерфейсами подключено к узлу с двумя сетевыми интерфейсами. Это дает только 2 активных сеанса. Используйте эту процедуру для устройства StorSimple с двумя сетевыми интерфейсами, подключенного к узлу с четырьмя сетевыми интерфейсами. Понадобится настроить 8 сеансов вместо 4, описанных здесь.

### <a name="to-configure-mpio-for-high-availability-and-load-balancing"></a>Настройка MPIO для обеспечения высокого уровня доступности и балансировки нагрузки
1. Выполните обнаружение целевого объекта. Для этого в диалоговом окне **iSCSI Initiator Properties** (Свойства инициатора iSCSI) на вкладке **Обнаружение** щелкните **Обнаружить портал**.
2. В диалоговом окне **Подключение к целевому объекту** укажите IP-адрес одного из сетевых интерфейсов устройства.
3. Щелкните **ОК** для возврата в диалоговое окно **iSCSI Initiator Properties** (Свойства инициатора iSCSI).
4. В диалоговом окне **iSCSI Initiator Properties** (Свойства инициатора iSCSI) перейдите на вкладку **Целевые объекты**, выделите обнаруженный целевой объект и нажмите кнопку **Подключение**. Появится диалоговое окно **Подключение к целевому объекту** .
5. В диалоговом окне **Подключение к целевому объекту** выполните следующие действия.
   
   * Оставьте выбранный по умолчанию целевой объект для параметра **Добавить объект к подключению** (список избранных целевых объектов). В этом случае устройство будет пытаться автоматически устанавливать соединение после каждого перезапуска компьютера.
   * Установите флажок **Включить поддержку многопутевых устройств** .
   * Нажмите кнопку **Дополнительно**.
6. В диалоговом окне **Дополнительные параметры** выполните следующие действия.
   
   * В раскрывающемся списке **Локальный адаптер** выберите **Microsoft iSCSI инициатор**.
   * Из раскрывающегося списка **IP-адрес инициатора** выберите IP-адрес узла.
   * Из раскрывающегося списка **Целевой IP-адрес портала** выберите IP-адрес для интерфейса данных устройства.
   * Щелкните **ОК** для возврата в диалоговое окно "Свойства инициатора iSCSI".
7. Щелкните **Свойства** и в диалоговом окне **Свойства** выберите **Добавить сеанс**.
8. В диалоговом окне **Подключение к конечному объекту** установите флажок **Включить поддержку многопутевых накопителей**, а затем щелкните **Дополнительно**.
9. В диалоговом окне **Дополнительные параметры** выполните следующие действия.
   
   1. В раскрывающемся списке **Локальный адаптер** выберите **Microsoft iSCSI инициатор**.
   2. Из раскрывающегося списка **IP-адрес инициатора** выберите IP-адрес узла, соответствующий второму интерфейсу на узле.
   3. Из раскрывающегося списка **Целевой IP-адрес портала** выберите IP-адрес для второго интерфейса данных устройства.
   4. Щелкните **ОК** для возврата в диалоговое окно **iSCSI Initiator Properties** (Свойства инициатора iSCSI). В целевой объект был добавлен второй сеанс.
10. Повторите шаги 8–10, чтобы добавить дополнительные сеансы (пути) в целевой объект. С двумя интерфейсами на узле и двумя на устройстве можно добавить не более четырех сеансов.
11. После добавления сеансов (путей) в диалоговом окне **iSCSI Initiator Properties** (Свойства инициатора iSCSI) выберите целевой объект и нажмите кнопку **Свойства**. На вкладке "Сеансы" диалогового окна **Свойства** обратите внимание на четыре идентификатора сеансов, которые соответствуют возможным перестановкам путей. Чтобы отменить сеанс, установите флаг рядом с идентификатором сеанса и нажмите кнопку **Отключить**.
12. Чтобы просмотреть устройства, представленные в сеансах, выберите вкладку **Устройства** . Чтобы настроить политику MPIO для выбранного устройства, щелкните **MPIO**. Откроется диалоговое окно **Сведения об устройстве** . На вкладке **MPIO** можно выбрать параметры **Политики балансировки нагрузки**. Можно также просмотреть тип пути **Активный** или **Ожидание**.

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения см. в статье [Использование службы диспетчера StorSimple для изменения конфигурации устройства StorSimple](storsimple-modify-device-config.md).


