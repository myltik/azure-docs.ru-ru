<properties
   pageTitle="Развертывание локального устройства StorSimple | Microsoft Azure"
   description="В статье описываются действия и рекомендации по развертыванию устройства StorSimple и службы. (Применимо к Microsoft Azure StorSimple 3 и более ранних версий.)"
   services="storsimple"
   documentationCenter="NA"
   authors="alkohli"
   manager="adinah"
   editor="" />
<tags
   ms.service="storsimple"
   ms.devlang="NA"
   ms.topic="hero-article"
   ms.tgt_pltfrm="NA"
   ms.workload="TBD"
   ms.date="01/14/2016"
   ms.author="alkohli" />

# Развертывание локального устройства StorSimple

> [AZURE.SELECTOR]
- [Update 2](../articles/storsimple/storsimple-deployment-walkthrough-u2.md)
- [Update 1](../articles/storsimple/storsimple-deployment-walkthrough-u1.md)
- [GA Release](../articles/storsimple/storsimple-deployment-walkthrough.md)

## Обзор

Добро пожаловать в раздел развертывания устройств StorSimple в Microsoft Azure. Это руководство по развертыванию применимо к версии выпуска серии StorSimple 8000, версии обновления 0.1 серии StorSimple 8000, версии обновления 0.2 серии StorSimple 8000 и версии обновления 0.3 серии StorSimple 8000. В этой серии учебников описывается настройка устройства StorSimple. Серия включает контрольный список настройки, предварительные требования к конфигурации и подробное пошаговое руководство по настройке.


Сведения, изложенные в этих учебниках, предполагают, что вы ознакомились с мерами предосторожности и уже распаковали устройство, установили его в стойку и подключили к устройству StorSimple все необходимые кабели. Если эти задачи еще предстоит выполнить, начните с ознакомления с [мерами предосторожности](storsimple-safety.md). В зависимости от модели устройства его нужно будет распаковать, установить в стойку и подключить кабели, следуя инструкциям в разделах:

- [Распаковка, монтаж в стойку и подключение кабелей к устройству 8100](storsimple-8100-hardware-installation.md)
- [Распаковка, монтаж в стойку и подключение кабелей к устройству 8600](storsimple-8600-hardware-installation.md)

Чтобы завершить процесс установки и настройки, вам потребуются права администратора. Перед началом настройки рекомендуется изучить контрольный список конфигурации. Процессы развертывания и настройки могут занять некоторое время.

> [AZURE.NOTE] Сведения о развертывании StorSimple, опубликованные на веб-сайте Microsoft Azure, применяются только к устройствам серии StorSimple 8000. Полные сведения об устройствах серии 7000 см. в статье [http://onlinehelp.storsimple.com/](http://onlinehelp.storsimple.com). Сведения о развертывании устройств серии 7000 см. в [кратком руководстве по системе StorSimple](http://onlinehelp.storsimple.com/111_Appliance/).

## Шаги по развертыванию

Выполните эти обязательные действия по настройке и подключению устройства StorSimple к службе StorSimple Manager. Помимо обязательных существуют дополнительные шаги и процедуры, которые могут потребоваться в ходе развертывания. В пошаговых инструкциях по развертыванию будет рассказано, когда необходимо предпринять каждый из этих дополнительных шагов.


| Шаг | Описание |
|----------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ПРЕДВАРИТЕЛЬНЫЕ ТРЕБОВАНИЯ** | При подготовке к предстоящему развертыванию необходимо выполнить следующее. |
| Контрольный список конфигурации развертывания. | Этот контрольный список служит для сбора и записи информации до и во время развертывания. |
| Предварительные условия для развертывания. | Эти условия служат для проверки готовности среды к развертыванию. |
| | |
| **ПОШАГОВОЕ РАЗВЕРТЫВАНИЕ** | Эти шаги обязательны для развертывания устройства StorSimple в производственной среде. |
| Шаг 1. Создание новой службы. | Настройте облачное управление и хранение для устройства StorSimple. При наличии существующей службы для других устройств StorSimple пропустите этот шаг. |
| Шаг 2. Получение ключа регистрации службы. | С помощью этого ключа зарегистрируйте и подключите устройство StorSimple к службе управления. |
| Шаг 3. Настройка и регистрация устройства средствами Windows PowerShell для StorSimple. | Подключите устройство к сети и зарегистрируйте его в Azure, чтобы завершить установку с помощью службы управления. |
| Шаг 4. Завершение минимальной настройки устройства.</br>Необязательно: обновление устройства StorSimple. | С помощью службы управления завершите настройку устройства и включите на нем возможность хранения данных. |
| Шаг 5. Создание контейнера томов. | Создайте контейнер для подготовки томов. У контейнера томов имеется учетная запись хранения, пропускная способность и параметры шифрования для всех томов, которые в нем содержатся. |
| Шаг 6. Создание тома. | Подготовьте один или несколько томов хранения данных на устройстве StorSimple для ваших серверов. |
| Шаг 7. Подключение, инициализация и форматирование тома.</br>Необязательно: настройка MPIO. | Подключите серверы к хранилищу iSCSI, предоставляемому устройством. При необходимости настройте MPIO, чтобы обеспечить устойчивость серверов к сбоям канала связи, сети и интерфейса. |
| Шаг 8. Создание резервной копии. | Настройте политику резервного копирования для защиты данных. |
| | |
| **ПРОЧИЕ ПРОЦЕДУРЫ** | При развертывании решения может возникнуть необходимость обратиться к этим процедурам. |
| Настройка новой учетной записи хранения для службы. | |
| Подключение к последовательной консоли устройства с помощью PuTTY. | |
| Получение IQN узла Windows Server. | |
| Создание резервной копии вручную. |


## Контрольный список конфигурации развертывания

В следующем контрольном списке конфигурации развертывания описаны сведения, которые необходимо собрать до и в ходе настройки программного обеспечения на устройстве StorSimple. Заблаговременная подготовка некоторых из этих сведений поможет оптимизировать процесс развертывания устройства StorSimple в вашей среде. Также используйте этот контрольный список для записи сведений о конфигурации при развертывании устройства.

| Этап | Параметр | Сведения | Значения |
|----------------------------------------|---------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------|
| **Подключение кабелей к устройству** | Последовательный доступ | Первоначальная конфигурация устройства | Да/нет |
| | | | |
| **Настройка и регистрация устройства** | Параметры сети Data 0 | IP-адрес Data 0:</br>Маска подсети:</br>Шлюз:</br>Основной DNS-сервер:</br>Основной NTP-сервер:</br>IP/полное доменное имя сервера веб-прокси (необязательно):</br>Порт веб-прокси:| |
| | Пароль администратора устройства | Пароль должен содержать от 8 до 15 символов, среди которых должны быть строчные и прописные буквы, числовые и специальные символы. | |
| | Пароль диспетчера моментальных снимков StorSimple | Пароль должен содержать от 14 до 15 символов, среди которых должны быть строчные и прописные буквы, числовые и специальные символы.| |
| | Регистрационный ключ службы | Этот ключ создается на классическом портале Azure. | |
| | Ключ шифрования данных службы | Этот ключ создается при регистрации устройства в службе управления через Windows PowerShell для StorSimple. Скопируйте этот ключ и сохраните его в безопасном месте.| |
| | | | |
| **Минимальная настройка устройства** | Понятное имя устройства | Это имя, описывающее устройство. | |
| | Часовой пояс | Устройство будет использовать заданный часовой пояс для всех запланированных операций. | |
| | Дополнительный DNS-сервер | Это обязательная конфигурация. | |
| | Сетевой интерфейс: фиксированные IP-адреса контроллера данных 0 | Эти IP-адреса должны маршрутизироваться в Интернет.</br>Фиксированный IP-адрес контроллера 0:</br>Фиксированный IP-адрес контроллера 1:|
| | | | |
| **Дополнительные параметры сетевого интерфейса** | Сетевой интерфейс: Data 1</br>Если включен интерфейс iSCSI, шлюз настраивать не следует. | Назначение: облако/iSCSI/не используется</br>IP-адрес:</br>Маска подсети:</br>Шлюз:|
| | Сетевой интерфейс: Data 2</br>Если включен интерфейс iSCSI, шлюз настраивать не следует. | Назначение: облако/iSCSI/не используется</br>IP-адрес:</br>Маска подсети:</br>Шлюз:|
| | Сетевой интерфейс: Data 3</br>Если включен интерфейс iSCSI, шлюз настраивать не следует. | Назначение: облако/iSCSI/не используется</br>IP-адрес:</br>Маска подсети:</br>Шлюз:|
| | Сетевой интерфейс: Data 4</br>Если включен интерфейс iSCSI, шлюз настраивать не следует. | Назначение: облако/iSCSI/не используется</br>IP-адрес:</br>Маска подсети:</br>Шлюз:|
| | Сетевой интерфейс: Data 5</br>Если включен интерфейс iSCSI, шлюз настраивать не следует. | Назначение: облако/iSCSI/не используется</br>IP-адрес:</br>Маска подсети:</br>Шлюз:|
| | | | |
| **Создание контейнеров томов** | Имя контейнера томов: | Имя для контейнера | |
| | Учетная запись хранения Azure: | Имя учетной записи хранения и ключ доступа, которые будут связаны с данным контейнером томов | |
| | Ключ шифрования в облачном хранилище: | Ключ шифрования для хранения данных в каждом контейнере | |
| | | | |
| **Создайте том** | Подробные сведения по каждому тому | Имя тома: | |
| | | Размер: | |
| | | Тип использования: | |
| | | Имя записи контроля доступа: | |
| | | Политика резервного копирования по умолчанию: | |
| | | | |
| **Подключение, инициализация и форматирование тома** | Подробные сведения для каждого сервера узла, который подключается к хранилищу | Имя Windows Server: | |
| | | Имя IQN Windows Server: | |
| | | Имя тома Windows Server: | |
| | | Точка подключения NTFS/буква диска: | |

## Предварительные условия для развертывания

В следующих разделах разъясняются предварительные условия для настройки службы StorSimple Manager, устройства StorSimple и сети в вашем центре обработки данных.

### Для службы Диспетчера StorSimple

Перед тем как начать, убедитесь в следующем.

- Имеется учетная запись Майкрософт и данные для доступа к ней.

- Имеется учетная запись хранения Microsoft Azure и данные для доступа к ней.

- Ваша подписка Microsoft Azure должна разрешать использование службы Диспетчера StorSimple. Необходимо, чтобы ваша подписка была приобретена в соответствии с [корпоративным соглашением](https://azure.microsoft.com/pricing/enterprise-agreement/).

- У вас должен быть доступ к программе эмуляции терминала, например PuTTY.

### Для устройства в центре обработки данных

Перед настройкой устройства убедитесь в следующем.

- Устройство должно быть полностью распаковано, установлено в стойку. Кроме того, к нему должны быть подключены все кабели питания, сети и последовательного доступа, как описано в разделах:

	-  [Распаковка, монтаж в стойку и подключение кабелей к устройству 8100](storsimple-8100-hardware-installation.md)
	-  [Распаковка, монтаж в стойку и подключение кабелей к устройству 8600](storsimple-8600-hardware-installation.md)


### Сеть в центре обработки данных

Перед тем как начать, убедитесь в следующем.

- Порты в брандмауэре центра данных открыты для трафика iSCSI и облака, как описано в разделе [Требования к сети для устройства StorSimple](storsimple-system-requirements.md#networking-requirements-for-your-storsimple-device).
- Устройство в центре обработки данных может подключаться к внешней сети. Выполните следующие командлеты [Windows PowerShell 4.0](http://www.microsoft.com/download/details.aspx?id=40855) (в таблице ниже) для проверки возможности подключения к внешней сети. Выполните эту проверку на компьютере (в сети центра обработки данных) с возможностью подключения к Azure, на котором будет развернуто устройство StorSimple.  

| Для этого параметра... | Чтобы проверить допустимость... | Выполните следующие команды/командлеты. |
|---------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **IP**</br>**Подсеть**</br>**Шлюз** | Это допустимый адрес IPv4 или IPv6?</br>Это допустимая подсеть?</br>Это допустимый шлюз?</br>Это повторяющийся IP-адрес в сети? | `ping ip`</br>`arp -a`</br>Команды `ping` и `arp` должны завершиться ошибкой, показывая, что в сети ЦОД нет устройства, использующего данный IP-адрес.
| | | |
| **DNS** | Это допустимый DNS? Он может разрешать URL-адреса Azure? | `Resolve-DnsName -Name www.bing.com -Server <DNS server IP address>` </br>Можно использовать альтернативную команду:</br>`nslookup --dns-ip=<DNS server IP address> www.bing.com` |
| | Проверьте, открыт ли порт 53. Это применимо только в том случае, если для устройства используется внешний DNS-сервер. Внутренний DNS должен автоматически разрешать внешние URL-адреса. | `Test-Port -comp dc1 -port 53 -udp -UDPtimeout 10000` </br>[Дополнительные сведения об этом командлете](http://learn-powershell.net/2011/02/21/querying-udp-ports-with-powershell/)|
| | | |
| **NTP** | После ввода NTP-сервера сразу же запускается синхронизация времени. При вводе `time.windows.com` или общедоступных серверов времени проверьте, открыт ли UDP-порт 123. | [Загрузите и используйте этот скрипт](https://gallery.technet.microsoft.com/scriptcenter/Get-Network-NTP-Time-with-07b216ca). |
| | | |
| **Прокси (необязательно)** | Это допустимые URI и порт прокси-сервера? </br> Правильно ли установлен режим проверки подлинности? | <code>wget http://bing.com | % {$\_.StatusCode}</code></br>Эту команду следует выполнить сразу после настройки веб-прокси. Если возвращается код состояния 200, это значит, что подключение установлено успешно. |
| | Маршрутизируется ли трафик через прокси? | Выполните проверку DNS, NTP или HTTP один раз после настройки прокси-сервера на своем устройстве. Это позволит четко увидеть, блокируется ли трафик на прокси-сервере или в другом месте. |
| | | |
| **Регистрация** | Проверьте, открыты ли исходящие порты TCP 443, 80, 9354. | `Test-NetConnection -Port   443 -InformationLevel Detailed`</br>[Дополнительные сведения для командлета Test-NetConnection](https://technet.microsoft.com/library/dn372891.aspx) |

## Пошаговое развертывание

Следующие пошаговые инструкции позволяют развернуть устройство StorSimple в центре обработки данных.

## Шаг 1. Создание новой службы

Служба Диспетчера StorSimple может управлять несколькими устройствами StorSimple. Для развертывания первого устройства StorSimple необходимо создать новую службу StorSimple Manager.

> [AZURE.IMPORTANT] Если у вас есть существующая служба StorSimple Manager, с помощью которой вы планируете развернуть устройство StorSimple, пропустите этот шаг.

Для создания нового экземпляра службы Диспетчера StorSimple выполните следующие действия.

[AZURE.INCLUDE [storsimple-create-new-service](../../includes/storsimple-create-new-service.md)]

> [AZURE.IMPORTANT] Если вы не использовали автоматическое создание учетной записи хранения вашей службой, то после успешного создания службы вам нужно будет создать хотя бы одну учетную запись хранения. Эта учетная запись хранения будет использоваться при создании контейнера томов.
>
> Если вы не создали учетную запись хранения автоматически, перейдите к разделу [Настройка новой учетной записи хранения для службы](#configure-a-new-storage-account-for-the-service), чтобы ознакомиться с подробными инструкциями. Если вы включили автоматическое создание учетной записи хранения, перейдите к [шагу 2, "Получение ключа регистрации службы"](#step-2:-get-the-service-registration-key).

## Шаг 2. Получение ключа регистрации службы

После запуска и настройки службы Диспетчера StorSimple вам необходимо будет получить ключ регистрации службы. Этот ключ используется для регистрации вашего устройства StorSimple в службе и подключения к ней.

На классическом портале Azure выполните указанные ниже действия.

[AZURE.INCLUDE [storsimple-get-service-registration-key](../../includes/storsimple-get-service-registration-key.md)]


## Шаг 3. Настройка и регистрация устройства средствами Windows PowerShell для StorSimple

> [AZURE.IMPORTANT] Перед выполнением этой настройки отсоедините все сетевые интерфейсы, кроме DATA 0, на обоих контроллерах (активном и пассивном).

Используйте Windows PowerShell для StorSimple, чтобы завершить первоначальную настройку устройства StorSimple, как описано в следующей процедуре. Для выполнения этого действия вам необходимо будет использовать программное обеспечение для эмуляции терминала. Для получения дополнительных сведений см. раздел [Использование PuTTY для подключения к последовательной консоли устройства](#use-putty-to-connect-to-the-device-serial-console).

[AZURE.INCLUDE [storsimple-configure-and-register-device](../../includes/storsimple-configure-and-register-device.md)]

## Шаг 4. Выполнение минимальной настройки устройства

Для минимальной настройки устройства StorSimple выполните следующие действия.

- Настройте вторичный сервер DNS.
- Включите последовательный интерфейс iSCSI хотя бы на одном сетевом интерфейсе.
- Назначьте фиксированный IP-адрес обоим контроллерам.

Чтобы завершить минимальную настройку устройства, выполните указанные ниже действия на классическом портале Azure.

[AZURE.INCLUDE [storsimple-complete-minimum-device-setup](../../includes/storsimple-complete-minimum-device-setup.md)]

Когда конфигурация устройства будет настроена, необходимо проверить наличие обновлений и установить их, если таковые имеются. Установка обновлений может занять несколько часов. Следуйте инструкциям раздела [Проверка наличия обновлений и их установка](#scan-for-and-apply-updates).


## Шаг 5. Создание контейнера томов

У контейнера томов имеется учетная запись хранения, пропускная способность и параметры шифрования для всех томов, которые в нем содержатся. Перед выделением томов на вашем устройстве StorSimple вам необходимо будет создать контейнер томов.

Чтобы создать контейнер томов, выполните указанные ниже действия на классическом портале Azure.

[AZURE.INCLUDE [storsimple-create-volume-container](../../includes/storsimple-create-volume-container.md)]

## Шаг 6. Создание тома

После того как вы создадите контейнер томов, вы сможете выделить на устройстве StorSimple том хранения для своих серверов. Чтобы создать том, выполните указанные ниже действия на классическом портале Azure.

> [AZURE.IMPORTANT] StorSimple Manager может создавать только тома с тонкой подготовкой. Тома с полной или частичной подготовкой создать нельзя.

[AZURE.INCLUDE [storsimple-create-volume](../../includes/storsimple-create-volume.md)]

## Шаг 7. Подключение, инициализация и форматирование тома

> [AZURE.IMPORTANT]

> - Чтобы обеспечить высокую доступность решения StorSimple, рекомендуется настроить MPIO на узле Windows Server (необязательно) перед настройкой iSCSI на узле Windows Server. Настройка MPIO на серверах узлов обеспечит устойчивость серверов к сбоям канала связи, сети или интерфейса.

> - Инструкции по установке и настройке MPIO и iSCSI см. в статье [Настройка MPIO для устройства StorSimple](storsimple-configure-mpio-windows-server.md). Эти инструкции также содержат шаги по подключению, инициализации и форматированию томов StorSimple.

Если вы решили не настраивать MPIO, выполните следующие действия для подключения, инициализации и форматирования томов StorSimple.

[AZURE.INCLUDE [storsimple-mount-initialize-format-volume](../../includes/storsimple-mount-initialize-format-volume.md)]

## Шаг 8. Создание резервной копии

Резервные копии обеспечивают защиту состояния томов до определенной точки во времени и улучают возможности восстановления, одновременно снижая время восстановления. Устройство StorSimple позволяет создавать резервные копии двух типов: локальные и облачные моментальные снимки. Каждый из этих типов резервных копий может создаваться **По расписанию** или **Вручную**.

Чтобы создать запланированное резервное копирование, выполните указанные ниже действия на классическом портале Azure.

[AZURE.INCLUDE [storsimple-take-backup](../../includes/storsimple-take-backup.md)]

Резервное копирование вручную можно выполнить в любое время. Ознакомиться с последовательностью действий для создания резервных копий вручную можно в разделе [Создание резервной копии вручную](#Create-a-manual-backup).

## Настройка новой учетной записи хранения для службы

Это необязательный шаг, который вам потребуется выполнить, только если вы не использовали возможность автоматически создать учетную запись хранения для вашей службы. Учетная запись хранения Microsoft Azure необходима для создания контейнера томов StorSimple.

Если вам нужно создать учетную запись хранения Azure в другом регионе, пошаговые инструкции см. в разделе [Об учетных записях хранения Azure](../storage/storage-create-storage-account.md).

На классическом портале Azure на странице **Служба диспетчера StorSimple** выполните следующее.

[AZURE.INCLUDE [storsimple-configure-new-storage-account](../../includes/storsimple-configure-new-storage-account.md)]


## Подключение к последовательной консоли устройства с помощью PuTTY

Чтобы выполнить подключения к Windows PowerShell для StorSimple, вам потребуется программное обеспечение эмуляции терминала, например PuTTY. Вы можете использовать PuTTY при прямом доступе к устройству через последовательную консоль либо в случае, если откроете сеанс telnet на удаленном компьютере.

[AZURE.INCLUDE [Подключение к последовательной консоли устройства с помощью PuTTY](../../includes/storsimple-use-putty.md)]

## Проверка наличия обновлений и их применение

Обновление устройства может занять от 1 до 4 часов. Выполните следующие действия, чтобы проверить наличие обновлений и применить их на своем устройстве.

> [AZURE.NOTE] Если шлюз настроен на сетевом интерфейсе, отличном от Data 0, перед установкой обновления необходимо будет отключить сетевые интерфейсы Data 2 и Data 3. Перейдите в раздел **Устройства > Настроить** и отключите интерфейсы Data 2 и Data 3. Эти интерфейсы необходимо будет снова включить после обновления устройства.

#### Обновление устройства
1.	На странице устройства **Быстрый запуск** щелкните **Устройства**. Выберите физическое устройство, нажмите кнопку **Обслуживание**, а затем нажмите **Проверить обновления**.  
2.	Будет создано задание поиска доступных обновлений. Если обновления доступны, кнопка **Проверить обновления** изменится на **Установить обновления**. Нажмите **Установить обновления**. Перед установкой обновлений может появиться сообщение о необходимости отключить интерфейсы Data 2 и Data 3. Эти сетевые интерфейсы необходимо отключить, иначе обновления могут завершиться ошибкой.
3.	Будет создано задание обновления. Отслеживайте статус обновления в разделе **Задания**.

	> [AZURE.NOTE] При запуске задания обновления его статус сразу отображается на уровне 50 процентов. Статус изменяется на 100 процентов только после завершения задания обновления. Статус процесса обновления в реальном времени не отображается.

4.	После успешного обновления устройства включите сетевые интерфейсы Data 2 и Data 3, если они были отключены.



## Получение IQN узла Windows Server

Выполните следующие действия, чтобы получить полное имя iSCSI (IQN) узла Windows, который работает под управлением Windows Server 2012.

[AZURE.INCLUDE [Создание резервной копии вручную](../../includes/storsimple-get-iqn.md)]


## Создание резервной копии вручную

Чтобы вручную запустить резервное копирование отдельного тома на устройстве StorSimple, на классическом портале Azure выполните указанные ниже действия.

[AZURE.INCLUDE [Создание резервной копии вручную](../../includes/storsimple-create-manual-backup.md)]


## Дальнейшие действия

- Настройте [виртуальное устройство](storsimple-virtual-device.md).

- Для управления устройством StorSimple используется [служба Диспетчера StorSimple](https://msdn.microsoft.com/library/azure/dn772396.aspx).

<!---HONumber=AcomDC_0128_2016-->