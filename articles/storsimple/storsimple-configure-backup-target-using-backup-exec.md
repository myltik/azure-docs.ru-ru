---
title: Использование StorSimple серии 8000 в качестве целевого объекта архивации с помощью Backup Exec | Документация Майкрософт
description: Описание настройки целевого объекта архивации StorSimple с помощью Veritas Backup Exec.
services: storsimple
documentationcenter: ''
author: harshakirank
manager: matd
editor: ''
ms.assetid: ''
ms.service: storsimple
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 12/05/2016
ms.author: hkanna
ms.openlocfilehash: a28b46e10bbdd5331cc665fad3f80523b3aa8a58
ms.sourcegitcommit: 6fcd9e220b9cd4cb2d4365de0299bf48fbb18c17
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2018
---
# <a name="storsimple-as-a-backup-target-with-backup-exec"></a>Использование StorSimple в качестве целевого объекта архивации с помощью Backup Exec

## <a name="overview"></a>Обзор

Azure StorSimple — это решение гибридного облачного хранилища от Майкрософт. StorSimple позволяет устранить проблемы, связанные с экспоненциальным увеличением объема данных. Для этого учетная запись хранения Azure используется в качестве расширения локального решения, а данные автоматически распределяются по уровням в локальном и облачном хранилище.

В этой статье представлены сведения об интеграции StorSimple с Veritas Backup Exec и рекомендации по интеграции этих решений. Вы также найдете здесь рекомендации по настройке Backup Exec для эффективной интеграции со StorSimple. Мы обратились к экспертам, специалистам по архивации и администраторам Veritas, чтобы узнать, как лучше всего настроить Backup Exec в соответствии с отдельными требованиями к архивации и соглашениями об уровне обслуживания.

В этой статье представлена процедура настройки и основные понятия. Однако она отнюдь не является пошаговым руководством по настройке или установке. Здесь предполагается, что основные компоненты и инфраструктура работоспособны и подготовлены для поддержки описываемых компонентов.

### <a name="who-should-read-this"></a>Для кого предназначена эта статья?

Эта статья предназначена для администраторов архивации, администраторов и архитекторов хранилища с опытом работы с хранилищами, Windows Server 2012 R2, Ethernet, облачными службами и Backup Exec.

## <a name="supported-versions"></a>Поддерживаемые версии

-   [Backup Exec 16 и более поздних версий](http://backupexec.com/compatibility)
-   [StorSimple с обновлением 3 и более поздних версий](storsimple-overview.md#storsimple-workload-summary)


## <a name="why-storsimple-as-a-backup-target"></a>Причины использования StorSimple в качестве целевого объекта архивации

StorSimple оптимально подходит для целевого объекта архивации по следующим причинам.

-   Это решение предоставляет стандартное локальное хранилище для приложений архивации, которое можно использовать, ничего не изменяя. Таким образом, вы быстро получаете расположение для резервных копий. StorSimple также обеспечивает быстрое восстановление последних резервных копий.
-   Возможность распределения по уровням облака без проблем интегрируется с учетной записью облачного хранилища Azure, благодаря чему вы можете воспользоваться экономичной службой хранилища Azure.
-   Это решение автоматически предоставляет автономное хранилище для аварийного восстановления.

## <a name="key-concepts"></a>Основные понятия

Для успешной работы этого решения, как и для любого другого решения хранилища, крайне важно провести тщательный анализ производительности решения хранилища, соглашения об уровне обслуживания, скорости изменений и потребности относительно увеличения емкости. Основная мысль состоит в том, что при реализации облачного уровня важную роль в работе StorSimple играют время доступа и пропускная способность облака.

Решение StorSimple предназначено для предоставления хранилища для приложений, работающих с четко определенным набором рабочих данных ("горячие данные"). В этой модели набор рабочих данных хранится на локальном уровне, а остальные наборы нерабочих, "холодных" и архивированных данных распределяются по уровням в облаке. Эта модель показана на рисунке ниже. Практически плоская зеленая линия представляет собой данные, хранящиеся на локальных уровнях устройства StorSimple. Красная линия представляет собой общий объем данных, хранящихся на всех уровнях в решении StorSimple. Расстояние между плоский зеленой линией и экспоненциальной красной кривой представляет собой общий объем данных, хранящихся в облаке.

**Распределение по уровням в StorSimple**
![Схема распределения по уровням в StorSimple](./media/storsimple-configure-backup-target-using-backup-exec/image1.jpg)

Благодаря такой архитектуре StorSimple идеально подходит для использования в качестве целевого объекта архивации. Вы можете использовать StorSimple, чтобы:
-   часто восстанавливать локальный рабочий набор данных;
-   использовать облако для автономного хранения и аварийного восстановления старых данных, которое выполняется не так часто.

## <a name="storsimple-benefits"></a>Преимущества StorSimple

StorSimple предоставляет локальное решение, без проблем интегрирующееся с Microsoft Azure за счет простого доступа к локальному и облачному хранилищу.

StorSimple использует автоматическое распределение по уровням между локальным устройством, содержащим устройство с твердотельными накопителями (SSD) и хранилище с последовательным подключением SCSI (SAS), и службой хранилища Azure. Благодаря автоматическому распределению по уровням часто используемые данные хранятся локально, на уровнях SSD и SAS, а редко используемые данные перемещаются в службу хранилища Azure.

StorSimple предоставляет следующие преимущества:

-   Уникальные алгоритмы дедупликации и сжатия, использующие облако для обеспечения беспрецедентного уровня дедупликации.
-   высокую доступность;
-   Георепликация на основе технологий Azure.
-   Интеграция Azure.
-   Шифрование данных в облаке.
-   Усовершенствованное аварийное восстановление и соответствие

Хотя StorSimple представляет два основных сценария развертывания (основной и дополнительный целевой объект архивации), это просто обычное устройство блочного хранилища. StorSimple выполняет сжатие и дедупликацию. Это решение также 	беспроблемно получает данные из облака и отправляет их в приложение и файловую систему.

Дополнительные сведения о StorSimple см. в статье [Серия StorSimple 8000: решение гибридного облачного хранилища](storsimple-overview.md). Кроме того, вы можете просмотреть статью [Технические характеристики и информация о соответствии нормативным требованиям для устройства StorSimple](storsimple-technical-specifications-and-compliance.md).

> [!IMPORTANT]
> Использование устройства StorSimple в качестве целевого объекта архивации поддерживается только для StorSimple 8000 с обновлением 3 или более поздней версии.

## <a name="architecture-overview"></a>Общие сведения об архитектуре

В следующих таблицах представлены основные рекомендации по моделям и архитектуре устройства.

**Емкость StorSimple для локального и облачного хранилища**

| Емкость хранилища       | 8100          | 8600            |
|------------------------|---------------|-----------------|
| Емкость локального хранилища | &lt;10 ТиБ\*  | &lt;20 ТиБ\*  |
| Емкость облачного хранилища | &gt;200 ТиБ\* | &gt;500 ТиБ\* |
\* В размере хранилища предполагается, что дедупликация и сжатие не используются.

**Емкость StorSimple для основных и дополнительных резервных копий**

| Сценарий архивации  | Емкость локального хранилища  | Емкость облачного хранилища  |
|---|---|---|
| Основная резервная копия  | Последние резервные копии содержатся в локальном хранилище для быстрого восстановления, чтобы соответствовать целевой точке восстановления (RPO). | Журнал архивации (RPO) помещается в облаке. |
| Дополнительная резервная копия | Дополнительную копию резервных данных можно хранить в облаке.  | Недоступно  |

## <a name="storsimple-as-a-primary-backup-target"></a>Использование StorSimple в качестве основного целевого объекта архивации

В этом случае тома StorSimple предоставляются приложению архивации в качестве единственного хранилища резервных копий. На этом рисунке показана архитектура решения, где все резервные копии используют многоуровневые тома StorSimple для архивации и восстановления.

![Логическая схема использования StorSimple в качестве основного целевого объекта архивации](./media/storsimple-configure-backup-target-using-backup-exec/primarybackuptargetlogicaldiagram.png)

### <a name="primary-target-backup-logical-steps"></a>Логическая процедура архивации основного целевого объекта

1.  Сервер архивации обращается к целевому агенту архивации, который передает ему данные.
2.  Сервер архивации записывает данные на многоуровневые тома StorSimple.
3.  Сервер архивации обновляет базу данных каталога и завершает задание архивации.
4.  Скрипт создания моментальных снимков активирует диспетчер облачных моментальных снимков StorSimple (запуск и удаление).
5.  В зависимости от политики периода удержания сервер архивации удаляет недействительные резервные копии.


### <a name="primary-target-restore-logical-steps"></a>Логическая процедура восстановления основного целевого объекта

1.  Сервер архивации начинает восстанавливать соответствующие данные из репозитория хранилища.
2.  Агент архивации получает данные с сервера архивации.
3.  Сервер архивации завершает задание восстановления.

## <a name="storsimple-as-a-secondary-backup-target"></a>Использование StorSimple в качестве дополнительного целевого объекта архивации

В этом случае тома StorSimple в основном используются для долгосрочного хранения и архивирования.

На следующем рисунке показана архитектура, где исходные резервные копии и восстанавливаемые данные сохраняются в высокопроизводительном томе. Эти резервные копии по заданному расписанию копируются и архивируются в многоуровневый том StorSimple.

Очень важно определить размер высокопроизводительного тома в соответствии с требованиями политики периода удержания к емкости и производительности.

![Логическая схема использования StorSimple в качестве дополнительного целевого объекта архивации](./media/storsimple-configure-backup-target-using-backup-exec/secondarybackuptargetlogicaldiagram.png)

### <a name="secondary-target-backup-logical-steps"></a>Логическая процедура архивации дополнительного целевого объекта

1.  Сервер архивации обращается к целевому агенту архивации, который передает ему данные.
2.  Сервер архивации записывает данные в высокопроизводительное хранилище.
3.  Сервер архивации обновляет базу данных каталога и завершает задание архивации.
4.  В зависимости от политики периода удержания сервер архивации копирует резервные копии в StorSimple.
5.  Скрипт создания моментальных снимков активирует диспетчер облачных моментальных снимков StorSimple (запуск и удаление).
6.  В зависимости от политики периода удержания сервер архивации удаляет недействительные резервные копии.

### <a name="secondary-target-restore-logical-steps"></a>Логическая процедура восстановления дополнительного целевого объекта

1.  Сервер архивации начинает восстанавливать соответствующие данные из репозитория хранилища.
2.  Агент архивации получает данные с сервера архивации.
3.  Сервер архивации завершает задание восстановления.

## <a name="deploy-the-solution"></a>Развертывание решения

Развертывание решения состоит из трех шагов.
1. Подготовка сетевой инфраструктуры.
2. Развертывание устройства StorSimple в качестве целевого объекта архивации.
3. Развертывание Backup Exec.

Каждый этап подробно описан в следующих разделах.

### <a name="set-up-the-network"></a>Настройка сети

StorSimple является решением, интегрированным с облаком Azure, и поэтому ему требуется активное действующее подключение к этому облаку. Это подключение используется для создания облачных моментальных снимков, управления, передачи метаданных и распределения старых, редко используемых данных по уровням в облачном хранилище Azure.

Для оптимальной работы решения мы советуем придерживаться следующих рекомендаций по сетям.

-   Канал связи между распределением по уровням StorSimple и Azure должен соответствовать требованиям к пропускной способности. Для этого необходимо, чтобы качество обслуживания параметров инфраструктуры было таким, как указано в соглашениях об уровне обслуживания для RPO и целевого времени восстановления (RTO).
-   Максимальная задержка доступа к хранилищу BLOB-объектов Azure должна находиться в пределах 80 мс.

### <a name="deploy-storsimple"></a>Развертывание StorSimple

Пошаговое руководство по развертыванию StorSimple см. в статье [Развертывание локального устройства StorSimple (с обновлением 2)](storsimple-deployment-walkthrough-u2.md).

### <a name="deploy-backup-exec"></a>Развертывание Backup Exec

Рекомендации по установке Backup Exec см. [здесь](https://www.veritas.com/support/en_US/article.000068207).

## <a name="set-up-the-solution"></a>Настройка решения

В этом разделе представлены некоторые примеры настройки. В следующих рекомендациях и примерах продемонстрирована простейшая базовая реализация. Эта реализация может не соответствовать конкретным требованиям к архивации.

### <a name="set-up-storsimple"></a>Настройка StorSimple

| Задачи развертывания StorSimple  | Дополнительные комментарии |
|---|---|
| Развертывание локального устройства StorSimple | Поддерживаемые версии: обновление 3 и более поздних версий. |
| Включение целевого объекта архивации | Используйте следующие команды, чтобы включить или отключить режим целевого объекта архивации и получить информацию о состоянии. Дополнительные сведения см. в статье [Удаленное подключение к устройству StorSimple](storsimple-remote-connect.md).</br> Чтобы включить режим архивации, выполните следующую команду: `Set-HCSBackupApplianceMode -enable`. </br> Чтобы отключить режим архивации, выполните следующую команду: `Set-HCSBackupApplianceMode -disable`. </br> Для получения текущего состояния параметров режима архивации выполните следующую команду: `Get-HCSBackupApplianceMode`. |
| Создайте общий контейнер томов для тома, на котором хранятся резервные данные. Все данные в контейнере томов дедуплицируются | Контейнеры томов StorSimple определяют домены дедупликации.  |
| Создание тома StorSimple | Создайте тома с размерами, максимально соответствующими тому, который предположительно будет использоваться, так как от размера тома зависит время создания облачных моментальных снимков. Дополнительные сведения об определении размера тома см. в разделе [Политики периода удержания](#retention-policies).</br> </br> Используйте многоуровневые тома StorSimple и установите флажок **Используйте этот том для архивных данных, доступ к которым осуществляется нечасто**. </br> Использование только локально закрепленных томов не поддерживается. |
| Создайте уникальную политику архивации StorSimple для всех целевых томов архивации. | Политика архивации StorSimple определяет группу согласованности томов. |
| Отключение расписания при истечении срока действия моментальных снимков | Моментальные снимки активируются в качестве операции постобработки. |

### <a name="set-up-the-host-backup-server-storage"></a>Настройка хранилища сервера архивации узла

Настройте хранилище сервера архивации узла, следуя указанным ниже рекомендациям.  

- Не используйте составные тома (созданные с помощью службы Windows Disk Management). Составные диски не поддерживаются.
- Отформатируйте тома с помощью NTFS с размером выделения 64 КБ.
- Сопоставьте тома StorSimple с сервером Backup Exec.
    - Используйте iSCSI для физических серверов.
    - Используйте транзитные диски для виртуальных серверов.

## <a name="best-practices-for-storsimple-and-backup-exec"></a>Рекомендации по StorSimple и Backup Exec

Настройте решение согласно рекомендациям в следующих разделах.

### <a name="operating-system-best-practices"></a>Рекомендации по операционной системе

-   Отключите шифрование и дедупликацию Windows Server для файловой системы NTFS.
-   Отключите дефрагментацию Windows Server для томов StorSimple.
-   Отключите индексацию Windows Server для томов StorSimple.
-   Выполните антивирусное сканирование исходного узла (не для томов StorSimple).
-   Отключите [обслуживание Windows Server](https://msdn.microsoft.com/library/windows/desktop/hh848037.aspx), включенное по умолчанию, в диспетчере задач. Выполните это действие одним из следующих способов.
   - Отключите средство настройки обслуживания в планировщике заданий Windows.
   - Скачайте программу [PsExec](https://technet.microsoft.com/sysinternals/bb897553.aspx) из Windows Sysinternals. После этого запустите Azure PowerShell от имени администратора и введите следующее:
      ```powershell
      psexec \\%computername% -s schtasks /change /tn “MicrosoftWindowsTaskSchedulerMaintenance Configurator" /disable
      ```

### <a name="storsimple-best-practices"></a>Рекомендации по StorSimple

  -   Убедитесь, что для устройства StorSimple установлено [обновление 3 или более поздней версии](storsimple-install-update-3.md).
  -   Изолируйте трафик iSCSI и облака. Используйте выделенное подключение iSCSI для трафика между StorSimple и сервером архивации.
  -   Проверьте, является ли устройство StorSimple выделенным целевым объектом архивации. Смешанные рабочие нагрузки не поддерживаются, так как они влияют на RTO и RPO.

### <a name="backup-exec-best-practices"></a>Рекомендации по Backup Exec

-   Backup Exec необходимо установить на локальном диске сервера, а не на томе StorSimple.
-   Задайте максимально возможное количество **параллельных операций записи** для хранилища Backup Exec.
    -   Задайте для **размера буфера и блока** хранилища Backup Exec 512 КБ.
    -   Включите **буферизацию операций чтения и записи** в хранилище Backup Exec.
-   StorSimple поддерживает полные и добавочные резервные копии Backup Exec. Мы не советуем использовать синтетические и разностные резервные копии.
-   Файлы резервных данных должны содержать только данные для конкретного задания. Например, запрещено добавлять носители для разных заданий.
-   Отключение проверки заданий. При необходимости запланируйте ее после последнего задания архивации. Важно понимать, что это задание влияет на окно архивации.
-   Выберите **Storage** (Хранилище) > **Your disk** (Ваш диск) > **Details** (Сведения) > **Properties** (Свойства). Отключите параметр **Pre-allocate disk space** (Выделить дисковое пространство).

Чтобы просмотреть последние параметры Backup Exec и рекомендации по реализации этих требований, посетите [веб-сайт Veritas](https://www.veritas.com).

## <a name="retention-policies"></a>Политики хранения

Чаще всего используется такая политика хранения резервных копий, как "дед-отец-сын" (GFS). В политике GFS добавочное резервное копирование выполняется ежедневно, а полное — еженедельно и ежемесячно. В результате вы получаете шесть многоуровневых томов StorSimple. Один том содержит полные еженедельные, ежемесячные и ежегодные резервные копии. На пяти других томах хранятся ежедневные добавочные резервные копии.

В следующем примере мы используем схему архивации GFS. В нем предполагается следующее:

-   Используются не дедуплицированные или не сжатые данные.
-   Размер полных резервных копий — 1 ТиБ.
-   Размер ежедневных добавочных резервных копий — 500 ГиБ.
-   Четыре еженедельные резервные копии хранятся в течение месяца.
-   12 ежемесячных резервных копий хранятся в течение года.
-   Одна ежегодная резервная копия хранится в течение 10 лет.

С учетом предыдущих предположений создайте многоуровневый том StorSimple на 26 ТиБ для полных ежемесячных и ежегодных резервных копий. Создайте многоуровневый том StorSimple на 5 ТиБ для каждой из добавочных ежедневных резервных копий.

| Период удержания и тип резервной копии | Размер (ТиБ) | Множитель GFS\* | Общая емкость (ТиБ)  |
|---|---|---|---|
| Еженедельная полная | 1 | 4.  | 4. |
| Ежедневная добавочная | 0,5 | 20 (число циклов соответствует числу недель в месяце) | 12 (2 для дополнительной квоты) |
| Полная ежемесячная | 1 | 12 | 12 |
| Полная ежегодная | 1  | 10 | 10 |
| Требование GFS |   | 38 |   |
| Дополнительная квота  | 4.  |   | Всего: 42 (в соответствии с требованиями GFS)  |
\* Коэффициент GFS — это количество копий, которые требуется защитить и сохранить в соответствии с требованиями политики архивации.

## <a name="set-up-backup-exec-storage"></a>Настройка хранилища Backup Exec

### <a name="to-set-up-backup-exec-storage"></a>Чтобы настроить хранилище Backup Exec, сделайте следующее:

1.  В консоли управления Backup Exec выберите **Storage** (Хранилище) > **Configure Storage** (Настройка хранилища) > **Disk-Based Storage** (Дисковое хранилище) > **Далее**.

    ![Страница настройки хранилища в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image4.png)

2.  Выберите **Disk Storage** (Хранилище дисков), а затем щелкните **Далее**.

    ![Страница выбора хранилища в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image5.png)

3.  Введите соответствующее имя, например **Полное копирование, суббота**, и описание. Щелкните **Далее**.

    ![Страница ввода имени и описания в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image7.png)

4.  Выберите диск, где необходимо создать дисковое запоминающее устройство, а затем щелкните **Далее**.

    ![Страница выбора диска хранилища в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image9.png)

5.  Увеличьте количество операций записи до **16** и нажмите кнопку **Далее**.

    ![Страница настройки количества одновременных операций записи в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image10.png)

6.  Проверьте параметры и нажмите кнопку **Готово**.

    ![Страница сводки по конфигурации хранилища в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image11.png)

7.  После каждого назначения тома изменяйте параметры устройства хранения в соответствии со списком рекомендаций в разделе [Рекомендации по StorSimple и Backup Exec](#best-practices-for-storsimple-and-backup-exec).

    ![Страница параметров устройства хранения в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image12.png)

8.  Повторите шаги 1–7, пока не назначите все тома StorSimple для Backup Exec.

## <a name="set-up-storsimple-as-a-primary-backup-target"></a>Настройка StorSimple в качестве основного целевого объекта архивации

> [!NOTE]
> Восстановление данных из резервной копии, распределенной по уровням в облако, происходит со скоростью облака.

На следующем рисунке представлено сопоставление типичного тома с заданием архивации. В этом случае все еженедельные резервные копии сопоставляются с диском "Полное копирование, суббота", а добавочные резервные копии — с дисками "Понедельник — пятница". Архивация и восстановление выполняются на многоуровневом томе StorSimple.

![Логическая схема конфигурации основного целевого объекта архивации](./media/storsimple-configure-backup-target-using-backup-exec/primarybackuptargetdiagram.png)

### <a name="storsimple-as-a-primary-backup-target-gfs-schedule-example"></a>Пример расписания с использованием схемы "дед-отец-сын" (GFS) для StorSimple в качестве основного целевого объекта архивации

Ниже приведен пример схемы архивации GFS на 4 недели, месяц и год.

| Периодичность и тип архивации | Полное | Добавочная (день 1–5)  |   
|---|---|---|
| Еженедельная (неделя 1–4) | Суббота | Понедельник — пятница |
| Ежемесячная  | Суббота  |   |
| Ежегодная | Суббота  |   |   |


### <a name="assign-storsimple-volumes-to-a-backup-exec-backup-job"></a>Назначение томов StorSimple заданию архивации Backup Exec

В следующей последовательности предполагается, что целевой узел настроен в соответствии с рекомендациями агента Veritas Backup Exec.

#### <a name="to-assign-storsimple-volumes-to-a-backup-exec-backup-job"></a>Чтобы назначить тома StorSimple заданию архивации Backup Exec, сделайте следующее:

1.  В консоли управления Backup Exec выберите **Host** (Узел) > **Backup** (Архивация) > **Backup to Disk** (Архивация на диск).

    ![Параметры Host (Узел), Backup (Архивация) и Backup to Disk (Архивация на диск) в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image14.png)

2.  В диалоговом окне **Backup Definition Properties** (Свойства определения архивации) в разделе **Backup** (Архивация) выберите **Edit** (Изменить).

    ![Диалоговое окно свойств определения архивации в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image15.png)

3.  Настройте полные и добавочные резервные копии в соответствии с требованиями к RPO и RTO и рекомендациями Veritas.

4.  В диалоговом окне **Backup Options** (Параметры архивации) выберите **Storage** (Хранилище).

    ![Диалоговое окно параметров архивации, вкладка Storage (Хранилище) в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image16.png)

5.  Назначьте соответствующие тома StorSimple для расписания архивации.

    > [!NOTE]
    > Для параметров **Compression** (Сжатие) и **Encryption type** (Тип шифрования) задайте значение **None**.

6.  В разделе **Verify** (Проверка) установите флажок **Do not verify data for this job** (Не проверять данные для этого задания). Использование этого параметра может повлиять на распределение по уровням StorSimple.

    > [!NOTE]
    > Дефрагментация, индексирование и фоновая проверка отрицательно влияют на распределение по уровням StorSimple.

    ![Диалоговое окно Backup Options (Параметры архивации), вкладка Verify (Проверка) в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image17.png)

7.  После настройки остальных параметров архивации в соответствии с требованиями нажмите кнопку **ОК**, чтобы завершить.

## <a name="set-up-storsimple-as-a-secondary-backup-target"></a>Настройка StorSimple в качестве дополнительного целевого объекта архивации

> [!NOTE]
>Восстановление данных из резервной копии, распределенной по уровням в облако, происходит со скоростью облака.

В этой модели необходим носитель для хранения (кроме StorSimple), который будет использоваться в качестве временного кэша. Например, том RAID может обеспечивать место, операции ввода-вывода и пропускную способность. Мы рекомендуем использовать RAID 5, 50 и 10.

На следующем рисунке представлены типичные локальные тома (на сервере) с кратким периодом удержания и архивные тома с длительным периодом удержания. В этом сценарии все резервные копии создаются на локальном томе RAID (на сервере). Эти резервные копии периодически копируются и архивируются на архивный том. Очень важно определить размер локального тома RAID (на сервере) в соответствии с требованиями к емкости и производительности для короткого периода удержания.

### <a name="storsimple-as-a-secondary-backup-target-gfs-example"></a>Пример использования схемы GFS для StorSimple в качестве дополнительного целевого объекта архивации

![Логическая схема использования StorSimple в качестве дополнительного целевого объекта архивации](./media/storsimple-configure-backup-target-using-backup-exec/secondarybackuptargetdiagram.png)

В следующей таблице показано, как настроить резервные копии для запуска на локальных дисках и дисках StorSimple. Сюда входят требования к емкости отдельного диска и общей емкости.

### <a name="backup-configuration-and-capacity-requirements"></a>Требования к конфигурации и емкости резервных копий

| Период удержания и тип резервной копии | Настроенное хранилище | Размер (ТиБ) | Множитель GFS | Общая емкость\* (ТиБ) |
|---|---|---|---|---|
| 1-я неделя (полная и добавочная) |Локальный диск (с коротким периодом удержания)| 1 | 1 | 1 |
| StorSimple, со 2-ой по 4-ю неделю |Диск StorSimple (с длительным периодом удержания) | 1 | 4. | 4 |
| Полная ежемесячная |Диск StorSimple (с длительным периодом удержания) | 1 | 12 | 12 |
| Полная ежегодная |Диск StorSimple (с длительным периодом удержания) | 1 | 1 | 1 |
|Размер тома в соответствии с GFS |  |  |  | 18*|
\* Общая емкость включает 17 ТиБ для дисков StorSimple и 1 ТиБ для локального тома RAID.


### <a name="gfs-example-schedule-gfs-rotation-weekly-monthly-and-yearly-schedule"></a>Примеры расписания GFS: еженедельное, ежемесячное и ежегодное расписание по схеме GFS

| Неделя | Полное | Добавочная, день 1 | Добавочная, день 2 | Добавочная, день 3 | Добавочная, день 4 | Добавочная, день 5 |
|---|---|---|---|---|---|---|
| 1-я неделя | Локальный том RAID  | Локальный том RAID | Локальный том RAID | Локальный том RAID | Локальный том RAID | Локальный том RAID |
| 2-я неделя | StorSimple, со 2-ой по 4-ю неделю |   |   |   |   |   |
| 3-я неделя | StorSimple, со 2-ой по 4-ю неделю |   |   |   |   |   |
| 4-я неделя | StorSimple, со 2-ой по 4-ю неделю |   |   |   |   |   |
| Ежемесячная | StorSimple, ежемесячная |   |   |   |   |   |
| Ежегодная | StorSimple, ежегодная  |   |   |   |   |   |   |


### <a name="assign-storsimple-volumes-to-a-backup-exec-archive-and-deduplication-job"></a>Назначение томов StorSimple заданию архивации или дедупликации Backup Exec

#### <a name="to-assign-storsimple-volumes-to-a-backup-exec-archive-and-duplication-job"></a>Чтобы назначить тома StorSimple заданию архивации или дедупликации Backup Exec, сделайте следующее:

1.  В консоли управления Backup Exec щелкните правой кнопкой мыши задание, которое вы хотите архивировать на том StorSimple, и выберите **Backup Definition Properties** (Свойства определения архивации)  > **Edit** (Изменить).

    ![Вкладка Backup Definition Properties (Свойства определения архивации) в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image19.png)

2.  Выберите **Add Stage** (Добавить этап)  > **Duplicate to Disk** (Дублировать на диск)  > **Edit** (Изменить).

    ![Параметр Add Stage (Добавить этап) в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image20.png)

3.  В диалоговом окне **Duplicate Options** (Параметры дублирования) выберите значения, которые вы хотите использовать для **источника** и **расписания**.

    ![Вкладка Backup Definitions Properties (Свойства определения архивации), Duplicate Options (Параметры дублирования) в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image21.png)

4.  В раскрывающемся списке **Storage** (Хранилище) выберите том StorSimple, на который нужно сохранить данные задания архивации.

    ![Вкладка Backup Definitions Properties (Свойства определения архивации), Duplicate Options (Параметры дублирования) в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image22.png)

5.  Выберите **Verify** (Проверка), а затем установите флажок **Do not verify data for this job** (Не проверять данные для этого задания).

    ![Вкладка Backup Definitions Properties (Свойства определения архивации), Duplicate Options (Параметры дублирования) в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image23.png)

6.  Нажмите кнопку **ОК**.

    ![Вкладка Backup Definitions Properties (Свойства определения архивации), Duplicate Options (Параметры дублирования) в консоли управления Backup Exec](./media/storsimple-configure-backup-target-using-backup-exec/image24.png)

7.  В столбце **Backup** (Архивация) добавьте новый этап. В качестве источника выберите **добавочное задание архивации**. В качестве целевого объекта — том StorSimple, на котором находится заархивированное задание добавочной архивации. Повторите шаги 1–6.

## <a name="storsimple-cloud-snapshots"></a>Облачные моментальные снимки StorSimple

Облачные моментальные снимки StorSimple обеспечивают защиту данных на устройстве StorSimple. Создание облачного моментального снимка эквивалентно доставке лент локального резервного копирования в удаленное помещение. При использовании геоизбыточного хранилища Azure оно эквивалентно доставке лент резервного копирования на несколько сайтов. Если после сбоя нужно восстановить устройство, можно запустить другое устройство StorSimple и выполнить отработку отказа. После отработки отказа вы сможете получить доступ к данным (со скоростью облака) из последнего облачного моментального снимка.

В разделе ниже показано, как создать короткий скрипт для запуска и удаления облачных моментальных снимков StorSimple во время постобработки резервной копии.

> [!NOTE]
> На созданные вручную или с помощью программных средств моментальные снимки не распространяется политика истечения срока действия моментальных снимков StorSimple. Их нужно удалять вручную или программным способом.

### <a name="start-and-delete-cloud-snapshots-by-using-a-script"></a>Запуск и удаление облачных моментальных снимков с помощью скрипта

> [!NOTE]
> Перед удалением моментального снимка StorSimple тщательно оцените последствия для соответствия требованиям и хранения данных. Дополнительные сведения о выполнении скрипта после архивации см. в [документации по Backup Exec](https://www.veritas.com/support/en_US/15047.html).

### <a name="backup-lifecycle"></a>Жизненный цикл резервной копии

![Схема жизненного цикла резервной копии](./media/storsimple-configure-backup-target-using-backup-exec/backuplifecycle.png)

### <a name="requirements"></a>Требования

-   Сервер, на котором выполняется скрипт, должен иметь доступ к облачным ресурсам Azure.
-   У учетной записи пользователя должны быть необходимые разрешения.
-   Для политики архивации StorSimple должны быть настроены, но не включены связанные тома StorSimple.
-   Вам понадобится имя ресурса, регистрационный ключ, имя устройства и идентификатор политики архивации StorSimple.

### <a name="to-start-or-delete-a-cloud-snapshot"></a>Запуск или удаление моментального снимка облака

1.  [Установите Azure PowerShell](/powershell/azure/overview).
2. Скачайте и установите скрипт [Manage-CloudSnapshots.ps1](https://github.com/anoobbacker/storsimpledevicemgmttools/blob/master/Manage-CloudSnapshots.ps1) PowerShell.
3. На сервере, на котором запускается скрипт, запустите PowerShell от имени администратора. Запустите скрипт с параметром `-WhatIf $true`, чтобы просмотреть внесенные изменения. Когда проверка будет завершена, передайте параметр `-WhatIf $false`. Выполните следующую команду:
```powershell
.\Manage-CloudSnapshots.ps1 -SubscriptionId [Subscription Id] -TenantId [Tenant ID] -ResourceGroupName [Resource Group Name] -ManagerName [StorSimple Device Manager Name] -DeviceName [device name] -BackupPolicyName [backup policyname] -RetentionInDays [Retention days] -WhatIf [$true or $false]
```
4.  Добавьте скрипт к заданию архивации в Backup Exec, изменив команды предварительной и окончательной публикации параметров задания Backup Exec.

    ![Консоль Backup Exec, Backup Options (Параметры архивации), вкладка Pre/Post Commands (Команды предварительной и окончательной публикации)](./media/storsimple-configure-backup-target-using-backup-exec/image25.png)

> [!NOTE]
> Мы советуем запустить политику архивации облачных моментальных снимков StorSimple в качестве скрипта постобработки по завершении задания ежедневной архивации. Дополнительные сведения об архивации и восстановлении среды приложения архивации в соответствии с RPO и RTO можно получить у архитектора по архивации.

## <a name="storsimple-as-a-restore-source"></a>Использование StorSimple в качестве источника восстановления

Восстановление из устройства StorSimple действует аналогично восстановлению из любого устройства блочного хранилища. Восстановление данных, распределенных по уровням в облаке, выполняется со скоростью облака. Восстановление локальных данных выполняется со скоростью локального диска устройства. Дополнительные сведения о выполнении восстановления см. в документации по Backup Exec. Мы советуем следовать рекомендациям по восстановлению Backup Exec.

## <a name="storsimple-failover-and-disaster-recovery"></a>Отработка отказа и аварийное восстановление для устройства StorSimple

> [!NOTE]
> Для сценариев с использованием целевого объекта архивации облачное устройство StorSimple не поддерживается в качестве целевого объекта восстановления.

Сбой может быть вызван множеством факторов. В следующей таблице перечислены распространенные сценарии аварийного восстановления.

| Сценарий | Влияние | Восстановление | Заметки |
|---|---|---|---|
| Сбой устройства StorSimple | Операции архивации и восстановления будут прерваны. | Замените неисправное устройство и выполните [отработку отказа и аварийное восстановление StorSimple](storsimple-device-failover-disaster-recovery.md). | Если после восстановления устройства требуется выполнить восстановление, все рабочие наборы данных извлекаются из облака на новое устройство. Все операции будут выполняться со скоростью облака. При повторном сканировании во время индексации и каталогизации все наборы резервных копий будут отсканированы и извлечены из облачного уровня на уровень локального устройства, что может занять много времени. |
| Сбой сервера Backup Exec | Операции архивации и восстановления будут прерваны. | Создайте сервер архивации повторно и восстановите базу данных, как описано в руководстве по [архивации и восстановлению базы данных Backup Exec вручную](http://www.veritas.com/docs/000041083). | На сайте аварийного восстановления необходимо повторно создать или восстановить сервер Backup Exec. Восстановите базу данных до последней точки. Если восстановленная база данных Backup Exec не синхронизирована с последним заданием архивации, требуется индексирование и каталогизация. При повторном сканировании во время индексации и каталогизации все наборы резервных копий будут отсканированы и извлечены из облачного уровня на уровень локального устройства. Поэтому следует учитывать ограничения по времени. |
| Сбой узла, который приводит к потере сервера архивации и StorSimple | Операции архивации и восстановления будут прерваны. | Сначала восстановите StorSimple, а затем — Backup Exec. | Сначала восстановите StorSimple, а затем — Backup Exec. Если после восстановления устройства требуется выполнить восстановление, все рабочие наборы данных извлекаются из облака на новое устройство. Все операции будут выполняться со скоростью облака. |

## <a name="references"></a>Ссылки

В этой статье содержатся ссылки на следующие документы:

- [Настройка функции Multipath I/O для устройства StorSimple](storsimple-configure-mpio-windows-server.md)
- [Storage scenarios: Thin provisioning](http://msdn.microsoft.com/library/windows/hardware/dn265487.aspx) (Сценарии хранилища: тонкая подготовка)
- [Using GPT drives](http://msdn.microsoft.com/windows/hardware/gg463524.aspx#EHD) (Использование дисков GPT)
- [Включение и настройка теневых копий общих папок](http://technet.microsoft.com/library/cc771893.aspx)

## <a name="next-steps"></a>Дополнительная информация

- Узнайте, как выполнить [восстановление из набора резервных копий](storsimple-restore-from-backup-set-u2.md).
- Узнайте, как выполнить [отработку отказа и аварийное восстановление устройства](storsimple-device-failover-disaster-recovery.md).
