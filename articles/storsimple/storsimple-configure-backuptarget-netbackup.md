---
title: Использование StorSimple серии 8000 в качестве целевого объекта архивации с помощью NetBackup | Документация Майкрософт
description: Описание настройки целевого объекта архивации StorSimple с помощью Veritas NetBackup.
services: storsimple
documentationcenter: ''
author: harshakirank
manager: matd
editor: ''
ms.assetid: ''
ms.service: storsimple
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 06/15/2017
ms.author: hkanna
ms.openlocfilehash: b1878c181a77ac6d54654fc55228907743243c45
ms.sourcegitcommit: 6fcd9e220b9cd4cb2d4365de0299bf48fbb18c17
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2018
ms.locfileid: "23112842"
---
# <a name="storsimple-as-a-backup-target-with-netbackup"></a>Использование StorSimple в качестве целевого объекта архивации с помощью NetBackup

## <a name="overview"></a>Обзор

Azure StorSimple — это решение гибридного облачного хранилища от Майкрософт. StorSimple позволяет устранить проблемы, связанные с экспоненциальным увеличением объема данных. Для этого учетная запись хранения Azure используется в качестве расширения локального решения, а данные автоматически распределяются по уровням в локальном и облачном хранилище.

В этой статье представлены сведения об интеграции StorSimple с Veritas NetBackup и рекомендации по интеграции этих решений. Вы также найдете здесь рекомендации по настройке Veritas NetBackup для эффективной интеграции со StorSimple. Мы обратились к экспертам, специалистам по архивации и администраторам Veritas, чтобы узнать, как лучше всего настроить Veritas NetBackup в соответствии с отдельными требованиями к архивации и соглашениями об уровне обслуживания.

В этой статье представлена процедура настройки и основные понятия. Однако она отнюдь не является пошаговым руководством по настройке или установке. Здесь предполагается, что основные компоненты и инфраструктура работоспособны и подготовлены для поддержки описываемых компонентов.

### <a name="who-should-read-this"></a>Для кого предназначена эта статья?

Эта статья предназначена для администраторов архивации, администраторов и архитекторов хранилища с опытом работы с хранилищами, Windows Server 2012 R2, Ethernet, облачными службами и Veritas NetBackup.

### <a name="supported-versions"></a>Поддерживаемые версии

-   NetBackup 7.7.x и более поздних версий
-   [StorSimple с обновлением 3 и более поздних версий](storsimple-overview.md#storsimple-workload-summary)


## <a name="why-storsimple-as-a-backup-target"></a>Причины использования StorSimple в качестве целевого объекта архивации

StorSimple оптимально подходит для целевого объекта архивации по следующим причинам.

-   Это решение предоставляет стандартное локальное хранилище для приложений архивации, которое можно использовать, ничего не изменяя. Таким образом, вы быстро получаете расположение для резервных копий. StorSimple также обеспечивает быстрое восстановление последних резервных копий.
-   Возможность распределения по уровням облака без проблем интегрируется с учетной записью облачного хранилища Azure, благодаря чему вы можете воспользоваться экономичной службой хранилища Azure.
-   Это решение автоматически предоставляет автономное хранилище для аварийного восстановления.

## <a name="key-concepts"></a>Основные понятия

Для успешной работы этого решения, как и для любого другого решения хранилища, крайне важно провести тщательный анализ производительности решения хранилища, соглашения об уровне обслуживания, скорости изменений и потребности относительно увеличения емкости. Основная мысль состоит в том, что при реализации облачного уровня важную роль в работе StorSimple играют время доступа и пропускная способность облака.

Решение StorSimple предназначено для предоставления хранилища для приложений, работающих с четко определенным набором рабочих данных ("горячие данные"). В этой модели набор рабочих данных хранится на локальном уровне, а остальные наборы нерабочих, "холодных" и архивированных данных распределяются по уровням в облаке. Эта модель показана на рисунке ниже. Практически плоская зеленая линия представляет собой данные, хранящиеся на локальных уровнях устройства StorSimple. Красная линия представляет собой общий объем данных, хранящихся на всех уровнях в решении StorSimple. Расстояние между плоский зеленой линией и экспоненциальной красной кривой представляет собой общий объем данных, хранящихся в облаке.

**Распределение по уровням в StorSimple**
![Схема распределения по уровням в StorSimple](./media/storsimple-configure-backup-target-using-netbackup/image1.jpg)

Благодаря такой архитектуре StorSimple идеально подходит для использования в качестве целевого объекта архивации. Вы можете использовать StorSimple, чтобы:
-   часто восстанавливать локальный рабочий набор данных;
-   использовать облако для автономного хранения и аварийного восстановления старых данных, которое выполняется не так часто.

## <a name="storsimple-benefits"></a>Преимущества StorSimple

StorSimple предоставляет локальное решение, без проблем интегрирующееся с Microsoft Azure за счет простого доступа к локальному и облачному хранилищу.

StorSimple использует автоматическое распределение по уровням между локальным устройством, содержащим устройство с твердотельными накопителями (SSD) и хранилище с последовательным подключением SCSI (SAS), и службой хранилища Azure. Благодаря автоматическому распределению по уровням часто используемые данные хранятся локально, на уровнях SSD и SAS, а редко используемые данные перемещаются в службу хранилища Azure.

StorSimple предоставляет следующие преимущества:

-   Уникальные алгоритмы дедупликации и сжатия, использующие облако для обеспечения беспрецедентного уровня дедупликации.
-   высокую доступность;
-   Георепликация на основе технологий Azure.
-   Интеграция Azure.
-   Шифрование данных в облаке.
-   Усовершенствованное аварийное восстановление и соответствие

Хотя StorSimple представляет два основных сценария развертывания (основной и дополнительный целевой объект архивации), это просто обычное устройство блочного хранилища. StorSimple выполняет сжатие и дедупликацию. Это решение также 	беспроблемно получает данные из облака и отправляет их в приложение и файловую систему.

Дополнительные сведения о StorSimple см. в статье [Серия StorSimple 8000: решение гибридного облачного хранилища](storsimple-overview.md). Кроме того, вы можете просмотреть статью [Технические характеристики и информация о соответствии нормативным требованиям для устройства StorSimple](storsimple-technical-specifications-and-compliance.md).

> [!IMPORTANT]
> Использование устройства StorSimple в качестве целевого объекта архивации поддерживается только для StorSimple 8000 с обновлением 3 или более поздней версии.

## <a name="architecture-overview"></a>Общие сведения об архитектуре

В следующих таблицах представлены основные рекомендации по моделям и архитектуре устройства.

**Емкость StorSimple для локального и облачного хранилища**

| Емкость хранилища       | 8100          | 8600            |
|------------------------|---------------|-----------------|
| Емкость локального хранилища | &lt;10 ТиБ\*  | &lt;20 ТиБ\*  |
| Емкость облачного хранилища | &gt;200 ТиБ\* | &gt;500 ТиБ\* |
\* В размере хранилища предполагается, что дедупликация и сжатие не используются.

**Емкость StorSimple для основных и дополнительных резервных копий**

| Сценарий архивации  | Емкость локального хранилища  | Емкость облачного хранилища  |
|---|---|---|
| Основная резервная копия  | Последние резервные копии содержатся в локальном хранилище для быстрого восстановления, чтобы соответствовать целевой точке восстановления (RPO). | Журнал архивации (RPO) помещается в облаке. |
| Дополнительная резервная копия | Дополнительную копию резервных данных можно хранить в облаке.  | Недоступно  |

## <a name="storsimple-as-a-primary-backup-target"></a>Использование StorSimple в качестве основного целевого объекта архивации

В этом случае тома StorSimple предоставляются приложению архивации в качестве единственного хранилища резервных копий. На этом рисунке показана архитектура решения, где все резервные копии используют многоуровневые тома StorSimple для архивации и восстановления.

![Логическая схема использования StorSimple в качестве основного целевого объекта архивации](./media/storsimple-configure-backup-target-using-netbackup/primarybackuptargetlogicaldiagram.png)

### <a name="primary-target-backup-logical-steps"></a>Логическая процедура архивации основного целевого объекта

1.  Сервер архивации обращается к целевому агенту архивации, который передает ему данные.
2.  Сервер архивации записывает данные на многоуровневые тома StorSimple.
3.  Сервер архивации обновляет базу данных каталога и завершает задание архивации.
4.  Скрипт создания моментальных снимков активирует диспетчер моментальных снимков StorSimple (запуск и удаление).
5.  В зависимости от политики периода удержания сервер архивации удаляет недействительные резервные копии.

### <a name="primary-target-restore-logical-steps"></a>Логическая процедура восстановления основного целевого объекта

1.  Сервер архивации начинает восстанавливать соответствующие данные из репозитория хранилища.
2.  Агент архивации получает данные с сервера архивации.
3.  Сервер архивации завершает задание восстановления.

## <a name="storsimple-as-a-secondary-backup-target"></a>Использование StorSimple в качестве дополнительного целевого объекта архивации

В этом случае тома StorSimple в основном используются для долгосрочного хранения и архивирования.

На следующем рисунке показана архитектура, где исходные резервные копии и восстанавливаемые данные сохраняются в высокопроизводительном томе. Эти резервные копии по заданному расписанию копируются и архивируются в многоуровневый том StorSimple.

Очень важно определить размер высокопроизводительного тома в соответствии с требованиями политики периода удержания к емкости и производительности.

![Логическая схема использования StorSimple в качестве дополнительного целевого объекта архивации](./media/storsimple-configure-backup-target-using-netbackup/secondarybackuptargetlogicaldiagram.png)

### <a name="secondary-target-backup-logical-steps"></a>Логическая процедура архивации дополнительного целевого объекта

1.  Сервер архивации обращается к целевому агенту архивации, который передает ему данные.
2.  Сервер архивации записывает данные в высокопроизводительное хранилище.
3.  Сервер архивации обновляет базу данных каталога и завершает задание архивации.
4.  В зависимости от политики периода удержания сервер архивации копирует резервные копии в StorSimple.
5.  Скрипт создания моментальных снимков активирует диспетчер моментальных снимков StorSimple (запуск и удаление).
6.  В зависимости от политики периода удержания сервер архивации удаляет недействительные резервные копии.

### <a name="secondary-target-restore-logical-steps"></a>Логическая процедура восстановления дополнительного целевого объекта

1.  Сервер архивации начинает восстанавливать соответствующие данные из репозитория хранилища.
2.  Агент архивации получает данные с сервера архивации.
3.  Сервер архивации завершает задание восстановления.

## <a name="deploy-the-solution"></a>Развертывание решения

Развертывание этого решения состоит из трех шагов.
1. Подготовка сетевой инфраструктуры.
2. Развертывание устройства StorSimple в качестве целевого объекта архивации.
3. Развертывание Veritas NetBackup.

Каждый этап подробно описан в следующих разделах.

### <a name="set-up-the-network"></a>Настройка сети

StorSimple является решением, интегрированным с облаком Azure, и поэтому ему требуется активное действующее подключение к этому облаку. Это подключение используется для создания облачных моментальных снимков, управления данными, передачи метаданных и распределения старых, редко используемых данных по уровням в облачном хранилище Azure.

Для оптимальной работы решения мы советуем придерживаться следующих рекомендаций по сетям.

-   Канал связи между распределением по уровням StorSimple и Azure должен соответствовать требованиям к пропускной способности. Для этого необходимо, чтобы качество обслуживания параметров инфраструктуры было таким, как указано в соглашениях об уровне обслуживания для RPO и целевого времени восстановления (RTO).

-   Максимальная задержка доступа к хранилищу BLOB-объектов Azure должна находиться в пределах 80 мс.

### <a name="deploy-storsimple"></a>Развертывание StorSimple

Пошаговое руководство по развертыванию StorSimple см. в статье [Развертывание локального устройства StorSimple (с обновлением 2)](storsimple-deployment-walkthrough-u2.md).

### <a name="deploy-netbackup"></a>Развертывание NetBackup

Пошаговое руководство по развертыванию NetBackup 7.7.x см. в [документации NetBackup 7.7.x](http://www.veritas.com/docs/000094423).

## <a name="set-up-the-solution"></a>Настройка решения

В этом разделе представлены некоторые примеры настройки. В следующих рекомендациях и примерах продемонстрирована простейшая базовая реализация. Эта реализация может не соответствовать конкретным требованиям к архивации.

### <a name="set-up-storsimple"></a>Настройка StorSimple

| Задачи развертывания StorSimple  | Дополнительные комментарии |
|---|---|
| Развертывание локального устройства StorSimple | Поддерживаемые версии: обновление 3 и более поздних версий. |
| Включение целевого объекта архивации | Используйте следующие команды, чтобы включить или отключить режим целевого объекта архивации и получить информацию о состоянии. Дополнительные сведения см. в статье [Удаленное подключение к устройству StorSimple](storsimple-remote-connect.md).</br> Чтобы включить режим архивации, выполните следующую команду: `Set-HCSBackupApplianceMode -enable`. </br> Чтобы отключить режим архивации, выполните следующую команду: `Set-HCSBackupApplianceMode -disable`. </br> Для получения текущего состояния параметров режима архивации выполните следующую команду: `Get-HCSBackupApplianceMode`. |
| Создайте общий контейнер томов для тома, на котором хранятся резервные данные. Все данные в контейнере томов дедуплицируются | Контейнеры томов StorSimple определяют домены дедупликации.  |
| Создание тома StorSimple | Создайте тома с размерами, максимально соответствующими тому, который предположительно будет использоваться, так как от размера тома зависит время создания облачных моментальных снимков. Дополнительные сведения об определении размера тома см. в разделе [Политики периода удержания](#retention-policies).</br> </br> Используйте многоуровневые тома StorSimple и установите флажок **Используйте этот том для архивных данных, доступ к которым осуществляется нечасто**. </br> Использование только локально закрепленных томов не поддерживается. |
| Создайте уникальную политику архивации StorSimple для всех целевых томов архивации. | Политика архивации StorSimple определяет группу согласованности томов. |
| Отключение расписания при истечении срока действия моментальных снимков | Моментальные снимки активируются в качестве операции постобработки. |

### <a name="set-up-the-host-backup-server-storage"></a>Настройка хранилища сервера архивации узла

Настройте хранилище сервера архивации узла, следуя указанным ниже рекомендациям.  

- Не используйте составные тома (созданные с помощью службы Windows Disk Management), так как они не поддерживаются.
- Отформатируйте тома с помощью NTFS с размером выделения 64 КБ.
- Сопоставьте тома StorSimple с сервером NetBackup.
    - Используйте iSCSI для физических серверов.
    - Используйте транзитные диски для виртуальных серверов.


## <a name="best-practices-for-storsimple-and-netbackup"></a>Рекомендации для StorSimple и NetBackup

Настройте решение согласно рекомендациям в следующих разделах.

### <a name="operating-system-best-practices"></a>Рекомендации по операционной системе

-   Отключите шифрование и дедупликацию Windows Server для файловой системы NTFS.
-   Отключите дефрагментацию Windows Server для томов StorSimple.
-   Отключите индексацию Windows Server для томов StorSimple.
-   Выполните антивирусное сканирование исходного узла (не для томов StorSimple).
-   Отключите [обслуживание Windows Server](https://msdn.microsoft.com/library/windows/desktop/hh848037.aspx), включенное по умолчанию, в диспетчере задач. Выполните это действие одним из следующих способов.
    - Отключите средство настройки обслуживания в планировщике заданий Windows.
    - Скачайте программу [PsExec](https://technet.microsoft.com/sysinternals/bb897553.aspx) из Windows Sysinternals. После этого запустите Windows PowerShell от имени администратора и введите следующее:
      ```powershell
      psexec \\%computername% -s schtasks /change /tn “MicrosoftWindowsTaskSchedulerMaintenance Configurator" /disable
      ```

### <a name="storsimple-best-practices"></a>Рекомендации по StorSimple

-   Убедитесь, что для устройства StorSimple установлено [обновление 3 или более поздней версии](storsimple-install-update-3.md).
-   Изолируйте трафик iSCSI и облака. Используйте выделенное подключение iSCSI для трафика между StorSimple и сервером архивации.
-   Проверьте, является ли устройство StorSimple выделенным целевым объектом архивации. Смешанные рабочие нагрузки не поддерживаются, так как они влияют на RTO и RPO.

### <a name="netbackup-best-practices"></a>Рекомендации по использованию NetBackup

-   База данных NetBackup должна быть локальной на сервере и не располагаться на томе StorSimple.
-   Для аварийного восстановления создайте резервную копию базы данных NetBackup на томе StorSimple.
-   Для этого решения мы поддерживаем полные и добавочные резервные копии NetBackup (которые в NetBackup также называются разностными добавочными резервными копиями). Мы не рекомендуем использовать синтетические и накопительные добавочные резервные копии.
-   Файлы резервных данных должны содержать только данные для конкретного задания. Например, запрещено добавлять носители для разных заданий.

Последние параметры NetBackup и рекомендации по реализации этих требований см. в документации по NetBackup на веб-сайте [www.veritas.com](https://www.veritas.com).


## <a name="retention-policies"></a>Политики хранения

Чаще всего используется такая политика хранения резервных копий, как "дед-отец-сын" (GFS). В политике GFS добавочное резервное копирование выполняется ежедневно, а полное — еженедельно и ежемесячно. В результате вы получаете 6 многоуровневых томов StorSimple. Один том содержит полные еженедельные, ежемесячные и ежегодные резервные копии. На 5 других томах хранятся ежедневные добавочные резервные копии.

В следующем примере мы используем схему архивации GFS. В нем предполагается следующее:

-   Используются не дедуплицированные или не сжатые данные.
-   Размер полных резервных копий — 1 ТиБ.
-   Размер ежедневных добавочных резервных копий — 500 ГиБ.
-   Четыре еженедельные резервные копии хранятся в течение месяца.
-   12 ежемесячных резервных копий хранятся в течение года.
-   Одна ежегодная резервная копия хранится в течение 10 лет.

С учетом предыдущих предположений создайте многоуровневый том StorSimple на 26 ТиБ для полных ежемесячных и ежегодных резервных копий. Создайте многоуровневый том StorSimple на 5 ТиБ для каждой из добавочных ежедневных резервных копий.

| Период удержания и тип резервной копии | Размер (ТиБ) | Множитель GFS\* | Общая емкость (ТиБ)  |
|---|---|---|---|
| Еженедельная полная | 1 | 4.  | 4. |
| Ежедневная добавочная | 0,5 | 20 (число циклов соответствует числу недель в месяце) | 12 (2 для дополнительной квоты) |
| Полная ежемесячная | 1 | 12 | 12 |
| Полная ежегодная | 1  | 10 | 10 |
| Требование GFS |   | 38 |   |
| Дополнительная квота  | 4.  |   | Всего: 42 (в соответствии с требованиями GFS)  |
\* Коэффициент GFS — это количество копий, которые требуется защитить и сохранить в соответствии с требованиями политики архивации.

## <a name="set-up-netbackup-storage"></a>Настройка хранилища NetBackup

### <a name="to-set-up-netbackup-storage"></a>Чтобы настроить хранилище NetBackup, сделайте следующее:

1.  В консоли администрирования NetBackup выберите **Media and Device Management** (Управление носителями и устройствами) > **Devices** (Устройства) > **Disk Pools** (Пулы дисков). В мастере настройки пула дисков в качестве типа сервера хранилища выберите **AdvancedDisk** и нажмите кнопку **Далее**.

    ![Консоль администрирования NetBackup, мастер настройки пула дисков](./media/storsimple-configure-backup-target-using-netbackup/nbimage1.png)

2.  Выберите свой сервер и нажмите кнопку **Далее**.

    ![Консоль администрирования NetBackup, выбор сервера](./media/storsimple-configure-backup-target-using-netbackup/nbimage2.png)

3.  Выберите свой том StorSimple.

    ![Консоль администрирования NetBackup, выбор диска тома StorSimple](./media/storsimple-configure-backup-target-using-netbackup/nbimage3.png)

4.  Введите имя целевого объекта архивации, а затем дважды нажмите кнопку **Далее** > **Далее**чтобы завершить работу мастера.

5.  Проверьте параметры и нажмите кнопку **Готово**.

6.  После каждого назначения тома изменяйте параметры устройства хранения в соответствии со списком рекомендаций в разделе [Рекомендации для StorSimple и NetBackup](#best-practices-for-storsimple-and-netbackup).

7. Повторите шаги 1–6, пока не назначите все тома StorSimple.

    ![Консоль администрирования NetBackup, настройка диска](./media/storsimple-configure-backup-target-using-netbackup/nbimage5.png)

## <a name="set-up-storsimple-as-a-primary-backup-target"></a>Настройка StorSimple в качестве основного целевого объекта архивации

> [!NOTE]
> Восстановление данных из резервной копии, распределенной по уровням в облако, происходит со скоростью облака.

На следующем рисунке представлено сопоставление типичного тома с заданием архивации. В этом случае все еженедельные резервные копии сопоставляются с диском "Полное копирование, суббота", а добавочные резервные копии — с дисками "Понедельник — пятница". Архивация и восстановление выполняются на многоуровневом томе StorSimple.

![Логическая схема конфигурации основного целевого объекта архивации ](./media/storsimple-configure-backup-target-using-netbackup/primarybackuptargetdiagram.png)

### <a name="storsimple-as-a-primary-backup-target-gfs-schedule-example"></a>Пример расписания с использованием схемы "дед-отец-сын" (GFS) для StorSimple в качестве основного целевого объекта архивации

Ниже приведен пример схемы архивации GFS на 4 недели, месяц и год.

| Периодичность и тип архивации | Полное | Добавочная (день 1–5)  |   
|---|---|---|
| Еженедельная (неделя 1–4) | Суббота | Понедельник — пятница |
| Ежемесячная  | Суббота  |   |
| Ежегодная | Суббота  |   |   |

## <a name="assigning-storsimple-volumes-to-a-netbackup-backup-job"></a>Назначение томов StorSimple заданию архивации NetBackup

В следующей последовательности предполагается, что NetBackup и целевой узел настроены в соответствии с рекомендациями агента NetBackup.

### <a name="to-assign-storsimple-volumes-to-a-netbackup-backup-job"></a>Чтобы назначить тома StorSimple заданию архивации NetBackup, сделайте следующее:

1.  В консоли администрирования NetBackup выберите **NetBackup Management** (Управление NetBackup), щелкните **Policies** (Политики) правой кнопкой мыши, а затем выберите **New Policy** (Создать политику).

    ![Консоль администрирования NetBackup, создание политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage6.png)

2.  В диалоговом окне **Add a New Policy** (Добавление политики) введите имя политики и установите флажок **Use Policy Configuration Wizard** (Использовать мастер настройки политики). Нажмите кнопку **ОК**.

    ![Консоль администрирования NetBackup, диалоговое окно Add a New Policy (Добавление политики)](./media/storsimple-configure-backup-target-using-netbackup/nbimage7.png)

3.  В мастере настройки политики архивации выберите необходимый тип архивации, а затем нажмите кнопку **Далее**.

    ![Консоль администрирования NetBackup, выбор типа архивации](./media/storsimple-configure-backup-target-using-netbackup/nbimage8.png)

4.  Чтобы задать тип политики, выберите **Standard** (Стандартная) и нажмите кнопку **Далее**.

    ![Консоль администрирования NetBackup, выбор типа политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage9.png)

5.  Выберите свой узел, установите флажок **Detect client operating system** (Определять клиентскую операционную систему) и нажмите кнопку **Добавить**. Щелкните **Далее**.

    ![Консоль администрирования NetBackup, список клиентов в новой политике](./media/storsimple-configure-backup-target-using-netbackup/nbimage10.png)

6.  Выберите диски для архивации.

    ![Консоль администрирования NetBackup, список выбора элементов архивации для новой политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage11.png)

7.  Определите значения частоты и периода удержания резервных копий в соответствии с требованиями к ротации резервных копий.

    ![Консоль администрирования NetBackup, настройка частоты и периода удержания резервных копий для новой политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage12.png)

8.  Выберите **Далее** > **Далее** > **Готово**.  Расписание можно изменить после создания политики.

9.  Разверните созданную политику и выберите **Schedules** (Расписания).

    ![Консоль администрирования NetBackup, расписания для новой политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage13.png)

10.  Щелкните **Differential-Inc** правой кнопкой мыши, выберите **Copy to new** (Скопировать в новый) и нажмите кнопку **ОК**.

    ![Консоль администрирования NetBackup, копирование расписания для новой политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage14.png)

11.  Щелкните созданное расписание правой кнопкой мыши и выберите **Изменить**.

12.  На вкладке **Атрибуты** установите флажок **Override policy storage selection** (Переопределять выбранное хранилище для политики) и выберите том, на котором сохраняются добавочные резервные копии за понедельник.

    ![Консоль администрирования NetBackup, изменение расписания](./media/storsimple-configure-backup-target-using-netbackup/nbimage15.png)

13.  На вкладке **Start Window** (Окно запуска) выберите окно времени для резервных копий.

    ![Консоль администрирования NetBackup, изменение окна запуска](./media/storsimple-configure-backup-target-using-netbackup/nbimage16.png)

14.  Нажмите кнопку **ОК**.

15.  Повторите шаги 10–14 для каждой добавочной резервной копии. Выберите подходящий том и расписание для каждой созданной резервной копии.

16.  Щелкните расписание **Differential-Inc** правой кнопкой мыши и удалите его.

17.  Измените расписание полной архивации в соответствии с требованиями.

    ![Консоль администрирования NetBackup, изменение расписания полной архивации](./media/storsimple-configure-backup-target-using-netbackup/nbimage17.png)

18.  Измените окна запуска.

    ![Консоль администрирования NetBackup, изменение окна запуска](./media/storsimple-configure-backup-target-using-netbackup/nbimage18.png)

19.  В окончательном виде расписание должно выглядеть следующим образом:

    ![Консоль администрирования NetBackup, окончательное расписание](./media/storsimple-configure-backup-target-using-netbackup/nbimage19.png)

## <a name="set-up-storsimple-as-a-secondary-backup-target"></a>Настройка StorSimple в качестве дополнительного целевого объекта архивации

> [!NOTE]
>Восстановление данных из резервной копии, распределенной по уровням в облако, происходит со скоростью облака.

В этой модели необходим носитель для хранения (кроме StorSimple), который будет использоваться в качестве временного кэша. Например, том RAID может обеспечивать место, операции ввода-вывода и пропускную способность. Мы рекомендуем использовать RAID 5, 50 и 10.

На следующем рисунке представлены типичные локальные тома (на сервере) с кратким периодом удержания и архивные тома с длительным периодом удержания. В этом сценарии все резервные копии создаются на локальном томе RAID (на сервере). Эти резервные копии периодически копируются и архивируются на архивный том. Очень важно определить размер локального тома RAID (на сервере) в соответствии с требованиями к емкости и производительности для короткого периода удержания.

### <a name="storsimple-as-a-secondary-backup-target-gfs-example"></a>Пример использования схемы GFS для StorSimple в качестве дополнительного целевого объекта архивации

![Логическая схема использования StorSimple в качестве дополнительного целевого объекта архивации](./media/storsimple-configure-backup-target-using-netbackup/secondarybackuptargetdiagram.png)

В следующей таблице показано, как настроить резервные копии для запуска на локальных дисках и дисках StorSimple. Сюда входят требования к емкости отдельного диска и общей емкости.

### <a name="backup-configuration-and-capacity-requirements"></a>Требования к конфигурации и емкости резервных копий

| Период удержания и тип резервной копии | Настроенное хранилище | Размер (ТиБ) | Множитель GFS | Общая емкость\* (ТиБ) |
|---|---|---|---|---|
| 1-я неделя (полная и добавочная) |Локальный диск (с коротким периодом удержания)| 1 | 1 | 1 |
| StorSimple, со 2-ой по 4-ю неделю |Диск StorSimple (с длительным периодом удержания) | 1 | 4. | 4 |
| Полная ежемесячная |Диск StorSimple (с длительным периодом удержания) | 1 | 12 | 12 |
| Полная ежегодная |Диск StorSimple (с длительным периодом удержания) | 1 | 1 | 1 |
|Размер тома в соответствии с GFS |  |  |  | 18*|
\* Общая емкость включает 17 ТиБ для дисков StorSimple и 1 ТиБ для локального тома RAID.


### <a name="gfs-example-schedule-gfs-rotation-weekly-monthly-and-yearly-schedule"></a>Примеры расписания GFS: еженедельное, ежемесячное и ежегодное расписание по схеме GFS

| Неделя | Полное | Добавочная, день 1 | Добавочная, день 2 | Добавочная, день 3 | Добавочная, день 4 | Добавочная, день 5 |
|---|---|---|---|---|---|---|
| 1-я неделя | Локальный том RAID  | Локальный том RAID | Локальный том RAID | Локальный том RAID | Локальный том RAID | Локальный том RAID |
| 2-я неделя | StorSimple, со 2-ой по 4-ю неделю |   |   |   |   |   |
| 3-я неделя | StorSimple, со 2-ой по 4-ю неделю |   |   |   |   |   |
| 4-я неделя | StorSimple, со 2-ой по 4-ю неделю |   |   |   |   |   |
| Ежемесячная | StorSimple, ежемесячная |   |   |   |   |   |
| Ежегодная | StorSimple, ежегодная  |   |   |   |   |   |   |


## <a name="assign-storsimple-volumes-to-a-netbackup-archive-and-duplication-job"></a>Назначение томов StorSimple заданию архивации и дедупликации NetBackup

NetBackup предлагает множество возможностей для управления хранилищем и носителями. Мы рекомендуем проконсультироваться со специалистами Veritas или архитектором NetBackup, чтобы оценить требования политики жизненного цикла хранилища (SLP) соответствующим образом.

После определения исходных пулов дисков определите три дополнительных политики жизненного цикла хранилища. Всего у вас будет четыре политики:
* LocalRAIDVolume;
* StorSimpleWeek2-4;
* StorSimpleMonthlyFulls;
* StorSimpleYearlyFulls.

### <a name="to-assign-storsimple-volumes-to-a-netbackup-archive-and-duplication-job"></a>Чтобы назначить тома StorSimple заданию архивации или дедупликации NetBackup, сделайте следующее:

1.  В консоли администрирования NetBackup выберите **Хранилище** > **Storage Lifecycle Policies** (Политики жизненного цикла хранилища) > **New Storage Lifecycle Policy** (Создать политику жизненного цикла хранилища).

    ![Консоль администрирования NetBackup, создание политики жизненного цикла хранилища](./media/storsimple-configure-backup-target-using-netbackup/nbimage20.png)

2.  Введите имя моментального снимка и нажмите кнопку **Add** (Добавить).

3.  В диалоговом окне **New Operation** (Новая операция) на вкладке **Properties** (Свойства) для параметра **Operation** (Операция) установите значение **Backup** (Архивация). Выберите **целевое хранилище**, **тип** и **период удержания**. Нажмите кнопку **ОК**.

    ![Консоль администрирования NetBackup, диалоговое окно New Operation (Новая операция)](./media/storsimple-configure-backup-target-using-netbackup/nbimage22.png)

    Вы определили первую операцию архивации и репозиторий.

4.  Выделите предыдущую операцию и нажмите кнопку **Add** (Добавить). В диалоговом окне **Change Storage Operation** (Изменение операции хранилища) выберите **целевое хранилище**, **тип** и **период удержания**.

    ![Консоль администрирования NetBackup, диалоговое окно Change Storage Operation (Изменение операции хранилища)](./media/storsimple-configure-backup-target-using-netbackup/nbimage23.png)

5.  Выделите предыдущую операцию и нажмите кнопку **Add** (Добавить). В диалоговом окне **New Storage Lifecycle Policy** (Создание политики жизненного цикла хранилища) добавьте ежемесячные резервные копии за год.

    ![Консоль администрирования NetBackup, диалоговое окно New Storage Lifecycle Policy (Создание политики жизненного цикла хранилища)](./media/storsimple-configure-backup-target-using-netbackup/nbimage24.png)

6.  Повторяйте шаги 4–5, пока не создадите необходимую политику периода удержания SLP.

    ![Консоль администрирования NetBackup, добавление политик в диалоговом окне New Storage Lifecycle Policy (Создание политики жизненного цикла хранилища)](./media/storsimple-configure-backup-target-using-netbackup/nbimage25.png)

7.  Определив политику периода удержания SLP, в разделе **Policy** (Политика) определите политику архивации, как описано в разделе [Назначение томов StorSimple заданию архивации NetBackup](#assigning-storsimple-volumes-to-a-netbackup-backup-job).

8.  В разделе **Schedules** (Расписания) в диалоговом окне **Change Schedule** (Изменение расписания) щелкните **Full** (Полное) правой кнопкой мыши и выберите **Change** (Изменить).

    ![Консоль администрирования NetBackup, диалоговое окно Change Schedule (Изменение расписания)](./media/storsimple-configure-backup-target-using-netbackup/nbimage26.png)

9.  Установите флажок **Override policy storage selection** (Переопределять выбранное хранилище для политики) и выберите политику периода удержания SLP, созданную ранее (шаг 1–6).

    ![Консоль администрирования NetBackup, переопределение выбранного хранилища для политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage27.png)

10.  Нажмите кнопку **ОК** и повторите действия для расписания добавочной архивации.

    ![Консоль администрирования NetBackup, диалоговое окно изменения расписания для добавочных архиваций](./media/storsimple-configure-backup-target-using-netbackup/nbimage28.png)


| Период удержания и тип резервной копии | Размер (ТиБ) | Множитель GFS\* | Общая емкость (ТиБ)  |
|---|---|---|---|
| Еженедельная полная |  1  |  4. | 4.  |
| Ежедневная добавочная  | 0,5  | 20 (число циклов соответствует числу недель в месяце) | 12 (2 для дополнительной квоты) |
| Полная ежемесячная  | 1 | 12 | 12 |
| Полная ежегодная | 1  | 10 | 10 |
| Требование GFS  |     |     | 38 |
| Дополнительная квота  | 4.  |    | Всего: 42 (в соответствии с требованиями GFS) |
\* Коэффициент GFS — это количество копий, которые требуется защитить и сохранить в соответствии с требованиями политики архивации.

## <a name="storsimple-cloud-snapshots"></a>Облачные моментальные снимки StorSimple

Облачные моментальные снимки StorSimple обеспечивают защиту данных на устройстве StorSimple. Создание облачного моментального снимка эквивалентно доставке лент локального резервного копирования в удаленное помещение. При использовании геоизбыточного хранилища Azure оно эквивалентно доставке лент резервного копирования на несколько сайтов. Если после сбоя нужно восстановить устройство, можно запустить другое устройство StorSimple и выполнить отработку отказа. После отработки отказа вы сможете получить доступ к данным (со скоростью облака) из последнего облачного моментального снимка.

В разделе ниже показано, как создать короткий скрипт для запуска и удаления облачных моментальных снимков StorSimple во время постобработки резервной копии.

> [!NOTE]
> На созданные вручную или с помощью программных средств моментальные снимки не распространяется политика истечения срока действия моментальных снимков StorSimple. Их нужно удалять вручную или программным способом.

### <a name="start-and-delete-cloud-snapshots-by-using-a-script"></a>Запуск и удаление облачных моментальных снимков с помощью скрипта

> [!NOTE]
> Перед удалением моментального снимка StorSimple тщательно оцените последствия для соответствия требованиям и хранения данных. Дополнительные сведения о выполнении скрипта после архивации см. в [документации по NetBackup](http://www.veritas.com/docs/000094423).

### <a name="backup-lifecycle"></a>Жизненный цикл резервной копии

![Схема жизненного цикла резервной копии](./media/storsimple-configure-backup-target-using-netbackup/backuplifecycle.png)

### <a name="requirements"></a>Требования

-   Сервер, на котором выполняется скрипт, должен иметь доступ к облачным ресурсам Azure.
-   У учетной записи пользователя должны быть необходимые разрешения.
-   Для политики архивации StorSimple должны быть настроены, но не включены связанные тома StorSimple.
-   Вам понадобится имя ресурса, регистрационный ключ, имя устройства и идентификатор политики архивации StorSimple.

### <a name="to-start-or-delete-a-cloud-snapshot"></a>Запуск или удаление моментального снимка облака

1.  [Установите Azure PowerShell](/powershell/azure/overview).
2. Скачайте и установите скрипт [Manage-CloudSnapshots.ps1](https://github.com/anoobbacker/storsimpledevicemgmttools/blob/master/Manage-CloudSnapshots.ps1) PowerShell.
3. На сервере, на котором запускается скрипт, запустите PowerShell от имени администратора. Запустите скрипт с параметром `-WhatIf $true`, чтобы просмотреть внесенные изменения. Когда проверка будет завершена, передайте параметр `-WhatIf $false`. Выполните следующую команду:
```powershell
.\Manage-CloudSnapshots.ps1 -SubscriptionId [Subscription Id] -TenantId [Tenant ID] -ResourceGroupName [Resource Group Name] -ManagerName [StorSimple Device Manager Name] -DeviceName [device name] -BackupPolicyName [backup policyname] -RetentionInDays [Retention days] -WhatIf [$true or $false]
```
4.  Добавьте скрипт к заданию архивации в NetBackup. Для этого измените команды предварительной обработки и постобработки параметров задания NetBackup.

> [!NOTE]
> Мы советуем запустить политику архивации облачных моментальных снимков StorSimple в качестве скрипта постобработки по завершении задания ежедневной архивации. Дополнительные сведения об архивации и восстановлении среды приложения архивации в соответствии с RPO и RTO можно получить у архитектора по архивации.

## <a name="storsimple-as-a-restore-source"></a>Использование StorSimple в качестве источника восстановления

Восстановление из устройства StorSimple действует аналогично восстановлению из любого устройства блочного хранилища. Восстановление данных, распределенных по уровням в облаке, выполняется со скоростью облака. Восстановление локальных данных выполняется со скоростью локального диска устройства. Дополнительные сведения о выполнении восстановления см. в [документации по NetBackup](http://www.veritas.com/docs/000094423). Мы советуем следовать рекомендациям по восстановлению NetBackup.

## <a name="storsimple-failover-and-disaster-recovery"></a>Отработка отказа и аварийное восстановление для устройства StorSimple

> [!NOTE]
> Для сценариев с использованием целевого объекта архивации облачное устройство StorSimple не поддерживается в качестве целевого объекта восстановления.

Сбой может быть вызван множеством факторов. В следующей таблице перечислены распространенные сценарии аварийного восстановления.

| Сценарий | Влияние | Восстановление | Заметки |
|---|---|---|---|
| Сбой устройства StorSimple | Операции архивации и восстановления будут прерваны. | Замените неисправное устройство и выполните [отработку отказа и аварийное восстановление StorSimple](storsimple-device-failover-disaster-recovery.md). | Если после восстановления устройства требуется выполнить восстановление, все рабочие наборы данных извлекаются из облака на новое устройство. Все операции будут выполняться со скоростью облака. При повторном сканировании во время индексации и каталогизации все наборы резервных копий будут отсканированы и извлечены из облачного уровня на уровень локального устройства, что может занять много времени. |
| Сбой сервера NetBackup | Операции архивации и восстановления будут прерваны. | Создайте сервер архивации повторно и восстановите базу данных. | На сайте аварийного восстановления необходимо повторно создать или восстановить сервер NetBackup. Восстановите базу данных до последней точки. Если восстановленная база данных NetBackup не синхронизирована с последним заданием архивации, требуется индексирование и каталогизация. При повторном сканировании во время индексации и каталогизации все наборы резервных копий будут отсканированы и извлечены из облачного уровня на уровень локального устройства. Поэтому следует учитывать ограничения по времени. |
| Сбой узла, который приводит к потере сервера архивации и StorSimple | Операции архивации и восстановления будут прерваны. | Сначала восстановите StorSimple, а затем — NetBackup. | Сначала восстановите StorSimple, а затем — NetBackup. Если после восстановления устройства требуется выполнить восстановление, все рабочие наборы данных извлекаются из облака на новое устройство. Все операции будут выполняться со скоростью облака. |

## <a name="references"></a>Ссылки

В этой статье содержатся ссылки на следующие документы:

- [Настройка функции Multipath I/O для устройства StorSimple](storsimple-configure-mpio-windows-server.md)
- [Storage scenarios: Thin provisioning](http://msdn.microsoft.com/library/windows/hardware/dn265487.aspx) (Сценарии хранилища: тонкая подготовка)
- [Using GPT drives](http://msdn.microsoft.com/windows/hardware/gg463524.aspx#EHD) (Использование дисков GPT)
- [Включение и настройка теневых копий общих папок](http://technet.microsoft.com/library/cc771893.aspx)

## <a name="next-steps"></a>Дополнительная информация

- Узнайте, как выполнить [восстановление из набора резервных копий](storsimple-restore-from-backup-set-u2.md).
- Узнайте, как выполнить [отработку отказа и аварийное восстановление устройства](storsimple-device-failover-disaster-recovery.md).
