<properties 
   pageTitle="Удаленное подключение к устройству StorSimple | Microsoft Azure"
   description="Объясняется, как настроить устройство для удаленного управления, а затем подключиться к Windows PowerShell для StorSimple по протоколу HTTP или HTTPS."
   services="storsimple"
   documentationCenter=""
   authors="alkohli"
   manager="carmonm"
   editor="" />
<tags 
   ms.service="storsimple"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="06/21/2016"
   ms.author="alkohli" />

# Удаленное подключение к устройству StorSimple

## Общие сведения

Для подключения к устройству StorSimple можно использовать удаленное взаимодействие Windows PowerShell. При таком способе подключения меню не отображается. (Меню появляется только при подключении к устройству с помощью последовательной консоли.) При использовании удаленного взаимодействия Windows PowerShell вы подключаетесь к конкретному пространству выполнения. Также можно указать язык интерфейса.

Дополнительные сведения об использовании удаленного взаимодействия Windows PowerShell для управления устройством см. в статье [Использование Windows PowerShell для StorSimple для администрирования устройства StorSimple](storsimple-windows-powershell-administration.md).

В этом учебнике объясняется, как настроить устройство для удаленного управления, а затем подключиться к Windows PowerShell для StorSimple. Для подключения с использованием удаленного взаимодействия Windows PowerShell можно использовать HTTP или HTTPS. Однако при выборе способа подключения к Windows PowerShell для StorSimple следует учесть перечисленные ниже аспекты.

- Прямое подключение к последовательной консоли устройства является безопасным, а подключение к последовательной консоли через сетевые коммутаторы — нет. При подключении к последовательной консоли устройства через сетевые коммутаторы учитывайте угрозы для безопасности. 

- Подключение через сеанс HTTP может быть более безопасным, чем подключение через последовательную консоль по сети. Хотя это не самый безопасный метод, его можно использовать в доверенных сетях.

- Наиболее безопасным и рекомендуемым способом подключения является подключение через сеанс HTTPS с самозаверяющим сертификатом.

К интерфейсу Windows PowerShell можно подключиться удаленно. Однако удаленный доступ к устройству StorSimple в интерфейсе Windows PowerShell по умолчанию отключен. Необходимо сначала включить удаленное управление на устройстве, а затем включить его в клиенте, который будет использоваться для доступа к устройству.

Действия, описанные в этой статье, были выполнены в системе узла под управлением Windows Server 2012 R2.

## Подключение по протоколу HTTP

Подключение к Windows PowerShell для StorSimple через сеанс HTTP обеспечивает более высокий уровень безопасности по сравнению с подключением через последовательную консоль устройства StorSimple. Хотя это не самый безопасный метод, его можно использовать в доверенных сетях.

Для настройки удаленного управления можно использовать классический портал Azure или последовательную консоль. Выберите одну из следующих процедур:

- [Включение удаленного управления по протоколу HTTP с помощью классического портала Azure](#use-the-azure-classic-portal-to-enable-remote-management-over-http)

- [Включение удаленного управления по протоколу HTTP с помощью последовательной консоли](#use-the-serial-console-to-enable-remote-management-over-http)

После включения удаленного управления используйте следующую процедуру для подготовки клиента для удаленного подключения.

- [Подготовка клиента для удаленного подключения](#prepare-the-client-for-remote-connection)

### Включить удаленное управление по протоколу HTTP можно с помощью классического портала Azure 

Для включения удаленного управления по протоколу HTTP выполните следующие действия на классическом портале Azure.с

#### Включение удаленного управления с помощью классического портала Azure

1. Откройте **Устройства** > **Настроить** для вашего устройства.

2. Прокрутите экран вниз, к разделу **Удаленное управление**.

3. Задайте для пункта **Включить удаленное управление** значение **Да**.

4. Теперь вы можете выбрать подключение по HTTP. (По умолчанию выбрано подключение по HTTPS.) Убедитесь, что выбран HTTP.

    >[AZURE.NOTE] Подключение по HTTP допустимо только в доверенных сетях.

6. В нижней части страницы нажмите кнопку **Сохранить**.

### Включение удаленного управления по протоколу HTTP с помощью последовательной консоли

Для включения удаленного управления выполните следующие действия в последовательной консоли устройства.

#### Включение удаленного управления с помощью последовательной консоли

1. В меню последовательной консоли выберите вариант 1. Дополнительные сведения об использовании последовательной консоли устройства см. в статье [Подключение к Windows PowerShell для StorSimple через последовательную консоль устройства](storsimple-windows-powershell-administration.md#connect-to-windows-powershell-for-storsimple-via-device-serial-console).

2. В командной строке введите следующую команду:`Enable-HcsRemoteManagement –AllowHttp`

3. Вы получите уведомление об уязвимостях системы безопасности при подключении к устройству с помощью HTTP. При появлении запроса подтверждения введите **Y**.

4. Убедитесь, что HTTP включен, набрав: `Get-HcsSystem`

5. Убедитесь, что значение поля **RemoteManagementMode** равно **HttpsAndHttpEnabled**. На следующем рисунке показаны эти параметры в PuTTY.

     ![Последовательный HTTPS и HTTP включены](./media/storsimple-remote-connect/HCS_SerialHttpsAndHttpEnabled.png)

### Подготовка клиента для удаленного подключения

Для включения удаленного управления выполните следующие действия в клиенте.

#### Подготовка клиента для удаленного подключения

1. Запустите сеанс Windows PowerShell от имени администратора.

2. Введите следующую команду, чтобы добавить IP-адрес устройства StorSimple в список доверенных узлов клиента:

     `Set-Item wsman:\localhost\Client\TrustedHosts <device_ip> -Concatenate -Force`

     Замените <*device\_ip*> IP-адресом своего устройства, например:

     `Set-Item wsman:\localhost\Client\TrustedHosts 10.126.173.90 -Concatenate -Force`

3. Введите следующую команду, чтобы сохранить учетные данные устройства в переменной:

     *$cred = Get-Credential*

4. В открывшемся диалоговом окне:

    1. Введите имя пользователя в следующем формате: *device\_ip\\SSAdmin*.
    2. Введите пароль администратора устройства, который был установлен при настройке устройства с помощью мастера установки. Пароль по умолчанию — *Password1*.

7. Запустите сеанс Windows PowerShell на устройстве, введя следующую команду:

     `Enter-PSSession -Credential $cred -ConfigurationName SSAdminConsole -ComputerName <device_ip>`

     >[AZURE.NOTE] Чтобы создать сеанс Windows PowerShell для виртуального устройства StorSimple, добавьте параметр `–Port` и укажите общий порт, настроенный для удаленного взаимодействия с виртуальным устройством StorSimple.

     На этом этапе у вас должен быть активный удаленный сеанс Windows PowerShell с устройством.

    ![Удаленное взаимодействие PowerShell через HTTP](./media/storsimple-remote-connect/HCS_PSRemotingUsingHTTP.png)

## Подключение по протоколу HTTPS

Подключение к Windows PowerShell для StorSimple через сеанс HTTPS — наиболее безопасный и рекомендуемый метод удаленного подключения к устройству Microsoft Azure StorSimple. В следующих процедурах описана настройка последовательной консоли и клиентских компьютеров для использования HTTPS для подключения к Windows PowerShell для StorSimple.

Для настройки удаленного управления можно использовать классический портал Azure или последовательную консоль. Выберите одну из следующих процедур:

- [Включение удаленного управления по протоколу HTTPS с помощью классического портала Azure](#use-the-azure-classic-portal-to-enable-remote-management-over-https)

- [Включение удаленного управления по протоколу HTTPS с помощью последовательной консоли](#use-the-serial-console-to-enable-remote-management-over-https)

После включения удаленного управления используйте следующие процедуры для подготовки узла для удаленного управления и подключения к устройству с удаленного узла.

- [Подготовка узла для удаленного управления](#prepare-the-host-for-remote-management)

- [Подключение к устройству с удаленного узла](#connect-to-the-device-from-the-remote-host)

### Включить удаленное управление по протоколу HTTPS можно с помощью классического портала Azure

Для включения удаленного управления по протоколу HTTPS выполните следующие действия на классическом портале Azure.

#### Включение удаленного управления по протоколу HTTPS на классическом портале Azure

1. Откройте **Устройства** > **Настроить** для вашего устройства.

2. Прокрутите экран вниз, к разделу **Удаленное управление**.

3. Задайте для пункта **Включить удаленное управление** значение **Да**.

4. Теперь вы можете выбрать подключение по HTTPS. (По умолчанию выбрано подключение по HTTPS.) Убедитесь, что выбран HTTPS.

5. Щелкните **Загрузить сертификат удаленного управления**. Укажите расположение для сохранения этого файла. Этот сертификат необходимо установить на компьютере клиента или узла, который будет использоваться для подключения к устройству.

6. В нижней части страницы нажмите кнопку **Сохранить**.

### Включение удаленного управления по протоколу HTTPS с помощью последовательной консоли

Для включения удаленного управления выполните следующие действия в последовательной консоли устройства.

#### Включение удаленного управления с помощью последовательной консоли

1. В меню последовательной консоли выберите вариант 1. Дополнительные сведения об использовании последовательной консоли устройства см. в статье [Подключение к Windows PowerShell для StorSimple через последовательную консоль устройства](storsimple-windows-powershell-administration.md#connect-to-windows-powershell-for-storsimple-via-device-serial-console).

2. В командной строке введите следующую команду:

     `Enable-HcsRemoteManagement`

    Эта команда должна включить протокол HTTPS на вашем устройстве.

3. Убедитесь, что HTTPS включен, набрав:

     `Get-HcsSystem`

    Убедитесь, что в поле **RemoteManagementMode** задано значение **HttpsEnabled**. На следующем рисунке показаны эти параметры в PuTTY.

     ![Последовательный HTTPS включен](./media/storsimple-remote-connect/HCS_SerialHttpsEnabled.png)

4. Из вывода команды `Get-HcsSystem` скопируйте серийный номер устройства и сохраните его для последующего использования.

    >[AZURE.NOTE] Серийный номер сопоставляется CN-имени в сертификате.

5. Получите сертификат удаленного управления, набрав:
 
     `Get-HcsRemoteManagementCert`

    Появится сертификат, похожий на показанный ниже:

    ![Получение сертификата удаленного управления](./media/storsimple-remote-connect/HCS_GetRemoteManagementCertificate.png)

5. Скопируйте информацию из сертификата от **-----BEGIN CERTIFICATE-----** до **-----END CERTIFICATE-----** в текстовый редактор, например в "Блокнот", и сохраните файл с расширением .cer. (При подготовке удаленного узла этот файл будет необходимо скопировать на этот узел.)

    >[AZURE.NOTE] Чтобы создать новый сертификат, используйте командлет `Set-HcsRemoteManagementCert`.

### Подготовка узла для удаленного управления

Чтобы подготовить компьютер узла для удаленного подключения, которое использует сеанс HTTPS, выполните следующие процедуры.

- [Импортируйте CER-файл в корневое хранилище клиента или удаленного узла](#to-import-the-certificate-on-the-remote-host).

- [Добавьте серийные номера устройств в файл hosts на удаленном узле](#to-add-device-serial-numbers-to-the-remote-host).

Каждая из этих процедур описана ниже.

#### Импорт сертификата на удаленном узле

1. Щелкните правой кнопкой мыши на CER-файле и выберите **Установить сертификат**. Откроется мастер импорта сертификатов.

    ![Мастер импорта сертификатов 1](./media/storsimple-remote-connect/HCS_CertificateImportWizard1.png)

2. В качестве **Расположения хранилища** выберите **Локальный компьютер**, затем нажмите кнопку **Далее**.

3. Выберите **Поместить все сертификаты в следующее хранилище**, затем нажмите кнопку **Обзор**. Перейдите в корневое хранилище удаленного узла и нажмите кнопку **Далее**.

    ![Мастер импорта сертификатов 2](./media/storsimple-remote-connect/HCS_CertificateImportWizard2.png)

4. Нажмите кнопку **Готово** Появится сообщение о том, что импорт успешно выполнен.

    ![Мастер импорта сертификатов 3](./media/storsimple-remote-connect/HCS_CertificateImportWizard3.png)

#### Добавление серийных номеров устройства в удаленный узел

1. Откройте "Блокнот" от имени администратора и откройте файл hosts, расположенный в папке \\Windows\\System32\\Drivers\\etc.

2. Добавьте следующие три следующие записи в файл hosts: **IP-адрес данных 0**, **Фиксированный IP-адрес контроллера 0** и **Фиксированный IP-адрес контроллера 1**.

3. Введите серийный номер устройства, сохраненный ранее. Сопоставьте его с IP-адресом, как показано на следующем рисунке. Для контроллера 0 и контроллера 1 добавьте **Controller0** и **Controller1** в конце серийного номера (CN-имени).

    ![Добавление имени CN в файл hosts](./media/storsimple-remote-connect/HCS_AddingCNNameToHostsFile.png)

4. Сохраните файл hosts.

### Подключение к устройству с удаленного узла

С помощью Windows PowerShell и SSL создайте сеанс SSAdmin на устройстве с удаленного узла или клиента. Сеанс SSAdmin соответствует пункту 1 в меню [последовательной консоли](storsimple-windows-powershell-administration.md#connect-to-windows-powershell-for-storsimple-via-device-serial-console) устройства.

Выполните следующую процедуру на компьютере, с которого будет выполняться удаленное подключение Windows PowerShell.

#### Создание сеанса SSAdmin на устройстве с помощью Windows PowerShell и SSL

1. Запустите сеанс Windows PowerShell от имени администратора.

2. Добавьте IP-адрес устройства в доверенные узлы клиента, набрав:

     `Set-Item wsman:\localhost\Client\TrustedHosts <device_ip> -Concatenate -Force`

    Замените <*device\_ip*> IP-адресом своего устройства, например:

     `Set-Item wsman:\localhost\Client\TrustedHosts 10.126.173.90 -Concatenate -Force`

3. Создайте новые учетные данные, введя:

     `$cred = New-Object pscredential @("<IP of target device>\SSAdmin", (ConvertTo-SecureString -Force -AsPlainText "<Device Administrator Password>"))`

    Где <*IP of target device*> — IP-адрес данных 0 устройства, например, **10.126.173.90**, как показано на предыдущем рисунке файла hosts. Также укажите пароль администратора для вашего устройства.

4. Создайте сеанс, набрав:

     `$session = New-PSSession -UseSSL -ComputerName <Serial number of target device> -Credential $cred -ConfigurationName "SSAdminConsole"`

    В качестве параметра -ComputerName в командлете предоставьте <*серийный номер целевого устройства*>. Этот серийный номер был сопоставлен с IP-адресом DATA 0 в файле hosts на удаленном узле. Пример — **SHX0991003G44MT**, как показано на следующем рисунке.

5. Тип:

     `Enter-PSSession $session`

6. Необходимо подождать несколько минут, после чего вы будете подключены к устройству через HTTPS по протоколу SSL. Появится сообщение о том, что вы подключены к устройству.

    ![Удаленное взаимодействие PowerShell через HTTPS и SSL](./media/storsimple-remote-connect/HCS_PSRemotingUsingHTTPSAndSSL.png)

## Дальнейшие действия

- Узнайте больше об [использовании Windows PowerShell для администрирования устройства StorSimple](storsimple-windows-powershell-administration.md).

- Узнайте больше об [использовании службы диспетчера StorSimple для администрирования устройства StorSimple](storsimple-manager-service-administration.md).

<!---HONumber=AcomDC_0622_2016-->