<properties 
   pageTitle="Отработка отказа и аварийное восстановление для устройства StorSimple | Microsoft Azure"
   description="Информация о том, как выполнить отработку отказа устройства StorSimple на то же устройство либо другое физическое или виртуальное устройство."
   services="storsimple"
   documentationCenter=""
   authors="alkohli"
   manager="carmonm"
   editor="" />
<tags 
   ms.service="storsimple"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="09/16/2016"
   ms.author="alkohli" />

# Отработка отказа и аварийное восстановление для устройства StorSimple

## Обзор

В этом учебнике описываются шаги, необходимые для отработки отказа устройства StorSimple в случае аварии. Отработка отказа позволит перенести данные c исходного устройства в центре обработки данных на другое физическое или даже виртуальное устройство, которое находится в том же или другом географическом расположении.

Управление аварийным восстановлением осуществляется с помощью функции отработки отказа устройства и инициируется на странице **Устройства**. На этой странице показаны все устройства StorSimple, подключенные к службе диспетчера StorSimple. Для каждого устройства отображается понятное имя, состояние устройства, выделенная и максимальная емкость, тип и модель устройства.

![Страница "Устройства"](./media/storsimple-device-failover-disaster-recovery/IC740972.png)

Рекомендации в этом учебнике относятся к физическим и виртуальным устройствам StorSimple для всех версий программного обеспечения.



## Отработка отказа и аварийное восстановление

В сценарии аварийного восстановления основное устройство прекращает функционировать. В этой ситуации можно переместить облачные данные, связанные с вышедшим из строя устройством, на другое устройство, используя основное устройство в качестве *источника* и указав другое устройство в качестве *целевого объекта*. Для миграции на целевое устройство можно выбрать один или несколько контейнеров томов. Этот процесс называется *отработка отказа*.

Во время отработки отказа меняется владелец контейнеров томов с исходного устройства, а сами они перемещаются на целевое устройство. Когда у контейнеров томов меняется владелец, они удаляются с исходного устройства. По завершении удаления можно выполнить восстановление размещения конечного устройства.

Обычно после аварийного восстановления для восстановления данных на целевом устройстве используется последняя резервная копия. Однако если есть несколько политик резервного копирования для одного тома, выбирается политика с наибольшим числом томов и для восстановления данных на целевом устройстве используется последняя резервная копия из этой политики.

Например, рассмотрим наличие двух политик резервного копирования (стандартной и настраиваемой) *defaultPol* и *customPol* со следующими параметрами.

- *defaultPol*: один том *vol1*, выполняется ежедневно начиная с 22:30.
- *customPol*: четыре тома, *vol1*, *vol2*, *vol3*, *vol4*, выполняется ежедневно начиная с 22:00.

В этом случае будет использоваться политика *customPol* так как у нее больше томов, и, соответственно, выше отказоустойчивость. Для восстановления данных используется последняя резервная копия из этой политики.


## Рекомендации по отработке отказа устройства

В случае аварии можно выбрать отработку отказа устройства StorSimple:

- на физическое устройство;
- на само устройство;
- на виртуальное устройство.

Для отработки отказа на любое устройство необходимо помнить следующее:

- для аварийного восстановления необходимо, чтобы все тома в контейнерах томов находились в автономном режиме и с этими контейнерами томов был связан облачный моментальный снимок;
- в качестве целевых устройств для аварийного восстановления можно использовать устройства, на которых достаточно пространства для размещения выбранных контейнеров томов;
- подключенные к службе устройства, на которых недостаточно пространства, не будут доступны в качестве целевых устройств.
- После аварийного восстановления в течение ограниченного времени скорость доступа к данным может быть существенно снижена, так как устройству потребуется получить доступ к данным в облаке и сохранить их локально.

#### Отработка отказа устройством в разных версиях программного обеспечения

Служба StorSimple Manager в развертывании может обслуживать несколько устройств, физических и виртуальных, на которых могут выполняться разные версии программного обеспечения. В зависимости от используемой версии программного обеспечения типы томов на устройствах также могут отличаться. Например, устройство под управлением ПО с обновлением 2 или более поздней версии использует локально закрепленные и многоуровневые тома (при этом архивные тома являются подмножеством многоуровневых). С другой стороны, устройство под управлением ПО версии, предшествующей обновлению 2, может содержать многоуровневые и архивные тома.

Используйте следующую таблицу, чтобы определить, можно ли отработать отказ с переключением на другое устройство, которое отличается версией ПО и поведением типов томов, во время аварийного восстановления.

| Отработка отказа с | Разрешено для физического устройства | Разрешено для виртуального устройства |
|----------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
| С устройства с ПО с обновлением 2 на устройство с ПО до обновления 1 (версия 0.1, 0.2, 0.3). | Нет | Нет |
| С устройства с ПО с обновлением 2 на устройство с ПО с обновлением 1 (1, 1.1, 1.2). | Да.<br></br>Если используются локально закрепленные или многоуровневые тома, либо их сочетания, для них отработка отказа всегда выполняется как для многоуровневых томов. | Да.<br></br>Если используются локально закрепленные тома, для них отработка отказа выполняется как для многоуровневых томов. |
| С устройства с ПО с обновлением 2 на устройство с ПО с обновлением 2 (более поздней версии). | Да.<br></br>Если используются локально закрепленные или многоуровневые тома, либо их сочетания, для них отработка отказа выполняется в соответствии с исходным типом тома: для многоуровневых томов — как для многоуровневых, а для локально закрепленных томов — как для локально закрепленных. | Да.<br></br>Если используются локально закрепленные тома, для них отработка отказа выполняется как для многоуровневых томов. |


#### Частичная отработка отказа в разных версиях программного обеспечения

Следуйте указаниям, если собираетесь выполнить частичную отработку отказа с исходного устройства StorSimple с ПО, выпущенным до обновления 1, на целевое устройство с обновлением 1 или более поздней версией ПО.


| Источник при частичной отработке отказа | Разрешено для физического устройства | Разрешено для виртуального устройства |
|----------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|Из ПО до обновления 1 (версии 0.1, 0.2, 0.3) в ПО с обновлением 1 или более поздней версии | Да, см. рекомендацию ниже. | Да, см. рекомендацию ниже. |


>[AZURE.TIP] В обновление 1 и более поздние версии внесено изменение облачных метаданных и формата данных. Поэтому не рекомендуется частичная отработка отказа из ПО до обновления 1 в ПО с обновлением 1 или более поздней версии. Если необходимо выполнить частичную отработку отказа, рекомендуется сначала установить обновление 1 или более позднюю версию на оба устройства (исходное и целевое), а затем выполнить отработку отказа.

## Отработка отказа на другое физическое устройство

Для восстановления своего устройства на целевое физическое устройство выполните следующие действия.

1. Убедитесь, что с контейнером томов, для которого необходимо выполнить отработку отказа, связаны облачные моментальные снимки.

1. На странице **Устройства** выберите вкладку **Контейнеры томов**.

1. Выберите контейнер томов, для которого следует выполнить отработку отказа на другое устройство. Щелкните контейнер томов, чтобы открыть список томов в контейнере. Выберите том и щелкните **Отключить**, чтобы отключить том. Повторите эту процедуру для всех томов в контейнере томов.

1. Повторите предыдущий шаг для всех контейнеров томов, для которых необходимо выполнить отработку отказа на другое устройство.

1. На странице **Устройства** выберите **Отработка отказа**.

1. В открывшемся окне мастера в разделе **Выберите контейнер томов для отработки отказа**.

	1. В списке контейнеров томов выберите контейнеры томов, для которых следует выполнить отработку отказа. **Отображаться будут только контейнеры тома со связанными облачными моментальными снимками и тома в автономном режиме.**

	1. В поле **Выберите целевое устройство** для томов в выбранных контейнерах в раскрывающемся списке доступных устройств выберите целевое устройство. В раскрывающемся списке отображаются только те устройства, на которых есть доступная емкость.

	1. Наконец, просмотрите все настройки отработки отказа в разделе **Подтвердить отработку отказа**. Щелкните значок с изображением флажка ![значок с изображением флажка](./media/storsimple-device-failover-disaster-recovery/IC740895.png).

1. Будет создано задание отработки отказа, которое можно отслеживать на странице **Задания**. Если контейнер томов, для которого выполнена отработка отказа, содержит локальные тома, то в нем для каждого локального тома отобразятся задания восстановления (а для многоуровневых томов не отобразятся). На выполнение этих заданий может уйти довольно много времени. Вполне вероятно, что задание отработки отказа может завершиться раньше. Обратите внимание, что эти тома будут доступны локально только тогда, когда будут выполнены задания восстановления. После завершения отработки отказа, перейдите на страницу **Устройства**.

	1. Выберите устройство, которое было использовано в качестве целевого при отработке отказа.

	1. Перейдите на страницу **Контейнеры томов**. В списке должны отобразиться все контейнеры томов, а также тома со старого устройства.

## Отработка отказа с помощью одного устройства

При наличии только одного устройства для отработки отказа можно сделать вот что.

1. Создайте облачные моментальные снимки всех томов на устройстве.

1. Восстановите параметры устройства по умолчанию. Выполните подробные инструкции по [восстановлению параметров по умолчанию для устройства StorSimple](storsimple-manage-device-controller.md#reset-the-device-to-factory-default-settings).

1. Настройте устройство и снова зарегистрируйте его в службе диспетчера StorSimple.

1. На странице **Устройства** для старого устройства должно отображаться состояние **Отключено**. У только что зарегистрированного устройства отображается состояние **Включено**.

1. Для нового устройства сначала нужно выполнить минимальную настройку.
												
	>[AZURE.IMPORTANT] **Если не провести сначала минимальную настройку, в текущей реализации аварийное восстановление завершится сбоем из-за ошибки. Такое поведение будет исправлено в одном из последующих выпусков.**

1. Выберите старое устройство (отключенное) и щелкните **Отработка отказа**. В открывшемся мастере выполните отработку отказа устройства и укажите целевое устройство в качестве нового зарегистрированного устройства. Подробные инструкции см. в разделе [Отработка отказа на другое физическое устройство](#fail-over-to-another-physical-device).

1. Будет создано задание восстановления на устройство, за которым можно наблюдать на странице **Задания**.

1. После успешного выполнения задания перейдите на новое устройство и откройте страницу **Контейнеры томов**. Теперь все контейнеры томов из старого устройства следует перенести на новое устройство.

## Отработка отказа на виртуальное устройство StorSimple

Перед началом этой процедуры нужно создать и настроить виртуальное устройство StorSimple. Если выполняется ПО с обновлением 2, рассмотрите возможность использования для аварийного восстановления виртуального устройства 8020, которое обладает 64 ТБ памяти и использует хранилище класса Premium.
 
Вот как можно восстановить устройство на целевом виртуальном устройстве StorSimple.

1. Убедитесь, что с контейнером томов, для которого необходимо выполнить отработку отказа, связаны облачные моментальные снимки.

1. На странице **Устройства** выберите вкладку **Контейнеры томов**.

1. Выберите контейнер томов, для которого следует выполнить отработку отказа на другое устройство. Щелкните контейнер томов, чтобы открыть список томов в контейнере. Выберите том и щелкните **Отключить**, чтобы отключить том. Повторите эту процедуру для всех томов в контейнере томов.

1. Повторите предыдущий шаг для всех контейнеров томов, для которых необходимо выполнить отработку отказа на другое устройство.

1. На странице **Устройства** выберите **Отработка отказа**.

1. В окне мастера в разделе **Выбор контейнера томов для отработки отказа** выполните следующие действия.
													
	а. В списке контейнеров томов выберите контейнеры томов, для которых следует выполнить отработку отказа.

	**Отображаться будут только контейнеры тома со связанными облачными моментальными снимками и тома в автономном режиме.**

	b. На следующей странице в поле **Выберите целевое устройство для томов в выбранных контейнерах** в раскрывающемся списке доступных устройств выберите виртуальное устройство StorSimple. **В раскрывающемся списке отображаются только устройства с достаточной емкостью.**
	

1. Наконец, просмотрите все настройки отработки отказа в разделе **Подтвердить отработку отказа**. Щелкните значок с изображением флажка ![значок с изображением флажка](./media/storsimple-device-failover-disaster-recovery/IC740895.png).

1. После завершения отработки отказа, перейдите на страницу **Устройства**.
													
	а. Выберите виртуальное устройство StorSimple, используемое в качестве целевого устройства для отработки отказа.
	
	b. Перейдите на страницу **Контейнеры томов**. Теперь должны отобразиться все контейнеры томов, а также тома со старого устройства.

![Доступно видео](./media/storsimple-device-failover-disaster-recovery/Video_icon.png) **Доступно видео**

Чтобы посмотреть видео, показывающее процесс перемещения данных с физического устройства после сбоя на виртуальное устройство в облаке, щелкните [здесь](https://azure.microsoft.com/documentation/videos/storsimple-and-disaster-recovery/).


## Восстановление размещения

Для ПО с обновлением 3 и более поздних версий StorSimple также поддерживает восстановление размещения. После завершения тестовой отработки отказа выполняются следующие действия:

- Контейнеры томов, для которых выполнена отработка отказа, удаляются с исходного устройства.

- Фоновое задание для контейнера томов (для которого выполнена отработка отказа) запускается на исходном устройстве. При попытке восстановить размещение во время выполнения задания отобразится оповещение об этом. Потребуется дождаться завершения задачи, чтобы начать восстановление размещения.

	Длительность удаления контейнеров томов зависит от различных факторов, таких как объем данных, возраст данных, количество резервных копий и доступная пропускная способность сети для операции. Если вы планируете выполнить тестовую отработку отказа или тестовое восстановление размещения, то рекомендуем использовать для тестирования контейнеры томов с меньшим объемом данных (ГБ). В большинстве случаев восстановление размещения можно начать через 24 часа после отработки отказа.




## Часто задаваемые вопросы

В. **Что происходит в случае сбоя аварийного восстановления или его частичного выполнения?**

О. В случае сбоя аварийного восстановления рекомендуется повторить попытку восстановления. При повторном запуске аварийное восстановления будет знать, что уже было выполнено и когда был приостановлен процесс. Процесс будет возобновлен с момента остановки.

В. **Можно ли удалить устройство во время отработки отказа устройства?**

О. Во время выполнения аварийного восстановления невозможно удалить устройство. Устройство можно удалить только после завершения аварийного восстановления.

В. **Когда на исходном устройстве начинается сборка мусора, чтобы удалить с него локальные данные?**

О. Сборка мусора на исходном устройстве запускается только после его полной очистки. Очистка исходного устройства включает в себя удаление объектов, для которых была выполнена отработка отказа, таких как тома, объекты резервного копирования (не данные), контейнеры томов и политики.

В. **Что произойдет в случае сбоя задания удаления, связанного с контейнерами томов на исходном устройстве?**

О. В случае сбоя задания удаления необходимо запустить удаление контейнеров томов вручную. На странице **Устройства** выберите исходное устройство и щелкните **Контейнеры томов**. Выберите контейнеры томов, для которых была выполнена отработка отказа, и внизу страницы нажмите кнопку **Удалить**. После удаления с исходного устройства всех контейнеров томов, для которых выполнена отработка отказа, можно начать восстановление размещения.

## Аварийное восстановление непрерывности бизнеса (BCDR)

Сценарий аварийного восстановления непрерывности бизнеса (BCDR) реализуется, когда весь центр обработки данных Azure прекращает работу. Это может повлиять на службу диспетчера StorSimple и связанные устройства StorSimple.

Если есть устройства StorSimple, зарегистрированные непосредственно перед сбоем, этим устройствам StorSimple может потребоваться восстановление заводских настроек. После аварии устройство StorSimple будет отображаться как автономное. Устройство StorSimple необходимо удалить из портала и восстановить его заводские настройки, после чего повторить регистрацию.


## Дальнейшие действия

- После отработки отказа, возможно, нужно будет [отключить или удалить устройство StorSimple](storsimple-deactivate-and-delete-device.md).

- Сведения об управлении устройством с помощью службы диспетчера StorSimple см. в статье [Использование службы StorSimple Manager для администрирования устройства StorSimple](storsimple-manager-service-administration.md).
 

<!---HONumber=AcomDC_0921_2016-->