---
title: Тестирование производительности облачной службы | Документация Майкрософт
description: Протестируйте производительность облачной службы с помощью профилировщика Visual Studio
services: visual-studio-online
documentationcenter: n/a
author: mikejo
manager: douge
editor: ''
ms.assetid: 7a5501aa-f92c-457c-af9b-92ea50914e24
ms.service: visual-studio-online
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: multiple
ms.workload: na
ms.date: 11/11/2016
ms.author: mikejo
ms.openlocfilehash: 74ffd70bdb204cee75b86a1e922ac67873a88758
ms.sourcegitcommit: 34e0b4a7427f9d2a74164a18c3063c8be967b194
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2018
ms.locfileid: "30292158"
---
# <a name="testing-the-performance-of-a-cloud-service"></a>Тестирование производительности облачной службы
## <a name="overview"></a>Обзор
Производительность облачной службы можно проверить следующими способами.

* Воспользоваться системой диагностики Azure для сбора сведений о запросах и подключениях и просмотра статистики сайта, которые показывают, как работает служба с точки зрения клиента. Чтобы приступить к работе, ознакомьтесь с разделом [Настройка системы диагностики для облачных служб и виртуальных машин Azure](http://go.microsoft.com/fwlink/p/?LinkId=623009).
* Воспользоваться профилировщиком Visual Studio для выполнения глубокого анализа вычислительных аспектов работы службы. Как описано в этом разделе, с помощью профилировщика можно измерить производительность работы службы в Azure. Сведения о том, как использовать профилировщик для измерения производительности работы службы, запущенной локально в эмуляторе вычислений, см. в разделе [Локальное тестирование производительности облачной службы в эмуляторе вычислений Azure с помощью профилировщика Visual Studio](http://go.microsoft.com/fwlink/p/?LinkId=262845).

## <a name="choosing-a-performance-testing-method"></a>Выбор метода тестирования производительности
### <a name="use-azure-diagnostics-to-collect"></a>Воспользуйтесь системой диагностики Azure для сбора:
* статистики для веб-страниц или служб, такой как запросы и подключения;
* статистики по ролям, например, частоты перезапуска роли;
* общей информации об использовании памяти, например, процента времени, занимаемого сборщиком мусора, и набора памяти запущенной роли.

### <a name="use-the-visual-studio-profiler-to"></a>Воспользуйтесь профилировщиком Visual Studio для:
* определения функций, на выполнение которых уходит большая часть времени;
* измерения количества времени, которое занимает каждая часть программы с большим объемом вычислений;
* сравнения подробных отчетов о производительности для двух версий службы;
* анализа выделения памяти более подробно, чем на уровне отдельных выделений памяти;
* анализа проблем параллелизма в многопоточном коде.

С помощью профилировщика можно собирать данные при запуске облачной службы локально или в Azure.

### <a name="collect-profiling-data-locally-to"></a>Сбор данных профилирования локально позволит:
* протестировать производительность части облачной службы (например, выполнение определенной рабочей роли), которая не требует реалистичного моделирования нагрузки;
* протестировать производительность облачной службы изолированно в контролируемых условиях;
* протестировать производительность облачной службы перед ее развертыванием в Azure;
* протестировать производительность облачной службы в частном порядке, без нарушения работы существующих развертываний;
* протестировать производительность облачной службы без платы за ее запуск в Azure.

### <a name="collect-profiling-data-in-azure-to"></a>Сбор данных профилирования в Azure позволит:
* протестировать производительность облачной службы с моделируемой или реальной нагрузкой;
* использовать метод инструментирования для сбора данных профилирования, как описано далее в этом разделе;
* протестировать производительность облачной службы в среде, которая аналогична рабочей среде для запуска службы.

Нагрузка для тестирования облачных служб обычно моделируется для обычной или нештатной ситуации.

## <a name="profiling-a-cloud-service-in-azure"></a>Профилирование облачной службы в Azure
При публикации облачной службы из Visual Studio можно выполнить профилирование службы и задать параметры профилирования, которые позволят получить необходимую вам информацию. Сеанс профилирования запускается для каждого экземпляра роли. Дополнительные сведения о публикации службы из Visual Studio см. в разделе [Публикация в облачной службе Azure из Visual Studio](https://msdn.microsoft.com/library/azure/ee460772.aspx).

Чтобы узнать больше о профилировании производительности в Visual Studio, изучите статьи [Руководство по профилированию производительности для начинающих](https://msdn.microsoft.com/library/azure/ms182372.aspx) и [Использование средств профилирования](https://msdn.microsoft.com/library/azure/z9z62c29.aspx).

> [!NOTE]
> При публикации облачной службы можно включить IntelliTrace или профилирование. И то, и другое одновременно включить нельзя.
> 
> 

### <a name="profiler-collection-methods"></a>Методы сбора данных профилировщика
Для профилирования можно использовать различные методы сбора данных в зависимости от того, какую статистику по производительности необходимо получить:

* **Выборка из ЦП** — этот метод осуществляет сбор статистики приложения, которую удобно использовать для первоначального анализа проблем использования ЦП. Большинство исследований производительности рекомендуется начинать с выборки из ЦП. Сбор данных выборки ЦП не оказывает существенного влияния на профилируемое приложение.
* **Инструментирование** — этот метод осуществляет сбор подробных временных данных, которые удобно использовать для целенаправленного анализа и для анализа проблем производительности ввода/вывода. Метод инструментирования регистрирует каждый вход и выход  из функции и каждый вызов функции для всех функций модуля во время профилирования. Этот метод удобен для сбора подробных временных данных для заданного фрагмента кода и для оценки влияния операций ввода/вывода на производительность приложения. На компьютерах, работающих под управлением 32-разрядных операционных систем, этот метод недоступен. Этот метод доступен только при запуске облачной службы в Azure, а не локально в эмуляторе вычислений.
* **Выделение памяти .NET** — этот метод осуществляет сбор данных о выделении памяти .NET Framework с помощью метода профилирования с выборкой. Собранные данные включают количество и размер выделенных объектов.
* **Параллелизм** — этот метод осуществляет сбор данных о конфликтах ресурсов и данных о выполнении процессов и потоков. Эти данные полезны для анализа многопоточных и многопроцессных приложений. Метод параллелизма собирает данные для каждого события, которое блокирует выполнение кода, например когда поток ожидает освобождения доступа к заблокированному ресурсу приложения. Этот метод удобен для анализа многопоточных приложений.
* Можно также включить **профилирование межуровневого взаимодействия**, которое предоставляет дополнительные сведения о времени выполнения синхронных вызовов ADO.NET в функциях многоуровневых приложений, взаимодействующих с одной или несколькими базами данных. Данные о межуровневом взаимодействии можно получить с помощью любого из методов профилирования. Дополнительные сведения о профилировании межуровневого взаимодействия см. в разделе [Представление "Взаимодействие между уровнями"](https://msdn.microsoft.com/library/azure/dd557764.aspx).

## <a name="configuring-profiling-settings"></a>Настройка параметров профилирования
На рисунке ниже показано, как настроить параметры профилирования в диалоговом окне "Публикация приложения Azure".

![Настроить параметры профилирования](./media/vs-azure-tools-performance-profiling-cloud-services/IC526984.png)

> [!NOTE]
> Чтобы установить флажок **Включить профилирование** , сначала установите профилировщик на локальном компьютере, который используется для публикации облачной службы. По умолчанию профилировщик устанавливается во время установки Visual Studio.
> 
> 

### <a name="to-configure-profiling-settings"></a>Для настройки параметров профилирования
1. В обозревателе решений откройте контекстное меню проекта Azure и выберите **Опубликовать**. Подробные инструкции по публикации облачной службы см. в статье [Публикация облачной службы с помощью инструментов Azure](http://go.microsoft.com/fwlink/p?LinkId=623012).
2. В диалоговом окне **Опубликовать приложение Azure** выберите вкладку **Дополнительные настройки**.
3. Чтобы включить профилирование, установите флажок **Включить профилирование** .
4. Чтобы настроить параметры профилирования, выберите гиперссылку **Параметры** . Откроется диалоговое окно "Параметры профилирования".
5. С помощью переключателей из раздела **Какой способ профилирования вы хотели бы использовать** выберите нужный тип профилирования.
6. Чтобы собирать данные профилирования для уровневого взаимодействия, установите флажок **Включить профилирование уровневого взаимодействия** .
7. Чтобы сохранить настройки, нажмите кнопку **ОК** .
   
    Во время публикации приложения эти параметры будут использоваться для создания сеанса профилирования для каждой роли.

## <a name="viewing-profiling-reports"></a>Просмотр отчетов профилирования
Сеанс профилирования создается для каждого экземпляра роли в облачной службе. Для просмотра отчетов профилирования для каждой сессии в Visual Studio откройте окно обозревателя сервера и выберите вычислительный узел Azure, после чего выберите экземпляр роли. Затем вы сможете просмотреть отчет о профилировании, как показано на следующем рисунке.

![Просмотр отчета профилирования Azure](./media/vs-azure-tools-performance-profiling-cloud-services/IC748914.png)

### <a name="to-view-profiling-reports"></a>Для просмотра отчетов профилирования
1. Чтобы открыть окно обозревателя сервера в Visual Studio, выберите меню "Представление", затем "Обозреватель сервера".
2. Выберите вычислительный узел Azure и затем выберите узел развертывания Azure для облачной службы, которую вы выбрали для профилирования при публикации из Visual Studio.
3. Чтобы просмотреть отчеты о профилировании экземпляра, выберите роль в службе, откройте контекстное меню конкретного экземпляра и выберите **Просмотреть отчет профилирования**.
   
    VSP-файл отчета будет скачан из Azure, а состояние скачивания отобразится в журнале действий Azure. После завершения скачивания отчет о профилировании откроется в редакторе Visual Studio на вкладке с именем <Role name>*<Instance Number>*<identifier>.vsp. Будут показаны сводные данные отчета.
4. Для отображения различных представлений отчета выберите необходимый тип представления в списке "Текущее представление". Дополнительные сведения см. в статье [Представления отчетов средств профилирования](https://msdn.microsoft.com/library/azure/bb385755.aspx).

## <a name="next-steps"></a>Дополнительная информация
[Отладка облачных служб](https://msdn.microsoft.com/library/azure/ee405479.aspx)

[Публикация в облачной службе Azure из Visual Studio](https://msdn.microsoft.com/library/azure/ee460772.aspx)

