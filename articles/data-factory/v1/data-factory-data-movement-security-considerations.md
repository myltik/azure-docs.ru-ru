---
title: Вопросы безопасности при перемещении данных в фабрике данных Azure | Документация Майкрософт
description: Узнайте о безопасном перемещении данных в фабрике данных Azure.
services: data-factory
documentationcenter: ''
author: nabhishek
manager: craigg
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 01/10/2018
ms.author: abnarain
robots: noindex
ms.openlocfilehash: cad363309b6086197ced1a5d1c1793995db11228
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34621628"
---
# <a name="azure-data-factory---security-considerations-for-data-movement"></a>Вопросы безопасности при перемещении данных в фабрике данных Azure

> [!NOTE]
> Статья относится к версии 1 фабрики данных, которая является общедоступной версией. Если вы используете версию 2 службы фабрики данных, которая находится на этапе предварительной версии, см. [рекомендации по безопасному перемещению данных в фабрике данных версии 2](../data-movement-security-considerations.md).

## <a name="introduction"></a>Введение
В этой статье описывается базовая инфраструктура безопасности, используемая службами перемещения данных в фабрике данных Azure для защиты данных. Ресурсы управления фабрики данных Azure созданы на основе инфраструктуры безопасности Azure и используют все возможные меры безопасности, предлагаемые Azure.

С помощью фабрики данных можно создать один или несколько [конвейеров](data-factory-create-pipelines.md)данных. Конвейеры — это логические группы действий, которые вместе отвечают за выполнение задачи. Эти конвейеры реализуются в регионе, где была создана фабрика данных. 

Хотя фабрика данных доступна только в **западной части США**, **восточной части США** и **Северной Европе**, служба перемещения данных доступна [глобально в нескольких регионах](data-factory-data-movement-activities.md#global). Служба фабрики данных обеспечивает постоянный географический регион для данных, если вы явно не укажите ей использовать запасной регион в случае, когда служба перемещения данных еще не развернута в этом регионе. 

Сама фабрика данных Azure не хранит никакие данные, за исключением учетных данных связанной службы для облачных хранилищ данных, зашифрованных с помощью сертификатов. Она предоставляет возможность создавать управляемые данными рабочие процессы для обработки данных с помощью [служб вычислений](data-factory-compute-linked-services.md) в других регионах или локальной среде и оркестрации перемещения данных между [поддерживаемыми хранилищами](data-factory-data-movement-activities.md#supported-data-stores-and-formats). Кроме того, с помощью фабрики данных можно [отслеживать рабочие процессы и управлять ими](data-factory-monitor-manage-pipelines.md) , используя программные методы и пользовательский интерфейс.

Перемещение данных с помощью фабрики данных Azure было **сертифицировано** для:
-   [HIPAA/HITECH](https://www.microsoft.com/en-us/trustcenter/Compliance/HIPAA);  
-   [ISO/IEC 27001](https://www.microsoft.com/en-us/trustcenter/Compliance/ISO-IEC-27001);  
-   [ISO/IEC 27018](https://www.microsoft.com/en-us/trustcenter/Compliance/ISO-IEC-27018); 
-   [CSA STAR](https://www.microsoft.com/en-us/trustcenter/Compliance/CSA-STAR-Certification).
     
Если вас интересует, как Azure обеспечивает соответствие требованиям и защищает собственную инфраструктуру, посетите [центр управления безопасностью Майкрософт](https://www.microsoft.com/TrustCenter/default.aspx). 

В этой статье мы рассмотрим вопросы безопасности в следующих двух сценариях перемещения данных: 

- **Облачный сценарий**, в котором источник и приемник являются общедоступными через Интернет. Эти источники данных включают управляемые службы облачного хранения, например служба хранилища Azure, хранилище данных SQL Azure, база данных SQL Azure, Azure Data Lake Store, Amazon S3, Amazon Redshift, службы SaaS (Salesforce) и такие веб-протоколы, как FTP и OData. Полный список поддерживаемых источников данных можно найти [здесь](data-factory-data-movement-activities.md#supported-data-stores-and-formats).
- **Гибридный сценарий**, в котором источник или приемник находятся за брандмауэром или внутри локальной корпоративной сети. Либо хранилище данных находится в частной или виртуальной сети (чаще всего это актуально для источника), а также не является общедоступным. Этот сценарий также охватывает серверы базы данных, расположенные на виртуальных машинах.

## <a name="cloud-scenarios"></a>Облачные сценарии
### <a name="securing-data-store-credentials"></a>Защита учетных данных хранилища данных
Фабрика данных Azure защищает учетные данные хранилища данных, выполняя их **шифрование** с помощью **сертификатов, управляемых Майкрософт**. Эти сертификаты меняются каждые **два года**. Изменения включают продление сертификата и перемещение учетных данных. Зашифрованные учетные данные безопасно хранятся в **службе хранилища Azure, которая контролируется службами управления фабрики данных Azure**. Дополнительные сведения о безопасности службы хранилища Azure см. [здесь](../../security/security-storage-overview.md).

### <a name="data-encryption-in-transit"></a>Шифрование данных при передаче
Если облачное хранилище данных поддерживает протоколы HTTPS или TLS, то передача всех данных между службами перемещения данных в фабрике данных и облачным хранилищем данных выполняется через эти защищенные каналы.

> [!NOTE]
> Во время передачи данных в базу данных и из нее все подключения к **базе данных SQL Azure** и **хранилищу данных SQL Azure** должны быть зашифрованы (с помощью SSL или TLS). Во время разработки конвейера с помощью редактора JSON добавьте свойство **шифрования** и задайте для него в **строке подключения** значение **true**. Если вы используете [мастер копирования](data-factory-azure-copy-wizard.md), это свойство задается по умолчанию. Для службы **хранилища Azure** вы можете использовать в строке подключения протокол **HTTPS**.

### <a name="data-encryption-at-rest"></a>Шифрование неактивных данных
Некоторые хранилища данных поддерживают шифрование неактивных данных. Мы советуем включить механизм шифрования данных для этих хранилищ данных. 

#### <a name="azure-sql-data-warehouse"></a>Хранилище данных SQL Azure
Прозрачное шифрование данных хранилища данных SQL Azure помогает защититься от вредоносных атак благодаря шифрованию и расшифровке неактивных данных в реальном времени. Этот процесс является прозрачным для клиента. Дополнительные сведения см. в статье [Защита базы данных в хранилище данных SQL](../../sql-data-warehouse/sql-data-warehouse-overview-manage-security.md).

#### <a name="azure-sql-database"></a>Базы данных SQL Azure
База данных SQL Azure также поддерживает прозрачное шифрование данных, которое помогает защититься от угрозы вредоносных атак за счет шифрования и расшифровки данных в реальном времени, не внося изменения в само приложение. Этот процесс является прозрачным для клиента. Дополнительные сведения см. в статье [Transparent Data Encryption with Azure SQL Database](https://docs.microsoft.com/sql/relational-databases/security/encryption/transparent-data-encryption-with-azure-sql-database) (Прозрачное шифрование данных в базе данных SQL Azure). 

#### <a name="azure-data-lake-store"></a>Хранилище озера данных Azure
В Azure Data Lake Store можно также включить шифрование данных, хранящихся в учетной записи. При включении Data Lake Store автоматически шифрует данные перед сохранением и расшифровывает их до извлечения. Таким образом данные полностью прозрачны для клиента, который получает к ним доступ. Дополнительные сведения см. в статье [Обеспечение безопасности в хранилище озера данных Azure](../../data-lake-store/data-lake-store-security-overview.md). 

#### <a name="azure-blob-storage-and-azure-table-storage"></a>Хранилище BLOB-объектов Azure и хранилище таблиц Azure
Хранилище BLOB-объектов Azure и хранилище таблиц Azure поддерживают функцию шифрования службы хранилища, которая автоматически шифрует данные перед их сохранением в хранилище и расшифровывает их до извлечения. Дополнительные сведения см. в статье [Шифрование службы хранилища Azure для неактивных данных (предварительная версия)](../../storage/common/storage-service-encryption.md).

#### <a name="amazon-s3"></a>Amazon S3
Amazon S3 поддерживает шифрование неактивных данных для сервера и клиента. Дополнительные сведения см. в документации [Protecting Data Using Encryption](http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingEncryption.html) (Защита данных с помощью шифрования). Сейчас фабрика данных не поддерживает Amazon S3 в виртуальном частном облаке.

#### <a name="amazon-redshift"></a>Amazon Redshift
Amazon Redshift поддерживает шифрование неактивных данных кластера. Дополнительные сведения см. в документации [Amazon Redshift Database Encryption](http://docs.aws.amazon.com/redshift/latest/mgmt/working-with-db-encryption.html) (Шифрование базы данных Amazon Redshift). Сейчас фабрика данных не поддерживает Amazon Redshift в виртуальном частном облаке. 

#### <a name="salesforce"></a>Salesforce
SalesForce поддерживает шифрование Shield Platform Encryption, которое позволяет зашифровать все файлы, вложения и настраиваемые поля. Дополнительные сведения см. в статье [Understanding the Web Server OAuth Authentication Flow](https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/intro_understanding_web_server_oauth_flow.htm) (Основные сведения о потоке проверки подлинности OAuth веб-сервера).  

## <a name="hybrid-scenarios-using-data-management-gateway"></a>Гибридные сценарии (с использованием шлюза управления данных)
Для использования гибридных сценариев необходимо установить шлюз управления данными. Его можно установить в локальной сети или внутри виртуальной сети (Azure), а также в виртуальном частном облаке (Amazon). Шлюзу должен быть предоставлен доступ к локальным хранилищам данных. Дополнительные сведения о шлюзе управления данными см. [здесь](data-factory-data-management-gateway.md). 

![Каналы шлюза управления данными](media/data-factory-data-movement-security-considerations/data-management-gateway-channels.png)

**Канал команд** обеспечивает взаимодействие между службами перемещения данных в фабрике данных и шлюзом управления данными. Этот коммуникационный канал содержит сведения, связанные с действиями. Канал данных используется для передачи данных между локальными хранилищами данных и облачными хранилищами.    

### <a name="on-premises-data-store-credentials"></a>Учетные данные локального хранилища данных
Учетные данные для локальных хранилищ данных хранятся локально (не в облаке). Их можно задать тремя разными способами. 

- С помощью **обычного текста** (обеспечивает меньшую защиту) через протокол HTTPS, используя портал Azure или мастер копирования. Учетные данные передаются в локальный шлюз в виде обычного текста.
- С помощью **библиотеки шифрования JavaScript из мастера копирования**.
- С помощью **диспетчера учетных данных на основе ClickOnce-приложения**. ClickOnce-приложение выполняется на локальной машине, у которой есть доступ к шлюзу. Это приложение задает учетные данные для хранилища данных. Этот параметр и следующий являются наиболее безопасными. Диспетчер учетных данных использует по умолчанию порт 8050 на компьютере со шлюзом для безопасного взаимодействия.  
- Используйте командлет PowerShell [New-AzureRmDataFactoryEncryptValue](/powershell/module/azurerm.datafactories/New-AzureRmDataFactoryEncryptValue), чтобы зашифровать учетные данные. Командлет шифрует учетные данные с помощью сертификата, который настроен в шлюзе. Вы можете использовать зашифрованные учетные данные, возвращенные этим командлетом, и добавить его в элемент **EncryptedCredential** **строки подключения** в JSON-файле, который вы использовали с командлетом [New-AzureRmDataFactoryLinkedService](/powershell/module/azurerm.datafactories/new-azurermdatafactorylinkedservice), или во фрагмент кода JSON в редакторе фабрики данных на портале. Этот параметр и ClickOnce-приложение являются наиболее безопасными. 

#### <a name="javascript-cryptography-library-based-encryption"></a>Шифрование на основе библиотеки шифрования JavaScript
Вы можете зашифровать учетные данные хранилища данных с помощью [библиотеки шифрования JavaScript](https://www.microsoft.com/download/details.aspx?id=52439) из [мастера копирования](data-factory-copy-wizard.md). При выборе этого параметра мастер копирования извлекает открытый ключ шлюза и использует его для шифрования учетных данных хранилища данных. Эти учетные данные расшифровываются с помощью компьютера шлюза и защищаются с помощью Windows [DPAPI](https://msdn.microsoft.com/library/ms995355.aspx).

**Поддерживаемые браузеры:** IE8, IE9, IE10, IE11, Microsoft Edge, последние версии Firefox, Chrome, Opera и Safari. 

#### <a name="click-once-credentials-manager-app"></a>Диспетчер учетных данных ClickOnce-приложения
Вы можете запустить диспетчер учетных данных на основе ClickOnce-приложения из портала Azure или мастера копирования при создании конвейеров. Благодаря этому приложению учетные данные не передаются в виде обычного текста. Для безопасного взаимодействия это приложение по умолчанию использует на компьютере со шлюзом порт **8050**. При необходимости этот порт можно изменить.  
  
![HTTPS-порт для шлюза](media/data-factory-data-movement-security-considerations/https-port-for-gateway.png)

В настоящее время шлюз управления данными использует единый **сертификат**. Этот сертификат создается во время установки шлюза (применимо к шлюзу управления данными, созданному после ноября 2016 г., и для версии 2.4.xxxx.x или более поздних). Вы можете заменить этот сертификат собственным сертификатом SSL или TLS. Этот сертификат используется приложением диспетчера учетных данных на основе ClickOnce-приложения для безопасного подключения к компьютеру шлюза для настройки учетных данных хранилища данных. Он локально безопасно хранит учетные данные хранилища данных, используя защиту данных Windows [DPAPI](https://msdn.microsoft.com/library/ms995355.aspx) на компьютере со шлюзом. 

> [!NOTE]
> Более ранние версии шлюзов, установленные до ноября 2016 г., или версии 2.3.xxxx.x продолжают использовать учетные данные, зашифрованные и хранимые в облаке. Даже если вы обновите шлюз до последней версии, учетные данные не будут перемещены на локальный компьютер.    
  
| Версия шлюза (во время создания) | Хранимые учетные данные | Шифрование и безопасность учетных данных | 
| --------------------------------- | ------------------ | --------- |  
| < = 2.3.xxxx.x | В облаке | Зашифрованные с помощью сертификата (отличного от сертификата, используемого диспетчером учетных данных) | 
| > = 2.4.xxxx.x | Локально | Защищен с помощью DPAPI | 
  

### <a name="encryption-in-transit"></a>Шифрование при передаче
Все передачи данных выполняются через защищенный канал **HTTPS** и **TLS через TCP**, чтобы предотвратить атаки "злоумышленник в середине" во время взаимодействия со службами Azure.
 
Вы также можете использовать [VPN-подключение IPSec](../../vpn-gateway/vpn-gateway-about-vpn-devices.md) или [Express Route](../../expressroute/expressroute-introduction.md), чтобы в дальнейшем обеспечить безопасность коммуникационного канала между локальной сетью и Azure.

Виртуальная сеть — это логическое представление сети в облаке. Вы можете подключить локальную сеть к виртуальной сети Azure (VNet), настроив VPN-подключение IPSec типа "сеть — сеть" или Express Route (частный пиринг).     

В таблице ниже представлены общие рекомендации для настройки шлюза и сети на основе различных комбинаций исходного и целевого расположений для гибридного перемещения данных.

| Источник | Место назначения | Конфигурация сети | Установка шлюза |
| ------ | ----------- | --------------------- | ------------- | 
| Локальная система | Виртуальные машины и облачные службы, развернутые в виртуальных сетях | VPN-подключение IPSec (типа "точка — сеть" или "сеть — сеть") | Вы можете установить шлюз на локальной виртуальной машине или виртуальной машине Azure в виртуальной сети. | 
| Локальная система | Виртуальные машины и облачные службы, развернутые в виртуальных сетях | ExpressRoute (частный пиринг) | Вы можете установить шлюз на локальной виртуальной машине или виртуальной машине Azure в виртуальной сети | 
| Локальная система | Службы на базе Azure, у которых есть общедоступная конечная точка | ExpressRoute (общедоступный пиринг) | Шлюз должен быть установлен локально | 

На изображениях ниже показано использование шлюза управления данными для перемещения данных между локальной базой данных и службами Azure с помощью ExpressRoute и VPN-подключения IPSec (с помощью виртуальной сети).

**ExpressRoute:**
 
![Использование ExpressRoute со шлюзом](media/data-factory-data-movement-security-considerations/express-route-for-gateway.png) 

**VPN-подключение IPSec:**

![VPN-подключение IPSec со шлюзом](media/data-factory-data-movement-security-considerations/ipsec-vpn-for-gateway.png)

### <a name="firewall-configurations-and-whitelisting-ip-address-of-gateway"></a>Параметры конфигурации брандмауэра и добавление IP-адреса шлюза в список разрешенных

#### <a name="firewall-requirements-for-on-premisesprivate-network"></a>Требования к брандмауэру для локальной или частной сети  
На предприятии **корпоративный брандмауэр** работает на центральном маршрутизаторе организации. А **брандмауэр Windows** работает как управляющая программа на локальном компьютере, на котором установлен шлюз. 

В таблице ниже представлены **исходящий порт** и требования к домену для **корпоративного брандмауэра**.

| Имена доменов | Исходящие порты | ОПИСАНИЕ |
| ------------ | -------------- | ----------- | 
| `*.servicebus.windows.net` | 443, 80 | Требуется шлюзу для подключения к службам перемещения данных в фабрике данных. |
| `*.core.windows.net` | 443 | Используется шлюзом для подключения к учетной записи хранения Azure при помощи функции [промежуточного копирования](data-factory-copy-activity-performance.md#staged-copy). | 
| `*.frontend.clouddatahub.net` | 443 | Требуется шлюзу для подключения к службе фабрики данных Azure. | 
| `*.database.windows.net` | 1433   | (Необязательно.) Требуется, если местом назначения является база данных SQL Azure или хранилище данных SQL Azure. Используйте функцию промежуточного копирования, чтобы копировать данные в базу данных SQL Azure или хранилище данных SQL Azure без необходимости открывать порт 1433. | 
| `*.azuredatalakestore.net` | 443 | (Необязательно.) Требуется, если местом назначения является Azure Data Lake Store. | 

> [!NOTE] 
> Вам может потребоваться управлять портами или создать утвержденный список доменов на уровне корпоративного брандмауэра в соответствии с определенными источниками данных. В этой таблице в качестве примеров используются база данных SQL Azure, хранилище данных SQL Azure и Azure Data Lake Store.   

В следующей таблице представлены требования к **входящему порту** для **брандмауэра Windows**.

| Входящие порты | ОПИСАНИЕ | 
| ------------- | ----------- | 
| 8050 (TCP) | Требуется диспетчером учетных данных для их безопасной настройки для локальных хранилищ данных шлюза. | 

![Требования к порту шлюза](media\data-factory-data-movement-security-considerations/gateway-port-requirements.png) 

#### <a name="ip-configurations-whitelisting-in-data-store"></a>Конфигурации IP или утвержденный список в хранилище данных
Некоторые хранилища данных в облаке также требуют, чтобы IP-адрес компьютера, который получает к ним доступ, был добавлен в список разрешенных. IP-адрес компьютера шлюза должен быть разрешенным и корректно настроенным в брандмауэре.

Ниже перечислены облачные хранилища данных, которым необходим разрешенный IP-адрес компьютера шлюза. Некоторым из них по умолчанию это может не требоваться. 

- [база данных SQL Azure;](../../sql-database/sql-database-firewall-configure.md) 
- [Хранилище данных Azure SQL](../../sql-data-warehouse/sql-data-warehouse-get-started-provision.md)
- [Хранилище озера данных Azure](../../data-lake-store/data-lake-store-secure-data.md#set-ip-address-range-for-data-access)
- [Azure Cosmos DB](../../cosmos-db/firewall-support.md)
- [Amazon Redshift](http://docs.aws.amazon.com/redshift/latest/gsg/rs-gsg-authorize-cluster-access.html) 

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

**Вопрос**. Может ли для различных фабрик данных использоваться один шлюз?
**Ответ**. В настоящее время эта функция не поддерживается. Но мы работаем над этим.

**Вопрос**. Каковы требования к порту для работы шлюза?
**Ответ**. Шлюз пропускает HTTP-соединения в Интернет. Для установки подключения для шлюза должны быть открыты **исходящие порты 443 и 80**. Откройте **входящий порт 8050** только на уровне компьютера (не на уровне корпоративного брандмауэра) для диспетчера учетных данных. Если база данных SQL Azure или хранилище данных SQL Azure используются в качестве исходного или целевого объектов, тогда вам также необходимо открыть порт **1433**. Дополнительные сведения см. в разделе [о параметрах конфигурации брандмауэра и утвержденном списке IP-адресов](#firewall-configurations-and-whitelisting-ip-address-of gateway). 

**Вопрос**. Каковы требования сертификата к шлюзу?
**Ответ**. Текущий шлюз требует сертификат, который будет использоваться диспетчером учетных данных для безопасной настройки учетных данных хранилища данных. Этот сертификат является самозаверяющим, созданным и настроенным во время установки шлюза. Вместо этого сертификата вы можете использовать собственный сертификат TLS или SSL. Дополнительные сведения см. в разделе о [диспетчере учетных данных ClickOnce-приложения](#click-once-credentials-manager-app). 

## <a name="next-steps"></a>Дополнительная информация
Дополнительные сведения о производительности действия копирования см. в [руководстве о производительности действия копирования и его настройке](data-factory-copy-activity-performance.md).

 
