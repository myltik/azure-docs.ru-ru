---
title: Вопросы безопасности в фабрике данных Azure | Документация Майкрософт
description: В этой статье описывается базовая инфраструктура безопасности, используемая службами перемещения данных в фабрике данных Azure для помощи в защите информации.
services: data-factory
documentationcenter: ''
author: nabhishek
manager: craigg
ms.reviewer: douglasl
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 02/26/2018
ms.author: abnarain
ms.openlocfilehash: 80cec0bc8136142f30ea7b957de819379b1bb139
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34619139"
---
#  <a name="security-considerations-for-data-movement-in-azure-data-factory"></a>Вопросы безопасности при перемещении данных в фабрике данных Azure
> [!div class="op_single_selector" title1="Select the version of Data Factory service you are using:"]
> * [Версия 1 — общедоступная](v1/data-factory-data-movement-security-considerations.md)
> * [Версия 2 — предварительная](data-movement-security-considerations.md)

В этой статье описывается базовая инфраструктура безопасности, используемая службами перемещения данных в фабрике данных Azure для помощи в защите данных. Ресурсы управления фабрики данных созданы на основе инфраструктуры безопасности Azure и используют все возможные меры безопасности, предлагаемые Azure.

> [!NOTE]
> Эта статья относится к версии 2 фабрики данных, которая в настоящее время доступна в предварительной версии. Если вы используете общедоступную версию 1 службы фабрики данных, см. статью [Вопросы безопасности при перемещении данных в фабрике данных Azure](v1/data-factory-data-movement-security-considerations.md).

С помощью фабрики данных можно создать один или несколько [конвейеров](concepts-pipelines-activities.md)данных. Конвейеры — это логические группы действий, которые вместе отвечают за выполнение задачи. Эти конвейеры реализуются в регионе, где была создана фабрика данных. 

Хотя фабрика данных доступна только в восточной части США, восточной части США 2 и Западной Европе (предварительная версия 2), служба перемещения данных доступна [глобально в нескольких регионах](concepts-integration-runtime.md#azure-ir). Если служба перемещения данных еще не развернута в этом регионе, служба фабрики данных гарантирует, что данные не покинут географическую область или регион, пока службе не будет явно указано использовать альтернативный регион. 

Фабрика данных Azure не хранит никакие данные, за исключением учетных данных связанной службы для облачных хранилищ данных, которые зашифрованы с помощью сертификатов. Используя фабрику данных, можно создать управляемые данными рабочие процессы, чтобы организовать перемещение данных между [поддерживаемыми хранилищами данных](copy-activity-overview.md#supported-data-stores-and-formats) и обработку данных с помощью [служб вычислений](compute-linked-services.md) в других регионах или локальной среде. Кроме того, можно отслеживать рабочие процессы и управлять ими с помощью пакетов SDK и Azure Monitor.

Перемещение данных с помощью фабрики данных было сертифицировано для:
-   [HIPAA/HITECH](https://www.microsoft.com/en-us/trustcenter/Compliance/HIPAA); 
-   [ISO/IEC 27001](https://www.microsoft.com/en-us/trustcenter/Compliance/ISO-IEC-27001);  
-   [ISO/IEC 27018](https://www.microsoft.com/en-us/trustcenter/Compliance/ISO-IEC-27018);
-   [CSA STAR](https://www.microsoft.com/en-us/trustcenter/Compliance/CSA-STAR-Certification).

Если вас интересует, как Azure обеспечивает соответствие требованиям и защищает собственную инфраструктуру, посетите [центр управления безопасностью Майкрософт](https://www.microsoft.com/trustcenter).

В этой статье мы рассмотрим вопросы безопасности в следующих двух сценариях перемещения данных: 

- **Облачный сценарий**, в котором источник и приемник являются общедоступными через Интернет. Эти источники данных включают управляемые службы облачного хранения, например служба хранилища Azure, хранилище данных SQL Azure, база данных SQL Azure, Azure Data Lake Store, Amazon S3, Amazon Redshift, службы SaaS (Salesforce) и такие веб-протоколы, как FTP и OData. Полный список поддерживаемых источников данных можно найти в разделе [Поддерживаемые хранилища данных и форматы](copy-activity-overview.md#supported-data-stores-and-formats).
- **Гибридный сценарий**, в котором источник или приемник находится за брандмауэром или внутри локальной корпоративной сети. Или хранилище данных находится в частной или виртуальной сети (чаще всего это актуально для источника) и не является общедоступным. Этот сценарий также охватывает серверы базы данных, расположенные на виртуальных машинах.

## <a name="cloud-scenarios"></a>Облачные сценарии

### <a name="securing-data-store-credentials"></a>Защита учетных данных хранилища данных

- **Хранение зашифрованных учетных данных в управляемом хранилище фабрики данных Azure**. Фабрика данных помогает защитить учетные данные хранилища данных, выполняя их шифрование с помощью сертификатов, управляемых корпорацией Майкрософт. Эти сертификаты меняются каждые два года. Изменения включают продление сертификата и перемещение учетных данных. Зашифрованные учетные данные безопасно хранятся в учетной записи хранения Azure, которая контролируется службами управления фабрики данных Azure. Дополнительные сведения о безопасности службы хранилища Azure см. в [этой статье](../security/security-storage-overview.md).
- **Хранение учетных данных в Azure Key Vault**. Учетные данные хранилища также можно хранить в [Azure Key Vault](https://azure.microsoft.com/services/key-vault/). Фабрика данных получает учетные данные во время выполнения действия. Дополнительные сведения см. в статье [Хранение учетных данных в Azure Key Vault](store-credentials-in-key-vault.md).

### <a name="data-encryption-in-transit"></a>Шифрование данных при передаче
Если облачное хранилище данных поддерживает протоколы HTTPS или TLS, то передача всех данных между службами перемещения данных в фабрике данных и облачным хранилищем данных выполняется через эти защищенные каналы.

> [!NOTE]
> Во время передачи данных в базу данных и из нее все подключения к базе данных SQL Azure и хранилищу данных SQL Azure должны быть зашифрованы (с помощью SSL или TLS). Разрабатывая конвейер с помощью JSON, добавьте свойство "encryption" и в строке подключения задайте для него значение **true**. Для службы хранилища Azure вы можете использовать в строке подключения протокол **HTTPS**.

### <a name="data-encryption-at-rest"></a>Шифрование неактивных данных
Некоторые хранилища данных поддерживают шифрование неактивных данных. Мы рекомендуем включить механизм шифрования данных для этих хранилищ данных. 

#### <a name="azure-sql-data-warehouse"></a>Хранилище данных SQL Azure
Прозрачное шифрование данных (TDE) в хранилище данных SQL Azure помогает защититься от вредоносных атак благодаря шифрованию и расшифровке неактивных данных в реальном времени. Этот процесс является прозрачным для клиента. Дополнительные сведения см. в статье [Защита базы данных в хранилище данных SQL](../sql-data-warehouse/sql-data-warehouse-overview-manage-security.md).

#### <a name="azure-sql-database"></a>Базы данных SQL Azure
База данных SQL Azure также поддерживает прозрачное шифрование данных, которое помогает защитить от угрозы вредоносных атак за счет шифрования и расшифровки данных в реальном времени, не внося изменения в само приложение. Этот процесс является прозрачным для клиента. Дополнительные сведения см. в статье [Прозрачное шифрование данных для хранилища данных и базы данных SQL Azure](https://docs.microsoft.com/sql/relational-databases/security/encryption/transparent-data-encryption-azure-sql).

#### <a name="azure-data-lake-store"></a>Хранилище озера данных Azure
В Azure Data Lake Store можно также включить шифрование данных, хранящихся в учетной записи. При включении Data Lake Store автоматически шифрует данные перед сохранением и расшифровывает их до извлечения. Таким образом данные полностью прозрачны для клиента, который получает к ним доступ. Дополнительные сведения см. в статье [Обеспечение безопасности в хранилище озера данных Azure](../data-lake-store/data-lake-store-security-overview.md). 

#### <a name="azure-blob-storage-and-azure-table-storage"></a>Хранилище BLOB-объектов Azure и хранилище таблиц Azure
Хранилище BLOB-объектов Azure и хранилище таблиц Azure поддерживают функцию шифрования службы хранилища, которая автоматически шифрует данные перед их сохранением в хранилище и расшифровывает их до извлечения. Дополнительные сведения см. в статье [Шифрование службы хранилища Azure для неактивных данных (предварительная версия)](../storage/common/storage-service-encryption.md).

#### <a name="amazon-s3"></a>Amazon S3
Amazon S3 поддерживает шифрование неактивных данных для сервера и клиента. Дополнительные сведения см. в документации [Protecting Data Using Encryption](http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingEncryption.html) (Защита данных с помощью шифрования).

#### <a name="amazon-redshift"></a>Amazon Redshift
Amazon Redshift поддерживает шифрование неактивных данных кластера. Дополнительные сведения см. в документации [Amazon Redshift Database Encryption](http://docs.aws.amazon.com/redshift/latest/mgmt/working-with-db-encryption.html) (Шифрование базы данных Amazon Redshift). 

#### <a name="salesforce"></a>Salesforce
Salesforce поддерживает шифрование Shield Platform Encryption, которое позволяет зашифровать все файлы, вложения и настраиваемые поля. Дополнительные сведения см. в статье [Understanding the Web Server OAuth Authentication Flow](https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/intro_understanding_web_server_oauth_flow.htm) (Основные сведения о потоке проверки подлинности OAuth веб-сервера).  

## <a name="hybrid-scenarios"></a>Гибридные сценарии
Для реализации гибридных сценариев необходимо установить локальную среду выполнения интеграции в локальной сети, виртуальной сети (Azure) или виртуальном частном облаке (Amazon). У локальной среды выполнения интеграции должен быть доступ к локальным хранилищам данных. Дополнительные сведения о локальной среде выполнения интеграции см. в статье [Создание и настройка локальной среды выполнения интеграции](https://docs.microsoft.com/azure/data-factory/create-self-hosted-integration-runtime). 

![Каналы локальной среды выполнения интеграции](media/data-movement-security-considerations/data-management-gateway-channels.png)

Канал команд обеспечивает взаимодействие между службами перемещения данных в фабрике данных и локальной среде выполнения интеграции. Этот коммуникационный канал содержит сведения, связанные с действиями. Канал данных используется для передачи данных между локальными хранилищами данных и облачными хранилищами.    

### <a name="on-premises-data-store-credentials"></a>Учетные данные локального хранилища данных
Учетные данные для локальных хранилищ данных всегда шифруются и сохраняются. Они могут храниться локально, на компьютере локальной среды выполнения интеграции или в управляемом хранилище фабрики данных Azure (как учетные данные облачного хранилища). 

- **Хранение учетных данных в локальной среде**. Чтобы зашифровать и сохранить учетные данные в локальной среде выполнения интеграции, выполните инструкции из статьи [Шифрование учетных данных для локальных хранилищ данных в фабрике данных Azure](encrypt-credentials-self-hosted-integration-runtime.md). Этот вариант поддерживают все соединители. Локальная среда выполнения интеграции использует Windows [DPAPI](https://msdn.microsoft.com/library/ms995355.aspx) для шифрования конфиденциальных данных и учетных данных. 

   Используйте командлет **New-AzureRmDataFactoryV2LinkedServiceEncryptedCredential** для шифрования учетных данных связанной службы и конфиденциальных данных в связанной службе. Затем можно использовать возвращаемое значение JSON (с элементом **EncryptedCredential** в строке подключения) для создания связанной службы с помощью командлета **Set-AzureRmDataFactoryV2LinkedService**.  

- **Хранение в управляемом хранилище фабрики данных Azure**. При непосредственном использовании командлета **Set-AzureRmDataFactoryV2LinkedService** со строками подключения и учетными данными, содержащимися в JSON, связанная служба зашифровывается и сохраняется в управляемом хранилище фабрики данных Azure. Конфиденциальная информация по-прежнему шифруется сертификатом, которым управляет корпорация Майкрософт.



#### <a name="ports-used-when-encrypting-linked-service-on-self-hosted-integration-runtime"></a>Порты, используемые для шифрования связанной службы в локальной среде выполнения интеграции
По умолчанию PowerShell использует порт 8050 на компьютере локальной среды выполнения интеграции для обеспечения безопасной связи. При необходимости этот порт можно изменить.  

![HTTPS-порт для шлюза](media/data-movement-security-considerations/https-port-for-gateway.png)

 


### <a name="encryption-in-transit"></a>Шифрование при передаче
Все передачи данных выполняются через защищенный канал HTTPS и TLS через TCP, чтобы предотвратить атаки "злоумышленник в середине" во время взаимодействия со службами Azure.

Вы также можете использовать [VPN-подключение IPSec](../vpn-gateway/vpn-gateway-about-vpn-devices.md) или [Azure ExpressRoute](../expressroute/expressroute-introduction.md), чтобы в дальнейшем обеспечить безопасность коммуникационного канала между локальной сетью и Azure.

Виртуальная сеть Azure— это логическое представление сети в облаке. Вы можете подключить локальную сеть к виртуальной сети, настроив VPN-подключение IPSec "сеть — сеть" или ExpressRoute (частный пиринг).    

В таблице ниже представлены общие рекомендации для настройки локальной среды выполнения интеграции и сети на основе различных комбинаций исходного и целевого расположений для гибридного перемещения данных.

| Источник      | Место назначения                              | Конфигурация сети                    | Настройка среды выполнения интеграции                |
| ----------- | ---------------------------------------- | ---------------------------------------- | ---------------------------------------- |
| Локальная система | Виртуальные машины и облачные службы, развернутые в виртуальных сетях | VPN-подключение IPSec (типа "точка — сеть" или "сеть — сеть") | Вы можете установить локальную среду выполнения интеграции на локальной виртуальной машине или виртуальной машине Azure в виртуальной сети. |
| Локальная система | Виртуальные машины и облачные службы, развернутые в виртуальных сетях | ExpressRoute (частный пиринг)           | Вы можете установить локальную среду выполнения интеграции на локальной виртуальной машине или виртуальной машине Azure в виртуальной сети. |
| Локальная система | Службы на базе Azure, у которых есть общедоступная конечная точка | ExpressRoute (общедоступный пиринг)            | Локальная среда выполнения интеграции должна быть установлена локально. |

На изображениях ниже показано, как использовать локальную среду выполнения интеграции для перемещения данных между локальной базой данных и службами Azure с помощью ExpressRoute и VPN-подключения IPSec (с помощью виртуальной сети Azure).

**ExpressRoute**

![Использование ExpressRoute со шлюзом](media/data-movement-security-considerations/express-route-for-gateway.png) 

**VPN-подключение IPSec**

![VPN-подключение IPSec со шлюзом](media/data-movement-security-considerations/ipsec-vpn-for-gateway.png)

### <a name="firewall-configurations-and-whitelisting-ip-address-of-gateway"></a> Параметры конфигурации брандмауэра и добавление IP-адресов в список разрешенных

#### <a name="firewall-requirements-for-on-premisesprivate-network"></a>Требования к брандмауэру для локальной или частной сети  
На предприятии корпоративный брандмауэр работает на центральном маршрутизаторе организации. Брандмауэр Windows работает как управляющая программа на локальном компьютере, на котором установлена локальная среда выполнения интеграции. 

В таблице ниже представлены исходящий порт и требования к домену для корпоративных брандмауэров.

| Имена доменов                  | Исходящие порты | ОПИСАНИЕ                              |
| ----------------------------- | -------------- | ---------------------------------------- |
| `*.servicebus.windows.net`    | 443            | Требуется локальной среде выполнения интеграции для подключения к службам перемещения данных в фабрике данных. |
| `*.core.windows.net`          | 443            | Используется локальной средой выполнения интеграции для подключения к учетной записи хранения Azure при помощи функции [промежуточного копирования](copy-activity-performance.md#staged-copy). |
| `*.frontend.clouddatahub.net` | 443            | Требуется локальной среде выполнения интеграции для подключения к службе фабрики данных. |
| `*.database.windows.net`      | 1433           | (Необязательно.) Требуется, если выполняется копирование из базы данных SQL Azure или хранилища данных SQL Azure или в них. Используйте функцию промежуточного копирования, чтобы копировать данные в базу данных SQL Azure или хранилище данных SQL Azure без необходимости открывать порт 1433. |
| `*.azuredatalakestore.net`<br>`login.microsoftonline.com/<tenant>/oauth2/token`    | 443            | (Необязательно.) Требуется, если выполняется копирование из репозитория Azure Data Lake Store или в него. |

> [!NOTE] 
> Возможно, вам придется управлять портами или создать утвержденный список доменов на уровне корпоративного брандмауэра в соответствии с определенными источниками данных. В этой таблице в качестве примеров используются база данных SQL Azure, хранилище данных SQL Azure и Azure Data Lake Store.   

В следующей таблице представлены требования к входящему порту для брандмауэра Windows.

| Входящие порты | ОПИСАНИЕ                              |
| ------------- | ---------------------------------------- |
| 8050 (TCP)    | Требуется для командлета шифрования PowerShell, как описано в статье [Шифрование учетных данных для локальных хранилищ данных в фабрике данных Azure](encrypt-credentials-self-hosted-integration-runtime.md), или для приложения диспетчера учетных данных, чтобы обеспечить безопасную настройку учетных данных для локальных хранилищ данных в локальной среде выполнения интеграции. |

![Требования к порту шлюза](media\data-movement-security-considerations/gateway-port-requirements.png) 

#### <a name="ip-configurations-and-whitelisting-in-data-stores"></a>Конфигурации IP и утвержденный список в хранилище данных
Некоторые хранилища данных в облаке также требуют от вас, чтобы IP-адрес компьютера, который получает к ним доступ, был добавлен в список разрешенных. IP-адрес компьютера локальной среды выполнения интеграции должен быть добавлен в список разрешений или корректно настроен в брандмауэре.

Ниже перечислены облачные хранилища данных, которым необходим разрешенный IP-адрес компьютера локальной среды выполнения интеграции. Некоторым из этих хранилищ данных по умолчанию это может не потребоваться. 

- [база данных SQL Azure;](../sql-database/sql-database-firewall-configure.md) 
- [Хранилище данных Azure SQL](../sql-data-warehouse/sql-data-warehouse-get-started-provision.md)
- [Хранилище озера данных Azure](../data-lake-store/data-lake-store-secure-data.md#set-ip-address-range-for-data-access)
- [Azure Cosmos DB](../cosmos-db/firewall-support.md)
- [Amazon Redshift](http://docs.aws.amazon.com/redshift/latest/gsg/rs-gsg-authorize-cluster-access.html) 

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

**Может ли локальная среда выполнения интеграции совместно использоваться разными фабриками данных?**

В настоящее время эта функция не поддерживается. Но мы работаем над этим.

**Каковы требования к портам для работы локальной среды выполнения интеграции?**

Локальная среда выполнения интеграции устанавливает HTTP-подключения для доступа к Интернету. Для установки этих подключений для локальной среды выполнения интеграции должны быть открыты исходящие порты 443 и 80. Откройте входящий порт 8050 только на уровне компьютера (не на уровне корпоративного брандмауэра) для приложения диспетчера учетных данных. Если база данных SQL Azure или хранилище данных SQL Azure используются в качестве исходного или целевого объектов, вам также необходимо открыть порт 1433. Дополнительные сведения см. в разделе [о параметрах конфигурации брандмауэра и утвержденном списке IP-адресов](#firewall-configurations-and-whitelisting-ip-address-of-gateway). 


## <a name="next-steps"></a>Дополнительная информация
Дополнительные сведения о производительности действия копирования для фабрики данных Azure см. в статье [Руководство по настройке производительности действия копирования](copy-activity-performance.md).

 
