---
title: "Как создавать сложные расписания и расширенное повторение с помощью планировщика Azure"
description: "Как создавать сложные расписания и расширенное повторение с помощью планировщика Azure"
services: scheduler
documentationcenter: .NET
author: derek1ee
manager: kevinlam1
editor: 
ms.assetid: 5c124986-9f29-4cbc-ad5a-c667b37fbe5a
ms.service: scheduler
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 08/18/2016
ms.author: deli
ms.openlocfilehash: 20c3e3c1cb85308cad47054c2efa87f61cae0f22
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="how-to-build-complex-schedules-and-advanced-recurrence-with-azure-scheduler"></a>Как создавать сложные расписания и расширенное повторение с помощью планировщика Azure
## <a name="overview"></a>Обзор
Основополагающую роль в любом задании планировщика Azure играет *расписание*. Именно оно определяет время и способ выполнения каждого задания.

Планировщик Azure позволяет настроить для задания различные одноразовые и повторяющиеся расписания. *Одноразовые* расписания запускаются один раз в указанное время — по сути это *повторяющиеся* расписания, которые выполняются только один раз. Повторяющиеся расписания запускаются с указанной периодичностью.

Благодаря этой гибкости планировщик Azure позволяет поддерживать самые разнообразные бизнес-сценарии.

* Периодическая очистка данных, например ежедневное удаление всех твитов старше 3 месяцев.
* Архивация, например ежемесячное создание резервной копии всей истории счетов.
* Запросы внешних данных, например получение нового прогноза погоды для лыжников от NOAA каждые 15 минут.
* Обработка образов, например сжатие всех загруженных за день образов с помощью системы облачных вычислений каждый день в период пиковой нагрузки.

В данной статье будут рассмотрены примеры заданий, которые можно создавать с помощью планировщика Azure. Для каждого расписания приводятся соответствующие данные JSON. Если вы используете [REST API планировщика](https://msdn.microsoft.com/library/mt629143.aspx), применяйте эти данные JSON для [создания заданий в планировщике Azure](https://msdn.microsoft.com/library/mt629145.aspx).

## <a name="supported-scenarios"></a>Поддерживаемые сценарии
Многие примеры в этом разделе иллюстрируют ряд сценариев, поддерживаемых планировщиком Azure. Грубо говоря, в следующих примерах показаны способы создания расписаний для самых разных моделей поведения, включая следующие.

* Однократное выполнение в определенный день и в конкретное время.
* Выполнение и повтор указанное количество раз.
* Незамедлительное выполнение и повтор.
* Выполнение и повтор через каждые *n* минут, часов, дней, недель или месяцев, начиная с указанного времени.
* Выполнение и повтор на еженедельной или ежемесячной основе, но только в указанные даты, дни недели или числа месяца.
* Выполнение и повтор несколько раз за период, например в последнюю пятницу и понедельник каждого месяца или в 05:15 и 17:15 каждого дня.

## <a name="dates-and-datetimes"></a>Значения даты и даты и времени
Даты в заданиях планировщика Azure соответствуют [спецификации ISO-8601](http://en.wikipedia.org/wiki/ISO_8601) и содержат только дату.

Ссылки на даты и время в планировщике заданий Azure соответствуют [спецификации ISO-8601](http://en.wikipedia.org/wiki/ISO_8601) и включают как дату, так и время. Предполагается, что даты и время без обозначения часового пояса указаны по UTC.  

## <a name="how-to-use-json-and-rest-api-for-creating-schedules"></a>Практическое руководство: создание расписаний с помощью JSON и API REST
Чтобы создать простое расписание с помощью [REST API планировщика Azure](https://msdn.microsoft.com/library/mt629143), сначала [зарегистрируйте подписку в поставщике ресурсов](https://msdn.microsoft.com/library/azure/dn790548.aspx) (имя поставщика для планировщика: *Microsoft.Scheduler*), а затем [создайте коллекцию заданий](https://msdn.microsoft.com/library/mt629159.aspx) и, наконец, [создайте задание](https://msdn.microsoft.com/library/mt629145.aspx). Создавая задание, можно задать расписание и периодичность его выполнения, используя данные JSON как в представленном ниже фрагменте кода:

    {
        "startTime": "2012-08-04T00:00Z", // optional
         …
        "recurrence":                     // optional
        {
            "frequency": "week",     // can be "year" "month" "day" "week" "hour" "minute"
            "interval": 1,                // optional, how often to fire (default to 1)
            "schedule":                   // optional (advanced scheduling specifics)
            {
                "weekDays": ["monday", "wednesday", "friday"],
                "hours": [10, 22]                      
            },
            "count": 10,                  // optional (default to recur infinitely)
            "endTime": "2012-11-04",      // optional (default to recur infinitely)
        },
        …
    }

## <a name="overview-job-schema-basics"></a>Общие сведения: основные параметры схемы заданий
В приведенной ниже таблице представлен общий обзор основных элементов, связанных с периодичностью выполнения и расписанием задания.

| **Имя JSON** | **Описание** |
|:--- |:--- |
| ***startTime*** |*startTime* — это дата и время. В простых расписаниях *startTime* определяет первый случай выполнения задания, а в сложных задание начинает выполняться не раньше, чем наступит время *startTime*. |
| ***recurrence*** |Объект *recurrence* определяет правила и периодичность повтора задания. Объект recurrence поддерживает следующие элементы: *frequency, interval, endTime, count* и *schedule*. Если задан объект *recurrence*, требуется также элемент *frequency*; остальные элементы объекта *recurrence* не являются обязательными. |
| ***frequency*** |Строка *frequency* определяет частоту повторного выполнения задания. Частота может быть указана в *минутах, часах, днях, неделях* или *месяцах*. |
| ***interval*** |Элемент *interval* выражается целым положительным числом и обозначает интервал частоты (*frequency*) выполнения соответствующего задания. Например, если *interval* равен 3, а в качестве значения элемента *frequency* выбрана неделя, задание выполняется повторно через каждые 3 недели. Максимальное значение элемента *interval* в планировщике Azure составляет 18 месяцев для ежемесячной частоты, 78 недель для еженедельной частоты и 548 дней для ежедневной частоты. Для часов и минут поддерживается следующий диапазон: 1 <= *interval* <= 1000. |
| ***endTime*** |Строка *endTime* определяет дату и время, после наступления которых задание выполняться не должно. Значение строки *endTime* не может быть в прошлом. Если параметр *endTime* или count не указан, задание выполняется бесконечно. Одно и то же задание не может иметь одновременно параметры *endTime* и *count*. |
| ***count*** |<p>Значение параметра *count* выражается целым положительным числом (больше нуля), которое указывает, сколько раз это задание будет запускаться до того, как оно завершится.</p><p>Параметр *count* определяет, после какого числа повторных выполнений задание будет считаться завершенным. Например, если задание с параметром *count*, значение которого равно 5, начинает выполняться в понедельник, оно будет завершено после выполнения в пятницу. Если начальная дата задания находится в прошлом, за время первого выполнения принимается время создания.</p><p>Если параметр *endTime* или *count* не указан, задание выполняется бесконечно. Одно и то же задание не может иметь одновременно параметры *endTime* и *count*.</p> |
| ***schedule*** |Задание с указанной частотой выполняется по расписанию. Оно определяется объектом *schedule*, который содержит изменения с учетом минут, часов, дней недели, чисел месяца и количества недель. |

## <a name="overview-job-schema-defaults-limits-and-examples"></a>Общие сведения: параметры схемы заданий по умолчанию, ограничения и примеры
Ознакомившись с общими сведениями, рассмотрим эти элементы более подробно.

| **Имя JSON** | **Тип значения** | **Обязательный?** | **Значение по умолчанию** | **Допустимые значения** | **Пример** |
|:--- |:--- |:--- |:--- |:--- |:--- |
| ***startTime*** |Строка |Нет |None |Дата и время по спецификации ISO-8601 |<code>"startTime" : "2013-01-09T09:30:00-08:00"</code> |
| ***recurrence*** |Объект |Нет |None |Объект recurrence |<code>"recurrence" : { "frequency" : "monthly", "interval" : 1 }</code> |
| ***frequency*** |Строка |Да |None |"minute" (минута), "hour" (час), "day" (день), "week" (неделя), "month" (месяц) |<code>"frequency" : "hour"</code> |
| ***interval*** |Number |Нет |1 |От 1 до 1000 |<code>"interval":10</code> |
| ***endTime*** |Строка |Нет |None |Значение даты-времени, представляющее время в будущем |<code>"endTime" : "2013-02-09T09:30:00-08:00"</code> |
| ***count*** |Number |Нет |None |>=1 |<code>"count": 5</code> |
| ***schedule*** |Объект |Нет |None |Объект schedule |<code>"schedule" : { "minute" : [30], "hour" : [8,17] }</code> |

## <a name="deep-dive-starttime"></a>Подробно: *startTime*
В приведенной ниже таблице показано, каким образом параметр *startTime* управляет выполнением задания.

| **Значение startTime** | **Количество повторов** | **Повторение без расписания** | **Повторение с расписанием** |
|:--- |:--- |:--- |:--- |
| **Время начала не указано** |Задание выполняется один раз сразу после запуска |Задание выполняется один раз сразу после запуска. Последующие выполнения производятся, исходя из времени предыдущего выполнения. |<p>Задание выполняется один раз сразу после запуска</p><p>Последующие выполнения производятся по расписанию повторов.</p> |
| **Время начала в прошлом** |Задание выполняется один раз сразу после запуска |<p>Время выполнения задания рассчитывается как время первого выполнения после времени начала.</p><p>Последующие выполнения производятся, исходя из времени предыдущего выполнения.</p><p>См. пример под этой таблицей</p> |<p>Выполнение задания начинается *не раньше* указанного времени начала. Первое выполнение производится по расписанию с учетом времени начала.</p><p>Последующие выполнения производятся по расписанию повторов.</p> |
| **Время начала в будущем или в настоящем** |Задание выполняется один раз в указанное время начала |<p>Задание выполняется один раз в указанное время начала</p><p>Последующие выполнения производятся, исходя из времени предыдущего выполнения.</p> |<p>Выполнение задания начинается *не раньше* указанного времени начала. Первое выполнение производится по расписанию с учетом времени начала.</p><p>Последующие выполнения производятся по расписанию повторов.</p> |

Рассмотрим пример того, что происходит, когда время *startTime* находится в прошлом и параметр *recurrence* установлен, а *schedule* — нет.  Допустим, текущее время — 2015-04-08 13:00, *startTime* — 2015-04-07 14:00, а повтор (*recurrence*) выполняется раз в 2 дня (т. е. параметр *frequency* имеет значение day, а *interval* равен 2). Обратите внимание, что время *startTime* находится в прошлом и наступает раньше текущего времени.

В этих условиях *первое выполнение* задания произойдет 9.04.2015 в 14:00\.. От времени начала ядро планировщика отсчитывает время повторных выполнений.  Выполнения, которые приходятся на прошлое, игнорируются. Ядро берет очередной случай выполнения, который приходится на будущее.  В данном случае *startTime* — это 2015-04-07 14:00, поэтому в следующий раз задание будет выполнено через 2 дня, 2015-04-09 в 14:00.

Обратите внимание, что время первого выполнения будет одинаковым независимо от того, имеет параметр startTime значение "2015-04-05 14:00" или "2015-04-01 14:00". Время последующих выполнений рассчитывается по расписанию — 11.04.2015 в 14:00, затем — 13.04.2015 в 14:00, затем — 15.04.2015 в 14:00 и т. д.

И, наконец, если у задания есть расписание, а часы и (или) минуты в нем не указаны, по умолчанию используются часы и минуты первого случая выполнения данного задания.

## <a name="deep-dive-schedule"></a>Подробный обзор: *schedule*
С одной стороны, параметр *schedule* может *ограничивать* число выполнений задания.  Например, если, согласно параметру *schedule*, задание с ежемесячной частотой должно выполняться в 31-й день месяца, оно будет выполняться только в те месяцы, в которых есть 31<sup>-е</sup> число.

С другой стороны: параметр *schedule* может *увеличивать* число выполнений задания. Например, если, согласно параметру *schedule*, задание с ежемесячной частотой должно выполняться в 1-й и 2-й день месяца, оно будет выполняться 1<sup>-го</sup> и 2-<sup>го</sup> числа каждого месяца, а не один раз в месяц.

Если для параметра schedule задано несколько элементов, они применяются в порядке от большего к меньшему: номер недели, число месяца, день недели, час и минута.

В следующей таблице элементы параметра *schedule* описаны подробно.

| **Имя JSON** | **Описание** | **Допустимые значения** |
|:--- |:--- |:--- |
| **minutes** |Минуты часа, в которые будет выполняться задание. |<ul><li>Целое число</li><li>массив целых чисел</li></ul> |
| **hours** |Часы дня, в которые будет выполняться задание. |<ul><li>Целое число</li><li>массив целых чисел</li></ul> |
| **weekDays** |Дни недели, в которые будет выполняться задание. Указываются только при выборе еженедельной частоты. |<ul><li>Понедельник, вторник, среда, четверг, пятница, суббота, воскресенье</li><li>Массив любого из указанных выше значений (максимальное количество элементов в массиве — 7)</li></ul>*Без учета* регистра |
| **monthlyOccurrences** |Определяет, в какие числа месяца будет выполняться задание. Указываются только при выборе ежемесячной частоты. |<ul><li>Массив объектов monthlyOccurrence:</li></ul> <pre>{ "day": *day*,<br />  "occurrence": *occurrence*<br />}</pre><p> *day* — это день недели, в который будет выполняться задание, например {Sunday} означает каждое воскресенье месяца. Обязательный элемент.</p><p>*occurence* — это появление указанного дня в течение месяца, например {Sunday, -1} означает последнее воскресенье месяца. Необязательный элемент.</p> |
| **monthDays** |День месяца, в который будет выполняться задание. Указываются только при выборе ежемесячной частоты. |<ul><li>Любое значение < = –1 и > = –31</li><li>Любое значение > = 1 и < = 31</li><li>Массив указанных выше значений</li></ul> |

## <a name="examples-recurrence-schedules"></a>Примеры: расписания повторений
Ниже приведены различные примеры расписания повторений с применением объекта schedule и его элементов.

Предполагается, что во всех представленных расписаниях параметр *interval* имеет значение 1\.. Кроме того, в каждом случае следует предполагать частоту, соответствующую параметру *schedule*. Например, использовать ежедневную частоту и параметр monthDays в одном расписании нельзя. Эти ограничения описаны выше.

| **Пример** | **Описание** |
|:--- |:--- |
| <code>{"hours":[5]}</code> |Задание выполняется каждый день в 05:00. Планировщик Azure соотносит каждое значение параметра hours с каждым значением параметра minutes и создает список всех моментов, в которые нужно будет выполнить задание. |
| <code>{"minutes":[15], "hours":[5]}</code> |Задание выполняется каждый день в 05:15. |
| <code>{"minutes":[15], "hours":[5,17]}</code> |Задание выполняется каждый день в 05:15 и 17:15. |
| <code>{"minutes":[15,45], "hours":[5,17]}</code> |Задание выполняется каждый день в 05:15, 05:45, 17:15 и 17:45. |
| <code>{"minutes":[0,15,30,45]}</code> |Задание выполняется каждые 15 минут. |
| <code>{hours":[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]}</code> |Задание выполняется каждый час. Это задание выполняется каждый час. Если указан параметр *startTime*, минуты выполнения задания определяет он, а если нет — время создания. Например, если задание было запущено или создано (в зависимости от того, какой параметр применяется) в 12:25, задание будет выполняться в 00:25, 01:25, 02:25, ..., 23:25. Это расписание работает так же, как если бы параметр *frequency* имел значение hour, параметр *interval* — значение 1, а параметр *schedule* был не задан. Отличие в том, что данное расписание можно также использовать для создания заданий с другими значениями параметров *frequency* и *interval*. Например, если бы параметр *frequency* имел значение month, расписание выполнялось бы раз в месяц, а не каждый день, как в данном случае, когда параметр *frequency* имеет значение day. |
| <code>{minutes:[0]}</code> |Задание выполняется с наступлением каждого часа. Это задание также выполняется каждый час, но ровно в момент его наступления (например, в 00:00, 01:00, 02:00 и т. д.). Оно эквивалентно заданию, в котором параметр frequency имеет значение hour, параметр startTime указан с нулевыми минутами, а расписание не задано (параметр frequency имеет значение day); если же параметр frequency имеет значение week или month, расписание будет выполняться только один раз в неделю или один раз в месяц соответственно. |
| <code>{"minutes":[15]}</code> |Задание выполняется через 15 минут после наступления каждого часа. Задание выполняется каждый час, начиная с 00:15, 01:15, 02:15 и т. д. и заканчивая 22:15 и 23:15. |
| <code>{"hours":[17], "weekDays":["saturday"]}</code> |Задание выполняется в 17:00 каждую субботу. |
| <code>{hours":[17], "weekDays":["monday", "wednesday", "friday"]}</code> |Задание выполняется в 17:00 в каждый понедельник, среду и пятницу. |
| <code>{"minutes":[15,45], "hours":[17], "weekDays":["monday", "wednesday", "friday"]}</code> |Задание выполняется в 17:15 и 17:45 в каждый понедельник, среду и пятницу. |
| <code>{"hours":[5,17], "weekDays":["monday", "wednesday", "friday"]}</code> |Задание выполняется в 05:00 и 17:00 в каждый понедельник, среду и пятницу. |
| <code>{"minutes":[15,45], "hours":[5,17], "weekDays":["monday", "wednesday", "friday"]}</code> |Задание выполняется в 05:15, 05:45, 17:15 и 17:45 в каждый понедельник, среду и пятницу. |
| <code>{"minutes":[0,15,30,45], "weekDays":["monday", "tuesday", "wednesday", "thursday", "friday"]}</code> |Задание выполняется каждые 15 минут в каждый рабочий день. |
| <code>{"minutes":[0,15,30,45], "hours": [9, 10, 11, 12, 13, 14, 15, 16] "weekDays":["monday", "tuesday", "wednesday", "thursday", "friday"]}</code> |Задание выполняется каждые 15 минут в период с 09:00 до 16:45 в каждый рабочий день. |
| <code>{"weekDays":["sunday"]}</code> |Задание выполняется по воскресеньям в указанное время начала. |
| <code>{"weekDays":["tuesday", "thursday"]}</code> |Задание выполняется по вторникам и четвергам в указанное время начала. |
| <code>{"minutes":[0], "hours":[6], "monthDays":[28]}</code> |Задание выполняется в 06:00 28-го числа каждого месяца (при ежемесячной частоте). |
| <code>{"minutes":[0], "hours":[6], "monthDays":[-1]}</code> |Задание выполняется в 06:00 в последний день каждого месяца. Если вы хотите, чтобы задание выполнялось в последний день месяца, используйте -1 вместо значения 28, 29, 30 или 31. |
| <code>{"minutes":[0], "hours":[6], "monthDays":[1,-1]}</code> |Задание выполняется в 06:00 в первый и последний день каждого месяца. |
| <code>{monthDays":[1,-1]}</code> |Задание выполняется в первый и последний день каждого месяца в указанное время начала. |
| <code>{monthDays":[1,14]}</code> |Задание выполняется в первый и 14-й день каждого месяца в указанное время начала. |
| <code>{monthDays":[2]}</code> |Задание выполняется во второй день месяца в указанное время начала. |
| <code>{"minutes":[0], "hours":[5], "monthlyOccurrences":[{"day":"friday", "occurrence":1}]}</code> |Задание выполняется в первую пятницу каждого месяца в 05:00. |
| <code>{"monthlyOccurrences":[{"day":"friday", "occurrence":1}]}</code> |Задание выполняется в первую пятницу каждого месяца в указанное время начала. |
| <code>{"monthlyOccurrences":[{"day":"friday", "occurrence":-3}]}</code> |Задание выполняется в третью пятницу с конца месяца, каждый месяц в указанное время начала. |
| <code>{"minutes":[15], "hours":[5], "monthlyOccurrences":[{"day":"friday", "occurrence":1},{"day":"friday", "occurrence":-1}]}</code> |Задание выполняется первую и последнюю пятницу каждого месяца в 05:15. |
| <code>{"monthlyOccurrences":[{"day":"friday", "occurrence":1},{"day":"friday", "occurrence":-1}]}</code> |Задание выполняется первую и последнюю пятницу каждого месяца в указанное время начала. |
| <code>{"monthlyOccurrences":[{"day":"friday", "occurrence":5}]}</code> |Задание выполняется в пятую пятницу каждый месяц в указанное время начала. Если пятой пятницы в месяце нет, задание не выполняется, поскольку по расписанию оно должно выполняться только по пятым пятницам. Если вы хотите, чтобы задание выполнялось в последнюю пятницу месяца, используйте вместо значения 5 значение -1. |
| <code>{"minutes":[0,15,30,45], "monthlyOccurrences":[{"day":"friday", "occurrence":-1}]}</code> |Задание выполняется каждые 15 минут в последнюю пятницу месяца. |
| <code>{"minutes":[15,45], "hours":[5,17], "monthlyOccurrences":[{"day":"wednesday", "occurrence":3}]}</code> |Задание выполняется в 05:15, 05:45, 17:15 и 17:45 третьей среды каждого месяца. |

## <a name="see-also"></a>См. также
 [Что такое планировщик?](scheduler-intro.md)

 [Основные понятия, терминология и иерархия сущностей планировщика Azure](scheduler-concepts-terms.md)

 [Приступая к работе с планировщиком Azure на портале Azure](scheduler-get-started-portal.md)

 [Планы и выставление счетов в планировщике Azure](scheduler-plans-billing.md)

 [Справочник по API REST планировщика Azure](https://msdn.microsoft.com/library/mt629143)

 [Справочник по командлетам PowerShell планировщика Azure](scheduler-powershell-reference.md)

 [Высокая доступность и надежность планировщика Azure](scheduler-high-availability-reliability.md)

 [Ограничения, значения по умолчанию и коды ошибок планировщика Azure](scheduler-limits-defaults-errors.md)

 [Исходящая аутентификация планировщика Azure](scheduler-outbound-authentication.md)

