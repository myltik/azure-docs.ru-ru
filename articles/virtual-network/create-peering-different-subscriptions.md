---
title: Создание пиринга виртуальных сетей Azure, развернутых с помощью Resource Manager в разных подписках | Документация Майкрософт
description: Узнайте, как создать пиринг между виртуальными сетями, развернутыми с помощью Resource Manager в разных подписках Azure.
services: virtual-network
documentationcenter: ''
author: jimdial
manager: jeconnoc
editor: ''
tags: azure-resource-manager
ms.assetid: ''
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/25/2017
ms.author: jdial;anavin
ms.openlocfilehash: eccfdf519d16595f2bda77675d62bff4bf14b4f8
ms.sourcegitcommit: 5b2ac9e6d8539c11ab0891b686b8afa12441a8f3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
# <a name="create-a-virtual-network-peering---resource-manager-different-subscriptions"></a>Создание пиринга виртуальных сетей, развернутых с помощью Resource Manager в разных подписках 

В этом руководстве вы узнаете, как установить пиринг между виртуальными сетями, развернутыми с помощью Resource Manager. Эти виртуальные сети находятся в разных подписках. Установление пиринга между двумя виртуальными сетями позволяет ресурсам в разных виртуальных сетях взаимодействовать друг с другом с такими же пропускной способностью и задержкой, как если бы эти ресурсы находились в одной виртуальной сети. Узнайте больше о [пиринге виртуальных сетей](virtual-network-peering-overview.md). 

Действия по созданию пиринга виртуальных сетей зависят от того, находятся ли виртуальные сети в одной или разных подписках, и того, какая [модель развертывания Azure](../azure-resource-manager/resource-manager-deployment-model.md?toc=%2fazure%2fvirtual-network%2ftoc.json) использовалась для их создания. Узнайте, как создать пиринг виртуальных сетей в других сценариях, выбрав сценарий в следующей таблице.

|Модель развертывания Azure  | Подписка Azure.  |
|--------- |---------|
|[Обе Resource Manager](tutorial-connect-virtual-networks-portal.md) |Аналогично|
|[Одна виртуальная сеть Resource Manager, одна классическая виртуальная сеть](create-peering-different-deployment-models.md) |Аналогично|
|[Одна виртуальная сеть Resource Manager, одна классическая виртуальная сеть](create-peering-different-deployment-models-subscriptions.md) |Разные|

Невозможно создать пиринг между двумя виртуальными сетями, созданными с помощью классической модели развертывания. Если вам необходимо подключить виртуальные сети, созданные с помощью классической модели развертывания, можно использовать [VPN-шлюз](../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json) Azure. 

Это руководство по созданию пиринга между виртуальными сетями в одном регионе. Пиринг можно создавать между виртуальными сетями в разных [поддерживаемых регионах](virtual-network-manage-peering.md#cross-region). 

Для создания пиринга виртуальных сетей можно использовать [портал Azure](#portal), [интерфейс командной строки](#cli) Azure (CLI), Azure [PowerShell](#powershell) или [шаблон Azure Resource Manager](#template). Выберите любую из представленных выше ссылок на инструменты, чтобы перейти к инструкциям по созданию пиринга виртуальных сетей с помощью выбранного инструмента.

## <a name="portal"></a>Создание пиринга с помощью портала Azure

В этом руководстве используются разные учетные записи для каждой подписки. Если вы используете учетную запись, имеющую разрешения для обеих подписок, то можете использовать эту учетную запись для всех действий. Пропустите выход с портала и назначение разрешений еще одного пользователя для виртуальных сетей.

1. Войдите на [портал Azure](https://portal.azure.com) как *пользователь A*. У учетной записи, используемой для входа, должны быть необходимые разрешения для создания пиринга виртуальных сетей. Список разрешений см. в разделе [Создание, изменение и удаление пиринга в виртуальной сети](virtual-network-manage-peering.md#permissions).
2. Щелкните **Создать ресурс**, выберите **Сеть** и **Виртуальная сеть**.
3. Введите или выберите значения из следующего примера для перечисленных ниже параметров, а затем щелкните **Создать**:
    - **Имя**: *myVnetA*.
    - **Адресное пространство**: *10.0.0.0/16*.
    - **Имя подсети**: *по умолчанию*.
    - **Диапазон адресов подсети**: *10.0.0.0/24*.
    - **Подписка**: выберите подписку A.
    - **Группа ресурсов**: установите флажок **Создать** и введите *myResourceGroupA*.
    - **Расположение**: *Восточная часть США*.
4. В поле **Поиск ресурсов**, находящемся в верхней части портала, введите *myVnetA*. Когда сеть **myVnetA** появится в результатах поиска, выберите ее. 
5. Выберите **Управление доступом (IAM)** в вертикальном списке вариантов слева.
6. В колонке **myVnetA — управление доступом (IAM)** выберите **+ Добавить**.
7. Выберите **Участник сети** в поле **Роль**.
8. В поле **Выбор** выберите *пользователя B* или введите его адрес электронной почты для поиска. Отобразится список пользователей из того же клиента Azure Active Directory, с которым связана виртуальная сеть, с которой вы устанавливаете пиринг. Если вы не можете найти пользователя B, он скорее всего находится не в том же клиенте Active Directory, что пользователь A. Если нужно подключиться к виртуальным сетям в других клиентах Active Directory, их следует соединить с помощью [VPN-шлюза Azure](../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md), а не пиринга виртуальных сетей.
9. Щелкните **Сохранить**.
10. В вертикальном списке вариантов слева в колонке **myVnetA — управление доступом (IAM)** щелкните **Свойства**. Скопируйте **Идентификатор ресурса**, он понадобится нам позже. Идентификатор ресурса имеет следующий вид: /subscriptions/<Subscription Id>/resourceGroups/myResourceGroupA/providers/Microsoft.Network/virtualNetworks/myVnetA.
11. Выйдите с портала как пользователь A, а затем войдите как пользователь B.
12. Выполните шаги 2–3, введя или выбрав следующие значения на шаге 3.

    - **Имя**: *myVnetB*.
    - **Адресное пространство**: *10.1.0.0/16*.
    - **Имя подсети**: *по умолчанию*.
    - **Диапазон адресов подсети:** *10.1.0.0/24*.
    - **Подписка**: выберите подписку B.
    - **Группа ресурсов**: установите флажок **Создать** и введите *myResourceGroupB*.
    - **Расположение**: *Восточная часть США*.

13. В поле **Поиск ресурсов**, находящемся в верхней части портала, введите *myVnetB*. Когда сеть **myVnetB** появится в результатах поиска, выберите ее.
14. В вертикальном списке вариантов слева в колонке **myVnetB** щелкните **Свойства**. Скопируйте **Идентификатор ресурса**, он понадобится нам позже. Идентификатор ресурса имеет следующий вид: /subscriptions/<Susbscription ID>/resourceGroups/myResoureGroupB/providers/Microsoft.ClassicNetwork/virtualNetworks/myVnetB.
15. Выберите **Управление доступом (IAM)** в колонке **myVnetB**, затем выполните шаги 5–10 для myVnetB, указав **пользователя A** на шаге 8.
16. Выйдите с портала как пользователь B, а затем войдите как пользователь A.
17. В поле **Поиск ресурсов**, находящемся в верхней части портала, введите *myVnetA*. Когда сеть **myVnetA** появится в результатах поиска, выберите ее.
18. Выберите **myVnetA**.
19. В разделе **Параметры** выберите **Пиринги**.
20. В колонке **myVnetA — пиринги** выберите **+ Добавить**
21. В колонке **Добавить пиринг** введите или выберите следующие значения, а затем нажмите кнопку **ОК**:
     - **Имя**: *myVnetAToMyVnetB*.
     - **Модель развертывания виртуальной сети**: выберите **Resource Manager**.
     - **Я знаю идентификатор ресурса**: установите этот флажок.
     - **Идентификатор ресурса**: введите идентификатор ресурса, полученный на шаге 14.
     - **Разрешить доступ к виртуальным сетям**: убедитесь, что выбрано значение **Включено**.
    Другие параметры в этом руководстве не используются. Чтобы узнать о всех параметрах пиринга, прочитайте раздел [Создание, изменение и удаление пиринга в виртуальной сети](virtual-network-manage-peering.md#create-a-peering).
22. Созданный пиринг появится вскоре после нажатия кнопки **ОК**, выполненного на предыдущем шаге. В столбце **Состояние пиринга** для созданного пиринга **myVnetAToMyVnetB** указано состояние **Инициировано**. Вы установили пиринг из myVnetA к myVnetB, но теперь необходимо установить пиринг из myVnetB к myVnetA. Пиринг необходимо создать в обоих направлениях, чтобы ресурсы в виртуальных сетях могли взаимодействовать друг с другом.
23. Выйдите с портала как пользователь A, а затем войдите как пользователь B.
24. Выполните шаги 17–21 для myVnetB. На шаге 21 назовите пиринг *myVnetBToMyVnetA*, выберите *myVnetA* в качестве значения параметра **Виртуальная сеть** и введите идентификатор, полученный на шаге 10, в поле **Идентификатор ресурса**.
25. Через несколько секунд после нажатия кнопки **ОК** здесь появится созданный пиринг **myVnetBToMyVnetA**, и в столбце **Состояние пиринга** для него будет указано значение **Подключен**.
26. Выйдите с портала как пользователь B, а затем войдите как пользователь A.
27. Выполните шаги 17–19 еще раз. Теперь в столбце **Состояние пиринга** для пиринга **myVnetAToVNetB** также отображается значение **Подключен**. Пиринг будет успешно установлен, когда значение **Подключен** отобразится в столбце **Состояние пиринга** для обеих виртуальных сетей в пиринге. Теперь все ресурсы Azure, созданные в любой из виртуальных сетей, могут взаимодействовать друг с другом, используя свои IP-адреса. Если вы используете разрешение имен Azure по умолчанию для виртуальных сетей, то ресурсы в этих виртуальных сетях не смогут разрешать имена между виртуальными сетями. Если требуется разрешение имен между виртуальными сетями в пиринге, необходимо создать собственный DNS-сервер. Узнайте, как настроить [разрешение имен с помощью собственного DNS-сервера](virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-that-uses-your-own-dns-server).
28. **Необязательно**. Хотя в этом руководстве не рассматривается создание виртуальных машин, можно создать по виртуальной машине в каждой виртуальной сети и подключить их между собой, чтобы проверить связь.
29. **Необязательно**. Чтобы удалить ресурсы, созданные в этом руководстве, выполните инструкции в разделе [Удаление ресурсов](#delete-portal) этой статьи.

## <a name="cli"></a>Создание пиринга с помощью Azure CLI

В этом руководстве используются разные учетные записи для каждой подписки. Если вы используете учетную запись, имеющую разрешения для обеих подписок, то можете использовать эту учетную запись для всех действий. Пропустите выход из Azure и удалите строки сценария, назначающие роли пользователей. Замените UserA@azure.com и UserB@azure.com во всех следующих сценариях именами пользователей, которые вы используете для пользователей A и B. Обе виртуальные сети для пиринга должны находиться в подписках, которые связаны с одним клиентом Azure Active Directory.  Если нужно подключиться к виртуальным сетям в других клиентах Active Directory, их следует соединить с помощью [VPN-шлюза Azure](../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md), а не пиринга виртуальных сетей.

Выполните следующие скрипты:

- Для его работы требуется Azure CLI 2.0.4 или более поздней версии. Чтобы узнать версию, выполните команду `az --version`. Если вам необходимо выполнить обновление, см. статью [Установка Azure CLI 2.0](/cli/azure/install-azure-cli?toc=%2fazure%2fvirtual-network%2ftoc.json).
- Этот сценарий работает в оболочке Bash. Сведения о параметрах выполнения скриптов Azure CLI в клиенте Windows см. в статье [Использование Azure CLI в Windows](../virtual-machines/windows/cli-options.md?toc=%2fazure%2fvirtual-network%2ftoc.json). 

Вместо установки интерфейса командной строки и его зависимостей вы можете использовать Azure Cloud Shell. Azure Cloud Shell — это бесплатная оболочка Bash, которую можно запускать непосредственно на портале Azure. Она включает предварительно установленный интерфейс Azure CLI и настроена для использования с вашей учетной записью. Нажмите кнопку **Попробовать** в следующем скрипте, чтобы запустить службу Cloud Shell, с помощью которой можно войти в учетную запись Azure. 

1. Запустите сеанс интерфейса командной строки и войдите в Azure как пользователь A с помощью команды `azure login`. У учетной записи, используемой для входа, должны быть необходимые разрешения для создания пиринга виртуальных сетей. Список разрешений см. в разделе [Создание, изменение и удаление пиринга в виртуальной сети](virtual-network-manage-peering.md#permissions).
2. Скопируйте приведенный ниже сценарий в текстовый редактор на своем компьютере и замените `<SubscriptionA-Id>` идентификатором подписки A. Затем скопируйте измененный сценарий, вставьте его в окно сеанса интерфейса командной строки и нажмите клавишу `Enter`. Если вам неизвестен идентификатор подписки, введите команду az account show. Значение **id** (Идентификатор) в выходных данных является идентификатором вашей подписки.

    ```azurecli-interactive
    # Create a resource group.
    az group create \
      --name myResourceGroupA \
      --location eastus

    # Create virtual network A.
    az network vnet create \
      --name myVnetA \
      --resource-group myResourceGroupA \
      --location eastus \
      --address-prefix 10.0.0.0/16

    # Assign UserB permissions to virtual network A.
    az role assignment create \
      --assignee UserB@azure.com \
      --role "Network Contributor" \
      --scope /subscriptions/<SubscriptionA-Id>/resourceGroups/myResourceGroupA/providers/Microsoft.Network/VirtualNetworks/myVnetA
    ```
    
3. Выйдите из Azure как пользователь A, выполнив команду `az logout`, а затем войдите в Azure как пользователь B. У учетной записи, используемой для входа, должны быть необходимые разрешения для создания пиринга виртуальных сетей. Список разрешений см. в разделе [Создание, изменение и удаление пиринга в виртуальной сети](virtual-network-manage-peering.md#permissions).
4. Создайте виртуальную сеть myVnetB. Скопируйте содержимое сценария, приведенного на шаге 2, в текстовый редактор на компьютере. Замените `<SubscriptionA-Id>` идентификатором подписки B. Измените 10.0.0.0/16 на 10.1.0.0/16, измените все A на B, а все B — на A. Скопируйте измененный сценарий, вставьте его в окно сеанса интерфейса командной строки и нажмите клавишу `Enter`. 
5. Выйдите из Azure как пользователь B и войдите качестве пользователя A.
6. Создайте пиринг виртуальных сетей из myVnetA к myVnetB. Скопируйте содержимое следующего сценария в текстовый редактор на своем компьютере. Замените `<SubscriptionB-Id>` идентификатором подписки B. Чтобы выполнить сценарий, скопируйте измененный сценарий, вставьте его в окно сеанса интерфейса командной строки и нажмите клавишу ВВОД.
 
    ```azurecli-interactive
        # Get the id for myVnetA.
        vnetAId=$(az network vnet show \
          --resource-group myResourceGroupA \
          --name myVnetA \
          --query id --out tsv)
    
        # Peer myVNetA to myVNetB.
        az network vnet peering create \
          --name myVnetAToMyVnetB \
          --resource-group myResourceGroupA \
          --vnet-name myVnetA \
          --remote-vnet-id /subscriptions/<SubscriptionB-Id>/resourceGroups/myResourceGroupB/providers/Microsoft.Network/VirtualNetworks/myVnetB \
          --allow-vnet-access
    ```

7. Просмотрите состояние пиринга myVnetA.

    ```azurecli-interactive
    az network vnet peering list \
      --resource-group myResourceGroupA \
      --vnet-name myVnetA \
      --output table
    ```

    Он должен находиться в состоянии **Initiated** (Инициировано). Это состояние изменится на **Connected** (Подключено) после создания пиринга из myVnetA к myVnetB.

8. Выйдите из Azure как пользователь A и войдите качестве пользователя B.
9. Создайте пиринг из myVnetB к myVnetA. Скопируйте содержимое сценария, приведенного на шаге 6, в текстовый редактор на компьютере. Замените `<SubscriptionB-Id>` идентификатором подписки A и измените все A на B, а все B — на A. После внесения этого скопируйте измененный сценарий, вставьте его в окно сеанса интерфейса командной строки и нажмите клавишу `Enter`.
10. Просмотрите состояние пиринга myVnetB. Скопируйте содержимое сценария, приведенного на шаге 7, в текстовый редактор на компьютере. Измените A на B в именах групп ресурсов и виртуальных сетей, затем скопируйте измененный сценарий, вставьте его в окно сеанса интерфейса командной строки и нажмите клавишу `Enter`. Пиринг находится в состоянии **Connected** (Подключено). Состояние пиринга myVnetA изменится на **Connected** (Подключен) после создания пиринга из myVnetB к myVnetA. Можно снова войти в Azure в качестве пользователя A и повторить шаг 7, чтобы проверить состояние пиринга myVnetA. 

    > [!NOTE]
    > Пиринг не будет установлен, пока не будет находится в состоянии **Connected** (Подключен) для обеих виртуальных сетей.

11. **Необязательно**. Хотя в этом руководстве не рассматривается создание виртуальных машин, можно создать по виртуальной машине в каждой виртуальной сети и подключить их между собой, чтобы проверить связь.
12. **Необязательно**. Чтобы удалить ресурсы, созданные в этом руководстве, выполните инструкции, описанные в разделе [Удаление ресурсов](#delete-cli) этой статьи.

Теперь все ресурсы Azure, созданные в любой из виртуальных сетей, могут взаимодействовать друг с другом, используя свои IP-адреса. Если вы используете разрешение имен Azure по умолчанию для виртуальных сетей, то ресурсы в этих виртуальных сетях не смогут разрешать имена между виртуальными сетями. Если требуется разрешение имен между виртуальными сетями в пиринге, необходимо создать собственный DNS-сервер. Узнайте, как настроить [разрешение имен с помощью собственного DNS-сервера](virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-that-uses-your-own-dns-server).
 
## <a name="powershell"></a>Создание пиринга с помощью PowerShell

В этом руководстве используются разные учетные записи для каждой подписки. Если вы используете учетную запись, имеющую разрешения для обеих подписок, то можете использовать эту учетную запись для всех действий. Пропустите выход из Azure и удалите строки сценария, назначающие роли пользователей. Замените UserA@azure.com и UserB@azure.com во всех следующих сценариях именами пользователей, которые вы используете для пользователей A и B. Обе виртуальные сети для пиринга должны находиться в подписках, которые связаны с одним клиентом Azure Active Directory.  Если нужно подключиться к виртуальным сетям в других клиентах Active Directory, их следует соединить с помощью [VPN-шлюза Azure](../vpn-gateway/vpn-gateway-howto-vnet-vnet-cli.md), а не пиринга виртуальных сетей.

1. Установите последнюю версию модуля [AzureRm](https://www.powershellgallery.com/packages/AzureRM/) PowerShell. Если вы еще не работали с Azure PowerShell, ознакомьтесь со статьей [Overview of Azure PowerShell](/powershell/azure/overview?toc=%2fazure%2fvirtual-network%2ftoc.json) (Общие сведения об Azure PowerShell).
2. Запустите сеанс PowerShell.
3. В PowerShell войдите в Azure как пользователь A, введя команду `login-azurermaccount`. У учетной записи, используемой для входа, должны быть необходимые разрешения для создания пиринга виртуальных сетей. Список разрешений см. в разделе [Создание, изменение и удаление пиринга в виртуальной сети](virtual-network-manage-peering.md#permissions).
4. Создайте группу ресурсов и виртуальную сеть myVnetA. Скопируйте приведенный ниже сценарий в текстовый редактор на своем компьютере. Замените `<SubscriptionA-Id>` идентификатором подписки A. Если вам неизвестен идентификатор подписки, введите команду `Get-AzureRmSubscription`, чтобы просмотреть его. Значение **Id** (Идентификатор) в полученных выходных данных является идентификатором вашей подписки. Чтобы выполнить сценарий, скопируйте измененный сценарий, вставьте его в окно сеанса PowerShell и нажмите клавишу `Enter`.

    ```powershell
    # Create a resource group.
    New-AzureRmResourceGroup `
      -Name MyResourceGroupA `
      -Location eastus

    # Create virtual network A.
    $vNetA = New-AzureRmVirtualNetwork `
      -ResourceGroupName MyResourceGroupA `
      -Name 'myVnetA' `
      -AddressPrefix '10.0.0.0/16' `
      -Location eastus

    # Assign UserB permissions to myVnetA.
    New-AzureRmRoleAssignment `
      -SignInName UserB@azure.com `
      -RoleDefinitionName "Network Contributor" `
      -Scope /subscriptions/<SubscriptionA-Id>/resourceGroups/myResourceGroupA/providers/Microsoft.Network/VirtualNetworks/myVnetA
    ```

5. Выйдите из Azure как пользователь A и войдите качестве пользователя B. У учетной записи, используемой для входа, должны быть необходимые разрешения для создания пиринга виртуальных сетей. Список разрешений см. в разделе [Создание, изменение и удаление пиринга в виртуальной сети](virtual-network-manage-peering.md#permissions).
6. Скопируйте содержимое сценария, приведенного на шаге 4, в текстовый редактор на компьютере. Замените `<SubscriptionA-Id>` идентификатором для подписки B. Измените 10.0.0.0/16 на 10.1.0.0/16. Измените все A на B, а все B — на A. Чтобы выполнить сценарий, скопируйте измененный сценарий, вставьте его в окно сеанса PowerShell и нажмите клавишу `Enter`.
7. Выйдите из Azure как пользователь B и войдите в качестве пользователя A.
8. Создайте пиринг из myVnetA к myVnetB. Скопируйте следующий сценарий в текстовый редактор на своем компьютере. Замените `<SubscriptionB-Id>` идентификатором подписки B. Чтобы выполнить сценарий, скопируйте измененный сценарий, вставьте его в окно сеанса PowerShell и нажмите клавишу `Enter`.
 
    ```powershell
    # Peer myVnetA to myVnetB.
    $vNetA=Get-AzureRmVirtualNetwork -Name myVnetA -ResourceGroupName myResourceGroupA
    Add-AzureRmVirtualNetworkPeering `
      -Name 'myVnetAToMyVnetB' `
      -VirtualNetwork $vNetA `
      -RemoteVirtualNetworkId "/subscriptions/<SubscriptionB-Id>/resourceGroups/myResourceGroupB/providers/Microsoft.Network/virtualNetworks/myVnetB"
    ```

9. Просмотрите состояние пиринга myVnetA.

    ```powershell
    Get-AzureRmVirtualNetworkPeering `
      -ResourceGroupName myResourceGroupA `
      -VirtualNetworkName myVnetA `
      | Format-Table VirtualNetworkName, PeeringState
    ```

    Он должен находиться в состоянии **Initiated** (Инициировано). Оно принимает значение **Connected** (Подключено) после настройки пиринга из myVnetB к myVnetA.

10. Выйдите из Azure как пользователь A и войдите качестве пользователя B.
11. Создайте пиринг из myVnetB к myVnetA. Скопируйте содержимое сценария, приведенного на шаге 8, в текстовый редактор на компьютере. Замените `<SubscriptionB-Id>` идентификатором подписки A и измените все A на B, а все B — на A. Чтобы выполнить сценарий, скопируйте измененный сценарий, вставьте его в окно сеанса PowerShell и нажмите клавишу `Enter`.
12. Просмотрите состояние пиринга myVnetB. Скопируйте содержимое сценария, приведенного на шаге 9, в текстовый редактор на компьютере. Измените A на B в именах групп ресурсов и виртуальных сетей. Чтобы выполнить сценарий, вставьте измененный сценарий в окно сеанса PowerShell и нажмите клавишу `Enter`. Отображается состояние **Connected** (Подключено). Состояние пиринга **myVnetA** изменится на **Connected** (Подключен) после создания пиринга из **myVnetB** к **myVnetA**. Можно снова войти в Azure в качестве пользователя A и повторить шаг 9, чтобы проверить состояние пиринга myVnetA. 

    > [!NOTE]
    > Пиринг не будет установлен, пока не будет находится в состоянии **Connected** (Подключен) для обеих виртуальных сетей.

    Теперь все ресурсы Azure, созданные в любой из виртуальных сетей, могут взаимодействовать друг с другом, используя свои IP-адреса. Если вы используете разрешение имен Azure по умолчанию для виртуальных сетей, то ресурсы в этих виртуальных сетях не смогут разрешать имена между виртуальными сетями. Если требуется разрешение имен между виртуальными сетями в пиринге, необходимо создать собственный DNS-сервер. Узнайте, как настроить [разрешение имен с помощью собственного DNS-сервера](virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-that-uses-your-own-dns-server).

13. **Необязательно**. Хотя в этом руководстве не рассматривается создание виртуальных машин, можно создать по виртуальной машине в каждой виртуальной сети и подключить их между собой, чтобы проверить связь.
14. **Необязательно**. Чтобы удалить ресурсы, созданные в этом руководстве, выполните инструкции, описанные в разделе [Удаление ресурсов](#delete-powershell) этой статьи.

## <a name="template"></a>Создание пиринга с помощью шаблона Resource Manager

1. Выполните действия в разделе для [портала](#portal), [Azure CLI](#cli) или [PowerShell](#powershell) этой статьи, чтобы создать виртуальную сеть и назначить соответствующие [разрешения](virtual-network-manage-peering.md#permissions).
2. Сохраните текст после файла на локальном компьютере. Замените `<subscription ID>` идентификатором подписки пользователя A. Файл можно сохранить как vnetpeeringA.json, например.

    ```json
    {
        "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
        "contentVersion": "1.0.0.0",
        "parameters": {
        },
        "variables": {
        },
    "resources": [
            {
            "apiVersion": "2016-06-01",
            "type": "Microsoft.Network/virtualNetworks/virtualNetworkPeerings",
            "name": "myVnetA/myVnetAToMyVnetB",
            "location": "[resourceGroup().location]",
            "properties": {
            "allowVirtualNetworkAccess": true,
            "allowForwardedTraffic": false,
            "allowGatewayTransit": false,
            "useRemoteGateways": false,
                "remoteVirtualNetwork": {
                "id": "/subscriptions/<subscription ID>/resourceGroups/PeeringTest/providers/Microsoft.Network/virtualNetworks/myVnetB"
                }
            }
            }
        ]
    }
    ```

3. Войдите в Azure в качестве пользователя A и разверните шаблон с помощью [портала](../azure-resource-manager/resource-group-template-deploy-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json#deploy-resources-from-custom-template), [PowerShell](../azure-resource-manager/resource-group-template-deploy.md?toc=%2fazure%2fvirtual-network%2ftoc.json#deploy-a-template-from-your-local-machine) или [Azure CLI](../azure-resource-manager/resource-group-template-deploy-cli.md?toc=%2fazure%2fvirtual-network%2ftoc.json#deploy-local-template). Укажите имя файла, в котором вы сохранили текст JSON на шаге 2.
4. Скопируйте пример JSON-файла, полученный на шаге 2, в файл на компьютере и внесите изменения в строки, начинающиеся с:
    - **name**: измените *myVnetA/myVnetAToMyVnetB* на *myVnetB/myVnetBToMyVnetA*.
    - **id**: замените `<subscription ID>` идентификатором подписки пользователя B и измените *myVnetB* на *myVnetA*.
5. Выполните шаг 3, войдя в Azure как пользователь B.
6. **Необязательно**. Хотя в этом руководстве не рассматривается создание виртуальных машин, можно создать по виртуальной машине в каждой виртуальной сети и подключить их между собой, чтобы проверить связь.
7. **Необязательно**. Чтобы удалить ресурсы, созданные в этом руководстве, выполните инструкции в разделе [Удаление ресурсов](#delete) этой статьи. Для этого можно использовать портал Azure, PowerShell или Azure CLI.

## <a name="delete"></a>Удаление ресурсов
По завершении работы с этим руководством может потребоваться удалить созданные в его рамках ресурсы, чтобы за их использование не взималась плата. При удалении группы ресурсов будут также удалены все ресурсы, содержащиеся в ней.

### <a name="delete-portal"></a>Портал Azure

1. Войдите на портал Azure как пользователь A.
2. В поле поиска на портале введите **myResourceGroupA**. В результатах поиска выберите **myResourceGroupA**.
3. Нажмите кнопку **Удалить**.
4. Чтобы подтвердить удаление, введите **myResourceGroupA** в поле **Введите имя группы ресурсов**, а затем выберите **Удалить**.
5. Выйдите с портала как пользователь A, а затем войдите как пользователь B.
6. Выполните шаги 2–4 для группы ресурсов myResourceGroupB.

### <a name="delete-cli"></a>Интерфейс командной строки Azure

1. Войдите в Azure как пользователь A и выполните следующую команду.

    ```azurecli-interactive
    az group delete --name myResourceGroupA --yes
    ```
2. Выйдите из Azure как пользователь A, а затем войдите как пользователь B.
3. Выполните следующую команду.

    ```azurecli-interactive
    az group delete --name myResourceGroupB --yes
    ```

### <a name="delete-powershell"></a>PowerShell

1. Войдите в Azure как пользователь A и выполните следующую команду.

    ```powershell
    Remove-AzureRmResourceGroup -Name myResourceGroupA -force
    ```

2. Выйдите из Azure как пользователь A, а затем войдите как пользователь B.
3. Выполните следующую команду.

    ```powershell
    Remove-AzureRmResourceGroup -Name myResourceGroupB -force
    ```

## <a name="next-steps"></a>Дополнительная информация

- Внимательно ознакомьтесь с важными [ограничениями и особенностями работы пиринга виртуальных сетей](virtual-network-manage-peering.md#requirements-and-constraints), прежде чем создавать пиринг виртуальных сетей для рабочей среды.
- Узнайте о [параметрах пиринга виртуальных сетей](virtual-network-manage-peering.md#create-a-peering).
- Узнайте, как [создать звездообразную топологию сети](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?toc=%2fazure%2fvirtual-network%2ftoc.json#vnet-peering) с помощью пиринга виртуальных сетей.
