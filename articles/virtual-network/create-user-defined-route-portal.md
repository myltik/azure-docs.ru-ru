---
title: Создание определяемого пользователем маршрута для направления сетевого трафика через виртуальный сетевой модуль с помощью портала Azure | Документация Майкрософт
description: Узнайте, как создать определяемый пользователем маршрут, чтобы переопределить маршрутизацию по умолчанию Azure, направляя трафик через сетевой виртуальный модуль (NVA).
services: virtual-network
documentationcenter: na
author: jimdial
manager: jeconnoc
editor: ''
tags: azure-resource-manager
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/16/2017
ms.author: jdial
ms.openlocfilehash: 0319029277091611673f15c94604604850cbfcbe
ms.sourcegitcommit: 0b02e180f02ca3acbfb2f91ca3e36989df0f2d9c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2018
ms.locfileid: "29766249"
---
# <a name="create-a-user-defined-route---azure-portal"></a>Создание определяемого пользователем маршрута с помощью портала Azure

В этом руководстве описывается, как создать определяемые пользователем маршруты для маршрутизации трафика между двумя подсетями [виртуальной сети](virtual-networks-overview.md) через сетевой виртуальный модуль. Сетевой виртуальный модуль — это виртуальная машина, на которой выполняется сетевое приложение, например брандмауэр. Дополнительные сведения о предварительно настроенных сетевых виртуальных модулях, которые можно развернуть в виртуальной сет Azure, см. на странице [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/category/networking?page=1&subcategories=appliances).

При создании подсетей в виртуальной сети платформа Azure создает [системные маршруты](virtual-networks-udr-overview.md#system-routes) по умолчанию, которые обеспечивают связь между ресурсами во всех подсетях, как показано на следующем рисунке.

![Маршруты по умолчанию](./media/create-user-defined-route/default-routes.png)

В этом руководстве создается виртуальная сеть с общедоступной и частной подсетями (Public и Private), а также подсетью периметра (DMZ), как показано на рисунке ниже. Обычно веб-серверы развертываются в общедоступной подсети, а сервер приложений или сервер базы данных — в частной подсети. Вы можете создать виртуальную машину в качестве виртуального модуля в подсети периметра и, при необходимости, создать в каждой подсети виртуальную машину, которая обменивается данными и через сетевой виртуальный модуль. Весь трафик между общедоступной и частной подсетями направляется через модуль, как показано на следующем рисунке.

![Определяемые пользователем маршруты](./media/create-user-defined-route/user-defined-routes.png)

Эта статья содержит инструкции по созданию определяемого пользователем маршрута на основе модели развертывания с помощью Resource Manager. Мы рекомендуем использовать эту модель при создании определяемых пользователем маршрутов. Если требуется создать классический определяемый пользователем маршрут, прочитайте раздел [Управление маршрутизацией и использование виртуальных модулей (классический режим) с помощью интерфейса командной строки Azure](virtual-network-create-udr-classic-ps.md). Если вы не знакомы с моделями развертывания Azure, см. статью [Развертывание с помощью Azure Resource Manager и классическое развертывание: сведения о моделях развертывания и состоянии ресурсов](../azure-resource-manager/resource-manager-deployment-model.md?toc=%2fazure%2fvirtual-network%2ftoc.json). Дополнительные сведения об определяемых пользователем маршрутах см. в статье [Определяемые пользователем маршруты и IP-пересылка](virtual-networks-udr-overview.md#user-defined).

## <a name="create-routes-and-network-virtual-appliance"></a>Создание маршрутов и сетевого виртуального модуля

1. **Необходимы компоненты**. Создайте виртуальную сеть с двумя подсетями, выполнив действия, описанные в разделе [Создание определяемых пользователем маршрутов с помощью Azure CLI 2.0](#create-a-virtual-network).
2. Создав виртуальную сеть, в веб-браузере перейдите на [портал Azure](https://portal.azure.com). Войдите с использованием [учетной записи Azure](../azure-glossary-cloud-terminology.md?toc=%2fazure%2fvirtual-network%2ftoc.json#account).
3. В поле **Поиск ресурсов** в верхней части портала введите *myResourceGroup*. Когда группа ресурсов **myResourceGroup** появится в результатах поиска, щелкните ее. Эта группа ресурсов была создана при выполнении предварительных условий.
4. Щелкните **myVnet**, как показано на следующем рисунке.

    ![Параметры сетевого интерфейса](./media/create-user-defined-route/virtual-network.png)

5. Создайте подсеть для сетевого виртуального модуля.
 
    - В разделе подсети **myVnet** щелкните **Подсети** в области **Параметры** слева.
    - Щелкните **+ Subnet** (+Подсеть), как показано на следующем рисунке.

        ![Подсети](./media/create-user-defined-route/subnets.png) 
    - Введите указанные ниже значения в разделе **Добавление подсети**, затем нажмите кнопку **ОК**.

        |Параметр|Значение|
        |-----|-----|
        |ИМЯ|DMZ|
        |Диапазон адресов (блок CIDR)|10.0.2.0/24|

6. Создайте виртуальную машину сетевого виртуального устройства.

    - В левой части портала щелкните **+ Создать**, затем щелкните **Вычисления**, а затем выберите **Windows Server 2016 Datacenter** или **Ubuntu Server 16.04 LTS**.
    - В открывшейся колонке **Основное** введите приведенные ниже значения и нажмите кнопку **ОК**.

        |Параметр|Значение|
        |---|---|
        |ИМЯ|myVm-Nva|
        |Имя пользователя|azureuser|
        |"Пароль" и "Подтверждение пароля"|Выбранный пароль.|
        |Подписка|Выберите свою подписку.|
        |Группа ресурсов|Щелкните **Использовать существующую**, а затем выберите **myResourceGroup**.|
        |Расположение|Восток США|
    - В открывшейся колонке **Выбор размера** щелкните **DS1_V2 Standard**, а затем нажмите кнопку **Выбрать**.
    - В отобразившейся колонке **Параметры** щелкните **Виртуальная сеть**. Щелкните **myVnet** в отобразившейся колонке **Выбор виртуальной сети**.
    - В колонке **Параметры** выберите **Подсеть**. Щелкните **myVnet** в отобразившейся колонке **Выбор подсети**. 
    - Оставьте значения по умолчанию для остальных параметров и нажмите кнопку **ОК**.
    - Щелкните **Создать** в отобразившейся колонке **Создание**. Развертывание виртуальной машины занимает несколько минут.

    > [!NOTE]
    > Помимо создания виртуальной машины портал Azure создает общедоступный IP-адрес и по умолчанию назначает его виртуальной машине. При развертывании виртуальной машины в рабочей среде вы можете не присваивать ей общедоступный IP-адрес. Вместо этого можно использовать доступ к сетевому виртуальному модулю машины с других виртуальных машин в виртуальной сети. Чтобы узнать больше об общедоступных IP-адресах, прочитайте статью [Создание, изменение и удаление общедоступного IP-адреса](virtual-network-public-ip-address.md).

7. Назначьте статический частный IP-адрес и включите IP-пересылку для сетевого интерфейса, созданного порталом на предыдущем шаге. 
    - В поле **Поиск ресурсов**, находящемся в верхней части страницы, введите *myVm-Nva*.
    - Когда сеть **myVm-Nva** появится в результатах поиска, щелкните ее.
    - Щелкните **Сети** в разделе **Параметры** с левой стороны.
    - Щелкните имя сетевого интерфейса в разделе **myVm-Nva — сетевые интерфейсы**. Его имя — **myvm-nva***X*, где *X* — номер, присвоенный порталом.
    - В разделе **Параметры** выбранного сетевого интерфейса щелкните  **	Конфигурации IP**.

        ![Параметры сетевого интерфейса](./media/create-user-defined-route/network-interface-settings.png)
        
    - Щелкните **Включено** для параметра **IP-пересылка**, затем нажмите кнопку **Сохранить**. Необходимо включить IP-пересылку для каждого сетевого интерфейса, получающего трафик, направленный на IP-адрес, отличающийся от адреса назначения этого трафика. Включение IP-пересылки отключает проверку источника и назначения трафика для сетевого интерфейса, осуществляемую Azure.
    - Щелкните **ipconfig1** в списке конфигураций IP.
    - Щелкните **Статический** для параметра **Назначение** частного IP-адреса в разделе **ipconfig1**, как показано на следующем рисунке.

        ![IP-конфигурация](./media/create-user-defined-route/ip-configuration.png)
    - Как показано на предыдущем рисунке, введите *10.0.2.4* в поле **IP-адрес** в разделе **Параметры частного IP-адреса**. Назначение статического IP-адреса сетевому интерфейсу гарантирует, что его адрес не изменится в течение жизненного цикла виртуальной машины, к которой подключен этот сетевой интерфейс. Введенный адрес в данный момент не назначен какому-либо другому ресурсу в подсети периметра, в которой находится сетевой интерфейс. 
    - Чтобы сохранить конфигурацию, нажмите кнопку **Сохранить** в разделе **ipconfig1**. Не закрывайте окно "ipconfig1", пока не получите уведомление на портале о том, что сетевой интерфейс сохранен.
 
8. Создайте две таблицы маршрутов. Таблицы маршрутов могут содержать несколько маршрутов или не содержать их вовсе.

    - В левой части портала щелкните **+Создать** > **Сети** > **Таблица маршрутов**.
    - В окне **Create a route table** (Создание таблицы маршрутов) введите приведенные ниже значения, а затем щелкните **Создать**.

        |Параметр|Значение|
        |---|---|
        |ИМЯ|myRouteTable-Public|
        |Подписка|Выберите свою подписку.|
        |Группа ресурсов|Щелкните **Использовать существующую**, а затем выберите **myResourceGroup**.|
        |Расположение|Восток США|
    
    - Снова выполните подпункты шага 8, но укажите имя таблицы маршрутов *myRouteTable-Private*.
9. Добавьте маршруты в таблицу маршрутов *myRouteTable-Public* и свяжите ее с *общедоступной* подсетью.

    - В поле **Поиск ресурсов** в верхней части портала введите *myRouteTable-Public*. Когда таблица маршрутов **myRouteTable-Public** появится в результатах поиска, щелкните ее.
    - В разделе **myRouteTable-Public** в списке **Параметры** щелкните **Маршруты**.
    - Щелкните **+Добавить** в разделе **myRouteTable-Public — маршруты**.
    -  По умолчанию Azure маршрутизирует трафик между всеми подсетями в виртуальной сети. Создайте маршрут, чтобы изменить маршрутизацию по умолчанию Azure и направить трафик из *общедоступной* подсети через NVA, а не напрямую в *частную* подсеть. В открывшейся колонке **Добавление маршрута** введите приведенные ниже значения и нажмите кнопку **ОК**.

        |Параметр|Значение|Пояснение|
        |---|---|---|
        |Имя маршрута|ToPrivateSubnet|Этот маршрут направляет трафик в частную подсеть через сетевой виртуальный модуль.|
        |Префикс адреса|10.0.1.0/24| Любой трафик, отправленный на любые адреса с этим префиксом (10.0.1.0–10.0.1.254), отправляется в сетевой виртуальный модуль.|
        |Тип следующего прыжка| Выберите **Виртуальный модуль**.||
        |Адрес следующего прыжка|10.0.2.4| Статический частный IP-адрес сетевого интерфейса, подключенного к сетевому виртуальному модулю. Единственный тип прыжка, для которого можно указать адрес, это **виртуальный модуль**.|

    - В разделе **myRouteTable-Public** щелкните **Подсети** в обалсти **Параметры**. 
    - Нажмите кнопку **+ Associate** (+Связать) в разделе **myRouteTable-Public — подсети**.
    - Щелкните **Виртуальная сеть** в разделе **Связать подсеть**, затем щелкните **myVnet**.
    - Щелкните **Подсеть** в разделе **Связать подсеть**, затем щелкните **Общедоступный** в разделе **Выбрать подсеть**. 
    - Чтобы сохранить конфигурацию, нажмите кнопку **ОК** в разделе **Связать подсеть**. Подсеть может иметь не более одной таблицы маршрутов, связанной с ней.
10. Выполните шаг 9 еще раз. Найдите таблицу маршрутов **myRouteTable-Private**, создайте маршрут со приведенными ниже параметрами, а затем свяжите таблицу маршрутов с **частной** подсетью виртуальной сети **myVnet**.

    |Параметр|Значение|Пояснение|
    |---|---|---|
    |Имя маршрута|ToPublicSubnet|Этот маршрут направляет трафик в общедоступную подсеть через сетевой виртуальный модуль.|
    |Префикс адреса|10.0.0.0/24| Любой трафик, отправленный на любые адреса с этим префиксом (10.0.0.0–10.0.1.254), отправляется в сетевой виртуальный модуль.|
    |Тип следующего прыжка| Выберите **Виртуальный модуль**.||
    |Адрес следующего прыжка|10.0.2.4||

    Сетевой трафик между любыми ресурсами в частной и общедоступной подсетях проходит через сетевой виртуальный модуль. 
11. **Необязательно**. Создайте виртуальную машину в общедоступной и частной подсетях и проверьте, передается ли трафик между виртуальными машинами через сетевой виртуальный модуль, выполнив действия, описанные в разделе [Проверка маршрутизации](#validate-routing). 
12. **Необязательно.** Удалите ресурсы, созданные в этом руководстве, с помощью шагов, описанных в разделе [Удаление ресурсов](#delete-resources).

## <a name="validate-routing"></a>Проверка маршрутизации

1. Если это еще не сделано, выполните действия, описанные в разделе [Создание маршрутов и сетевого виртуального модуля](#create-routes-and-network-virtual-appliance).
2. Нажмите кнопку **Попробовать** в поле внизу. Откроется Azure Cloud Shell. При появлении запроса войдите в Azure со своей [учетной записью Azure](../azure-glossary-cloud-terminology.md?toc=%2fazure%2fvirtual-network%2ftoc.json#account). Если у вас нет учетной записи Azure, вы можете зарегистрироваться и получить [бесплатную пробную версию](https://azure.microsoft.com/offers/ms-azr-0044p). Azure Cloud Shell — это бесплатная оболочка Bash с предварительно установленным интерфейсом командной строки Azure. 

    Приведенные ниже сценарии создают две виртуальные машины, одну в *общедоступной* подсети и одну — в *частной* подсети. Эти сценарии также включают IP-пересылку для сетевого интерфейса в операционной системе NVA, чтобы операционная система могла маршрутизировать трафик через этот сетевой интерфейс. NVA в рабочей среде обычно проверяет трафик перед отправкой, но в этом руководстве простой модуль NVA только направляет трафик, не проверяя его. 

    Нажмите кнопку **Копировать** в сценариях для **Linux** или **Windows**, приведенных ниже, и вставьте их содержимое в текстовый редактор. Измените пароль в переменной *adminPassword*, а затем вставьте сценарий в Azure Cloud Shell. Выполните сценарий для операционной системы, выбранной при создании сетевого виртуального модуля на шаге 6 процедуры [Создание маршрутов и сетевого виртуального модуля](#create-routes-and-network-virtual-appliance). 

    **Linux**

    ```azurecli-interactive
    #!/bin/bash

    #Set variables used in the script.
    rgName="myResourceGroup"
    location="eastus"
    adminPassword=ChangeToYourPassword
    
    # Create a virtual machine in the Public subnet.
    az vm create \
      --resource-group $rgName \
      --name myVm-Public \
      --image UbuntuLTS \
      --vnet-name myVnet \
      --subnet Public \
      --public-ip-address myPublicIp-Public \
      --admin-username azureuser \
      --admin-password $adminPassword

    # Create a virtual machine in the Private subnet.
    az vm create \
      --resource-group $rgName \
      --name myVm-Private \
      --image UbuntuLTS \
      --vnet-name myVnet \
      --subnet Private \
      --public-ip-address myPublicIp-Private \
      --admin-username azureuser \
      --admin-password $adminPassword

    # Enable IP forwarding for the network interface in the NVA virtual machine's operating system.    
    az vm extension set \
      --resource-group $rgName \
      --vm-name myVm-Nva \
      --name customScript \
      --publisher Microsoft.Azure.Extensions \
      --settings '{"commandToExecute":"sudo sysctl -w net.ipv4.ip_forward=1"}'
    ```

    **Windows**

    ```azurecli-interactive

    #!/bin/bash
    #Set variables used in the script.
    rgName="myResourceGroup"
    location="eastus"
    adminPassword=ChangeToYourPassword
    
    # Create a virtual machine in the Public subnet.
    az vm create \
      --resource-group $rgName \
      --name myVm-Public \
      --image win2016datacenter \
      --vnet-name myVnet \
      --subnet Public \
      --public-ip-address myPublicIp-Public \
      --admin-username azureuser \
      --admin-password $adminPassword

    # Allow pings through the Windows Firewall.
    az vm extension set \
      --publisher Microsoft.Compute \
      --version 1.9 \
      --name CustomScriptExtension \
      --vm-name myVm-Public \
      --resource-group $rgName \
      --settings '{"commandToExecute":"netsh advfirewall firewall add rule name=Allow-ping protocol=icmpv4 dir=in action=allow"}'

    # Create a virtual machine in the Private subnet.
    az vm create \
      --resource-group $rgName \
      --name myVm-Private \
      --image win2016datacenter \
      --vnet-name myVnet \
      --subnet Private \
      --public-ip-address myPublicIp-Private \
      --admin-username azureuser \
      --admin-password $adminPassword

    # Allow pings through the Windows Firewall.
    az vm extension set \
      --publisher Microsoft.Compute \
      --version 1.9 \
      --name CustomScriptExtension \
      --vm-name myVm-Private \
      --resource-group $rgName \
      --settings '{"commandToExecute":"netsh advfirewall firewall add rule name=Allow-ping protocol=icmpv4 dir=in action=allow"}'

    # Enable IP forwarding for the network interface in the NVA virtual machine's operating system.
    az vm extension set \
      --publisher Microsoft.Compute \
      --version 1.9 \
      --name CustomScriptExtension \
      --vm-name myVm-Nva \
      --resource-group $rgName \
      --settings '{"commandToExecute":"powershell.exe Set-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters -Name IpEnableRouter -Value 1"}'

    # Restart the NVA virtual machine.
    az vm extension set \
      --publisher Microsoft.Compute \
      --version 1.9 \
      --name CustomScriptExtension \
      --vm-name myVm-Nva \
      --resource-group $rgName \
      --settings '{"commandToExecute":"powershell.exe Restart-Computer -ComputerName myVm-Nva -Force"}'
    ```

3. Проверьте связь между виртуальными машинами в общедоступной и частной подсетях. 

    - Откройте [SSH](../virtual-machines/linux/tutorial-manage-vm.md?toc=%2fazure%2fvirtual-network%2ftoc.json#connect-to-vm)-подключение (Linux) или подключение [удаленного рабочего стола](../virtual-machines/windows/tutorial-manage-vm.md?toc=%2fazure%2fvirtual-network%2ftoc.json#connect-to-vm) (Windows) по общедоступному IP-адресу виртуальной машины *myVm-Public*.
    - В командной строки на виртуальной машине *myVm-Public* введите `ping myVm-Private`. Вы получите ответы, так как NVA направляет трафик из общедоступной подсети в частную подсеть.
    - На виртуальной машине*myVm-Public* выполните команду trace route между виртуальными машинами в общедоступной и частной подсетях. Введите соответствующую команду, приведенную ниже, в зависимости от того, какая операционная система установлена на виртуальных машинах в общедоступной и частной подсетях.
        - **Windows**. В командной строке выполните команду `tracert myvm-private`.
        - **Ubuntu**. Выполните команду `tracepath myvm-private`.
      Трафик проходит через IP-адрес 10.0.2.4 (NVA), прежде чем достигает IP-адреса 10.0.1.4 (виртуальная машина в частной подсети). 
    - Выполните предыдущие шаги, подключившись к виртуальной машине *myVm-Private* и проверив связь с виртуальной машиной *myVm-Public*. Команда trace route показывает, что трафик проходит через IP-адрес 10.0.2.4 (NVA), прежде чем достигает IP-адреса 10.0.0.4 (виртуальная машина в общедоступной подсети).

      > [!NOTE]
      > Приведенные выше действия позволяют проверить маршрутизацию между частными IP-адресами Azure. Если вы хотите пересылать трафик или передавать его через прокси-сервер на общедоступные IP-адреса с помощью сетевого виртуального модуля, сделайте вот что:
      > - Убедитесь, что модуль преобразовывает сетевые адреса или имеет функциональные возможности прокси-сервера. В случае с преобразованием сетевых адресов модуль должен преобразовывать исходный IP-адрес в свой собственный, а затем пересылать запрос на общедоступный IP-адрес. Azure преобразовывает частный IP-адрес сетевого виртуального модуля в общедоступный IP-адрес в любом случае: и при преобразовании модулем исходных сетевых адресов, и при работе модуля в роли прокси-сервера. Дополнительные сведения о том, как Azure преобразовывает частные IP-адреса в общедоступные, см. в статье [Общие сведения об исходящих подключениях в Azure](../load-balancer/load-balancer-outbound-connections.md?toc=%2fazure%2fvirtual-network%2ftoc.json).
      > - Добавьте в таблицу маршрутов дополнительный маршрут, например префикс 0.0.0.0/0, тип следующего прыжка VirtualAppliance и IP-адрес для следующего прыжка 10.0.2.4 (см. пример сценария выше).
      >
    - **Необязательно**. Чтобы проверить следующий прыжок между двумя виртуальными машинами в Azure, используйте функцию следующего прыжка службы "Наблюдатель за сетями Azure". Прежде чем использовать службу "Наблюдатель за сетями", необходимо [создать экземпляр службы "Наблюдатель за сетями Azure"](../network-watcher/network-watcher-create.md?toc=%2fazure%2fvirtual-network%2ftoc.json) для региона, в котором вы хотите его использовать. В этом руководстве используется регион "Восточная часть США". Включив экземпляр службы "Наблюдатель за сетями" в регионе, введите следующую команду, чтобы просмотреть сведения о следующем прыжке между виртуальными машинами в общедоступной и частной подсетях.
     
        ```azurecli-interactive
        az network watcher show-next-hop --resource-group myResourceGroup --vm myVm-Public --source-ip 10.0.0.4 --dest-ip 10.0.1.4
        ```

       В выходных данных возвращается параметр **nextHopIpAddress** со значением *10.0.2.4* и параметр **nextHopType** со значением *VirtualAppliance*. 

> [!NOTE]
> Чтобы продемонстрировать основные понятия в этом руководстве, виртуальным машинам в общедоступной и частной подсетях назначаются общедоступные IP-адреса и для обеих виртуальных машин разрешен полный доступ к сетевым портам в Azure. При создании виртуальных машин для использования в рабочей среде не следует назначать им общедоступные IP-адреса. Следует фильтровать сетевой трафик для частной подсети, развернув сетевой виртуальный модуль перед ней или назначив группу безопасности сети для подсетей, сетевого интерфейса или для подсетей и сетевого интерфейса. Дополнительные сведения о группах безопасности сети см. в статье [Фильтрация сетевого трафика с помощью групп безопасности сети](virtual-networks-nsg.md).

## <a name="create-a-virtual-network"></a>Создать виртуальную сеть

Для выполнения инструкций этого руководства требуется виртуальная сеть с двумя подсетями. Нажмите кнопку **Попробовать** кнопку в поле ниже, чтобы быстро создать виртуальную сеть. Кнопка **Попробовать** открывает [Azure Cloud Shell](../cloud-shell/overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json). Хотя в Cloud Shell выполняется оболочка PowerShell или Bash, в этом разделе для создания виртуальной сети используется оболочка Bash. В оболочке Bash установлен интерфейс командной строки Azure. При появлении запроса Cloud Shell войдите в Azure со своей [учетной записью Azure](../azure-glossary-cloud-terminology.md?toc=%2fazure%2fvirtual-network%2ftoc.json#account). Если у вас нет учетной записи Azure, вы можете зарегистрироваться и получить [бесплатную пробную версию](https://azure.microsoft.com/offers/ms-azr-0044p). Чтобы создать виртуальную сеть, используемую в этом руководстве, нажмите кнопку **Копировать** в поле ниже, а затем вставьте сценарий в Azure Cloud Shell.

```azurecli-interactive
#!/bin/bash

#Set variables used in the script.
rgName="myResourceGroup"
location="eastus"

# Create a resource group.
az group create \
  --name $rgName \
  --location $location

# Create a virtual network with one subnet named Public.
az network vnet create \
  --name myVnet \
  --resource-group $rgName \
  --address-prefixes 10.0.0.0/16 \
  --subnet-name Public \
  --subnet-prefix 10.0.0.0/24

# Create an additional subnet named Private in the virtual network.
az network vnet subnet create \
  --name Private \
  --address-prefix 10.0.1.0/24 \
  --vnet-name myVnet \
  --resource-group $rgName
```

Чтобы узнать больше о создании виртуальной сети с помощью портала, PowerShell или шаблона Azure Resource Manager, прочитайте раздел [Создание виртуальной сети с несколькими подсетями](virtual-networks-create-vnet-arm-pportal.md).

## <a name="delete-resources"></a>Удаление ресурсов.

По завершении работы с этим руководством может потребоваться удалить созданные ресурсы, чтобы за их использование не взималась плата: При удалении группы ресурсов будут также удалены все ресурсы, содержащиеся в ней. Открыв портал, сделайте следующее.

1. В поле поиска на портале введите **myResourceGroup**. В результатах поиска щелкните **myResourceGroup**.
2. В колонке **myResourceGroup** щелкните значок **Удалить**.
3. Чтобы подтвердить удаление, введите **myResourceGroup** в поле **Введите имя группы ресурсов**, а затем щелкните **Удалить**.

## <a name="next-steps"></a>Дополнительная информация

- Создайте [высокодоступный сетевой виртуальный модуль](/azure/architecture/reference-architectures/dmz/nva-ha?toc=%2fazure%2fvirtual-network%2ftoc.json).
- Сетевые виртуальные модули часто содержат несколько сетевых интерфейсов и используют несколько IP-адресов. Узнайте, как [добавить сетевые интерфейсы в существующую виртуальную машину](virtual-network-network-interface-vm.md#vm-add-nic) и как [добавить IP-адреса в существующий сетевой интерфейс](virtual-network-network-interface-addresses.md#add-ip-addresses). Виртуальные машины любых размеров могут содержать по крайней мере два сетевых интерфейса. Каждый размер виртуальной машины поддерживает определенное максимальное количество сетевых интерфейсов. Чтобы узнать, какое количество сетевых интерфейсов поддерживает каждый размер виртуальной машины, ознакомьтесь с размерами виртуальных машин [Windows](../virtual-machines/windows/sizes.md?toc=%2Fazure%2Fvirtual-network%2Ftoc.json) и [Linux](../virtual-machines/linux/sizes.md?toc=%2fazure%2fvirtual-network%2ftoc.json). 
- Создайте определяемый пользователем маршрут, чтобы принудительно направить трафик локально через [VPN-подключение типа "сеть — сеть"](../vpn-gateway/vpn-gateway-forced-tunneling-rm.md?toc=%2fazure%2fvirtual-network%2ftoc.json).
