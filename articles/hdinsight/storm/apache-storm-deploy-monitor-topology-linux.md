---
title: Развертывание топологий Apache Storm в HDInsight на основе Linux и управление ими | Документация Майкрософт
description: Узнайте, как развертывать и отслеживать топологии Apache Storm, а также управлять ими с помощью панели мониторинга Storm в HDInsight на основе Linux. Использование инструментов Hadoop для Visual Studio.
services: hdinsight
documentationcenter: ''
author: Blackmist
manager: jhubbard
editor: cgronlun
ms.assetid: 35086e62-d6d8-4ccf-8cae-00073464a1e1
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: conceptual
ms.date: 02/22/2018
ms.author: larryfr
ms.openlocfilehash: 9dd63e1f3ec381dd99495ebc6193198611c76c88
ms.sourcegitcommit: 9cdd83256b82e664bd36991d78f87ea1e56827cd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
ms.locfileid: "31417042"
---
# <a name="deploy-and-manage-apache-storm-topologies-on-hdinsight"></a>Развертывание топологий Apache Storm в HDInsight и управление ими

С помощью этого документа вы ознакомитесь с основами управления и мониторинга топологий Storm, работающих в Storm в кластерах HDInsight.

> [!IMPORTANT]
> Для выполнения действий, описанных в этой статье, вам потребуется Storm под управлением Linux в кластере HDInsight. Linux — это единственная операционная система, используемая для работы с HDInsight 3.4 или более поздних версий. Дополнительные сведения см. в разделе [Приближается дата прекращения сопровождения HDI версии 3.3](../hdinsight-component-versioning.md#hdinsight-windows-retirement). 
>
> Сведения о развертывании и мониторинге топологий в HDInsight под управлением Windows см. в статье [Развертывание топологий Apache Storm в HDInsight под управлением Windows и управление ими](apache-storm-deploy-monitor-topology.md).


## <a name="prerequisites"></a>предварительным требованиям

* **Storm под управлением Linux в кластере HDInsight.** Инструкции по созданию кластера см. в статье [Руководство по Apache Storm в HDInsight: начало работы с анализом больших объемов данных в HDInsight с помощью примеров Storm Starter](apache-storm-tutorial-get-started-linux.md).

* (Необязательно.) **Знакомство с SSH и SCP**. Дополнительные сведения см. в разделе [Подключение к HDInsight (Hadoop) с помощью SSH](../hdinsight-hadoop-linux-use-ssh-unix.md).

* (Необязательно.) **Visual Studio**. Пакет SDK для Azure 2.5.1 или более поздней версии и средства Azure Data Lake для Visual Studio. Дополнительные сведения см. в статье [Приступая к работе с инструментами Azure Data Lake (в HDInsight) для Visual Studio для выполнения запроса Hive](../hadoop/apache-hadoop-visual-studio-tools-get-started.md).

    Одна из следующих версий Visual Studio:

  * Visual Studio 2012 с [обновлением 4](http://www.microsoft.com/download/details.aspx?id=39305)

  * Visual Studio 2013 с [обновлением 4](http://www.microsoft.com/download/details.aspx?id=44921) или [Visual Studio 2013 Community](http://go.microsoft.com/fwlink/?LinkId=517284)
  * [Visual Studio 2015](https://www.visualstudio.com/downloads/)

  * Visual Studio 2015 (любой выпуск);

  * Visual Studio 2017 (любой выпуск). Средства Data Lake для Visual Studio 2017 устанавливаются как часть рабочей нагрузки Azure.

## <a name="submit-a-topology-visual-studio"></a>Отправка топологии: Visual Studio

Средства HDInsight можно использовать для отправки топологии C# или гибридной топологии в кластер Storm. Далее используется пример приложения. См. дополнительные сведения о [разработке топологий C# с помощью средств HDInsight для Visual Studio](apache-storm-develop-csharp-visual-studio-topology.md).

1. Если вы еще не установили последнюю версию средств Data Lake для Visual Studio, прочитайте статью [Приступая к работе с инструментами Azure Data Lake (в HDInsight) для Visual Studio для выполнения запроса Hive](../hadoop/apache-hadoop-visual-studio-tools-get-started.md).

    > [!NOTE]
    > Средства Data Lake для Visual Studio ранее назывались средствами HDInsight для Visual Studio.
    >
    > Средства Data Lake для Visual Studio входят в состав __рабочей нагрузки Azure__ для Visual Studio 2017.

2. Откройте Visual Studio b выберите **Файл** > **Создать** > **Проект**.

3. В диалоговом окне **Новый проект** разверните **Установленные** > **Шаблоны** и выберите **HDInsight**. В списке шаблонов выберите **Пример Storm**. В нижней части диалогового окна введите имя приложения.

    ![изображение](./media/apache-storm-deploy-monitor-topology-linux/sample.png)

4. В **обозревателе решений** щелкните правой кнопкой мыши проект и выберите **Submit to Storm on HDInsight** (Отправить в Storm в HDInsight).

   > [!NOTE]
   > При появлении запроса введите учетные данные входа для своей подписки Azure. Если у вас несколько подписок, воспользуйтесь той, что содержит ваш кластер Storm в HDInsight.

5. Выберите Storm в кластере HDInsight из раскрывающегося списка **Кластер Storm** и щелкните **Отправить**. Вы можете отслеживать выполнение отправки в окне **Выходные данные** .

## <a name="submit-a-topology-ssh-and-the-storm-command"></a>Отправка топологии: SSH и команда Storm

1. Подключитесь к кластеру HDInsight с помощью SSH. Замените **USERNAME** именем пользователя SSH. Замените **CLUSTERNAME** именем кластера HDInsight.

        ssh USERNAME@CLUSTERNAME-ssh.azurehdinsight.net

    Дополнительные сведения об использовании SSH для подключения к кластеру HDInsight см. в разделе [Подключение к HDInsight (Hadoop) с помощью SSH](../hdinsight-hadoop-linux-use-ssh-unix.md).

2. Запустите пример топологии, используя следующую команду:

        storm jar /usr/hdp/current/storm-client/contrib/storm-starter/storm-starter-topologies-*.jar org.apache.storm.starter.WordCountTopology WordCount

    Эта команда запускает пример топологии WordCount в кластере. Эта топология произвольно создает предложения, а затем подсчитывает число вхождений каждого слова в предложениях.

   > [!NOTE]
   > При отправке топологии в кластер необходимо сначала скопировать jar-файл, содержащий кластер, а затем воспользоваться командой `storm`. Чтобы скопировать файл в кластер, можно использовать команду `scp`. Например, `scp FILENAME.jar USERNAME@CLUSTERNAME-ssh.azurehdinsight.net:FILENAME.jar`
   >
   > Пример WordCount и другие начальные примеры использования Storm уже включены в ваш кластер в `/usr/hdp/current/storm-client/contrib/storm-starter/`.

## <a name="submit-a-topology-programmatically"></a>Отправка топологии: программный метод

Топологию можно развернуть программными средствами с помощью службы Nimbus. По адресу [https://github.com/Azure-Samples/hdinsight-java-deploy-storm-topology](https://github.com/Azure-Samples/hdinsight-java-deploy-storm-topology) приведен пример приложения Java, в котором показано, как развернуть и запустить топологию с помощью службы Nimbus.

## <a name="monitor-and-manage-visual-studio"></a>Мониторинг и управление: Visual Studio

После отправки топологии с помощью Visual Studio отображается представление **Топологии Storm**. Выберите топологию в списке, чтобы просмотреть информацию о выполняемой топологии.

![мониторинг Visual Studio](./media/apache-storm-deploy-monitor-topology-linux/vsmonitor.png)

> [!NOTE]
> Можно также просмотреть **топологии Storm** в **обозревателе серверов**. Для этого разверните **Azure** > **HDInsight**, затем щелкните правой кнопкой мыши топологию Storm в кластере HDInsight и выберите **Просмотреть топологии Storm**.

Выделите компонент spout или bolt, чтобы просмотреть информацию о нем. Для каждого выбранного элемента открывается новое окно.

### <a name="deactivate-and-reactivate"></a>Деактивация и повторная активация

Деактивация топологии приостанавливает ее до завершения или повторной активации. Для этих операций используйте кнопки __Отключить__ и __Активировать повторно__ в верхней части окна __Topology Summary__ (Сводка топологии).

### <a name="rebalance"></a>Повторная балансировка

Повторная балансировка топологии позволяет системе пересмотреть параллелизм топологии. Например, если вы изменили размер кластера, добавив дополнительные узлы, повторная балансировка позволит топологии использовать новые узлы.

Для повторной балансировки топологии используйте кнопку __Rebalance__ (Перераспределить) в верхней части окна __Topology Summary__ (Сводка топологии).

> [!WARNING]
> При повторной балансировке сначала деактивируется топология, затем рабочие роли равномерно перераспределяются по кластеру и, наконец, топология возвращается в состояние, в котором она находилась перед повторной балансировкой. Поэтому, если топология была активна, она снова становится активной. Если она была отключена, то останется таковой.

### <a name="kill-a-topology"></a>Завершение работы топологии

Топологии Storm выполняются, пока не будут удалены или пока не будет удален кластер. Чтобы остановить топологию, используйте кнопку __Прервать__ в верхней части окна __Topology Summary__ (Сводка топологии).

## <a name="monitor-and-manage-ssh-and-the-storm-command"></a>Мониторинг и управление: SSH и команда Storm

Программа `storm` позволяет работать с запущенными топологиями из командной строки. Чтобы вывести полный список команд, воспользуйтесь `storm -h` .

### <a name="list-topologies"></a>Вывод списка топологий

Чтобы просмотреть список всех запущенных топологий, используйте следующую команду:

    storm list

Эта команда возвращает сведения аналогичные следующим:

    Topology_name        Status     Num_tasks  Num_workers  Uptime_secs
    -------------------------------------------------------------------
    WordCount            ACTIVE     29         2            263

### <a name="deactivate-and-reactivate"></a>Деактивация и повторная активация

Деактивация топологии приостанавливает ее до завершения или повторной активации. Чтобы отключить и повторно активировать топологию, используйте следующую команду.

    storm Deactivate TOPOLOGYNAME

    storm Activate TOPOLOGYNAME

### <a name="kill-a-running-topology"></a>Завершение запущенной топологии

Топологии Storm после запуска продолжают работать до тех пор, пока не будут остановлены. Для завершения топологии введите следующую команду:

    storm kill TOPOLOGYNAME

### <a name="rebalance"></a>Повторная балансировка

Повторная балансировка топологии позволяет системе пересмотреть параллелизм топологии. Например, если вы изменили размер кластера, добавив дополнительные узлы, повторная балансировка позволит топологии использовать новые узлы.

> [!WARNING]
> При повторной балансировке сначала деактивируется топология, затем рабочие роли равномерно перераспределяются по кластеру и, наконец, топология возвращается в состояние, в котором она находилась перед повторной балансировкой. Поэтому, если топология была активна, она снова становится активной. Если она была отключена, то останется таковой.

    storm rebalance TOPOLOGYNAME

## <a name="monitor-and-manage-storm-ui"></a>Мониторинг и управление: пользовательский интерфейс Storm

Пользовательский интерфейс Storm предоставляет веб-интерфейс для работы с запущенными топологиями и включен в состав кластера HDInsight. Чтобы открыть пользовательский интерфейс Storm, в веб-браузере перейдите по адресу **https://CLUSTERNAME.azurehdinsight.net/stormui**, где **CLUSTERNAME** — это имя вашего кластера.

> [!NOTE]
> При появлении соответствующего запроса введите имя пользователя и пароль администратора кластера (admin), которые использовались при создании кластера.

### <a name="main-page"></a>Главная страница

На главной странице пользовательского интерфейса Storm отображается следующая информация.

* **Cluster summary**(Сводка по кластерам) — основная информация о кластере Storm.
* **Topology summary**(Сводка по топологиям) — список запущенных топологий. С помощью ссылок в этом разделе можно просмотреть дополнительную информацию о конкретных топологиях.
* **Supervisor summary**(Сводка по контролеру) — информация о контролере Storm.
* **Nimbus configuration**(Конфигурация Nimbus) — конфигурация Nimbus для кластера.

### <a name="topology-summary"></a>Topology summary

При выборе ссылки в разделе **Topology summary** (Сводка по топологиям) отображается следующая информация о топологии.

* **Topology summary**(Сводка по топологии) — основная информация о топологии.
* **Topology actions**(Действия с топологией) — действия управления, которые можно выполнять с топологией.

  * **Activate**(Включить) — возобновление обработки отключенной топологии.
  * **Deactivate**(Отключить) — приостановка выполняемой топологии.
  * **Rebalance**(Повторная балансировка) — корректировка параллелизма топологии. После изменения числа узлов в кластере необходимо выполнить повторную балансировку топологий. Эта операция позволяет топологии скорректировать параллелизм для компенсации увеличения или уменьшения количества узлов в кластере.

    Дополнительные сведения см. в статье <a href="http://storm.apache.org/documentation/Understanding-the-parallelism-of-a-Storm-topology.html" target="_blank">Understanding the parallelism of a Storm topology</a> (Общие сведения о параллелизме топологии Storm).
  * **Kill**(Удалить) — останавливает выполнение топологии Storm по истечении заданного времени ожидания.
* **Topology stats**(Статистика топологии) — статистика по топологии. С помощью ссылок в столбце **Window** (Окно) можно установить интервал времени для оставшихся записей на странице.
* **Spouts**(Воронки) — используемые в топологии источники данных, которые называются воронками. С помощью ссылок в этом разделе можно получить дополнительную информацию о конкретных воронках.
* **Bolts**(Сита — используемые в топологии обработчики данных, которые называются ситами. С помощью ссылок в этом разделе можно получить дополнительную информацию о конкретных ситах.
* **Topology configuration**(Конфигурация топологии) — конфигурация выбранной топологии.

### <a name="spout-and-bolt-summary"></a>Сводка по воронкам и ситам

При выборе воронки в разделе **Spouts** (Воронки) или **Bolts** (Сита) отображается следующая информация о выбранном элементе.

* **Component summary**(Сводка по компоненту) — основная информация о воронке или сите.
* **Spout/Bolt stats**(Статистика по воронке или ситу) — статистика по воронке или ситу. С помощью ссылок в столбце **Window** (Окно) можно установить интервал времени для оставшихся записей на странице.
* **Input stats** (Статистика по входным данным, только сита) — информация о входных потоках, проходящих через сито.
* **Выходная статистика** — информация о потоках, создаваемых компонентами spout и bolt.
* **Executors**(Исполнители) — информация об экземплярах воронки или сита. Выберите запись **Port** (Порт) для конкретного исполнителя, чтобы просмотреть журнал диагностической информации, созданный для этого экземпляра.
* **Ошибки** — информация об ошибках для компонентов spout и bolt.

## <a name="monitor-and-manage-rest-api"></a>Мониторинг и управление: REST API

Пользовательский интерфейс Storm построен на базе REST API, поэтому функциональность отслеживания и управления можно реализовать аналогичным образом с помощью API. С помощью REST API можно создать пользовательские средства для отслеживания топологий Storm и управления ими.

Дополнительные сведения см. в разделе [API-интерфейс REST пользовательского интерфейса Storm](http://storm.apache.org/releases/0.9.6/STORM-UI-REST-API.html). Следующая информация касается использования REST API с Apache Storm в HDInsight.

> [!IMPORTANT]
> API-интерфейс REST для Storm не является общедоступным через Интернет, и обращаться к нему необходимо с помощью туннеля SSH на головной узел кластера HDInsight. Дополнительные сведения о создании и использовании туннеля SSH см. в статье [Использование туннелирования SSH для доступа к веб-интерфейсу Ambari, JobHistory, NameNode, Oozie и другим веб-интерфейсам](../hdinsight-linux-ambari-ssh-tunnel.md).

### <a name="base-uri"></a>Базовый универсальный код ресурса

Базовый универсальный код ресурса (URI) для REST API в кластерах HDInsight под управлением Linux доступен в головном узле по адресу **https://HEADNODEFQDN:8744/api/v1/**. Доменное имя головного узла формируется при создании кластера и не является статическим.

Полное доменное имя (FQDN) головного узла кластера можно получить несколькими способами.

* **Из сеанса SSH.** Из сеанса SSH в кластер примените команду `headnode -f`.
* **Из веб-интерфейса Ambari.** В верхней части страницы выберите **Services** (Службы), а затем — **Storm**. На вкладке **Summary** (Сводка) выберите **Storm UI Server** (Сервер пользовательского интерфейса Storm). Полное доменное имя узла, на котором размещены пользовательский интерфейс Storm и REST API, отображено в верхней части страницы.
* **Из интерфейса REST API Ambari.** Используйте команду `curl -u admin -G "https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/STORM/components/STORM_UI_SERVER"`, чтобы получить сведения об узле с выполняемыми пользовательскими интерфейсами Storm и REST API. Замените **CLUSTERNAME** именем кластера. При появлении запроса введите пароль (администратора), чтобы войти в учетную запись. Запись host_name в ответе будет содержать полное доменное имя узла.

### <a name="authentication"></a>Authentication

Для запросов REST API необходимо использовать **обычную проверку подлинности**с помощью имени и пароля администратора кластера HDInsight.

> [!NOTE]
> Так как при обычной проверке подлинности данные отправляются открытым текстом, следует **всегда** использовать HTTPS для защиты связи с кластером.

### <a name="return-values"></a>Возвращаемые значения

Сведения, возвращаемые из REST API, могут использоваться только в пределах кластера. Например, полное доменное имя, возвращаемое для серверов Zookeeper, недоступно из Интернета.

## <a name="next-steps"></a>Дальнейшие действия

См. дополнительные сведения о [разработке топологий на основе Java с помощью Maven](apache-storm-develop-java-topology.md).

Другие примеры топологий Storm см. в разделе [Примеры топологий для Storm в HDInsight](apache-storm-example-topology.md).
