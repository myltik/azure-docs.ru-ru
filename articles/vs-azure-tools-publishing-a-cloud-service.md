---
title: Публикация облачной службы с помощью инструментов Azure | Документация Майкрософт
description: Узнайте, как публиковать проекты облачных служб Azure с помощью Visual Studio.
services: visual-studio-online
author: ghogen
manager: douge
assetId: 1a07b6e4-3678-4cbf-b37e-4520b402a3d9
ms.prod: visual-studio-dev15
ms.technology: vs-azure
ms.workload: azure
ms.topic: conceptual
ms.date: 11/11/2017
ms.author: ghogen
ms.openlocfilehash: bde00dfbf4a7ffde90d1a9a3d57d3a2decf74cad
ms.sourcegitcommit: fa493b66552af11260db48d89e3ddfcdcb5e3152
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2018
ms.locfileid: "31799470"
---
# <a name="publishing-a-cloud-service-using-visual-studio"></a>Публикация облачной службы с помощью Visual Studio

Visual Studio может публиковать приложение непосредственно в Azure с поддержкой промежуточных и рабочих сред для облачной службы. При публикации выберите среду развертывания и учетную запись хранения, временно используемые для пакета развертывания.

Во время разработки и тестирования приложения Azure можно постепенно публиковать изменения веб-ролей с помощью веб-развертывания. После публикации приложения в среду развертывания веб-развертывание позволяет развертывать изменения непосредственно в виртуальную машину, которая выполняет веб-роль. Не обязательно упаковывать и публиковать все приложение Azure каждый раз, когда вы хотите обновить вашу веб-роль, чтобы проверить изменения. При таком подходе изменения веб-роли будут доступны в облаке для тестирования без ожидания, пока приложение будет публиковаться в среде развертывания.

Чтобы опубликовать приложение Azure и обновить веб-роль с помощью веб-развертывания, выполните следующие действия.

- Опубликуйте и упакуйте приложение Azure из Visual Studio
- Обновите веб-роль в рамках цикла разработки и тестирования

## <a name="publish-or-package-an-azure-application-from-visual-studio"></a>Опубликуйте и упакуйте приложение Azure из Visual Studio.

При публикации приложения Azure можно выполнить одну из следующих задач.

- Создать пакет службы. Этот пакет и файл конфигурации службы можно использовать для публикации приложения в среде развертывания из [портала Azure](https://portal.azure.com).

- Публикация проекта Azure из Visual Studio. Чтобы опубликовать приложение напрямую в Azure, воспользуйтесь мастером публикации. Дополнительную информацию см. в статье [Мастер публикации приложений Azure](vs-azure-tools-publish-azure-application-wizard.md).

### <a name="to-create-a-service-package-from-visual-studio"></a>Создание пакета службы из Visual Studio

1. Когда приложение готово к публикации, откройте обозреватель решений, затем контекстное меню проекта Azure, который содержит роли, и выберите пункт "Опубликовать".

1. Чтобы создать пакет службы, выполните следующие действия.

   a. Откройте контекстное меню проекта Azure и выберите пункт **Пакет**.

   Б. В диалоговом окне **Пакет приложения Azure** выберите конфигурацию службы, для которой требуется создать пакет, а затем конфигурацию построения.

   c. (Необязательно.) Чтобы включить удаленный рабочий стол для облачной службы после ее публикации, выберите **Enable Remote Desktop for all Roles** (Включить удаленный рабочий стол для всех ролей) и нажмите кнопку **Параметры**, чтобы настроить удаленный рабочий стол. Дополнительные сведения см. в статье [Enable Remote Desktop Connection for a Role in Azure Cloud Services using Visual Studio](cloud-services/cloud-services-role-enable-remote-desktop-visual-studio.md) (Включение подключения к удаленному рабочему столу для роли в облачных службах Azure с помощью Visual Studio).

      Если вы хотите отладить облачную службу после ее публикации, включите удаленную отладку, установив флажок **Включить удаленный отладчик для всех ролей**.

   d. Для создания пакета щелкните **Пакет** .

      Проводник показывает расположение файла только что созданного пакета. Скопируйте это расположение на портале Azure, чтобы его можно было использовать.

   д. Чтобы опубликовать этот пакет в среде развертывания, необходимо использовать это расположение в качестве расположения пакета при создании облачной службы и развернуть этот пакет в среде с помощью портала Azure.

1. (Необязательно) Чтобы отменить процесс развертывания, в контекстном меню строки в журнале действий выберите пункт **Отменить и удалить**. Эта команда позволит остановить процесс развертывания и удалить среду развертывания из Azure. Чтобы удалить среду после развертывания, воспользуйтесь порталом Azure.

1. (Необязательно.) После запуска экземпляров ролей Visual Studio автоматически отображает среду развертывания в узле **Облачные службы** в обозревателе сервера. Здесь можно просматривать состояние отдельных экземпляров ролей. Ознакомьтесь со статьей [Управление ресурсами Azure с помощью обозревателя облака](vs-azure-tools-resources-managing-with-cloud-explorer.md). На следующем рисунке показаны экземпляры роли в состоянии "Инициализация".

    ![VST_DeployComputeNode](./media/vs-azure-tools-publishing-a-cloud-service/IC744134.png)

## <a name="update-a-web-role-as-part-of-the-development-and-testing-cycle"></a>Обновите веб-роль в рамках цикла разработки и тестирования

Если серверная инфраструктура стабильна, но для веб-ролей требуется более частое обновление, можно использовать веб-развертывание, чтобы обновлять только веб-роль в проекте. Это удобно, если вы не хотите повторно создавать и развертывать серверные рабочие роли или если у вас несколько веб-ролей и вы хотите обновлять только одну из них.

### <a name="requirements-for-using-web-deploy"></a>Требования к использованию веб-развертывания

- **Только для разработки и тестирования.** Изменения вносятся непосредственно в виртуальную машину, в которой выполняется веб-роль. В случае рециркуляции виртуальной машины изменения будут потеряны, поскольку опубликованный исходный пакет используется для воссоздания виртуальной машины для роли. Чтобы последние обновления отразились в веб-роли, опубликуйте приложение повторно.

- **Можно обновлять только веб-роли.** Рабочие роли не обновляются. Кроме того, нельзя обновлять параметр `RoleEntryPoint` в файле `web role.cs`.

- **Возможна поддержка только одного экземпляра веб-роли.** Ни одна роль не может существовать в среде развертывания в нескольких экземплярах. При этом несколько веб-ролей с одним экземпляром поддерживаются.

- **Разрешить подключения к удаленному рабочему столу.** Это нужно для того, чтобы функция веб-развертывания могла подключиться к виртуальной машине, используя имя пользователя и пароль, и развернуть изменения на сервере IIS. Возможно также, что вам придется подключиться к виртуальной машине и добавить доверенный сертификат в IIS на этой виртуальной машине. (Этот сертификат обеспечивает защиту удаленного подключения к IIS, используемого веб-развертыванием.)

В описанной ниже процедуре предполагается, что вы используете **мастер публикации приложения Azure** .

### <a name="enable-web-deploy-when-you-publish-your-application"></a>Включение веб-развертывания при публикации приложения

1. Чтобы включить параметр **Enable Web Deploy for all web roles** (Разрешить веб-развертывание для всех веб-ролей), необходимо сначала настроить подключения удаленного рабочего стола. Выберите для всех ролей **Включить удаленный рабочий стол** и предоставьте учетные данные, используемые для удаленного подключения, в появившемся поле **Конфигурация удаленного рабочего стола**. Ознакомьтесь со статьей [Enable Remote Desktop Connection for a Role in Azure Cloud Services using Visual Studio](cloud-services/cloud-services-role-enable-remote-desktop-visual-studio.md) (Включение подключения к удаленному рабочему столу для роли в облачных службах Azure с помощью Visual Studio).

1. Чтобы включить веб-развертывание для всех веб-ролей приложения, установите флажок **Разрешить веб-развертывание для всех веб-ролей**.

    Появится желтый предупредительный треугольник. Веб-развертывание использует недоверенный, самозаверяющий сертификат по умолчанию, который не рекомендуется для передачи конфиденциальных данных. Если вам нужно обеспечить этот процесс для конфиденциальных данных, можно добавить сертификат SSL, который будет использоваться для подключений веб-развертывания. Этот сертификат должен быть доверенным. Дополнительные сведения см. в разделе [Безопасное веб-развертывание](#make-web-deploy-secure).

1. Нажмите кнопку **Далее**, чтобы отобразить экран **Сводка**, а затем нажмите кнопку **Опубликовать**, чтобы развернуть облачную службу.

    Облачная служба будет опубликована. Удаленные подключения создаваемой виртуальной машины включены для IIS таким образом, чтобы можно было использовать веб-развертывание для обновления веб-ролей без повторной публикации.

   > [!NOTE]
   > Если для веб-роли настроено больше одного экземпляра, выводится предупреждение о том, что каждая веб-роль ограничена одним экземпляром в пакете, созданном для публикации приложения. Чтобы продолжить, нажмите кнопку **ОК** . Как указано в разделе "Требования", веб-ролей может быть несколько, но у каждой роли может быть только один экземпляр.

### <a name="update-your-web-role-by-using-web-deploy"></a>Обновление веб-роли с помощью веб-развертывания

1. Чтобы использовать веб-развертывание, внесите изменения в код проекта для любой из веб-ролей в Visual Studio, которую требуется опубликовать, а затем щелкните узел этого проекта в решении правой кнопкой мыши и выберите пункт **Опубликовать**. Откроется диалоговое окно **Публикация веб-сайта** .

1. (Необязательно.) Если добавлен доверенный SSL-сертификат для удаленных подключений служб IIS, можно снять флажок **Разрешить ненадежный сертификат**. Сведения о том, как добавить сертификат для обеспечения безопасности веб-развертывания, см. ниже в разделе **Безопасное веб-развертывание**.

1. Чтобы использовать веб-развертывание, механизму публикации необходимо имя пользователя и пароль, которые создаются для подключения удаленного рабочего стола во время первой публикации пакета.

   a. В поле **Имя пользователя**введите имя пользователя.

   Б. В поле **Пароль**введите пароль.

   c. (Необязательно) Если вы хотите сохранить пароль в этом профиле, выберите **Сохранить пароль**.

1. Чтобы опубликовать изменения в веб-роли, щелкните **Опубликовать**.

    В строке состояния отображается **Публикация начата**. После завершения публикации отображается **Публикация успешно завершена** . Эти изменения были развернуты для веб-роли на вашей виртуальной машине. Теперь можно запустить приложение Azure, чтобы проверить изменения в среде Azure.

### <a name="make-web-deploy-secure"></a>Безопасное веб-развертывание

1. Веб-развертывание использует недоверенный, самозаверяющий сертификат по умолчанию, который не рекомендуется для передачи конфиденциальных данных. Если вам нужно обеспечить этот процесс для конфиденциальных данных, можно добавить сертификат SSL, который будет использоваться для подключений веб-развертывания. Это должен быть доверенный сертификат, который можно получить в центре сертификации.

    Чтобы выполнить безопасное веб-развертывание для каждой виртуальной машины и каждой веб-роли, необходимо загрузить доверенный сертификат, который будет использоваться для веб-развертывания, на портал Azure. Этот сертификат будет добавлен на виртуальную машину, которая создается для веб-роли при публикации приложения.

1. Чтобы добавить в IIS доверенный сертификат SSL, который будет использоваться для удаленных подключений, выполните указанные ниже действия.

   a. Чтобы подключиться к виртуальной машине, на которой запущена веб-роль, выберите экземпляр веб-роли в **Cloud Explorer** или **обозревателе сервера**, а затем выберите команду **Подключиться с помощью удаленного рабочего стола**. Пошаговые инструкции по подключению к виртуальной машине см. в статье [Enable Remote Desktop Connection for a Role in Azure Cloud Services using Visual Studio](cloud-services/cloud-services-role-enable-remote-desktop-visual-studio.md) (Включение подключения к удаленному рабочему столу для роли в облачных службах Azure с помощью Visual Studio). В браузере появится запрос на скачивание `.rdp` файла.

   Б. Чтобы добавить сертификат SSL, откройте службу управления в диспетчере IIS. В диспетчере IIS включите использование SSL, щелкнув ссылку **Привязки** в области **Действие**. Откроется диалоговое окно **Добавление привязки сайта**. Выберите **Добавить**, а затем из раскрывающегося списка **Тип** выберите пункт HTTPS. Из списка **SSL-сертификатов** выберите SSL-сертификат, подписанный центром сертификации и переданный на портал Azure. Дополнительные сведения см. в разделе [Configure Connection Settings for the Management Service (IIS 7)](http://go.microsoft.com/fwlink/?LinkId=215824) (Настройка параметров подключения для службы управления (IIS 7)).

      > [!NOTE]
      > После добавления доверенного SSL-сертификата желтый треугольник предупреждения больше не будет отображаться в **мастере публикации**.

## <a name="include-files-in-the-service-package"></a>Включение файлов в пакет службы

Вам может понадобиться включить в пакет службы определенные файлы, чтобы они были доступны на виртуальной машине, созданной для роли. Например, возможно, что в пакет службы нужно будет добавить `.exe` или `.msi` файл, который используется скриптом запуска, или сборку, необходимую проекту рабочей или веб-роли. Включаемые файлы должны быть добавлены в решение для приложения Azure.

1. Чтобы добавить сборку в пакет службы, выполните следующие действия.

   a. В **обозревателе решений** откройте узел проекта, не содержащий сборку, на которую имеется ссылка.
   Б. Чтобы добавить сборку в проект, откройте контекстное меню папки **Ссылки** и выберите **Добавить ссылку**. Открывается диалоговое окно "Добавить ссылку".
   c. Выберите ссылку, которую вы хотите добавить, а затем нажмите **ОК**. Ссылка будет добавлена в список в папке **Ссылки** .
   d. Откройте контекстное меню добавленной сборки и выберите **Свойства**. Откроется окно **Свойства** .

      Чтобы включить эту сборку в пакет службы, выберите из списка **Копировать локально** значение **True**.
1. В **обозревателе решений** откройте узел проекта, не содержащий сборку, на которую имеется ссылка.

1. Чтобы добавить сборку в проект, откройте контекстное меню папки **Ссылки** и выберите **Добавить ссылку**. Откроется диалоговое окно **Добавить ссылку** .

1. Выберите ссылку, которую вы хотите добавить, а затем нажмите кнопку **ОК** .

    Ссылка будет добавлена в список в папке **Ссылки** .

1. Откройте контекстное меню добавленной сборки и выберите **Свойства**. Откроется окно "Свойства".

1. Чтобы включить эту сборку в пакет службы, выберите из списка **Копировать локально** значение **True**.

1. Чтобы включить файлы, добавленные в проект веб-роли, в пакет службы, откройте контекстное меню файла и выберите пункт **Свойства**. В окне **Свойства** из списка **Действие при сборке** выберите **Содержимое**.

1. Чтобы включить файлы, добавленные в проект рабочей роли, в пакет службы, откройте контекстное меню файла и выберите пункт **Свойства**. В окне **Свойства** из списка **Копировать в выходной каталог** выберите **Копировать, если новее**.

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о публикации в Azure из Visual Studio см. в статье [Мастер публикации приложения Azure](vs-azure-tools-publish-azure-application-wizard.md).
