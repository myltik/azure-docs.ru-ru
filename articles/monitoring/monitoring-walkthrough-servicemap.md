---
title: Гибкая демонстрация работы с решением "Сопоставление служб" в Azure | Документация Майкрософт
description: "\"Сопоставление служб\" — это решение Azure, которое автоматически обнаруживает компоненты приложений в системах Windows и Linux и сопоставляет взаимодействие между службами. В этой демонстрации представлены пошаговые инструкции по определению и диагностике имитации проблемы в веб-приложении с помощью решения \"Сопоставление служб\"."
services: monitoring
documentationcenter: ''
author: bwren
manager: carmonm
editor: tysonn
ms.assetid: 9dc437b9-e83c-45da-917c-cb4f4d8d6333
ms.service: monitoring
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/12/2017
ms.author: bwren
ms.openlocfilehash: b406cb2a9e96e3ba3514ed08c20483df57de9c71
ms.sourcegitcommit: 870d372785ffa8ca46346f4dfe215f245931dae1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/08/2018
---
# <a name="self-paced-demo---service-map"></a>Гибкая демонстрация работы с решением "Сопоставление служб"
В этой демонстрации представлены пошаговые инструкции по определению и диагностике имитации проблемы в веб-приложении с помощью [решения "Сопоставление служб"](monitoring-service-map.md) в Azure. Служба схемы услуги автоматически обнаруживает компоненты приложений в системах Windows и Linux и сопоставляет взаимодействие между службами. Здесь также объединяются данные из других служб и решений, которые помогут в анализе производительности и выявлении проблем. Чтобы определить источник проблемы, подробно изучите собранные данные, выполнив [поиск по журналам в Log Analytics](../log-analytics/log-analytics-log-searches.md).


## <a name="scenario-description"></a>Описание сценария
Вы только что получили уведомление о том, что в приложении пользовательского портала ACME произошли проблемы с производительностью. Вы знаете только то, что проблемы начались сегодня около 4:00 по тихоокеанскому времени. Вы не совсем уверены во всех компонентах, от которых зависит портал, кроме набора веб-серверов. 

## <a name="components-and-features-used"></a>Используемые компоненты и функции
- [Решение "Схема услуги"](monitoring-service-map.md)
- [Поиск по журналам Log Analytics](../log-analytics/log-analytics-log-searches.md)


## <a name="walkthrough"></a>Пошаговое руководство

### <a name="1-connect-to-the-oms-experience-center"></a>1. Подключение к OMS Experience Center
В этом пошаговом руководстве используется [Operations Management Suite Experience Center](https://experience.mms.microsoft.com/), предоставляющий полную среду Log Analytics с демонстрационными данными. Сначала перейдите по этой ссылке, укажите необходимые сведения и выберите сценарий  **Insight and Analytics** (Анализ и аналитика).


### <a name="2-start-service-map"></a>2. Запуск решения "Схема услуги"
Запустите решение "Схема услуги", щелкнув плитку **Схема услуги**.

![Плитка "Схемы услуги"](media/monitoring-walkthrough-servicemap/tile.png)

Откроется консоль решения "Схема услуги". На панели слева приведен список компьютеров в среде с установленным агентом схемы услуги. Выберите из этого списка компьютер, который вы хотите просмотреть.

![Список компьютеров](media/monitoring-walkthrough-servicemap/computer-list.png)


### <a name="3-view-computer"></a>3. Просмотр компьютера
Вы знаете, что веб-серверы называются AcmeWFE001 и AcmeWFE002, поэтому разумно начать с них. Щелкните **AcmeWFE001**. Откроется схема веб-сервера AcmeWFE001 и всех его зависимостей. Вы можете увидеть, какие процессы запущены на выбранном компьютере и какие из них взаимодействуют с внешними службами.

![Веб-сервер](media/monitoring-walkthrough-servicemap/web-server.png)

Вам нужно узнать о производительности веб-приложений, поэтому щелкните процесс **AcmeAppPool (пул приложений IIS)**. Отобразятся подробные сведения об этом процессе и выделятся его зависимости. 

![Пул приложений](media/monitoring-walkthrough-servicemap/app-pool.png)


### <a name="4-change-time-window"></a>4. Изменение временного окна

Вам известно, что проблемы начались в 4:00. Давайте посмотрим, что происходило в то время. Щелкните **Диапазон времени** и измените значение времени на 4:00 по тихоокеанскому времени (сохраните текущую дату и выберите локальный часовой пояс) с диапазоном времени 20 минут.

![Средство выбора времени](./media/monitoring-walkthrough-servicemap/time-picker.png)


### <a name="5-view-alert"></a>5. Просмотр оповещений

Вы видите, что возле зависимости **acmetomcat** отобразилось оповещение. Вероятнее всего, это и есть проблема. Щелкните значок оповещения в **acmetomcat** для отображения сведений о нем. Видно, что ЦП критически загружен. Если развернуть зависимость, мы можем получить больше сведений. Вероятно, это причина снижения производительности. 

![Предупреждение](./media/monitoring-walkthrough-servicemap/alert.png)


### <a name="6-view-performance"></a>6. Просмотр производительности

Давайте подробнее рассмотрим **acmetomcat**. Щелкните в верхней правой части **acmetomcat** и выберите **Загрузить карту сервера**, чтобы отобразить зависимости и получить больше сведений об этом компьютере. Теперь вы можете посмотреть на счетчики производительности, чтобы проверить свои подозрения. Выберите вкладку **Производительность**, чтобы отобразить [счетчики производительности, данные которых собрала служба Log Analytics](../log-analytics/log-analytics-data-sources-performance-counters.md) за определенный период времени. На сервере происходят периодические скачки нагрузки на процессор и память.

![Производительность](./media/monitoring-walkthrough-servicemap/performance.png)


### <a name="7-view-change-tracking"></a>7. Просмотр отслеживаемых изменений
Давайте посмотрим, можем ли мы выяснить причину этой высокой загрузки. Щелкните вкладку **Сводка**. На ней представлены сведения, собранные Log Analytics с компьютера, такие как сбои подключений, критические оповещения и изменения программного обеспечения. Разделы с соответствующими сведениями должны быть развернуты. Кроме того, вы можете развернуть и другие разделы, чтобы просмотреть сведения в них.


Если узел **Отслеживание изменений** не открыт, разверните его. Здесь содержатся сведения, собираемые [решением для отслеживания изменений](../log-analytics/log-analytics-change-tracking.md). Похоже в течение этого диапазона времени произошло изменение в программном обеспечении. Щелкните **Программное обеспечение** для получения сведений. Сразу после 4:00 на компьютер был добавлен процесс архивации, который и вызвал избыточное потребление ресурсов.

![Отслеживание изменений](./media/monitoring-walkthrough-servicemap/change-tracking.png)



### <a name="8-view-details-in-log-search"></a>8. Просмотр сведений в поиске по журналам
Вы можете дополнительно убедиться в этом, просмотрев подробные сведения о производительности, собранные в рабочей области Log Analytics. Снова щелкните вкладку **Оповещения**, а затем одно из оповещений о **высокой нагрузке ЦП**. Щелкните **Показать в поиске по журналам**. Откроется окно поиска по журналу, где вы можете [искать по журналам](../log-analytics/log-analytics-log-searches.md) любые данные, хранящиеся в рабочей области. В решении "Сопоставление служб" уже заполнен запрос на получение интересующего оповещения. 

![Поиск по журналам](./media/monitoring-walkthrough-servicemap/log-search.png)


### <a name="9-open-saved-search"></a>9. Открытие сохраненного поиска
Давайте попытаемся получить более подробные сведения о сборке данных производительности, вызвавшей это оповещение, и проверим свои подозрения о том, что проблемы вызваны процессом архивации. Измените диапазон времени на **6 часов** Щелкните **Избранное** и прокрутите вниз до сохраненных поисковых запросов **Схемы услуги**. Эти запросы созданы специально для этого анализа. Щелкните **Top 5 Processes by CPU for acmetomcat** (5 основных процессов ЦП для acmetomcat).

![Сохраненный поиск](./media/monitoring-walkthrough-servicemap/saved-search.png)


Этот запрос выводит список 5 основных процессов, потребляющих ресурсы ЦП, на **acmetomcat**. Вы можете изучить запрос, чтобы кратко ознакомиться с языком запросов, используемым для поиска по журналам. Если вы заинтересованы в процессах на других компьютерах, можно изменить запрос, чтобы получить эту информацию.

В этом случае процесс архивации постоянно занимает около 60 % ЦП на сервере приложений. Очевидно, что из-за этого процесса возникли проблемы с производительностью. Вы конечно же решили удалить этот новый процесс архивации программного обеспечения с сервера приложения. Вы можете использовать настройку требуемого состояния (DSC) под управлением службы автоматизации Azure для определения политик, гарантирующих, что этот процесс никогда не будет выполняться на этих критически важных системах.


## <a name="summary-points"></a>Основные положения
- [Схема услуг](monitoring-service-map.md) предоставляет возможность просмотра всего приложения, даже если вы не знаете всех его серверов и зависимостей.
- "Сопоставление служб" предоставляет данные, собранные другими решениями по управлению, чтобы помочь определить проблемы с приложением и его базовой инфраструктурой.
- [Поиск по журналу](../log-analytics/log-analytics-log-searches.md) позволяет детально изучить конкретные данные, собранные в рабочей области Log Analytics.  

## <a name="next-steps"></a>Дополнительная информация
- Дополнительные сведения о [Схеме услуги](monitoring-service-map.md)
- [Разверните и настройте](monitoring-service-map-configure.md) решение "Схема услуг".
- Дополнительные сведения о службе Log Analytics, требуемой для решения "Сопоставление служб" и сохраняющей рабочие данные агентов, см. в статье [Что такое Log Analytics?](../log-analytics/log-analytics-overview.md).