---
title: Использование решения "Сопоставление служб" в Azure | Документация Майкрософт
description: "\"Сопоставление служб\" — это решение Azure, которое автоматически обнаруживает компоненты приложений в системах Windows и Linux и сопоставляет взаимодействие между службами. В этой статье содержатся подробные сведения о развертывании схемы услуги в вашей среде и приведены разнообразные сценарии ее использования."
services: monitoring
documentationcenter: ''
author: daveirwin1
manager: jwhit
editor: tysonn
ms.assetid: 3ceb84cc-32d7-4a7a-a916-8858ef70c0bd
ms.service: monitoring
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 11/22/2016
ms.author: daseidma;bwren;dairwin
ms.openlocfilehash: aa9a6b54576ce8399471891c9ab5b80216f00ee1
ms.sourcegitcommit: 870d372785ffa8ca46346f4dfe215f245931dae1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/08/2018
ms.locfileid: "33887494"
---
# <a name="using-service-map-solution-in-azure"></a>Использование решения "Сопоставление служб" в Azure
Служба схемы услуги автоматически обнаруживает компоненты приложений в системах Windows и Linux и сопоставляет взаимодействие между службами. Схема услуги позволяет рассматривать серверы как взаимосвязанные системы, предоставляющие важные услуги. Схема услуги отображает сведения о подключениях между серверами, процессами и портами в любой подключенной по протоколу TCP архитектуре без дополнительной настройки. Пользователям требуется только установить агент.

В этой статье подробно описано использование схемы услуги. Сведения о настройке решения "Сопоставление служб" и соответствующих агентов подключения см. в статье [Настройка схемы услуги в Operations Management Suite]( monitoring-service-map-configure.md).


## <a name="use-cases-make-your-it-processes-dependency-aware"></a>Сценарии использования. Обеспечение учета зависимостей в ИТ-процессах

### <a name="discovery"></a>Обнаружение
Служба схемы услуги автоматически создает общую ссылочную карту зависимостей между серверами, процессами и сторонними службами. Она обнаруживает и сопоставляет все TCP-зависимости, определяя неожиданные подключения, удаленные сторонние системы, от которых зависит ваша система, и зависимости в традиционных "темных" областях вашей сети, например Active Directory. Кроме того, служба схемы услуги обнаруживает неудачные сетевые подключения пользовательских систем, что позволяет определить потенциальные неверные настройки сервера, простои служб и проблемы с сетью.

### <a name="incident-management"></a>Управление инцидентами
Схема услуги помогает быстрее изолировать проблему, предоставляя сведения о подключениях систем и их влиянии друг на друга. Помимо определения неудачных попыток подключения, она также помогает выявлять неправильно настроенные подсистемы балансировки нагрузки, неожиданные или избыточные нагрузки на важные службы и неавторизованные клиенты, такие как компьютеры разработчиков, взаимодействующие с рабочими системами. Используя интегрированные с решением для отслеживания изменений рабочие процессы, вы также можете определять, вызван ли инцидент событием изменения на внутреннем компьютере или во внутренней службе.

### <a name="migration-assurance"></a>Обеспечение миграции
Схема услуги позволяет эффективно спланировать, ускорить и проверить миграцию ресурсов в Azure, гарантируя полный перенос без простоев. Пользователи могут обнаруживать все взаимозависимые системы, которые нужно переносить вместе, оценивать конфигурацию и емкость системы, а также определять, следует ли переносить систему (возможно, ее уже нужно вывести из эксплуатации). После переноса вы можете проверить нагрузку и удостоверения клиента, чтобы убедиться в том, что тестовые системы и пользователи подключены. Если с планированием подсети и определениями брандмауэра возникли проблемы, то на основе неудачных подключений, отображаемых на картах сопоставления служб, можно определить системы, для которых требуется установить подключение.

### <a name="business-continuity"></a>Непрерывность бизнес-процессов
Если вы используете Azure Site Recovery и вам нужна помощь с определением последовательности восстановления среды приложения, служба схемы услуги может автоматически показать взаимосвязь между системами. Таким образом вы обеспечите надежный план восстановления. Выбрав важный сервер или группу и просмотрев их клиенты, можно определить внешние системы, которые следует восстановить после восстановления и обеспечения доступности сервера. И наоборот, просмотрев внутренние зависимости важного сервера, можно определить системы, которые необходимо восстановить после восстановления целевых систем.

### <a name="patch-management"></a>Управление исправлениями
За счет предоставления сведений о других группах и серверах, зависящих от вашей службы, решение "Сопоставление служб" расширяет возможности использования решения для оценки обновлений системы. Это позволяет заранее уведомлять об отключении системы для установки исправлений. Решение "Сопоставление служб" предоставляет также дополнительные возможности управления исправлениями, отображая сведения о доступности служб и правильности их подключения после установки исправлений или перезапуска.


## <a name="mapping-overview"></a>Общие сведения о сопоставлении
Агенты сопоставления служб собирают информацию обо всех подключенных по протоколу TCP процессах на сервере, где они установлены, а также сведения о входящих и исходящих подключениях для каждого процесса. В списке в левой области можно выбрать компьютеры или группы с агентами схемы услуги, чтобы визуализировать их зависимости для определенного диапазона времени. Карты зависимостей компьютеров создаются для отдельного компьютера. На них представлены сведения о всех компьютерах, которые являются клиентами или серверами TCP, к которым может напрямую подключиться этот компьютер.  На картах групп компьютеров показаны наборы серверов и их зависимости.

![Обзор схемы услуги](media/monitoring-service-map/service-map-overview.png)

Чтобы получить сведения о выполняющихся группах процессов и процессах с активными сетевыми подключениями в течение определенного диапазона времени, компьютеры можно развернуть в представлении карты. При развертывании карты для удаленного компьютера с агентом схемы услуги отображаются только те процессы, которые взаимодействуют с целевым компьютером. Сведения о количестве подключенных к целевому компьютеру внешних компьютеров, на которых не установлены агенты, указаны слева от процессов, к которым они подключены. Если целевой компьютер подключается к внутреннему компьютеру без агента, этот внутренний сервер включается в группу портов сервера вместе с другими подключениями к порту с таким же номером.

По умолчанию на картах сопоставления служб представлены сведения о зависимостях за последние 30 минут. С помощью элементов управления временем, расположенных в левом верхнем углу, на картах можно запрашивать сведения максимум за 1 час. Так вы можете получать представление о зависимостях в прошлом (например, во время инцидента или перед изменением). В платных рабочих областях данные схемы услуги хранятся 30 дней, а в бесплатных — 7.

## <a name="status-badges-and-border-coloring"></a>Индикаторы состояния и цвет рамки представления
В нижней части схемы каждого сервера может отображаться список значков состояния с информацией о состоянии сервера. Наличие значков свидетельствует о том, что для сервера поступили важные сведения из одной из интеграций решения. Если щелкнуть значок, в области справа откроются сведения о состоянии. Сейчас доступны следующие значки состояния: "Предупреждения", "Служба поддержки", "Изменения", "Безопасность" и "Обновления".

В зависимости от серьезности индикатора состояния рамка представления со сведениями об узле компьютера может быть красной (критическое состояние), желтой (предупреждение) или синей (информационное оповещение). Цвет представляет высокую серьезность любого индикатора состояния. Серая рамка информирует об узле без индикаторов состояния.

![Значки состояния](media/monitoring-service-map/status-badges.png)

## <a name="process-groups"></a>Группы процессов
Группы процессов позволяют объединять процессы, связанные с общим продуктом или службой, в группы.  При развертывании узла компьютера будут отображаться автономные процессы и группы процессов.  Если произойдет сбой какого-либо входящего или исходящего подключения к процессу в группе, будет считаться, что подключение завершилось с ошибкой для всей группы процессов.

## <a name="machine-groups"></a>Группы компьютеров
Группы компьютеров позволяют просматривать карты для набора серверов, а не отдельного сервера, благодаря чему можно отображать на одной карте все элементы многоуровневого приложения или кластера серверов.

Пользователи выбирают серверы, относящиеся к одной группе, и указывают имя группы.  Затем можно выбрать, следует ли просмотреть группу со всеми процессами и подключениями или только с теми процессами и подключениями, которые напрямую связаны с другими элементами группы.

![Группа компьютеров](media/monitoring-service-map/machine-group.png)

### <a name="creating-a-machine-group"></a>Создание группы компьютеров
Чтобы создать группу, выберите нужный компьютер или компьютеры в списке компьютеров и щелкните **Добавить в группу**.

![Создание группы](media/monitoring-service-map/machine-groups-create.png)

Далее можно выбрать **Создать** и присвоить группе имя.

![Присвоение имени группе](media/monitoring-service-map/machine-groups-name.png)

>[!NOTE]
>Группы компьютеров в настоящее время ограничены 10 серверами, однако в ближайшее время мы планируем увеличить этот предел.

### <a name="viewing-a-group"></a>Просмотр группы
После создания групп их можно просмотреть на вкладке "Группы".

![Вкладка "Группы"](media/monitoring-service-map/machine-groups-tab.png)

Затем выберите имя группы для просмотра карты этой группы компьютеров.
![Группа компьютеров](media/monitoring-service-map/machine-group.png). Относящиеся к группе компьютеры обозначены на карте белым цветом.

При развертывании группы компьютеров выводится список входящих в нее компьютеров.

![Компьютеры группы](media/monitoring-service-map/machine-groups-machines.png)

### <a name="filter-by-processes"></a>Фильтрация по процессам
Карту можно переключать между двумя режимами просмотра: отображение всех процессов и подключений в группе или только тех процессов и подключений, которые напрямую связаны с группой компьютеров.  По умолчанию отображаются все процессы.  Чтобы изменить режим, щелкните значок фильтра над картой.

![Фильтрация группы](media/monitoring-service-map/machine-groups-filter.png)

Если выбран фильтр **Все процессы**, на карте будут показаны все процессы и подключения на каждом компьютере группы.

![Все процессы группы компьютеров](media/monitoring-service-map/machine-groups-all.png)

Если изменить режим на отображение **связанных с группой процессов**, карте будут показаны только те процессы и подключения, которые напрямую связаны с другими компьютерами в группе, что упрощает представление.

![Группа компьютеров с отфильтрованными процессами](media/monitoring-service-map/machine-groups-filtered.png)
 
### <a name="adding-machines-to-a-group"></a>Добавление компьютеров в группу
Чтобы добавить компьютеры в существующую группу, установите флажки рядом с нужными компьютерами и щелкните **Добавить в группу**.  Затем выберите группу, в которую нужно добавить компьютеры.
 
### <a name="removing-machines-from-a-group"></a>Удаление компьютеров из группы
В списке групп разверните имя группы, чтобы получить список входящих в нее компьютеров.  Затем щелкните многоточие рядом с компьютером, который нужно удалить, и в открывшемся меню выберите пункт **Удалить**.

![Удаление компьютера из группы](media/monitoring-service-map/machine-groups-remove.png)

### <a name="removing-or-renaming-a-group"></a>Удаление или переименование группы
В списке групп щелкните многоточие рядом с именем группы, чтобы открыть меню.

![Меню группы компьютеров](media/monitoring-service-map/machine-groups-menu.png)


## <a name="role-icons"></a>Значки ролей
Определенным процессам присваиваются определенные роли на компьютерах: веб-серверы, серверы приложений, базы данных и т. д. На схеме служб процессы и поля, представляющие компьютеры, обозначены значками ролей. Эти значки помогают быстро определить роль, присвоенную процессу или серверу.

| Значок роли | ОПИСАНИЕ |
|:--|:--|
| ![Веб-сервер](media/monitoring-service-map/role-web-server.png) | Веб-сервер |
| ![Сервер приложений](media/monitoring-service-map/role-application-server.png) | Сервер приложений |
| ![Сервер базы данных](media/monitoring-service-map/role-database.png) | Сервер базы данных |
| ![Сервер LDAP](media/monitoring-service-map/role-ldap.png) | Сервер LDAP |
| ![Сервер SMB](media/monitoring-service-map/role-smb.png) | Сервер SMB |

![Значки ролей](media/monitoring-service-map/role-icons.png)


## <a name="failed-connections"></a>Неудачные подключения
На картах схемы услуги отображаются сведения о неудачных подключениях компьютеров и процессов. Пунктирная красная линия указывает на то, что при подключении клиентской системы к процессу или порту произошел сбой. Сведения о неудачных подключениях поступают из всех систем, на которых развернут агент схемы услуги и где попытка подключения завершилась сбоем. Служба схемы услуги оценивает этот процесс путем наблюдения за TCP-сокетами, которым не удалось установить подключение. Ошибки подключения могут быть связаны с брандмауэром, неправильными настройками клиента или сервера, а также с недоступностью удаленной службы.

![Неудачные подключения](media/monitoring-service-map/failed-connections.png)

Понятие причин сбоя подключений может помочь с устранением неполадок, проверкой переноса и выполнением анализа безопасности, а также разобраться, как устроена архитектура. Иногда неудачные подключения безвредны, но зачастую они указывают на проблему, например внезапную недоступность среды отработки отказа или отсутствие взаимодействия между двумя уровнями приложения после миграции в облако.

## <a name="client-groups"></a>Группы клиентов
Клиентские группы представлены на схеме элементами, представляющими клиентские компьютеры без агентов зависимостей. Одна группа клиентов представляет клиентов для отдельного процесса или компьютера.

![Группы клиентов](media/monitoring-service-map/client-groups.png)

Чтобы просмотреть IP-адреса серверов в группе клиентов, выберите соответствующую группу. Содержимое группы выводится в области **Свойства группы клиентов**.

![Свойства группы клиентов](media/monitoring-service-map/client-group-properties.png)

## <a name="server-port-groups"></a>Группы портов серверов
Группы портов серверов — это элементы, представляющие порты серверов на серверах, которые не имеют агентов зависимостей. В элементе отображается порт сервера и число серверов, подключенных к этому порту. Разверните элемент, чтобы просмотреть отдельные серверы и подключения. Если в списке отображается только один сервер, указывается его имя или IP-адрес.

![Группы портов серверов](media/monitoring-service-map/server-port-groups.png)

## <a name="context-menu"></a>Контекстное меню
Если щелкнуть многоточие (...) в правом верхнем углу любого сервера, откроется контекстное меню для этого сервера.

![Неудачные подключения](media/monitoring-service-map/context-menu.png)

### <a name="load-server-map"></a>Загрузить карту сервера
Если выбрать пункт **Загрузить карту сервера**, откроется новая карта с выбранным сервером в качестве нового целевого компьютера.

### <a name="show-self-links"></a>Показать ссылки на себя
Если выбрать пункт **Показать ссылки на себя**, будет обновлен узел сервера, включая все циклические ссылки, которые являются TCP-подключениями, начинающимися и заканчивающимися в процессах в пределах сервера. Если циклические ссылки отображаются, команда меню меняется на **Скрыть ссылки на себя**, что позволяет отключить ссылки.

## <a name="computer-summary"></a>Сводка по компьютеру
В области **Machine Summary** (Сводка по компьютеру) представлены общие сведения об операционной системе сервера, числе зависимостей, а также данные из других решений. Эти данные включают в себя метрики производительности, билеты на обслуживание в службе поддержки, данные отслеживания изменений, сведения о безопасности и обновления.

![Область "Сводка по компьютеру"](media/monitoring-service-map/machine-summary.png)

## <a name="computer-and-process-properties"></a>Свойства компьютера и процесса
Выбрав на карте схемы услуги компьютеры и процессы, можно просмотреть дополнительные сведения об их свойствах. Для виртуальных машин предоставляются сведения о DNS-имени, IPv4-адресах, мощности ЦП и объеме памяти, типе виртуальной машины, версии операционной системы, времени последнего перезапуска и идентификаторах соответствующих агентов OMS и сопоставления служб.

![Область "Свойства компьютера"](media/monitoring-service-map/machine-properties.png)

Вы можете собирать сведения о выполняющихся процессах на основе метаданных операционной системы. К ним относятся имя процесса, его описание, имя пользователя и домен (в Windows), название компании, имя продукта, версия продукта, рабочий каталог, командная строка и время запуска процесса.

![Область "Свойства процесса"](media/monitoring-service-map/process-properties.png)

В области **Сводка по процессу** приведены дополнительные сведения о подключениях процесса, в том числе привязанные порты, входящие и исходящие подключения, а также неудачные подключения.

![Область "Сводка по процессу"](media/monitoring-service-map/process-summary.png)

## <a name="alerts-integration"></a>Интеграция с решением для управления оповещениями
Решение "Сопоставление служб" интегрируется с оповещениями в Log Analytics для отображения активированных оповещений для выбранного сервера за указанный диапазон времени. При наличии предупреждений на сервере отображается соответствующий значок, и предупреждения отображаются в области **предупреждений компьютера**.

![Область предупреждений компьютера](media/monitoring-service-map/machine-alerts.png)

Чтобы включить отображение важных предупреждений в службе схемы услуги, создайте правило предупреждений, которое запускается для определенного компьютера. Ниже описано, как правильно создавать оповещения.
- Добавьте предложение для группирования по компьютеру (например, **by Computer interval 1minute**).
- Выберите предупреждение на основе измерения метрики.

![Конфигурация оповещения](media/monitoring-service-map/alert-configuration.png)


## <a name="log-events-integration"></a>Интеграция событий журнала
Схема услуги интегрируется со службой поиска по журналам для отображения количества всех событий журнала, доступных для выбранного сервера за указанный диапазон времени. Можно щелкнуть любую строку в списке количества событий, чтобы перейти к поиску по журналам и просмотреть отдельные события журнала.

![Область событий журнала компьютера](media/monitoring-service-map/log-events.png)

## <a name="service-desk-integration"></a>Интеграция службы поддержки
Если решение "Сопоставление служб" и соединитель управления ИТ-услугами включены и настроены в рабочей области Log Analytics, они интегрируются друг с другом автоматически. Эта интеграция обозначена в схеме услуги как "Служба поддержки". Дополнительные сведения см. в статье [Централизованное управление рабочими элементами ITSM с помощью соединителя управления ИТ-службами](https://docs.microsoft.com/azure/log-analytics/log-analytics-itsmc-overview).

В области **службы поддержки компьютера** отображается список всех событий управления ИТ-службами для выбранного сервера за указанный диапазон времени. При наличии текущих элементов на сервере отображается значок, а их список приводится в области службы поддержки компьютера.

![Область службы поддержки компьютера](media/monitoring-service-map/service-desk.png)

Чтобы открыть элемент в подключенном решении ITSM, щелкните **Просмотреть рабочий элемент**.

Чтобы просмотреть сведения об элементе в области "Поиск по журналам", щелкните **Показать в поиске по журналам**.


## <a name="change-tracking-integration"></a>Интеграция с решением для отслеживания изменений
Если решения "Сопоставление служб" и "Отслеживание изменений" включены и настроены в вашей рабочей области Log Analytics, то они интегрируются друг с другом автоматически.

В области **Отслеживание изменений на компьютере** содержится список всех изменений (начиная с последнего), а также ссылка на поиск по журналам для получения дополнительных сведений.

![Область отслеживания изменений на компьютере](media/monitoring-service-map/change-tracking.png)

Ниже приведен пример подробных сведений о событии ConfigurationChange, которые отображаются после выбора команды **Показать в Log Analytics**.

![Событие ConfigurationChange](media/monitoring-service-map/configuration-change-event.png)


## <a name="performance-integration"></a>Интеграция с решением для определения производительности
В области **производительности компьютера** приводятся стандартные метрики производительности для выбранного сервера. Сюда входят метрики использования ЦП, использования памяти, числа отправленных и полученных по сети байтов, а также список основных процессов, упорядоченный по числу байтов, отправленных и полученных по сети.

![Область производительности компьютера](media/monitoring-service-map/machine-performance.png)

Чтобы просмотреть данные о производительности, может потребоваться [включить соответствующие счетчики производительности Log Analytics](https://docs.microsoft.com/azure/log-analytics/log-analytics-data-sources-performance-counters).  Счетчики, которые потребуется включить:

Windows:
- Процессор(*)\\% загруженности процессора.
- Память\\% использования выделенной памяти.
- Сетевой адаптер(*)\\отправленных байтов/с.
- Сетевой адаптер(*)\\полученных байтов/с.

Linux:
- Процессор(*)\\% загруженности процессора.
- Память(*)\\% использованной памяти.
- Сетевой адаптер(*)\\отправленных байтов/с.
- Сетевой адаптер(*)\\полученных байтов/с.

Чтобы получить данные о производительности сети, необходимо включить решение Wire Data 2.0 в рабочей области.
 
## <a name="security-integration"></a>Интеграция решений для обеспечения безопасности
Если решения "Сопоставление служб" и "Безопасность и аудит" включены и настроены в вашей рабочей области Log Analytics, то они интегрируются друг с другом автоматически.

Панель **безопасности виртуальной машины** отображает данные из решения для безопасности и аудита для выбранного сервера. В этой области содержится сводка необработанных проблем безопасности для сервера за выбранный диапазон времени. Если щелкнуть проблему безопасности, будет выполнен поиск подробных сведений о ней в журналах.

![Область безопасности компьютера](media/monitoring-service-map/machine-security.png)


## <a name="updates-integration"></a>Интеграция с решением для управления обновлениями
Если решения "Сопоставление служб" и "Управление обновлениями" включены и настроены в вашей рабочей области Log Anlaytics, то они интегрируются друг с другом автоматически.

Панель **обновлений виртуальной машины** отображает данные из решения для управления обновлениями для выбранного сервера. В этой области содержится сводка по отсутствующим обновлениям для сервера за выбранный диапазон времени.

![Область отслеживания изменений на компьютере](media/monitoring-service-map/machine-updates.png)

## <a name="log-analytics-records"></a>Записи Log Analytics
Данные инвентаризации компьютеров и процессов из схемы услуги можно получить, выполнив [поиск](../log-analytics/log-analytics-log-searches.md) в Log Analytics. Эти данные используются в различных сценариях, таких как планирование миграции, анализ емкости, обнаружение и устранение проблем с производительностью по требованию.

Для каждого уникального компьютера и процесса создается одна запись в час. Кроме того, записи создаются во время запуска компьютера или процесса, а также при подключении их к схеме услуги. В таблице ниже приведены свойства этих записей. Поля и значения в событиях ServiceMapComputer_CL сопоставляются с полями ресурса Machine (Компьютер) в API ServiceMap Azure Resource Manager. Поля и значения в событиях ServiceMapProcess_CL сопоставляются с полями ресурса Process (Процесс) в API ServiceMap Azure Resource Manager. Поле ResourceName_s совпадает с полем имени в соответствующем ресурсе Resource Manager. 

>[!NOTE]
>По мере расширения функций схемы услуги эти поля могут изменяться.

На основе созданных в системе свойств можно определить уникальные компьютеры или процессы:

- Компьютер. Используйте свойство ResourceId или ResourceName_s для уникальной идентификации компьютера в рабочей области Log Analytics.
- Процесс. Используйте свойство ResourceId для уникальной идентификации процесса в рабочей области Log Analytics. Свойство ResourceName_s является уникальным для компьютера, на котором выполняется процесс (MachineResourceName_s). 

Так как для указанных процесса и компьютера в заданном диапазоне времени могут существовать несколько записей, то запросы могут возвращать несколько записей для одного и того же компьютера или процесса. Чтобы включить только самую последнюю запись, добавьте к запросу строку "| dedup ResourceId".

### <a name="servicemapcomputercl-records"></a>Записи ServiceMapComputer_CL
В записях типа *AdmComputer_CL* содержатся данные инвентаризации для серверов с агентами схемы услуги. У этих записей есть свойства, приведенные в таблице ниже.

| Свойство | ОПИСАНИЕ |
|:--|:--|
| type | *ServiceMapComputer_CL* |
| SourceSystem | *OpsManager* |
| ResourceId | Уникальный идентификатор для компьютера в рабочей области |
| ResourceName_s | Уникальный идентификатор для компьютера в рабочей области |
| ComputerName_s | Полное доменное имя компьютера |
| Ipv4Addresses_s | Список IPv4-адресов сервера |
| Ipv6Addresses_s | Список IPv6-адресов сервера |
| DnsNames_s | Массив DNS-имен |
| OperatingSystemFamily_s | Windows или Linux |
| OperatingSystemFullName_s | Полное имя операционной системы  |
| Bitness_s | Разрядность компьютера (32- или 64-разрядный)  |
| PhysicalMemory_d | Объем физической памяти в МБ |
| Cpus_d | Количество ЦП |
| CpuSpeed_d | Скорость ЦП в МГц|
| VirtualizationState_s | *неизвестно*, *физический*, *виртуальный*, *гипервизор* |
| VirtualMachineType_s | *hyperv*, *vmware* и т. д. |
| VirtualMachineNativeMachineId_g | Идентификатор виртуальной машины, назначенный ее гипервизором |
| VirtualMachineName_s | Имя виртуальной машины |
| BootTime_t | Время загрузки |



### <a name="servicemapprocesscl-type-records"></a>Записи типа ServiceMapProcess_CL
В записях типа *ServiceMapProcess_CL* содержатся данные инвентаризации для подключенных по протоколу TCP процессов на серверах с агентами схемы услуги. У этих записей есть свойства, приведенные в таблице ниже.

| Свойство | ОПИСАНИЕ |
|:--|:--|
| type | *ServiceMapProcess_CL* |
| SourceSystem | *OpsManager* |
| ResourceId | Уникальный идентификатор для процесса в рабочей области |
| ResourceName_s | Уникальный идентификатор для процесса на компьютере, на котором он выполняется|
| MachineResourceName_s | Имя ресурса компьютера |
| ExecutableName_s | Имя исполняемого файла процесса |
| StartTime_t | Время запуска пула процессов |
| FirstPid_d | Первый идентификатор процесса в пуле процессов |
| Description_s | Описание процесса |
| CompanyName_s | Название организации |
| InternalName_s | Внутреннее имя |
| ProductName_s | Имя продукта |
| ProductVersion_s | Версия продукта |
| FileVersion_s | Версия файла |
| CommandLine_s | Командная строка |
| ExecutablePath _s | Путь к исполняемому файлу |
| WorkingDirectory_s | Рабочий каталог |
| UserName | Учетная запись, с которой выполняется процесс |
| UserDomain | Домен, в котором выполняется процесс |


## <a name="sample-log-searches"></a>Пример поисков журналов

### <a name="list-all-known-machines"></a>Список всех известных компьютеров
ServiceMapComputer_CL | summarize arg_max(TimeGenerated, *) by ResourceId

### <a name="list-the-physical-memory-capacity-of-all-managed-computers"></a>Вывод сведений об объеме физической памяти для всех управляемых компьютеров
ServiceMapComputer_CL | summarize arg_max(TimeGenerated, *) by ResourceId | project PhysicalMemory_d, ComputerName_s

### <a name="list-computer-name-dns-ip-and-os"></a>Список сведений об имени компьютера, DNS-имени, IP-адресе и ОС
ServiceMapComputer_CL | summarize arg_max(TimeGenerated, *) by ResourceId | project ComputerName_s, OperatingSystemFullName_s, DnsNames_s, Ipv4Addresses_s

### <a name="find-all-processes-with-sql-in-the-command-line"></a>Поиск всех процессов с sql в командной строке
ServiceMapProcess_CL | where CommandLine_s contains_cs "sql" | summarize arg_max(TimeGenerated, *) by ResourceId

### <a name="find-a-machine-most-recent-record-by-resource-name"></a>Поиск компьютера (самой последней записи) по имени ресурса
search in (ServiceMapComputer_CL) "m-4b9c93f9-bc37-46df-b43c-899ba829e07b" | summarize arg_max(TimeGenerated, *) by ResourceId

### <a name="find-a-machine-most-recent-record-by-ip-address"></a>Поиск компьютера (самой последней записи) по IP-адресу
search in (ServiceMapComputer_CL) "10.229.243.232" | summarize arg_max(TimeGenerated, *) by ResourceId

### <a name="list-all-known-processes-on-a-specified-machine"></a>Вывод списка всех известных процессов на определенном компьютере
ServiceMapProcess_CL | where MachineResourceName_s == "m-559dbcd8-3130-454d-8d1d-f624e57961bc" | summarize arg_max(TimeGenerated, *) by ResourceId

### <a name="list-all-computers-running-sql"></a>Вывод списка всех компьютеров, на которых выполняется SQL
ServiceMapComputer_CL | where ResourceName_s in ((search in (ServiceMapProcess_CL) "\*sql\*" | distinct MachineResourceName_s)) | distinct ComputerName_s

### <a name="list-all-unique-product-versions-of-curl-in-my-datacenter"></a>Вывод списка всех уникальных версий продукта cURL в центре обработки данных
ServiceMapProcess_CL | where ExecutableName_s == "curl" | distinct ProductVersion_s

### <a name="create-a-computer-group-of-all-computers-running-centos"></a>Создание группы, объединяющей все компьютеры, на которых выполняется CentOS
ServiceMapComputer_CL | where OperatingSystemFullName_s contains_cs "CentOS" | distinct ComputerName_s


## <a name="rest-api"></a>ИНТЕРФЕЙС REST API
Все данные серверов, процессов и зависимостей в сопоставлении служб доступны через [REST API сопоставления служб](https://docs.microsoft.com/rest/api/servicemap/).


## <a name="diagnostic-and-usage-data"></a>Данные диагностики и использования
Корпорация Майкрософт автоматически собирает данные об использовании и производительности с помощью службы схемы услуги. Эти данные используются, чтобы улучшить качество, повысить безопасность и целостность службы схемы услуги. Чтобы предоставить возможности для точного и эффективного устранения неполадок, они включают в себя сведения о конфигурации программного обеспечения, такие как версия операционной системы, а также IP-адрес, DNS-имя и имя рабочей станции. Корпорация Майкрософт не собирает сведения об именах, адресах и другую контактную информацию.

Дополнительные сведения о сборе и использовании данных см. в [заявлении о конфиденциальности служб Microsoft Online Services](https://go.microsoft.com/fwlink/?LinkId=512132).


## <a name="next-steps"></a>Дополнительная информация
Узнайте больше о [поиске по журналам](../log-analytics/log-analytics-log-searches.md) в Log Analytics для получения данных, собранных с помощью схемы услуги.


## <a name="troubleshooting"></a>Устранение неполадок
См. раздел об [устранении неполадок в документе по настройке схемы услуги]( monitoring-service-map-configure.md#troubleshooting).


## <a name="feedback"></a>Отзыв
У вас есть комментарии относительно схемы услуги или этой документации?  Посетите нашу страницу [User Voice](https://feedback.azure.com/forums/267889-log-analytics/category/184492-service-map), где можно предложить функции или проголосовать за существующие предложения.
