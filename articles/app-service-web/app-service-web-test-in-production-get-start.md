<properties
	pageTitle="Введение в тестирование веб-приложений в рабочей среде"
	description="Дополнительные сведения о тестировании веб-приложений службы приложений Azure в рабочей среде."
	services="app-service\web"
	documentationCenter=""
	authors="cephalin"
	manager="wpickett"
	editor=""/>

<tags
	ms.service="app-service-web"
	ms.workload="web"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="01/13/2016"
	ms.author="cephalin"/>

# Введение в тестирование веб-приложений в рабочей среде

Тестирование в рабочей среде или тестирование веб-приложения с использованием текущего пользовательского трафика является популярной стратегией тестирования, которую разработчики приложений широко интегрируют в методологию [гибкой разработки](https://en.wikipedia.org/wiki/Agile_software_development). Эта стратегия позволяет выполнять проверку качества приложений с использованием текущего пользовательского трафика в рабочей среде — в отличие от использования синтезированных данных в тестовой среде. Предоставляя новое приложение реальным пользователям, вы можете получать сведения о реальных проблемах, которые могут возникнуть после развертывания приложения. Вы можете проверить функциональность, производительность и объем обновлений на основе данных об объеме, скорости и отличиях в показателях текущего пользовательского трафика. Иными словами, выполнить то, что не позволяет сделать тестовая среда.

## Маршрутизация трафика в веб-приложениях службы приложений

С помощью функции маршрутизации трафика [службы приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714) вы можете перенаправить часть реального пользовательского трафика в один или несколько [слотов развертывания](web-sites-staged-publishing.md), а затем проанализировать приложения с помощью [Azure Application Insights](/services/application-insights/) или [Azure HDInsight](/services/hdinsight/), или средства сторонних производителей, например [New Relic](/marketplace/partners/newrelic/newrelic/), чтобы проверить внесенные изменения. Например, вы можете реализовать следующие сценарии со службой приложений.

- Обнаружение функциональных ошибок или выявление ограничивающих факторов производительности в обновлениях перед развертыванием компонентов на уровне сайта.
- Выполнение управляемого фокус-тестирования изменений путем измерения метрик удобства использования в бета-версии приложения.
- Постепенное разворачивание нового обновления и корректный откат к текущей версии при возникновении ошибок. 
- Оптимизация результатов бизнес-приложения путем выполнения [альфа- и бета-тестирования](https://en.wikipedia.org/wiki/A/B_testing) или [многовариантного тестирования](https://en.wikipedia.org/wiki/Multivariate_testing_in_marketing) в нескольких слотах развертывания.

### Требования для использования маршрутизации трафика в веб-приложениях

- Веб-приложение должно выполняться в категории **Стандартный** или **Премиум**, так как это требуется для нескольких слотов развертывания.
- Для правильной маршрутизации трафика в браузере пользователей должны быть включены файлы cookie. Маршрутизация трафика использует файлы cookie, чтобы привязать клиентский браузер к слоту развертывания на время клиентского сеанса.
- Маршрутизация трафика поддерживает расширенные сценарии тестирования в рабочей среде с использованием командлетов Azure PowerShell.

## Маршрутизация сегмента трафика в слот развертывания

На базовом уровне каждый сценарий тестирования в рабочей среде предполагает маршрутизацию предопределенного процента текущего трафика в нерабочий слот развертывания. Для этого сделайте следующее.

>[AZURE.NOTE] В этих инструкциях предполагается, что у вас уже есть [нерабочая область развертывания](web-sites-staged-publishing.md), а также что нужное содержимое уже [развернуто](web-sites-publish-source-control.md) в веб-приложении.

1. Войдите на [портал Azure](https://portal.azure.com/).
2. В колонке веб-приложения щелкните элементы **Параметры** > **Маршрутизация трафика**. ![](./media/app-service-web-test-in-production/01-traffic-routing.png)
3. Выберите слот для перенаправления трафика и укажите требуемый процент от общего трафика, а затем нажмите кнопку **Сохранить**.

	![](./media/app-service-web-test-in-production/02-select-slot.png)

4. Перейдите в колонку слота развертывания и вы увидите, что текущий трафик перенаправляется в него.

	![](./media/app-service-web-test-in-production/03-traffic-routed.png)

После настройки маршрутизации трафика указанный процент клиентов будет случайным образом перенаправляться в нерабочий слот. При этом следует отметить, что автоматическая маршрутизация клиента в конкретный слот означает его привязку к этому слоту в течение данного клиентского сеанса. Это реализуется с помощью файлов cookie. При проверке HTTP-запросов вы обнаружите файл cookie `TipMix` в каждом последующем запросе.

![](./media/app-service-web-test-in-production/04-tip-cookie.png)

## Принудительная отправка клиентских запросов в конкретный слот

Кроме автоматизации маршрутизации трафика служба приложений может перенаправлять запросы в конкретные слоты. Это полезно, если вы хотите предоставить пользователям возможность согласиться или отказаться от использования бета-версии приложения. Это можно сделать с помощью параметра запросов `x-ms-routing-name`.

Чтобы перенаправить пользователей в конкретный слот с помощью `x-ms-routing-name`, проверьте, добавлен ли этот слот в список маршрутизации трафика. Так как вам требуется явная маршрутизация в слот, фактический процент маршрутизации, который вы укажете, не имеет значения. При необходимости можно создать бета-версию ссылки, которую пользователь сможет использовать для доступа к бета-версии приложения.

![](./media/app-service-web-test-in-production/06-enable-x-ms-routing-name.png)

### Отказ пользователей от использования бета-версии приложения

Чтобы пользователи могли отказаться от использования бета-версии приложения, можно поместить эту ссылку на своей веб-странице:

    <a href="<webappname>.azurewebsites.net/?x-ms-routing-name=self">Go back to production app</a>

Строка `x-ms-routing-name=self` определяет рабочий слот. Когда браузер клиента получает доступ к ссылке, он не только перенаправляется в рабочий слот. Каждый последующий запрос будет содержать файл cookie `x-ms-routing-name=self`, который связывает данный сеанс с рабочим слотом.

![](./media/app-service-web-test-in-production/05-access-production-slot.png)

### Согласие пользователей на использование бета-версии приложения

Чтобы пользователи могли согласиться использовать бета-версию приложения, укажите для имени нерабочей области один параметр запроса, например:

		<webappname>.azurewebsites.net/?x-ms-routing-name=staging

## Дополнительные ресурсы ##

-   [Настройка промежуточных сред для веб-приложений в службе приложений Azure](web-sites-staged-publishing.md)
-	[Предсказуемое развертывание сложного приложения в Azure](app-service-deploy-complex-application-predictably.md)
-   [Гибкая разработка программного обеспечения с помощью службы приложений Azure.](app-service-agile-software-development.md)
-	[Эффективное использование сред разработки и операций для веб-приложений](app-service-web-staged-publishing-realworld-scenarios.md)

<!---HONumber=AcomDC_0128_2016-->