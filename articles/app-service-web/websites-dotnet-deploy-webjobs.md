---
title: "Развертывание веб-заданий с помощью Visual Studio"
description: "Узнайте, как развернуть веб-задания Azure в веб-приложениях службы приложений Azure с помощью Visual Studio."
services: app-service
documentationcenter: 
author: tdykstra
manager: erikre
editor: jimbe
ms.assetid: a3a9d320-1201-4ac8-9398-b4c9535ba755
ms.service: app-service
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/27/2016
ms.author: tdykstra
translationtype: Human Translation
ms.sourcegitcommit: fcbd9e10e4cc336dc6ea37f84201249e14b1af91
ms.openlocfilehash: 9f792f6ea082461f3304516fc9b4c3273e2f50b8
ms.lasthandoff: 02/16/2017


---
# <a name="deploy-webjobs-using-visual-studio"></a>Развертывание веб-заданий с помощью Visual Studio
## <a name="overview"></a>Обзор
В этом разделе объясняется, как использовать Visual Studio для развертывания проекта консольного приложения в веб-приложении [службы приложений](http://go.microsoft.com/fwlink/?LinkId=529714) в качестве [веб-задания Azure](http://go.microsoft.com/fwlink/?LinkId=390226). Дополнительную информацию о развертывании веб-заданий с помощью [портала Azure](https://portal.azure.com) см. в разделе [Выполнение фоновых задач с помощью веб-заданий](web-sites-create-web-jobs.md).

При развертывании в Visual Studio проекта консольного приложения с поддержкой веб-заданий выполняются две задачи.

* Копирование файлов среды выполнения в соответствующую папку в веб-приложении (*App_Data/jobs/continuous* для постоянных веб-заданий, *App_Data/jobs/triggered* для запланированных веб-заданий и веб-заданий по запросу).
* Указание [заданий планировщика Azure](#scheduler) для веб-заданий, которые запланированы на выполнение в определенное время. (Это не требуется для постоянных веб-заданий.)

Проект с поддержкой веб-заданий содержит следующие добавленные элементы.

* Пакет NuGet [Microsoft.Web.WebJobs.Publish](http://www.nuget.org/packages/Microsoft.Web.WebJobs.Publish/) .
* Файл [webjob-publish-settings.json](#publishsettings) , который содержит параметры развертывания и планировщика. 

![Диаграмма, отображающая добавленные элементы в приложение консоли для реализации развертывания как веб-задания](./media/websites-dotnet-deploy-webjobs/convert.png)

Вы можете добавить эти элементы в существующий проект приложения консоли или использовать шаблон для создания нового проекта приложения консоли с поддержкой веб-заданий. 

Можно развернуть проект как веб-задание или связать его с веб-проектом для автоматического развертывания при каждом развертывании веб-проекта. Чтобы связать проекты, Visual Studio включает имя проекта с поддержкой веб-заданий в файле [webjobs-list.json](#webjobslist) веб-проекта.

![Диаграмма, отображающая проект веб-задания, связанный с веб-проектом](./media/websites-dotnet-deploy-webjobs/link.png)

## <a name="prerequisites"></a>Предварительные требования
Функции развертывания веб-заданий доступны в Visual Studio 2015 при установке пакета SDK Azure для .Net:

* [Пакет SDK Azure для .NET (Visual Studio 2015)](http://go.microsoft.com/fwlink/?linkid=518003)

## <a name="a-idconvertaenable-webjobs-deployment-for-an-existing-console-application-project"></a><a id="convert"></a>Включение развертывания веб-заданий для существующего проекта консольного приложения
Существует два варианта.

* [Включение автоматического развертывания с веб-проектом](#convertlink).
  
    Настройка существующего проекта приложения консоли для автоматического развертывания в качестве веб-приложения при развертывании веб-проекта. Используйте этот параметр, если нужно запустить веб-задание в том же веб-приложении, в котором запущено связанное веб-приложение.
* [Включение развертывания без веб-проекта](#convertnolink).
  
    Настройка существующего проекта приложения консоли для развертывания в качестве веб-задания без ссылки на веб-проект. Используйте этот параметр, если нужно запустить веб-задание в веб-приложении самостоятельно, без веб-приложения, запущенного в веб-приложении. Это может понадобиться для независимого масштабирования ресурсов веб-заданий ресурсов веб-приложений.

### <a name="a-idconvertlinka-enable-automatic-webjobs-deployment-with-a-web-project"></a><a id="convertlink"></a> Включение автоматического развертывания веб-заданий с помощью веб-проекта
1. Щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Добавить** > **Существующий проект как веб-задание Azure**.
   
    ![Существующий проект как веб-задание Azure](./media/websites-dotnet-deploy-webjobs/eawj.png)
   
    Откроется диалоговое окно [Добавление веб-задания Azure](#configure) .
2. В раскрывающемся списке **Имя проекта** выберите проект приложения консоли для добавления в качестве веб-задания.
   
    ![Выбор проекта в диалоговом окне "Добавление веб-задания Azure"](./media/websites-dotnet-deploy-webjobs/aaw1.png)
3. Заполните диалоговое окно [Добавление веб-задания Azure](#configure) и щелкните кнопку **ОК**. 

### <a name="a-idconvertnolinka-enable-webjobs-deployment-without-a-web-project"></a><a id="convertnolink"></a> Включение развертывания веб-заданий без веб-проекта
1. Щелкните правой кнопкой мыши проект консольного приложения в **обозревателе решений** и выберите **Опубликовать как веб-задание Azure**. 
   
    ![Опубликовать как веб-задание Azure](./media/websites-dotnet-deploy-webjobs/paw.png)
   
    Появится диалоговое окно [Добавление веб-задания Azure](#configure) с проектом, выбранным в поле **Имя проекта** .
2. Заполните диалоговое окно [Добавление веб-задания Azure](#configure) и щелкните кнопку **ОК**.
   
   Откроется мастер **веб-публикации** .  Если вы не хотите сразу выполнить публикацию, закройте мастер. Указанные параметры сохраняются до момента [развертывания проекта](#deploy).

## <a name="a-idcreateacreate-a-new-webjobs-enabled-project"></a><a id="create"></a>Создание нового проекта с поддержкой веб-заданий
Чтобы создать проект с поддержкой веб-заданий, можно использовать шаблон проекта приложения консоли и включить развертывание веб-заданий, как показано в [предыдущем разделе](#convert). В качестве альтернативы можно использовать шаблон создания проекта с поддержкой веб-заданий:

* [Использование шаблона создания проекта веб-заданий для отдельного веб-задания](#createnolink)
  
    Создайте проект и настройте его для развертывания в качестве веб-задания без ссылки на веб-проект. Используйте этот параметр, если нужно запустить веб-задание в веб-приложении самостоятельно, без веб-приложения, запущенного в веб-приложении. Это может понадобиться для независимого масштабирования ресурсов веб-заданий ресурсов веб-приложений.
* [Использование шаблона создания проекта с поддержкой веб-заданий для веб-задания, связанного с веб-проектом](#createlink)
  
    Создайте проект, настроенный для автоматического развертывания, как веб-задание при развертывании веб-проекта в том же решении. Используйте этот параметр, если нужно запустить веб-задание в том же веб-приложении, в котором запущено связанное веб-приложение.

> [!NOTE]
> Шаблон нового проекта веб-задания автоматически устанавливает пакеты NuGet и включает в файл *Program.cs* код для [пакета SDK веб-заданий](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/getting-started-with-windows-azure-webjobs). Если вы не хотите использовать пакет SDK веб-заданий или предпочитаете использовать веб-задания по расписанию, а не непрерывные веб-задания, удалите или измените инструкцию `host.RunAndBlock` в файле *Program.cs*.
> 
> 

### <a name="a-idcreatenolinka-use-the-webjobs-new-project-template-for-an-independent-webjob"></a><a id="createnolink"></a> Использование шаблона создания проекта веб-заданий для отдельного веб-задания
1. Щелкните **Файл** > **Создать проект**, а затем в диалоговом окне **Новый проект** выберите **Облако** > **Веб-задание Microsoft Azure**.
   
    ![Диалоговое окно "Новый проект", отображающее шаблон веб-заданий](./media/websites-dotnet-deploy-webjobs/np.png)
2. Следуйте инструкциям, показанным ранее, чтобы [сделать проект приложения консоли независимым проектом веб-заданий](#convertnolink).

### <a name="a-idcreatelinka-use-the-webjobs-new-project-template-for-a-webjob-linked-to-a-web-project"></a><a id="createlink"></a> Использование шаблона создания проекта с поддержкой веб-заданий для веб-задания, связанного с веб-проектом
1. Щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Добавить** > **Новый проект веб-задания Azure**.
   
    ![Запись меню "Новый проект веб-задания Azure"](./media/websites-dotnet-deploy-webjobs/nawj.png)
   
    Откроется диалоговое окно [Добавление веб-задания Azure](#configure) .
2. Заполните диалоговое окно [Добавление веб-задания Azure](#configure) и щелкните кнопку **ОК**.

## <a name="a-idconfigureathe-add-azure-webjob-dialog"></a><a id="configure"></a>Диалоговое окно "Добавление веб-заданий Azure"
Диалоговое окно **Добавление веб-заданий Azure** позволяет ввести имя веб-задания и параметры планирования для веб-задания. 

![Диалоговое окно "Добавление веб-заданий Azure"](./media/websites-dotnet-deploy-webjobs/aaw2.png)

Поля в этом диалоговом окне соответствуют полям в диалоговом окне **Новое задание** портала Azure. Дополнительные сведения см. в разделе [Выполнение фоновых задач с помощью веб-заданий](web-sites-create-web-jobs.md).

Для запланированного веб-задания (не для постоянных веб-заданий) Visual Studio создает коллекцию заданий [планировщика Azure](/services/scheduler/) , если она не существует, и создает задание в коллекции.

* Коллекция заданий планировщика называется *WebJobs-{имя_региона}*, где *{имя_региона}* — регион, в котором размещено веб-приложение. Например, WebJobs-WestUS.
* Задание планировщика называется *{webappname}-{webjobname}*. Например, MyWebApp-MyWebJob. 

> [!NOTE]
> * Дополнительные сведения о развертывании из командной строки см. в разделе [Включение предоставления веб-заданий Azure из командной строки или постоянно](https://azure.microsoft.com/blog/2014/08/18/enabling-command-line-or-continuous-delivery-of-azure-webjobs/).
> * Если вы настраиваете **повторяющееся задание** и задаете частоту повторений в минутах, за использование службы планировщика Azure будет взиматься плата. Частота в часах, днях и т. д. бесплатна.
> * Если после развертывания веб-задания принимается решение о необходимости изменить его тип и развернуть веб-задание повторно, нужно будет удалить файл webjobs-publish-settings.json. При этом Visual Studio снова покажет параметры публикации и можно будет изменить тип веб-задания.
> * Если вы развертываете веб-задание, а затем изменяете режим выполнения с постоянного на непостоянный или наоборот, Visual Studio создаст новое веб-задание в Azure при повторном развертывании. При изменении других параметров планирования но сохранении режима выполнения или при переключении между режимами "Запланировано" и "По запросу" Visual Studio обновляет существующее задание, а не создает новое.
> 
> 

## <a name="a-idpublishsettingsawebjob-publish-settingsjson"></a><a id="publishsettings"></a>webjob-publish-settings.json
При настройке консольного приложения для развертывания веб-заданий Visual Studio устанавливает пакет NuGet [Microsoft.Web.WebJobs.Publish](http://www.nuget.org/packages/Microsoft.Web.WebJobs.Publish/) и сохраняет сведения о планировании в файле *webjob-publish-settings.json* в папке *Properties* проекта веб-заданий. Вот пример этого файла:

        {
          "$schema": "http://schemastore.org/schemas/json/webjob-publish-settings.json",
          "webJobName": "WebJob1",
          "startTime": "2014-06-23T00:00:00-08:00",
          "endTime": "2014-06-27T00:00:00-08:00",
          "jobRecurrenceFrequency": "Minute",
          "interval": 5,
          "runMode": "Scheduled"
        }

Вы можете изменить этот файл напрямую, и Visual Studio предоставит IntelliSense. Схема файла сохранена на сайте [http://schemastore.org](http://schemastore.org/schemas/json/webjob-publish-settings.json) , и ее можно просмотреть здесь.  

> [!NOTE]
> * Если вы настраиваете **повторяющееся задание** и задаете частоту повторений в минутах, за использование службы планировщика Azure будет взиматься плата. Частота в часах, днях и т. д. бесплатна.
> 
> 

## <a name="a-idwebjobslistawebjobs-listjson"></a><a id="webjobslist"></a>webjobs-list.json
При связывании проекта с поддержкой веб-заданий с веб-проектом Visual Studio сохраняет имя проекта веб-заданий в файле *webjobs-list.json* в папке веб-проекта *Properties*. Список может содержать несколько проектов веб-заданий, как показано в следующем примере:

        {
          "$schema": "http://schemastore.org/schemas/json/webjobs-list.json",
          "WebJobs": [
            {
              "filePath": "../ConsoleApplication1/ConsoleApplication1.csproj"
            },
            {
              "filePath": "../WebJob1/WebJob1.csproj"
            }
          ]
        }

Вы можете изменить этот файл напрямую, и Visual Studio предоставит IntelliSense. Схема файла сохранена на сайте [http://schemastore.org](http://schemastore.org/schemas/json/webjobs-list.json) , и ее можно просмотреть здесь.

## <a name="a-iddeployadeploy-a-webjobs-project"></a><a id="deploy"></a>Развертывание проекта веб-заданий
Проект веб-заданий, связанный с веб-проектом, развертывается автоматически с веб-проектом. Информацию о развертывании веб-проектов см. в разделе [Развертывание приложения в службе приложений Azure](web-sites-deploy.md).

Чтобы развернуть проект веб-заданий, щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Опубликовать как веб-задание Azure**. 

![Опубликовать как веб-задание Azure](./media/websites-dotnet-deploy-webjobs/paw.png)

Для независимого веб-задания отобразится тот же мастер **веб-публикации** , который использовался для веб-проектов, но некоторые параметры будут недоступны для изменения.

## <a name="a-idnextstepsanext-steps"></a><a id="nextsteps"></a>Дальнейшие действия
В этой статье показано, как развернуть WebJob с помощью Visual Studio. Дополнительные сведения о развертывании веб-заданий Azure см. в статье [Документация по веб-заданиям Azure](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/azure-webjobs-recommended-resources#deploying).


