---
title: Как настроить георепликацию для кэша Redis для Azure | Документация Майкрософт
description: Узнайте, как реплицировать экземпляры кэша Redis для Azure между географическими регионами.
services: redis-cache
documentationcenter: ''
author: wesmc7777
manager: cfowler
editor: ''
ms.assetid: 375643dc-dbac-4bab-8004-d9ae9570440d
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 09/15/2017
ms.author: wesmc
ms.openlocfilehash: 883683f6af7943fa4da49095c9a15aefd5cfa719
ms.sourcegitcommit: 2a70752d0987585d480f374c3e2dba0cd5097880
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/19/2018
ms.locfileid: "27911376"
---
# <a name="how-to-configure-geo-replication-for-azure-redis-cache"></a>Как настроить георепликацию для кэша Redis для Azure

Георепликация предоставляет механизм связывания двух экземпляров кэша Redis для Azure уровня "Премиум". Один кэш используется в качестве основного связанного кэша, а другой — как дополнительный связанный кэш. Дополнительный связанный кэш становится доступным только для чтения, и в него реплицируются данные, записанные в основной кэш. Эту функцию можно использовать для репликации кэша в разные регионы Azure. Эта статья содержит руководство по настройке георепликации для экземпляров кэша Redis для Azure уровня "Премиум".

## <a name="geo-replication-prerequisites"></a>Предварительные требования георепликации

Чтобы настроить георепликацию между двумя кэшами, должны выполняться следующие предварительные требования:

- Оба кэша должны относиться к [уровню "Премиум"](cache-premium-tier-intro.md).
- Оба кэша должны относиться к одной подписке Azure.
- Дополнительный связанный кэш должен относиться к той же ценовой категорий, что и основной связанный кэш, или к более высокой категории.
- Если для основного связанного кэша включена кластеризация, то и на дополнительном связанном кэше должна быть включена кластеризация с тем же количеством сегментов, что и на основном.
- Оба кэша должны быть созданы и находиться в состоянии выполнения.
- Сохраняемость не должна быть включена ни на одном из кэшей.
- Георепликация между кэшами в одной виртуальной сети поддерживается. Георепликация между кэшами в разных виртуальных сетях также поддерживается, при условии, что две виртуальные сети настроены таким образом, что ресурсы в этих сетях будут доступны друг другу через TCP-подключения.

После настройки георепликации в отношении вашей пары связанных кэшей применяются следующие ограничения:

- Дополнительный связанный кэш доступен только для чтения, то есть из него можно считывать данные, но нельзя записать данные в него. 
- Любые данные, которые были в дополнительном связанном кэше до добавления связи, удаляются. Однако, если георепликация впоследствии удаляется, то реплицированные данные остаются в дополнительном связанном кэше.
- Если в кэше включена кластеризация, то ни на одном из кэшей вы не сможете инициировать [операцию масштабирования](cache-how-to-scale.md) или [изменить количество сегментов](cache-how-to-premium-clustering.md).
- Ни на одном из кэше не удастся включить сохраняемость.
- С любым из кэшей можно использовать функцию [экспорта](cache-how-to-import-export-data.md#export), но [импорт](cache-how-to-import-export-data.md#import) возможен только в основной связанный кэш.
- Невозможно удалить ни один из связанных кэшей или группу ресурсов, в которую они входят, пока не удалена связь георепликации. Дополнительные сведения см. в разделе [Почему произошел сбой операции, когда я попытался удалить связанный кэш?](#why-did-the-operation-fail-when-i-tried-to-delete-my-linked-cache)
- Если два кэша находятся в разных регионах, то расходы на исходящие данные сети будет применяться к данным, реплицируемым между регионами в дополнительный связанный кэш. Дополнительные сведения см. в разделе [Сколько стоит реплицировать мои данные между регионами Azure?](#how-much-does-it-cost-to-replicate-my-data-across-azure-regions)
- В случае сбоя основного кэша (и его реплики) автоматический переход на дополнительный связанный кэш не выполняется. Чтобы выполнить отработку отказа клиентских приложений потребуется вручную удалить связь георепликации и направить клиентские приложения на кэш, который ранее был дополнительным связанным кэшем. Дополнительные сведения см. в разделе [Как выполнить отработку отказа в дополнительный связанный кэш?](#how-does-failing-over-to-the-secondary-linked-cache-work)

## <a name="add-a-geo-replication-link"></a>Добавление связи георепликации

1. Чтобы связать для георепликации два кэша уровня "Премиум", в меню ресурсов кэша, предназначенного для использования в качестве основного связанного кэша, щелкните **Георепликация**, а затем в колонке **Георепликация** щелкните **Add cache replication link** (Добавить связь репликации кэша).

    ![Добавление связи](./media/cache-how-to-geo-replication/cache-geo-location-menu.png)

2. В списке **Compatible caches** (Совместимые кэши) щелкните имя кэша, который необходимо использовать в качестве дополнительного кэша. Если необходимый вам кэш не отображается в списке, то проверьте, выполняются ли для этого дополнительного кэша [предварительные требования георепликации](#geo-replication-prerequisites). Чтобы отфильтровать кэши по региону, щелкните нужный регион на карте. В результате в списке **Compatible caches** (Совместимые кэши) отобразятся только кэши выбранного региона.

    ![Кэши, совместимые с георепликацией](./media/cache-how-to-geo-replication/cache-geo-location-select-link.png)
    
    Для инициирования процесса связывания или просмотра сведений о дополнительном кэше можно также использовать контекстное меню.

    ![Контекстное меню георепликации](./media/cache-how-to-geo-replication/cache-geo-location-select-link-context-menu.png)

3. Чтобы связывать два кэша друг с другом и начать процесс репликации, нажмите кнопку **Связь**.

    ![Связывание кэшей](./media/cache-how-to-geo-replication/cache-geo-location-confirm-link.png)

4. Ход выполнения процесса репликации можно просмотреть в колонке **Георепликация**.

    ![Состояние связывания](./media/cache-how-to-geo-replication/cache-geo-location-linking.png)

    Состояние связывания также можно просмотреть в колонке **Обзор** как для основного кэша, так и для дополнительного.

    ![Состояние кэша](./media/cache-how-to-geo-replication/cache-geo-location-link-status.png)

    По завершении процесса репликации **Состояние связи** изменится на **Успешно**.

    ![Состояние кэша](./media/cache-how-to-geo-replication/cache-geo-location-link-successful.png)

    В процессе связывания основной связанный кэш остается доступным для использования, а дополнительный связанный кэш недоступен, пока не завершится процесс связывания.

## <a name="remove-a-geo-replication-link"></a>Удаление связи георепликации

1. Чтобы удалить связь между двумя кэшами и приостановить георепликацию, щелкните **Unlink caches** (Удалить связь кэшей) в колонке **Георепликация**.
    
    ![Удаление связи кэшей](./media/cache-how-to-geo-replication/cache-geo-location-unlink.png)

    По завершения процесса удаления связи дополнительный кэш станет доступным как для чтения, так и для записи.

>[!NOTE]
>Когда удаляется связь георепликации, реплицированные данные из основного связанного кэша остаются в дополнительном кэше.
>
>

## <a name="geo-replication-faq"></a>Часто задаваемые вопросы по георепликации

- [Можно ли использовать георепликацию с кэшем уровня "Стандартный" или "Базовый"?](#can-i-use-geo-replication-with-a-standard-or-basic-tier-cache)
- [Можно ли использовать кэш во время связывания или удаления связи?](#is-my-cache-available-for-use-during-the-linking-or-unlinking-process)
- [Можно ли связать больше двух кэшей?](#can-i-link-more-than-two-caches-together)
- [Можно ли связать два кэша из разных подписок Azure?](#can-i-link-two-caches-from-different-azure-subscriptions)
- [Можно ли связать два кэша с разными размерами?](#can-i-link-two-caches-with-different-sizes)
- [Можно ли использовать георепликацию при включенной кластеризации?](#can-i-use-geo-replication-with-clustering-enabled)
- [Можно ли использовать георепликацию, если кэши находятся в виртуальной сети?](#can-i-use-geo-replication-with-my-caches-in-a-vnet)
- [Что такое расписание репликации для георепликации Redis?](#what-is-the-replication-schedule-for-redis-geo-replication)
- [Сколько времени занимает георепликация?](#how-long-does-geo-replication-replication-take)
- [Гарантируется ли точка восстановления репликации?](#is-the-replication-recovery-point-guaranteed)
- [Можно ли использовать PowerShell или Azure CLI для управления георепликацией?](#can-i-use-powershell-or-azure-cli-to-manage-geo-replication)
- [Сколько стоит реплицировать мои данные между регионами Azure?](#how-much-does-it-cost-to-replicate-my-data-across-azure-regions)
- [Почему произошел сбой операции, когда я попытался удалить связанный кэш?](#why-did-the-operation-fail-when-i-tried-to-delete-my-linked-cache)
- [Какой регион лучше использовать для дополнительного связанного кэша?](#what-region-should-i-use-for-my-secondary-linked-cache)
- [Как выполнить отработку отказа в дополнительный связанный кэш?](#how-does-failing-over-to-the-secondary-linked-cache-work)

### <a name="can-i-use-geo-replication-with-a-standard-or-basic-tier-cache"></a>Можно ли использовать георепликацию с кэшем уровня "Стандартный" или "Базовый"?

Нет. Георепликация доступна только для кэшей категории "Премиум".

### <a name="is-my-cache-available-for-use-during-the-linking-or-unlinking-process"></a>Можно ли использовать кэш во время связывания или удаления связи?

- Во время связывания двух кэшей для георепликации основной связанный кэш остается доступным для использования, а дополнительный связанный кэш недоступен, пока не завершится процесс связывания.
- При удалении связи георепликации между двумя кэшами оба кэша остаются доступными для использования.

### <a name="can-i-link-more-than-two-caches-together"></a>Можно ли связать больше двух кэшей?

Нет. При использовании георепликации можно связать друг с другом только два кэша.

### <a name="can-i-link-two-caches-from-different-azure-subscriptions"></a>Можно ли связать два кэша из разных подписок Azure?

Нет. Оба кэша должны относиться к одной подписке Azure.

### <a name="can-i-link-two-caches-with-different-sizes"></a>Можно ли связать два кэша с разными размерами?

Да, если размер дополнительного связанного кэша больше размера основного связанного кэша.

### <a name="can-i-use-geo-replication-with-clustering-enabled"></a>Можно ли использовать георепликацию при включенной кластеризации?

Да, если оба кэша имеют одинаковое число сегментов.

### <a name="can-i-use-geo-replication-with-my-caches-in-a-vnet"></a>Можно ли использовать георепликацию, если кэши находятся в виртуальной сети?

Да. Георепликация кэшей в виртуальных сетях поддерживается. 

- Георепликация между кэшами в одной виртуальной сети поддерживается.
- Георепликация между кэшами в разных виртуальных сетях также поддерживается, при условии, что две виртуальные сети настроены таким образом, что ресурсы в этих сетях будут доступны друг другу через TCP-подключения.

### <a name="what-is-the-replication-schedule-for-redis-geo-replication"></a>Что такое расписание репликации для георепликации Redis?

Репликация не происходит по заданному расписанию, она осуществляется непрерывно и асинхронно, т. е. все операции записи на сервер-источник мгновенно асинхронно реплицируются на сервер-получатель.

### <a name="how-long-does-geo-replication-replication-take"></a>Сколько времени занимает георепликация?

Репликация является добавочной, асинхронной и непрерывной, и затрачиваемое на нее время обычно не сильно отличается от задержки в сети между регионами. При определенных условиях в некоторые моменты времени серверу-получателю может потребоваться выполнить полную синхронизацию данных с сервером-источником. В этом случае время репликации зависит от ряда факторов, в том числе от нагрузки на кэш сервера-источника, доступной пропускной способности на компьютере кэша, задержки внутри региона и т. д. Например, проведя некоторые тесты, мы обнаружили, что время репликации полной геореплицируемой пары с объемом данных в 53 ГБ в регионах "Восточная часть США" и "Западная часть США" может занимать от 5 до 10 минут.

### <a name="is-the-replication-recovery-point-guaranteed"></a>Гарантируется ли точка восстановления репликации?

В настоящее время для кэшей в режиме георепликации функции сохраняемости и импорта и экспорта не поддерживаются. Поэтому в случае, если клиент инициировал отработку отказа, или в случаях, когда связь репликации между геореплицируемой парой была разорвана, сервер-получатель сохранит данные, находящиеся в памяти, которые он синхронизировал с сервером-источником до этого момента времени. В таких ситуациях гарантия точки восстановления не предоставляются.

### <a name="can-i-use-powershell-or-azure-cli-to-manage-geo-replication"></a>Можно ли использовать PowerShell или Azure CLI для управления георепликацией?

В настоящее время управление георепликацией доступно только на портале Azure.

### <a name="how-much-does-it-cost-to-replicate-my-data-across-azure-regions"></a>Сколько стоит реплицировать мои данные между регионами Azure?

При использовании георепликации данные из основного связанного кэша реплицируются в дополнительный связанный кэш. Если два связанных кэша находятся в одном регионе Azure, то за передачу данных плата не взимается. Если два связанных кэша находятся в разных регионах Azure, то передача данных при георепликации оплачивается по пропускной способности, которая используется для репликации данных в другой регион Azure. Дополнительные сведения см. на странице [Сведения о стоимости пропускной способности](https://azure.microsoft.com/pricing/details/bandwidth/).

### <a name="why-did-the-operation-fail-when-i-tried-to-delete-my-linked-cache"></a>Почему произошел сбой операции, когда я попытался удалить связанный кэш?

Когда два кэша связаны между собой, невозможно удалить ни один из них или группу ресурсов, в которую они входят, пока не удалена связь георепликации. При попытке удалить группу ресурсов, в которую входит один из них или оба связанных кэша, остальные ресурсы в группе ресурсов удаляются, но группа ресурсов остается в состоянии `deleting`, а все связанные кэши в группе ресурсов остаются в состоянии `running`. Чтобы завершить удаление группы ресурсов и связанных кэшей, которые в нее входят, прервите связь георепликации, как описано в разделе [Удаление связи георепликации](#remove-a-geo-replication-link).

### <a name="what-region-should-i-use-for-my-secondary-linked-cache"></a>Какой регион лучше использовать для дополнительного связанного кэша?

Как правило, в качестве региона Azure для размещения кэша рекомендуется использовать тот же регион, в котором размещается приложение, обращающееся к нему. Если у приложения есть основной и резервный регионы, то основной и дополнительный кэши следует размещать в тех же регионах. Дополнительные сведения о парах регионов см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](../best-practices-availability-paired-regions.md).

### <a name="how-does-failing-over-to-the-secondary-linked-cache-work"></a>Как выполнить отработку отказа в дополнительный связанный кэш?

В первоначальном выпуске георепликации кэш Redis для Azure не поддерживает автоматический переход на другой ресурс между регионами Azure. Георепликация используется, главным образом, в сценариях аварийного восстановления. В сценарии аварийного восстановления клиентам необходимо скоординировано перенести весь стек приложений в резервный регион, а не позволять отдельным компонентам приложений самостоятельно решать, когда переключаться на резервный ресурс. Это особенно актуально для кэша Redis. Одно из ключевых преимуществ кэша Redis — это то, что он является хранилищем с очень низкой задержкой. Если кэш Redis, используемый приложением, переходит при сбое в другой регион Azure, а уровень среды выполнения приложений не переходит, то добавленное время кругового пути заметно влияет на производительность. По этой причине мы бы хотели избежать автоматического перехода кэша Redis на другой ресурс из-за временных проблем с доступностью.

В настоящее время для инициирования отработки отказа необходимо удалить связь георепликации на портале Azure, а затем изменить конечную точку подключения в клиенте Redis с основного связанного кэша на (ранее связанный) дополнительный кэш. Когда связь между двумя кэшами будет разорвана, реплика снова станет обычным кэшем с функциями чтения и записи и будет принимать запросы от клиентов Redis напрямую.


## <a name="next-steps"></a>Дополнительная информация

Ознакомьтесь с дополнительными сведениями о [кэше Redis для Azure уровня "Премиум"](cache-premium-tier-intro.md).

