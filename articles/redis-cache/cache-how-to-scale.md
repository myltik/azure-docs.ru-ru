---
title: Как масштабировать кэш Redis для Azure | Документация Майкрософт
description: Узнайте, как масштабировать экземпляры кэша Redis для Azure
services: redis-cache
documentationcenter: ''
author: wesmc7777
manager: cfowler
editor: ''
ms.assetid: 350db214-3b7c-4877-bd43-fef6df2db96c
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 04/11/2017
ms.author: wesmc
ms.openlocfilehash: 9ef988ccdcca921c0285bf983125483a38a07678
ms.sourcegitcommit: d74657d1926467210454f58970c45b2fd3ca088d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="how-to-scale-azure-redis-cache"></a>Масштабирование кэша Redis для Azure
Кэш Redis для Azure предлагает разные варианты кэша, которые обеспечивают гибкость в выборе размера и функций кэша. После создания кэша можно масштабировать его размер и ценовые категории при изменении требований приложения. В этой статье показано, как масштабировать кэш на портале Azure и с помощью инструментов, таких как Azure PowerShell и Azure CLI.

## <a name="when-to-scale"></a>Выбор времени масштабирования
Вы можете использовать функции [мониторинга](cache-how-to-monitor.md) кэша Redis для Azure, чтобы отслеживать работоспособность и производительность кэша и определить, есть ли необходимость в его масштабировании. 

Можно отслеживать следующие метрики для определения необходимости масштабирования.

* Загрузка сервера Redis
* Использование памяти
* Пропускная способность сети
* Загрузка ЦП

Если выяснилось, что ваш кэш больше не отвечает требованиям приложения, можно перейти в более высокую или низкую ценовую категорию кэша, которая подходит для вашего приложения. Дополнительные сведения о выборе ценовой категории кэша см. в разделе [Какое предложение и размер кэша Redis мне следует использовать?](cache-faq.md#what-redis-cache-offering-and-size-should-i-use)

## <a name="scale-a-cache"></a>Масштабирование кэша
Для масштабирования кэша [перейдите к нему](cache-configure.md#configure-redis-cache-settings) на [портале Azure](https://portal.azure.com) и в **меню ресурсов** выберите **Масштаб**.

![Масштаб](./media/cache-how-to-scale/redis-cache-scale-menu.png)

Выберите нужную ценовую категорию в колонке **Выберите ценовую категорию** и нажмите кнопку **Выбрать**.

![Ценовой уровень][redis-cache-pricing-tier-blade]


Вы можете выполнить масштабирование до другой ценовой категории со следующими ограничениями.

* Перейти с более высокой ценовой категории на более низкую нельзя.
  * Ценовую категорию кэша **Премиум** нельзя изменить на категорию **Стандартный** или **Базовый**.
  * Ценовую категорию кэша **Стандартный** нельзя изменить на категорию **Базовый**.
* Вы можете выполнить масштабирование кэша с уровня **Базовый** до уровня **Стандартный**, но вам не удастся одновременно с этим изменить размер кэша. Если требуется изменить размер, можно выполнить последующую операцию масштабирования до нужного размера.
* Ценовую категорию кэша **Базовый** нельзя изменить сразу на уровень **Премиум**. Сначала перейдите с категории **Базовый** на категорию **Стандартный**, а затем — с категории **Стандартный** на категорию **Премиум**.
* Вам не удастся выполнить масштабирование с большего размера до размера **C0 (250 МБ)** .
 
Во время масштабирования кэша до новой ценовой категории в колонке **Кэш Redis** отображается состояние **Масштабирование**.

![Масштабирование][redis-cache-scaling]

После завершения масштабирования состояние меняется с **Масштабирование** на **Работает**.

## <a name="how-to-automate-a-scaling-operation"></a>Автоматизация операции масштабирования
Кроме масштабирования вашего экземпляра на портале Azure, существует возможность масштабирования с помощью командлетов PowerShell, Azure CLI и библиотек управления Microsoft Azure (MAML). 

* [Масштабирование с помощью PowerShell](#scale-using-powershell)
* [Масштабирование с помощью интерфейса командной строки Azure](#scale-using-azure-cli)
* [Масштабирование с помощью MAML](#scale-using-maml)

### <a name="scale-using-powershell"></a>Масштабирование с помощью PowerShell
Вы можете масштабировать экземпляры кэша Redis для Azure с помощью командлета PowerShell [Set-AzureRmRedisCache](https://msdn.microsoft.com/library/azure/mt634518.aspx) при изменении свойств `Size`, `Sku` или `ShardCount`. В следующем примере демонстрируется масштабирование кэша с именем `myCache` в кэш размером 2,5 ГБ. 

    Set-AzureRmRedisCache -ResourceGroupName myGroup -Name myCache -Size 2.5GB

Дополнительные сведения о масштабировании с помощью PowerShell см. в разделе [Масштабирование кэша Redis](cache-howto-manage-redis-cache-powershell.md#scale).

### <a name="scale-using-azure-cli"></a>Масштабирование с помощью интерфейса командной строки Azure
Чтобы выполнить масштабирование экземпляров кэша Redis для Azure с помощью интерфейса командной строки Azure, вызовите команду `azure rediscache set` и передайте ей требуемые изменения в конфигурации, которые включают новый размер, SKU или размер кластера, в зависимости от требуемой операции масштабирования.

Дополнительные сведения о масштабировании с помощью интерфейса командной строки Azure см. в разделе [Изменение параметров существующего кэша Redis](cache-manage-cli.md#scale).

### <a name="scale-using-maml"></a>Масштабирование с помощью MAML
Чтобы масштабировать экземпляры кэша Redis для Azure с помощью [библиотек управления Microsoft Azure (MAML)](http://azure.microsoft.com/updates/management-libraries-for-net-release-announcement/), вызовите метод `IRedisOperations.CreateOrUpdate` и передайте ему новый размер `RedisProperties.SKU.Capacity`.

    static void Main(string[] args)
    {
        // For instructions on getting the access token, see
        // https://azure.microsoft.com/documentation/articles/cache-configure/#access-keys
        string token = GetAuthorizationHeader();

        TokenCloudCredentials creds = new TokenCloudCredentials(subscriptionId,token);

        RedisManagementClient client = new RedisManagementClient(creds);
        var redisProperties = new RedisProperties();

        // To scale, set a new size for the redisSKUCapacity parameter.
        redisProperties.Sku = new Sku(redisSKUName,redisSKUFamily,redisSKUCapacity);
        redisProperties.RedisVersion = redisVersion;
        var redisParams = new RedisCreateOrUpdateParameters(redisProperties, redisCacheRegion);
        client.Redis.CreateOrUpdate(resourceGroupName,cacheName, redisParams);
    }

Чтобы узнать больше, ознакомьтесь с примером [управления кэшем Redis с помощью MAML](https://github.com/rustd/RedisSamples/tree/master/ManageCacheUsingMAML).

## <a name="scaling-faq"></a>Масштабирование: часто задаваемые вопросы
Следующий список содержит ответы на часто задаваемые вопросы о масштабировании кэша Redis для Azure.

* [Можно ли выполнять масштабирование кэша до уровня Премиум, с уровня Премиум до другого уровня или в пределах уровня Премиум?](#can-i-scale-to-from-or-within-a-premium-cache)
* [Нужно ли менять имя кэша и ключи доступа после масштабирования?](#after-scaling-do-i-have-to-change-my-cache-name-or-access-keys)
* [Как работает масштабирование?](#how-does-scaling-work)
* [Сохранятся ли данные кэша при масштабировании?](#will-i-lose-data-from-my-cache-during-scaling)
* [Что происходит с пользовательским параметром databases при масштабировании?](#is-my-custom-databases-setting-affected-during-scaling)
* [Будет ли кэш доступен во время масштабирования?](#will-my-cache-be-available-during-scaling)
* [Почему мне не удается масштабировать кэш или изменить сегменты в кластере, когда настроена георепликация?](#scaling-limitations-with-geo-relication)
* [Какие операции не поддерживаются?](#operations-that-are-not-supported)
* [Сколько времени занимает масштабирование?](#how-long-does-scaling-take)
* [Как узнать, когда масштабирование завершено?](#how-can-i-tell-when-scaling-is-complete)

### <a name="can-i-scale-to-from-or-within-a-premium-cache"></a>Можно ли выполнять масштабирование кэша до уровня Премиум, с уровня Премиум до другого уровня или в пределах уровня Премиум?
* Ценовую категорию кэша **Премиум** нельзя изменить на категорию **Базовый** или **Стандартный**.
* Вы можете переходить от одной ценовой категории кэша **Премиум** к другой.
* Ценовую категорию кэша **Базовый** нельзя изменить сразу на уровень **Премиум**. Сначала перейдите с категории **Базовый** на категорию **Стандартный**, а затем — с категории **Стандартный** на категорию **Премиум**.
* Если при создании вашего кэша категории **Премиум** была включена кластеризация, вы можете [изменить размер кластера](cache-how-to-premium-clustering.md#cluster-size). Если кэш создан без кластеризации, ее можно будет настроить позже.
  
  Дополнительные сведения см. в статье [Настройка кластеризации для кэша Redis для Azure уровня Премиум](cache-how-to-premium-clustering.md).

### <a name="after-scaling-do-i-have-to-change-my-cache-name-or-access-keys"></a>Нужно ли менять имя кэша и ключи доступа после масштабирования?
Нет, имя кэша и ключи не изменяются во время операции масштабирования.

### <a name="how-does-scaling-work"></a>Как работает масштабирование?
* При масштабировании кэша уровня **Базовый** до другого размера работа кэша будет завершена. При этом будет выполнена подготовка к работе нового кэша с новым размером. В течение этого времени кэш недоступен и все данные в кэше теряются.
* При масштабировании кэша уровня **Базовый** до уровня **Стандартный** выполняется подготовка к работе реплики кэша. При этом данные будут скопированы из основного кэша в реплику кэша. Кэш остается доступным в процессе масштабирования.
* При масштабировании кэша уровня **Стандартный** до другого размера или до кэша уровня **Премиум** одна из реплик завершает работу, а затем выполняется ее повторная подготовка к работе с новым размером. После этого в нее будут переданы данные. Затем другая реплика выполнит отработку отказа перед повторной подготовкой к работе. Отработка отказа выполняется, как при сбое одного из узлов кэша.

### <a name="will-i-lose-data-from-my-cache-during-scaling"></a>Сохранятся ли данные кэша при масштабировании?
* При масштабировании кэша уровня **Базовый** до другого размера будут утеряны все данные. Во время операции масштабирования кэш недоступен.
* При масштабировании кэша уровня **Базовый** до уровня **Стандартный** данные в кэше обычно сохраняются.
* При масштабировании кэша уровня **Стандартный** до большего размера или более высокой ценовой категории, а также при увеличении масштаба кэша уровня **Премиум** все данные обычно сохраняются. При уменьшении масштаба кэша уровня **Стандартный** или **Премиум** данные могут быть потеряны, в зависимости от того, сколько данных находится в кэше при масштабировании относительно нового размера. При потере данных во время масштабирования до меньшего размера ключи вытесняются с помощью политики вытеснения [allkeys-lru](http://redis.io/topics/lru-cache) . 

### <a name="is-my-custom-databases-setting-affected-during-scaling"></a>Что происходит с пользовательским параметром databases при масштабировании?
Если вы задали пользовательское значение для параметра `databases` во время создания кэша, учитывайте, что некоторые ценовые категории имеют различные [ограничения для количества баз данных](cache-configure.md#databases). Ниже приведены рекомендации по масштабированию в этом сценарии.

* При масштабировании до определенной ценовой категории с более низким значением `databases` , чем на текущем уровне:
  * Если вы используете заданное по умолчанию количество `databases` (16 для всех ценовых категорий), то данные не теряются.
  * Если вы используете настраиваемое количество `databases` (в пределах ограничений уровня, до которого выполняется масштабирование), значение `databases` будет сохранено и данные не будут утеряны.
  * Если вы используете настраиваемое количество `databases` (которое превышает ограничения нового уровня), значение `databases` будет уменьшено в соответствии с новым уровнем, а все данные в удаленных базах данных будут утеряны.
* При масштабировании до ценовой категории с аналогичным или более высоким значением `databases` по сравнению с текущим уровнем значение `databases` будет сохранено, а данные не будут утеряны.

Хотя кэш "Стандартный" и "Премиум" имеет соглашение об уровне обслуживания с показателем доступности 99,9 %, для потери данных соглашение об уровне обслуживания отсутствует.

### <a name="will-my-cache-be-available-during-scaling"></a>Будет ли кэш доступен во время масштабирования?
* Кэш уровня **Стандартный** или **Премиум** остается доступным во время операции масштабирования. Но кратковременные сбои подключения могут произойти при масштабировании кэша уровня "Стандартный" и "Премиум", а также при масштабировании кэша с уровня "Базовый" до уровня "Стандартный". Сбои подключения обычно длятся недолго, и клиенты Redis могут восстановить подключение мгновенно.
* Во время операций масштабирования до другого размера кэши уровня **Базовый** находятся в автономном режиме. При масштабировании с уровня **Базовый** до уровня **Стандартный** кэши уровня "Базовый" остаются доступными, но при этом могут возникнуть непродолжительные сбои подключения. При возникновении сбоев подключения клиенты Redis могут восстановить подключение мгновенно.


### <a name="scaling-limitations-with-geo-relication"></a>Ограничения масштабирования, связанные с георепликацией

Если вы добавите связь георепликации между двумя кэшами, вы больше не сможете инициировать операцию масштабирования или изменить количество сегментов в кластере. Для выполнения этих команд необходимо удалить связь кэша. Дополнительные сведения см. в статье о [настройке георепликации](cache-how-to-geo-replication.md).


### <a name="operations-that-are-not-supported"></a>Какие операции не поддерживаются?
* Перейти с более высокой ценовой категории на более низкую нельзя.
  * Ценовую категорию кэша **Премиум** нельзя изменить на категорию **Стандартный** или **Базовый**.
  * Ценовую категорию кэша **Стандартный** нельзя изменить на категорию **Базовый**.
* Вы можете выполнить масштабирование кэша с уровня **Базовый** до уровня **Стандартный**, но вам не удастся одновременно с этим изменить размер кэша. Если требуется изменить размер, можно выполнить последующую операцию масштабирования до нужного размера.
* Ценовую категорию кэша **Базовый** нельзя изменить сразу на уровень **Премиум**. Сначала перейдите с категории **Базовый** на категорию **Стандартный**, а затем — с категории **Стандартный** на категорию **Премиум**.
* Вам не удастся выполнить масштабирование с большего размера до размера **C0 (250 МБ)** .

Если операцию масштабирования не удается завершить, служба попытается отменить операцию и кэш вернется к исходному размеру.


### <a name="how-long-does-scaling-take"></a>Сколько времени занимает масштабирование?
Масштабирование занимает приблизительно 20 минут в зависимости от объема данных в кэше.

### <a name="how-can-i-tell-when-scaling-is-complete"></a>Как узнать, когда масштабирование завершено?
На портале Azure вы увидите, как выполняется операция масштабирования. После завершения масштабирования состояние кэша изменяется на **Работает**.

<!-- IMAGES -->

[redis-cache-pricing-tier-blade]: ./media/cache-how-to-scale/redis-cache-pricing-tier-blade.png

[redis-cache-scaling]: ./media/cache-how-to-scale/redis-cache-scaling.png



