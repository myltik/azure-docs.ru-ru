---
title: Обзор автомасштабирования в виртуальных машинах, облачных службах и веб-приложениях Microsoft Azure | Microsoft Docs
description: Обзор автомасштабирования в Microsoft Azure. Применяется к виртуальным машинам, облачным службам и веб-приложениям.
author: rboucher
manager: ''
editor: ''
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics

ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/06/2016
ms.author: robb

---
# Обзор автомасштабирования в виртуальных машинах, облачных службах и веб-приложениях Microsoft Azure
В этой статье объясняется, что такое автомасштабирование Microsoft Azure, каковы преимущества этой функции и как начать ее использовать.

Автомасштабирование Azure Insights работает только с [наборами масштабирования виртуальных машин](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [облачными службами](https://azure.microsoft.com/services/cloud-services/) и [веб-приложениями службы приложений](https://azure.microsoft.com/services/app-service/web/).

> [!NOTE]
> В Azure доступно два способа автомасштабирования. Более старый способ работает с виртуальными машинами (группами доступности). Для него предлагается ограниченная поддержка, поэтому мы рекомендуем перейти к наборам масштабирования виртуальных машин, чтобы обеспечить более быстрое и надежное автомасштабирование. В этой статье есть ссылка на сведения об использовании более старой технологии.
> 
> 

## Основные сведения об автомасштабировании
Благодаря автомасштабированию вы получаете именно тот объем ресурсов, который нужен для обработки нагрузки в вашем приложении. Эта функция позволяет добавлять ресурсы для обработки дополнительной нагрузки и удалять неиспользуемые ресурсы для экономии средств. Вы указываете минимальное и максимальное количество экземпляров, которые должны работать, и система на основании набора правил автоматически добавляет или удаляет виртуальные машины. Если указано минимальное количество, приложение работает всегда, даже при отсутствии нагрузки. Максимальное количество, в свою очередь, ограничивает общую возможную почасовую стоимость. Используя созданные вами правила, система автоматически масштабирует ресурсы в диапазоне двух предельных значений.

 ![Объяснение автомасштабирования. Добавление и удаление виртуальных машин](./media/monitoring-autoscale-overview/AutoscaleConcept.png)

Когда условия правил выполняются, активируется одно или несколько действий автомасштабирования. К ним относятся добавление и удаление виртуальных машин, а также другие настраиваемые действия. Этот процесс показан на концептуальной схеме ниже.

 ![Концептуальная схема потока автомасштабирования](./media/monitoring-autoscale-overview/AutoscaleOverview3.png)

## Процесс автомасштабирования в подробностях
Приведенные ниже сведения относятся к показанной выше схеме.

### Метрики ресурсов
Ресурсы выдают метрики, которые позже обрабатываются с помощью правил. Метрики можно получить различными способами. Наборы масштабирования виртуальных машин используют данные телеметрии из агентов диагностики Azure, а телеметрия для веб-приложений и облачных служб поступает непосредственно из инфраструктуры Azure. К некоторым часто используемым статистическим сведениям относятся загрузка ЦП, использование памяти, число потоков, длина очереди и использование диска. Список данных телеметрии, которые можно использовать, см. в статье [Общие метрики автомасштабирования Azure Insights](../monitoring-and-diagnostics/insights-autoscale-common-metrics.md).

### Время
В правилах на основе расписания используется формат UTC. При настройке правил необходимо правильно задать свой часовой пояс.

### Правила
На схеме показано только одно правило автомасштабирования. Однако можно использовать и сразу несколько. При необходимости для конкретной ситуации можно создать сложные перекрывающиеся правила. Правила бывают следующих типов:

* **на основе метрики**, например выполнение определенного действия при загрузке ЦП более чем на 50 %;
* **на основе времени**, например активация webhook каждую субботу в 8:00 в заданном часовом поясе.

Правила на основе метрик измеряют нагрузку приложений и в зависимости от нагрузки добавляют или удаляют виртуальные машины. Правила, в которых используется расписание, позволяют масштабировать ресурсы, когда в изменении нагрузки просматриваются закономерности. Например, вы хотите добавить или удалить ресурсы до того, как нагрузка увеличится или уменьшится.

### Действия и автоматизация
Правила могут вызвать одно или несколько типов действий:

* **Масштабирование** — свертывание или развертывание виртуальных машин.
* **Электронная почта** — отправка письма по электронной почте администраторам и соадминистраторам подписки, а также на указанные дополнительные адреса электронной почты.
* **Автоматизация с помощью объектов webhook** — вызов объектов webhook, с помощью которых можно активировать несколько сложных действий в среде Azure и за ее пределами. В Azure можно запустить Runbook службы автоматизации Azure, функции Azure или приложения Azure Logic. К примерам сторонних служб можно отнести Slack и Twilio.

## Параметры автомасштабирования
Автомасштабирование имеет определенную структуру, для описания которой используется соответствующая терминология.

* Подсистема автомасштабирования считывает **параметр автомасштабирования** и определяет, что нужно делать с масштабом: увеличивать или уменьшать. Этот параметр содержит один или несколько профилей, информацию о целевом ресурсе и настройки уведомлений.
  * **Профиль автомасштабирования** сочетает в себе параметр емкости, набор правил, управляющих триггерами, действия масштабирования для профиля и сведения о повторении. На случай, если одни требования частично дублируются другими требованиями, можно создать несколько профилей.
    * **Параметр емкости** определяет минимальное, максимальное и стандартное количество экземпляров (см. рисунок 1).
    * **Правило** включает в себя метрический или временной триггер и действие масштабирования (увеличение или уменьшение масштаба), которое нужно выполнять, когда ситуация отвечает условиям правила.
    * Сведения о **повторении** определяют, когда именно функция автомасштабирования должна активировать тот или иной профиль. У вас может быть несколько профилей автомасштабирования, предназначенных, например, для разных дней недели или разного времени суток.
* **Параметр уведомлений** определяет, какие уведомления должны появляться, когда происходит событие автомасштабирования, отвечающее условиям одного из профилей автомасштабирования. Функция автомасштабирования может отправлять уведомления на электронную почту или вызывать перехватчики webhook.

![Структура правил, профилей и параметров автомасштабирования Azure](./media/monitoring-autoscale-overview/AzureResourceManagerRuleStructure3.png)

Полный список настраиваемых полей и описаний см. в статье [о REST API для функции автомасштабирования](https://msdn.microsoft.com/library/dn931928.aspx).

Примеры кода см. в следующих статьях:

* [Расширенная настройка автомасштабирования с помощью шаблонов Resource Manager для набора масштабирования виртуальных машин](../monitoring-and-diagnostics/insights-advanced-autoscale-virtual-machine-scale-sets.md)
* [Create or update an autoscale setting in Azure Insights REST API](https://msdn.microsoft.com/library/dn931953.aspx) (Создание и изменение параметров автомасштабирования в REST API Azure Insights)

## Горизонтальное и вертикальное масштабирование
При автомасштабировании ресурсы масштабируются только горизонтально, то есть происходит увеличение (развертывание) или уменьшение (свертывание) количества экземпляров виртуальной машины. Горизонтальное масштабирование больше подходит для облачной среды, так как позволяет запускать потенциально тысячи виртуальных машин для обработки нагрузки. С вертикальным масштабированием дело обстоит иначе. Имеющееся количество виртуальных машин всегда остается неизменным, а увеличивается или уменьшается их мощность. Мощность измеряется по объему памяти, скорости ЦП, дисковому пространству и т. д. Вертикальное масштабирование связано с дополнительными ограничениями. Оно зависит от доступности оборудования большего размера, что, в свою очередь, зависит от региона. К тому же при таком масштабировании быстро достигается верхнее ограничение. Обычно при вертикальном масштабировании требуется запускать и останавливать виртуальную машину. Дополнительные сведения см. в статье [Вертикальное масштабирование виртуальной машины Azure c помощью службы автоматизации Azure](../virtual-machines/virtual-machines-linux-vertical-scaling-automation.md).

## Варианты доступа
Автомасштабирование можно настроить с помощью следующих инструментов:

* [Портал Azure](insights-how-to-scale.md)
* [PowerShell](../monitoring-and-diagnostics/insights-powershell-samples.md#create-and-manage-autoscale-settings)
* [Кроссплатформенный интерфейс командной строки](../monitoring-and-diagnostics/insights-cli-samples.md#autoscale)
* [REST API Insights;](https://msdn.microsoft.com/library/azure/dn931953.aspx)

## Службы, поддерживающие автомасштабирование
| служба | Схемы и документы |
| --- | --- |
| Веб-приложения |[Scaling Web Apps (Масштабирование веб-приложения)](insights-how-to-scale.md) |
| Облачные службы |[Автомасштабирование облачной службы](../cloud-services/cloud-services-how-to-scale.md) |
| Виртуальные машины: классическое развертывание |[Scaling Classic Virtual Machine Availability Sets (Масштабирование групп доступности классических виртуальных машин)](https://blogs.msdn.microsoft.com/kaevans/2015/02/20/autoscaling-azurevirtual-machines/) |
| Виртуальные машины: наборы масштабирования Windows |[Scaling VM Scale Sets in Windows (Масштабирование наборов масштабирования виртуальных машин в Windows)](../virtual-machine-scale-sets/virtual-machine-scale-sets-windows-autoscale.md) |
| Виртуальные машины: наборы масштабирования Linux |[Scaling VM Scale Sets in Windows (Масштабирование наборов масштабирования виртуальных машин в Linux)](../virtual-machine-scale-sets/virtual-machine-scale-sets-linux-autoscale.md) |
| Виртуальные машины: пример с Windows |[Расширенная настройка автомасштабирования с помощью шаблонов Resource Manager для набора масштабирования виртуальных машин](../monitoring-and-diagnostics/insights-advanced-autoscale-virtual-machine-scale-sets.md) |

## Дальнейшие действия
Дополнительные сведения об автомасштабировании см. в пошаговых руководствах по автомасштабированию выше, а также в следующих статьях:

* [Общие метрики автомасштабирования Azure Insights](../monitoring-and-diagnostics/insights-autoscale-common-metrics.md)
* [Рекомендации по автомасштабированию Azure Insights](../monitoring-and-diagnostics/insights-autoscale-best-practices.md)
* [Использование действий автомасштабирования для отправки электронной почты и уведомлений об оповещениях веб-перехватчика в Azure Insights](../monitoring-and-diagnostics/insights-autoscale-to-webhook-email.md)
* [Create or update an autoscale setting in Azure Insights REST API (Создание и изменение параметров автомасштабирования в REST API Azure Insights)](https://msdn.microsoft.com/library/dn931953.aspx)
* [Устранение неполадок при автомасштабировании масштабируемых наборов виртуальных машин](../virtual-machine-scale-sets/virtual-machine-scale-sets-troubleshoot.md)

<!---HONumber=AcomDC_0914_2016-->