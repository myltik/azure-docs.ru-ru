---
title: 'AMQP 1.0 в служебной шине Azure: операции c запросами и ответами | Документация Майкрософт'
description: Список операций с запросами и ответами в служебной шине Microsoft Azure.
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: ''
ms.assetid: ''
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 02/22/2018
ms.author: sethm
ms.openlocfilehash: 847fe0c08d442388cfa506042272bb358058cb4c
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
ms.locfileid: "32194709"
---
# <a name="amqp-10-in-microsoft-azure-service-bus-request-response-based-operations"></a>AMQP 1.0 в служебной шине Microsoft Azure: операции c запросами и ответами

В этой статье приводится список операций с запросами и ответами в служебной шине Microsoft Azure. Эта информация основана на использовании рабочего проекта службы управления AMQP версии 1.0.  
  
Подробные инструкции по работе с протоколом AMQP 1.0 на уровне соединения, в которых объясняется, как служебная шина реализует и использует техническую спецификацию OASIS AMQP, см. в руководствах по [использованию протокола AMQP 1.0 в служебной шине и концентраторах событий Azure и использованию протокола AMQP 1.0][Руководство по использованию протокола AMQP 1.0].  
  
## <a name="concepts"></a>Основные понятия  
  
### <a name="entity-description"></a>Описание сущности  

Описание сущности касается таких объектов служебной шины, как [класс QueueDescription](/dotnet/api/microsoft.servicebus.messaging.queuedescription), [класс TopicDescription](/dotnet/api/microsoft.servicebus.messaging.topicdescription) и [класс SubscriptionDescription](/dotnet/api/microsoft.servicebus.messaging.subscriptiondescription).  
  
### <a name="brokered-message"></a>Сообщение в брокере  

Сообщение в служебной шине, сопоставленное с сообщением AMQP. Определение сопоставления см. в статье [Руководство по использованию протокола AMQP 1.0 в служебной шине и концентраторах событий Azure](service-bus-amqp-protocol-guide.md).  
  
## <a name="attach-to-entity-management-node"></a>Подключение к узлу управления сущностью  

Все операции, описанные в этом документе, соответствуют шаблону "запрос — ответ", ограничены сущностью, и для их выполнения требуется подключение к узлу управления сущностью.  
  
### <a name="create-link-for-sending-requests"></a>Создание ссылки для отправки запросов  

Создание ссылки на узел управления для отправки запросов.  
  
```  
requestLink = session.attach(     
role: SENDER,   
    target: { address: "<entity address>/$management" },   
    source: { address: ""<my request link unique address>" }   
)  
  
```  
  
### <a name="create-link-for-receiving-responses"></a>Создание ссылки для получения ответов  

Создание ссылки для получения ответов от узла управления.  
  
```  
responseLink = session.attach(    
role: RECEIVER,   
    source: { address: "<entity address>/$management" }   
    target: { address: "<my response link unique address>" }   
)  
  
```  
  
### <a name="transfer-a-request-message"></a>Передача сообщения запроса  

Передача сообщения запроса.  
При необходимости можно добавить transaction-state для операций, которые поддерживают транзакции.

```  
requestLink.sendTransfer(  
        Message(  
                properties: {  
                        message-id: <request id>,  
                        reply-to: "<my response link unique address>"  
                },  
                application-properties: {  
                        "operation" -> "<operation>",  
                }
        ),
        [Optional] State = transactional-state: {
                txn-id: <txn-id>
        }
)
```  
  
### <a name="receive-a-response-message"></a>Получение ответного сообщения  

Получение ответного сообщения по ссылке ответа.  
  
```  
responseMessage = responseLink.receiveTransfer()  
```  
  
Ответное сообщение имеет следующий формат:
  
```  
Message(  
properties: {     
        correlation-id: <request id>  
    },  
    application-properties: {  
            "statusCode" -> <status code>,  
            "statusDescription" -> <status description>,  
           },         
)  
  
```  
  
### <a name="service-bus-entity-address"></a>Адрес сущности служебной шины  

Адреса сущностей служебной шины составляются следующим образом:  
  
|Тип сущности|Адрес|Пример|  
|-----------------|-------------|-------------|  
|очередь|`<queue_name>`|`“myQueue”`<br /><br /> `“site1/myQueue”`|  
|Раздел|`<topic_name>`|`“myTopic”`<br /><br /> `“site2/page1/myQueue”`|  
|Подписка|`<topic_name>/Subscriptions/<subscription_name>`|`“myTopic/Subscriptions/MySub”`|  
  
## <a name="message-operations"></a>Операции с сообщениями  
  
### <a name="message-renew-lock"></a>Блокировка обновления сообщений  

Продлевает блокировку сообщения до момента времени, указанного в описании сущности.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:renew-lock`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
 Текст запроса должен включать раздел amqp-value, содержащий схему со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|`lock-tokens`|Массив UUID|Yes|Маркеры блокировки сообщения для обновления.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет |Описание состояния.|  
  
Текст ответа должен включать раздел amqp-value, содержащий схему со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|expirations|Массив метки времени|Yes|Новый срок действия для маркера блокировки сообщения, который соответствует маркерам блокировки запроса.|  
  
### <a name="peek-message"></a>Просмотр сообщения  

Просмотр сообщений без блокировки.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:peek-message`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|`from-sequence-number`|длинное целое число|Yes|Порядковый номер, с которого следует начать просмотр.|  
|`message-count`|int|Yes|Максимальное число просматриваемых сообщений.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — есть дополнительные сообщения.<br /><br /> 0xcc: нет содержимого — больше нет сообщений.|  
|statusDescription|строка|Нет |Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|отправляемых из облака на устройство|Список схем|Yes|Список сообщений, в котором каждая схема представляет сообщение.|  
  
Схема, представляющая сообщение, должна содержать следующие элементы.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|Message|Массив байтов|Yes|Сообщение с кодированием линии связи AMQP 1.0.|  
  
### <a name="schedule-message"></a>Расписание сообщения  

Расписание для сообщений. Эта операция поддерживает транзакции.
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:schedule-message`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|отправляемых из облака на устройство|Список схем|Yes|Список сообщений, в котором каждая схема представляет сообщение.|  
  
Схема, представляющая сообщение, должна содержать следующие элементы.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|message-id|строка|Yes|`amqpMessage.Properties.MessageId` в качестве строки|  
|session-id|строка|Нет |`amqpMessage.Properties.GroupId as string`|  
|partition-key|строка|Нет |`amqpMessage.MessageAnnotations.”x-opt-partition-key"`|
|via-partition-key|строка|Нет |`amqpMessage.MessageAnnotations."x-opt-via-partition-key"`|
|Message|Массив байтов|Yes|Сообщение с кодированием линии связи AMQP 1.0.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет |Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий схему со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sequence-numbers|Массив длинных чисел|Yes|Порядковый номер запланированных сообщений. Порядковый номер используется для отмены.|  
  
### <a name="cancel-scheduled-message"></a>Отмена запланированного сообщения  

Отмена запланированных сообщений.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:cancel-scheduled-message`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sequence-numbers|Массив длинных чисел|Yes|Порядковый номер запланированных сообщений для отмены.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет |Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий схему со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sequence-numbers|Массив длинных чисел|Yes|Порядковый номер запланированных сообщений. Порядковый номер используется для отмены.|  
  
## <a name="session-operations"></a>Операции на уровне сеанса  
  
### <a name="session-renew-lock"></a>Блокировка обновления сеанса  

Продлевает блокировку сообщения до момента времени, указанного в описании сущности.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:renew-session-lock`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|session-id|строка|Yes|Идентификатор сеанса.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — есть дополнительные сообщения.<br /><br /> 0xcc: нет содержимого — больше нет сообщений.|  
|statusDescription|строка|Нет |Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий схему со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|expiration|timestamp|Yes|Новый срок действия.|  
  
### <a name="peek-session-message"></a>Просмотр сообщения сеанса  

Просмотр сообщений сеанса без блокировки.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:peek-message`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|from-sequence-number|длинное целое число|Yes|Порядковый номер, с которого следует начать просмотр.|  
|message-count|int|Yes|Максимальное число просматриваемых сообщений.|  
|session-id|строка|Yes|Идентификатор сеанса.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — есть дополнительные сообщения.<br /><br /> 0xcc: нет содержимого — больше нет сообщений.|  
|statusDescription|строка|Нет |Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий схему со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|отправляемых из облака на устройство|Список схем|Yes|Список сообщений, в котором каждая схема представляет сообщение.|  
  
 Схема, представляющая сообщение, должна содержать следующие элементы.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|Message|Массив байтов|Yes|Сообщение с кодированием линии связи AMQP 1.0.|  
  
### <a name="set-session-state"></a>Установка состояния сеанса  

Установка состояния сеанса.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:peek-message`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|session-id|строка|Yes|Идентификатор сеанса.|  
|session-state|Массив байтов|Yes|Непрозрачные двоичные данные.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет |Описание состояния.|  
  
### <a name="get-session-state"></a>Получение состояния сеанса  

Получение состояния сеанса.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:get-session-state`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|session-id|строка|Yes|Идентификатор сеанса.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет |Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|session-state|Массив байтов|Yes|Непрозрачные двоичные данные.|  
  
### <a name="enumerate-sessions"></a>Перечисление сеансов  

Перечисление сеансов в сущности обмена сообщениями.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:get-message-sessions`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|last-updated-time|timestamp|Yes|Фильтр включает только сеансы, обновленные после указанного времени.|  
|skip|int|Yes|Пропуск определенного числа сеансов.|  
|top|int|Yes|Максимальное число сеансов.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — есть дополнительные сообщения.<br /><br /> 0xcc: нет содержимого — больше нет сообщений.|  
|statusDescription|строка|Нет |Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|skip|int|Yes|Количество пропущенных сеансов, если код состояния равен 200.|  
|sessions-ids|Массив строк|Yes|Массив идентификаторов, если код состояния равен 200.|  
  
## <a name="rule-operations"></a>Операции с правилами  
  
### <a name="add-rule"></a>Добавление правила  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:add-rule`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|rule-name|строка|Yes|Имя правила без учета имени подписки и раздела.|  
|rule-description|map|Yes|Описание правила, как указано в следующем разделе.|  
  
Схема **rule-description** должна содержать следующие элементы, где элементы **sql-filter** и **correlation-filter** являются взаимоисключающими.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sql-filter|map|Yes|`sql-filter`, как указано в следующем разделе.|  
|correlation-filter|map|Yes|`correlation-filter`, как указано в следующем разделе.|  
|sql-rule-action|map|Yes|`sql-rule-action`, как указано в следующем разделе.|  
  
Схема sql-filter должна включать следующие элементы.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|expression|строка|Yes|Выражение фильтра SQL.|  
  
Схема **correlation-filter** должна содержать хотя бы один из следующих элементов.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|correlation-id|строка|Нет ||  
|message-id|строка|Нет ||  
|значение|строка|Нет ||  
|reply-to|строка|Нет ||  
|label|строка|Нет ||  
|session-id|строка|Нет ||  
|reply-to-session-id|строка|Нет ||  
|content-type|строка|Нет ||  
|properties|map|Нет |Сопоставляется с [BrokeredMessage.Properties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Properties) в служебной шине.|  
  
Схема **sql-rule-action** должна включать следующие элементы.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|expression|строка|Yes|Выражение действия SQL.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет |Описание состояния.|  
  
### <a name="remove-rule"></a>Удаление правила  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:remove-rule`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|rule-name|строка|Yes|Имя правила без учета имени подписки и раздела.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет |Описание состояния.|  
  
### <a name="get-rules"></a>Получение правил

#### <a name="request"></a>Запрос

Сообщение запроса должно включать следующие свойства приложения.

|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:enumerate-rules`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  

Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|top|int|Yes|Число получаемых правил на странице.|  
|skip|int|Yes|Число пропускаемых правил. Определяет начальный индекс (+1) списка правил. | 

#### <a name="response"></a>Ответ

Ответное сообщение содержит следующие свойства.

|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|правила| Массив сопоставлений|Yes|Массив правил. Каждое правило представлено сопоставлением.|

Каждая запись сопоставления в массиве содержит следующие свойства.

|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|rule-description|Массив описанных объектов|Yes|`com.microsoft:rule-description:list` с описанным кодом AMQP 0x0000013700000004| 

`com.microsoft.rule-description:list` представляет собой массив описанных объектов. Массив содержит следующие элементы.

|Индекс|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
| 0 | Массив описанных объектов | Yes | `filter`, как указано ниже. |
| 1 | Массив описанных объектов | Yes | `ruleAction`, как указано ниже. |
| 2 | строка | Yes | Имя правила. |

`filter` может быть одного из приведенных ниже типов.

| Имя дескриптора | Код дескриптора | Значение |
| --- | --- | ---|
| `com.microsoft:sql-filter:list` | 0x000001370000006 | Фильтр SQL |
| `com.microsoft:correlation-filter:list` | 0x000001370000009 | Фильтр корреляции |
| `com.microsoft:true-filter:list` | 0x000001370000007 | Фильтр значений True, представляющий схему 1=1 |
| `com.microsoft:false-filter:list` | 0x000001370000008 | Фильтр значений False, представляющий схему 1=0 |

`com.microsoft:sql-filter:list` представляет собой описанный массив, который включает в себя следующие элементы.

|Индекс|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
| 0 | строка | Yes | Выражение фильтра SQL |

`com.microsoft:correlation-filter:list` представляет собой описанный массив, который включает в себя следующие элементы.

|Индекс (если существует)|Тип значения|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
| 0 | строка | Идентификатор корреляции |
| 1 | строка | Идентификатор сообщения |
| 2 | строка | Кому |
| 3 | строка | Ответить |
| 4. | строка | Метка |
| 5 | строка | Идентификатор сеанса |
| 6 | строка | Ответ на идентификатор сеанса|
| 7 | строка | Тип содержимого |
| 8 | Сопоставление | Сопоставление определенных приложением свойств |

`ruleAction` может быть одного из приведенных ниже типов.

| Имя дескриптора | Код дескриптора | Значение |
| --- | --- | ---|
| `com.microsoft:empty-rule-action:list` | 0x0000013700000005 | Пустое правило действия: действие правила отсутствует |
| `com.microsoft:sql-rule-action:list` | 0x0000013700000006 | Действие правила SQL |

`com.microsoft:sql-rule-action:list` представляет собой массив описанных объектов, первая запись которого является строкой, содержащей выражение действия правила SQL.

## <a name="deferred-message-operations"></a>Операции с отложенными сообщениями  
  
### <a name="receive-by-sequence-number"></a>Получение по порядковому номеру  

Получение отложенных сообщений по порядковым номерам.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:receive-by-sequence-number`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sequence-numbers|Массив длинных чисел|Yes|Порядковые номера.|  
|receiver-settle-mode|ubyte|Yes|Режим **сопоставления получателя**, как указано в AMQP Core 1.0.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет |Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|отправляемых из облака на устройство|Список схем|Yes|Список сообщений, в котором каждая схема представляет сообщение.|  
  
Схема, представляющая сообщение, должна содержать следующие элементы.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|lock-token|uuid|Yes|Маркер блокировки, если значение `receiver-settle-mode` равно -1.|  
|Message|Массив байтов|Yes|Сообщение с кодированием линии связи AMQP 1.0.|  
  
### <a name="update-disposition-status"></a>Обновление состояния метода обработки  

Обновление состояния метода обработки для отложенных сообщений. Эта операция поддерживает транзакции.
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|строка|Yes|`com.microsoft:update-disposition`|  
|`com.microsoft:server-timeout`|uint|Нет |Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|disposition-status|строка|Yes|выполнено<br /><br /> abandoned (прервано)<br /><br /> suspended (приостановлено)|  
|lock-tokens|Массив UUID|Yes|Маркеры блокировки сообщения для обновления состояния метода обработки.|  
|deadletter-reason|строка|Нет |Может быть задано, если состояние метода обработки имеет значение **suspended**.|  
|deadletter-description|строка|Нет |Может быть задано, если состояние метода обработки имеет значение **suspended**.|  
|properties-to-modify|map|Нет |Список свойств сообщений в брокере служебной шины, подлежащих изменению.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Yes|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет |Описание состояния.|

## <a name="next-steps"></a>Дополнительная информация

Сведения о служебной шине и AMQP см. по следующим ссылкам.

* [Протокол AMQP служебной шины — обзор]
* [Руководство по использованию протокола AMQP 1.0]
* [Протокол AMQP служебной шины для Windows Server]

[Протокол AMQP служебной шины — обзор]: service-bus-amqp-overview.md
[Руководство по использованию протокола AMQP 1.0]: service-bus-amqp-protocol-guide.md
[Протокол AMQP служебной шины для Windows Server]: https://msdn.microsoft.com/library/dn574799.asp