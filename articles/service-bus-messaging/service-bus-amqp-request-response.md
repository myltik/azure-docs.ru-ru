---
title: "AMQP 1.0 в служебной шине Azure: операции c запросами и ответами | Документация Майкрософт"
description: "Список операций с запросами и ответами в служебной шине Microsoft Azure."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 06/27/2017
ms.author: sethm
ms.translationtype: Human Translation
ms.sourcegitcommit: 857267f46f6a2d545fc402ebf3a12f21c62ecd21
ms.openlocfilehash: 756565b3da6e0a818d1ee3d5e17f942d96be14f0
ms.contentlocale: ru-ru
ms.lasthandoff: 06/28/2017

---

# <a name="amqp-10-in-microsoft-azure-service-bus-request-response-based-operations"></a>AMQP 1.0 в служебной шине Microsoft Azure: операции c запросами и ответами

В этой статье приводится список операций с запросами и ответами в служебной шине Microsoft Azure. Эта информация основана на использовании рабочего проекта службы управления AMQP версии 1.0.  
  
Подробные инструкции по работе с протоколом AMQP 1.0 на уровне соединения, которые объясняют, как служебная шина реализует и использует техническую спецификацию OASIS AMQP, см. в статье [Руководство по использованию протокола AMQP 1.0 в служебной шине и концентраторах событий Azure](service-bus-amqp-protocol-guide.md).  
  
## <a name="concepts"></a>Основные понятия  
  
### <a name="entity-description"></a>Описание сущности  

Описание сущности касается таких объектов служебной шины, как [QueueDescription Class](/dotnet/api/microsoft.servicebus.messaging.queuedescription), [TopicDescription Class](/dotnet/api/microsoft.servicebus.messaging.topicdescription) и [SubscriptionDescription Class](/dotnet/api/microsoft.servicebus.messaging.subscriptiondescription).  
  
### <a name="brokered-message"></a>Сообщение в брокере  

Сообщение в служебной шине, сопоставленное с сообщением AMQP. Определение сопоставления см. в статье [Руководство по использованию протокола AMQP 1.0 в служебной шине и концентраторах событий Azure](service-bus-amqp-protocol-guide.md).  
  
## <a name="attach-to-entity-management-node"></a>Подключение к узлу управления сущностью  

Все операции, описанные в этом документе, соответствуют шаблону "запрос — ответ", ограничены сущностью, и для их выполнения требуется подключение к узлу управления сущностью.  
  
### <a name="create-link-for-sending-requests"></a>Создание ссылки для отправки запросов  

Создание ссылки на узел управления для отправки запросов.  
  
```  
requestLink = session.attach(     
role: SENDER,   
    target: { address: "<entity address>/$management" },   
    source: { address: ""<my request link unique address>" }   
)  
  
```  
  
### <a name="create-link-for-receiving-responses"></a>Создание ссылки для получения ответов  

Создание ссылки для получения ответов от узла управления.  
  
```  
responseLink = session.attach(    
role: RECEIVER,   
    source: { address: "<entity address>/$management" }   
    target: { address: "<my response link unique address>" }   
)  
  
```  
  
### <a name="transfer-a-request-message"></a>Передача сообщения запроса  

Передача сообщения запроса.  
  
```  
requestLink.sendTransfer(  
        Message(  
                properties: {  
                        message-id: <request id>,  
                        reply-to: "<my response link unique address>"  
                },  
                application-properties: {  
                        "operation" -> "<operation>",  
                },  
        )  
```  
  
### <a name="receive-a-response-message"></a>Получение ответного сообщения  

Получение ответного сообщения по ссылке ответа.  
  
```  
responseMessage = responseLink.receiveTransfer()  
```  
  
Ответное сообщение имеет следующий формат:
  
```  
Message(  
properties: {     
        correlation-id: <request id>  
    },  
    application-properties: {  
            "statusCode" -> <status code>,  
            "statusDescription" -> <status description>,  
           },         
)  
  
```  
  
### <a name="service-bus-entity-address"></a>Адрес сущности служебной шины  

Адреса сущностей служебной шины составляются следующим образом:  
  
|Тип сущности|Адрес|Пример|  
|-----------------|-------------|-------------|  
|очередь|`<queue_name>`|`“myQueue”`<br /><br /> `“site1/myQueue”`|  
|Раздел|`<topic_name>`|`“myTopic”`<br /><br /> `“site2/page1/myQueue”`|  
|subscription|`<topic_name>/Subscriptions/<subscription_name>`|`“myTopic/Subscriptions/MySub”`|  
  
## <a name="message-operations"></a>Операции с сообщениями  
  
### <a name="message-renew-lock"></a>Блокировка обновления сообщений  

Продлевает блокировку сообщения до момента времени, указанного в описании сущности.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|string|Да|`com.microsoft:renew-lock`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
 Текст запроса должен включать раздел amqp-value, содержащий схему со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|`lock-tokens`|Массив UUID|Да|Маркеры блокировки сообщения для обновления.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|string|Нет|Описание состояния.|  
  
Текст ответа должен включать раздел amqp-value, содержащий схему со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|expirations|Массив метки времени|Да|Новый срок действия для маркера блокировки сообщения, который соответствует маркерам блокировки запроса.|  
  
### <a name="peek-message"></a>Просмотр сообщения  

Просмотр сообщений без блокировки.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|string|Да|`com.microsoft:peek-message`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|`from-sequence-number`|длинное целое число|Да|Порядковый номер, с которого следует начать просмотр.|  
|`message-count`|int|Да|Максимальное число просматриваемых сообщений.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — есть дополнительные сообщения.<br /><br /> 0xcc: нет содержимого — больше нет сообщений.|  
|statusDescription|string|Нет|Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|отправляемых из облака на устройство|Список схем|Да|Список сообщений, в котором каждая схема представляет сообщение.|  
  
Схема, представляющая сообщение, должна содержать следующие элементы.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|message|Массив байтов|Да|Сообщение с кодированием линии связи AMQP 1.0.|  
  
### <a name="schedule-message"></a>Расписание сообщения  

Расписание для сообщений.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|string|Да|`com.microsoft:schedule-message`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|отправляемых из облака на устройство|Список схем|Да|Список сообщений, в котором каждая схема представляет сообщение.|  
  
Схема, представляющая сообщение, должна содержать следующие элементы.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|message-id|строка|Да|`amqpMessage.Properties.MessageId` в качестве строки|  
|session-id|строка|Да|`amqpMessage.Properties.GroupId as string`|  
|partition-key|string|Да|`amqpMessage.MessageAnnotations.”x-opt-partition-key"`|  
|message|Массив байтов|Да|Сообщение с кодированием линии связи AMQP 1.0.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|string|Нет|Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий схему со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sequence-numbers|Массив длинных чисел|Да|Порядковый номер запланированных сообщений. Порядковый номер используется для отмены.|  
  
### <a name="cancel-scheduled-message"></a>Отмена запланированного сообщения  

Отмена запланированных сообщений.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|string|Да|`com.microsoft:cancel-scheduled-message`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sequence-numbers|Массив длинных чисел|Да|Порядковый номер запланированных сообщений для отмены.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|string|Нет|Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий схему со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sequence-numbers|Массив длинных чисел|Да|Порядковый номер запланированных сообщений. Порядковый номер используется для отмены.|  
  
## <a name="session-operations"></a>Операции на уровне сеанса  
  
### <a name="session-renew-lock"></a>Блокировка обновления сеанса  

Продлевает блокировку сообщения до момента времени, указанного в описании сущности.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|string|Да|`com.microsoft:renew-session-lock`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|session-id|строка|Да|Идентификатор сеанса.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — есть дополнительные сообщения.<br /><br /> 0xcc: нет содержимого — больше нет сообщений.|  
|statusDescription|string|Нет|Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий схему со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|expiration|Timestamp|Да|Новый срок действия.|  
  
### <a name="peek-session-message"></a>Просмотр сообщения сеанса  

Просмотр сообщений сеанса без блокировки.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|string|Да|`com.microsoft:peek-message`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|from-sequence-number|длинное целое число|Да|Порядковый номер, с которого следует начать просмотр.|  
|message-count|int|Да|Максимальное число просматриваемых сообщений.|  
|session-id|строка|Да|Идентификатор сеанса.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — есть дополнительные сообщения.<br /><br /> 0xcc: нет содержимого — больше нет сообщений.|  
|statusDescription|string|Нет|Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий схему со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|отправляемых из облака на устройство|Список схем|Да|Список сообщений, в котором каждая схема представляет сообщение.|  
  
 Схема, представляющая сообщение, должна содержать следующие элементы.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|message|Массив байтов|Да|Сообщение с кодированием линии связи AMQP 1.0.|  
  
### <a name="set-session-state"></a>Установка состояния сеанса  

Установка состояния сеанса.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|string|Да|`com.microsoft:peek-message`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|session-id|строка|Да|Идентификатор сеанса.|  
|session-state|Массив байтов|Да|Непрозрачные двоичные данные.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|string|Нет|Описание состояния.|  
  
### <a name="get-session-state"></a>Получение состояния сеанса  

Получение состояния сеанса.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|string|Да|`com.microsoft:get-session-state`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|session-id|строка|Да|Идентификатор сеанса.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|string|Нет|Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|session-state|Массив байтов|Да|Непрозрачные двоичные данные.|  
  
### <a name="enumerate-sessions"></a>Перечисление сеансов  

Перечисление сеансов в сущности обмена сообщениями.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|string|Да|`com.microsoft:get-message-sessions`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|last-updated-time|Timestamp|Да|Фильтр включает только сеансы, обновленные после указанного времени.|  
|skip|int|Да|Пропуск определенного числа сеансов.|  
|top|int|Да|Максимальное число сеансов.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — есть дополнительные сообщения.<br /><br /> 0xcc: нет содержимого — больше нет сообщений.|  
|statusDescription|string|Нет|Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|skip|int|Да|Количество пропущенных сеансов, если код состояния равен 200.|  
|sessions-ids|Массив строк|Да|Массив идентификаторов, если код состояния равен 200.|  
  
## <a name="rule-operations"></a>Операции с правилами  
  
### <a name="add-rule"></a>Добавление правила  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|string|Да|`com.microsoft:add-rule`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|rule-name|строка|Да|Имя правила без учета имени подписки и раздела.|  
|rule-description|map|Да|Описание правила, как указано в следующем разделе.|  
  
Схема **rule-description** должна содержать следующие элементы, где элементы **sql-filter** и **correlation-filter** являются взаимоисключающими.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sql-filter|map|Да|`sql-filter`, как указано в следующем разделе.|  
|correlation-filter|map|Да|`correlation-filter`, как указано в следующем разделе.|  
|sql-rule-action|map|Да|`sql-rule-action`, как указано в следующем разделе.|  
  
Схема sql-filter должна включать следующие элементы.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|expression|string|Да|Выражение фильтра SQL.|  
  
Схема **correlation-filter** должна содержать хотя бы один из следующих элементов.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|correlation-id|строка|Нет||  
|message-id|строка|Нет||  
|значение|string|Нет||  
|reply-to|string|Нет||  
|label|строка|Нет||  
|session-id|строка|Нет||  
|reply-to-session-id|string|Нет||  
|content-type|строка|Нет||  
|properties|map|Нет|Сопоставляется с [BrokeredMessage.Properties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Properties) в служебной шине.|  
  
Схема **sql-rule-action** должна включать следующие элементы.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|expression|string|Да|Выражение действия SQL.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|string|Нет|Описание состояния.|  
  
### <a name="remove-rule"></a>Удаление правила  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|string|Да|`com.microsoft:remove-rule`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|rule-name|строка|Да|Имя правила без учета имени подписки и раздела.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|string|Нет|Описание состояния.|  
  
## <a name="deferred-message-operations"></a>Операции с отложенными сообщениями  
  
### <a name="receive-by-sequence-number"></a>Получение по порядковому номеру  

Получение отложенных сообщений по порядковым номерам.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|string|Да|`com.microsoft:receive-by-sequence-number`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sequence-numbers|Массив длинных чисел|Да|Порядковые номера.|  
|receiver-settle-mode|ubyte|Да|Режим **сопоставления получателя**, как указано в AMQP Core 1.0.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|string|Нет|Описание состояния.|  
  
Текст ответа должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|отправляемых из облака на устройство|Список схем|Да|Список сообщений, в котором каждая схема представляет сообщение.|  
  
Схема, представляющая сообщение, должна содержать следующие элементы.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|lock-token|uuid|Да|Маркер блокировки, если значение `receiver-settle-mode` равно -1.|  
|message|Массив байтов|Да|Сообщение с кодированием линии связи AMQP 1.0.|  
  
### <a name="update-disposition-status"></a>Обновление состояния метода обработки  

Обновление состояния метода обработки для отложенных сообщений.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операция|string|Да|`com.microsoft:update-disposition`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст запроса должен включать раздел **amqp-value**, содержащий **схему** со следующими элементами.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|disposition-status|строка|Да|выполнено<br /><br /> abandoned (прервано)<br /><br /> suspended (приостановлено)|  
|lock-tokens|Массив UUID|Да|Маркеры блокировки сообщения для обновления состояния метода обработки.|  
|deadletter-reason|string|Нет|Может быть задано, если состояние метода обработки имеет значение **suspended**.|  
|deadletter-description|строка|Нет|Может быть задано, если состояние метода обработки имеет значение **suspended**.|  
|properties-to-modify|map|Нет|Список свойств сообщений в брокере служебной шины, подлежащих изменению.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Ключ|Тип значения|Обязательно|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|int|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|string|Нет|Описание состояния.|

## <a name="next-steps"></a>Дальнейшие действия

Сведения о служебной шине и AMQP см. по следующим ссылкам.

* [Протокол AMQP служебной шины — обзор]
* [Поддержка AMQP 1.0 для секционированных очередей и разделов служебной шины]
* [Протокол AMQP служебной шины для Windows Server]

[Протокол AMQP служебной шины — обзор]: service-bus-amqp-overview.md
[Поддержка AMQP 1.0 для секционированных очередей и разделов служебной шины]: service-bus-partitioned-queues-and-topics-amqp-overview.md
[Протокол AMQP служебной шины для Windows Server]: https://msdn.microsoft.com/library/dn574799.asp
