---
title: Автоматическая пересылка сущностей обмена сообщениями служебной шины Azure | Документация Майкрософт
description: Описывается, как привязать очередь или подписку служебной шины к другой очереди или разделу.
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: ''
ms.assetid: f7060778-3421-402c-97c7-735dbf6a61e8
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 02/22/2018
ms.author: sethm
ms.openlocfilehash: be23d919b0c96d6c9b96ee328d1b18ad978a9dcc
ms.sourcegitcommit: fbba5027fa76674b64294f47baef85b669de04b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/24/2018
ms.locfileid: "29558098"
---
# <a name="chaining-service-bus-entities-with-auto-forwarding"></a>Объединение в цепочки сущностей служебной шины с помощью автоматической переадресации

Функция *автоматической переадресации* служебной шины позволяет привязать очередь или подписку к другой очереди или разделу, которые являются частью одного и того же пространства имен. Если включена автоматическая переадресация, служебная шина автоматически удаляет сообщения, помещенные в первую очередь или подписку (источник), и помещает их во вторую очередь или раздел (место назначения). Обратите внимание, что при этом сохраняется возможность отправить сообщение в конечную сущность напрямую. Кроме того, подочередь (например, очередь недоставленных сообщений) нельзя привязать к другой очереди или разделу.

## <a name="using-auto-forwarding"></a>Использование автоматической переадресации

Автоматическую пересылку можно включить, задав свойства [QueueDescription.ForwardTo][QueueDescription.ForwardTo] или [SubscriptionDescription.ForwardTo][SubscriptionDescription.ForwardTo] объектов источника [QueueDescription][QueueDescription] или [SubscriptionDescription][SubscriptionDescription], как показано в следующем примере:

```csharp
SubscriptionDescription srcSubscription = new SubscriptionDescription (srcTopic, srcSubscriptionName);
srcSubscription.ForwardTo = destTopic;
namespaceManager.CreateSubscription(srcSubscription));
```

Конечная сущность должна существовать на момент создания исходной сущности. Если конечной сущности не существует, служебная шина возвращает исключение при попытке создать исходную сущность.

С помощью автоматической переадресации можно выполнить масштабирование отдельного раздела. Служебная шина ограничивает [количество подписок на определенный раздел](service-bus-quotas.md) до 2000. Создав разделы второго уровня, можно разместить дополнительные подписки. Даже при отсутствии ограничения служебной шины на количество подписок, добавление разделов второго уровня может повысить общую пропускную способность раздела.

![Сценарий автоматической пересылки][0]

С помощью автоматической переадресации также можно разделить отправителей и получателей сообщений. Например, рассмотрим систему ERP, состоящую из трех модулей: обработки заказов, управления запасами и управления отношениями с клиентами. Каждый из этих модулей создает сообщения, передаваемые в очередь в соответствующем разделе. Алиса и Роберт — торговые представители, которых интересуют все сообщения, относящиеся к своим клиентам. Для получения этих сообщений Алиса и Боб создают персональные очереди и подписки в каждом из разделов ERP, которые автоматически пересылают все сообщения в их очереди.

![Сценарий автоматической пересылки][1]

Если Алиса уйдет в отпуск, то заполнится ее личная очередь, а не очередь раздела ERP. В этом сценарии ни один из разделов ERP не достигнет выделенной квоты, так как торговый представитель не получил ни одного сообщения.

## <a name="auto-forwarding-considerations"></a>Рекомендации при использовании автоматической пересылки

Если целевая сущность накапливает слишком много сообщений и превышает квоту или целевая сущность отключена, то исходная сущность добавляет сообщения в [очередь недоставленных сообщений](service-bus-dead-letter-queues.md) до тех пор, пока в целевой сущности не появится место (или пока целевая сущность не будет снова включена). Эти сообщения будут находиться в очереди недоставленных сообщений, поэтому необходимо явным образом получать и обрабатывать их из этой очереди.

При объединении в цепочку отдельных разделов для получения составного раздела с несколькими подписками рекомендуется сократить количество подписок на раздел первого уровня до умеренного и увеличить количество подписок на разделы второго уровня. Например, раздел первого уровня с 20 подписками, каждая из которых объединена в цепочку с разделом второго уровня с 200 подписками, позволяет получить более высокую пропускную способность по сравнению с разделом первого уровня с 200 подписками, каждая из которых объединена в цепочку с разделом второго уровня с 20 подписками.

Служебная шина тарифицирует каждое перенаправленное сообщение как одну операцию. Например, отправка сообщения в раздел с 20 подписками, каждая из которых настроена на автоматическую переадресацию сообщений в другую очередь или раздел, тарифицируется как 21 операция, если все подписки первого уровня получили копию сообщения.

Для создания подписки, привязанной к другой очереди или разделу, создатель подписки должен иметь разрешение на **управление** как исходной, так и целевой сущностями. Для отправки сообщений в исходный раздел требуется только разрешение на **отправку** для исходного раздела.

## <a name="next-steps"></a>Дополнительная информация

Подробные сведения об автоматической пересылке см. в следующих разделах:

* [ForwardTo][QueueDescription.ForwardTo]
* [QueueDescription][QueueDescription]
* [SubscriptionDescription][SubscriptionDescription]

Дополнительные сведения об улучшении производительности служебной шины см. в статье 

* [Рекомендации по повышению производительности с помощью обмена сообщениями через служебную шину](service-bus-performance-improvements.md)
* [Секционированные сущности обмена сообщениями][Partitioned messaging entities].

[QueueDescription.ForwardTo]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.forwardto#Microsoft_ServiceBus_Messaging_QueueDescription_ForwardTo
[SubscriptionDescription.ForwardTo]: /dotnet/api/microsoft.servicebus.messaging.subscriptiondescription.forwardto#Microsoft_ServiceBus_Messaging_SubscriptionDescription_ForwardTo
[QueueDescription]: /dotnet/api/microsoft.servicebus.messaging.queuedescription
[SubscriptionDescription]: /dotnet/api/microsoft.servicebus.messaging.queuedescription
[0]: ./media/service-bus-auto-forwarding/IC628631.gif
[1]: ./media/service-bus-auto-forwarding/IC628632.gif
[Partitioned messaging entities]: service-bus-partitioning.md
