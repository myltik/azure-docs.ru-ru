---
title: Откладывание сообщений служебной шины Azure | Документация Майкрософт
description: Откладывание доставки сообщений служебной шины.
services: service-bus-messaging
documentationcenter: ''
author: clemensv
manager: timlt
editor: ''
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/26/2018
ms.author: sethm
ms.openlocfilehash: bece2be88a020610dfd3d22f15f7d276d99bb153
ms.sourcegitcommit: ded74961ef7d1df2ef8ffbcd13eeea0f4aaa3219
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2018
ms.locfileid: "28196981"
---
# <a name="message-deferral"></a>Откладывание сообщений

Когда клиент очереди или подписки получает сообщение, которое требуется обработать, но в настоящее время это невозможно из-за особых обстоятельств в приложении, он имеет возможность "отложить" получение этого сообщения на потом. Сообщение остается в очереди или подписке, но игнорируется.

Функция откладывания создана специально для сценариев обработки рабочих процессов. Платформы рабочих процессов могут требовать обработки определенных операций в заданном порядке, для чего может потребоваться отложить обработку некоторых полученных сообщений до завершения предписанных предшествующих операций, указанных в других сообщениях.

Простой наглядный пример — это последовательность обработки, в которой уведомление об оплате от внешнего поставщика платежных услуг появляется в системе до того, как соответствующий заказ на покупку был передан из магазина в систему обработки заказов. В этом случае система обработки заказов может отложить обработку уведомления об оплате, пока не появится заказ, с которым его можно будет связать. В сценариях рандеву, где сообщения из различных источников управляют рабочим процессом, порядок выполнения в режиме реального времени на самом деле может быть правильным, но сообщения, отражающие результаты обработки, могут приходить в неправильном порядке.

В конечном счете откладывание помогает изменить порядок, в котором сообщения поступают, на порядок, в котором они могут быть обработаны, сохраняя их в надежном хранилище сообщений, для которого требуется отложить обработку сообщений.

## <a name="message-deferral-apis"></a>Интерфейсы API откладывания сообщений

Доступные API: [BrokeredMessage.Defer](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.defer?view=azureservicebus-4.1.1#Microsoft_ServiceBus_Messaging_BrokeredMessage_Defer) или [BrokeredMessage.DeferAsync](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deferasync?view=azureservicebus-4.1.1#Microsoft_ServiceBus_Messaging_BrokeredMessage_DeferAsync) в клиенте .NET Framework, [MessageReceiver.DeferAsync](/dotnet/api/microsoft.azure.servicebus.core.messagereceiver.deferasync) в клиенте .NET Standard и **mesageReceiver.defer** или **messageReceiver.deferSync** в клиенте Java. 

Отложенные сообщения остаются в основной очереди вместе с другими активными сообщениями (в отличие от недоставленных сообщений, находящихся в подочереди), но их больше невозможно получить с помощью обычных функций Receive и ReceiveAsync. Отложенные сообщения можно будет обнаружить посредством [обзора сообщений](message-browsing.md), если приложение потеряет их.

Для получения отложенного сообщения его владелец обязан запомнить значение [SequenceNumber](/dotnet/api/microsoft.azure.servicebus.message.systempropertiescollection.sequencenumber#Microsoft_Azure_ServiceBus_Message_SystemPropertiesCollection_SequenceNumber), присваиваемое при откладывании. Любой получатель, который знает последовательный номер отложенного сообщения, позже сможет получить сообщение явным образом с помощью функции `Receive(sequenceNumber)`.

Если сообщение не удается обработать, так как конкретный ресурс для его обработки временно недоступен, но обработку этого сообщения нельзя бесцеремонно приостанавливать, можно отложить это сообщение в сторону на несколько минут, запомнив значение **SequenceNumber** в [запланированном сообщении](message-sequencing.md), которое должно быть опубликовано через несколько минут, и повторно получить отложенное сообщение при получении этого запланированного сообщения. Обратите внимание на то, что если все операции обработчика сообщений зависят от базы данных, и она временно недоступна, то следует не откладывать, полностью приостанавливать получение сообщений, пока эта база данных снова не будет доступна.

Откладывание сообщений не влияет на срок их действия, то есть срок действия отложенных сообщений по-прежнему истекает в изначально запланированное время, затем они перемещаются в очередь недоставленных сообщений, если указаны соответствующие настройки.

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения об обмене сообщениями через служебную шину см. в следующих статьях:

* [Базовая информация о служебной шине](service-bus-fundamentals-hybrid-solutions.md)
* [Очереди, разделы и подписки служебной шины](service-bus-queues-topics-subscriptions.md)
* [Начало работы с очередями служебной шины](service-bus-dotnet-get-started-with-queues.md)
* [Как использовать разделы и подписки служебной шины](service-bus-dotnet-how-to-use-topics-subscriptions.md)