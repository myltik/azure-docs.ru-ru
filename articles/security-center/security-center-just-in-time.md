---
title: JIT-доступ к виртуальным машинам в центре безопасности Azure | Документы Майкрософт
description: В этом документе описано, как управлять доступом к виртуальным машинам Azure в центре безопасности Azure с помощью JIT-доступа (доступ только в течение заданного времени).
services: security-center
documentationcenter: na
author: TerryLanfear
manager: MBaldwin
editor: ''
ms.assetid: ''
ms.service: security-center
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/04/2018
ms.author: terrylan
ms.openlocfilehash: e293f085eb6c4c90b26ac6035d50d74f5cdd7269
ms.sourcegitcommit: b6319f1a87d9316122f96769aab0d92b46a6879a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2018
ms.locfileid: "34366894"
---
# <a name="manage-virtual-machine-access-using-just-in-time"></a>Управление доступом к виртуальным машинам с помощью JIT

JIT-доступ к виртуальной машине позволяет заблокировать входящий трафик к виртуальным машинам Azure, снизить уязвимость к атакам и обеспечить удобный доступ к виртуальным машинам, когда это необходимо.

> [!NOTE]
> Функция JIT доступна в центре безопасности Azure уровня "Стандартный".  Дополнительные сведения о ценовых категориях центра безопасности см. на странице [Цены](security-center-pricing.md).
>
>

## <a name="attack-scenario"></a>Сценарий атаки

Целью атак методом подбора часто становятся порты управления как средство получения доступа к виртуальной машине. В случае успешной атаки злоумышленник может установить контроль над виртуальной машиной и закрепиться в вашей среде.

Один из способов снижения вероятности атаки методом подбора — ограничить количество времени, в течение которого порт открыт. Порты управления не должны быть открыты всегда. Они должны быть открыты только при подключении к виртуальной машине, например для выполнения задач управления или обслуживания. Если JIT-доступ включен, центр безопасности использует правила [группы безопасности сети](../virtual-network/security-overview.md#security-rules), которые ограничивают доступ к портам управления, чтобы они не стали целью злоумышленников.

![Сценарий JIT][1]

## <a name="how-does-just-in-time-access-work"></a>Как работает доступ JIT?

Если JIT включен, центр безопасности блокирует входящий трафик для виртуальной машины Azure путем создания правила группы безопасности сети. Вы выбираете порты на виртуальной машине, для которых будет заблокирован входящий трафик. Этими портами управляет решение JIT.

Когда пользователь запрашивает доступ к виртуальной машине, центр безопасности проверяет, что у пользователя есть разрешения [управления доступом на основе ролей (RBAC)](../role-based-access-control/role-assignments-portal.md), которые предоставляют доступ на запись для виртуальной машины. Если у пользователя есть разрешение на запись, доступ разрешается, и центр безопасности автоматически настраивает группу безопасности сети, которая разрешает передачу входящего трафика через выбранные порты на указанный период времени. После истечения этого времени центр безопасности восстанавливает прежнее состояние групп безопасности сети.

> [!NOTE]
> JIT-доступ с использованием центра безопасности сейчас поддерживается только для виртуальных машин, развернутых с помощью Azure Resource Manager. Дополнительные сведения о классической модели развертывания и модели развертывания Resource Manager см. в разделе [Модель развертывания Azure Resource Manager и классическая модель развертывания](../azure-resource-manager/resource-manager-deployment-model.md).
>
>

## <a name="using-just-in-time-access"></a>Использование JIT-доступа

1. Откройте панель мониторинга **центра безопасности**.

2. В левой области выберите **JIT-доступ к виртуальной машине**.

![Элемент "JIT-доступ к виртуальной машине"][2]

Откроется окно **JIT-доступ к виртуальной машине**.

![Элемент "JIT-доступ к виртуальной машине"][10]

В колонке **JIT-доступ к виртуальной машине** содержатся сведения о состоянии виртуальных машин.

- **Настроенные** — виртуальные машины, для которых был настроен JIT-доступ. Указываются сведения за последнюю неделю, которые включают число одобренных запросов, дату и время последнего доступа и последнего пользователя для каждой виртуальной машины.
- **Рекомендуемые** — виртуальные машины, которые поддерживают JIT-доступ, но для которых он не настроен. Рекомендуется включить JIT-доступ для этих виртуальных машин. Ознакомьтесь с разделом [Настройка политики JIT-доступа](#configuring-a-just-in-time-access-policy).
- **Нерекомендуемые** — причины, по которым виртуальная машина может попасть в эту группу, включают следующие:
  - Отсутствует группа безопасности сети — для решения JIT необходима группа безопасности сети.
  - Классическая виртуальная машина — JIT-доступ с использованием центра безопасности сейчас поддерживается только для виртуальных машин, развернутых с помощью Azure Resource Manager. JIT-доступ для классической модели развертывания не поддерживается.
  - Другое — виртуальная машина находится в этой категории, если решение JIT отключено в политике безопасности подписки или группы ресурсов или если виртуальная машина не имеет общедоступного IP-адреса и для нее не создана группа безопасности сети.

## <a name="configuring-a-just-in-time-access-policy"></a>Настройка политики JIT-доступа

Чтобы выбрать виртуальные машины, для которых вы хотите включить JIT-доступ, выполните следующие действия:

1. В колонке **JIT-доступ к виртуальной машине** перейдите на вкладку **Рекомендуемые**.

  ![Включение JIT-доступа][3]

2. В разделе **Виртуальная машина** выберите виртуальные машины, доступ к которым нужно включить. При этом устанавливается флажок рядом с виртуальной машиной.
3. Выберите **Включить JIT-доступ для виртуальных машин**.
4. Щелкните **Сохранить**.

### <a name="default-ports"></a>Номера портов по умолчанию

Вы увидите номера портов, которые центр безопасности рекомендует открыть для JIT-доступа.

1. В колонке **JIT-доступ к виртуальной машине** перейдите на вкладку **Рекомендуемые**.

  ![Отображение номеров портов по умолчанию][6]

2. В разделе **Виртуальные машины** выберите виртуальную машину. При этом устанавливается флажок рядом с виртуальной машиной и открывается колонка **Настройка JIT-доступа к виртуальной машине**. В этой колонке отображаются порты по умолчанию.

### <a name="add-ports"></a>Добавление портов

В колонке **Настройка JIT-доступа к виртуальной машине** также можно добавить и настроить новый порт, который будет использоваться для JIT-доступа.

1. В колонке **Настройка JIT-доступа к виртуальной машине** выберите **Добавить**. Откроется колонка **Добавление конфигурации порта**.

  ![Конфигурация порта][7]

2. В колонке **Добавление конфигурации порта** укажите порт, тип протокола, допустимые IP-адреса источника и максимальное время запроса.

  Допустимые IP-адреса источника — это диапазоны IP-адресов, с которых можно получить доступ по утвержденному запросу.

  Максимальное время запроса — это максимальный интервал времени, в течение которого может быть открыт конкретный порт.

3. Нажмите кнопку **ОК**.

## <a name="requesting-access-to-a-vm"></a>Запрос доступа к виртуальной машине

Чтобы запросить доступ к виртуальной машине, выполните следующие действия:

1. В колонке **JIT-доступ к виртуальной машине** перейдите на вкладку **Настроенные**.
2. В разделе **Виртуальные машины** выберите виртуальные машины, для которых вы хотите включить JIT-доступ. При этом устанавливается флажок рядом с виртуальной машиной.
3. Выберите **Запросить доступ**. При этом откроется колонка **Запрос на доступ**.

  ![Запрос доступа к виртуальной машине][4]

4. В колонке **Запрос на доступ** для каждой виртуальной машины необходимо указать открытые порты, IP-адрес источника, на котором открыт порт, и временной интервал, в течение которого открыт порт. Можно запросить доступ только к портам, которые настроены в политике JIT. Максимально допустимое время для каждого порта определяется из политики JIT.
5. Выберите **Открыть порты**.

> [!NOTE]
> Когда пользователь запрашивает доступ к виртуальной машине, центр безопасности проверяет, что у пользователя есть разрешения [управления доступом на основе ролей (RBAC)](../role-based-access-control/role-assignments-portal.md), которые предоставляют доступ на запись для виртуальной машины. Если у него есть разрешения на запись, то запрос утверждается.
>
>

> [!NOTE]
> Если пользователь запрашивает доступ через прокси-сервер, то параметр "Мой IP-адрес" может не работать. Возможно, необходимо определить полный диапазон адресов организации.
>
>

## <a name="editing-a-just-in-time-access-policy"></a>Изменение политики JIT-доступа

Вы можете изменить существующую политику JIT-доступа для виртуальной машины, добавив и настроив новый открытый порт для этой виртуальной машины или изменив любой другой параметр уже настроенного защищенного порта.

Для изменения существующей политики JIT-доступа виртуальной машины используется вкладка **Настроенные**:

1. В разделе **Виртуальные машины** выберите виртуальную машину, для которой необходимо добавить порт, щелкнув многоточие в строке для этой виртуальной машины. Откроется меню.
2. Выберите **Изменить** в меню. Откроется колонка **Настройка JIT-доступа к виртуальной машине**.

  ![Изменение политики][8]

3. В колонке **Настройка JIT-доступа к виртуальной машине** можно изменить существующие параметры уже защищенного порта, щелкнув его, или добавить новый порт, щелкнув **Добавить**. Откроется колонка **Добавление конфигурации порта**.

  ![Добавление порта][7]

4. В колонке **Добавление конфигурации порта** укажите порт, тип протокола, допустимые IP-адреса источника и максимальное время запроса.
5. Нажмите кнопку **ОК**.
6. Щелкните **Сохранить**.

## <a name="auditing-just-in-time-access-activity"></a>Аудит действий JIT-доступа

Для просмотра действий виртуальной машины можно воспользоваться поиском по журналам. Для просмотра журналов выполните следующие действия:

1. В колонке **JIT-доступ к виртуальной машине** перейдите на вкладку **Настроенные**.
2. В разделе **Виртуальные машины** выберите виртуальную машину, сведения о которой нужно просмотреть, щелкнув многоточие в строке для этой виртуальной машины. Откроется меню.
3. Выберите **Журнал действий** в меню. Откроется колонка **Журнал действий**.

  ![Выбор журнала действий][9]

  В колонке **Журнал действий** отображается отфильтрованный список предыдущих операций для этой виртуальной машины, а также дата, время и подписка.

  ![Просмотр журнала действий][5]

Чтобы скачать сведения журналов, воспользуйтесь ссылкой **Щелкните здесь, чтобы загрузить все элементы в формате CSV**.

Чтобы изменить отображаемые сведения журнала, измените фильтры и нажмите **Применить**.

## <a name="using-just-in-time-vm-access-via-powershell"></a>Использование JIT-доступа через PowerShell

Для использования JIT-доступа через PowerShell убедитесь, что у вас установлена [последняя](/powershell/azure/install-azurerm-ps) версия Azure PowerShell.
После этого установите [последнюю](https://aka.ms/asc-psgallery) версию центра безопасности Azure из коллекции PowerShell.

### <a name="configuring-a-just-in-time-policy-for-a-vm"></a>Настройка политики JIT-доступа для виртуальной машины

Чтобы настроить политику JIT-доступа для виртуальной машины, выполните следующую команду в сеансе PowerShell: Set-ASCJITAccessPolicy.
Дополнительные сведения см. в документации по командлету.

### <a name="requesting-access-to-a-vm"></a>Запрос доступа к виртуальной машине

Для доступа к виртуальной машине, защищенной с помощью политики JIT-доступа, выполните следующую команду в сеансе PowerShell: Invoke-ASCJITAccess.
Дополнительные сведения см. в документации по командлету.

## <a name="next-steps"></a>Дополнительная информация
Из этой статьи вы узнали, как управлять доступом к виртуальным машинам Azure с помощью JIT-доступа в центре безопасности.

Дополнительные сведения о Центре безопасности см. в следующих статьях:

- [Настройка политик безопасности](security-center-policies.md) — сведения о настройке политик безопасности для подписок и групп ресурсов Azure.
- [Управление рекомендациями по безопасности](security-center-recommendations.md) — сведения об использовании рекомендаций для защиты ресурсов Azure.
- [Наблюдение за работоспособностью системы безопасности](security-center-monitoring.md) — сведения об отслеживании работоспособности ресурсов Azure.
- [Управление оповещениями безопасности](security-center-managing-and-responding-alerts.md) — сведения об управлении оповещениями системы безопасности и реагировании на них.
- [Мониторинг решений партнеров](security-center-partner-solutions.md) — сведения об отслеживании работоспособности решений партнеров.
- [Центр безопасности: часто задаваемые вопросы](security-center-faq.md). Часто задаваемые вопросы об использовании этой службы.
- [Блог по безопасности Azure](https://blogs.msdn.microsoft.com/azuresecurity/) — публикации блога, посвященные безопасности и соответствию требованиям в Azure.


<!--Image references-->
[1]: ./media/security-center-just-in-time/just-in-time-scenario.png
[2]: ./media/security-center-just-in-time/just-in-time.png
[10]: ./media/security-center-just-in-time/just-in-time-access.png
[3]: ./media/security-center-just-in-time/enable-just-in-time-access.png
[4]: ./media/security-center-just-in-time/request-access-to-a-vm.png
[5]: ./media/security-center-just-in-time/activity-log.png
[6]: ./media/security-center-just-in-time/default-ports.png
[7]: ./media/security-center-just-in-time/add-a-port.png
[8]: ./media/security-center-just-in-time/edit-policy.png
[9]: ./media/security-center-just-in-time/select-activity-log.png
