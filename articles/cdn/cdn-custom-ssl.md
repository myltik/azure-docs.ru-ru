---
title: Настройка протокола HTTPS для личного домена в сети доставки содержимого Azure | Документация Майкрософт
description: Узнайте, как включить или отключить протокол HTTPS для конечной точки Azure CDN с личным доменом.
services: cdn
documentationcenter: ''
author: dksimpson
manager: ''
editor: ''
ms.assetid: 10337468-7015-4598-9586-0b66591d939b
ms.service: cdn
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/22/2018
ms.author: casoper
ms.openlocfilehash: fea7121fc67944b20b8f39007edb0c0aad86aeaa
ms.sourcegitcommit: d74657d1926467210454f58970c45b2fd3ca088d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="configure-https-on-an-azure-content-delivery-network-custom-domain"></a>Настройка протокола HTTPS для личного домена в сети доставки содержимого Azure

[!INCLUDE [cdn-verizon-only](../../includes/cdn-verizon-only.md)]

Майкрософт поддерживает протокол HTTPS для личных доменов в сети доставки содержимого (CDN) Azure. Благодаря этому вы можете доставлять защищенное содержимое через протокол SSL, используя собственное имя домена для повышения безопасности данных в процессе передачи. Включение HTTPS-подключение сведено к нажатию всего лишь одной кнопки. Кроме того, вы получаете в свое распоряжение полноценное управление сертификатами. И все это без дополнительных затрат с вашей стороны.

Крайне важно обеспечить неприкосновенность и целостность конфиденциальных данных веб-приложения в процессе их передачи. Протокол HTTPS обеспечивает шифрование конфиденциальных данных при их передаче через Интернет. Он обеспечивает доверие, проверку подлинности и защиту веб-приложений от атак. По умолчанию Azure CDN поддерживает HTTPS в конечных точках CDN. К примеру, при создании конечной точки CDN из Azure CDN (например, https:\//contoso.azureedge.net) протокол HTTPS включен по умолчанию. Кроме того, благодаря возможности использования HTTPS в личном домене для такого домена (например, https:\//www.contoso.com) можно также включить безопасную доставку. 

Ниже приведены некоторые ключевые характеристики компонента HTTPS.

- Никаких дополнительных затрат: вам не придется оплачивать приобретение или продление сертификата или платить за трафик, переданный по протоколу HTTPS. Вы платите только за исходящий трафик из CDN.

- Простое включение: на [портале Azure](https://portal.azure.com) доступна подготовка одним щелчком. Для включения этого компонента можно также использовать REST API или другие средства разработки.

- Полноценное управление сертификатами: закупка всех сертификатов и управление ими осуществляется без вашего участия. Сертификаты автоматически подготавливаются и продлеваются до истечения их срока действия, что устраняет риски прерывания работы службы в связи с истечением срока действия сертификата.

>[!NOTE] 
>Перед включением поддержки протокола HTTPS необходимо установить [личный домен Azure CDN](./cdn-map-content-to-custom-domain.md).

## <a name="enabling-https"></a>Включение протокола HTTPS

Ниже описана процедура включения протокола HTTPS для личного домена.

### <a name="step-1-enable-the-feature"></a>Шаг 1. Включение компонента 

1. На [портале Azure](https://portal.azure.com) перейдите к профилю CDN категории "Стандартный" или "Премиум" от Verizon.

2. В списке конечных точек щелкните ту из них, которая содержит личный домен.

3. Щелкните личный домен, для которого требуется включить HTTPS.

    ![Список личных доменов](./media/cdn-custom-ssl/cdn-custom-domain.png)

4. Щелкните **Вкл.**, чтобы включить HTTPS, а затем нажмите кнопку **Применить**.

    ![Состояние HTTPS для личного домена](./media/cdn-custom-ssl/cdn-enable-custom-ssl.png)


### <a name="step-2-validate-domain"></a>Шаг 2. Проверка домена

>[!NOTE]
>Если у поставщика DNS имеется запись авторизации центра сертификации, то она должна включать DigiCert как допустимый ЦС. Запись авторизации ЦС позволяет владельцам доменов указывать своим поставщикам DNS, какие ЦС уполномочены выдавать сертификаты безопасности для их домена. Если ЦС получает заказ на сертификат для домена, который имеет запись авторизации ЦС, и этот ЦС не указан как уполномоченный издатель, тогда этому домену или поддомену запрещается выдавать сертификат безопасности. Сведения об управлении записями авторизации ЦС см. в [этой статье](https://support.dnsimple.com/articles/manage-caa-record/). Средство для работы с записями авторизации ЦС доступно [здесь](https://sslmate.com/caa/).

#### <a name="custom-domain-is-mapped-to-cdn-endpoint"></a>Пользовательский домен сопоставлен с конечной точкой CDN

Добавив настраиваемый домен для конечной точки, вы создали в таблице DNS вашего регистратора домена запись CNAME, которая сопоставляет домен с именем узла конечной точки CDN. Если запись CNAME еще существует и не содержит поддомен cdnverify, центр сертификации DigiCert использует ее для проверки прав владения доменом. 

Запись CNAME должна иметь указанный ниже формат, где *Name* обозначает пользовательское доменное имя, а *Value* — имя узла конечной точки CDN:

| ИМЯ            | type  | Значение                 |
|-----------------|-------|-----------------------|
| www.contoso.com; | CNAME | contoso.azureedge.net |

Дополнительные сведения о записи CNAME см. в разделе [о создании записи CNAME в DNS](https://docs.microsoft.com/en-us/azure/cdn/cdn-map-content-to-custom-domain#step-2-create-the-cname-dns-records).

Если запись CNAME имеет правильный формат, DigiCert автоматически подтверждает пользовательское доменное имя и добавляет его к сертификату SAN. DigitCert не будет отправлять писем для подтверждения и вам не нужно подтверждать этот запрос. Сертификат будет действителен в течение одного года, а перед истечением срока действия — автоматически продлеваться. Переходите к шагу 3 ([Ожидание распространения](#step-3-wait-for-propagation)). 

#### <a name="cname-record-is-not-mapped-to-cdn-endpoint"></a>Запись CNAME не сопоставлена с конечной точкой CDN

Если запись CNAME для конечной точки не существует или содержит поддомен cdnverify, следуйте инструкциям в этом шаге.

При включении HTTPS для личного домена центр сертификации DigiCert (ЦС) проверяет право собственности на ваш домен, связавшись с пользователем, выполнившим регистрацию, в соответствии с информацией в базе данных [WHOIS](http://whois.domaintools.com/) для домена. Контакт осуществляется по электронной почте (по умолчанию) или телефону, указанному в базе данных WHOIS. Чтобы поддержка HTTPS стала активной для личного домена, необходимо выполнить его проверку. Для подтверждения домена у вас есть шесть рабочих дней. Запросы, которые не утверждены в течение шести рабочих дней, будут автоматически отменены. 

![Запись WHOIS](./media/cdn-custom-ssl/whois-record.png)

DigiCert также отправляет письмо для подтверждения на дополнительные адреса электронной почты. Если сведения о регистрируемом пользователе в базе данных WHOIS являются частными, убедитесь, что возможно утверждение непосредственно с одного из этих адресов:

admin@&lt;имя_вашего_домена.com&gt;  
administrator@&lt;имя_вашего_домена.com&gt;  
webmaster@&lt;имя_вашего_домена.com&gt;  
hostmaster@&lt;имя_вашего_домена.com&gt;  
postmaster@&lt;имя_вашего_домена.com&gt;  

Через несколько минут должно появиться электронное сообщение, как показано в следующем примере, с просьбой подтвердить запрос. При использовании фильтра нежелательной почты добавьте admin@digicert.com в список разрешений. Если вы не получите электронное сообщение в течение 24 часов, обратитесь в службу поддержки Майкрософт.
    
![Письмо для подтверждения заказа на сертификат](./media/cdn-custom-ssl/domain-validation-email.png)

При щелчке ссылки для подтверждения запроса откроется следующая онлайн-форма: 
    
![Форма подтверждения для домена](./media/cdn-custom-ssl/domain-validation-form.png)

Следуйте инструкциям в форме. Есть два варианта проверки:

- Можно утвердить все будущие заказы, оформленные с использованием одной и той же учетной записи для одного корневого домена, например contoso.com. Этот подход рекомендуется, если планируется добавлять дополнительные пользовательские домены для одного корневого домена.

- Можно просто утвердить конкретное имя узла, которое используется в данном запросе. Для последующих запросов требуются дополнительные утверждения.

После утверждения DigiCert добавляет имя личного домена в сертификат SAN. Сертификат будет действителен в течение года и автоматически продлен до истечения его срока действия.

### <a name="step-3-wait-for-propagation"></a>Шаг 3. Ожидание распространения

Активация компонента HTTPS для личного домена после проверки доменного имени может занять до 6–8 часов. Когда процесс будет завершен, состояние пользовательского HTTPS на портале Azure будет иметь значение **Вкл.**, а четыре шага в диалоговом окне пользовательского домена будут отмечены как завершенные. Личный домен готов для использования протокола HTTPS.

![Диалоговое окно "Включить HTTPS"](./media/cdn-custom-ssl/cdn-enable-custom-ssl-complete.png)

### <a name="operation-progress"></a>Ход выполнения операции

В следующей таблице показан ход операции, возникающей при включении HTTPS. После включения HTTPS в диалоговом окне личного домена отобразятся четыре шага операции. По мере активации этих шагов в них появляются вложенные шаги со сведениями о ходе выполнения. Не все из вложенных шагов будут выполняться. После успешного завершения шага рядом с ним появится зеленый флажок. 

| Шаг операции | Сведения о вложенном шаге операции | 
| --- | --- |
| 1. Отправка запроса | Отправка запроса |
| | Отправляется HTTP-запрос. |
| | HTTPS-запрос успешно отправлен. |
| 2. Проверка домена | Мы отправили вам электронное сообщение с просьбой подтвердить право собственности на домен. Ожидание подтверждения. ** |
| | Владение доменом успешно подтверждено. |
| | Истек срок действия запроса на подтверждение прав владения доменом (клиент, скорее всего, не ответил в течение 6 дней). HTTPS не будет включен в вашем домене. * |
| | Клиент отклонил запрос на подтверждение прав собственности на домен. HTTPS не будет включен в вашем домене. * |
| 3. Подготовка сертификата | В настоящее время центр сертификации выдает сертификат, необходимый для включения HTTPS в вашем домене. |
| | Сертификат был выдан и в настоящее время развертывается в сеть доставки содержимого. Это может занять до 6 часов. |
| | Сертификат успешно развернут в сети доставки содержимого. |
| 4. Завершение | HTTPS успешно включен для вашего домена. |

\* Это сообщение отображается, только если произошла ошибка. 

\** Это сообщение не отображается, если для личного домена существует запись CNAME, которая указывает на имя узла конечной точки CDN.

Если перед отправкой запроса возникает ошибка, появится следующее сообщение об ошибке:

<code>
We encountered an unexpected error while processing your HTTPS request. Please try again and contact support if the issue persists.
</code>

## <a name="disabling-https"></a>Отключение HTTPS

Включенный протокол HTTPS в личном домене можно отключить. Чтобы отключить протокол HTTPS, выполните приведенные ниже действия.

### <a name="step-1-disable-the-feature"></a>Шаг 1. Отключение компонента 

1. На [портале Azure](https://portal.azure.com) перейдите к профилю CDN категории "Стандартный" или "Премиум" от Verizon.

2. В списке конечных точек щелкните ту из них, которая содержит личный домен.

3. Щелкните личный домен, для которого требуется отключить HTTPS.

    ![Список личных доменов](./media/cdn-custom-ssl/cdn-custom-domain-HTTPS-enabled.png)

4. Щелкните **Выкл.**, чтобы отключить HTTPS, а затем нажмите кнопку **Применить**.

    ![Диалоговое окно "Настраиваемый HTTPS"](./media/cdn-custom-ssl/cdn-disable-custom-ssl.png)

### <a name="step-2-wait-for-propagation"></a>Шаг 2. Ожидание распространения

После отключения компонента HTTPS личного домена для вступления изменений в силу может потребоваться до 6–8 часов. Когда процесс будет завершен, состояние пользовательского HTTPS на портале Azure будет иметь значение **Выкл.**, а три шага в диалоговом окне пользовательского домена будут отмечены как завершенные. Личный домен больше не сможет использовать HTTPS.

![Диалоговое окно "Отключить HTTPS"](./media/cdn-custom-ssl/cdn-disable-custom-ssl-complete.png)

### <a name="operation-progress"></a>Ход выполнения операции

В следующей таблице показан ход операции, возникающей при отключении HTTPS. После отключения HTTPS в диалоговом окне личного домена отобразятся три шага. По мере того, как каждый шаг становится активным, под ним появляются дополнительные сведения. После успешного завершения шага рядом с ним появится зеленый флажок. 

| Ход выполнения операции | Сведения об операции | 
| --- | --- |
| 1. Отправка запроса | Отправка запроса |
| 2. Отзыв сертификата | Удаление сертификата |
| 3. Завершение | Сертификат удален |

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

1. *Кто является поставщиком сертификата и какой тип сертификата используется?*

    Корпорация Майкрософт использует сертификат альтернативного имени субъекта (SAN), предоставленный DigiCert. С помощью одного сертификата SAN можно защитить несколько полных доменных имен.

2. *Могу ли я использовать выделенный сертификат?*
    
    Сейчас это невозможно, но мы планируем добавить такую возможность.

3. *Что делать, если я не получу сообщение электронной почты для проверки домена от DigiCert?*

    Если вы не получите электронное сообщение в течение 24 часов, обратитесь в службу поддержки Майкрософт. Если для личного домена существует запись CNAME, которая указывает на имя узла конечной точки (и в домене не существует поддомен cdnverify), вы не получите письмо с запросом на подтверждение домена. Проверка в этом случае проходит автоматически.

4. *Не окажется ли сертификат SAN менее безопасным, чем выделенный сертификат?*
    
    Для сертификата SAN используются те же стандарты безопасности и шифрования, что и для выделенного сертификата. Чтобы дополнительно обезопасить сервер, для всех выданных сертификатов SSL используется алгоритм SHA-256.

5. *Можно ли использовать HTTPS для личного домена с Azure CDN от Akamai?*

    На данный момент этот компонент доступен только для Azure CDN от Verizon. Мы работаем над тем, чтобы в ближайшие месяцы обеспечить его поддержку в Azure CDN от Akamai.

6. *Нужно ли иметь запись авторизации центра сертификации у моего поставщика DNS?*

    Нет, в настоящее время не требуется запись авторизации центра сертификации. Однако если у вас она есть, она должна включать DigiCert в качестве действительного центра сертификации.


## <a name="next-steps"></a>Дополнительная информация

- Узнайте, как настроить [личный домен в конечной точке Azure CDN](./cdn-map-content-to-custom-domain.md).


