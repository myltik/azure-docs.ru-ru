---
title: Управление режимом кэширования Azure CDN с помощью правил кэширования | Документация Майкрософт
description: Вы можете использовать правила кэширования сети доставки содержимого (CDN) или изменять истечение срока действия кэша по умолчанию как глобально, так и с условиями (например, URL-путь и расширения файла).
services: cdn
documentationcenter: ''
author: dksimpson
manager: akucer
editor: ''
ms.service: cdn
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/20/2018
ms.author: v-deasim
ms.openlocfilehash: 09705893c50e56cce5d888db097d7b810624b5d8
ms.sourcegitcommit: e221d1a2e0fb245610a6dd886e7e74c362f06467
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2018
---
# <a name="control-azure-cdn-caching-behavior-with-caching-rules"></a>Управление режимом кэширования Azure CDN с помощью правил кэширования

> [!NOTE] 
> Правила кэширования доступны только для профилей **Azure CDN уровня "Стандартный" от Verizon** и **Azure CDN уровня "Стандартный" от Akamai**. Для профилей **Azure CDN уровня "Премиум" от Verizon** необходимо использовать [обработчик правил Azure CDN](cdn-rules-engine.md) на портале **Управление** с аналогичными функциональными возможностями.
 
Сеть доставки содержимого Azure (CDN) предлагает два способа управления кэшированием файлов. 

- Правила кэширования. В этой статье описывается, как использовать правила кэширования сети доставки содержимого (CDN) или изменять истечение срока действия кэша по умолчанию как глобально, так и с настраиваемыми условиями (например, URL-путь и расширения файла). Azure CDN предоставляет два типа правил кэширования.

   - Глобальные правила кэширования. Вы можете задать в своем профиле одно глобальное правило кэширования для каждой конечной точки, которое влияет на все запросы к конечной точке. Глобальное правило кэширования переопределяет все заголовки директив кэша HTTP (если они заданы).

   - Настраиваемые правила кэширования. Вы можете задать одно или несколько настраиваемых правил кэширования для каждой конечной точки в профиле. Настраиваемые правила кэширования соответствуют конкретным путям и расширениям файлов, обрабатываются по порядку и переопределяют глобальное правило кэширования (если оно задано). 

- Кэширование строки запроса. Вы можете настроить обработку кэширования Azure CDN для запросов со строками запроса. Дополнительные сведения см. в статье [Управление режимом кэширования в сети доставки содержимого Azure с помощью строк запросов](cdn-query-string.md). Если файл невозможно кэшировать, параметр кэширования строки запроса не оказывает влияния, исходя из правил кэширования и поведения по умолчанию CDN.

Сведения о поведении кэширования по умолчанию и заголовках директив кэширования см. в статье [Как выполняется кэширование](cdn-how-caching-works.md). 


## <a name="accessing-azure-cdn-caching-rules"></a>Доступ к правилам кэширования Azure CDN

1. Откройте портал Azure, выберите профиль CDN, а затем конечную точку.

2. В области слева в разделе "Параметры" выберите **Правила кэширования**.

   ![Кнопка "Правила кэширования" CDN](./media/cdn-caching-rules/cdn-caching-rules-btn.png)

   Появится страница **Правила кэширования**.

   ![Страница правил кэширования CDN](./media/cdn-caching-rules/cdn-caching-rules-page.png)


## <a name="caching-behavior-settings"></a>Параметры поведения кэширования
Для глобальных и настраиваемых правил кэширования можно задать следующие параметры **поведения кэширования**.

- **Отключение кэша.** Не кэшировать и игнорировать предоставляемые системой заголовки директив кэша.

- **Переопределить.** Игнорировать предоставленные системой заголовки директив кэша и использовать вместо них продолжительность хранения в кэше.

- **Установить, если отсутствует.** Учитывать предоставленные системой заголовки директив кэша, если таковые имеются. В противном случае использовать продолжительность хранения в кэше.

![Глобальные правила кэширования](./media/cdn-caching-rules/cdn-global-caching-rules.png)

![Настраиваемые правила кэширования](./media/cdn-caching-rules/cdn-custom-caching-rules.png)

## <a name="cache-expiration-duration"></a>Срок действия кэша
Для глобальных и настраиваемых правил кэширования можно указать срок действия кэша в днях, часах, минутах и секундах.

- Для параметров **поведения кэширования** **Переопределить** и **Установить, если отсутствует** допустимая продолжительность хранения кэша варьируется от 0 секунд и до 366 дней. При значении 0 секунд CDN кэширует содержимое, но необходимо повторять проверку каждого запроса на сервере-источнике.

- Для параметра **Отключение кэша** в качестве продолжительности хранения в кэше автоматически устанавливается значение 0 секунд и его нельзя изменить.

## <a name="custom-caching-rules-match-conditions"></a>Условия соответствия настраиваемых правил кэширования

Для настраиваемых правил кэширования доступно два условия соответствия.
 
- **Путь.** Это условие соответствует пути URL-адреса, за исключением доменного имени, и в нем поддерживается подстановочный символ (\*). Например, _/myfile.html_, _/my/folder/*_ и _/my/images/*.jpg_. Максимальная длина составляет 260 символов.

- **Расширение.** Это условие соответствует расширению запрашиваемого файла. Вы можете предоставить список расширений файлов для соответствия (разделенных запятыми). Например, _.jpg_, _.mp3_ или _.png_. Максимальное количество расширений — 50, а максимальное количество символов на одно расширение — 16. 

## <a name="global-and-custom-rule-processing-order"></a>Порядок обработки глобального и настраиваемого правил
Глобальные и настраиваемые правила кэширования обрабатываются в следующем порядке.

- Глобальные правила кэширования имеют приоритет над поведением кэширования CDN по умолчанию (параметры заголовка директив кэша HTTP). 

- Настраиваемые правила кэширования имеют приоритет над глобальными правилами кэширования, где они применяются. Настраиваемые правила кэширования обрабатываются в порядке сверху вниз. То есть если запрос соответствует обоим условиям, правила в нижней части списка имеют приоритет над правилами в верхней части списка. Поэтому вы должны размещать конкретные правила ниже в списке.

**Пример**:
- Глобальное правило кэширования. 
   - Поведение кэширования: **Переопределить**
   - Срок действия кэша: 1 день

- Первое настраиваемое правило кэширования:
   - Условие соответствия: **путь**
   - Значение соответствия: _/home/*_.
   - Поведение кэширования: **Переопределить**
   - Срок действия кэша: 2 дня

- Второе настраиваемое правило кэширования:
   - Условие соответствия: **Расширение**
   - Значение соответствия: _.html_.
   - Поведение кэширования: **Установить, если отсутствует**
   - Срок действия кэша: 3 дня

Если эти правила установлены, запрос _&lt;имя узла конечной точки&gt;_.azureedge.net/home/index.html активирует второе настраиваемое правило кэширования, для которого задано значение **Установить, если отсутствует** и срок в 3 дня. Поэтому если в файле *index.html* есть заголовки HTTP `Cache-Control` или `Expires`, они учитываются. Если эти заголовки не заданы, файл кэшируется 3 дня.

> [!NOTE] 
> Файлы, которые сохраняются в кэше до изменения правила, поддерживают исходный параметр сроки кэширования. Чтобы сбросить продолжительность хранения в кэше, нужно [очистить файл](cdn-purge-endpoint.md). Для конечных точек **Azure CDN от Verizon** правила кэширования могут начать действовать через 90 минут.

## <a name="see-also"></a>См. также

- [Как выполняется кэширование](cdn-how-caching-works.md)
- [Tutorial: Set Azure CDN caching rules](cdn-caching-rules-tutorial.md) (Руководство. Настройка правил кэширования Azure CDN)
