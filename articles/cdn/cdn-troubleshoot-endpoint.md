---
title: Устранение неполадок с конечными точками Azure CDN, которые возвращают код состояния 404 | Документация Майкрософт
description: Устранение неполадок с конечными точками Azure CDN, связанных с кодами ответа 404.
services: cdn
documentationcenter: ''
author: zhangmanling
manager: erikre
editor: ''
ms.assetid: b588a1eb-ab69-4fc7-ae4d-157c3e46f4a8
ms.service: cdn
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/23/2017
ms.author: mazha
ms.openlocfilehash: 1cffef5bbda475032ee7ff07188ab0d9d52846ea
ms.sourcegitcommit: e221d1a2e0fb245610a6dd886e7e74c362f06467
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2018
ms.locfileid: "33766110"
---
# <a name="troubleshooting-azure-cdn-endpoints-that-return-a-404-status-code"></a>Устранение неполадок с конечными точками Azure CDN, которые возвращают код состояния 404
Сведения в этой статье позволяют устранить неполадки, связанные с конечными точками сети доставки содержимого (CDN) Azure, которые возвращают ответы с кодом состояния HTTP 404.

Если вам потребуется дополнительная помощь по любому из вопросов, рассматриваемых в статье, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](https://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт поддержки Azure](https://azure.microsoft.com/support/options/) и выберите **Получить поддержку**.

## <a name="symptom"></a>Симптом
Вы создали профиль CDN и конечную точку, но содержимое недоступно в сети CDN. Пользователи, пытающиеся получить доступ к вашему содержимому через URL-адрес CDN, получают коды состояния HTTP 404. 

## <a name="cause"></a>Причина:
Возможно несколько причин, включая указанные ниже.

* Источник файла недоступен для CDN.
* Конечная точка настроена неправильно, поэтому CDN выполняет поиск в неправильном месте.
* Узел отклоняет заголовок узла от CDN.
* У конечной точки не было времени для распространения в сети CDN.

## <a name="troubleshooting-steps"></a>Действия по устранению неполадок
> [!IMPORTANT]
> После создания конечная точка CDN не будет доступна сразу. Распространение регистрационных сведений по сети CDN может занять некоторое время.
> - Для профилей **Azure CDN уровня "Стандартный" от Майкрософт** распространение обычно завершается в течение десяти минут. 
> - Для профилей **Azure CDN уровня "Стандартный" от Akamai** распространение обычно завершается в течение одной минуты. 
> - Для профилей **Azure CDN уровня "Стандартный" от Verizon** и **Azure CDN уровня "Премиум" от Verizon** распространение обычно завершается в течение 90 минут. 
> 
> Если вы по-прежнему получаете ответы 404 после выполнения процедур, описанных в этом документе, подождите еще несколько часов, чтобы повторить проверку, прежде чем открыть запрос в службу поддержки.
> 
> 

### <a name="check-the-origin-file"></a>Проверка исходного файла
Во-первых, убедитесь, что файл для кэширования доступен в сервере-источнике и в Интернете в режиме общего доступа. Самый быстрый способ — открыть браузер в анонимном режиме или режиме InPrivate и перейти к файлу напрямую. Введите или вставьте URL-адрес в поле адреса и убедитесь, что выведен нужный вам файл. Например, предположим, что у вас в учетной записи хранения Azure есть файл, доступный по адресу https:\//cdndocdemo.blob.core.windows.net/publicblob/lorem.txt. Если содержимое этого файла загружено успешно, он прошел проверку.

![Готово!](./media/cdn-troubleshoot-endpoint/cdn-origin-file.png)

> [!WARNING]
> Хотя это и самый быстрый и простой способ проверки общего доступа к файлу, некоторые конфигурации сети в организации могут определить, что этот файл является общедоступным, тогда как на самом деле он доступен только для пользователей вашей корпоративной сети (даже если размещен в Azure). Чтобы убедиться, что это не так, проверьте файл с помощью внешнего браузера, например на мобильном устройстве, не подключенном к сети вашей организации, или на виртуальной машине в Azure.
> 
> 

### <a name="check-the-origin-settings"></a>Проверка параметров источника
Убедившись, что файл находится в открытом доступе в Интернете, проверьте параметры источника. На [портале Azure](https://portal.azure.com) перейдите к профилю CDN и выберите конечную точку, для которой вы устраняете неполадки. На открывшейся странице **Конечная точка** выберите источник.  

![Страница "Конечная точка" с выделенным источником](./media/cdn-troubleshoot-endpoint/cdn-endpoint.png)

Откроется страница **Источник**. 

![Страница "Источник"](./media/cdn-troubleshoot-endpoint/cdn-origin-settings.png)

#### <a name="origin-type-and-hostname"></a>Тип и имя узла источника
Убедитесь, что **тип источника** и **имя узла источника** указаны правильно. В этом примере URL-адреса, https:\//cdndocdemo.blob.core.windows.net/publicblob/lorem.txt, часть имени узла — *cdndocdemo.blob.core.windows.net*. Все указано правильно. Для источников "Служба хранилища Azure", "Веб-приложение" и "Облачная служба" поле **Имя узла источника** содержит раскрывающийся список, поэтому нам не нужно беспокоиться о правильности написания. Однако если вы используете настраиваемый источник, очень важно правильно указать имя вашего узла.

#### <a name="http-and-https-ports"></a>Порты HTTP и HTTPS
Проверьте порты **HTTP** и **HTTPS**. В большинстве случаев значения 80 и 443 правильны и изменять их не требуется.  Тем не менее, если сервер-источник прослушивает другой порт, необходимо указать именно его. Если вам это неизвестно, взгляните на URL-адрес для исходного файла. Спецификации HTTP и HTTPS используют порты 80 и 443 по умолчанию. В примере URL-адреса, https:\//cdndocdemo.blob.core.windows.net/publicblob/lorem.txt, порт не указан, поэтому предполагается значение по умолчанию (443) и параметры заданы правильно.  

Тем не менее рассмотрим такой URL-адрес для ранее тестируемого исходного файла: http:\//www.contoso.com:8080/file.txt. Обратите внимание на часть *:8080* в конце сегмента имени узла. Этот номер сообщает браузеру о необходимости использовать порт 8080 для подключения к веб-серверу по адресу www.contoso.com, поэтому вам потребуется ввести *8080* в поле **HTTP-порт**. Важно отметить, что эти параметры портов влияют только на определение порта, используемого конечной точкой для получения сведений из источника.

> [!NOTE]
> В конечных точках **Azure CDN уровня "Стандартный" от Akamai** запрещено использовать полный диапазон портов TCP для источников.  Список запрещенных портов источников см. в статье о [разрешенных портах источников Azure CDN от Akamai](https://msdn.microsoft.com/library/mt757337.aspx).  
> 
> 

### <a name="check-the-endpoint-settings"></a>Проверка параметров конечной точки
На странице **Конечная точка** нажмите кнопку **Настройка**.

![Страница "Конечная точка" с выделенной кнопкой "Настройка"](./media/cdn-troubleshoot-endpoint/cdn-endpoint-configure-button.png)

Откроется страница **настройки** конечной точки.

![Страница "Настройка"](./media/cdn-troubleshoot-endpoint/cdn-configure.png)

#### <a name="protocols"></a>Протоколы
В разделе **Протоколы** убедитесь, что выбран протокол, используемый клиентами. Протокол клиента также используется для доступа к источнику, поэтому важно, чтобы порты источника были настроены правильно (см. предыдущий раздел). Конечная точка CDN будет прослушивать только порты HTTP и HTTPS по умолчанию (80 и 443), независимо от портов источника.

Давайте вернемся к нашему гипотетическому примеру с файлом http:\//www.contoso.com:8080/file.txt.  Как вы помните, компания Contoso указала *8080* как HTTP-порт, однако также предположим, что она указала *44300* как HTTPS-порт.  Если сотрудники компании создали конечную точку с именем *contoso*, то именем узла их конечной точки CDN будет *contoso.azureedge.net*.  Запрос файла http:\//contoso.azureedge.net/file.txt является HTTP-запросом, поэтому конечная точка будет использовать HTTP на порту 8080, чтобы получить его из источника.  При использовании безопасного запроса по протоколу HTTPS, https:\//contoso.azureedge.net/file.txt, конечная точка будет использовать HTTPS на порту 44300 во время получения файла из источника.

#### <a name="origin-host-header"></a>Заголовок узла источника
**Заголовок узла источника** — это значение заголовка узла, отправляемое в источник с каждым запросом.  В большинстве случаев оно должно совпадать со значением **имени узла источника** , которое мы проверяли ранее.  Неверное значение в этом поле, как правило, не вызывает состояния 404, но может вызвать другие состояния 4xx, в зависимости от данных, ожидаемых источником.

#### <a name="origin-path"></a>Путь к источнику
Наконец, следует проверить **путь к источнику**.  По умолчанию это пустое поле.  Это поле следует использовать только в том случае, если требуется сузить область размещенных в источнике ресурсов, которые требуется сделать доступными в сети CDN.  

В этом примере конечной точки необходимо, чтобы все ресурсы в учетной записи хранения были доступными, поэтому поле **Путь к источнику** осталось пустым.  Это означает, что запрос файла https:\//cdndocdemo.azureedge.net/publicblob/lorem.txt вызовет подключение из конечной точки к узлу cdndocdemo.core.windows.net, который запросит файл */publicblob/lorem.txt*.  Аналогичным образом запрос файла https:\//cdndocdemo.azureedge.net/donotcache/status.png приведет к запросу конечной точкой файла */donotcache/status.png* из источника.

Но что делать, если вы не хотите использовать CDN для каждого пути к источнику?  Предположим, что вы хотите предоставить только путь *publicblob*.  Если мы введем */publicblob* в поле **Путь к источнику**, то конечная точка будет вставлять */publicblob* перед каждым запросом к источнику.  Это означает, что запрос файла https:\//cdndocdemo.azureedge.net/publicblob/lorem.txt теперь фактически будет использовать часть запроса URL-адреса */publicblob/lorem.txt*, добавив в начало */publicblob*. Это приводит к запросу файла */publicblob/publicblob/lorem.txt* из источника.  Если этот путь не разрешается в фактический файл, источник будет возвращать состояние 404.  Правильный URL-адрес для получения файла lorem.txt в этом примере: https:\//cdndocdemo.azureedge.net/lorem.txt.  Обратите внимание, что мы не включали путь */publicblob*, так как часть запроса URL-адреса — */lorem.txt* и конечная точка добавляет */publicblob*, в результате чего создается запрос */publicblob/lorem.txt*, передаваемый источнику.

