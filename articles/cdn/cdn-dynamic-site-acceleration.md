---
title: "Динамическое ускорение сайтов с помощью Azure CDN"
description: "Подробный обзор динамического ускорения сайтов"
services: cdn
documentationcenter: 
author: smcevoy
manager: erikre
editor: 
ms.assetid: 
ms.service: cdn
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/02/2017
ms.author: v-semcev
ms.translationtype: HT
ms.sourcegitcommit: 8b857b4a629618d84f66da28d46f79c2b74171df
ms.openlocfilehash: be2719e0e02c8bc69800ef4a3e7da3c3164cb9dd
ms.contentlocale: ru-ru
ms.lasthandoff: 08/04/2017

---
# <a name="dynamic-site-acceleration-via-azure-cdn"></a>Динамическое ускорение сайтов с помощью Azure CDN

В связи со стремительным развитием социальных сетей, электронной коммерции и невероятной персонализацией Интернета все большая часть предоставляемого пользователям содержимого создается в режиме реального времени. Пользователям необходимы быстрые, надежные и настраиваемые решения, которые не зависят от браузера, расположения, устройства или сети. Однако сами же инновации, при всей привлекательности новых возможностей, замедляют загрузку страниц и создают неудобства в работе пользователя. 

Стандартная поддержка CDN позволяет кэшировать файлы ближе к пользователям, что ускоряет доставку статических файлов. Тем не менее, с развитием динамических веб-приложений кэширование содержимого в граничных расположениях невозможно, так как сервер создает содержимое в ответ на действия пользователей. Ускорить доставку такого содержимого сложнее, чем в традиционном пограничном кэшировании. Для этого требуется комплексное решение, которое точно настроит каждый элемент на протяжении всего пути данных — с момента их создания до доставки. Динамическое ускорение сайтов (DSA) в сети доставки содержимого (CDN) Azure значительно улучшает производительность веб-страниц с динамическим содержимым.

Azure CDN от Akamai и Verizon позволяют выбрать функцию оптимизации DSA в меню **Optimized for** (Оптимизировано для) во время создания конечной точки.

## <a name="configuring-cdn-endpoint-to-accelerate-delivery-of-dynamic-files"></a>Настройка конечной точки CDN для ускорения доставки динамических файлов

Вы можете настроить конечную точку CDN, чтобы оптимизировать доставку динамических файлов через портал Azure, выбрав параметр **Dynamic site acceleration** (Динамическое ускорение сайтов) в свойствах **Optimized for** (Оптимизировано для) во время создания конечной точки. То же самое можно сделать программным образом с помощью наших REST API или любого клиентского пакета SDK. 

### <a name="probe-path"></a>Путь пробы
Путь пробы — это функция динамического ускорения сайтов. Для создания необходим допустимый путь. DSA использует небольшой файл *пути пробы*, размещенный на сервере-источнике, чтобы оптимизировать конфигурации сетевой маршрутизации для CDN. Вы можете скачать и передать на свой сайт наш пример файла или использовать в качестве пути пробы имеющийся ресурс (если он существует) на своем сервере-источнике, который имеет размер около 10 КБ.

> [!Note]
> За использование DSA взимается дополнительная плата. Дополнительные сведения см. на соответствующей [странице с расценками](https://azure.microsoft.com/pricing/details/cdn/).

На следующих снимках экрана показано, как это сделать с помощью портала Azure.
 
![Добавление новой конечной точки CDN](./media/cdn-dynamic-site-acceleration/01_Endpoint_Profile.png) 

*Рис. 1. Добавление новой конечной точки CDN из профиля CDN*
 
![Создание конечной точки CDN с поддержкой DSA](./media/cdn-dynamic-site-acceleration/02_Optimized_DSA.png)  

*Рис. 2. Создание конечной точки CDN с выбранным параметром оптимизации "Динамическое ускорение сайтов"*

После создания конечной точки CDN оптимизация DSA применяется для всех файлов, соответствующих определенным условиям. В следующем разделе подробно описана оптимизация DSA.

## <a name="dsa-optimization-using-azure-cdn"></a>Оптимизация DSA с помощью Azure CDN

Динамическое ускорение сайтов в Azure CDN ускоряет доставку динамических ресурсов с помощью следующих приемов:

-   Оптимизация маршрутов
-   Оптимизация TCP
-   Предварительная выборка объектов (только Akamai).
-   Сжатие мобильных изображений (только Akamai).

### <a name="route-optimization"></a>Оптимизация маршрутов

Оптимизации маршрутов важна, так как Интернет — это динамичная среда, в которой топология сети постоянно меняется под действием трафика и временных простоев. Протокол пограничного шлюза (BGP) — это Интернет-протокол маршрутизации, но при использовании промежуточных серверов точек подключения возможны более быстрые маршруты. 

Оптимизация маршрутов выбирает самый оптимальный путь к серверу-источнику, чтобы сайт был постоянно доступен, а динамическое содержимое доставлялось пользователям по наиболее быстрому и надежному маршруту. 

Сеть Akamai использует методы сбора данных в режиме реального времени и сравнения различных путей с помощью разных узлов на сервере Akamai. Она также использует маршрут BGP по умолчанию в открытом Интернете для определения самого быстрого маршрута между сервером-источником и пограничным сервером CDN. Это позволяет избегать длинных маршрутов и точек перегрузки в Интернете. 

Аналогичным образом сети Verizon используют сочетание произвольной рассылки DNS, поддерживающей точки подключения большой емкости и проверку работоспособности для определения самых оптимальных шлюзов для эффективной маршрутизации данных от клиента к источнику.
 
В результате полностью динамическое и транзакционное содержимое доставляется пользователям быстрее и надежнее, даже когда оно не кэшируется. 

### <a name="tcp-optimizations"></a>Оптимизация TCP

Протокол TCP — это стандартный протокол из набора Интернет-протоколов, который используется для обмена данными между приложениями и сетью IP.  По умолчанию для установки TCP-подключения необходимо выполнить несколько входящих и исходящих запросов. Также существуют ограничения, которые позволяют избежать перегрузок в сети, снижающих эффективность масштабирования. Azure CDN от Akamai решает эту проблему путем оптимизации в трех областях: 

 - устранение медленного запуска;
 - использование постоянных подключений;
 - настройка параметров TCP-пакетов (только Akamai).

#### <a name="eliminating-slow-start"></a>Устранение медленного запуска

*Медленный запуск* — это часть протокола TCP, которая предотвращает перегрузки в сети за счет ограничения объема данных, передаваемых по сети. При запуске между отправителем и получателем используются окна небольшого размера, чтобы избежать перегрузок. Постепенно размер увеличивается, пока не достигается максимум или не обнаруживается потеря пакетов.

Azure CDN от Akamai и Verizon устраняют медленный запуск в 3 этапа:

1.  Сети Akamai и Verizon используют мониторинг работоспособности и пропускной способности для измерения пропускной способности соединений между пограничными серверами точек подключения.
2. Метрики являются общими для пограничных серверов конечных точек, чтобы каждый сервер "знал" о состоянии сети и работоспособности сервера точек подключения.  
3. Теперь пограничные серверы CDN могут сделать выводы о некоторых параметрах передачи. Например, какой размер окна будет оптимальным при взаимодействии с соседними пограничными серверами CDN. Это означает, что начальный размер окна перегрузки можно увеличить, если состояние подключения между пограничными серверами CDN способно передать больше пакетных данных.  

#### <a name="leveraging-persistent-connections"></a>Использование постоянных подключений

При использовании CDN к серверу-источнику напрямую подключается меньше уникальных компьютеров, чем когда к нему напрямую подключаются пользователи. Azure CDN от Akamai и также Verizon объединяют запросы пользователей в пулы, чтобы реже подключаться к серверу-источнику.

Как упоминалось ранее, при подтверждении TCP-подключений необходимо выполнить несколько входящих и исходящих запросов, чтобы установить новое подключение. Постоянные подключения, также известные как проверяемые на активность подключения HTTP (Keep-Alive), повторно используют существующие TCP-подключения для нескольких HTTP-запросов, чтобы сократить время кругового пути и ускорить доставку. 

Сеть Verizon также периодически отправляет пакеты проверки активности через TCP-соединение, чтобы открытое соединение не было закрыто.

#### <a name="tuning-tcp-packet-parameters"></a>Настройка параметров TCP-пакетов

Azure CDN от Akamai также позволяет настроить параметры, которые управляют подключениями между серверами, и сократить дальность круговых путей, используемых для получения встроенного в сайт содержимого. Для этого необходимо выполнить следующие действия:

1.  Увеличить начальное окно перегрузки, чтобы больше пакетов отправлялось, не ожидая подтверждения.
2.  Уменьшить начальное время ожидания повторной передачи, чтобы обнаруживалась потеря и повторная передача выполнялась быстрее.
3.  Уменьшить минимальное и максимальное время ожидания повторной передачи, чтобы быстрее предположить, что пакеты были потеряны при передаче.

### <a name="object-prefetch-akamai-only"></a>Предварительная выборка объектов (только Akamai)

Большинство веб-сайтов состоит из HTML-страницы, которая ссылается на другие ресурсы, такие как изображения и сценарии. Как правило, когда клиент запрашивает веб-страницу, браузер сначала скачивает и анализирует HTML-объект, а затем выполняет дополнительные запросы к связанным ресурсам, необходимым для полной загрузки страницы. 

*Предварительная выборка* — это метод извлечения изображений и сценариев, встроенных в HTML-страницу, когда HTML-код передается в браузер. Извлечение происходит еще до того, как браузер запрашивает эти объекты. 

Если функция **предварительной выборки** включена, когда CDN передает базовую HTML-страницу в браузер клиента, то CDN проанализирует HTML-файл и выполнит дополнительные запросы на получение связанных ресурсов, а также сохранит их в своем кэше. Когда клиент запросит связанные ресурсы, на пограничном сервере CDN уже будут запрашиваемые объекты, и он сможет передать их немедленно, не отправляясь по круговому пути к серверу-источнику. Такая оптимизация полезна как для кэшируемого, так и для некэшируемого содержимого.

### <a name="adaptive-image-compression-akamai-only"></a>Адаптивное сжатие изображений (только Akamai)

На некоторых устройствах, особенно мобильных, периодически наблюдается снижение скорости сети. В таких сценариях пользователю выгоднее быстро просмотреть веб-страницу с небольшими изображениями, чем долго дожидаться загрузки изображений в полном разрешении.

Эта функция автоматически отслеживает качество сети и задействует стандартные методы сжатия JPEG, чтобы ускорить доставку, когда скорость сети снижается.

Адаптивное сжатие изображений | Расширения файлов  
--- | ---  
Сжатие JPEG | .jpg, .jpeg, .jpe, .jig, .jgig, .jgi

## <a name="caching"></a>Caching

С DSA кэширование по умолчанию отключено в CDN, даже если сервер-источник включает в ответ заголовки Cache-Control или Expires. Это значение по умолчанию отключено, так как DSA обычно используется для динамических ресурсов, которые не нужно кэшировать, так как они уникальны для каждого клиента, а включение кэширования по умолчанию может нарушить работу.

Если на вашем веб-сайте есть статические и динамические ресурсы, для достижения оптимальной производительности лучше всего использовать гибридный подход. 

При использовании ADN с Verizon Premium можно включить кэширование для конкретных сценариев, используя обработчик правил.  

Альтернативой является использование двух конечных точек CDN: одно — с DSA для доставки динамических ресурсов, а другой — со статической оптимизацией (например, общая веб-доставка) для доставки кэшируемых ресурсов. Чтобы реализовать этот вариант, измените URL-адреса веб-страниц для связывания с ресурсами в конечной точке CDN, которую планируется использовать. 

Например, `mydynamic.azureedge.net/index.html` — это динамическая страница, загружаемая из конечной точки DSA.  HTML-страница ссылается на несколько статических ресурсов, таких как библиотеки JavaScript и изображения, загружаемые из статической конечной точки CDN, например `mystatic.azureedge.net/banner.jpg` и `mystatic.azureedge.net/scripts.js`. 

Пример использования контроллера в веб-приложении ASP.NET для доставки содержимого по определенному URL-адресу CDN см. [здесь](https://docs.microsoft.com/azure/cdn/cdn-cloud-service-with-cdn#controller).





