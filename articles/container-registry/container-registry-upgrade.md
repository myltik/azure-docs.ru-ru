---
title: Обновление реестра контейнеров Azure уровня "Классический"
description: Воспользуйтесь преимуществами управляемых реестров контейнеров с расширенным набором функций ценовой категории "Базовый", "Стандартный" или "Премиум", обновив неуправляемый реестр контейнеров уровня "Классический".
services: container-registry
author: mmacy
manager: jeconnoc
ms.service: container-registry
ms.topic: article
ms.date: 03/15/2018
ms.author: marsma
ms.openlocfilehash: 084dfc8f87aaea4b5bbad7cb5fdb9d445d566206
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
ms.locfileid: "32168713"
---
# <a name="upgrade-a-classic-container-registry"></a>Обновление реестра контейнеров уровня "Классический"

Реестр контейнеров Azure (ACR) доступен на нескольких уровнях обслуживания, [известных как номера SKU](container-registry-skus.md). В первоначальном выпуске ACR предлагался один номер SKU уровня "Классический", в котором не предоставляются несколько возможностей, имеющиеся в номерах SKU уровня "Базовый", "Стандартный" и "Премиум" (известные как *управляемые* реестры). В этой статье подробно описывается переход с неуправляемого реестра уровня "Классический" на один из управляемых номеров SKU, чтобы воспользоваться преимуществами их улучшенных функций.

## <a name="why-upgrade"></a>Причины, по которым стоит установить обновление

Так как классические неуправляемые реестры имеют ограниченные возможности, мы рекомендуем перейти с реестров уровня "Классический" на управляемые уровни "Базовый", "Стандартный" или "Премиум". Эти номера SKU более высокого уровня более тесно интегрируют реестр с возможностями Azure.

Управляемые реестры предоставляют следующие возможности:

* интеграция Azure Active Directory для [отдельной аутентификации](container-registry-authentication.md#individual-login-with-azure-ad);
* поддержка удаления образов и тегов;
* [Георепликация](container-registry-geo-replication.md)
* [Объекты Webhook](container-registry-webhook.md)

Чаще всего реестр уровня "Классический" зависит от учетной записи хранения, которую Azure автоматически подготавливает в вашей подписке Azure при создании реестра. Номера SKU "Базовый", "Стандартный" и "Премиум" используют преимущества [дополнительных функций хранения Azure](container-registry-storage.md), прозрачно обрабатывая хранилище образов для вас. Отдельная учетная запись хранения не создается в подписке.

Управляемое хранилище реестров предоставляет следующие преимущества.

* Образы контейнеров [зашифрованы при хранении](container-registry-storage.md#encryption-at-rest).
* Образы хранятся с использованием [геоизбыточного хранилища](container-registry-storage.md#geo-redundant-storage), что обеспечивает резервное копирование образов с репликацией в нескольких регионах.
* Возможность без ограничений [перемещаться между номерами SKU](container-registry-skus.md#changing-skus), что обеспечивает высокую пропускную способность при выборе номера SKU более высокого уровня. С каждым номером SKU ACR может удовлетворить ваши требования к пропускной способности по мере роста ваших потребностей.
* Единая модель безопасности для реестра и его хранилища предоставляет возможность упрощенного управления правами. Вы можете управлять разрешениями только для реестра контейнеров без необходимости управлять разрешениями для отдельной учетной записи хранения.

Дополнительные сведения о хранилище образов в записи контроля доступа см. в статье о [хранилище образов контейнеров в Реестре контейнеров Azure](container-registry-storage.md).

## <a name="migration-considerations"></a>Рекомендации по переносу

При изменении реестра уровня "Классический" на один из управляемых реестров Azure должен копировать все имеющиеся образы контейнера из созданной учетной записи хранения контроля доступа в вашей подписке в учетную запись хранения, управляемую Azure. В зависимости от размера реестра этот процесс может занять от нескольких минут до нескольких часов.

Во время преобразования все операции `docker push` блокируются, а `docker pull` продолжает функционировать.

Во время преобразования не удаляйте и не изменяйте содержимое учетной записи хранения, в которую копируется реестр уровня "Классический". Это может привести к повреждению или потере образов контейнера.

После миграции учетная запись хранения в подписке, с помощью которой было выполнено первоначальное резервное копирование реестра уровня "Классический", будет применяться для записи контроля доступа. После проверки успешности миграции рассмотрите возможность удаления учетной записи хранения, чтобы свести затраты к минимуму.

>[!IMPORTANT]
> Обновление реестра от уровня "Классический" до одного из управляемых номеров SKU является **односторонним процессом**. После обновления реестра до уровня "Базовый", "Стандартный" или "Премиум" вы не сможете вернуться к использованию уровня "Классический". Однако вы можете без ограничений перемещаться между управляемыми номерами SKU с емкостью, достаточной для реестра.

## <a name="how-to-upgrade"></a>Обновление

Неуправляемый реестр уровня "Классический" можно обновить до одного из управляемых SKU несколькими способами. В следующих разделах описывается процесс использования [интерфейса командной строки Azure][azure-cli] и [портала Azure][azure-portal].

## <a name="upgrade-in-azure-cli"></a>Обновление с помощью интерфейса командной строки Azure

Чтобы обновить реестр уровня "Классический" с помощью Azure CLI, выполните команду [az acr update][az-acr-update] и укажите новый номер SKU реестра. В следующем примере реестр уровня "Классический" с именем *myclassicregistry* обновляется до SKU уровня "Премиум".

```azurecli-interactive
az acr update --name myclassicregistry --sku Premium
```

После миграции вы увидите выходные данные, аналогичные следующим. Обратите внимание, что уровень `sku` — "Премиум", а `storageAccount` имеет значение NULL, указывающее, что теперь хранилище образов этого реестра находится под управлением Azure.

```JSON
{
  "adminUserEnabled": false,
  "creationDate": "2017-12-12T21:23:29.300547+00:00",
  "id": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myresourcegroup/providers/Microsoft.ContainerRegistry/registries/myregistry",
  "location": "eastus",
  "loginServer": "myregistry.azurecr.io",
  "name": "myregistry",
  "provisioningState": "Succeeded",
  "resourceGroup": "myresourcegroup",
  "sku": {
    "name": "Premium",
    "tier": "Premium"
  },
  "status": null,
  "storageAccount": null,
  "tags": {},
  "type": "Microsoft.ContainerRegistry/registries"
}
```

Если указать управляемый номер SKU реестра, максимальная емкость которого меньше, чем размер реестра уровня "Классический", отобразится следующее сообщение об ошибке.

`Cannot update the registry SKU due to reason: Registry size 12936251113 bytes exceeds the quota value 10737418240 bytes for SKU Basic. The suggested SKU is Standard.`

Если отобразилось такое сообщение, выполните команду [az acr update][az-acr-update] еще раз и укажите рекомендованный номер SKU (следующий SKU самого высокого уровня, который способен обрабатывать образы).

## <a name="upgrade-in-azure-portal"></a>Обновление на портале Azure

При обновлении реестра уровня "Классический" через портал Azure автоматически выбирается номер SKU самого низкого уровня, который способен обрабатывать образы. Например, если реестр содержит 12 Гиб образов, Azure автоматически выбирает и преобразовывает реестр уровня "Классический" на уровень "Стандартный" (который обрабатывает до 100 Гиб).

Чтобы обновить реестр уровня "Классический" с помощью портала Azure, перейдите в раздел реестра контейнеров **Overview** (Обзор) и выберите **Обновление до управляемого реестра**.

![Кнопка обновления реестра уровня "Классический" в пользовательском интерфейсе портала Azure][update-classic-01-upgrade]

Щелкните **ОК**, чтобы подтвердить обновление управляемого реестра.

![Подтверждение обновления реестра уровня "Классический" в пользовательском интерфейсе портала Azure][update-classic-02-confirm]

Во время миграции на портале **состояние подготовки** реестра — *Updating* (Обновляется). Как упоминалось ранее, операции `docker push` недоступны во время миграции. Во время миграции не удаляйте и не обновляйте учетную запись хранения, используемую реестром уровня "Классический", так как это может привести к повреждению или потере образов.

![Процесс обновления реестра уровня "Классический" в пользовательском интерфейсе портала Azure][update-classic-03-updating]

По завершении миграции **состояние подготовки** будет *Succeeded* (Успешно). Вы можете еще раз выполнить операцию `docker push` в реестре.

![Завершение обновления реестра уровня "Классический" в пользовательском интерфейсе портала Azure][update-classic-04-updated]

## <a name="next-steps"></a>Дополнительная информация

После обновления реестра до уровня "Базовый", "Стандартный" или "Премиум" Azure больше не использует учетную запись хранения, с помощью которой было выполнено первоначальное резервное копирование реестра уровня "Классический". Чтобы сократить затраты, рассмотрите возможность удаления учетной записи хранения или контейнера больших двоичных объектов в учетной записи, содержащей старые образы контейнера.

<!-- IMAGES -->
[update-classic-01-upgrade]: ./media/container-registry-upgrade\update-classic-01-upgrade.png
[update-classic-02-confirm]: ./media/container-registry-upgrade\update-classic-02-confirm.png
[update-classic-03-updating]: ./media/container-registry-upgrade\update-classic-03-updating.png
[update-classic-04-updated]: ./media/container-registry-upgrade\update-classic-04-updated.png

<!-- LINKS - internal -->
[az-acr-update]: /cli/azure/acr#az_acr_update
[azure-cli]: /cli/azure/install-azure-cli
[azure-portal]: https://portal.azure.com