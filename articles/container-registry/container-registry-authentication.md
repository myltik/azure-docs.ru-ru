---
title: Аутентификация в реестре контейнеров Azure
description: Варианты аутентификации в реестре контейнеров Azure, включая прямой вход с помощью субъекта-службы Azure Active Directory и вход с помощью реестра.
services: container-registry
author: stevelas
manager: jeconnoc
ms.service: container-registry
ms.topic: article
ms.date: 01/23/2018
ms.author: stevelas
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: c8fcebae21d73db75e19bd1091faa8f389f0ba40
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
ms.locfileid: "32165523"
---
# <a name="authenticate-with-a-private-docker-container-registry"></a>Аутентификация с помощью частного реестра контейнеров Docker

Существует несколько способов аутентификации в реестре контейнеров Azure, каждый из которых подходит для одного или нескольких сценариев использования реестра.

Вы можете входить в реестр напрямую с помощью [отдельного входа](#individual-login-with-azure-ad), а ваши приложения и оркестраторы контейнеров могут осуществлять автоматическую аутентификацию с помощью [субъекта-службы](#service-principal) Active Directory Azure (Azure AD).

Реестр контейнеров Azure не поддерживает неаутентифицированные операции Docker или анонимный доступ. Для общедоступных образов можно использовать [концентратор Docker](https://docs.docker.com/docker-hub/).

## <a name="individual-login-with-azure-ad"></a>Отдельный вход с помощью Azure AD

При работе с реестром напрямую, например при извлечении образов на рабочую станцию разработки и отправке образов с нее, выполняйте аутентификацию с помощью команды [az acr login](/cli/azure/acr?view=azure-cli-latest#az_acr_login) в [Azure CLI](/cli/azure/install-azure-cli).

```azurecli
az acr login --name <acrName>
```

При входе с помощью команды `az acr login` интерфейс командной строки использует маркер, созданный при выполнении команды `az login`, чтобы прозрачно выполнить аутентификацию вашего сеанса в реестре. После входа таким образом ваши учетные данные сохраняются в кэше, и при последующем выполнении команды `docker` не потребуется вводить имя пользователя или пароль. Если срок действия маркера истекает, его можно обновить его с помощью команды `az acr login`, чтобы повторно пройти аутентификацию. Использование `az acr login` с удостоверениями Azure обеспечивает [доступ на основе ролей](../role-based-access-control/role-assignments-portal.md).

## <a name="service-principal"></a>Субъект-служба

Можно назначить [субъект-службу](../active-directory/develop/active-directory-application-objects.md) для реестра, и приложение или служба сможет использовать его для автоматической аутентификации. Использование субъектов-служб обеспечивает [доступ к реестру на основе ролей](../role-based-access-control/role-assignments-portal.md), и одному реестру можно назначить несколько субъектов-служб. Применение нескольких субъектов-служб позволяет определить разные права доступа для приложений.

Доступные роли:

  * **Читатель**: извлечение;
  * **Участник**: извлечение и отправка;
  * **Владелец**: извлечение, отправка и назначение ролей другим пользователям.

Субъекты-службы позволяют выполнять автономное подключение к реестру в сценариях извлечения и отправки, примеры которых указаны ниже.

  * *Читатель*: развертывание контейнеров из реестра в системы оркестрации, в том числе Kubernetes, DC/OS и Docker Swarm. Данные из реестров контейнеров можно также отправлять в связанные службы Azure, например в [AKS](../aks/index.yml), [службу приложений](../app-service/index.yml), [пакетную службу](../batch/index.yml), [Service Fabric](/azure/service-fabric/) и другие.

  * *Участник*: решения непрерывной интеграции и развертывания (например, Visual Studio Team Services (VSTS) или Jenkins), создающие образы контейнеров и отправляющие их в реестр.

> [!TIP]
> Можно создать пароль субъекта-службы повторно, выполнив команду [az ad sp reset-credentials](/cli/azure/ad/sp?view=azure-cli-latest#az_ad_sp_reset_credentials).
>

Вы можете также выполнить вход напрямую с помощью субъекта-службы. Укажите идентификатор и пароль приложения для субъекта-службы в команде `docker login`.

```
docker login myregistry.azurecr.io -u xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx -p myPassword
```

После входа в систему Docker кэширует учетные данные, поэтому вам не нужно запоминать идентификатор приложения.

В зависимости от установленной версии Docker может появиться предупреждение системы безопасности, рекомендующее использовать параметр `--password-stdin`. Хотя его использование выходит за рамки данной статьи, мы рекомендуем следовать данной рекомендации. Чтобы получить дополнительные сведения, ознакомьтесь с описанием команды [docker login](https://docs.docker.com/engine/reference/commandline/login/).

Дополнительные сведения об использовании субъекта-службы для автоматической аутентификации в ACR см. в статье об [аутентификации реестра контейнеров Azure в субъекте-службе](container-registry-auth-service-principal.md).

## <a name="admin-account"></a>Учетная запись администратора

Каждый реестр контейнеров содержит учетную запись администратора, которая отключена по умолчанию. Вы можете включить учетную запись администратора и управлять ее учетными данными на [портале Azure](container-registry-get-started-portal.md#create-a-container-registry) или с помощью Azure CLI.

> [!IMPORTANT]
> Учетная запись администратора предоставляет доступ к реестру одному пользователю. Она предназначена, главным образом, для тестирования. Не рекомендуется совместное использование учетных данных администратора несколькими пользователями. Все пользователи, выполняющие аутентификацию с учетной записью администратора, отображаются как один пользователь с возможностью извлечения данных из реестра и отправки данных в него. Изменив или отключив эту учетную запись, вы ограничите доступ к реестру для пользователей, использующих эти учетные данные. Для пользователей и субъектов-служб в сценариях автоматического входа рекомендуется использовать отдельные удостоверения.
>

Учетной записи администратора предоставляются два пароля, каждый из которых можно создать повторно. Благодаря этому вы можете подключаться к реестру, используя один пароль, пока второй создается повторно. Если учетная запись администратора включена, вы можете указать в команде `docker login` имя пользователя и пароль для обычной проверки подлинности в реестре. Например: 

```
docker login myregistry.azurecr.io -u myAdminName -p myPassword1
```

Docker рекомендует использовать параметр `--password-stdin` вместо передачи его в командной строке для повышения безопасности. Можно также указать только имя пользователя, без `-p`, а затем при появлении запроса ввести пароль.

Чтобы включить учетную запись администратора для существующего реестра, можно использовать параметр `--admin-enabled` в команде [az acr update](/cli/azure/acr?view=azure-cli-latest#az_acr_update) в Azure CLI.

```azurecli
az acr update -n <acrName> --admin-enabled true
```

Чтобы включить учетную запись администратора на портале Azure, перейдите к реестру, выберите **Ключи доступа** в разделе **Параметры**, затем щелкните **Включить** в разделе **Пользователь-администратор**.

![Включение учетной записи администратора на портале Azure][auth-portal-01]

## <a name="next-steps"></a>Дополнительная информация

* [Отправка первого образа с помощью Azure CLI](container-registry-get-started-azure-cli.md)

<!-- IMAGES -->
[auth-portal-01]: ./media/container-registry-authentication/auth-portal-01.png
