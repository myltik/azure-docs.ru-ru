---
title: Защита личных данных документа с помощью средств создания отчетов Azure | Документация Майкрософт
description: Использование служб Azure Reporting Services для защиты конфиденциальности персональных данных в рамках инициатив по соблюдению Общего регламента по защите данных (GDPR).
services: security
documentationcenter: na
author: barclayn
manager: MBaldwin
editor: TomSh
ms.assetid: ''
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/06/2018
ms.author: barclayn
ms.openlocfilehash: fc859f3aa34531133b7a21e36591b011c63d511c
ms.sourcegitcommit: 3a4ebcb58192f5bf7969482393090cb356294399
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
# <a name="document-protection-of-personal-data-with-azure-reporting-tools"></a>Защита личных данных документа с помощью средств создания отчетов Azure

В этой статье рассматривается использование служб отчетов и технологий Azure для защиты конфиденциальности персональных данных. Эти сведения можно использовать для соблюдения отраслевых или государственных норм, например Общего регламента по защите данных (GDPR).
## <a name="scenario"></a>Сценарий

Большая круизная компания, расположенная в США, расширяет масштабы своей деятельности и предлагает маршруты в Средиземном, Адриатическом и Балтийском морях, а также на Британских островах. Для реализации этой программы компания приобрела несколько небольших круизных фирм, расположенных в Италии, Германии, Дании и Великобритании.

Компания использует Microsoft Azure для обработки и хранения корпоративных данных. Сюда входят персональные данные, позволяющие установить личность, например имена, адреса, номера телефонов и сведения о кредитной карте в глобальной клиентской базе. Кроме того, они включают стандартные сведения о кадрах, например адреса, номера телефонов, идентификационные номера налогоплательщиков и другие сведения о сотрудниках во всех расположениях. Круизная компания также содержит большую базу данных участников программ лояльности и программ скидок, которая, в свою очередь, содержит персональные данные, позволяющие отслеживать связи с текущими и бывшими клиентами.

Сотрудники компании получают доступ к сети из удаленных филиалов, а туристические агентства, расположенные по всему миру, имеют доступ к отдельным ресурсам.

## <a name="problem-statement"></a>Проблема

Компания должна защищать конфиденциальность личных данных сотрудников и клиентов с помощью многоуровневой стратегии безопасности, использующей функции безопасности и управления Azure для осуществления строгого контроля доступа к личным данным и их обработки, а также должна иметь возможность продемонстрировать защитные меры внутренним и внешним аудиторам.

## <a name="company-goal"></a>Цель организации

В рамках многоступенчатой стратегии по обеспечению безопасности целью компании является отслеживание всех попыток доступа к персональным данным и их обработки, а также разработка и внедрение документации по соответствующей защите конфиденциальности личных данных.

## <a name="solutions"></a>Решения

Microsoft Azure предоставляет комплексные средства мониторинга, ведения журнала и диагностики для отслеживания и записи действий и событий, связанных с доступом к персональным данным и их обработкой, географическим потоком данных, а также сторонним доступом к персональным данным. Так как за безопасность личных данных в облаке в равной степени несут ответственность обе стороны, Майкрософт также предоставляет клиентам следующее:

- подробные сведения о собственной обработке данных клиентов;

- меры безопасности под управлением Майкрософт;

- необходимые расположения и способы отправки данных клиентов;

- подробности о рассмотрении Майкрософт сведений о конфиденциальности.

### <a name="azure-active-directory"></a>Azure Active Directory

[Azure Active Directory](https://azure.microsoft.com/services/active-directory/) — это мультитенантный облачный каталог и служба управления удостоверениями Майкрософт. Благодаря возможностям предоставления отчетов об аудите службы и событиях входа в нее вы получаете подробные сведения об активности использования приложения и частоте входов для отслеживания и обеспечения соответствующего доступа к персональным данным клиентов и сотрудников.

Существуют два типа отчетов об активности:

- [отчеты или журналы о действиях аудита](https://docs.microsoft.com/azure/active-directory/active-directory-reporting-activity-audit-logs) предоставляют подробные записи системных операций или задач;

- [отчет или журнал об активности событий входа](https://docs.microsoft.com/azure/active-directory/active-directory-reporting-activity-sign-ins) показывает исполнителя каждой задачи в отчете аудита.

Используя оба типа отчетов, вы можете отследить историю каждой выполненной задачи, а также пользователя, выполнившего ее. Эти типы отчетов можно настраивать и фильтровать.

#### <a name="how-do-i-access-the-audit-and-security-logs"></a>Как получить доступ к журналам безопасности и аудита?

Доступ к журналам безопасности и аудита можно получить с портала Active Directory тремя способами: через раздел **действий** (выберите **Журналы аудита** или **Входов**), через раздел **Пользователи или группы** или **Корпоративные приложения** в **управлении** в Active Directory. Доступ к отчетам можно также получить через API отчетов Azure Active Directory. 

1. На портале Azure выберите **Azure Active Directory.**

2. В разделе **Действие** выберите **Журналы аудита**.

    ![](media/protection-personal-data-azure-reporting-tools/image001.png)

3. Настройте представление списка, щелкнув **Столбцы** на панели инструментов.

4.  Выберите элемент в представлении списка, чтобы просмотреть доступные сведения о нем.

    ![](media/protection-personal-data-azure-reporting-tools/image003.png)

Отчеты Azure Active Directory также включают два типа отчетов безопасности — **пользователи в группе риска** и **события входа, представляющие риск**. С помощью этих отчетов можно отследить потенциальные риски в среде Azure.

Дополнительные сведения о службе отчетов см. в статье [Отчеты Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-reporting-azure-portal).

Ознакомьтесь с разделом [Отчеты об активности](https://docs.microsoft.com/azure/active-directory/active-directory-reporting-azure-portal#activity-reports), чтобы получить дополнительные сведения об отчетах, доступных в Azure Active Directory. Эта статья также включает дополнительные сведения о получении доступа к [отчетам об активности журналов аудита](https://docs.microsoft.com/azure/active-directory/active-directory-reporting-activity-audit-logs) и [отчетам о действиях входа](https://docs.microsoft.com/azure/active-directory/active-directory-reporting-activity-sign-ins) и их использовании на портале. Вы можете также ознакомиться с отчетами безопасности о [пользователях в группе риска](https://docs.microsoft.com/azure/active-directory/active-directory-reporting-security-user-at-risk) и [событиях входа, представляющих риск](https://docs.microsoft.com/azure/active-directory/active-directory-reporting-security-risky-sign-ins).

Ознакомьтесь со [справочником по API аудита Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-reporting-api-audit-reference), чтобы получить дополнительные сведения о подключении к отчетам Azure Directory программным способом.

### <a name="log-analytics"></a>Служба Log Analytics

[Log Analytics](https://azure.microsoft.com/services/log-analytics/) может [собирать данные Azure Monitor](https://docs.microsoft.com/azure/log-analytics/log-analytics-azure-storage), чтобы сопоставлять их с другими данными и выполнять дополнительный анализ. Azure Monitor собирает и анализирует данные мониторинга для вашей среды Azure. 

Средства анализа в Log Analytics, такие как поиск по журналам, представления и решения, обрабатывают все собранные данные, предоставляя централизованный анализ всей среды. Log Analytics может выполнять статистическую обработку и анализ журналов событий Windows, журналов IIS и системных журналов, что поможет обнаружить потенциальные нарушения безопасности персональных данных, дающие возможность неавторизованным пользователям получить доступ к этим данным.

#### <a name="how-do-i-use-log-analytics"></a>Как использовать Log Analytics?

Вы можете получить доступ к Log Analytics через портал OMS или Azure, а также любой браузер. Служба Log Analytics поддерживает язык запросов для быстрого получения и консолидации данных в рабочей области Log Analytics. Вы можете создать и сохранить поиск по журналам для анализа данных на портале напрямую.

Чтобы создать рабочую область Log Analytics на портале Azure, сделайте следующее.

1. Выберите **Log Analytics** в списке служб в Marketplace.

2. Выберите **Создать**, а затем укажите имя рабочей области Log Analytics. Выберите подписку, группу ресурсов, расположение и ценовую категорию.

3. Нажмите кнопку **ОК** для отображения списка рабочих областей.

4. Выберите рабочую область, чтобы просмотреть сведения о ней.

    ![](media/protection-personal-data-azure-reporting-tools/image004.png)

Ознакомьтесь со статьей [Что такое Log Analytics?](https://docs.microsoft.com/azure/log-analytics/log-analytics-overview), чтобы узнать больше о службе.

Ознакомьтесь со статьей [Начало работы с рабочей областью Log Analytics](https://docs.microsoft.com/azure/log-analytics/log-analytics-get-started), чтобы создать рабочую область, а также узнать основные сведения об использовании службы.

Ознакомьтесь со статьями ниже, чтобы получить дополнительные сведения о подключении для использования Log Analytics с помощью журналов, описанных выше:

[Источники данных для журнала событий Windows в Log Analytics](https://docs.microsoft.com/azure/log-analytics/log-analytics-data-sources-windows-events)

[Журналы IIS в службе Log Analytics](https://docs.microsoft.com/azure/log-analytics/log-analytics-data-sources-iis-logs)

[Источники данных системного журнала в Log Analytics](https://docs.microsoft.com/azure/log-analytics/log-analytics-data-sources-syslog)

### <a name="azure-monitorazure-activity-log"></a>Журнал действий Azure и Azure Monitor 

[Azure Monitor](https://azure.microsoft.com/services/monitor/) предоставляет метрики инфраструктуры базового уровня, а также журналы для большинства служб Microsoft Azure.
Мониторинг необходим для получения подробных сведений о приложениях Azure. Azure Monitor использует расширение системы диагностики Azure (Windows или Linux) для сбора множества метрик и журналов на уровне приложения, [Журнал действий Azure](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-activity-logs) — один из ресурсов, который можно просмотреть с помощью Azure Monitor. Он отслеживает все вызовы API и предоставляет подробные сведения о действиях в [Azure Resource Manager](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-overview).
В журналах действий (которые ранее назывались операционными журналами или журналами аудита) вы можете искать информацию о ресурсе в контексте инфраструктуры Azure. 

Несмотря на то что большая часть сведений, регистрируемых в журнале действий, имеет отношение к производительности и работоспособности службы, имеются также сведения, связанные с защитой данных. С помощью журнала действий можно определить необходимые сведения о любой операции записи (PUT, POST, DELETE), касающейся ресурсов в подписке Azure.

Например, можно получить запись, когда администратор удаляет группу безопасности сети, что может повлиять на защиту персональных данных. Записи журнала действий хранятся в Azure Monitor в течение 90 дней.

#### <a name="how-do-i-use-the-data-collected-by-azure-monitor"></a>Как использовать данные, собранные Azure Monitor?

Существует ряд способов использования данных в журнале действий и других ресурсов Azure Monitor.

- Вы можете передавать данные в другие расположения в режиме реального времени.

- Вы можете долгосрочно хранить данные (дольше, чем это установлено значениями по умолчанию) с помощью [учетной записи хранения Azure](https://docs.microsoft.com/azure/storage/common/storage-introduction) и настройки политики хранения.

- Вы можете визуализировать данные на графиках и диаграммах, используя [портал Azure](https://azure.microsoft.com/features/azure-portal/), [Azure Application Insights](https://azure.microsoft.com/services/application-insights/), [Microsoft PowerBI](https://powerbi.microsoft.com/) или сторонние средства визуализации.

- Вы можете запрашивать данные с помощью Azure Monitor REST API, команд интерфейса командной строки, командлетов [PowerShell](https://docs.microsoft.com/powershell/) или пакета SDK для .NET.

Чтобы начать работу с Azure Monitor, выберите **Все службы** на портале Azure.

1. Прокрутите вниз до области **Мониторинг** в разделе **Monitoring and Managing** (Мониторинг и управление).

    ![](media/protection-personal-data-azure-reporting-tools/image005.png)

2.  В представлении **Журнал действий** откроется раздел мониторинга.

    ![](media/protection-personal-data-azure-reporting-tools/image007.png)

Можно создавать и сохранять запросы для распространенных фильтров, а затем закрепить наиболее важные запросы на панели мониторинга на портале, чтобы всегда знать о событиях, которые соответствуют указанным условиям.

1. Вы можете фильтровать представление по группе ресурсов, интервалу времени и категории события.

    ![](media/protection-personal-data-azure-reporting-tools/image008.png)

2. Затем вы можете закрепить запросы на панели мониторинга портала, нажав кнопку **Закрепить**. Это поможет вам создать единый источник информации о рабочих данных в службах. Имя запроса и количество результатов появятся на панели мониторинга.

Вы можете также использовать раздел мониторинга для просмотра метрик для всех ресурсов Azure, настройки параметров диагностики и оповещений, а также поиска по журналу. Дополнительные сведения об использовании Azure Monitor и журнала действий см. в статье [Приступая к работе с Azure Monitor](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-get-started).

### <a name="azure-diagnostics"></a>Диагностика Azure 

Возможность диагностики в Azure позволяет выполнять сбор данных из нескольких источников. Журналы событий Windows, в том числе журнал безопасности, могут быть особенно полезны при отслеживании и создании документации по защите персональных данных. Журнал безопасности отслеживает как успешные события входа, так и события, завершившиеся сбоем, а также изменения разрешений, обнаружение шаблонов, указывающих определенные виды атак, изменения политик безопасности, изменения участников в группе безопасности и многое другое.

Например, событие с идентификатором 4695 оповещает о попытке снять защиту проверяемых защищенных данных. Это относится к API защиты данных (DPAPI), который помогает защитить такие данные, как закрытые ключи, сохраненные учетные данные и другие конфиденциальные данные.

#### <a name="how-do-i-enable-the-diagnostics-extension-for-windows-vms"></a>Как включить расширение системы диагностики для виртуальных машин Windows?

Вы можете использовать PowerShell для включения расширения системы диагностики для виртуальных машин Windows, также как и для сбора данных журнала. Необходимые действия будут зависеть от используемой модели развертывания (диспетчера ресурсов или классической). Чтобы включить расширение системы диагностики на уже существующей виртуальной машине, созданной с помощью модели развертывания диспетчера ресурсов, можно использовать [командлет PowerShell Set-AzureRMVMDiagnosticsExtension](https://docs.microsoft.com/powershell/module/azurerm.compute/set-azurermvmdiagnosticsextension?view=azurermps-4.3.1).

   ![](media/protection-personal-data-azure-reporting-tools/image009.png)

*\$diagnosticsconfig_path* — это путь к файлу с конфигурацией диагностики в формате XML. Подробные сведения о включении системы диагностики Azure на виртуальной машине под управлением Windows с помощью PowerShell см. в [этой статье](https://docs.microsoft.com/azure/virtual-machines/windows/ps-extensions-diagnostics).

Расширение системы диагностики Azure может переносить собранные данные в учетную запись хранения Azure или отправлять их в такие службы, как Application Insights. Затем можно использовать эти данные для аудита.

#### <a name="how-do-i-store-and-view-diagnostic-data"></a>Как хранить и просматривать диагностические данные?

Помните, что диагностические данные не хранятся долго. Для длительного хранения их необходимо переместить в эмулятор хранения Microsoft Azure или хранилище Azure. Чтобы сохранить и просмотреть диагностические данные в службе хранилища Azure, сделайте следующее:

1. Укажите учетную запись хранения в файле ServiceConfiguration.cscfg. Система диагностики Azure может использовать службу BLOB-объектов или таблиц в зависимости от типа данных. Журналы событий Windows хранятся в формате таблицы.

2. Переместите данные. Вы можете выполнить запрос на передачу диагностических данных с помощью файла конфигурации. Для пакета SDK версии 2.4 и более ранних версий можно также программно выполнить запрос.

3. Просмотрите данные с помощью [обозревателя хранилищ Azure](https://docs.microsoft.com/azure/vs-azure-tools-storage-manage-with-storage-explorer), [обозревателя сервера](https://docs.microsoft.com/azure/vs-azure-tools-storage-resources-server-explorer-browse-manage) в Visual Studio или [диспетчера системы диагностики Azure](https://www.cerebrata.com/products/azure-diagnostics-manager) в Azure Management Studio.

Дополнительные сведения о выполнении всех этих действий см. в статье [Хранение и просмотр диагностических данных в хранилище Azure](https://docs.microsoft.com/azure/cloud-services/cloud-services-dotnet-diagnostics-storage).

### <a name="azure-storage-analytics"></a>Аналитика службы хранилища Azure 

В аналитике хранилища регистрируется подробная информация об успешных и неудачных запросах к службе хранилища. Эти сведения можно использовать для мониторинга отдельных запросов, которые могут помочь в документировании доступа к персональным данным, хранящимся в службе. Тем не менее ведение журнала решения "Аналитики Службы хранилища" по умолчанию для учетной записи хранения не предусмотрено. Вы можете включить эту функцию на портале Azure.

#### <a name="how-do-i-configure-monitoring-for-a-storage-account"></a>Как настроить мониторинг учетной записи хранения?

Чтобы настроить мониторинг учетной записи хранения, сделайте следующее:

1. Выберите **Учетные записи хранения** на портале Azure, а затем выберите имя учетной записи для отслеживания.

    ![](media/protection-personal-data-azure-reporting-tools/image011.png)

2. В разделе **Мониторинг** выберите **Диагностика**.

3.  Выберите **тип** данных метрик для отслеживания для каждой службы (больших двоичных объектов, таблиц, файлов). Чтобы указать службе хранилища Azure сохранять журналы диагностики для запросов на чтение, запись и удаление, отправляемых к службам BLOB-объектов, таблиц и очередей, выберите **журналы больших двоичных объектов, журналы таблиц** и **журналы очередей**.

    ![](media/protection-personal-data-azure-reporting-tools/image013.png)

4. Используя ползунок в нижней области, задайте политику **хранения** в днях (значение от 1 до 365). По умолчанию используется значение семь дней.

5. Выберите **Сохранить**, чтобы применить параметры конфигурации.

Записи журналов хранения содержат следующие сведения об отдельных запросах:

- Сведения о времени, например время запуска, совокупное время задержки и время задержки сервера.

- Сведения об операциях в хранилище, например тип операции, раздел объекта хранилища, к которому клиент получает доступ, сведения об успешном выполнении операции или ее сбое, а также код состояния HTTP, возвращенный клиенту.

- Сведения о проверке подлинности, например тип проверки подлинности, используемый клиентом.

- Сведения о параллелизме, например значение ETag и последняя измененная метка времени.

- Размеры сообщений с запросом и ответом.

Подробные сведения о включении ведения журнала решения "Аналитики службы хранилища" см. в статье [Мониторинг учетной записи хранения на портале Azure](https://docs.microsoft.com/azure/storage/common/storage-monitor-storage-account).

### <a name="azure-security-center"></a>Центр безопасности Azure 

[Центр безопасности Azure](https://azure.microsoft.com/services/security-center/) отслеживает состояние безопасности ресурсов Azure, чтобы предотвращать и обнаруживать угрозы, а также предоставлять рекомендации для ответа. С его помощью вы можете несколькими способами задокументировать свои меры безопасности для защиты конфиденциальности персональных данных.

Отслеживание работоспособности системы безопасности необходимо для обеспечения соответствия политикам безопасности. Мониторинг системы безопасности — это упреждающая стратегия аудита ресурсов для выявления систем, которые не соответствуют корпоративным стандартам или рекомендациям. Вы можете отслеживать состояние безопасности следующих ресурсов:

- вычислений (виртуальные машины и облачные службы);

- сетей (виртуальные сети);

- хранилища и данных (аудит базы данных и сервера и обнаружение угроз, прозрачное шифрование данных, шифрование хранилища);

- приложений (потенциальные проблемы безопасности).

Проблемы безопасности в любой из этих категорий могут представлять угрозу разглашения персональных данных.

#### <a name="how-do-i-view-the-security-state-of-my-azure-resources"></a>Как просмотреть состояние безопасности ресурсов Azure?

Центр безопасности периодически анализирует состояние безопасности ресурсов Azure. Вы можете просмотреть любые потенциальные уязвимости безопасности, которые он идентифицирует, в разделе **Предотвращение** панели мониторинга.

   ![](media/protection-personal-data-azure-reporting-tools/image014.png)

1. В разделе **Предотвращение** выберите плитку **Вычисление**. Здесь вы увидите вкладки **Обзор** и **Виртуальные машины** со сведениями обо всех машинах и их состоянии безопасности, а **облачные службы** будут содержать список веб-ролей и рабочих ролей, отслеживаемых центром безопасности.

2. На вкладке **Обзор** щелкните рекомендацию, чтобы просмотреть дополнительные сведения.

3. Выберите виртуальную машину на вкладке **Виртуальные машины**, чтобы просмотреть дополнительные сведения.

После включения сбора данных в центре безопасности Azure на всех имеющихся и новых поддерживаемых виртуальных машинах будет автоматически подготовлен агент Microsoft Monitoring Agent. Данные, собранные из этого агента, сохраняются в существующей рабочей области [Log Analytics](https://azure.microsoft.com/services/log-analytics/), связанной с подпиской Azure, или в новой рабочей области.

[Отчеты об исследовании угроз](https://docs.microsoft.com/azure/security-center/security-center-threat-report) предоставляет центр безопасности. В них вы найдете полезные сведения для идентификации злоумышленников, сведения о целях, кампаниях по текущим и прошлым атакам, а также используемым тактикам, средствам и процедурам. В них также содержатся сведения по устранению рисков.

Основная цель этих отчетов об угрозах — содействие эффективному реагированию на непосредственную угрозу, а также принятие следующих соответствующих мер по устранению проблемы. Сведения в этих отчетах также можно использовать при документировании мер, принятых при возникновении инцидента, для создания отчетов и аудита.

Отчеты об исследовании угроз представлены в формате PDF. Доступ к ним можно получить через ссылку в поле **Отчеты** колонки **Suspicious process executed** (Выполнение подозрительных процессов) для каждого оповещения системы безопасности в центре безопасности Azure.

Дополнительные сведения о просмотре и использовании отчета об исследовании угроз см. в статье [Отчет об анализе угроз, предоставляемый центром безопасности Azure.](https://docs.microsoft.com/azure/security-center/security-center-threat-report)

## <a name="next-steps"></a>Дальнейшие действия

[Приступая к работе с API отчетов Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-reporting-api-getting-started-azure-portal)

[Что такое Log Analytics?](https://docs.microsoft.com/azure/log-analytics/log-analytics-overview)

[Обзор мониторинга в Microsoft Azure](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview)

[Introduction to the Azure Activity Log](https://azure.microsoft.com/resources/videos/intro-activity-log/) (Обзор журнала действий Azure в видео)
