---
title: Сетевая безопасность Azure | Документы Майкрософт
description: Узнайте об облачных службах вычислений, которые включают в себя широкий спектр вычислительных операций и служб, поддерживающих автомасштабирование ресурсов в соответствии с потребностями приложения или предприятия.
services: security
documentationcenter: na
author: UnifyCloud
manager: mbaldwin
editor: TomSh
ms.assetid: ''
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 11/21/2017
ms.author: TomSh
ms.openlocfilehash: 774d678c00b830f3932455c5b79fb44bde284d91
ms.sourcegitcommit: 870d372785ffa8ca46346f4dfe215f245931dae1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/08/2018
---
# <a name="azure-network-security"></a>Сетевая безопасность Azure

Мы понимаем, что в облаке безопасность имеет наивысший приоритет и вам крайне важно получать точные и своевременные сведения о безопасности Azure. Одним из наиболее весомых доводов в пользу использования Azure для приложений и служб является доступ к обширному ассортименту различных инструментов и функций обеспечения безопасности Azure. Эти средства и возможности мы предлагаем вам для создания безопасных решений на платформе Azure.

Microsoft Azure обеспечивает конфиденциальность, целостность и доступность данных клиента, а также прозрачный учет. Эта статья "Сетевая безопасность Azure" написана, чтобы помочь вам лучше понять набор средств управления безопасностью, реализованных в Microsoft Azure. В ней представлен взгляд с точки зрения клиента, а также содержатся исчерпывающие сведения об инструментах управления сетевой безопасностью в Microsoft Azure.

Цель этого документа — проинформировать вас о широком диапазоне средств управления безопасностью, которые можно настроить для повышения безопасности решений, развертываемых в Azure. Если вас интересуют действия, предпринимаемые Майкрософт для защиты структуры сети самой платформы Azure, см. раздел по безопасности Azure в [Центре управления безопасностью Майкрософт](https://www.microsoft.com/trustcenter/security/azure-security).

## <a name="azure-platform"></a>Платформа Azure

Azure — общедоступная облачная платформа, которая поддерживает широкий выбор операционных систем, языков программирования, платформ, инструментов, баз данных и устройств.  В ней можно запускать контейнеры Linux с интеграцией Docker, создавать приложения на языках JavaScript, Python, .NET, PHP, Java и Node.js, разрабатывать серверные решения для устройств под управлением iOS, Android и Windows. Облачные службы Azure поддерживают технологии, которым доверяют миллионы разработчиков и ИТ-специалистов.

Создавая ресурсы ИТ или перенося их в поставщик общедоступных облачных служб, вы полагаетесь на возможности организации по обеспечению защиты приложений и данных с помощью предоставляемых решений для управления безопасностью облачных ресурсов.

Инфраструктура устройств и приложений Azure предназначена для размещения миллионов пользователей одновременно. Это надежная база, которая удовлетворяет корпоративным требованиям к обеспечению безопасности. Кроме того, Azure предоставляет широкий набор настраиваемых решений для обеспечения безопасности, а также возможность управления ими. Все это позволит настроить защиту в соответствии с уникальными особенностями развернутых в организации служб.

## <a name="abstract"></a>Аннотация

Общедоступные облачные службы Майкрософт позволяют пользоваться масштабируемыми службами и инфраструктурой, возможностями корпоративного класса и множеством вариантов гибридных подключений. Вы можете обращаться к этим службам через Интернет или с помощью службы Azure ExpressRoute, которая позволяет создавать подключения к частной сети. Платформа Microsoft Azure позволяет вам легко добавлять в свою инфраструктуру облачные решения и создавать многоуровневую архитектуру. Кроме того, сторонние производители могут получить дополнительные возможности путем предоставления служб безопасности и виртуальных устройств.

Сетевые службы Azure по своему определению повышают гибкость, доступность, устойчивость, безопасность и целостность. В этом документе приводятся сведения о сетевых функциях Azure и информация о том, как клиенты могут использовать встроенные функции безопасности Azure для защиты своих информационных ресурсов.

Этот документ предназначен для следующих категорий читателей:

- технические руководители, сетевые администраторы и разработчики, которым нужны доступные и поддерживаемые в Azure решения по обеспечению безопасности;

-   эксперты или руководители бизнес-процессов, которые хотят получить общий обзор сетевых технологий и служб Azure, имеющих важное значение в обсуждениях сетевой безопасности в общедоступном облаке Azure.

## <a name="azure-networking-big-picture"></a>Общий обзор сети Azure
Microsoft Azure включает в себя надежную сетевую инфраструктуру для удовлетворения требований к взаимодействию приложений и служб. Сетевое взаимодействие возможно между ресурсами в Azure, между локальными и размещенными в Azure ресурсами, а также между Интернетом и службой Azure.

![Общий обзор сети Azure](media/azure-network-security/azure-network-security-fig-1.png)

[Сетевая инфраструктура Azure](https://docs.microsoft.com/azure/virtual-machines/windows/infrastructure-networking-guidelines) позволяет безопасно подключать ресурсы Azure между собой с помощью виртуальных сетей. Виртуальная сеть — это представление вашей собственной сети в облаке. Это логическая изоляция облачной сети Azure, выделенной для вашей подписки. Виртуальные сети можно также подключать к локальным сетям.

Azure поддерживает подключение к локальной сети по выделенному каналу связи WAN и к виртуальной сети Azure с помощью [ExpressRoute](https://docs.microsoft.com/azure/expressroute/expressroute-introduction). Для связи между Azure и вашим сайтом будет использоваться выделенное подключение вне общедоступного Интернета. Если ваше приложение Azure выполняется в нескольких центрах обработки данных, вы можете использовать [диспетчер трафика Azure](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-overview) для интеллектуального перенаправления запросов пользователей в экземпляры этого приложения. Вы также можете перенаправлять трафик в службы, не запущенные в Azure, если они доступны в Интернете.

## <a name="enterprise-view-of-azure-networking-components"></a>Корпоративное представление сетевых компонентов Azure
В Azure существует множество сетевых компонентов, имеющих отношение к вопросам безопасности сети. Мы дадим описание этих сетевых компонентов и рассмотрим связанные с ними вопросы безопасности.

> [!Note]
> Здесь описываются не все аспекты сетей Azure, а только те, которые считаются крайне важными при планировании и проектировании безопасной сетевой инфраструктуры для служб и приложений, развертываемых в Azure.

В этом документе будут затронуты следующие возможности сетевого взаимодействия Azure корпоративного класса:

-   Базовое сетевое подключение

-   Гибридное подключение

-   Средства управления безопасностью

-   Проверка сети

### <a name="basic-network-connectivity"></a>Базовое сетевое подключение

Служба [виртуальной сети Azure](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview) позволяет безопасно подключать ресурсы Azure между собой с помощью виртуальных сетей. Виртуальная сеть — это представление вашей собственной сети в облаке. Это логическая изоляция сетевой инфраструктуры Azure, выделенной для вашей подписки. Кроме того, виртуальные сети можно подключать между собой и к локальным сетям с помощью VPN-подключений типа "сеть-сеть" и выделенных [каналов WAN](https://docs.microsoft.com/azure/expressroute/expressroute-introduction).

![Базовое сетевое подключение](media/azure-network-security/azure-network-security-fig-2.png)

Имея представление о том, что виртуальные машины используются для размещения серверов в Azure, требуется ответить на вопрос о подключении этих виртуальных машин к сети. Дело в том, что виртуальные машины подключаются [к виртуальной сети Azure](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview).

Виртуальные сети Azure аналогичны виртуальным сетям, используемым вами в локальной среде с собственными решениями по платформе виртуализации, например Microsoft Hyper-V или VMware.

#### <a name="intra-vnet-connectivity"></a>Подключение виртуальных сетей между собой

Виртуальные сети можно подключать между собой. Таким образом ресурсы в этих виртуальных сетях смогут взаимодействовать. Чтобы подключить виртуальные сети между собой, воспользуйтесь одним или обоими способами:

- **Пиринг.** Позволяет взаимодействовать ресурсам, подключенным к разным виртуальным сетям Azure, в одном расположении Azure. Значения пропускной способности и задержки виртуальных сетей совпадают, как и при подключении ресурсов к одной виртуальной сети. Дополнительные сведения о пиринге см. в статье [Пиринг между виртуальными сетями](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview).

 ![Пиринг](media/azure-network-security/azure-network-security-fig-3.png)

- **Подключение между виртуальными сетями.** Позволяет взаимодействовать ресурсам, подключенным к разным виртуальным сетям Azure, в одном или в разных расположениях Azure. В отличие от пиринга, между виртуальными сетями пропускная способность ограничена, так как трафик должен проходить через VPN-шлюз Azure.

![Подключение виртуальной сети к виртуальной сети](media/azure-network-security/azure-network-security-fig-4.png)


Дополнительные сведения о подключении между виртуальными сетями см. в статье [Настройка подключения между виртуальными сетями на портале Azure](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal?toc=%2fazure%2fvirtual-network%2ftoc.json).

#### <a name="azure-virtual-network-capabilities"></a>Возможности виртуальной сети Azure

Как видите, виртуальная сеть Azure предоставляет виртуальные машины для подключения к сети, чтобы они могли безопасно подключаться к другим сетевым ресурсам. Однако базовое подключение является всего лишь началом. Следующие возможности службы виртуальной сети Azure предоставляют характеристики безопасности виртуальной сети Azure:

-   Изоляция

-   Подключение к Интернету

-   Подключение ресурсов Azure

-   Подключение виртуальных сетей

-   Локальные возможности подключения

-   Фильтрация трафика

-   Маршрутизация

**Изоляция**

Виртуальные сети полностью [изолированы](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview) друг от друга. Это позволяет создавать отдельные виртуальные сети для разработки, тестирования и эксплуатации, использующие одинаковые блоки адресов [CIDR](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing). И наоборот, можно создать несколько виртуальных сетей, использующих различные блоки адресов CIDR, и соединить их. Виртуальную сеть можно разделить на несколько подсетей.

Azure предоставляет возможность внутреннего разрешения имен для экземпляров ролей виртуальных машин и [облачных служб](https://azure.microsoft.com/services/cloud-services/), подключенных к виртуальной сети. При необходимости можно настроить виртуальную сеть для использования собственных DNS-серверов вместо внутреннего разрешения имен Azure.

Вы можете реализовать несколько виртуальных сетей в пределах [подписки](https://docs.microsoft.com/azure/azure-glossary-cloud-terminology?toc=%2fazure%2fvirtual-network%2ftoc.json) и [региона](https://docs.microsoft.com/azure/azure-glossary-cloud-terminology?toc=%2fazure%2fvirtual-network%2ftoc.json) Azure. Виртуальные сети изолированы друг от друга. Вот что можно сделать для каждой из них:

-   Указать пользовательское пространство частных IP-адресов, в котором используются общедоступные и частные адреса (RFC 1918). Azure назначает ресурсам, подключенным к виртуальной сети, частный IP-адрес из определенного адресного пространства.

-   Разделить виртуальную сеть на подсети и выделить каждой из них часть адресного пространства виртуальной сети.

-   Использовать разрешение имен Azure или указать собственный DNS-сервер, который будут использовать ресурсы, подключенные к виртуальной сети. Дополнительные сведения о разрешении имен в виртуальных сетях см. в статье [Разрешение имен для виртуальных машин и экземпляров ролей](https://docs.microsoft.com/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances).

**Подключение к Интернету**

По умолчанию все экземпляры ролей [виртуальных машин](https://docs.microsoft.com/azure/virtual-machines/windows/) и облачных служб Azure, подключенных к виртуальной сети, имеют доступ к Интернету. При необходимости можно включить входящий доступ к определенным ресурсам. Экземпляры ролей виртуальных машин и облачных служб, подключенных к виртуальной сети, имеют доступ к Интернету по умолчанию. При необходимости можно также включить входящий доступ к определенным ресурсам.

По умолчанию все ресурсы, подключенные к виртуальной сети, имеют исходящее подключение к Интернету. Частный IP-адрес ресурса методом SNAT преобразовывается в общедоступный IP-адрес в инфраструктуре Azure. Подключение по умолчанию можно изменить, реализовав пользовательскую маршрутизацию и фильтрацию трафика. Дополнительные сведения об исходящих интернет-подключениях см. в статье [Общие сведения об исходящих подключениях в Azure](https://docs.microsoft.com/azure/load-balancer/load-balancer-outbound-connections?toc=%2fazure%2fvirtual-network%2ftoc.json).

Для входящего подключения к ресурсам Azure из Интернета или исходящего подключения к Интернету без SNAT ресурсу необходимо назначить общедоступный IP-адрес. Дополнительные сведения об общедоступных IP-адресах см. в [этой статье](https://docs.microsoft.com/azure/virtual-network/virtual-network-public-ip-address).

**Подключение ресурсов Azure**

[Ресурсы Azure](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview), такие как облачные службы и виртуальные машины, можно подключить к одной виртуальной сети. Ресурсы могут подключаться друг к другу по частному IP-адресу, даже если они находятся в разных подсетях. В Azure предусмотрена маршрутизация по умолчанию между подсетями, виртуальными сетями и локальными сетями, поэтому вам не нужно настраивать маршруты и управлять ими.

К виртуальной сети можно подключить несколько ресурсов Azure, таких как виртуальные машины, облачные службы, среды службы приложений и масштабируемые наборы виртуальных машин. Виртуальные машины подключаются к подсети в виртуальной сети с помощью сетевого интерфейса. Дополнительные сведения о сетевых интерфейсах см. в [этой статье](https://docs.microsoft.com/azure/virtual-network/virtual-network-network-interface).

**Подключение виртуальных сетей**

[Виртуальные сети](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview) можно подключить между собой. Таким образом, ресурсы в этих виртуальных сетях смогут взаимодействовать.

Виртуальные сети можно подключать между собой. Таким образом ресурсы в этих виртуальных сетях смогут взаимодействовать. Чтобы подключить виртуальные сети между собой, воспользуйтесь одним или обоими способами:

- **Пиринг.** Позволяет взаимодействовать ресурсам, подключенным к разным виртуальным сетям Azure, в одном расположении Azure. Значения пропускной способности и задержки виртуальных сетей совпадают, как и при подключении ресурсов к одной виртуальной сети. Дополнительные сведения о пиринге см. в статье [Пиринг между виртуальными сетями](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview).

- **Подключение между виртуальными сетями.** Позволяет взаимодействовать ресурсам, подключенным к разным виртуальным сетям Azure, в одном или в разных расположениях Azure. В отличие от пиринга, между виртуальными сетями пропускная способность ограничена, так как трафик должен проходить через VPN-шлюз Azure. Дополнительные сведения о подключении одной виртуальной сети к другой. Дополнительные сведения см. в статье [Настройка подключения между виртуальными сетями на портале Azure](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal?toc=%2fazure%2fvirtual-network%2ftoc.json).

**Возможность подключения к локальной среде**

Виртуальные сети можно подключить к [локальным сетям](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview) через частные сетевые подключения между вашей сетью и Azure либо путем VPN-подключения типа "сеть-сеть" в Интернете.

Локальную сеть можно подключить к виртуальной, используя сочетание следующих способов:

- **VPN типа "точка — сеть".** Устанавливается между компьютером, подключенным к вашей сети, и виртуальной сетью. Этот тип подключения идеально подходит для новичков, не умеющих работать в Azure, или для разработчиков, так как при его использовании существующую сеть почти не нужно менять. Подключение осуществляется по протоколу SSTP для обеспечения зашифрованного обмена данными между компьютером и виртуальной сетью через Интернет. Задержку VPN типа "точка-сеть" невозможно спрогнозировать, так как трафик проходит через Интернет.

- **VPN типа "сеть — сеть".** Устанавливается между VPN-устройством и VPN-шлюзом Azure. Используя такое подключение, авторизованные локальные ресурсы могут получить доступ к виртуальной сети. Это VPN-подключение по протоколу IPSec/IKE, благодаря которому локальные устройства и VPN-шлюз Azure могут взаимодействовать по зашифрованному каналу через Интернет. Задержку VPN типа "сеть-сеть" невозможно спрогнозировать, так как трафик проходит через Интернет.

- **Azure ExpressRoute.** Устанавливается между вашей сетью и Azure через партнера ExpressRoute. Это подключение является закрытым. Трафик не передается через Интернет. Задержку для подключения ExpressRoute можно спрогнозировать, так как трафик не передается через Интернет. Дополнительные сведения о предыдущих способах подключения см. в разделе [Схемы топологий подключения](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json).

**Фильтрация трафика**

Входящий и исходящий [сетевой трафик](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview) экземпляров ролей виртуальных машин и облачных служб можно фильтровать по исходному и целевому IP-адресу и порту, а также по протоколу.

Сетевой трафик между подсетями можно фильтровать следующими способами:

- **Группы безопасности (NSG).** Каждая NSG может содержать несколько правил безопасности относительно входящего и исходящего трафика для его фильтрации по исходному и конечному IP-адресу, порту и протоколу. NSG можно применять к каждой сетевой карте на виртуальной машине, а также к подсети, к которой подключена сетевая карта или другой ресурс Azure. Дополнительные сведения о группах безопасности сети см. в [этой статье](https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg).

- **Виртуальные сетевые устройства.** Виртуальное сетевое устройство представляет собой виртуальную машину, на которой выполняется программное обеспечение, выступающее в роли сети, такое как брандмауэр. Список доступных виртуальных сетевых устройств см. в Azure Marketplace. Кроме того, доступны виртуальные сетевые устройства, обеспечивающие оптимизацию WAN, а также предоставляющие другие возможности для сетевого трафика. Виртуальные сетевые устройства обычно используются с определяемыми пользователем маршрутами или с маршрутами BGP. С помощью виртуальных сетевых устройств также можно фильтровать трафик между виртуальными сетями.

**Маршрутизация**

При необходимости можно переопределить маршрутизацию Azure по умолчанию, настроив собственные правила или используя маршруты BGP через сетевой шлюз.

Azure создает таблицы маршрутов, используя которые ресурсы, подключенные к любой подсети в любой сети, могут по умолчанию взаимодействовать. Чтобы переопределить маршруты по умолчанию, создаваемые в Azure, используйте следующие варианты:

- **Определяемые пользователем маршруты.** Вы можете создать пользовательские таблицы маршрутов с маршрутами, определяющими направление передачи трафика для каждой подсети. Дополнительные сведения об определяемых пользователем маршрутах см. в [этой статье](https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview).

- **Маршруты BGP.** При подключении виртуальной сети к локальной сети с помощью VPN-шлюза или канала ExpressRoute Azure можно распространить маршруты BGP в виртуальных сетях.

### <a name="hybrid-internet-connectivity-connect-to-an-on-premises-network"></a>Гибридное подключение к Интернету: подключение к локальной сети
Локальную сеть можно подключить к виртуальной, используя сочетание следующих способов:

-   Подключение к Интернету

-   VPN-подключение типа "точка-сеть" (P2S VPN)

-   VPN-подключение типа "сеть-сеть" (S2S VPN)

-   ExpressRoute

#### <a name="internet-connectivity"></a>Подключение к Интернету

Как следует из названия, подключение к Интернету делает ваши рабочие нагрузки доступными из Интернета за счет использования различных общедоступных конечных точек для рабочих нагрузок, выполняющихся внутри виртуальной сети. Эти рабочие нагрузки могут быть доступны с помощью [ориентированного на Интернет балансировщика нагрузки](https://docs.microsoft.com/azure/load-balancer/load-balancer-internet-overview) или путем простого назначения общедоступного IP-адреса виртуальной машине. Таким образом, любой пользователь в Интернете может получить доступ к этой виртуальной машине при условии, что такую возможность ему представляют брандмауэр узла, [группы безопасности сети (NSG)](https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg) и [определяемые пользователем маршруты](https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview).

В этом сценарии можно предоставить доступ к приложению в Интернете и получить возможность подключения к нему из любого места или определенных расположений в зависимости от конфигурации рабочих нагрузок.

#### <a name="point-to-site-vpn-or-site-to-site-vpn"></a>VPN-подключение типа "точка-сеть" или "сеть-сеть"
Эти два варианта входят в одну категорию. Для их реализации виртуальная сеть должна иметь VPN-шлюз, подключение к которому осуществляется с помощью VPN-клиента для рабочей станции в рамках [конфигурации "точка-сеть"](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal) или путем настройки локального [VPN-устройства](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpn-devices) для завершения VPN-подключения типа "сеть-сеть". В этом случае локальные устройства могут подключаться к ресурсам в виртуальной сети.

Конфигурация типа "точка — сеть" позволяет создать безопасное подключение к виртуальной сети с отдельного клиентского компьютера. Подключение типа "точка — сеть" — это VPN-подключение по протоколу SSTP (Secure Socket Tunneling Protocol).

![VPN-подключение типа "точка — сеть"](media/azure-network-security/azure-network-security-fig-5.png)

Это эффективное решение для подключений типа "точка-сеть" к виртуальной сети из удаленного расположения, например, если вы находитесь дома или в конференц-зале или если подключение к виртуальной сети требуется всего нескольким клиентам.

Для подключения типа "точка — сеть" не требуется VPN-устройство или общедоступный IP-адрес. VPN-подключение устанавливается с клиентского компьютера. Таким образом, вариант P2S не рекомендуется использовать для подключения к Azure, если требуется постоянное подключение многих локальных устройств и компьютеров к сети Azure.

![VPN-подключение "сеть-сеть"](media/azure-network-security/azure-network-security-fig-6.png)

> [!Note]
> Дополнительные сведения о подключениях типа "точка-сеть" см. в разделе [Часто задаваемые вопросы о подключениях типа "точка-сеть"](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-howto-point-to-site-classic-azure-portal).

Подключение VPN-шлюза типа "сеть — сеть" используется для подключения между локальной сетью и виртуальной сетью Azure через туннель VPN по протоколу IPsec/IKE (IKEv1 или IKEv2).

Для этого типа подключения требуется локальное VPN-устройство, которому назначен внешний общедоступный IP-адрес. Это подключение осуществляется через Интернет и позволяет передавать данные по зашифрованному каналу через туннель между вашей сетью и сетью Azure. VPN типа "сеть — сеть" представляет собой безопасную проверенную технологию, которая десятилетиями применяется на предприятиях всех размеров. Шифрование туннеля выполняется в [режиме туннелирования IPsec](https://technet.microsoft.com/library/cc786385.aspx).

Хотя VPN типа "сеть — сеть" и является надежной и проверенной технологией, трафик внутри туннеля все же передается через Интернет. Кроме того, пропускная способность относительно ограничена до 200 Мбит/с.

Если требуется обеспечить исключительный уровень безопасности и производительности для распределенных подключений, рекомендуется использовать Azure ExpressRoute. ExpressRoute — это выделенный канал связи в глобальной сети для локальной среды или поставщика услуг размещения Exchange. Так как это телекоммуникационное подключение, данные не проходят через Интернет и, таким образом, не подвергаются потенциальному риску при обмене данными через Интернет.

> [!Note]
> Дополнительные сведения о VPN-шлюзах см. в [этой статье](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways).

#### <a name="dedicated-wan-link"></a>Выделенный канал WAN
Microsoft Azure ExpressRoute позволяет переносить локальные сети в облако Azure по выделенному закрытому соединению, которое предоставляется поставщиком услуг подключения.

Подключения ExpressRoute не проходят через общедоступный Интернет. Это обеспечивает повышенный уровень безопасности, надежности и быстродействия подключений ExpressRoute и более низкий уровень задержки по сравнению с типовыми подключениями через Интернет.

![ Выделенный канал WAN](media/azure-network-security/azure-network-security-fig-7.png)

> [!Note]
> Сведения о том, как подключить сеть к облаку Майкрософт с помощью ExpressRoute, см. в статьях [Модели подключения ExpressRoute](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways) и [Технический обзор ExpressRoute](https://docs.microsoft.com/azure/expressroute/expressroute-introduction).

Как и VPN-подключение типа "сеть-сеть", ExpressRoute также позволяет подключаться к ресурсам, которые необязательно находятся только в одной виртуальной сети. В действительности в зависимости от номера SKU можно подключиться к 10 виртуальным сетям. Если у вас есть [дополнительный компонент уровня Premium](https://docs.microsoft.com/azure/expressroute/expressroute-faqs), поддерживаются подключения к максимум 100 виртуальным сетям (в зависимости от пропускной способности). Дополнительные сведения об этих типах подключений см. в разделе о [схемах топологий подключений](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json).

### <a name="security-controls"></a>Средства управления безопасностью
Виртуальная сеть Azure является безопасной логической сетью, которая изолирована от других виртуальных сетей и поддерживает множество средств управления безопасностью, используемых в локальных сетях. Клиенты создают собственные структуры с помощью подсетей — они используют собственный диапазон закрытых IP-адресов, настраивают таблицы маршрутизации, сетевые группы безопасности, списки контроля доступа (ACL), шлюзы и виртуальные устройства для выполнения рабочих нагрузок в облаке.

Ниже перечислены средства управления безопасностью, которые можно использовать в виртуальных сетях Azure.

-   Средства контроля сетевого доступа

-   Определяемые пользователем маршруты

-   Устройство безопасности сети

-   Шлюз приложений

-   Брандмауэр веб-приложения Azure

-   Средство управления доступностью сети

#### <a name="network-access-controls"></a>Средства контроля сетевого доступа
Хотя виртуальная сеть Azure (VNet) представляет собой основной компонент сетевой модели Azure и обеспечивает изоляцию и защиту, главным средством, используемым для применения и контроля правил сетевого трафика на сетевом уровне, являются [сетевые группы безопасности (NSG)](https://blogs.msdn.microsoft.com/igorpag/2016/05/14/azure-network-security-groups-nsg-best-practices-and-lessons-learned/).

![ Средства контроля сетевого доступа](media/azure-network-security/azure-network-security-fig-8.png)


Пользователи могут контролировать доступ, разрешая или запрещая взаимодействие рабочих нагрузок друг с другом в пределах виртуальной сети, с клиентских систем в сетях клиента с помощью подключений между сетями, а также напрямую через Интернет.

На схеме виртуальные сети и сетевые группы безопасности находятся на определенном уровне в общей системе безопасности, на котором с помощью сетевых групп безопасности (NSG), определяемого пользователем маршрута (UDR) и виртуальных сетевых устройств создаются границы безопасности для защиты развернутых приложений в защищаемой сети.

Для оценки трафика (и использования в правилах, настраиваемых для сетевых групп безопасности) группы NSG применяют 5 кортежей:

-   [Исходный и конечный IP-адрес](https://support.microsoft.com/help/969029/the-functionality-for-source-ip-address-selection-in-windows-server-2008-and-in-windows-vista-differs-from-the-corresponding-functionality-in-earlier-versions-of-windows)

-   [Исходный и конечный порт](https://technet.microsoft.com/library/dd197515)

-   Протокол: [протокол TCP](https://technet.microsoft.com/library/cc940037.aspx) или [протокол UDP](https://technet.microsoft.com/library/cc940034.aspx)

Это означает, что можно контролировать доступ между одной виртуальной машиной и группой виртуальных машин, одной виртуальной машиной и другой виртуальной машиной либо между всеми подсетями. Следует помнить, что это простая фильтрация пакетов с отслеживанием состояния, а не полная проверка пакетов. В группе безопасности сети отсутствует проверка протокола или возможность IDS или IPS уровня сети.

NSG включает в себя несколько встроенных правил, о которых нужно знать. а именно:

-   **Разрешить передачу всего трафика в конкретной виртуальной сети.** Все виртуальные машины в одной виртуальной сети Azure могут взаимодействовать друг с другом.

-   **Разрешить балансировку нагрузки Azure для входящего трафика.** Это правило разрешает передачу трафика из любого исходного адреса в любой адрес назначения для балансировщика нагрузки Azure.

-   **Запретить весь входящий трафик.** Это правило блокирует весь трафик, поступающий из Интернета, который вы разрешили явным образом.

-   **Разрешить весь исходящий трафик в Интернет.** Это правило разрешает виртуальным машинам инициировать подключения к Интернету. Если эти подключения не требуются, необходимо создать правило для блокировки этих подключений или применения принудительного туннелирования.

#### <a name="system-routes-and-user-defined-routes"></a>Системные маршруты и определяемые пользователем маршруты

При добавлении виртуальных машин в виртуальную сеть (VNet) в Azure можно заметить, что они могут автоматически связываться между собой по сети. Несмотря на то что виртуальные машины находятся в разных подсетях, не нужно указывать шлюз.

Это также относится к общедоступному подключению виртуальных машин через Интернет и даже по локальной сети при наличии гибридного подключения Azure к вашему центру обработки данных.

![Системные маршруты](media/azure-network-security/azure-network-security-fig-9.png)

Этот обмен данными возможен, так как Azure использует ряд системных маршрутов для определения передачи IP-трафика. Системные маршруты управляют обменом данных в следующих случаях:

-   в одной и той же подсети;

-   из одной подсети в другую в виртуальной сети;

-   из виртуальных машин в Интернет;

-   из одной виртуальной сети в другую через VPN-шлюз;

-   из одной виртуальной сети в другую через пиринговую связь ([цепочка служб](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview));

-   из виртуальной сети в локальную сеть через VPN-шлюз.

На многих предприятиях действуют строгие требования к обеспечению безопасности и соблюдению норм, предполагающие локальную проверку всех сетевых пакетов в целях применения определенных политик. В Azure имеется механизм, называемый [принудительным туннелированием](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-forced-tunneling), который направляет трафик из виртуальных машин в локальную среду, создавая настраиваемый маршрут или используя объявления [BGP](https://docs.microsoft.com/windows-server/remote/remote-access/bgp/border-gateway-protocol-bgp) через ExpressRoute или VPN.

В Azure принудительное туннелирование настраивается с помощью определяемых пользователем маршрутов виртуальной сети (UDR). Перенаправление трафика на локальный сайт выполняется с помощью маршрута по умолчанию к VPN-шлюзу Azure.

В разделе ниже перечислены текущие ограничения таблицы маршрутизации и маршрутов для виртуальной сети Azure.

-   Каждая подсеть виртуальной сети имеет встроенные системные таблицы маршрутизации. Системная таблица маршрутизации содержит три указанные ниже группы маршрутов.

 -  **Маршруты локальной виртуальной сети.** Они ведут непосредственно к виртуальным машинам назначения в той же виртуальной сети.

 - **Локальные маршруты.** Ведут к VPN-шлюзу Azure.

 -  **Маршрут по умолчанию.** Ведет напрямую в Интернет. Пакеты, предназначенные для частных IP-адресов, не входящих в предыдущие два маршрута, будут удалены.

-   Задав пользовательские маршруты, вы сможете создать таблицу маршрутизации для добавления маршрута по умолчанию, а затем сопоставить таблицу маршрутизации с подсетями вашей виртуальной сети для включения принудительного туннелирования в этих подсетях.

-   Из числа локальных межорганизационных сайтов, подключенных к виртуальной сети, необходимо выбрать "сайт по умолчанию".

-   Принудительное туннелирование должно быть сопоставлено с виртуальной сетью, в которой есть VPN-шлюз с динамической маршрутизацией (а не статический шлюз).

- С помощью этого механизма невозможно настроить принудительное туннелирование ExpressRoute. Такое туннелирование включается, когда предлагается маршрут по умолчанию с помощью сеансов пиринга BGP ExpressRoute.

> [!Note]
> Дополнительные сведения см. в [документации по ExpressRoute](https://azure.microsoft.com/documentation/services/expressroute/).

#### <a name="network-security-appliances"></a>Устройства сетевой безопасности
Хотя группы безопасности сети и определяемые пользователем маршруты и могут в некоторой мере обеспечить безопасность сети на уровне сети и транспортном уровне [модели OSI](https://en.wikipedia.org/wiki/OSI_model), в некоторых случаях также понадобится обеспечить безопасность сетевой системы высочайшего уровня. В таких случаях рекомендуется развернуть виртуальные сетевые устройства безопасности, предоставляемые партнерами Azure.

![Устройства сетевой безопасности](./media/azure-network-security/azure-network-security-fig-10.png)

Устройства сетевой безопасности сети Azure улучшают безопасность виртуальной сети и повышают эффективность сетевых функций. Они доступны у множества поставщиков в [Azure Marketplace](https://azuremarketplace.microsoft.com). Эти виртуальные устройства безопасности можно развернуть для использования следующих компонентов и выполнения следующих задач:

-   Высокодоступные брандмауэры

-   Предотвращение вторжений

-   Обнаружение вторжений

-   Брандмауэры веб-приложений (WAF)

-   Оптимизация WAN

-   Маршрутизация

-   Балансировка нагрузки.

-   Виртуальная частная сеть

-   Управление сертификатами

-   Active Directory

-   Многофакторная идентификация

#### <a name="application-gateway"></a>Шлюз приложений

[Шлюз приложений Microsoft Azure](https://docs.microsoft.com/azure/application-gateway/application-gateway-introduction) является выделенным виртуальным устройством, которое предоставляет контроллер доставки приложений (ADC) как услугу.

 ![Шлюз приложений](./media/azure-network-security/azure-network-security-fig-11.png)

Кроме того, он позволяет оптимизировать производительность и доступность веб-фермы за счет выполнения операции завершения SSL-запросов, требующей интенсивного использования ЦП, на шлюзе приложений (разгрузка SSL). Он также предоставляет другие возможности маршрутизации уровня 7, включая:

-   циклическое распределение входящего трафика;

-   сходство сеансов на основе файлов cookie;

-   маршрутизация на основе URL-путей;

-   возможность размещения нескольких веб-сайтов за одним шлюзом приложений.


[Брандмауэр веб-приложений (WAF)](https://docs.microsoft.com/azure/application-gateway/application-gateway-web-application-firewall-overview) также предоставляется как часть шлюза приложений. Он обеспечивает защиту веб-приложений от распространенных веб-уязвимостей и эксплойтов. Шлюз приложений можно настроить как шлюз с выходом в Интернет, внутренний шлюз или их сочетание.

WAF шлюза приложений можно запускать в режиме обнаружения или предотвращения. Администраторы обычно запускают шлюз в режиме обнаружения для отслеживания в трафике признаков вредоносных действий. После обнаружения потенциальных угроз переход в режим предотвращения позволяет блокировать подозрительный входящий трафик.

 ![Шлюз приложений](./media/azure-network-security/azure-network-security-fig-12.png)

Кроме того, WAF шлюза приложений служит для отслеживания атак, нацеленных на веб-приложения. Для этого применяется действующий в режиме реального времени журнал WAF, интегрированный с [Azure Monitor](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview) и [центром безопасности Azure](https://azure.microsoft.com/services/security-center/), для отслеживания предупреждений WAF и наблюдения за тенденциями.

Журнал в формате JSON поступает непосредственно в учетную запись хранения клиента. Вы полностью контролируете эти журналы и можете применять собственные политики хранения.

Эти журналы можно внедрить в собственную систему аналитики с помощью [интеграции журналов Azure](https://aka.ms/AzLog). Журналы WAF также интегрируются с [Log Analytics](../log-analytics/log-analytics-overview.md), поэтому Log Analytics можно использовать для выполнения сложных детализированных запросов.

#### <a name="azure-web-application-firewall-waf"></a>Брандмауэр веб-приложения Azure (WAF)

Веб-приложения все чаще становятся целью вредоносных атак, использующих общие известные уязвимости, например внедрения кода SQL, атаки межсайтовых сценариев и другие атаки, которые отображаются в [списке топ-10 уязвимостей от OWASP](https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project). Предотвращение таких эксплойтов в приложении требует неукоснительного обслуживания, установки исправлений и мониторинга на различных уровнях топологии приложения.

 ![Брандмауэр веб-приложения Azure (WAF)](./media/azure-network-security/azure-network-security-fig-13.png)

Централизованный [брандмауэр веб-приложения (WAF)](https://docs.microsoft.com/azure/application-gateway/application-gateway-web-application-firewall-overview) обеспечивает защиту от атак и упрощает управление безопасностью без каких-либо изменений приложения.

Решение WAF может быстрее реагировать на угрозы безопасности по сравнению с защитой каждого отдельного веб-приложения благодаря установке исправлений известных уязвимостей в центральном расположении. Существующие шлюзы приложений можно преобразовать в шлюзы приложений с поддержкой брандмауэра веб-приложений.

#### <a name="network-availability-controls"></a>Средства управления доступностью сети

Есть различные варианты для распределения сетевого трафика с помощью Microsoft Azure. Эти варианты работают по-разному, имеют разные наборы функций и поддерживают разные сценарии. Их можно использовать по отдельности или вместе.

Ниже указаны средства управления доступностью сети.

-   Azure Load Balancer

-   Шлюз приложений

-   Диспетчер трафика

**Балансировщик нагрузки Azure**

Обеспечивает высокий уровень доступности и производительности ваших приложений в сети. Это балансировщик нагрузки уровня 4 (TCP, UDP), распределяющий входящий трафик между работоспособными экземплярами служб, определенных в наборе балансировки нагрузки.

 ![Azure Load Balancer](media/azure-network-security/azure-network-security-fig-14.png)


Вот какие функции можно настроить в службе Azure Load Balancer:

-   балансировка нагрузки входящего интернет-трафика виртуальных машин. Такая конфигурация называется [балансировкой нагрузки для Интернета](https://docs.microsoft.com/azure/load-balancer/load-balancer-internet-overview).

-   Балансировка нагрузки трафика между виртуальными машинами в виртуальной сети, между виртуальными машинами в облачных службах или между локальными компьютерами и виртуальными машинами в распределенной виртуальной сети. Такая конфигурация называется [внутренней балансировкой нагрузки](https://docs.microsoft.com/azure/load-balancer/load-balancer-internal-overview).

-   Перенаправление внешнего трафика к определенному экземпляру виртуальной машины.

Чтобы все ресурсы облака были доступны через Интернет, им необходимы общедоступные IP-адреса. В облачной инфраструктуре Azure в ресурсах используются немаршрутизируемые IP-адреса. Azure использует преобразование сетевых адресов (NAT) с общедоступными IP-адресами для обмена данными с Интернетом.

 **шлюз приложений**;

 Шлюз приложений работает на прикладном уровне (уровень 7 в эталонном стеке сети OSI). Он выступает в качестве службы обратного прокси-сервера, завершая подключение клиента и перенаправляя запросы к конечным точкам серверной части.

 **Диспетчер трафика**

Диспетчер трафика Microsoft Azure позволяет управлять распределением пользовательского трафика между конечными точками службы в разных центрах обработки данных. К конечным точкам службы, поддерживаемым диспетчером трафика Azure, относятся виртуальные машины, веб-приложения и облачные службы Azure. Можно также использовать диспетчер трафика Azure для внешних конечных точек, не относящихся к среде Azure.

Диспетчер трафика использует службу доменных имен (DNS) для направления клиентских запросов к наиболее подходящей конечной точке в зависимости от [метода маршрутизации трафика](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-routing-methods) и работоспособности конечных точек. Диспетчер трафика предоставляет целый ряд методов маршрутизации трафика, подходящих для приложений с различными потребностями, а также для [мониторинга](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-monitoring) работоспособности конечных точек и автоматической отработки отказа. Диспетчер трафика устойчив к сбоям, включая сбой всего региона Azure.

Диспетчер трафика Azure позволяет управлять распределением трафика между конечными точками приложения. Конечная точка — это любая служба, размещенная в среде Azure или за ее пределами, с доступом в Интернет.

Диспетчер трафика предоставляет два основных преимущества.

-   Распределение трафика в соответствии с одним из нескольких [методов маршрутизации трафика](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-routing-methods).

-   [Постоянный мониторинг работоспособности конечной точки](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-monitoring) и автоматический переход на другой ресурс при сбое конечных точек.

Когда клиент пытается подключиться к службе, он должен сначала разрешить IP-адрес этой службы по ее DNS-имени. Затем клиент подключается к этому IP-адресу для доступа к службе. Диспетчер трафика с помощью службы DNS направляет клиентов к разным конечным точкам службы, используя правила маршрутизации трафика. Клиент напрямую подключается к выбранной конечной точке. Диспетчер трафика не выполняет функции прокси-сервера или шлюза. Диспетчер трафика не может отслеживать трафик, проходящий между клиентом и службой.

### <a name="azure-network-validation"></a>Проверка сети Azure

Проверка сети Azure предназначена для обеспечения работы сети Azure в соответствии с настройками. Для ее выполнения можно использовать службы и функции, доступные для мониторинга сети. С помощью наблюдателя за сетями Azure можно получить доступ к целому ряду возможностей для ведения журналов и диагностики, анализ данных которых позволит понять состояние работоспособности и производительности сети. Эти возможности доступны через портал, Power Shell, CLI, REST API и пакет SDK.

Под операционной безопасностью Azure понимаются службы, элементы управления и функции, которые пользователи могут использовать для защиты своих данных, приложений и других ресурсов в Microsoft Azure. Операционная безопасность Azure основывается на знаниях, полученных в процессе эксплуатации ряда уникальных систем корпорации Майкрософт, включая жизненный цикл разработки защищенных приложений (Майкрософт) (SDL) и программу Microsoft Security Response Center, а также на глубокой осведомленности в области угроз кибербезопасности.

-   [Azure Operations Management Suite](https://docs.microsoft.com/azure/operations-management-suite/operations-management-suite-overview)

-   [Центр безопасности Azure](https://docs.microsoft.com/azure/security-center/security-center-intro)

-   [Azure Monitor](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview)

-   [Наблюдатель за сетями Azure](https://docs.microsoft.com/azure/network-watcher/network-watcher-monitoring-overview)

-   [Azure Storage Analytics](https://docs.microsoft.com/rest/api/storageservices/fileservices/storage-analytics)

-   Azure Resource Manager

#### <a name="azure-resource-manager"></a>Azure Resource Manager

Сотрудники и процессы, работающие в Microsoft Azure, возможно, являются важнейшими компонентами безопасности платформы. В этом разделе описываются компоненты глобальной инфраструктуры центров обработки данных Майкрософт, которые помогают улучшать и поддерживать безопасность, целостность и конфиденциальность.

Обычно инфраструктура приложения состоит из ряда компонентов, например из виртуальной машины, учетной записи хранения и виртуальной сети или веб-приложения, базы данных, сервера базы данных и служб сторонних поставщиков. Эти компоненты не отображаются как отдельные сущности, вместо этого они воспринимаются как связанные и взаимозависимые части одной сущности. Их нужно развертывать, контролировать и отслеживать в виде группы. Azure Resource Manager позволяет работать с ресурсами решения как с группой.

Вы можете развертывать, обновлять или удалять все ресурсы решения в рамках одной скоординированной операции. Развертывание осуществляется на основе шаблона, используемого для разных сред, в том числе для тестовой, промежуточной и рабочей. Диспетчер ресурсов предоставляет функции безопасности, аудита и добавления тегов, помогающие управлять ресурсами после развертывания.

**Преимущества использования Resource Manager**

Диспетчер ресурсов предоставляет несколько преимуществ.

-   Вы можете развертывать и отслеживать все ресурсы вашего решения как единую группу, а не работать с ними по отдельности.

-   Вы можете повторно развертывать решение на протяжении всего цикла разработки и гарантировать, что ресурсы развертываются в согласованном состоянии.

-   Инфраструктурой можно управлять с помощью декларативных шаблонов, а не сценариев.

-   Вы можете определять зависимости между ресурсами так, чтобы они разворачивались в правильном порядке.

-   Вы можете применить контроль доступа ко всем службам, так как контроль доступа на основе ролей (RBAC) изначально интегрирован в платформу управления.

-   Для логического упорядочивания всех ресурсов в вашей подписке к ним можно применять теги.

-   Чтобы узнать о выставлении счетов для вашей организации, просмотрите затраты на группу ресурсов с общим тегом.

> [!Note]
> Диспетчер ресурсов предоставляет новый способ развертывания ваших решений и управления ими. Если вы использовали более раннюю модель развертывания и хотите узнать о произошедших изменениях, см. статью [Развертывание с помощью Azure Resource Manager и классическое развертывание: сведения о моделях развертывания и состоянии ресурсов](https://docs.microsoft.com/azure/azure-resource-manager/resource-manager-deployment-model).

## <a name="azure-network-logging-and-monitoring"></a>Ведение сетевых журналов и мониторинг сетей в Azure

Azure предлагает множество инструментов для отслеживания, предотвращения, обнаружения событий безопасности сети и реагирования на них. Ниже перечислены некоторые из наиболее эффективных инструментов, доступных в этой области.

-   Наблюдатель за сетями

-   Мониторинг уровня сетевого ресурса

-   Log Analytics

### <a name="network-watcher"></a>Наблюдатель за сетями

[Наблюдатель за сетями](https://docs.microsoft.com/azure/network-watcher/network-watcher-monitoring-overview). Мониторинг на основе сценариев обеспечивается с помощью функций Наблюдателя за сетями. Эта служба включает в себя запись пакетов, определение следующего прыжка, проверку IP-потока, представление групп безопасности и журналы потоков NSG. В отличие от мониторинга отдельных сетевых ресурсов, мониторинг на уровне сценария обеспечивает комплексное представление сетевых ресурсов.

 ![Наблюдатель за сетями](./media/azure-network-security/azure-network-security-fig-15.png)

Наблюдатель за сетями — это региональная служба, обеспечивающая мониторинг и диагностику условий на уровне сетевого сценария на платформе Azure. Инструменты диагностики сети и визуализации, доступные в Наблюдателе за сетями, помогают понять, как работает сеть в Azure, диагностировать ее и получить ценную информацию.

В настоящее время Наблюдатель за сетями имеет следующие возможности.

#### <a name="topology"></a>Топология

[Топология](https://docs.microsoft.com/azure/network-watcher/network-watcher-topology-overview) возвращает граф сетевых ресурсов в виртуальной сети. На графе показаны взаимодействия между ресурсами, позволяющие оценить сквозное сетевое подключение. На портале топология возвращает объекты ресурсов для каждой виртуальной сети. Связи показаны в виде линий между ресурсами за пределами региона Наблюдателя за сетями, даже если это не отображается в группе ресурсов. Ресурсы, возвращенные на портале, представляют собой подмножество сетевых компонентов, показанных на графе. Полный список сетевых ресурсов можно просмотреть с помощью [PowerShell](https://docs.microsoft.com/azure/network-watcher/network-watcher-topology-powershell) или [REST](https://docs.microsoft.com/azure/network-watcher/network-watcher-topology-rest).

После возвращения ресурсов между ними моделируется подключение по двум связям.

- **Вложение**. Виртуальная сеть содержит подсеть, которая, в свою очередь, содержит сетевую карту.

- **Связь**. Сетевая карта связана с виртуальной машиной.

#### <a name="variable-packet-capture"></a>Запись пакетов переменных

Возможности [записи пакетов переменных ](https://docs.microsoft.com/azure/network-watcher/network-watcher-packet-capture-overview) Наблюдателя за сетями позволяют создавать соответствующие сеансы для отслеживания входящего и исходящего трафика виртуальной машины. Функция записи пакетов помогает выявлять аномалии в работе сети по факту или заранее. Они также помогают выполнять сбор сетевой статистики, получать сведения о сетевых вторжениях, выполнять отладку передачи данных между клиентом и сервером и многое другое.

Запись пакетов — это расширение виртуальной машины, которое запускается удаленно в службе наблюдения за сетями. Эту функцию не нужно запускать вручную. К тому же она сразу выполняется на требуемой виртуальной машине, что также позволяет сэкономить ваше время. Запись пакетов можно активировать через портал, PowerShell, интерфейс командной строки или REST API. Один из примеров активации записи пакетов — активация с помощью оповещений на виртуальной машине.

#### <a name="ip-flow-verify"></a>Проверка IP-потока

Функция [проверки IP-потоков](https://docs.microsoft.com/azure/network-watcher/network-watcher-ip-flow-verify-overview) проверяет, разрешена или запрещена передача пакета на виртуальную машину или с нее на основе данных пяти кортежей. Эта информация включает в себя направление, протокол, локальный IP-адрес, удаленный IP-адрес, локальный порт и удаленный порт. Если пакет отклонен группой безопасности, возвращается имя правила, которое запретило этот пакет. Хотя может быть выбран любой исходный или конечный IP-адрес, эта функция помогает администраторам быстро диагностировать проблемы с входящим или исходящим подключением к Интернету и входящим или исходящим подключением к локальной среде.

Функция проверки IP-потоков нацеливается на сетевой интерфейс виртуальной машины. После чего на основе настроенных параметров проверяется входящий или исходящий поток трафика этого сетевого интерфейса. Эту возможность удобно использовать, чтобы проверить, блокирует ли правило в группе безопасности сети входящий или исходящий трафик виртуальной машины.

#### <a name="next-hop"></a>Следующий прыжок

Позволяет определить [следующий прыжок](https://docs.microsoft.com/azure/network-watcher/network-watcher-next-hop-overview) для пакетов, маршрутизируемых в сетевой структуре Azure, что позволяет диагностировать любые неправильные определяемые пользователем маршруты. Трафик из виртуальной машины отправляется по назначению в зависимости от действующих маршрутов, связанных с сетевой картой. Функция определения следующего прыжка возвращает тип следующего прыжка и IP-адрес пакета из определенной виртуальной машины и сетевой карты. Это позволяет определить, направляется ли пакет по назначению или трафик передается в "черную дыру".

Функция определения следующего прыжка также возвращает таблицу маршрутов, связанную со следующим прыжком. Если при запросе следующего прыжка маршрут задан как определяемый пользователем, то возвращается этот маршрут. В противном случае возвращается системный маршрут.

#### <a name="security-group-view"></a>Представление групп безопасности

Возвращает действующие и примененные правила безопасности, которые применяются к виртуальной машине. Группы безопасности сети (NSG) связаны на уровне подсети или сетевой карты. Если она связана на уровне подсети, то применяется ко всем экземплярам виртуальной машины в этой подсети. [Представление групп безопасности сети](https://docs.microsoft.com/azure/network-watcher/network-watcher-security-group-view-overview) возвращает все настроенные NSG и правила, связанные на уровне сетевой карты и подсети для виртуальной машины, обеспечивая глубокое понимание данных. Кроме того, оно возвращает действующие правила безопасности для каждой из сетевых карт в виртуальной машине. С помощью представления групп безопасности сети можно оценить сетевые уязвимости виртуальной машины, например открытые порты. Можно также проверить, работает ли группа безопасности сети ожидаемым образом, [сравнив настроенные и действующие правила безопасности](https://docs.microsoft.com/azure/network-watcher/network-watcher-nsg-auditing-powershell).

#### <a name="nsg-flow-logging"></a>Ведение журнала потоков NSG

 Журналы потоков для групп безопасности сети позволяют записывать журналы, относящиеся к трафику, который разрешают или запрещают правила безопасности в группе. Поток определяется данными пяти кортежей: исходный IP-адрес, конечный IP-адрес, исходный порт, конечный порт и протокол.

[Журналы потоков для групп безопасности сети](https://docs.microsoft.com/azure/network-watcher/network-watcher-nsg-flow-logging-overview) — это компонент Наблюдателя за сетями, который позволяет просматривать сведения о входящем и исходящем IP-трафике в группе безопасности сети.

#### <a name="virtual-network-gateway-and-connection-troubleshooting"></a>Устранение неполадок шлюза виртуальной сети и подключений

Наблюдатель за сетями предоставляет множество возможностей, так как он позволяет проанализировать сетевые ресурсы в Azure. Одна из этих возможностей — устранение неполадок в ресурсах. Процедуру [устранения неполадок с ресурсами](https://docs.microsoft.com/azure/network-watcher/network-watcher-troubleshoot-manage-rest) можно вызывать в PowerShell, интерфейсе командной строки или REST API. При вызове Наблюдатель за сетями проверяет работоспособность шлюза виртуальной сети или подключения и возвращает результаты.

В этом разделе вы ознакомитесь с разными задачами управления, доступными в настоящее время для устранения неполадок в ресурсах.

-   [Устранение неполадок шлюза виртуальной сети](https://docs.microsoft.com/azure/network-watcher/network-watcher-troubleshoot-manage-rest)

-   [Устранение неполадок подключений](https://docs.microsoft.com/azure/network-watcher/network-watcher-troubleshoot-manage-rest)

#### <a name="network-subscription-limits"></a>Ограничения сетевых ресурсов подписки

[Ограничения сетевых ресурсов подписки](https://docs.microsoft.com/azure/network-watcher/network-watcher-monitoring-overview) позволяют узнать об использовании каждого сетевого ресурса подписки в регионе и сравнить эти данные с максимальным количеством доступных ресурсов.

#### <a name="configuring-diagnostics-log"></a>Настройка журнала диагностики

Наблюдатель за сетями содержит представление [журналов диагностики](https://docs.microsoft.com/azure/network-watcher/network-watcher-monitoring-overview). Оно содержит все сетевые ресурсы, поддерживающие ведение журналов диагностики. В этом представлении можно удобно и быстро включать и отключать сетевые ресурсы.

### <a name="network-resource-level-monitoring"></a>Мониторинг уровня сетевого ресурса

Ниже приведены функции мониторинга уровня ресурса.

#### <a name="audit-log"></a>Журнал аудита

Регистрируются операции, выполняемые при настройке сетей. Эти журналы аудита необходимы для обеспечения соответствия различным нормам и требованиям. Эти журналы можно просмотреть на портале Azure или получить с помощью инструментов Майкрософт, таких как Power BI, или сторонних инструментов. Журналы аудита можно получить с помощью портала, PowerShell, интерфейса командной строки и REST API.

> [!Note]
> Дополнительные сведения о журналах аудита см. в статье [Операции аудита с помощью диспетчера ресурсов](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-audit).
Доступны журналы аудита для операций, выполненных со всеми сетевыми ресурсами.


#### <a name="metrics"></a>Метрики

Метрики представляют собой измерения производительности и счетчики, значения которых собираются за определенный период. В настоящее время доступны метрики для шлюза приложений. Метрики можно использовать для активации оповещений по пороговому значению. Шлюз приложений Azure по умолчанию отслеживает работоспособность всех ресурсов в своем пуле внутренних серверов и автоматически удаляет из пула все ресурсы, признанные неработоспособными. Шлюз приложений продолжает отслеживать неисправные экземпляры и добавляет их в пул внутренних серверов, как только они становятся доступными и начинают отвечать на проверку работоспособности. Шлюз приложений отправляет пробы работоспособности с помощью порта, который задан в параметрах HTTP серверной части. Благодаря этой конфигурации проверка тестирует тот же порт, с помощью которого клиенты подключаются к внутренней части.

> [!Note]
> Прочитайте раздел [Диагностика шлюза приложений](https://docs.microsoft.com/azure/application-gateway/application-gateway-probe-overview), чтобы узнать, как можно использовать метрики для создания оповещений.

#### <a name="diagnostic-logs"></a>Журналы диагностики

Периодические и спонтанные события, создаваемые сетевыми ресурсами, регистрируются в журналах в учетных записях хранения, отправляются в концентратор событий или в Log Analytics. Эти журналы содержат подробные сведения о работоспособности ресурса. Их можно просматривать в таких инструментах, как Power BI и Log Analytics. Чтобы узнать, как просматривать журналы диагностики, посетите страницу [Log Analytics](https://docs.microsoft.com/azure/log-analytics/log-analytics-azure-networking-analytics).

Доступны журналы диагностики для [подсистемы балансировки нагрузки](https://docs.microsoft.com/azure/load-balancer/load-balancer-monitor-log), [групп безопасности сети](https://docs.microsoft.com/azure/virtual-network/virtual-network-nsg-manage-log), маршрутов и [шлюза приложений](https://docs.microsoft.com/azure/application-gateway/application-gateway-diagnostics).

Наблюдатель за сетями содержит представление журналов диагностики. Оно содержит все сетевые ресурсы, поддерживающие ведение журналов диагностики. В этом представлении можно удобно и быстро включать и отключать сетевые ресурсы.

### <a name="log-analytics"></a>Служба Log Analytics

[Log Analytics](https://docs.microsoft.com/azure/log-analytics/log-analytics-overview) — это служба в Azure, которая отслеживает облачные и локальные среды, чтобы поддерживать уровень их доступности и производительности. Она собирает данные, формируемые ресурсами в облачных и локальных средах, а также другими средствами мониторинга, и на их основе предоставляет аналитические сведения для нескольких источников.

Log Analytics предлагает следующие решения для мониторинга сетей.

-   Монитор производительности сети

-   Анализ шлюзов приложений Azure

-   Анализ групп безопасности сети Azure

#### <a name="network-performance-monitor-npm"></a>Монитор производительности сети (NPM)
Решение по управлению [Монитор производительности сети](https://docs.microsoft.com/azure/log-analytics/log-analytics-network-performance-monitor) — это решение для мониторинга сети, которое отслеживает работоспособность и доступность сетей.

Оно используется для отслеживания подключения между следующими ресурсами:

-   общедоступное облако и локальная среда;

-   центры обработки данных и расположения пользователей (филиалы);

-   подсети, в которых размещены различные уровни многоуровневого приложения.


#### <a name="azure-application-gateway-analytics-in-log-analytics"></a>Анализ шлюзов приложений Azure в Log Analytics

Шлюзы приложений поддерживают следующие журналы:

-   ApplicationGatewayAccessLog

-   ApplicationGatewayPerformanceLog

-   ApplicationGatewayFirewallLog

Шлюзы приложений поддерживают следующие метрики:

-   5-минутная пропускная способность

#### <a name="azure-network-security-group-analytics-in-log-analytics"></a>Анализ групп безопасности сети Azure в Log Analytics

[Группы безопасности сети](https://docs.microsoft.com/azure/virtual-network/virtual-network-nsg-manage-log) поддерживают следующие журналы:

- **NetworkSecurityGroupEvent**. Содержит записи, по которым правила NSG на основе MAC-адреса применяются к виртуальным машинам и экземплярам ролей. Состояние этих правил регистрируется каждые 60 секунд.

- **NetworkSecurityGroupRuleCounter**. Содержит записи с информацией о том, сколько раз каждое правило NSG было применено для запрета или разрешения трафика.

## <a name="next-steps"></a>Дополнительная информация
Дополнительные сведения о безопасности можно узнать, ознакомившись с указанными далее подробными статьями.

-   [Аналитика журналов для групп безопасности сети](https://docs.microsoft.com/azure/virtual-network/virtual-network-nsg-manage-log)

-   [Инновационные возможности работы в сети, исключающие сбои облачных служб](https://azure.microsoft.com/blog/networking-innovations-that-drive-the-cloud-disruption/)

-   [SONiC. Сетевое программное обеспечение, повышающее эффективность глобального облака Майкрософт](https://azure.microsoft.com/blog/sonic-the-networking-switch-software-that-powers-the-microsoft-global-cloud/)

-   [Как корпорация Майкрософт создает свою быструю и надежную глобальную сеть](https://azure.microsoft.com/blog/how-microsoft-builds-its-fast-and-reliable-global-network/)

-   [Внедрение сетевых инноваций](https://azure.microsoft.com/blog/lighting-up-network-innovation/)
