---
title: Рекомендации по обеспечению безопасности баз данных Azure | Документация Майкрософт
description: В этой статье представлены рекомендации по безопасности баз данных Azure.
services: security
documentationcenter: na
author: unifycloud
manager: mbaldwin
editor: tomsh
ms.assetid: ''
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 11/21/2017
ms.author: tomsh
ms.openlocfilehash: 81acf90f0d600c0c3dafa2a4ccd2f8564fd18c9a
ms.sourcegitcommit: 870d372785ffa8ca46346f4dfe215f245931dae1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/08/2018
ms.locfileid: "33893897"
---
# <a name="azure-database-security-best-practices"></a>Рекомендации по обеспечению безопасности базы данных Azure

При управлении базами данных безопасность имеет первостепенное значение и всегда была приоритетной задачей для базы данных SQL Azure. Вы можете обеспечить надежную защиту баз данных, чтобы удовлетворить большинству нормативных требований или требований безопасности, включая, помимо прочих, стандарты HIPAA, ISO 27001/27002 и PCI DSS (уровень 1). Текущий список сертификатов соответствия требованиям безопасности доступен на [сайте Центра управления безопасностью Майкрософт](http://azure.microsoft.com/support/trust-center/services/). В зависимости от нормативных требований базы данных можно также разместить в определенных центрах обработки данных.

В этой статье мы рассмотрим рекомендации по обеспечению безопасности баз данных Azure. В основе рекомендаций лежит наш опыт в области защиты баз данных в Azure, а также отзывы клиентов.

Для каждой рекомендации будет предоставлено объяснение следующих аспектов:

-   суть рекомендации;
-   почему необходимо применять эту рекомендацию;
-   что может случиться, если не применить эту рекомендацию;
-   как научиться применять эту рекомендацию.

В этой статье изложено общепринятое мнение по рассматриваемому вопросу, а также представлены возможности и компоненты платформы Azure, доступные на момент ее написания. Со временем мнения и технологии меняются. Поэтому эта статья будет постоянно обновляться, чтобы отражать эти изменения.

Здесь рассматриваются следующие рекомендации по обеспечению безопасности баз данных Azure:

-   использование правил брандмауэра для ограничения доступа к базе данных;
-   включение проверки подлинности базы данных;
-   защита данных с помощью шифрования;
-   Защита данных при передаче
-   включение аудита базы данных;
-   обнаружение угроз для базы данных.


## <a name="use-firewall-rules-to-restrict-database-access"></a>Использование правил брандмауэра для ограничения доступа к базе данных

База данных SQL Microsoft Azure предоставляет службу реляционных баз данных для Azure и других интернет-приложений. Чтобы обеспечить безопасность доступа, база данных SQL управляет доступом с помощью правил брандмауэра, ограничивающих подключение по IP-адресу, механизмов проверки подлинности, требующих удостоверений пользователей, и методов авторизации, ограничивающих действия и данные для пользователей. Брандмауэр запрещает любой доступ к серверу базы данных, пока вы не укажете компьютеры, у которых есть разрешение на доступ. Брандмауэр предоставляет доступ к базам данным на основе исходного IP-адреса каждого запроса.

![Правила файрволла](./media/azure-database-security-best-practices/azure-database-security-best-practices-Fig1.png)

Служба Базы данных SQL Microsoft Azure доступна только на TCP-порте 1433. Для получения доступа к базе данных Azure со своего компьютера убедитесь, что брандмауэр клиентского компьютера пропускает исходящие подключения по протоколу TCP через порт 1433. Заблокируйте входящие подключения по протоколу TCP через порт 1433, если они не требуются для других приложений, используя правила брандмауэра.

В рамках процесса подключения все подключения от виртуальных машин Azure будут перенаправлены на другой IP-адрес и порт, уникальный для каждой рабочей роли. Номер порта находится в диапазоне от 11000 до 11999. Дополнительные сведения о TCP-портах см. в статье [Порты для ADO.NET 4.5, отличные от порта 1433](https://docs.microsoft.com/azure/sql-database/sql-database-develop-direct-route-ports-adonet-v12).

> [!Note]
> Дополнительные сведения о правилах брандмауэра см. в статье [Обзор правил брандмауэра базы данных SQL Azure](https://docs.microsoft.com/azure/sql-database/sql-database-firewall-configure).

## <a name="enable-database-authentication"></a>Включение проверки подлинности базы данных
База данных SQL поддерживает два типа проверки подлинности, проверку подлинности SQL и проверку подлинности Azure Active Directory (аутентификацию Azure AD).

**Проверка подлинности SQL** рекомендуется, если требуется поддержка следующих случаев:

-   Позволяет SQL Azure поддерживать среды с несколькими операционными системами, где все пользователи не проходят проверку подлинности с помощью домена Windows.
-   Позволяет SQL Azure поддерживать более старые приложения и приложения, поставляемые сторонними производителями, для которых требуется проверка подлинности SQL Server.
-   Позволяет пользователям устанавливать соединения из неизвестных или недоверенных доменов. Например, приложение, в котором клиенты подключаются с помощью назначенных учетных данных SQL Server для получения состояния их заказов.
-   Позволяет SQL Azure поддерживать веб-приложения, в которых пользователи создают собственные удостоверения.
-   Позволяет разработчикам программного обеспечения распространять свои приложения с помощью сложной иерархии разрешений на основе известных, заранее установленных учетных данных SQL Server.

> [!Note]
> Однако для проверки подлинности SQL Server не используются процедуры обеспечения безопасности Kerberos.

Если вы используете **проверку подлинности SQL**, вам потребуется:

-   самостоятельно управлять надежными учетными данными;
-   защитить учетные данные в строке подключения;
-   (потенциально) защитить учетные данные, передаваемые по сети с веб-сервера в базу данных (дополнительные сведения см. в статье [How to: Connect to SQL Server Using SQL Authentication in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998300.aspx) (Практическое руководство. Подключение к серверу SQL Server с помощью проверки подлинности SQL в ASP.NET 2.0)).

**Проверка подлинности Azure Active Directory** — это механизм подключения к базе данных SQL Microsoft Azure и [хранилищу данных SQL](https://docs.microsoft.com/azure/sql-data-warehouse/sql-data-warehouse-overview-what-is) с помощью удостоверений в Azure Active Directory (Azure AD). С помощью проверки подлинности Azure AD можно централизованно управлять удостоверениями пользователей базы данных и другими службами Майкрософт. Централизованное управление удостоверениями позволяет использовать единое расположение для управления пользователями и упрощает управление разрешениями. Это дает такие преимущества:

-   наличие альтернативного варианта проверки подлинности SQL Server;
-   возможность остановить увеличение количества пользователей на серверах баз данных;
-   возможность чередования паролей в одном расположении;
-   клиенты могут управлять разрешениями базы данных с помощью внешних групп (AAD);
-   возможность исключить хранение паролей с помощью встроенной проверки подлинности Windows и других видов проверки подлинности, поддерживаемых Azure Active Directory;
-   При проверке подлинности Azure AD используются данные пользователей автономной базы данных для проверки подлинности удостоверений на уровне базы данных.
-   Azure AD поддерживает проверку подлинности на основе маркеров для приложений, подключающихся к базе данных SQL.
-   Azure AD поддерживает проверку подлинности с использованием AD FS (федерация доменов) или собственную проверку подлинности с помощью имени пользователя и пароля для локального каталога Azure Active Directory без синхронизации домена.
-   Azure AD поддерживает подключения из SQL Server Management Studio, использующие универсальную проверку подлинности Active Directory, в том числе Многофакторную идентификацию (MFA). MFA обеспечивает надежную аутентификацию с использованием ряда простых вариантов проверки посредством телефонного звонка, текстового сообщения, смарт-карты с ПИН-кодом или уведомления в мобильном приложении. Дополнительные сведения см. в разделе [Поддержка SSMS в Azure AD MFA для базы данных SQL и хранилища данных SQL](https://docs.microsoft.com/azure/sql-database/sql-database-ssms-mfa-authentication).

Для настройки и использования проверки подлинности Azure Active Directory выполните следующие действия.

-   Создайте и заполните каталог Azure AD.
-   Свяжите или измените каталог Active Directory, который сейчас связан с вашей подпиской Azure (этот шаг можно пропустить).
-   Создайте учетную запись администратора Azure Active Directory для сервера Azure SQL Server или [хранилища данных SQL Azure](https://azure.microsoft.com/services/sql-data-warehouse/).
- Настройте клиентские компьютеры.
-   Создайте учетные записи пользователей автономной базы данных в базе данных, сопоставленной с удостоверениями Azure AD.
-   Подключитесь к базе данных с помощью удостоверений Azure AD.

Дополнительные сведения см. [здесь](https://docs.microsoft.com/azure/sql-database/sql-database-aad-authentication).

## <a name="protect-your-data-using-encryption"></a>Защита данных с помощью шифрования

[Прозрачное шифрование данных в базе данных SQL Azure](https://msdn.microsoft.com/library/dn948096.aspx) помогает защититься от вредоносных действий. В реальном времени выполняется шифрование и расшифровка хранимых баз данных, связанных резервных копий и файлов журналов транзакций. При этом само приложение изменять не нужно. При использовании TDE хранилище всей базы данных шифруется с помощью симметричного ключа, который называется ключом шифрования базы данных.

Даже если хранилище данных зашифровано, нужно зашифровать и базу данных. Такой подход обеспечивает эшелонированную защиту ваших данных. Если вы используете базу данных SQL Azure и хотите защитить конфиденциальные данные, например номера кредитных карт или социального страхования, то вы можете использовать для шифрования базы данных 256-разрядное шифрование AES, прошедшее проверку по стандарту FIPS 140-2 и соответствующее требованиям различных отраслевых стандартов (например, HIPAA и PCI).

Важно понимать, что файлы, относящиеся к [расширению буферного пула](https://docs.microsoft.com/sql/database-engine/configure-windows/buffer-pool-extension), не шифруются при использовании прозрачного шифрования базы данных. Для защиты этих файлов следует применить средства шифрования на уровне файловой системы, например [BitLocker](https://technet.microsoft.com/library/cc732774) или [шифрованную файловую систему (EFS)](https://technet.microsoft.com/library/cc700811.aspx).

Поскольку авторизованные пользователи, например администратор службы безопасности или администратор базы данных, имеют доступ к данным даже при использовании прозрачного шифрования, следует соблюдать ряд дополнительных рекомендаций:

-   включить проверку подлинности SQL на уровне базы данных;
-   выполнять проверку подлинности Azure AD с использованием [ролей RBAC](https://docs.microsoft.com/azure/role-based-access-control/overview);
-   использовать раздельные учетные записи для проверки подлинности пользователей и приложений (это позволит ограничить разрешения, предоставляемые пользователям и приложениям, и снизить риски вредоносных действий);
-   реализовать защиту на уровне базы данных с помощью предопределенных ролей базы данных (например, db_datareader и db_datawriter) или собственных пользовательских ролей для приложения, которые явным образом предоставляют разрешения для определенных объектов базы данных.

Другие способы шифрования данных включают следующее:

-   [Шифрование на уровне ячейки](https://msdn.microsoft.com/library/ms179331.aspx) для шифрования определенных столбцов или даже ячеек данных с использованием разных ключей шифрования.
-   Шифрование с помощью [Always Encrypted](https://msdn.microsoft.com/library/mt163865.aspx), которое позволяет клиентам шифровать конфиденциальные данные в приложениях, не раскрывая ключи шифрования в ядре СУБД (база данных SQL или SQL Server). Таким образом, Always Encrypted разделяет пользователей на владельцев данных (которые могут просматривать их) и управляющих данными (но без доступа к ним).
-   Использование безопасности на уровне строк. Безопасность на уровне строк позволяет пользователям управлять доступом к строкам в таблице базы данных в зависимости от характеристик пользователя, выполняющего запрос (например, членство в группе или контекст выполнения). Дополнительные сведения см. в статье [Безопасность на уровне строк](https://msdn.microsoft.com/library/dn765131).

## <a name="protect-data-in-transit"></a>Защита данных при передаче
Защита данных при передаче обязательно должна быть учтена в стратегии защиты данных. Так как данные будут перемещаться между разными расположениями, мы рекомендуем всегда использовать для обмена данными протоколы SSL/TLS. В некоторых случаях вам потребуется изолировать весь коммуникационный канал между локальной сетью и облачной инфраструктурой, создав виртуальную частную сеть (VPN).

Для перемещения данных между локальной инфраструктурой и Azure следует применять соответствующие меры безопасности, например использовать HTTPS или VPN.

Если организации нужен безопасный доступ к Azure с нескольких рабочих станций в локальной сети, то используйте [VPN-подключение типа "сеть — сеть"](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-site-to-site-create).

Если организации нужен безопасный доступ к Azure с отдельных рабочих станций в локальной сети, то используйте [VPN-подключение типа "точка — сеть"](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-point-to-site-create).

Большие наборы данных можно перемещать по выделенному высокоскоростному каналу глобальной сети, например [ExpressRoute](https://azure.microsoft.com/services/expressroute/). Если вы решите использовать ExpressRoute, то для дополнительной защиты можно зашифровать данные на уровне приложения с помощью [SSL/TLS](https://support.microsoft.com/kb/257591) или других протоколов.

Если вы обращаетесь к службе хранилища Azure через портал Azure, все транзакции проходят по протоколу HTTPS. Также для взаимодействия со [службой хранилища Azure](https://azure.microsoft.com/services/storage/) и [Базой данных SQL Azure](https://azure.microsoft.com/services/sql-database/) можно использовать [REST API хранилища](https://msdn.microsoft.com/library/azure/dd179355.aspx) через HTTPS.

Организации, не защищающие передаваемые данные, более уязвимы для [атак типа "злоумышленник в середине"](https://technet.microsoft.com/library/gg195821.aspx), [перехвата данных](https://technet.microsoft.com/library/gg195641.aspx) и перехвата сеанса. Такие атаки могут стать первым шагом в ходе получения доступа к конфиденциальным данным.

Дополнительные сведения о возможностях VPN в Azure см. в статье [Планирование и проектирование VPN-шлюза](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-plan-design).

## <a name="enable-database-auditing"></a>Включение аудита базы данных
Аудит экземпляра ядра СУБД SQL Server или отдельной базы данных включает в себя отслеживание и ведение журнала событий, происходящих в ядре СУБД. Подсистема аудита SQL Server позволяет проводить аудит сервера, который может предусматривать спецификации аудита серверов для событий на уровне сервера и спецификации аудита баз данных для событий на уровне базы данных. Прошедшие аудит события могут записываться в журналы событий или файлы аудита.

Для SQL Server есть несколько уровней аудита в зависимости от нормативных или стандартных требований для вашей установки. Подсистема аудита SQL Server предоставляет средства и процессы, необходимые для включения, хранения и просмотра аудитов на различных объектах серверов и баз данных.

[Аудит базы данных SQL Azure](https://docs.microsoft.com/azure/sql-database/sql-database-auditing) позволяет отслеживать события базы данных и записывать их в журнал аудита в учетной записи хранения Azure.

Аудит может помочь вам соблюсти требования нормативов, проанализировать работу с базой данных и получить представление о расхождениях и аномалиях, которые могут указывать на бизнес-проблемы или предполагаемые нарушения безопасности.

Средства аудита способствуют соблюдению стандартов соответствия, но не гарантируют их выполнение.

Дополнительные сведения об аудите базы данных и его включении см. в статье [Включение аудита и обнаружения угроз для серверов SQL в центре безопасности Azure](https://docs.microsoft.com/azure/security-center/security-center-enable-auditing-on-sql-servers).

## <a name="enable-database-threat-detection"></a>Обнаружение угроз для базы данных
Благодаря оповещениям безопасности о подозрительной активности система обнаружения угроз SQL позволяет обнаруживать потенциальные угрозы по мере возникновения и реагировать на них. Вы получаете оповещения о подозрительных действиях с базами данных, потенциальных уязвимостях, атаках путем внедрения кода SQL и аномальных закономерностях в доступе к базам данных. Оповещения об обнаружении угроз SQL содержат сведения о подозрительных операциях и рекомендации о том, как исследовать причину угрозы и устранить ее.

Например, внедрение кода SQL — один из распространенных видов угроз безопасности веб-приложений в Интернете, используемый для получения несанкционированного доступа к приложениям, управляемым данными. Хакеры используют уязвимости приложения, чтобы ввести вредоносные инструкции SQL в поля ввода приложения, чтобы испортить или изменить данные в базе данных.

Дополнительные сведения о настройке обнаружения угроз для базы данных на портале Azure см. в статье [Обнаружение угроз для базы данных SQL](https://docs.microsoft.com/azure/sql-database/sql-database-threat-detection).

Кроме того, оповещения об обнаружении угроз базы данных SQL интегрируются с [центром безопасности Azure](https://azure.microsoft.com/services/security-center/). Приглашаем воспользоваться бесплатным 60-дневным периодом.

Дополнительные сведения об обнаружении угроз для базы данных и его включении см. в статье [Включение аудита и обнаружения угроз для серверов SQL в центре безопасности Azure](https://docs.microsoft.com/azure/security-center/security-center-enable-auditing-on-sql-servers).

## <a name="conclusion"></a>Заключение
База данных Azure — это надежная платформа баз данных с полным набором функций безопасности, которые удовлетворяют многим организационным и нормативным требованиям. Вы можете защитить данные, контролируя физический доступ к данным и используя различные способы защиты данных на уровне файлов, столбцов или строк благодаря прозрачному шифрованию данных, шифрованию на уровне ячейки или обеспечению безопасности на уровне строк. Always Encrypted также позволяет выполнять операции с зашифрованными данными, что упрощает процесс обновления приложения. В свою очередь, благодаря доступу к журналам аудита действий базы данных SQL вы получаете необходимые сведения о способе и времени доступа к данным.

## <a name="next-steps"></a>Дополнительная информация
- Общие сведения о правилах брандмауэра см. в [этой статье](https://docs.microsoft.com/azure/sql-database/sql-database-firewall-configure).
- Сведения о пользователях и имена для входа см. в статье [Проверка подлинности и авторизация в базе данных SQL: предоставление доступа](https://docs.microsoft.com/azure/sql-database/sql-database-manage-logins).
- Ознакомьтесь с руководством [Защита базы данных SQL Azure](https://docs.microsoft.com/azure/sql-database/sql-database-security-tutorial).
