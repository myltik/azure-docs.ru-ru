---
title: Антивредоносная программа Майкрософт для Azure | Документация Майкрософт
description: В этой статье приведен обзор архитектуры антивредоносного ПО Майкрософт для Azure, а также поддерживаемых сценариев и конфигураций, с помощью которых можно включить, настроить и развернуть защиту для облачных служб и виртуальных машин Azure. В этой статье мы рассмотрим работу с основными функциями, включая настройку, управление и мониторинг, с помощью API управления службами Microsoft Azure, сценариев PowerShell, портала Azure и Visual Studio.
services: security
documentationcenter: na
author: barclayn
manager: mbaldwin
editor: ''
ms.assetid: 265683c8-30d7-4f2b-b66c-5082a18f7a8b
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/26/2018
ms.author: barclayn
ms.openlocfilehash: 9898b14745d88ba04acce02a5a38d1561c6f469e
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
ms.locfileid: "32192474"
---
# <a name="microsoft-antimalware-for-azure-cloud-services-and-virtual-machines"></a>Антивредоносное ПО Майкрософт для облачных служб и виртуальных машин Azure
Спектр современных угроз, с которыми сталкиваются пользователи облачных сред, расширяется чрезвычайно быстро. Поэтому подписчики, использующие облачные технологии в сфере ИТ-бизнеса, вынуждены искать средства эффективной защиты, обеспечивающие соответствие требованиям к безопасности. Антивредоносная программа (Майкрософт) для Azure — это бесплатное средство защиты для обнаружения и удаления вирусов, шпионского ПО и других вредоносных программ в режиме реального времени. Кроме того, вы можете настроить оповещения о попытках установки вредоносного или нежелательного программного обеспечения в системах Azure.

Это решение создано на той же платформе для средств защиты от вредоносных программ, что и Microsoft Security Essentials \[MSE\], Microsoft Forefront Endpoint Protection, Microsoft System Center Endpoint Protection, Windows Intune и Защитник Windows для Windows 8.0 и более поздних версий. Антивредоносное ПО для Azure — это единый агент для приложений и клиентских сред, работающий в фоновом режиме без стороннего вмешательства. Вы можете развернуть систему защиты, соответствующую рабочим нагрузкам своих приложений, и использовать базовую конфигурацию защиты (по умолчанию) или расширенную настраиваемую конфигурацию, включающую отслеживание вредоносных программ.

После развертывания антивредоносного ПО Майкрософт и его включения в среде Azure, содержащей ваши приложения, доступны следующие основные функции.

* **Защита в режиме реального времени**: мониторинг действий, выполняемых в облачных службах и виртуальных машинах, для обнаружения и блокировки работы вредоносных программ.
* **Запланированное сканирование**: периодическое целевое сканирование для обнаружения вредоносных программ, включая уже запущенные.
* **Исправление вредоносных действий**: автоматические действия в отношении обнаруженных вредоносных программ, например удаление или помещение в карантин вредоносных файлов, а также удаление из реестра нежелательных записей.
* **Обновление подписей**: автоматическая установка последних версий подписей (определений вирусов) с заданной частотой, обеспечивающая актуальность защиты.
* **Обновление модуля защиты от вредоносных программ**: автоматическое обновление соответствующего модуля защиты Майкрософт.
* **Обновление платформы защиты от вредоносных программ**: автоматическое обновление платформы антивредоносного ПО Майкрософт.
* **Активная защита**: отправка в Microsoft Azure отчетов с метаданными телеметрии, содержащих сведения об обнаруженных угрозах и подозрительных ресурсах. Это обеспечивает быстрое реагирование на возникающие угрозы и синхронное предоставление подписей в режиме реального времени с помощью системы Microsoft Active Protection System (MAPS).
* **Отправка образцов**: отправка отчетов и образцов в службу защиты от вредоносных программ Майкрософт для повышения качества обслуживания и устранения неполадок.
* **Исключения**: администраторы приложений и служб могут отключать защиту и сканирование для определенных файлов, процессов и дисков, повышая тем самым производительность и решая другие задачи.
* **Сбор событий защиты от вредоносных программ**: запись данных о работоспособности службы защиты от вредоносных программ, а также сведений о подозрительных действиях и исправлениях в журнале событий операционной системы. Вся эта информация собирается в пользовательской учетной записи хранения Azure.

> [!NOTE]
> Антивредоносную программу (Майкрософт) можно также развертывать с помощью центра безопасности Azure. Дополнительные сведения см. в статье [Установка Endpoint Protection в центре безопасности Azure](../security-center/security-center-install-endpoint-protection.md).
>
>

## <a name="architecture"></a>Архитектура
Антивредоносная программа (Майкрософт) для Azure включает в себя клиент и службу защиты от вредоносных программ (Майкрософт), классическую модель развертывания антивредоносной программы, командлеты PowerShell для антивредоносной программы и расширение системы диагностики Azure. Антивредоносное ПО Майкрософт поддерживается семействами операционных систем Windows Server 2008 R2, Windows Server 2012 и Windows Server 2012 R2. Операционная система Windows Server 2008 не поддерживает это решение, как и Linux. 

Во всех поддерживаемых семействах гостевых операционных систем Azure клиент и служба защиты от вредоносных программ Майкрософт устанавливаются по умолчанию в отключенном состоянии. На платформе для виртуальных машин клиент и служба защиты от вредоносных программ (Майкрософт) не устанавливаются по умолчанию. Это решение можно включить как дополнительный компонент в конфигурации виртуальной машины на портале Azure и в Visual Studio в разделе "Расширения безопасности".

Если вы используете службу приложений Azure, то в базовой службе, в которой размещено веб-приложение, также включено антивредоносное ПО (Майкрософт). Оно используется для защиты инфраструктуры службы приложений Azure и не затрагивает содержимое клиентов.

> [!NOTE]
> Реализована поддержка Windows Server 2016 с Защитником. Защитник Windows — это встроенное антивредоносное ПО, включенное в Windows Server 2016. Кроме того, интерфейс Защитника Windows по умолчанию включен для некоторых номеров SKU Windows Server 2016 ([подробнее](https://docs.microsoft.com/windows/threat-protection/windows-defender-antivirus/windows-defender-antivirus-on-windows-server-2016)). Расширение защиты от вредоносных программ для виртуальных машин Azure по-прежнему можно добавить на виртуальную машину Azure под управлением Windows Server 2016 с Защитником Windows. Но в таком случае применяются все дополнительные [политики конфигурации](https://gallery.technet.microsoft.com/Antimalware-For-Azure-5ce70efe), которые должны использоваться Защитником Windows. При помощи расширения не развертываются какие-либо дополнительные службы защиты от вредоносных программ.
> Дополнительные сведения об этом обновлении см. [здесь](https://blogs.msdn.microsoft.com/azuresecurity/2017/03/07/update-to-azure-antimalware-extension-for-cloud-services/).

### <a name="microsoft-antimalware-workflow"></a>Рабочий процесс антивредоносной программы (Майкрософт)
Администратор служб Azure может включить антивредоносное ПО со стандартной или настраиваемой конфигурацией для запущенных в Azure виртуальных машин и облачных служб следующим образом.

* Для виртуальных машин — на портале Azure в разделе **Расширения безопасности**.
* Для виртуальных машин — в Visual Studio в обозревателе сервера в разделе конфигурации виртуальных машин.
* Для виртуальных машин и облачных служб — с помощью [классической модели развертывания](https://msdn.microsoft.com/library/azure/ee460799.aspx) антивредоносной программы.
* Для виртуальных машин и облачных служб — с помощью командлетов PowerShell для защиты от вредоносных программ.

С помощью портала Azure или командлетов PowerShell можно отправить файл пакета расширения антивредоносной программы в предопределенное фиксированное расположение в системе Azure. Гостевой агент Azure (агент структуры) запускает расширение антивредоносного ПО и применяет соответствующие параметры конфигурации, указанные в качестве входных данных. Это действие включает службу защиты от вредоносных программ со стандартными или настраиваемыми параметрами конфигурации. Если настраиваемые параметры конфигурации не указаны, в службе защиты от вредоносных программ будут использоваться стандартные параметры. Дополнительные сведения см. в разделе *Antimalware configuration* (Конфигурация антивредоносного ПО) в документе [Microsoft Antimalware For Azure Cloud Services and VMs Code Samples](http://aka.ms/amazsamples "Microsoft Antimalware For Azure Cloud Services and VMs Code Samples") (Антивредоносная программа (Майкрософт) для облачных служб и виртуальных машин Azure: примеры кода).

После запуска клиент антивредоносного ПО Майкрософт загружает из Интернета в систему Azure последние версии модуля защиты от вредоносных программ и определения подписей. Служба защиты от вредоносных программ Майкрософт записывает события, связанные с работой служб, в системный журнал событий ОС в раздел «Источник события» для антивредоносного ПО. События включают состояние работоспособности клиента антивредоносного ПО, состояние защиты и исправлений, новые и старые параметры конфигурации, обновления модулей и определений подписей и пр.

Вы можете включить отслеживание вредоносных программ в облачной службе или виртуальной машине, чтобы все события журнала событий антивредоносного ПО записывались в учетную запись хранения Azure по мере возникновения. Служба защиты от вредоносных программ использует расширение диагностики Azure, чтобы собирать в системе Azure данные о событиях антивредоносного ПО, записывая их в таблицы в пользовательской учетной записи хранения Azure.

Рабочий процесс развертывания, включая шаги по настройке параметров, которые поддерживают вышеуказанные сценарии, описан в разделе [Сценарии развертывания антивредоносного ПО](#_Antimalware_Deployment_Scenarios) этой статьи.

![Антивредоносное ПО Майкрософт в Azure](./media/azure-security-antimalware/sec-azantimal-fig1.PNG)

> [!NOTE]
> Для развертывания наборов масштабирования виртуальных машин с антивирусным расширением Майкрософт можно использовать PowerShell или интерфейсы API и шаблоны Azure Resource Manager.  Чтобы установить расширение на уже работающую виртуальную машину, используйте пример сценария python *vmssextn.py*, который можно найти [здесь](https://github.com/gbowerman/vmsstools). Этот сценарий добавляет в набор масштабирования существующую конфигурацию расширения, а затем добавляет расширение в список существующих расширений в наборах масштабирования виртуальных машин.
>
>

### <a name="default-and-custom-antimalware-configuration"></a>Стандартная и настраиваемая конфигурации антивредоносного ПО
Стандартная конфигурация используется для защиты облачных служб или виртуальных машин Azure от вредоносных программ, если не указана настраиваемая конфигурация. Стандартные параметры конфигурации предварительно оптимизированы для работы в среде Azure. При необходимости стандартные параметры конфигурации можно настроить в соответствии с требованиями к развертыванию службы или приложения Azure, а также использовать их в других сценариях развертывания.

> [!NOTE]
> По умолчанию пользовательский интерфейс антивредоносной программы (Майкрософт) в Azure Resource Manager отключен, и обход этой ошибки с помощью файла [cleanuppolicy.xml](https://blogs.msdn.microsoft.com/azuresecurity/2016/02/24/update-on-microsoft-antimalware-and-azure-resource-manager-arm-vms/) не поддерживается. О том, как создать настраиваемую политику, узнайте в публикации блога [Enabling Microsoft Antimalware User Interface on Azure Resource Manager VMs Post Deployment](https://blogs.msdn.microsoft.com/azuresecurity/2016/03/09/enabling-microsoft-antimalware-user-interface-post-deployment/) (Включение пользовательского интерфейса антивредоносной программы (Майкрософт) на виртуальных машинах Azure Resource Manager после развертывания).
>
>

В следующей таблице приведены параметры конфигурации, доступные для службы защиты от вредоносных программ. Стандартные параметры конфигурации отмечены в таблице ниже в столбце "По умолчанию".

![Таблица 1](./media/azure-security-antimalware/sec-azantimal-tb18.PNG)

## <a name="antimalware-deployment-scenarios"></a>Сценарии развертывания антивредоносного ПО
В этом разделе рассматриваются сценарии включения и настройки антивредоносного ПО, включая мониторинг облачных служб и виртуальных машин Azure.

### <a name="virtual-machines---enable-and-configure-antimalware"></a>Виртуальные машины: включение и настройка антивредоносной программы
**Развертывание с использованием портала Azure**

Чтобы включить службу защиты от вредоносных программ, в колонке "Расширения" щелкните **Добавить**, в колонке "Новый ресурс" выберите **Антивредоносное ПО Майкрософт**, а затем в колонке "Антивредоносное ПО Майкрософт" нажмите кнопку **Создать**. Чтобы включить защиту от вредоносных программ с параметрами по умолчанию, щелкните **Создать**, не указывая параметры конфигурации. Вы также можете ввести параметры конфигурации антивредоносного ПО для настроенной виртуальной машины, как показано на рис. 2. Поддерживаемые значения конфигурации приведены в **подсказках** ко всем параметрам конфигурации в колонке "Добавление расширения".

![Параметры конфигурации виртуальной машины для антивредоносной программы (Майкрософт)](./media/azure-security-antimalware/sec-azantimal-fig2.PNG)

**Развертывание с использованием портала Azure**

Чтобы включить и настроить антивредоносную программу (Майкрософт) для виртуальных машин Azure с помощью портала Azure во время подготовки виртуальной машины, выполните следующее.

1. Войдите на портал Azure по ссылке <https://portal.azure.com>.

2.Чтобы создать виртуальную машину, последовательно выберите элементы **Создать**, **Вычисления**, **Виртуальная** **машина**, **Из коллекции** (не используйте функцию быстрого создания), как показано ниже.

![Новая виртуальная машина](./media/azure-security-antimalware/sec-azantimal-fig3.PNG)

3.На странице **Выберите образ** выберите образ **Microsoft Windows Server**.

4.Щелкните стрелку вправо и введите параметры конфигурации виртуальной машины.

5.На странице конфигурации виртуальной машины в разделе **Расширения безопасности** установите флажок **Антивредоносное ПО Майкрософт**.

6.Нажмите кнопку «Отправить», чтобы включить антивредоносное ПО Майкрософт для виртуальных машин Azure со стандартными параметрами конфигурации.

![Конфигурация виртуальной машины](./media/azure-security-antimalware/sec-azantimal-fig4.PNG)

**Развертывание с помощью страницы конфигурации виртуальной машины в Visual Studio**

Чтобы включить и настроить службу защиты от вредоносных программ Майкрософт с помощью Visual Studio, выполните следующие шаги.

1.Подключитесь к Microsoft Azure в Visual Studio.

2.Выберите виртуальную машину, развернув узел **Виртуальные машины** в **обозревателе серверов**.

![Конфигурация виртуальной машины в Visual Studio](./media/azure-security-antimalware/sec-azantimal-fig5.PNG)

3.Щелкните правой кнопкой мыши элемент **Настройка**, чтобы открыть страницу конфигурации виртуальной машины.

4.В раскрывающемся списке в разделе **Установленные расширения** выберите расширение **Антивредоносное ПО Майкрософт**, а затем нажмите кнопку **Добавить**, чтобы включить стандартную конфигурацию защиты от вредоносных программ.

![Установленные расширения](./media/azure-security-antimalware/sec-azantimal-fig6.PNG)

5.Чтобы настроить стандартные параметры конфигурации антивредоносного ПО, выберите расширение антивредоносного ПО в списке установленных расширений (выделено на рис.) и нажмите кнопку **Настроить**.

6.В текстовом поле **Общедоступная конфигурация** замените стандартную конфигурацию антивредоносного ПО настраиваемой конфигурацией в поддерживаемом формате JSON, а затем нажмите кнопку "ОК".

7.Нажмите кнопку **Обновить**, чтобы отправить обновленную конфигурацию на свою виртуальную машину.

![Расширение конфигурации виртуальной машины](./media/azure-security-antimalware/sec-azantimal-fig7.PNG)

**Примечание.** Конфигурация виртуальных машин Visual Studio поддерживает конфигурацию антивредоносного ПО только в формате JSON. Шаблон поддерживаемых параметров конфигурации антивредоносной программы в формате JSON приведен в статье [Microsoft Antimalware For Azure Cloud Services and VMs Code Samples](http://aka.ms/amazsamples "Microsoft Antimalware For Azure Cloud Services and VMs Code Samples") (Антивредоносная программа (Майкрософт) для облачных служб и виртуальных машин Azure: примеры кода).

**Развертывание с помощью командлетов PowerShell**

В приложении или службе Azure с помощью командлетов PowerShell можно включить и настроить антивредоносное ПО Майкрософт для виртуальных машин Azure.

Чтобы включить и настроить антивредоносное ПО Майкрософт, используя соответствующие командлеты PowerShell, выполните следующие шаги.

1. Настройте среду PowerShell, как описано в документации по адресу <https://github.com/Azure/azure-powershell>.
2. Чтобы включить и настроить антивредоносное ПО Майкрософт для виртуальной машины, используйте соответствующий командлет Set-AzureVMMicrosoftAntimalwareExtension, как описано в документации по адресу <http://msdn.microsoft.com/library/azure/dn771718.aspx>.

**Примечание.** Конфигурация виртуальных машин Azure поддерживает конфигурацию антивредоносного ПО только в формате JSON. Шаблон поддерживаемых параметров конфигурации антивредоносной программы в формате JSON приведен в статье [Microsoft Antimalware For Azure Cloud Services and VMs Code Samples](http://aka.ms/amazsamples "Microsoft Antimalware For Azure Cloud Services and VMs Code Samples") (Антивредоносная программа (Майкрософт) для облачных служб и виртуальных машин Azure: примеры кода).

### <a name="enable-and-configure-antimalware-using-powershell-cmdlets"></a>Включение и настройка защиты от вредоносных программ с помощью командлетов PowerShell
В приложении или службе Azure с помощью командлетов PowerShell можно включить и настроить антивредоносное ПО Майкрософт для облачных служб Azure. Обратите внимание, что антивредоносное ПО Майкрософт устанавливается на платформу для облачных служб в отключенном состоянии и его необходимо включить с помощью приложения Azure.

Чтобы включить и настроить антивредоносное ПО Майкрософт, используя командлеты PowerShell, выполните следующие шаги.

1. Настройте среду PowerShell, как описано в документации по адресу <https://github.com/Azure/azure-sdk-tools#get-started>.
2. Чтобы включить и настроить антивредоносное ПО Майкрософт для облачной службы, используйте соответствующий командлет Set-AzureServiceAntimalwareExtension, как описано в документации по адресу <http://msdn.microsoft.com/library/azure/dn771718.aspx>.

Шаблон поддерживаемых параметров конфигурации антивредоносной программы в формате XML приведен в статье [Microsoft Antimalware For Azure Cloud Services and VMs Code Samples](http://aka.ms/amazsamples "Microsoft Antimalware For Azure Cloud Services and VMs Code Samples") (Антивредоносная программа (Майкрософт) для облачных служб и виртуальных машин Azure: примеры кода).

### <a name="cloud-services-and-virtual-machines---configuration-using-powershell-cmdlets"></a>Облачные службы и виртуальные машины: настройка конфигурации с помощью командлетов PowerShell
В приложении или службе Azure с помощью командлетов PowerShell можно получить конфигурацию антивредоносного ПО Майкрософт для облачных служб и виртуальных машин.

Чтобы получить конфигурацию антивредоносного ПО с помощью командлетов PowerShell, выполните следующие шаги.

1. Настройте среду PowerShell, как описано в документации по адресу <https://github.com/Azure/azure-sdk-tools#get-started>.
2. **Для виртуальных машин**: получите конфигурацию антивредоносного ПО, используя соответствующий командлет Get-AzureVMMicrosoftAntimalwareExtension, как описано в документации по адресу <http://msdn.microsoft.com/library/azure/dn771719.aspx>.
3. **Для облачных служб**: получите конфигурацию антивредоносного ПО, используя соответствующий командлет Get-AzureServiceAntimalwareConfig, как описано в документации по адресу <http://msdn.microsoft.com/library/azure/dn771722.aspx>.

### <a name="remove-antimalware-configuration-using-powershell-cmdlets"></a>Удаление конфигурации антивредоносного ПО с помощью командлетов PowerShell
С помощью приложения или службы Azure можно удалить конфигурацию антивредоносной программы и связанную конфигурацию отслеживания вредоносных программ из соответствующих расширений антивредоносной программы и службы диагностики Azure, связанных с облачной службой или виртуальной машиной.

Чтобы удалить антивредоносное ПО Майкрософт, используя командлеты PowerShell, выполните следующие шаги.

1. Настройте среду PowerShell, как описано в документации по адресу <https://github.com/Azure/azure-sdk-tools#get-started>.
2. **Для виртуальных машин**: используйте соответствующий командлет Remove-AzureVMMicrosoftAntimalwareExtension, как описано в документации по адресу <http://msdn.microsoft.com/library/azure/dn771720.aspx>.
3. **Для облачных служб**: используйте соответствующий командлет Remove-AzureServiceAntimalwareExtension, как описано в документации по адресу <http://msdn.microsoft.com/library/azure/dn771717.aspx>.

Чтобы **включить** сбор событий антивредоносного ПО для виртуальной машины на портале предварительной версии Azure, выполните следующие шаги:

1. Щелкните любую часть линзы мониторинга в колонке виртуальной машины.
2. Выберите команду «Диагностика» в колонке «Метрика».
3. Переведите переключатель **Состояние** в положение "ВКЛ." и установите флажок для параметра "Журналы системы событий Windows".
4. . Вы можете снять флажки для остальных параметров в списке или оставить их, если это необходимо для работы службы приложений.
5. События антивредоносного ПО, относящиеся к категориям «Ошибка», «Предупреждение», «Информация» и т. д., будут записываться в вашу учетную запись хранения Azure.

Теперь события антивредоносного ПО будут собираться из системных журналов событий Windows в вашу учетную запись хранения Azure. Вы можете настроить учетную запись хранения для сбора событий антивредоносного ПО на виртуальной машине, выбрав соответствующую учетную запись хранения.

![Метрики и диагностика](./media/azure-security-antimalware/sec-azantimal-fig8.PNG)

> [!NOTE]
> Дополнительные сведения о том, как включить ведение журнала диагностики для антивредоносной программы Azure, см. в публикации блога [Enabling Diagnostics Logging for Azure Antimalware](https://blogs.msdn.microsoft.com/azuresecurity/2016/04/19/enabling-diagnostics-logging-for-azure-antimalware/) (Включение ведения журнала диагностики для антивредоносной программы Azure).
>
>

### <a name="enable-and-configure-antimalware-monitoring-using-powershell-cmdlets"></a>Включение и настройка отслеживания вредоносных программ с помощью командлетов PowerShell
С помощью командлетов PowerShell можно включить сбор событий антивредоносного ПО Майкрософт, выполняемый службой диагностики Azure, для облачной службы или виртуальной машины. Расширение службы диагностики Azure можно настроить так, чтобы события из источника журнала событий «Антивредоносное ПО Майкрософт» записывались в вашу учетную запись хранения Azure. События антивредоносного ПО, относящиеся к категориям «Ошибка», «Предупреждение», «Информация» и т. д., будут записываться в вашу учетную запись хранения Azure.

Чтобы включить сбор событий антивредоносного ПО в учетную запись хранения Azure с помощью командлетов PowerShell, выполните следующие шаги.

1. Настройте среду PowerShell, как описано в документации по адресу <https://github.com/Azure/azure-sdk-tools#get-started>.
2. **Для виртуальных машин**: используйте соответствующий командлет Set-AzureVMMicrosoftAntimalwareExtension с включенной функцией мониторинга, как описано в документации по адресу <http://msdn.microsoft.com/library/azure/dn771716.aspx>.
3. **Для облачных служб**: используйте соответствующий командлет Set-AzureServiceAntimalwareExtension с включенной функцией мониторинга, как описано в документации по адресу <http://msdn.microsoft.com/library/azure/dn771718.aspx>.

Вы можете просматривать необработанные события антивредоносного ПО в таблице *WADWindowsEventLogsTable* в учетной записи хранения Azure, которую вы настроили для отслеживания вредоносных программ. Это позволяет проверить, как работает сбор событий антивредоносного ПО, а также оценить работоспособность службы защиты от вредоносных программ. Дополнительную информацию, включая пример кода для извлечения событий антивредоносной программы из учетной записи хранения, см. в статье [Microsoft Antimalware For Azure - Code Samples](http://aka.ms/amazsamples "Microsoft Antimalware For Azure - Code Samples") (Антивредоносная программа (Майкрософт) для облачных служб и виртуальных машин Azure: примеры кода).
