---
title: "Рекомендации по безопасности Azure Service Fabric | Документация Майкрософт"
description: "В этой статье представлены рекомендации по безопасности Azure Service Fabric."
services: security
documentationcenter: na
author: unifycloud
manager: swadhwa
editor: tomsh
ms.assetid: 
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/04/2017
ms.author: tomsh
ms.translationtype: HT
ms.sourcegitcommit: 0aae2acfbf30a77f57ddfbaabdb17f51b6938fd6
ms.openlocfilehash: 3132e42aac72c0132c7526ac56d80bc5eec269e7
ms.contentlocale: ru-ru
ms.lasthandoff: 08/09/2017

---
# <a name="azure-service-fabric-security-best-practices"></a>Рекомендации по безопасности Azure Service Fabric
Развертывание приложения в Azure — быстрое, удобное и экономичное. Перед развертыванием облачного приложения в рабочей среде удобно иметь под рукой рекомендации, содержащие важные и лучшие методики, которые помогают оценить приложение.

Azure Service Fabric — это платформа распределенных систем, которая дает возможность не только легко упаковывать и развертывать масштабируемые и надежные микрослужбы, но и управлять ими. Service Fabric также позволяет разрешить значительные трудности, возникающие при разработке облачных приложений и управлении ими. Получая гарантированную масштабируемость, надежность и управляемость, разработчики и администраторы могут сосредоточиться на реализации критически важных и ресурсоемких рабочих нагрузок вместо того, чтобы тратить силы на решение сложных проблем с инфраструктурой. 

Для каждой рекомендации будет предоставлено объяснение следующих аспектов:

-   суть рекомендации;
-   почему необходимо применять эту рекомендацию;
-   что может случиться, если не применить эту рекомендацию;
-   как научиться применять эту рекомендацию.

Сейчас доступны следующие рекомендации по обеспечению безопасности в Azure Service Fabric:

-   Создание безопасного кластера с помощью шаблона Azure Resource Manager (ARM) и модуля PowerShell Azure для Service Fabric.
-   Использование сертификата X.509.
-   Настройка политик безопасности.
-   Настройка безопасности с помощью Reliable Actors.
-   Настройка SSL для Azure Service Fabric.
-   Обеспечение сетевой изоляции и безопасности с помощью Azure Service Fabric.
-   Настройка хранилища ключей для обеспечения безопасности.
-   Назначение пользователей ролям


## <a name="best-practices-for-securing-your-cluster"></a>Рекомендации по обеспечению безопасности кластера

**Общая картина**

Всегда используйте безопасный кластер.
-   Безопасность кластера. Используйте сертификаты.
-   Клиентский доступ (для администраторов и только для чтения). Используйте AAD.

Используйте автоматическое развертывание.
-   Используйте сценарии для создания, развертывания и смены секретов.
-   Храните секреты в хранилище ключей. Используйте AD для других видов клиентского доступа.
-   Никто не должен иметь к ним доступ без аутентификации.

Кроме того, учтите следующее:
-   Создавайте сети периметра с помощью групп безопасности сети.
-   Используйте серверы перехода для подключения к виртуальным машинам кластера по протоколу удаленного рабочего стола или для управления кластером.

Кластеры должны быть защищены для предотвращения подключения к ним неавторизованных пользователей, особенно в тех случаях, когда на кластере выполняются рабочие нагрузки в рабочей среде. Существует возможность создания незащищенного кластера, однако стоит учитывать, что это позволит анонимным пользователям подключаться к нему, если конечные точки управления кластером общедоступны через Интернет.

Технологии, используемые для реализации этих сценариев. [Сценарии обеспечения безопасности кластера](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security):

-   Безопасность обмена данными между узлами. Обеспечивается защита взаимодействия виртуальных машин и компьютеров в кластере. Такая защита гарантирует, что размещать приложения и службы в кластере смогут владельцы только тех компьютеров, которые прошли авторизацию для подключения к кластеру.
Кластеры, работающие в Azure, или автономные кластеры, работающие под управлением Windows, могут использовать [безопасность на основе сертификатов](https://docs.microsoft.com/azure/service-fabric/service-fabric-windows-cluster-x509-security) или [безопасность Windows](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-windows-cluster-windows-security) для компьютеров Windows Server.
-   Безопасность обмена данными между клиентами и узлами. Обеспечивается защита взаимодействия клиента Service Fabric и отдельных узлов в кластере.
-   Управление доступом на основе ролей. Клиентские роли (администратора или клиента) задаются во время создания кластера путем предоставления отдельных удостоверений (сертификатов, AAD и т. д.) для каждой из них.
-   Рекомендации по безопасности. Чтобы обеспечить безопасность обмена данными между узлами в кластерах Azure, рекомендуется использовать безопасность AAD для аутентификации клиентов и сертификатов.

Для настройки автономного кластера Windows см. статью [Параметры конфигурации для автономного кластера Windows](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-manifest).

Используйте шаблон Azure Resource Manager (ARM) и модуль PowerShell Azure для Service Fabric для создания безопасного кластера.
Пошаговое руководство, которое поможет выполнить настройку защищенного кластера Azure Service Fabric в Azure с помощью Azure Resource Manager, доступно [здесь](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm).

Используйте шаблон Azure Resource Manager для настройки кластера.
-   Настройте управляемое хранилище для виртуальных жестких дисков виртуальной машины.

Используйте шаблон Azure Resource Manager для изменения группы ресурсов.
-   Простое управление конфигурацией.
-   Аудит

Считайте конфигурацию кластера кодом.
-   Тщательно проверяйте конфигурации, которые требуется развернуть.
-   Не используйте неявные команды для настройки ресурсов напрямую.

Многие аспекты [жизненного цикла приложения Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-application-lifecycle) можно автоматизировать. [Модуль PowerShell Azure для Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-deploy-remove-applications#upload-the-application-package) автоматизирует типовые задачи по развертыванию, обновлению, удалению и тестированию приложений Service Fabric. Также доступны управляемые API и API HTTP для управления приложениями.

## <a name="use-x509-certificates"></a>Использование сертификата X.509.
Кластеры всегда должны быть защищены с помощью сертификатов X.509 или службы безопасности Windows. Безопасность настраивается только во время создания кластера. После этого ее невозможно включить.

При указании [сертификата кластера](https://docs.microsoft.com/azure/service-fabric/service-fabric-windows-cluster-x509-security) задайте для параметра ClusterCredentialType значение X509. При указании сертификата сервера для внешних соединений задайте для параметра ServerCredentialType значение X509.

-   Сертификаты, которые используются в кластерах, выполняющих рабочие нагрузки в рабочей среде, следует создать с помощью правильно настроенной службы сертификации Windows Server или получить из утвержденного центра сертификации.
-   Никогда не используйте в рабочей среде какие-либо временные или тестовые сертификаты, созданные с помощью таких инструментов, как MakeCert.exe.
-   Можно использовать самозаверяющий сертификат, но это следует делать только для тестовых кластеров, а не в рабочей среде.

Этот кластер не защищен. Любой пользователь может анонимно подключиться и выполнять операции управления, поэтому рабочие кластеры нужно обязательно защищать с помощью сертификатов X.509 или средств обеспечения безопасности Windows.

Дополнительные сведения о включении сертификатов в кластере Service Fabric см. в статье [Добавление и удаление сертификатов для кластера Service Fabric в Azure](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security-update-certs-azure).

## <a name="configure-security-policies"></a>Настройка политик безопасности.
Кроме того, платформа помогает защищать ресурсы, используемые приложениями при развертывании с помощью учетных записей, например файлы, каталоги и сертификаты. Это позволяет изолировать друг от друга выполняемые приложения, даже если они запущены в общей среде.

-   Используйте группу доменов или пользователя Active Directory. Службу можно запустить с использованием учетных данных для учетной записи пользователя или группы Active Directory. Речь идет о локальной службе Active Directory в домене, а не Azure Active Directory (Azure AD). С помощью пользователей или групп домена вы можете обращаться к другим ресурсам в домене (например, к общим файловым ресурсам), для которых предоставлены разрешения на доступ.

-   Назначьте политику безопасности доступа для конечных точек HTTP и HTTPS. Если к службе применяется политика запуска от имени, а манифест службы объявляет в качестве ресурсов конечные точки, использующие протокол HTTP, вам нужно указать SecurityAccessPolicy. Это гарантирует, что к выделенным для этих конечных точек портам будут правильно применены списки управления доступом для той учетной записи, от имени которой выполняется служба. В противном случае файл http.sys не получит доступа к службе, а вызовы от клиента будут завершаться ошибками.
Дополнительные сведения о включении политики безопасности в Service Fabric см. в статье [Настройка политик безопасности для приложения](https://docs.microsoft.com/azure/service-fabric/service-fabric-application-runas-security).

## <a name="reliable-actors-security-configuration"></a>Настройка безопасности с помощью Reliable Actors.
Субъекты Reliable Actors Service Fabric — это реализация шаблона проектирования субъектов. Как и в случае с любым другим шаблоном проектирования программного обеспечения, решение о выборе того или иного шаблона зависит от того, соответствует ли он проблеме проектирования программного обеспечения.

В частности следует учесть, подойдет ли шаблон субъекта для моделирования проблемы или сценария, если:
-   Проблемное пространство включает множество (тысячи и больше) небольших независимых и изолированных единиц состояния и логики.
-   Вы собираетесь работать с однопоточными объектами, которые не требуют значительного взаимодействия с внешними компонентами, включая запросы состояния в пределах определенного набора субъектов.
-   Экземпляры субъекта не должны блокировать вызывающие объекты с непредсказуемыми задержками, выполняя операции ввода-вывода.

В Service Fabric субъекты реализуются на платформе субъектов Reliable Actors: платформа приложений на основе шаблона субъекта опирается на [службы Reliable Services Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction). Каждая написанный вами субъект Reliable Actor фактически представляет собой секционированную надежную службу Reliable Service с отслеживанием состояния.
Аналогично объектам .NET, которые являются экземплярами типа .NET, каждый субъект определяется как экземпляр типа субъекта. Предположим, есть тип субъекта, который реализует функции калькулятора, и есть много субъектов этого типа, распределенных по разным узлам кластера. У каждого такого субъекта есть уникальный идентификатор.

[Конфигурации безопасности репликаторов](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-actors-kvsactorstateprovider-configuration) используются для защиты канала связи, который используется во время репликации. Это означает, что службы не будут "видеть" реплицируемый трафик друг друга, что позволит обеспечить высокую доступность и высокий уровень защиты. По умолчанию пустой раздел конфигурации безопасности означает, что канал репликации не защищен.
Конфигурации репликатора используются для настройки репликатора, отвечающего за надежность состояний поставщика состояний субъекта.

## <a name="configure-ssl-for-azure-service-fabric"></a>Настройка SSL для Azure Service Fabric.

[Аутентификация сервера](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm) позволяет аутентифицировать конечные точки управления кластера в клиенте управления, чтобы он "знал", что обращается к настоящему кластеру. Этот сертификат также предоставляет [SSL](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-cluster-creation-via-arm) для API управления HTTPS и Service Fabric Explorer по протоколу HTTPS.
Необходимо получить имя личного домена для кластера. При запросе сертификата из ЦС имя субъекта сертификата должно совпадать с именем личного домена, используемого для кластера.

Чтобы настроить протокол SSL для приложения, сначала необходимо получить SSL-сертификат, подписанный центром сертификации, то есть доверенным сторонним поставщиком, который выдает сертификаты для этой цели. Если у вас еще нет сертификата, нужно получить его в компании, продающей SSL-сертификаты.

Сертификат должен отвечать следующим требованиям для SSL-сертификатов в Azure:
-   Сертификат должен содержать закрытый ключ.
-   Сертификат должен быть создан для обмена ключами, которые можно экспортировать в файл обмена личной информацией (PFX-файл).
-   Имя субъекта сертификата должно совпадать с именем домена, которое используется для обращения к облачной службе. Не удается получить SSL-сертификат от центра сертификации (ЦС) в домене cloudapp.net. Необходимо получить имя пользовательского домена для использования при получении доступа к службе. При запросе сертификата из ЦС имя субъекта сертификата должно соответствовать имени личного домена, который используется для доступа к вашему приложению. Например, если вы используете домен contoso.com, необходимо запросить сертификат из центра сертификации для **.contoso.com** или **www.contoso.com**.
-   Сертификат должен использовать как минимум 2048-разрядное шифрование.

Протокол HTTP — небезопасный и подвержен атакам с перехватом, так как данные передаются с веб-браузера на веб-сервер или между другими конечными точками в виде обычного текста. Это означает, что злоумышленники могут перехватывать и просматривать конфиденциальные данные, такие как сведения о кредитной карте и учетных данных. При отправке или публикации данных с помощью браузера по протоколу HTTPS SSL обеспечивает шифрование таких сведений и их защиту от перехвата.

Дополнительные сведения см. в статье [Настройка SSL для приложения в Azure](https://docs.microsoft.com/azure/cloud-services/cloud-services-configure-ssl-certificate).

## <a name="network-isolationsecurity-with-azure-service-fabric"></a>Обеспечение сетевой изоляции и безопасности с помощью Azure Service Fabric.
Используйте [шаблон Azure Resource Manager (ARM)](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-authoring-templates) как пример для настройки трех безопасных кластеров типа узла и управления входящим и исходящим сетевым трафиком с помощью групп безопасности сети.

Шаблон содержит по одной группе безопасности сети для каждого масштабируемого набора виртуальных машин для управления входящим и исходящим трафиком масштабируемого набора виртуальных машин. По умолчанию правила настраиваются на разрешение всего трафика, необходимого системным службам и приложениям портов, указанным в шаблоне. Просмотрите эти правила и измените их в соответствии со своими потребностями, включая добавление новых правил для приложений.

Дополнительные сведения см. в статье [Схемы сетевых подключений Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-patterns-networking).

## <a name="set-up-a-key-vault-for-security"></a>Настройка хранилища ключей для обеспечения безопасности.
Сертификаты используются в Service Fabric, чтобы обеспечить функции аутентификации и шифрования для защиты различных аспектов кластера и его приложений.

Service Fabric использует сертификаты X.509 для защиты кластера и обеспечения функций безопасности приложений. Key Vault используется для [управления сертификатами](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security-update-certs-azure) кластеров Service Fabric в Azure. При развертывании кластера в Azure поставщик ресурсов Azure, ответственный за создание кластеров Service Fabric, извлекает сертификаты из Key Vault и устанавливает их на виртуальные машины кластера.

Между [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-secure-your-key-vault), кластером Service Fabric и поставщиком ресурсов Azure, который использует сертификаты из Key Vault при создании кластера, устанавливается связь.

**Создание группы ресурсов.** Первый шаг — создание группы ресурсов специально для хранилища ключей. Рекомендуется поместить хранилище ключей в собственной группе ресурсов. Так вы сможете удалять группы ресурсов для вычислений и хранения, включая группу ресурсов, в которой размещен кластер Service Fabric, без потери ключей и секретов. Группа ресурсов с хранилищем ключей должна находиться в том же регионе, что и кластер, который ее использует.

**Создание хранилища ключей в новой группе ресурсов.** Хранилище ключей должно быть доступно для развернутой службы. Это позволит поставщику вычислительных ресурсов получить из него сертификаты и установить их на экземплярах виртуальных машин.
Дополнительные сведения о настройке Azure Key Vault см. в статье [Приступая к работе с хранилищем ключей Azure](https://docs.microsoft.com/azure/key-vault/key-vault-get-started).

## <a name="assign-users-roles"></a>Назначение ролей пользователей
Создав приложения, представляющие кластер, сопоставьте пользователей с ролями, поддерживаемыми Service Fabric и разрешающими доступ на чтение и администрирование. Роли можно назначить с помощью классического портала Azure.

>[!Note]
> Дополнительные сведения о ролях в Service Fabric см. в статье [Контроль доступа на основе ролей для клиентов Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security-roles).

Платформа Azure Service Fabric поддерживает два разных типа контроля доступа для клиентов, подключенных к [кластеру Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm): администраторский и пользовательский. Благодаря контролю доступа администратор кластера может ограничить доступ разных групп пользователей на выполнение определенных операций в кластере, повысив тем самым уровень безопасности кластера.

## <a name="next-steps"></a>Дальнейшие действия
- Настройка [среды разработки](https://docs.microsoft.com/azure/service-fabric/service-fabric-get-started).
- Узнайте о [вариантах поддержки Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-support).


