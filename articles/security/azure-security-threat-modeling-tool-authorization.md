---
title: Авторизация. Средство моделирования угроз Microsoft Azure | Документация Майкрософт
description: Устранение угроз, обнаруженных с помощью средства моделирования угроз
services: security
documentationcenter: na
author: RodSan
manager: RodSan
editor: RodSan
ms.assetid: na
ms.service: security
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: rodsan
ms.openlocfilehash: b9ad3ceeb77a4adc2c47b262aa40a48c14423198
ms.sourcegitcommit: 9890483687a2b28860ec179f5fd0a292cdf11d22
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
# <a name="security-frame-authorization--mitigations"></a>Механизм безопасности. Авторизация | Устранение рисков 
| Продукт или служба | Статья |
| --------------- | ------- |
| **Граница доверия между компьютерами** | <ul><li>[Соответствующим образом настройте списки ACL для предотвращения несанкционированного доступа к данным на устройстве](#acl-restricted-access)</li><li>[Конфиденциальное пользовательское содержимое приложения должно храниться в каталоге профиля пользователя](#sensitive-directory)</li><li>[Развернутые приложения следует запускать с минимальным числом привилегий](#deployed-privileges)</li></ul> |
| **Веб-приложение** | <ul><li>[Обеспечьте последовательный порядок обработки потоков бизнес-логики](#sequential-logic)</li><li>[Реализуйте ограничение частоты транзакций, чтобы предотвратить перечисление](#rate-enumeration)</li><li>[Обеспечьте применение соответствующего типа авторизации и соблюдение принципа наименьших необходимых привилегий](#principle-least-privilege)</li><li>[Бизнес-логика и принятие решений об авторизации доступа к ресурсам не должны основываться на параметрах входящего запроса](#logic-request-parameters)</li><li>[Убедитесь, что содержимое и ресурсы не могут быть перечислены или доступны путем несанкционированного просмотра](#enumerable-browsing)</li></ul> |
| **База данных** | <ul><li>[Убедитесь, что для подключения к серверу базы данных используются учетные записи с минимальными привилегиями доступа](#privileged-server)</li><li>[Реализуйте безопасность на уровне строк (RLS), чтобы запретить клиентам доступ к данным друг друга](#rls-tenants)</li><li>[Роль системного администратора должна быть только у необходимых действительных пользователей](#sysadmin-users)</li></ul> |
| **Облачный шлюз Интернета вещей** | <ul><li>[Подключайтесь к облачному шлюзу с помощью маркеров с минимальными привилегиями доступа](#cloud-least-privileged)</li></ul> |
| **Концентратор событий Azure** | <ul><li>[Для создания маркеров устройства используйте ключ SAS с разрешениями только для отправки](#sendonly-sas)</li><li>[Не используйте маркеры доступа, которые предоставляют прямой доступ к концентратору событий](#access-tokens-hub)</li><li>[Подключайтесь к концентратору событий, используя ключи SAS с минимальными необходимыми разрешениями](#sas-minimum-permissions)</li></ul> |
| **Azure DocumentDB** | <ul><li>[Использование маркеров ресурса (по возможности) для подключения к Cosmos DB](#resource-docdb)</li></ul> |
| **Граница доверия Azure** | <ul><li>[Обеспечьте детальное управление доступом к подписке Azure с помощью RBAC](#grained-rbac)</li></ul> |
| **Граница доверия Service Fabric** | <ul><li>[С помощью RBAC ограничьте доступ клиента к операциям кластера](#cluster-rbac)</li></ul> |
| **Dynamics CRM** | <ul><li>[Выполняйте моделирование безопасности, при необходимости применяя безопасность на уровне полей](#modeling-field)</li></ul> |
| **Портал Dynamics CRM** | <ul><li>[Выполняйте моделирование безопасности учетных записей на портале с учетом отличия модели безопасности для портала от модели безопасности для CRM](#portal-security)</li></ul> |
| **Хранилище Azure** | <ul><li>[Предоставьте детальное разрешение диапазону сущностей в хранилище таблиц Azure](#permission-entities)</li><li>[С помощью Azure Resource Manager включите для учетной записи хранения Azure управление доступом на основе ролей (RBAC)](#rbac-azure-manager)</li></ul> |
| **Мобильный клиент** | <ul><li>[Реализуйте неявное обнаружение снятия защиты или получение административного доступа](#rooting-detection)</li></ul> |
| **WCF** | <ul><li>[Слабый механизм ссылки на класс в WCF](#weak-class-wcf)</li><li>[Реализуйте контроль авторизации WCF](#wcf-authz)</li></ul> |
| **Веб-интерфейс API** | <ul><li>[Реализуйте соответствующий механизм авторизации в веб-API ASP.NET](#authz-aspnet)</li></ul> |
| **Устройство IoT** | <ul><li>[Выполняйте проверки авторизации на устройстве, если оно поддерживает действия, для которых требуются разрешения различных уровней](#device-permission)</li></ul> |
| **Полевой шлюз Интернета вещей** | <ul><li>[Выполняйте проверки авторизации в полевом шлюзе, если он поддерживает действия, для которых требуются разрешения различных уровней](#field-permission)</li></ul> |

## <a id="acl-restricted-access"></a>Соответствующим образом настройте списки ACL для предотвращения несанкционированного доступа к данным на устройстве

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Отношения доверия между компьютерами | 
| **Этап SDL**               | Развертывание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | Соответствующим образом настройте списки ACL для предотвращения несанкционированного доступа к данным на устройстве|

## <a id="sensitive-directory"></a>Конфиденциальное пользовательское содержимое приложения должно храниться в каталоге профиля пользователя

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Отношения доверия между компьютерами | 
| **Этап SDL**               | Развертывание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | Убедитесь, что важное содержимое приложения хранится в каталоге профиля пользователя. Это гарантирует, что пользователи одного компьютера не смогут получить доступ к данным друг друга.|

## <a id="deployed-privileges"></a>Развернутые приложения следует запускать с минимальным числом привилегий

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Отношения доверия между компьютерами | 
| **Этап SDL**               | Развертывание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | Убедитесь, что развернутые приложения выполняются с минимальным числом привилегий. |

## <a id="sequential-logic"></a>Обеспечьте последовательный порядок обработки потоков бизнес-логики

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-приложение | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | Чтобы убедиться, что этот этап был запущен подлинным пользователем, необходимо, чтобы приложение обрабатывало потоки бизнес-логики только в последовательном порядке с реальной для человека скоростью. При этом потоки не должны обрабатываться: не по порядку, с пропуском шагов, вместе с запросами других пользователей, со слишком быстро отправляемыми транзакциями.|

## <a id="rate-enumeration"></a>Реализуйте ограничение частоты транзакций, чтобы предотвратить перечисление

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-приложение | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | Убедитесь, что конфиденциальные идентификаторы являются случайными. Реализуйте элемент управления CAPTCHA для анонимных страниц. Убедитесь, что ошибки и исключения не раскрывают определенные данные.|

## <a id="principle-least-privilege"></a>Обеспечьте применение соответствующего типа авторизации и соблюдение принципа наименьших необходимых привилегий

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-приложение | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | <p>Этот принцип означает предоставление учетной записи пользователя только тех привилегий, которые необходимы ему для работы. Например, пользователю резервного копирования не требуется устанавливать программное обеспечение. Такой пользователь имеет права только на запуск резервного копирования и связанных с ним приложений. Другие привилегии, такие как установка нового программного обеспечения, блокируются. Этот принцип также применяется к пользователю персонального компьютера, который зачастую работает в обычной учетной записи и открывает привилегированную защищенную паролем учетную запись (то есть учетную запись суперпользователя) только в крайнем случае. </p><p>Этот принцип применим и к веб-приложениям. Вместо использования только методов проверки подлинности на основе ролей в сеансах пользователям необходимо назначать привилегии с помощью системы проверки подлинности на основе баз данных. Используйте сеансы, чтобы убедиться, что пользователь правильно выполнил вход, но вместо назначения пользователю определенной роли назначьте ему привилегии, определяющие, какие действия он имеет право выполнять в системе. Большой плюс этого метода в том, что когда пользователю необходимо назначить меньше привилегий, изменения применяются в режиме реального времени, так как назначение не зависит от сеанса, который иначе пришлось бы сначала завершить.</p>|

## <a id="logic-request-parameters"></a>Бизнес-логика и принятие решений об авторизации доступа к ресурсам не должны основываться на параметрах входящего запроса

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-приложение | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | Каждый раз при проверке ограничений пользователя на просмотр определенных данных ограничения доступа должны обрабатываться на стороне сервера. Идентификатор пользователя должен храниться в переменной сеанса при входе в систему и использоваться для получения пользовательских данных из базы данных. |

### <a name="example"></a>Пример
```SQL
SELECT data 
FROM personaldata 
WHERE userID=:id < - session var 
```
Теперь злоумышленник не сможет исказить и изменить работу приложения, так как идентификатор для получения данных обрабатывается на стороне сервера.

## <a id="enumerable-browsing"></a>Убедитесь, что содержимое и ресурсы не могут быть перечислены или доступны путем несанкционированного просмотра

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-приложение | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | <p>Конфиденциальные статические файлы и файлы конфигурации не должны храниться в корневом каталоге. Для содержимого, которое должно быть закрытым, необходимо либо применить соответствующие параметры управления доступом, либо удалить само содержимое.</p><p>Несанкционированный просмотр обычно сопровождается атакой методом подбора, чтобы получить доступ к максимальному количеству URL-адресов и выполнить перечисление хранящихся на сервере каталогов и файлов. Злоумышленники могут проверять все виды широко распространенных файлов. Например, поиск файла пароля будет охватывать такие файлы, как psswd.txt, password.htm, password.dat и другие.</p><p>Чтобы избежать этого, необходимо включить возможность обнаруживать попытки атак методом подбора.</p>|

## <a id="privileged-server"></a>Убедитесь, что для подключения к серверу базы данных используются учетные записи с минимальными привилегиями доступа

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | База данных | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | [Иерархия разрешений (компонент Database Engine)](https://msdn.microsoft.com/library/ms191465), [Защищаемые объекты](https://msdn.microsoft.com/library/ms190401) |
| **Действия** | Для подключения к базе данных следует использовать учетные записи с минимальными привилегиями доступа. Имя для входа в приложение должно иметь возможность выполнять в базе данных только выбранные хранимые процедуры. Также оно не должно иметь прямого доступа к таблицам. |

## <a id="rls-tenants"></a>Реализуйте безопасность на уровне строк (RLS), чтобы запретить клиентам доступ к данным друг друга

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | База данных | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | SQL Azure, локальные |
| **Атрибуты**              | Версия SQL: 12, MsSQL2016 |
| **Справочные материалы**              | [Безопасность на уровне строк](https://msdn.microsoft.com/library/azure/dn765131.aspx) |
| **Действия** | <p>Безопасность на уровне строк позволяет пользователям управлять доступом к строкам в таблице базы данных в зависимости от характеристик пользователя, выполняющего запрос (например, членство в группе или контекст выполнения).</p><p>Безопасность на уровне строк (RLS) упрощает проектирование и программирование безопасности в приложении. RLS позволяет реализовать ограничения доступа к строкам данных. Обеспечьте сотрудникам доступ только к тем строкам данных, которые имеют отношение к их отделу, или только к тем данным клиента, которые относятся к их компании.</p><p>Логика ограничения доступа находится на уровне базы данных, а не на другом уровне приложения отдельно от данных. Система базы данных применяет ограничения доступа при каждой попытке получения доступа к данным независимо от уровня. Это делает систему безопасности более надежной и устойчивой за счет уменьшения ее контактной зоны.</p><p>|

Обратите внимание, что RLS, как готовая функция базы данных, применима только к SQL Server (начиная с версии 2016) и базе данных SQL Azure. Если готовая функция RLS не реализована, необходимо ограничить доступ к данным с помощью представлений и процедур.

## <a id="sysadmin-users"></a>Роль системного администратора должна быть только у необходимых действительных пользователей

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | База данных | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | [Иерархия разрешений (компонент Database Engine)](https://msdn.microsoft.com/library/ms191465), [Защищаемые объекты](https://msdn.microsoft.com/library/ms190401) |
| **Действия** | Участники фиксированной роли сервера системного администратора должны быть ограничены и не должны содержать учетные записи, используемые приложениями.  Просмотрите список пользователей в роли и удалите все ненужные учетные записи.|

## <a id="cloud-least-privileged"></a>Подключайтесь к облачному шлюзу с помощью маркеров с минимальными привилегиями доступа

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Облачный шлюз Интернета вещей | 
| **Этап SDL**               | Развертывание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Выбор шлюза: Центр Интернета вещей Azure |
| **Справочные материалы**              | [Руководство разработчика по Центру Интернета вещей Azure](https://azure.microsoft.com/documentation/articles/iot-hub-devguide/#Security) |
| **Действия** | Предоставьте разрешения с минимальными привилегиями компонентам, подключающимся к облачному шлюзу Центра Интернета вещей. Например, компоненту управления и подготовки устройств нужны разрешения на чтение и запись в реестр, а обработчику событий (ASA) разрешения на подключение службы. Отдельные устройства подключаются с помощью учетных данных.|

## <a id="sendonly-sas"></a>Для создания маркеров устройства используйте ключ SAS с разрешениями только для отправки

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | концентратору событий Azure | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | [Обзор проверки подлинности концентраторов событий и модели безопасности](https://azure.microsoft.com/documentation/articles/event-hubs-authentication-and-security-model-overview/) |
| **Действия** | Ключ SAS используется для создания маркеров отдельных устройств. Для создания маркеров устройств нужного издателя используйте ключ SAS с разрешениями только на отправку.|

## <a id="access-tokens-hub"></a>Не используйте маркеры доступа, которые предоставляют прямой доступ к концентратору событий

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | концентратору событий Azure | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | [Обзор проверки подлинности концентраторов событий и модели безопасности](https://azure.microsoft.com/documentation/articles/event-hubs-authentication-and-security-model-overview/) |
| **Действия** | Маркер, который предоставляет прямой доступ к концентратору событий, не должен предоставляться устройству. С помощью маркера с минимальными правами, который предоставляет доступ только издателю, можно определить несанкционированное или скомпрометированное устройство и поместить его в список блокировок.|

## <a id="sas-minimum-permissions"></a>Подключайтесь к концентратору событий, используя ключи SAS с минимальными необходимыми разрешениями

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | концентратору событий Azure | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | [Обзор проверки подлинности концентраторов событий и модели безопасности](https://azure.microsoft.com/documentation/articles/event-hubs-authentication-and-security-model-overview/) |
| **Действия** | Серверным приложениям, которые подключаются к концентратору событий, следует предоставлять разрешения с минимальными привилегиями. Создавайте отдельные ключи SAS для каждого серверного приложения и предоставляйте им только необходимые разрешения — на отправку, получение или управление.|

## <a id="resource-docdb"></a>Использование маркеров ресурса (по возможности) для подключения к Cosmos DB

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Azure DocumentDB | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | Маркер ресурса связан с разрешением Azure Cosmos DB и отражает отношение между пользователем базы данных и разрешением этого пользователя к конкретному ресурсу приложения Azure Cosmos DB (например, коллекции, документу). Всегда используйте маркер ресурса для доступа к Azure Cosmos DB, если клиенту (приложению пользователя, например клиенту мобильного или настольного приложения) невозможно доверить обработку главных ключей или ключей только для чтения. Используйте главный ключ или ключи только для чтения серверных приложений, которые могут хранить их безопасно.|

## <a id="grained-rbac"></a>Обеспечьте детальное управление доступом к подписке Azure с помощью RBAC

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Граница доверия Azure | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | [Использование назначений ролей для управления доступом к ресурсам в подписке Azure](https://azure.microsoft.com/documentation/articles/role-based-access-control-configure/)  |
| **Действия** | Контроль доступа на основе ролей (RBAC) Azure обеспечивает точное управление доступом для Azure. С помощью RBAC можно предоставлять пользователям доступ, необходимый только для выполнения поставленных перед ними задач.|

## <a id="cluster-rbac"></a>С помощью RBAC ограничьте доступ клиента к операциям кластера

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Граница доверия Service Fabric | 
| **Этап SDL**               | Развертывание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Среда: Azure |
| **Справочные материалы**              | [Контроль доступа на основе ролей для клиентов Service Fabric](https://azure.microsoft.com/documentation/articles/service-fabric-cluster-security-roles/) |
| **Действия** | <p>Платформа Azure Service Fabric поддерживает два разных типа контроля доступа для клиентов, подключенных к кластеру Service Fabric: администраторский и пользовательский. Благодаря контролю доступа администратор кластера может ограничить доступ разных групп пользователей на выполнение определенных операций в кластере, повысив тем самым уровень безопасности кластера.</p><p>Администраторы имеют полный доступ к возможностям управления (включая возможности чтения и записи). Пользователи по умолчанию имеют доступ только на чтение для управления (например, при работе с запросами) и возможность разрешения приложений и служб.</p><p>Во время создания кластера задаются две клиентские роли (администратора или клиента) путем предоставления отдельных сертификатов для каждой из них.</p>|

## <a id="modeling-field"></a>Выполняйте моделирование безопасности, при необходимости применяя безопасность на уровне полей

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Dynamics CRM | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | Выполняйте моделирование безопасности, при необходимости применяя безопасность на уровне полей|

## <a id="portal-security"></a>Выполняйте моделирование безопасности учетных записей на портале с учетом отличия модели безопасности для портала от модели безопасности для CRM

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Портал Dynamics CRM | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | Выполняйте моделирование безопасности учетных записей на портале с учетом отличия модели безопасности для портала от модели безопасности для CRM|

## <a id="permission-entities"></a>Предоставьте детальное разрешение диапазону сущностей в хранилище таблиц Azure

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Хранилище Azure | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Тип хранилища: таблица |
| **Справочные материалы**              | [Руководство по безопасности службы хранилища Azure. Делегирование доступа к объектам в учетной записи с помощью подписанных URL-адресов и хранимых политик доступа](https://azure.microsoft.com/documentation/articles/storage-security-guide/#_data-plane-security) |
| **Действия** | В некоторых бизнес-сценариях для хранения конфиденциальных данных, предназначенных для различных сторон, может потребоваться хранилище таблиц Azure. Это могут быть конфиденциальные данные, относящиеся к разным странам. В таких случаях подписи SAS можно создать, указав диапазоны ключей разделов и строк таким образом, чтобы пользователь мог обращаться к данным, относящимся к определенной стране.| 

## <a id="rbac-azure-manager"></a>С помощью Azure Resource Manager включите для учетной записи хранения Azure управление доступом на основе ролей (RBAC)

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Хранилище Azure | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | [Защита учетной записи хранения с помощью управления доступом на основе ролей (RBAC)](https://azure.microsoft.com/documentation/articles/storage-security-guide/#management-plane-security) |
| **Действия** | <p>При создании учетной записи хранения необходимо выбрать модель развертывания: классическую или на основе Azure Resource Manager. Классическая модель создания ресурсов в Azure обеспечивает доступ к подписке, а, следовательно, и к учетной записи хранения, только по принципу "все или ничего".</p><p>При применении модели на основе Azure Resource Manager учетная запись хранения помещается в группу ресурсов, а доступ к ее плоскости управления контролируется с помощью Azure Active Directory. Например, вы можете предоставить определенным пользователям доступ к ключам учетной записи хранения, а другим — запретить такой доступ, но разрешить просматривать информацию об учетной записи.</p>|

## <a id="rooting-detection"></a>Реализуйте неявное обнаружение снятия защиты или получение административного доступа

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Мобильный клиент | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | <p>Приложение должно обеспечить защиту собственной конфигурации и данных пользователя в случае, если обнаружено, что на телефоне снята защита или к нему получен административный доступ. Такие случаи подразумевают, что злоумышленник имеет несанкционированный доступ к телефону. Поэтому при запуске приложения должна выполняться логика неявного обнаружения, позволяющая обнаружить получение административного доступа.</p><p>Логика обнаружения может легко обращаться к файлам, доступ к которым обычно имеет только привилегированный пользователь, например:</p><ul><li>/system/app/Superuser.apk;</li><li>/sbin/su;</li><li>/system/bin/su;</li><li>/system/xbin/su;</li><li>/data/local/xbin/su;</li><li>/data/local/bin/su;</li><li>/system/sd/xbin/su;</li><li>/system/bin/failsafe/su;</li><li>/data/local/su.</li></ul><p>Если приложение может получить доступ к любому из этих файлов, это означает, что оно выполняется с привилегированного пользователя.</p>|

## <a id="weak-class-wcf"></a>Слабый механизм ссылки на класс в WCF

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | WCF | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальные, .NET Framework 3 |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | [MSDN](https://msdn.microsoft.com/library/ff648500.aspx), [Fortify Kingdom](https://vulncat.fortify.com/en/vulncat/index.html) |
| **Действия** | <p>Система использует слабый механизм ссылки на класс, который может позволить злоумышленнику выполнить несанкционированный код. Программа ссылается на пользовательский класс, который идентифицируется неоднозначно. Когда .NET загружает этот слабо идентифицируемый класс, загрузчик среды типа CLR ищет класс в следующих местоположениях в указанном порядке:</p><ol><li>Если сборка типа известна, загрузчик выполняет поиск в расположениях перенаправления файла конфигурации, в глобальном кэше сборок, в текущей сборке с помощью сведений о конфигурации и в базовом каталоге приложения.</li><li>Если сборка неизвестна, загрузчик ищет в текущей сборке, в файле mscorlib и в месте, возвращаемом обработчиком событий TypeResolve.</li><li>Можно изменить порядок поиска среды CLR с помощью таких обработчиков, как механизм пересылки типа и событие AppDomain.TypeResolve.</li></ol><p>Если злоумышленник использует порядок поиска среды CLR, создав альтернативный класс с тем же именем и поместив его в альтернативное расположение, которое среда CLR загрузит сначала, среда CLR непреднамеренно выполнит предоставленный злоумышленником код.</p>|

### <a name="example"></a>Пример
Элемент `<behaviorExtensions/>` расположенного ниже файла конфигурации WCF указывает WCF добавить настраиваемый класс поведения в определенное расширение WCF.
```
<system.serviceModel>
    <extensions>
        <behaviorExtensions>
            <add name=""myBehavior"" type=""MyBehavior"" />
        </behaviorExtensions>
    </extensions>
</system.serviceModel>
```
Использование полных (надежных) имен однозначно определяет тип и повышает безопасность системы. Используйте полные имена сборок при регистрации типов в файлах machine.config и app.config.

### <a name="example"></a>Пример
Элемент `<behaviorExtensions/>` расположенного ниже файла конфигурации WCF указывает WCF добавить настраиваемый класс поведения с надежным механизмом ссылки в определенное расширение WCF.
```
<system.serviceModel>
    <extensions>
        <behaviorExtensions>
            <add name=""myBehavior"" type=""Microsoft.ServiceModel.Samples.MyBehaviorSection, MyBehavior,
            Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"" />
        </behaviorExtensions>
    </extensions>
</system.serviceModel>
```

## <a id="wcf-authz"></a>Реализуйте контроль авторизации WCF

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | WCF | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальные, .NET Framework 3 |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | [MSDN](https://msdn.microsoft.com/library/ff648500.aspx), [Fortify Kingdom](https://vulncat.fortify.com/en/vulncat/index.html) |
| **Действия** | <p>Эта служба не использует контроль авторизации. Когда клиент вызывает определенную службу WCF, WCF предоставляет различные схемы авторизации, которые проверяют, имеет ли вызывающий объект разрешение на выполнение метода обслуживания на сервере. Если элементы контроля авторизации не включены для служб WCF, прошедший проверку подлинности пользователь может добиться расширения привилегий.</p>|

### <a name="example"></a>Пример
Следующая конфигурация указывает WCF не проверять уровень авторизации клиента при выполнении службы:
```
<behaviors>
    <serviceBehaviors>
        <behavior>
            ...
            <serviceAuthorization principalPermissionMode=""None"" />
        </behavior>
    </serviceBehaviors>
</behaviors>
```
Используйте схему авторизации службы, чтобы убедиться, что объект, вызывающий метод службы, авторизован выполнять это действие. WCF работает в двух режимах и позволяет определить настраиваемую схему авторизации. Для проверки подлинности в режиме UseWindowsGroups используются роли и пользователи Windows, а в режиме UseAspNetRoles используется поставщик ролей ASP.NET, например SQL Server.

### <a name="example"></a>Пример
Следующая конфигурация указывает WCF перед добавлением службы проверять, входит ли клиент в группу администраторов:
```
<behaviors>
    <serviceBehaviors>
        <behavior>
            ...
            <serviceAuthorization principalPermissionMode=""UseWindowsGroups"" />
        </behavior>
    </serviceBehaviors>
</behaviors>
```
Затем служба объявляется следующим образом:
```
[PrincipalPermission(SecurityAction.Demand,
Role = ""Builtin\\Administrators"")]
public double Add(double n1, double n2)
{
double result = n1 + n2;
return result;
}
```

## <a id="authz-aspnet"></a>Реализуйте соответствующий механизм авторизации в веб-API ASP.NET

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-интерфейс API | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальные, MVC 5 |
| **Атрибуты**              | Н/Д, поставщик удостоверений — ADFS или Azure AD |
| **Справочные материалы**              | [Проверка подлинности и авторизация в веб-API ASP.NET](http://www.asp.net/web-api/overview/security/authentication-and-authorization-in-aspnet-web-api) |
| **Действия** | <p>Сведения о роли для пользователей приложения можно получить из утверждений Azure AD или ADFS, если приложение использует эти службы в качестве поставщика удостоверений. Их также может предоставлять само приложение. В каждом из этих случаев реализация настраиваемой авторизации должна проверять сведения о роли пользователя.</p><p>Сведения о роли для пользователей приложения можно получить из утверждений Azure AD или ADFS, если приложение использует эти службы в качестве поставщика удостоверений. Их также может предоставлять само приложение. В каждом из этих случаев реализация настраиваемой авторизации должна проверять сведения о роли пользователя.</p>

### <a name="example"></a>Пример
```csharp
[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, Inherited = true, AllowMultiple = true)]
public class ApiAuthorizeAttribute : System.Web.Http.AuthorizeAttribute
{
        public async override Task OnAuthorizationAsync(HttpActionContext actionContext, CancellationToken cancellationToken)
        {
            if (actionContext == null)
            {
                throw new Exception();
            }

            if (!string.IsNullOrEmpty(base.Roles))
            {
                bool isAuthorized = ValidateRoles(actionContext);
                if (!isAuthorized)
                {
                    HandleUnauthorizedRequest(actionContext);
                }
            }

            base.OnAuthorization(actionContext);
        }

public bool ValidateRoles(actionContext)
{
   //Authorization logic here; returns true or false
}

}
```
Для всех контроллеров и методов действий, которым требуется защита, необходимо добавить указанный выше атрибут.
```csharp
[ApiAuthorize]
public class CustomController : ApiController
{
     //Application code goes here
}
```

## <a id="device-permission"></a>Выполняйте проверки авторизации на устройстве, если оно поддерживает действия, для которых требуются разрешения различных уровней

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Устройства Интернета вещей | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | <p>Устройство должно авторизовать вызывающий объект, чтобы проверить, имеет ли он необходимые разрешения на выполнение запрашиваемого действия. Например, устройство является умным дверным замком, отслеживаемым из облака, которое предоставляет возможность удаленной блокировки двери.</p><p>Этот замок позволит выполнить разблокировку, только если кто-то с картой физически находится рядом с дверью. В таком случае управление и удаленные команды необходимо реализовать таким образом, чтобы не предоставлять функциональные возможности для разблокирования двери, когда облачный шлюз не авторизован отправлять соответствующую команду.</p>|

## <a id="field-permission"></a>Выполняйте проверки авторизации в полевом шлюзе, если он поддерживает действия, для которых требуются разрешения различных уровней

| Название                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Полевой шлюз Интернета вещей | 
| **Этап SDL**               | Создание |  
| **Применимые технологии** | Универсальный |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Действия** | Полевой шлюз должен авторизовать вызывающий объект, чтобы проверить, имеет ли он необходимые разрешения на выполнение запрашиваемого действия. Например, у него должны быть разные разрешения для API пользователя с правами администратора, который используется для настройки полевого шлюза и подключенных к нему устройств.|
