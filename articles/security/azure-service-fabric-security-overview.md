---
title: Общие сведения о безопасности Azure Service Fabric | Документация Майкрософт
description: Эта статья содержит общие сведения о безопасности Azure Service Fabric.
services: security
documentationcenter: na
author: unifycloud
manager: mbaldwin
editor: tomsh
ms.assetid: ''
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/04/2017
ms.author: tomsh
ms.openlocfilehash: 19e4e55c4bd63e5d7a9ef6ea3b0bf6ae63f929d5
ms.sourcegitcommit: 870d372785ffa8ca46346f4dfe215f245931dae1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/08/2018
ms.locfileid: "33895669"
---
# <a name="azure-service-fabric-security-overview"></a>Общие сведения о безопасности Azure Service Fabric
[Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview) — это платформа распределенных систем, которая дает возможность не только легко упаковывать и развертывать масштабируемые и надежные микрослужбы, но и управлять ими. Service Fabric позволяет разрешить значительные трудности, возникающие при разработке облачных приложений и управлении ими. Получая гарантированную масштабируемость, надежность и управляемость, разработчики и администраторы могут сосредоточиться на реализации критически важных и ресурсоемких рабочих нагрузок вместо того, чтобы тратить силы на решение сложных проблем с инфраструктурой.

В этом обзоре безопасности Azure Service Fabric рассматриваются следующие области:

-   Защита кластера
-   Основные сведения о мониторинге и диагностике.
-   Создание более безопасных сред с помощью сертификатов.
-   Использование управления доступом на основе ролей (RBAC).
-   Защита кластеров с помощью средств безопасности Windows.
-   Настройка безопасности приложений в Service Fabric.
-   Защита взаимодействия служб в Azure Service Fabric. 

## <a name="secure-your-cluster"></a>Обеспечение безопасности кластера
Azure Service Fabric оркестрирует службы в кластере виртуальных машин. Кластеры должны быть защищены, чтобы неавторизованные пользователи не могли подключиться к ним, особенно если на кластере выполняются рабочие нагрузки в рабочей среде. Существует возможность создания незащищенного кластера, что позволит анонимным пользователям подключаться к нему (если конечные точки управления кластером общедоступны через Интернет).

Этот раздел предоставляет общие сведения о сценариях безопасности для кластеров, запущенных автономно или в Azure. В нем также описаны различные технологии, используемые для реализации этих сценариев. Сценарии обеспечения безопасности кластера:

-   безопасность обмена данными между узлами;
-   безопасность обмена данными между клиентами и узлами;

### <a name="node-to-node-security"></a>безопасность обмена данными между узлами;
Когда обмен данными между узлами защищен, обеспечивается безопасность взаимодействия между виртуальными машинами и компьютерами в кластере. Такая защита гарантирует, что размещать приложения и службы в кластере смогут владельцы только тех компьютеров, которые прошли авторизацию для подключения к кластеру.

Кластеры, работающие в Azure, или автономные кластеры, работающие под управлением Windows, могут использовать [безопасность на основе сертификатов](https://msdn.microsoft.com/library/ff649801.aspx) или [безопасность Windows](https://msdn.microsoft.com/library/ff649396.aspx) для компьютеров Windows Server.

**Основные сведения о безопасности обмена данными между узлами на основе сертификатов**

Azure Service Fabric использует сертификаты сервера X.509, указанные при создании кластера. Краткий обзор этих сертификатов и способа их получения или создания приведен в статье [Working with Certificates](https://docs.microsoft.com/dotnet/framework/wcf/feature-details/working-with-certificates) (Работа с сертификатами).

При создании кластера безопасность на основе сертификатов можно настроить с помощью портала Azure, шаблона диспетчера Azure Resource Manager или автономного шаблона JSON. Вы можете указать основной сертификат и необязательный дополнительный сертификат, который будет использоваться для смены сертификатов. Эти сертификаты должны отличаться от сертификатов клиента администрирования и клиента только для чтения, указанных для [безопасности обмена данными между клиентами и узлами](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security).

### <a name="client-to-node-security"></a>безопасность обмена данными между клиентами и узлами;
Безопасность обмена данными между клиентом и узлом настраивается с помощью удостоверений клиента. Чтобы установить отношения доверия между клиентом и кластером, необходимо настроить кластер таким образом, чтобы ему были известны удостоверения клиентов, которым можно доверять. Это можно сделать двумя способами:

-   указать пользователей группы домена, которые могут подключаться; 
-   указать пользователей узла домена, которые могут подключаться.

Service Fabric поддерживает два разных типа контроля доступа для клиентов, подключенных к кластеру Service Fabric:

-   Администратор
-   Пользователь

С помощью управления доступом администраторы кластера могут ограничить доступ к определенным типам операций кластера. Это дает возможность обеспечить более надежную защиту кластера.

 Администраторы имеют полный доступ к возможностям управления (включая возможности чтения и записи). Пользователи по умолчанию имеют доступ только на чтение для управления (например, при работе с запросами) и возможность разрешения приложений и служб.

**Основные сведения о безопасности обмена данными между клиентами и узлами на основе сертификатов**

При создании кластера безопасность обмена данными между клиентами и узлами на основе сертификатов можно настроить с помощью портала Azure, шаблонов Azure Resource Manager или автономного шаблона JSON. Необходимо указать сертификат клиента администратора и/или пользователя. 

Эти сертификаты должны отличаться от основного и дополнительного сертификатов, указанных для защиты обмена данными между узлами.

Клиенты, подключающиеся к кластеру с помощью сертификата администрирования, получают полный доступ к возможностям управления. Клиенты, подключающиеся к кластеру с помощью сертификата клиента только для чтения, получают доступ только для чтения к возможностям управления. Другими словами, эти сертификаты используются для RBAC.

Чтобы узнать, как настроить безопасность на основе сертификатов в кластере, см. статью [Создание кластера Service Fabric в Azure с помощью Azure Resource Manager](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm).

**Основные сведения о безопасности обмена данными между клиентами и узлами Azure Active Directory в Azure**

Для защиты доступа к конечным точкам управления кластеры под управлением Azure также могут использовать Azure Active Directory (AAD). Сведения о том, как создать необходимые артефакты Azure Active Directory (AAD), как их заполнить при создании кластера и как подключиться к этим кластерам, см. в статье [Создание кластера Service Fabric в Azure с помощью Azure Resource Manager](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm).

Azure AD позволяет организациям (известным как клиенты) управлять доступом пользователей к приложениям. Есть приложения с пользовательским интерфейсом входа в систему и те, в которых вход выполняется с помощью собственного клиентского приложения.

Кластеры Service Fabric предлагают несколько точек входа для управления функциями кластеров, включая веб-интерфейс Service Fabric Explorer и Visual Studio. В итоге вы получаете два приложения Azure AD для управления доступом к кластеру: одно веб-приложение и одно собственное приложение.

Чтобы обеспечить безопасность обмена данными между узлами в кластерах Azure, мы рекомендуем использовать безопасность AAD для проверки подлинности клиентов и сертификатов.

Если в рамках автономных кластеров Windows Server используется Windows Server 2012 R2 и Active Directory, мы рекомендуем применять безопасность Windows к управляемым группой учетным записям.  В противном случае используйте безопасность Windows с учетными записями Windows.

## <a name="understand-monitoring-and-diagnostics-in-azure-service-fabric"></a>Основные сведения о мониторинге и диагностике в Azure Service Fabric
[Мониторинг и диагностика](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-overview) крайне важны для разработки, тестирования и развертывания приложений и служб в любой среде. Оптимальная работа решений Service Fabric зависит от эффективного планирования, реализации мониторинга и диагностики, что помогает обеспечить ожидаемую работу приложений и служб в локальной среде разработки или в производственной среде.

С точки зрения безопасности основные цели мониторинга и диагностики заключаются в следующем:

-   Обнаружение и диагностика неполадок оборудования и инфраструктуры, вызванных событиями безопасности.
-   Выявление проблем с программным обеспечением и приложениями, благодаря которым можно определить индикатор компрометации.
-   Оценка потребления ресурсов для предотвращения непреднамеренного отказа в обслуживании.

Общий рабочий процесс мониторинга и диагностики состоит из трех этапов.

-   **Создание событий.** Сюда входят события (журналы, трассировки, пользовательские события) на уровне инфраструктуры (кластера) и приложения/службы. Ознакомьтесь с дополнительными сведениями о [событиях уровня инфраструктуры](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-generation-infra) и [событиях уровня приложений](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-generation-app), чтобы понять, какое инструментирование уже предоставлено, а какое можно добавить дополнительно.

-   **Агрегирование событий.** Создаваемые события должны быть собраны и агрегированы, прежде чем они могут быть отображены. Как правило, мы рекомендуем использовать [систему диагностики Azure](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-aggregation-wad) (похожа на коллекцию журналов на основе агентов) или [EventFlow](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow) (внутрипроцессная коллекция журналов).

-   **Анализ.** События должны быть представленными и доступными в определенном формате, обеспечивающем возможность анализа и отображения. Существует несколько платформ для анализа и визуализации данных мониторинга и диагностики. Мы рекомендуем использовать [Log Analytics](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-analysis-oms) и [Azure Application Insights](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-analysis-appinsights), так как эти инструменты хорошо интегрируются с Service Fabric.

[Мониторинг Azure](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview) дает возможность отслеживать многие ресурсы Azure, из которых состоит кластер Service Fabric.

Устройство наблюдения — это отдельная служба, отслеживающая работоспособность и нагрузку в службах и сообщающая о работоспособности любого элемента в иерархии модели работоспособности. Это устройство позволяет предотвратить ошибки, которые невозможно обнаружить на основе отдельной службы. 

Модули наблюдения также удобны для размещения кода, выполняющего корректирующие действия без участия пользователя (например, очистку файлов журнала в хранилище через определенные интервалы времени). С примером реализации службы устройства наблюдения можно ознакомиться в статье [Azure Service Fabric watchdog sample](https://azure.microsoft.com/resources/samples/service-fabric-watchdog-service/) (Образец устройства наблюдения Azure Service Fabric).

## <a name="understand-how-to-secure-communication-by-using-certificates"></a>Общие сведения о защите взаимодействия с помощью сертификатов
Сертификаты дают возможность защиты взаимодействия между различными узлами автономного кластера Windows. С помощью сертификатов X.509 можно проверить подлинность клиентов, подключающихся к этому кластеру. Таким образом, доступ к кластеру имеют только авторизованные пользователи. При создании кластера мы рекомендуем включить сертификат кластера.

### <a name="x509-certificates-and-service-fabric"></a>Сертификаты X.509 и Service Fabric
Цифровые сертификаты X.509 обычно используются для проверки подлинности клиентов и серверов, а также для шифрования и цифровой подписи сообщений.

В следующей таблице перечислены сертификаты, необходимые для настройки кластера:

|Параметр сведений о сертификате |ОПИСАНИЕ|
|-------------------------------|-----------|
|ClusterCertificate|    Этот сертификат нужен, чтобы защитить связь между узлами кластера. Для обновления можно использовать два разных сертификата — основной и дополнительный.|
|ServerCertificate| Этот сертификат предоставляется клиенту при попытке подключиться к этому кластеру. Для обновления можно использовать два разных сертификата сервера — основной и дополнительный.|
|ClientCertificateThumbprints|  Это набор сертификатов, которые требуется установить на клиентских компьютерах, прошедших проверку подлинности.|
|ClientCertificateCommonNames|  Это обычное название первого сертификата клиента для параметра CertificateCommonName. CertificateIssuerThumbprint — это отпечаток издателя сертификата.|
|ReverseProxyCertificate|   Это необязательный сертификат, который можно указать для защиты [обратного прокси-сервера](https://docs.microsoft.com/azure/service-fabric/service-fabric-reverseproxy).|

Дополнительные сведения о защите сертификатов см. в статье [Защита автономного кластера под управлением Windows с помощью сертификатов X.509](https://docs.microsoft.com/azure/service-fabric/service-fabric-windows-cluster-x509-security).

## <a name="understand-role-based-access-control"></a>Общие сведения об управлении доступом на основе ролей
Благодаря контролю доступа администратор кластера может ограничить доступ определенным группам пользователей к выполнению определенных операций в кластере, повысив тем самым уровень безопасности кластера. Для клиентов, подключающихся к кластеру, поддерживаются два типа управления доступом: 

- роль администратора;
- роль пользователя.

Администраторы имеют полный доступ к возможностям управления (включая возможности чтения и записи). Пользователи по умолчанию имеют доступ только на чтение для управления (например, при работе с запросами) и возможность разрешения приложений и служб.

Роли администратора и клиента задаются во время создания кластера путем предоставления отдельных удостоверений (включая сертификаты) для каждой из них. Дополнительные сведения о параметрах управления доступом по умолчанию и их изменении см. в статье [Контроль доступа на основе ролей для клиентов Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security-roles).

## <a name="secure-standalone-cluster-by-using-windows-security"></a>Защита автономного кластера с помощью системы безопасности Windows
Чтобы предотвратить несанкционированный доступ к кластеру Service Fabric, его необходимо защитить. Безопасность особенно важна при выполнении в кластере производственных рабочих нагрузок. Здесь описывается, как настроить безопасность обмена данными между узлами или между клиентом и узлом с помощью системы безопасности Windows и файла ClusterConfig.JSON.

**Настройка безопасности Windows с помощью групповой управляемой учетной записи службы (gMSA)**

Безопасный обмен данными между узлами можно настроить с помощью параметра [ClustergMSAIdentity](https://docs.microsoft.com/azure/service-fabric/service-fabric-windows-cluster-windows-security), когда Service Fabric необходимо использовать групповую управляемую учетную запись службы. Чтобы создать отношения доверия между узлами, им нужно сообщить друг о друге.

Безопасность обмена данными между клиентом и узлом настраивается с помощью параметра ClientIdentities. Чтобы установить отношения доверия между клиентом и кластером, необходимо настроить кластер таким образом, чтобы он мог распознать удостоверения клиентов, которым можно доверять.

**Настройка безопасности Windows с помощью использования группы компьютеров**

Если вы хотите использовать группу компьютеров в домене Active Directory, настройте безопасный обмен данными между узлами с помощью параметра ClusterIdentity. Дополнительные сведения см. в статье [How to Create a Group in Active Directory](https://msdn.microsoft.com/library/aa545347) (Как создать группу в Active Directory).

Безопасность обмена данными между клиентом и узлом настраивается с помощью параметра ClientIdentities. Чтобы установить отношения доверия между клиентом и кластером, необходимо настроить кластер таким образом, чтобы он мог распознать удостоверения клиентов, которым можно доверять. Установить отношения доверия можно двумя разными способами:

-   указать пользователей группы домена, которые могут подключаться;
-   указать пользователей узла домена, которые могут подключаться.

## <a name="configure-application-security-in-service-fabric"></a>Настройка безопасности приложений в Service Fabric.
### <a name="manage-secrets-in-service-fabric-applications"></a>Управление секретами в приложениях Service Fabric
Этот метод помогает управлять секретами в приложении Service Fabric. Секретом может считаться любая конфиденциальная информации, например строка подключения к хранилищу, пароль или другое значение, которое не должно обрабатываться в виде обычного текста.

В этом подходе для управления ключами и секретами используется [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-whatis). Тем не менее секреты в приложении используются независимо от облачной платформы. Это означает, что приложения могут развертываться в кластер, размещенный в любом месте. Этот поток состоит из четырех основных шагов.

-   Получение сертификата шифрования данных.
-   Установка сертификата на кластер.
-   Шифрование значений секретов при развертывании приложения с помощью сертификата и их включение в файл конфигурации Settings.xml службы.
-   Чтение зашифрованных значений из файла Settings.xml. Для их расшифровки используется тот же сертификат шифрования.

>[!NOTE]
>Дополнительные сведения см. в статье [Управление секретами в приложениях Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-application-secret-management).

### <a name="configure-security-policies-for-your-application"></a>Настройка политик безопасности для приложения
Платформа безопасности Azure Service Fabric помогает защищать приложения, работающие в кластере под разными учетными записями. Кроме того, она помогает защищать ресурсы, используемые приложениями при развертывании с помощью учетных записей, например файлы, каталоги и сертификаты. Таким образом, приложения будут работать безопаснее, даже если они запущены в общей среде.

Для этого нужно выполнить следующие действия:

-   Настройка политики для точки входа установки службы.
-   Запуск команд PowerShell из точки входа настройки.
-   Использование перенаправления консоли для локальной отладки.
-   Настройка политики для пакетов кода службы.
-   Назначение политики безопасности доступа для конечных точек HTTP и HTTPS.

## <a name="secure-communication-for-services-in-azure-service-fabric-security"></a>Защита взаимодействия служб в Azure Service Fabric.
Безопасность — один из самых важных аспектов взаимодействия. Платформа приложений Reliable Services предоставляет несколько готовых стеков взаимодействия и средств, которыми можно воспользоваться для повышения безопасности.

-   [Защита взаимодействия служб в Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-secure-communication)
-   [Защита службы при использовании стека взаимодействия на основе WCF](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-secure-communication#help-secure-a-service-when-youre-using-a-wcf-based-communication-stack)

## <a name="next-steps"></a>Дополнительная информация
- Основные сведения о безопасности кластера см. в статье [Создание кластера Service Fabric в Azure с помощью Azure Resource Manager](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm) и на [портале Azure](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-portal).
- Дополнительные сведения о безопасности кластера Service Fabric см. в статье [Сценарии защиты кластера Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security).
