---
title: "Общие сведения о безопасности Azure Service Fabric | Документация Майкрософт"
description: "Эта статья содержит общие сведения о безопасности Azure Service Fabric."
services: security
documentationcenter: na
author: unifycloud
manager: swadhwa
editor: tomsh
ms.assetid: 
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/04/2017
ms.author: tomsh
ms.translationtype: HT
ms.sourcegitcommit: 0aae2acfbf30a77f57ddfbaabdb17f51b6938fd6
ms.openlocfilehash: 0445df244848469cc2071681bec4b8f4c5fceeac
ms.contentlocale: ru-ru
ms.lasthandoff: 08/09/2017

---
# <a name="azure-service-fabric-security-overview"></a>Общие сведения о безопасности Azure Service Fabric
[Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview) — это платформа распределенных систем, которая дает возможность не только легко упаковывать и развертывать масштабируемые и надежные микрослужбы, но и управлять ими. Service Fabric также позволяет разрешить значительные трудности, возникающие при разработке облачных приложений и управлении ими. Получая гарантированную масштабируемость, надежность и управляемость, разработчики и администраторы могут сосредоточиться на реализации критически важных и ресурсоемких рабочих нагрузок вместо того, чтобы тратить силы на решение сложных проблем с инфраструктурой.

В этом обзоре безопасности Azure Service Fabric рассматриваются следующие области:

-   Защита кластера.
-   Мониторинг и диагностика.
-   Безопасное использование сертификатов.
-   Управление доступом на основе ролей (RBAC)
-   Защита кластера с помощью системы безопасности Windows.
-   Настройка безопасности приложений в Service Fabric.
-   Защита взаимодействия служб в Azure Service Fabric.

## <a name="securing-your-cluster"></a>Защита кластера
Azure Service Fabric — это оркестратор служб в кластере компьютеров. Кластеры нужно защищать во избежание несанкционированного подключения к ним, особенно если на нем выполняются рабочие нагрузки рабочей среды. Существует возможность создания незащищенного кластера, однако стоит учитывать, что это позволит анонимным пользователям подключаться к нему, если конечные точки управления кластером общедоступны через Интернет.

Этот раздел содержит обзор сценариев безопасности автономных или работающих в Azure кластеров. В нем также рассматриваются различные технологии, используемые для реализации этих сценариев. Сценарии обеспечения безопасности кластера:

-   безопасность обмена данными между узлами;
-   безопасность обмена данными между клиентами и узлами;

### <a name="node-to-node-security"></a>безопасность обмена данными между узлами;
Обеспечивается безопасность обмена данными между виртуальными машинами и компьютерами в кластере. Такая защита гарантирует, что размещать приложения и службы в кластере смогут владельцы только тех компьютеров, которые прошли авторизацию для подключения к кластеру.

Кластеры, работающие в Azure, или автономные кластеры, работающие под управлением Windows, могут использовать [безопасность на основе сертификатов](https://msdn.microsoft.com/library/ff649801.aspx) или [безопасность Windows](https://msdn.microsoft.com/library/ff649396.aspx) для компьютеров Windows Server.

**Безопасность обмена данными между узлами на основе сертификатов**

Service Fabric использует сертификаты сервера X.509, которые указываются как часть конфигурации типа узла при создании кластера. Краткий обзор этих сертификатов и [способа их получения или создания приведен в этой статье](https://docs.microsoft.com/dotnet/framework/wcf/feature-details/working-with-certificates).

При создании кластера безопасность на основе сертификатов можно настроить с помощью портала Azure, шаблонов Azure Resource Manager или автономного шаблона JSON. Вы можете указать основной сертификат и необязательный дополнительный сертификат, который будет использоваться для смены сертификатов. Эти сертификаты должны отличаться от сертификатов клиента администрирования и клиента только для чтения, указанных для [безопасности обмена данными между клиентами и узлами](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-cluster-security).

### <a name="client-to-node-security"></a>безопасность обмена данными между клиентами и узлами;
Безопасность обмена данными между клиентом и узлом настраивается с помощью параметра ClientIdentities. Чтобы установить отношение доверия между клиентом и кластером, необходимо настроить кластер таким образом, чтобы ему были известны удостоверения клиентов, которым можно доверять. Это можно сделать двумя способами:

-   указать пользователей группы домена, которые могут подключаться;
-   указать пользователей узла домена, которые могут подключаться.

Service Fabric поддерживает два разных типа контроля доступа для клиентов, подключенных к кластеру Service Fabric:

-   Администратор
-   Пользователь

Благодаря контролю доступа администратор кластера может ограничить доступ разных групп пользователей на выполнение определенных типов операций в кластере, повысив тем самым уровень безопасности кластера. Администраторы имеют полный доступ к возможностям управления (включая возможности чтения и записи). Пользователи по умолчанию имеют доступ только на чтение для управления (например, при работе с запросами) и возможность разрешения приложений и служб.

**Безопасность обмена данными между клиентами и узлами на основе сертификатов**

Безопасность обмена данными между клиентами и узлами на основе сертификатов настраивается при создании кластера (на портале Azure, с помощью шаблонов Resource Manager или автономного шаблона JSON). Для этого указывается сертификат клиента администрирования и (или) пользовательский сертификат клиента. Эти сертификаты должны отличаться от основного и дополнительного сертификатов, указанных для защиты обмена данными между узлами.

Клиенты, подключающиеся к кластеру с помощью сертификата администрирования получают полный доступ к возможностям управления. Клиенты, подключающиеся к кластеру с помощью сертификата клиента только для чтения, получают доступ только для чтения к возможностям управления. Иными словами, эти сертификаты используются для управления доступом на основе ролей (RBAC).

Чтобы узнать, как настроить безопасность на основе сертификатов в кластере, работающем в Azure, см. статью [Создание кластера Service Fabric в Azure с помощью Azure Resource Manager](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm).

**Безопасность обмена данными между клиентами и узлами Azure Active Directory в Azure**

Для защиты доступа к конечным точкам управления кластеры под управлением Azure также могут использовать Azure Active Directory (AAD). Сведения о том, как создать необходимые артефакты Azure Active Directory (AAD), как их заполнить при создании кластера, а после этого подключиться к этим кластерам, см. в статье [Создание кластера Service Fabric в Azure с помощью Azure Resource Manager](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm).

AAD позволяет организациям (известным как клиенты) управлять доступом пользователей к приложениям, которые делятся на приложения с веб-интерфейсом входа и приложения с собственным интерфейсом входа клиента.

Кластеры Service Fabric предлагают несколько точек входа для управления функциями кластеров, включая веб-интерфейс Service Fabric Explorer и Visual Studio. В итоге вы получаете два приложения AAD для управления доступом к кластеру: одно веб-приложение и одно собственное приложение.
Чтобы обеспечить безопасность обмена данными между узлами в кластерах Azure, рекомендуется использовать безопасность AAD для аутентификации клиентов и сертификатов.

Если в рамках автономных кластеров Windows Server используется Windows Server 2012 R2 и Active Directory, рекомендуется применять безопасность Windows с учетными записями, управляемыми группой. В противном случае используйте безопасность Windows с учетными записями Windows.

## <a name="monitoring-and-diagnostics-for-azure-service-fabric"></a>Мониторинг и диагностика для Azure Service Fabric
[Мониторинг и диагностика](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-overview) крайне важны для разработки, тестирования и развертывания приложений и служб в любой среде. Оптимальная работа решений Service Fabric зависит от эффективного планирования и реализации мониторинга и диагностики, которые помогают обеспечить правильную работу приложений и служб в локальной среде разработки или в производственной среде.

С точки зрения безопасности основные цели мониторинга и диагностики заключаются в следующем:

-   Обнаружение и диагностика неполадок оборудования и инфраструктуры, вызванных событиями безопасности.
-   Выявление проблем с программным обеспечением и приложениями, благодаря которым можно определить индикатор компрометации.
-   Оценка потребления ресурсов для предотвращения непреднамеренного отказа в обслуживании.

Общий рабочий процесс мониторинга и диагностики состоит из трех этапов.

-   **Создание событий.** Сюда входят события (журналы, трассировки, пользовательские события) на уровне инфраструктуры (кластера) и приложения или службы. Ознакомьтесь с дополнительными сведениями о [событиях уровня инфраструктуры](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-generation-infra) и [событиях уровня приложений](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-generation-app), чтобы понять, какое инструментирование предоставляется по умолчанию, а какое можно добавить дополнительно.
-   **Агрегирование событий.** Создаваемые события должны быть собраны и агрегированы, прежде чем они могут быть отображены. Как правило, мы рекомендуем использовать [систему диагностики Azure](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-aggregation-wad) (больше напоминает сбор журналов на основе агентов) или [EventFlow](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow) (внутрипроцессный сбор журналов).
-   **Анализ.** События должны быть доступными для просмотра и использования в определенном формате, обеспечивающем возможность анализа и отображения. На рынке представлено несколько отличных платформ анализа и визуализации данных мониторинга и диагностики. Мы рекомендуем использовать [OMS](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-analysis-oms) и [Application Insights](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-analysis-appinsights), так как эти инструменты лучше интегрируются с Service Fabric.

[Мониторинг Azure](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview) дает возможность отслеживать многие ресурсы Azure, из которых состоит кластер Service Fabric.

Модуль наблюдения — это отдельная служба, которая может отслеживать работоспособность и нагрузку в службах и сообщать о работоспособности любого элемента в иерархии модели работоспособности. Он позволяет предотвратить ошибки, которые невозможно обнаружить в контексте отдельной службы. Модули наблюдения также удобны для размещения кода, выполняющего корректирующие действия без участия пользователя (например, очистку файлов журнала в хранилище через определенные интервалы времени). Пример реализации службы наблюдения см. [здесь](https://azure.microsoft.com/resources/samples/service-fabric-watchdog-service/).

## <a name="secure-using-certificates"></a>Безопасное использование сертификатов
Используя сертификаты, вы можете определить, как защитить обмен данными между различными узлами автономного кластера под управлением Windows, а также как аутентифицировать клиентов, подключающихся к этому кластеру, с помощью сертификатов X.509. Это гарантирует, что только авторизованные пользователи могут получить доступ к кластеру для развертывания приложений и выполнения задач управления. Безопасность на основе сертификатов необходимо включить в кластере при его создании.

### <a name="x509-certificates-and-service-fabric"></a>Сертификаты X.509 и Service Fabric
Цифровые сертификаты X.509 обычно используются для проверки подлинности клиентов и серверов, а также для шифрования и цифровой подписи сообщений.

В следующей таблице перечислены сертификаты, которые понадобятся при настройке кластера.

|Параметр сведений о сертификате |Описание|
|-------------------------------|-----------|
|ClusterCertificate|    Этот сертификат нужен, чтобы защитить связь между узлами кластера. Для обновления можно использовать два разных сертификата — основной и дополнительный.|
|ServerCertificate| Этот сертификат предоставляется клиенту при попытке подключиться к этому кластеру. Для обновления можно использовать два разных сертификата сервера — основной и дополнительный.|
|ClientCertificateThumbprints|  Это набор сертификатов, которые требуется установить на клиентских компьютерах, прошедших аутентификацию.|
|ClientCertificateCommonNames|  Укажите общее имя первого сертификата клиента для параметра CertificateCommonName. CertificateIssuerThumbprint — это отпечаток издателя сертификата.|
|ReverseProxyCertificate|   Это необязательный сертификат, который можно указать, если вы хотите защитить [обратный прокси-сервер](https://docs.microsoft.com/azure/service-fabric/service-fabric-reverseproxy).|

Дополнительные сведения о защите сертификатов см. [здесь](https://docs.microsoft.com/azure/service-fabric/service-fabric-windows-cluster-x509-security).

## <a name="role-based-access-control-rbac"></a>Управление доступом на основе ролей (RBAC)
Благодаря контролю доступа администратор кластера может ограничить доступ разных групп пользователей на выполнение определенных операций в кластере, повысив тем самым уровень безопасности кластера. Для клиентов, подключающихся к кластеру, поддерживаются два типа управления доступом: администратор и пользователь.

Администраторы имеют полный доступ к возможностям управления (включая возможности чтения и записи). Пользователи по умолчанию имеют доступ только на чтение для управления (например, при работе с запросами) и возможность разрешения приложений и служб.

Клиентские роли (администратора или клиента) задаются во время создания кластера путем предоставления отдельных удостоверений (сертификатов, AAD и т. д.) для каждой из них. Дополнительные сведения о параметрах управления доступом по умолчанию и их изменении см. в статье [Контроль доступа на основе ролей для клиентов Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security-roles).

## <a name="secure-standalone-cluster-using-windows-security"></a>Защита автономного кластера с помощью системы безопасности Windows
Чтобы предотвратить несанкционированный доступ к кластеру Service Fabric, его необходимо защитить. Безопасность особенно важна при выполнении в кластере производственных рабочих нагрузок. Здесь описывается, как настроить безопасность обмена данными между узлами или между клиентом и узлом с помощью системы безопасности Windows и файла ClusterConfig.JSON.

**Настройка безопасности Windows с помощью групповой управляемой учетной записи службы**

Безопасный обмен данными между узлами можно настроить с помощью параметра [ClustergMSAIdentity](https://docs.microsoft.com/azure/service-fabric/service-fabric-windows-cluster-windows-security), когда Service Fabric необходимо использовать групповую управляемую учетную запись службы. Чтобы создать отношения доверия между узлами, им нужно сообщить друг о друге.

Безопасность обмена данными между клиентом и узлом настраивается с помощью параметра ClientIdentities. Чтобы установить отношение доверия между клиентом и кластером, необходимо настроить кластер таким образом, чтобы ему были известны удостоверения клиентов, которым можно доверять.

**Настройка безопасности Windows с использованием группы компьютеров**

Безопасный обмен данными между узлами можно настроить с помощью параметра ClusterIdentity, если вы хотите использовать группу компьютеров в домене Active Directory. Дополнительные сведения см. в статье [How to Create a Group in Active Directory](https://msdn.microsoft.com/library/aa545347) (Как создать группу компьютеров в Active Directory).

Защиту обмена данными между клиентом и узлом можно настроить с помощью параметра ClientIdentities. Чтобы установить отношения доверия между клиентом и кластером, необходимо настроить кластер таким образом, чтобы ему были известны удостоверения клиентов, которым можно доверять. Установить отношения доверия можно двумя разными способами:

-   указать пользователей группы домена, которые могут подключаться;
-   указать пользователей узла домена, которые могут подключаться.

## <a name="configure-application-security-in-service-fabric"></a>Настройка безопасности приложений в Service Fabric.
### <a name="managing-secrets-in-service-fabric-applications"></a>Управление секретами в приложениях Service Fabric
Этот метод помогает с управлением секретами в приложении Service Fabric. Секретом может считаться любая конфиденциальная информации, например строка подключения к хранилищу, пароль или другое значение, которое не должно обрабатываться в виде обычного текста.

В этом подходе для управления ключами и секретами используется [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-whatis). Однако использование секретов в приложении осуществляется без привязки к определенной облачной платформе, чтобы приложения могли быть развернуты в кластере, размещенном в любом месте. Этот поток состоит из четырех основных шагов.

-   Получение сертификата шифрования данных.
-   Установка сертификата в кластере.
-   Шифрование значений секретов при развертывании приложения с помощью сертификата и их включение в файл конфигурации Settings.xml службы.
-   Чтение зашифрованных значений из файла Settings.xml. Для расшифровки используется тот же сертификат шифрования.

>[!Note]
>Дополнительные сведения см. в статье [Управление секретами в приложениях Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-application-secret-management).

### <a name="configure-security-policies-for-your-application"></a>Настройка политик безопасности для приложения
Платформа безопасности Azure Service Fabric помогает защищать приложения, работающие в кластере под разными учетными записями. Кроме того, она помогает защищать ресурсы, используемые приложениями при развертывании с помощью учетных записей, например файлы, каталоги и сертификаты. Это позволяет изолировать друг от друга выполняемые приложения, даже если они запущены в общей среде.
Для этого нужно выполнить следующие действия:

-   Определение политики для точки входа настройки службы.
-   Запуск команд PowerShell из точки входа настройки.
-   Использование перенаправления консоли для локальной отладки.
-   Настройка политики для пакетов кода службы.
-   Назначение политики безопасности доступа для конечных точек HTTP и HTTPS.

## <a name="secure-communication-for-services-in-azure-service-fabric-security"></a>Защита взаимодействия служб в Azure Service Fabric.
Безопасность — один из самых важных аспектов взаимодействия. Платформа приложений Reliable Services предоставляет несколько готовых стеков взаимодействия и средств, которыми можно воспользоваться для повышения безопасности.

-   [Защита взаимодействия служб в Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-secure-communication)
-   [Защита службы при использовании стека взаимодействия на основе WCF](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-secure-communication#help-secure-a-service-when-youre-using-a-wcf-based-communication-stack)

## <a name="next-steps"></a>Дальнейшие действия
- Основные сведения о безопасности кластера см. в статье [Создание кластера Service Fabric в Azure с помощью Azure Resource Manager](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm) и на [портале Azure](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-portal).
- Ознакомьтесь с дополнительными сведениями о [защите кластера Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security).

