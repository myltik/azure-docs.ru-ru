---
title: Как отслеживать и уменьшать регулирование в службе "Аналитика временных рядов Azure" | Документация Майкрософт
description: Эта статья описывает процессы мониторинга, диагностики и устранение проблем производительности в службе "Аналитика временных рядов Azure", которые могут привести к задержкам и регулированию.
ms.service: time-series-insights
services: time-series-insights
author: jasonwhowell
ms.author: jasonh
manager: jhubbard
ms.reviewer: v-mamcge, jasonh, kfile, anshan
ms.devlang: csharp
ms.workload: big-data
ms.topic: troubleshooting
ms.date: 11/27/2017
ms.openlocfilehash: 9a7720934870818a4e13d3d6b5d391d9bd3cddcd
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34653677"
---
# <a name="monitor-and-mitigate-throttling-to-reduce-latency-in-azure-time-series-insights"></a>Отслеживание и уменьшение регулирования для сокращения задержек в службе "Аналитика временных рядов Azure"
Если объем входящих данных превышает пределы, установленные в конфигурации вашей среды, в службе "Аналитика временных рядов Azure" могут возникнуть задержки или регулирования.

Чтобы избежать задержки и регулирования, следует правильно настроить среду для того объема данных, который поступает для анализа.

Задержки и регулирования чаще всего возникают в следующих случаях.

- Если вы добавили новый источник событий, содержащий много данных за предыдущие периоды, и скорость передачи этих данных превышает выделенный для среды лимит (службе "Аналитика временных рядов" потребуется некоторое время, чтобы восстановить актуальность).
- Если вы добавили в среду дополнительные источники событий, в результате чего увеличился объем получаемых событий и, возможно, превысил емкость вашей среды.
- Если вы передали в источник событий большой объем архивных данных (службе "Аналитика временных рядов" потребуется некоторое время, чтобы восстановить актуальность).
- Если вы добавили новые сведения о телеметрии, что увеличило размер событий.  С точки зрения регулирования входящий пакет данных размером 32 КБ рассматривается как 32 события размером по 1 КБ каждое. Максимальный допустимый размер события составляет 32 КБ. Пакеты данных, размер которых превышает 32 КБ, усекаются.


## <a name="monitor-latency-and-throttling-with-alerts"></a>Мониторинг задержки и регулирования с помощью оповещений

Оповещения помогут вам выявить и устранить проблемы, вызывающие задержки в вашей среде. 

1. На портале Azure щелкните **Метрики**. 

   ![Метрики](media/environment-mitigate-latency/add-metrics.png)

2. Щелкните **Add metric alert** (Добавить оповещение метрики).  

    ![Добавление оповещения для метрики](media/environment-mitigate-latency/add-metric-alert.png)

Здесь вы можете настроить оповещения по следующим метрикам.

|Метрика  |ОПИСАНИЕ  |
|---------|---------|
|**Ingress Received Bytes** (Получено байт входящих данных)     | Количество байтов необработанной информации, полученных от источников событий. Обычно в этот объем включается имя и значение свойства.  |  
|**Ingress Received Invalid Messages** (Получено недопустимых сообщений во входящих данных)     | Число недопустимых сообщений, полученных от всех источников событий (концентраторов событий Azure и Центров Интернета вещей Azure).      |
|**Ingress Received Messages** (Получено сообщений входящих данных)   | Количество сообщений, полученных от всех источников событий (концентраторов событий Azure и Центров Интернета вещей Azure).        |
|**Ingress Stored Bytes** (Хранится байтов входящих данных)     | Общий размер сохраненных событий, доступных для запросов. В этот объем включаются только значения свойств.        |
|**Ingress Stored Events** (Хранится сообщений входящих данных)     |   Общее количество сведенных и сохраненных событий, доступных для запросов.      |
|**Ingress Recieved Message Time Lag** (Получено сообщений входящих данных с задержкой)    |  Разница между временем, когда сообщение помещается в очередь источника событий, и временем, когда сообщение обрабатывается во входящих сообщениях.      |
|**Ingress Recieved Message Count Lag** (Количество полученных сообщений входящих данных с задержкой)    |  Разница между порядковым номером последнего сообщения в очереди событий источника секции и порядковым номером сообщения, обрабатываемого во входящих сообщениях.      |


![Latency](media/environment-mitigate-latency/latency.png)

Если выполняется регулировка, вы увидите сообщение со значением *Ingress Recieved Message Time Lag* (Получено сообщений входящих данных с задержкой). В нем будет отображена информация о том, на сколько минут TSI отстает от реального времени и когда сообщение попадает в источник события (не учитывая время индексирования, которое примерно составляет 30–60 секунд).  Метрика *Ingress Recieved Message Count Lag* (Количество полученных сообщений входящих данных с задержкой) также должна иметь значение, которое позволяет определить, на сколько сообщений вы отстали.  Самым простым способом устранить задержку является увеличение емкости среды до размера, который позволит сделать это.  

Например, если в среде S1 имеется задержка в 5 миллионов сообщений, то чтобы устранить ее, необходимо увеличить размер среды до шести единиц на один день.  Чтобы устранить задержку еще быстрее, количество единиц можно увеличить еще.  Это обычная практика при первоначальной настройке среды, особенно когда вы подключаете ее к источнику событий, в котором уже есть события или когда вы загружаете много исторических данных.

Кроме того, вы можете установить оповещение, которое сработает, если значение параметра **Ingress Stored Events** (Хранится сообщений входящих данных) в течение 2 часов превышает некоторое пороговое значение, установленное чуть ниже общей емкости вашей среды.  Такое предупреждение позволит понять, что возможности среды постоянно используются полностью, что указывает на высокую вероятность задержки.  

Например, если вы подготовили три единицы S1 (с общим объемом 2100 входящих запросов в минуту), установите оповещение "**Ingress Stored Events** >= 1900 в течение 2 часов". Если среда регулярно достигает этого предела и активирует это оповещение, то скорее всего вы выделили недостаточно ресурсов.  

Если же у вас есть подозрения, что срабатывает регулирование, сравните значение **Ingress Received Messages** с количеством сообщений, отправленных с соответствующего источника.  Если число сообщений, поступающих в концентратор событий, превышает значение **Ingress Received Messages**, значит Аналитика временных рядов применяет регулирование.

## <a name="improving-performance"></a>Повышение производительности 
Если вы хотите уменьшить регулирование или устранить задержки, мы рекомендуем увеличить емкость вашей среды. 

Чтобы избежать задержки и регулирования, следует правильно настроить среду для того объема данных, который поступает для анализа. Дополнительные сведения о том, как повысить емкость среды, вы найдете в [статье о масштабировании среды](time-series-insights-how-to-scale-your-environment.md).

## <a name="next-steps"></a>Дополнительная информация
- Дополнительные рекомендации по устранению неполадок см. в статье [Диагностика и устранение неполадок в среде Time Series Insights](time-series-insights-diagnose-and-solve-problems.md).
- Чтобы получить помощь по этим темам, откройте дискуссию на [форуме MSDN](https://social.msdn.microsoft.com/Forums/home?forum=AzureTimeSeriesInsights) или [Stack Overflow](https://stackoverflow.com/questions/tagged/azure-timeseries-insights). Также вы можете обратиться в [службу поддержки Azure](https://azure.microsoft.com/support/options/).
