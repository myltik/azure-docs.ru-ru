---
title: Рекомендации по настройке производительности Azure Data Lake Store | Документация Майкрософт
description: Рекомендации по настройке производительности Azure Data Lake Store
services: data-lake-store
documentationcenter: ''
author: stewu
manager: amitkul
editor: cgronlun
ms.assetid: ebde7b9f-2e51-4d43-b7ab-566417221335
ms.service: data-lake-store
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 06/30/2017
ms.author: stewu
ms.openlocfilehash: aa803e823eb3096ea785f1f912293cae82c24b8d
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
---
# <a name="tuning-azure-data-lake-store-for-performance"></a>Настройка Azure Data Lake Store для повышения производительности

Data Lake Store поддерживает высокую пропускную способность при анализе с интенсивным использованием ввода-вывода и перемещением данных.  В Azure Data Lake Store важно использовать всю доступную пропускную способность (объем данных, которые можно читать или записывать в секунду), чтобы обеспечить высокую производительность.  Для этого нужно выполнить как можно больше операций чтения и записи параллельно.

![Производительность Data Lake Store](./media/data-lake-store-performance-tuning-guidance/throughput.png)

Azure Data Lake Store можно масштабировать, чтобы предоставить необходимую пропускную способность для всех сценариев аналитики. По умолчанию учетная запись Azure Data Lake Store автоматически предоставляет достаточную пропускную способность для выполнения различных сценариев использования. В случаях, когда клиенты достигают лимита по умолчанию, учетную запись ADLS можно настроить для предоставления большей пропускной способности, связавшись с поддержкой Майкрософт.

## <a name="data-ingestion"></a>Прием данных

При передаче данных из исходной системы в ADLS необходимо учесть, что исходное оборудование, сетевое оборудование и сетевое подключение к ADLS могут быть узким местом.  

![Производительность Data Lake Store](./media/data-lake-store-performance-tuning-guidance/bottleneck.png)

Очень важно убедиться, что перемещение данных не зависит от следующих факторов.

### <a name="source-hardware"></a>Исходное оборудование

При использовании локальных компьютеров или виртуальных машин в Azure следует тщательно выбирать соответствующее оборудование. В качестве исходного дискового оборудования следует использовать SSD, а не жесткие диски, поэтому выбирайте дисковое оборудование с быстро работающими шпинделями. В качестве исходного сетевого оборудования используйте самые быстрые сетевые адаптеры.  В Azure мы советуем виртуальные машины Azure D14 с соответствующим мощным диском и сетевым оборудованием.

### <a name="network-connectivity-to-azure-data-lake-store"></a>Сетевое подключение к Azure Data Lake Store

Сетевое подключение между исходными данными и Azure Data Lake Store иногда может быть узким местом. Если исходные данные находятся в локальной среде, рекомендуется использовать выделенный канал с [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/). Если исходные данные находятся в Azure, вы сможете обеспечить лучшую производительность, если разместить данные в том же регионе Azure, что и Data Lake Store.

### <a name="configure-data-ingestion-tools-for-maximum-parallelization"></a>Настройка средств приема данных для обеспечения максимальной параллелизации

Решив проблему с узкими местами исходного оборудования и сетевого подключения, можно приступить к настройке средств приема. В следующей таблице перечислены ключевые параметры нескольких популярных средств приема и предоставлены подробные статьи по настройке производительности для них.  Дополнительные сведения о выборе подходящего средства для вашего сценария см. в [этой статье](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-data-scenarios).

| Средство               | Параметры     | Дополнительные сведения                                                                 |
|--------------------|------------------------------------------------------|------------------------------|
| PowerShell       | PerFileThreadCount, ConcurrentFileCount |  [Ссылка](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-powershell#performance-guidance-while-using-powershell) |
| AdlCopy    | Единицы измерения Azure Data Lake Analytics  |   [Ссылка](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-copy-data-azure-storage-blob#performance-considerations-for-using-adlcopy)         |
| DistCp            | -m (mapper)   | [Ссылка](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-copy-data-wasb-distcp#performance-considerations-while-using-distcp)                             |
| Фабрика данных Azure| parallelCopies    | [Ссылка](../data-factory/copy-activity-performance.md)                          |
| Sqoop           | fs.azure.block.size, -m (mapper)    |   [Ссылка](https://blogs.msdn.microsoft.com/bigdatasupport/2015/02/17/sqoop-job-performance-tuning-in-hdinsight-hadoop/)        |

## <a name="structure-your-data-set"></a>Структура набора данных

При хранении данных в Data Lake Store размер файла, число файлов и структура папок влияют на производительность.  В следующем разделе описаны рекомендации в этих областях.  

### <a name="file-size"></a>Размер файла

Как правило, у модулей аналитики, таких как HDInsight и Azure Data Lake Analytics, нагрузка зависит от количества файлов.  Если вы храните данные в большом количестве небольших файлов, это может отрицательно сказаться на производительности.  

Упорядочивайте свои данные в файлы большого размера для лучшей производительности.  Мы рекомендуем упорядочивать наборы данных в файлы размером 256 МБ или больше. В некоторых случаях, например относительно изображений и двоичных данных, их параллельная обработка невозможна.  В таких случаях рекомендуется хранить отдельные файлы размером не более 2 ГБ.

В некоторых случаях конвейеры данных имеют ограниченный контроль над необработанными данными, которые содержат множество небольших файлов.  Рекомендуется использовать процесс подготовки, который будет создавать файлы большего размера для дочерних приложений.  

### <a name="organizing-time-series-data-in-folders"></a>Упорядочение данных временных рядов в папках

Для рабочих нагрузок Hive и ADLA удаление секций данных временных рядов может помочь некоторым запросам считывать только подмножество данных, что улучшает производительность.    

Конвейеры, принимающие данные временных рядов, часто помещают свои файлы с сильно структурированными именами файлов и папок. Ниже приведен обычный пример для данных, структурированных по дате:

    \DataSet\YYYY\MM\DD\datafile_YYYY_MM_DD.tsv

Обратите внимание, что данные времени и даты отображаются и как папки, и в имени файла.

Ниже приведен распространенный шаблон для даты и времени:

    \DataSet\YYYY\MM\DD\HH\mm\datafile_YYYY_MM_DD_HH_mm.tsv

Выбор, который вы делаете с помощью упорядочения папки и файлов, должен быть оптимизирован для больших размеров файлов и разумного количества файлов в каждой папке.

## <a name="optimizing-io-intensive-jobs-on-hadoop-and-spark-workloads-on-hdinsight"></a>Оптимизация заданий с интенсивными вычислениями ввода-вывода для рабочих нагрузок Hadoop и Spark в HDInsight

Задания можно отнести к одной из трех категорий:

* **Интенсивно использующие ЦП.**  Эти задания имеют долгое время вычисления с минимальным временем ввода-вывода.  Примеры включают машинное обучение и задания обработки естественных языков.  
* **С высоким объемом требуемой памяти.**  Эти задания используют большой объем памяти.  Примеры включают PageRank и задания аналитики в реальном времени.  
* **С большим количеством операций ввода-вывода.**  Эти задания большую часть своего времени выполняют операции ввода-вывода.  Распространенным примером является задание копирования, которое использует только операции чтения и записи.  Другие примеры включают задания подготовки данных, которые считывают большое количество данных, выполняют некоторую трансформацию данных, а затем записывают данные обратно в хранилище.  

Следующее руководство применяется только к заданиям с большим объемом операций ввода-вывода.

### <a name="general-considerations-for-an-hdinsight-cluster"></a>Общие рекомендации, связанные с кластером HDInsight

* **Поддерживаемые версии HDInsight.** Для повышения производительности используйте последний выпуск HDInsight.
* **Регионы.** Разместите Data Lake Store в том же регионе, что и кластер HDInsight.  

Кластер HDInsight An состоит из двух головных узлов и нескольких рабочих узлов. Каждый рабочий узел предоставляет определенное количество ядер и памяти, которые определяют тип виртуальной машины.  При выполнении задания YARN выступает в качестве согласователя ресурсов, который выделяет доступную память и ядра для создания контейнеров.  Каждый контейнер выполняет задачи, которые необходимы для выполнения задания.  Контейнеры выполняются параллельно для быстрой обработки задачи. Таким образом производительность повышается за счет выполнения максимально возможного количества контейнеров параллельно.

В пределах кластера HDInsight имеется три уровня, которые можно настроить, чтобы увеличить число контейнеров и использовать всю доступную пропускную способность.  

* **Физический уровень**
* **Уровень YARN**
* **Уровень рабочей нагрузки**

### <a name="physical-layer"></a>Физический уровень

**Запустите кластер с большим количеством узлов и/или на виртуальной машине большего размера.**  Больший кластер позволит вам выполнять дополнительные контейнеры YARN, как это показано на рисунке ниже.

![Производительность Data Lake Store](./media/data-lake-store-performance-tuning-guidance/VM.png)

**Используйте виртуальные машины с большей пропускной способностью сети.**  Пропускная способность сети может быть узким местом, если она меньше, чем пропускная способность Data Lake Store.  У различных виртуальных машин будет разная пропускная способность сети.  Выберите тип виртуальной машины с самой большой пропускной способностью сети.

### <a name="yarn-layer"></a>Уровень YARN

**Используйте контейнеры YARN меньшего размера.**  Уменьшите размер каждого контейнера YARN, чтобы создать больше контейнеров с тем же объемом ресурсов.

![Производительность Data Lake Store](./media/data-lake-store-performance-tuning-guidance/small-containers.png)

В зависимости от рабочей нагрузки минимальный необходимый размер контейнера YARN будет иметься всегда. Если выбрать слишком маленький контейнер, у заданий будут возникать проблемы из-за нехватки памяти. Как правило, контейнеры YARN должны быть размером не менее 1 ГБ. Обычно можно увидеть контейнеры YARN размером в 3 ГБ. Для некоторых рабочих нагрузок могут потребоваться контейнеры YARN большего размера.  

**Увеличьте количество ядер на контейнер YARN.**  Увеличьте количество ядер, выделенных для каждого контейнера, чтобы увеличить число параллельных задач, которые выполняются в каждом контейнере.  Это работает для приложений, которые выполняют несколько задач на контейнер, например Spark.  Для приложений, например Hive, которые выполняют один поток в каждом контейнере, лучше иметь несколько контейнеров, а не больше ядер на контейнер.   

### <a name="workload-layer"></a>Уровень рабочей нагрузки

**Используйте все доступные контейнеры.**  Задайте число задач равное или большее количества доступных контейнеров, чтобы использовать все ресурсы.

![Производительность Data Lake Store](./media/data-lake-store-performance-tuning-guidance/use-containers.png)

**Незавершенные задачи ресурсоемки.** Если у каждой задачи есть большой объем данных для обработки, неудачное выполнение задачи приводит к дорогостоящей повторной попытке.  Поэтому лучше создавать дополнительные задачи, каждая из которых обрабатывает небольшой объем данных.

Помимо общих рекомендаций, приведенных выше, каждое приложение имеет различные параметры, которые можно настроить для каждого конкретного приложения. В следующей таблице перечислены некоторые параметры и ссылки для начала работы с настройкой производительности для каждого приложения.

| Рабочая нагрузка               | Параметры для настройки задач                                                         |
|--------------------|-------------------------------------------------------------------------------------|
| [Spark в HDInsight](data-lake-store-performance-tuning-spark.md)       | <ul><li>Num-executors</li><li>Executor-memory</li><li>Executor-cores</li></ul> |
| [Hive в HDInsight](data-lake-store-performance-tuning-hive.md)    | <ul><li>hive.tez.container.size</li></ul>         |
| [MapReduce в HDInsight](data-lake-store-performance-tuning-mapreduce.md)            | <ul><li>Mapreduce.map.memory</li><li>Mapreduce.job.maps</li><li>Mapreduce.reduce.memory</li><li>Mapreduce.job.reduces</li></ul> |
| [Storm в HDInsight](data-lake-store-performance-tuning-storm.md)| <ul><li>Количество рабочих процессов</li><li>Количество экземпляров исполнителей воронки</li><li>Количество экземпляров исполнителей сита </li><li>Количество задач воронки</li><li>Количество задач сита</li></ul>|

## <a name="see-also"></a>См. также
* [Обзор хранилища озера данных Azure](data-lake-store-overview.md)
* [Начало работы с аналитикой озера данных Azure](../data-lake-analytics/data-lake-analytics-get-started-portal.md)
