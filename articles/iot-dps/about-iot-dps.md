---
title: Общие сведения о службе Azure "Подготовка устройств к добавлению в Центр Интернета вещей" | Документация Майкрософт
description: Эта статья содержит сведения о подготовке устройств в Azure с использованием службы подготовки устройств и Центра Интернета вещей.
author: nberdy
ms.author: nberdy
ms.date: 12/05/2017
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
manager: briz
ms.openlocfilehash: 45f47a553f94da2759c4db2b79c8ef5a1b42b8e8
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34630250"
---
# <a name="provisioning-devices-with-azure-iot-hub-device-provisioning-service"></a>Подготовка устройств с помощью службы подготовки устройств к добавлению в Центр Интернета вещей
Microsoft Azure предоставляет широкий набор интегрированных общедоступных облачных служб для всех потребностей решений Интернета вещей. Служба подготовки устройств для Центра Интернета вещей — это вспомогательная служба для Центра Интернета вещей, которая обеспечивает полностью автоматическую JIT-подготовку для нужного Центра Интернета вещей. Она позволяет подготавливать миллионы устройств и обеспечивает высокий уровень безопасности и масштабируемости без каких-либо действий со стороны пользователя.

## <a name="when-to-use-device-provisioning-service"></a>Сценарии использования службы подготовки устройств
Существует множество сценариев подготовки, в которых служба подготовки устройств помогает подключить и настроить устройства в Центре Интернета вещей, например:

* полностью автоматическая подготовка для одного решения Интернета вещей, не требующая указывания в коде сведений о подключении Центра Интернета вещей производителем (начальная настройка);
* балансировка нагрузки устройств в нескольких центрах;
* подключение устройств к решениям Интернета вещей их владельцев на основе данных операций по продажам (мультитенантность);
* подключение устройств к определенному решению Интернета вещей в зависимости от сценария использования (изоляция решений);
* подключение устройства к Центру Интернета вещей с минимальной задержкой (геосегментирование);
* повторная подготовка на основе изменений в устройстве;
* развертывание ключей, используемых устройством для подключения к Центру Интернета вещей (когда для подключения не используется сертификат X.509).

## <a name="behind-the-scenes"></a>Сопутствующие ресурсы
Все сценарии, перечисленные в предыдущем разделе, можно автоматически реализовать в одной и той же последовательности с помощью службы подготовки. Служба подготовки устройств автоматизирует большинство выполняемых вручную действий подготовки, чтобы сократить время развертывания устройств Интернета вещей и снизить риск ошибки пользователей. Ниже приведено описание действий, необходимых для подготовки устройства. Первое действие нужно выполнить вручную, а все остальные автоматизированы.

![Базовая последовательность подготовки](./media/about-iot-dps/dps-provisioning-flow.png)

1. Производитель устройства добавляет сведения о регистрации устройства в список регистрации на портале Azure.
2. Устройство связывается с конечной точкой службы подготовки, установленной производителем. Затем оно предоставляет службе подготовки идентификационные сведения для подтверждения подлинности.
3. Служба подготовки проверяет идентификатор устройства путем проверки идентификатора регистрации и ключа в соответствии с записью списка регистрации, выполняя специальный запрос nonce ([доверенный платформенный модуль](https://trustedcomputinggroup.org/work-groups/trusted-platform-module/)) или стандартную проверку X.509 (сертификат X.509).
4. Служба подготовки регистрирует устройство с помощью Центра Интернета вещей и заполняет [требуемое состояние двойника устройства](../iot-hub/iot-hub-devguide-device-twins.md).
5. Центр Интернета вещей возвращает сведения об идентификаторе устройства в службу подготовки.
6. Служба подготовки возвращает сведения о подключении к Центру Интернета вещей устройству. Теперь устройство может приступить к отправке данных непосредственно в Центр Интернета вещей.
7. Устройство подключается к Центру Интернета вещей.
8. Устройство получает требуемое состояние из двойника устройства в Центре Интернет вещей.

## <a name="provisioning-process"></a>Процесс подготовки
Процесс развертывания устройства состоит из двух отдельных этапов, в которых участвует служба подготовки устройств:

* **Этап производства**, на котором устройство создается и подготавливается производителем.
* **Этап настройки облака**, на котором служба подготовки устройств настраивается для автоматической подготовки.

Оба эти этапа легко интегрируются с имеющимися процессами производства и развертывания. Служба подготовки устройств даже упрощает некоторые процессы развертывания, которые выполняются вручную, чтобы получить сведения о подключении на устройстве.

### <a name="manufacturing-step"></a>Этап производства
Этот этап полностью посвящен действиям на производственной линии. На этом этапе задействуются такие роли, как кремниевый конструктор, кремниевый производитель, интегратор и (или) конечный производитель устройства. Этот этап посвящен созданию оборудования.

Служба подготовки устройств не вводит новые действия на этапе производства, однако она участвует в имеющихся действиях, выполняющих установку первоначального программного обеспечения и (в идеале) HSM на устройстве. Вместо создания идентификатора устройства на этом этапе устройство просто программируется с использованием сведений службы подготовки. При включении устройство вызывает службу подготовки для получения сведений о подключении и назначения решения Интернета вещей.

На этом этапе производитель также предоставляет специалисту по развертыванию или оператору устройств сведения об идентифицирующем ключе. По сути, процедура может заключаться в подтверждении того, что все устройства имеют сертификат X.509, созданный из сертификата для подписи, который предоставил специалист по развертыванию или оператор устройств, для извлечения открытой части ключа подтверждения доверенного платформенного модуля (TPM) из каждого устройства TPM. Сегодня эти службы предлагают многие кремниевые производители.

### <a name="cloud-setup-step"></a>Этап настройки облака
На этом этапе выполняется настройка облака для правильной автоматической подготовки. Обычно на этом этапе задействованы два типа пользователей: пользователь, который знает, как выполнить изначальную настройку устройств (оператор устройств), и пользователь, который знает, как разделить устройства среди Центров Интернета вещей (оператор решений).

Это однократная начальная настройка подготовки, которую необходимо выполнить. Это обычно делает оператор решений. После настройки службу подготовки не нужно изменять, пока не изменится вариант использования.

Настроив службу для автоматической подготовки, ее необходимо подготовить к регистрации устройств. Этот этап выполняет оператор устройств, которому известна требуемая конфигурация устройств и который должен проследить, чтобы служба подготовки могла надлежащим образом подтвердить удостоверение устройства при поиске Центра Интернета вещей. Оператор устройств принимает сведения об идентифицирующем ключе от производителя и добавляет их в список регистрации. Список регистрации может обновляться по мере добавления новых записей или обновления имеющихся записей последними сведениями об устройствах.

## <a name="registration-and-provisioning"></a>Регистрация и подготовка
Под *подготовкой* подразумеваются различные действия, в зависимости от отрасли, в которой используется термин. В контексте подготовки устройств Интернета вещей для облачных решений подготовка состоит из двух этапов:

1. На первом этапе устанавливается начальное подключение между устройством и решением Интернета вещей путем регистрации устройства.
2. Второй этап включает применение правильной конфигурации на устройстве на основе определенных требований решения, в котором оно зарегистрировано.

Устройство будет полностью подготовлено только после завершения обоих этих этапов. В некоторых облачных службах выполняется только первый этап процесса подготовки (регистрация устройств в конечной точке решения Интернета вещей). В них нельзя выполнить начальную настройку. Служба подготовки устройств автоматизирует оба этапа для обеспечения эффективной подготовки устройства.

## <a name="features-of-the-device-provisioning-service"></a>Возможности службы подготовки устройств
Служба подготовки устройств имеет множество возможностей, благодаря которым она идеально подходит для подготовки устройств.

* **Поддержка безопасной аттестации** удостоверения X.509 и удостоверения на основе доверенного платформенного модуля.
* **Список регистрации**, содержащий полную запись устройств или групп устройств, которые можно зарегистрировать в определенный момент. Он также содержит сведения о требуемой конфигурации устройства после его регистрации и может быть обновлен в любое время.
* **Несколько политик распределения**, позволяющие управлять назначением устройств службой подготовки устройств Центрам Интернета вещей для поддержки ваших сценариев.
* **Журналы мониторинга и диагностики**, позволяющие убедиться, что все работает правильно.
* **Поддержка нескольких центров**, что позволяет службе подготовки устройств назначить устройства нескольким Центрам Интернета вещей. Служба подготовки устройств может взаимодействовать с центрами в нескольких подписках Azure.
* **Поддержка нескольких регионов**, что позволяет службе подготовки устройств назначить устройства Центрам Интернета вещей в других регионах.

Дополнительные сведения об основных понятиях и возможностях подготовки устройств см. в статьях со [сведениями о понятиях, связанных с устройством](concepts-device.md), [службой](concepts-service.md) и [безопасностью](concepts-security.md).

## <a name="cross-platform-support"></a>Кроссплатформенная поддержка
Служба подготовки устройств, как и все службы Интернета вещей Azure, работает на нескольких платформах с различными операционными системами. Azure предоставляет пакеты SDK с открытым исходным кодом на различных [языках](https://github.com/Azure/azure-iot-sdks), чтобы упростить подключение устройств и управление службой. Служба подготовки устройств поддерживает следующие протоколы для подключения устройств:

* HTTPS
* AMQP
* AMQP через WebSocket;
* MQTT
* MQTT через WebSocket.

Служба подготовки устройств поддерживает только HTTPS-подключения для операций службы.

## <a name="regions"></a>регионы
Служба подготовки устройств доступна во многих регионах. Список уже доступных и новых регионов обновляется для всех служб в [регионах Azure](https://azure.microsoft.com/regions/). Узнать о доступности службы подготовки устройств в том или ином регионе можно на странице [Состояние Azure](https://azure.microsoft.com/status/).

> [!NOTE]
> Служба подготовки устройств является глобальной и не привязана к конкретному расположению. Но вам потребуется указать регион, в котором будут храниться метаданные, связанные с вашим профилем службы подготовки устройств.

## <a name="availability"></a>Доступность
Мы поддерживаем [соглашение об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/iot-hub/) с показателем доступности 99,9 % для службы подготовки устройств, о чем вы можете прочитать в соглашении. В полном [соглашении об уровне обслуживания Azure](https://azure.microsoft.com/support/legal/sla/) поясняется гарантированная доступность Azure в целом.

## <a name="quotas"></a>Квоты
Для каждой подписки Azure предусмотрена квота по умолчанию, которая может повлиять на зону охвата решения Интернета вещей. Текущее ограничение для каждой подписки составляет 10 служб подготовки устройств на подписку.

Дополнительные сведения об ограничениях квоты:

* [Подписка Azure, границы, квоты и ограничения службы](../azure-subscription-service-limits.md)

## <a name="related-azure-components"></a>Связанные компоненты Azure
Служба подготовки устройств автоматизирует подготовку устройств с помощью Центра Интернета вещей. См. дополнительные сведения о [Центре Интернета вещей](https://docs.microsoft.com/azure/iot-hub/).

## <a name="next-steps"></a>Дополнительная информация
Вы ознакомились с общими сведениями о подготовке устройств Интернета вещей в Azure. Далее следует ознакомиться с комплексным сценарием Интернета вещей.
> [!div class="nextstepaction"]
> [Set up the IoT Hub Device Provisioning Service (preview) with the Azure portal](quick-setup-auto-provision.md) (Настройка службы подготовки устройств для Центра Интернета вещей Azure на портале Azure (предварительная версия))
> [Create and provision a simulated device using IoT Hub Device Provisioning Service (preview)](quick-create-simulated-device.md) (Создание и подготовка виртуального устройства с помощью службы подготовки устройств для Центра Интернета вещей (предварительная версия))
> [Set up a device to provision using the Azure IoT Hub Device Provisioning Service](tutorial-set-up-device.md) (Настройка устройства для подготовки с помощью службы подготовки устройств для Центра Интернета вещей Azure)
