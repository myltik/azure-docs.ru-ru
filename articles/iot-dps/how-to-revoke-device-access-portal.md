---
title: Практическое руководство по отзыву регистрации устройства из службы подготовки устройств к добавлению в Центр Интернета вещей Azure
description: Сведения о том, как отозвать регистрацию устройства, чтобы предотвратить его подготовку с помощью службы подготовки устройств к добавлению в Центр Интернета вещей Azure.
author: bryanla
ms.author: bryanla
ms.date: 04/05/2018
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
manager: timlt
ms.openlocfilehash: 4b6c948765575c92c962999fe394ffaf1a0d22f3
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34628850"
---
# <a name="how-to-disenroll-a-device-from-azure-iot-hub-device-provisioning-service"></a>Практическое руководство по отзыву регистрации устройства из службы подготовки устройств к добавлению в Центр Интернета вещей Azure

Правильное управление учетными данными устройства крайне важно для таких крупных систем, как решения Интернета вещей. Для таких систем мы рекомендуем иметь четкий план отмены доступа к устройствам, когда их учетные данные, например маркера SAS или сертификат X.509, скомпрометированы. 

Устройство, зарегистрированное в службе подготовки устройств, может быть [автоматически подготовлено](concepts-auto-provisioning.md). Подготовленное устройство было зарегистрировано в центре Интернета вещей. Оно может принимать состояние [двойника устройства](~/articles/iot-hub/iot-hub-devguide-device-twins.md) и начать передачу данных телеметрии. В этой статье описывается, как отозвать регистрацию устройства из экземпляра службы подготовки, чтобы предотвратить его повторную подготовку в будущем.

> [!NOTE] 
> Не забывайте учесть политики повтора, применяемые к устройствам, для которых вы отменяете доступ. Например, если для устройства применяется политика бесконечных повторов, оно будет постоянно выполнять попытки зарегистрироваться в службе подготовки. Из-за этого оно потребляет ресурсы службы и даже может снизить производительность.

## <a name="blacklist-devices-by-using-an-individual-enrollment-entry"></a>Список блокировок устройств при использовании записей индивидуальной регистрации

Индивидуальные регистрации относятся к конкретным устройствам и могут использовать в качестве механизмов аттестации сертификаты X.509 или токены SAS (в реальном или виртуальном доверенном платформенном модуле). (Устройства, использующие токены SAS в качестве механизма аттестации, можно подготовить только через индивидуальные регистрации.) Чтобы внести в список блокировок устройство, для которого существует индивидуальная регистрация, следует отключить или удалит 

Чтобы временно отключить устройство, достаточно отключить его запись регистрации: 

1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
2. Выберите из списка ресурсов службу подготовки, от которой нужно отключить устройство.
3. В службе подготовки выберите **Управление регистрациями**, а затем — вкладку **Отдельные регистрации**.
4. Выберите запись регистрации устройства, которое вы хотите внести в список блокировок. 
5. Прокрутите до нижней части и выберите **Отключить** в переключателе **Включить запись**, а затем выберите **Сохранить**.  

   [![Отключение записи индивидуальной регистрации на портале](./media/how-to-revoke-device-access-portal/disable-individual-enrollment.png)](./media/how-to-revoke-device-access-portal/disable-individual-enrollment.png#lightbox)  

Чтобы навсегда отключить устройство, можно удалить его запись регистрации:

1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
2. Выберите из списка ресурсов службу подготовки, от которой нужно отключить устройство.
3. В службе подготовки выберите **Управление регистрациями**, а затем — вкладку **Отдельные регистрации**.
4. Установите флажок рядом с записью регистрации устройства, которое вы хотите внести в список блокировок. 
5. Выберите **Удалить** в верхней части окна, а затем подтвердите удаление регистрации, выбрав ответ **Да**. 

   ![Удаление записи индивидуальной регистрации на портале](./media/how-to-revoke-device-access-portal/delete-individual-enrollment.png)
    
После завершения процедуры запись исчезнет из списка индивидуальных регистраций.  

## <a name="blacklist-an-x509-intermediate-or-root-ca-certificate-by-using-an-enrollment-group"></a>Внесение в черный список сертификата X.509 промежуточного или корневого ЦС с использованием группы регистраций

Сертификаты X.509 обычно организованы в цепочки доверия. В случае компрометации сертификата на любом этапе цепочки доверие будет нарушено. Сертификат нужно отключить для предотвращения подготовки устройств службой подготовки устройств ниже по цепочке, которая содержит этот сертификат. Дополнительные сведения о сертификатах X.509 и их применении в службе подготовки вы найдете в статье [о сертификатах X.509](./concepts-security.md#x509-certificates). 

Группа регистраций представляет собой групповую запись для устройств с общим механизмом аттестации сертификатов X.509, подписанных одним и тем же промежуточным или корневым ЦС. Запись группы регистраций настроена с сертификатом X.509, связанным с промежуточным или корневым ЦС. Запись также настраивается и может иметь любые параметры конфигурации, например состояния двойника и подключения к Центру Интернета вещей, которые применяются для всех устройств, в цепочке сертификатов которых есть указанный в записи сертификат. Чтобы внести такой сертификат в список блокировок, вы можете отключить или удалить соответствующую группу регистраций.

Чтобы временно отключить сертификат, достаточно отключить его группу регистраций: 

1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
2. Выберите из списка ресурсов службу подготовки, от которой нужно отключить сертификат для подписи.
3. В службе подготовки выберите **Управление регистрациями**, а затем — вкладку **Группы регистрации**.
4. Выберите группу регистраций, использующую сертификат, который вы хотите внести в список блокировок.
5. Выберите **Отключить** в переключателе **Включить запись**, а затем выберите **Сохранить**.  

   ![Отключение записи группы регистраций на портале](./media/how-to-revoke-device-access-portal/disable-enrollment-group.png)

    
Чтобы навсегда отключить сертификат, можно удалить его группу регистраций:

1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
2. Выберите из списка ресурсов службу подготовки, от которой нужно отключить устройство.
3. В службе подготовки выберите **Управление регистрациями**, а затем — вкладку **Группы регистрации**.
4. Установите флажок рядом с группой регистраций, которую вы хотите внести в список блокировок. 
5. Выберите **Удалить** в верхней части окна, а затем подтвердите удаление группы регистраций, выбрав ответ **Да**. 

   ![Удаление записи группы регистраций на портале](./media/how-to-revoke-device-access-portal/delete-enrollment-group.png)

После завершения процедуры запись исчезнет из списка групп регистраций.  

> [!NOTE]
> Удаление группы регистраций для сертификата не помешает устройствам с этим сертификатом подключаться к службе, если существует другая, активная группа регистраций для корневого или промежуточного сертификата, расположенного выше в цепочке сертификатов устройств.

## <a name="blacklist-specific-devices-in-an-enrollment-group"></a>Отключение конкретных устройств, входящих в группу регистраций

Устройства, которые используют механизм аттестации X.509, выполняют аутентификацию на основе цепочки сертификатов устройства и закрытого ключа. Когда устройство подключается и выполняет аутентификацию с помощью службы подготовки устройств, служба сначала ищет отдельные регистрации, соответствующие учетным данным устройства. Служба выполняет поиск групп регистраций, чтобы определить, можно ли подготовить устройство. Если служба обнаружит отключенную отдельную регистрацию устройства, она не позволит устройству подключиться. Служба предотвращает подключение, даже если в цепочке сертификатов устройства есть включенная группа регистраций для промежуточного или корневого ЦС. 

Чтобы включить в черный список индивидуальное устройство из группы регистраций, выполните следующие действия.

1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
2. В списке ресурсов выберите службу подготовки, которая содержит группу регистраций для отключаемого устройства.
3. В службе подготовки выберите **Управление регистрациями**, а затем — вкладку **Отдельные регистрации**.
4. Нажмите кнопку **Добавить** вверху. 
5. Выберите **X.509** в качестве механизма аттестации для устройства, а затем отправьте сертификат устройства. Это подписанный сертификат конечного субъекта, установленный на устройстве. Устройство использует его для создания сертификатов для аутентификации.
6. Введите **идентификатор устройства Центра Интернета вещей** для нужного устройства. 
7. Выберите **Отключить** в переключателе **Включить запись**, а затем выберите **Сохранить**. 

    [![Использование отключенной записи индивидуальной регистрации для исключения устройства из группы регистрации на портале](./media/how-to-revoke-device-access-portal/disable-individual-enrollment-in-enrollment-group.png)](./media/how-to-revoke-device-access-portal/disable-individual-enrollment-in-enrollment-group.png#lightbox)

После успешного создания регистрации новое устройство появится на вкладке **Индивидуальные регистрации**.

## <a name="next-steps"></a>Дополнительная информация

Отзыв регистрации также является частью полного процесса отзыва. Отзыв устройства включает как отзыв регистрации из службы подготовки, так и отмену регистрации в Центре Интернета вещей. Дополнительные сведения о полном процессе см. в статье [Как отменить подготовку устройств, зарегистрированных в службе подготовки](how-to-unprovision-devices.md). 

