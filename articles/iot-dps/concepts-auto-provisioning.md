---
title: 'Служба "Подготовка устройств к добавлению в Центр Интернета вещей": принципы автоматической подготовки'
description: В этой статье описываются общие этапы автоматической подготовки устройств с помощью службы "Подготовка устройств к добавлению в Центр Интернета вещей", Центра Интернета вещей и клиентских пакетов SDK.
services: iot-dps
keywords: ''
author: BryanLa
ms.author: bryanla
ms.date: 03/27/2018
ms.topic: conceptual
ms.service: iot-dps
documentationcenter: ''
manager: timlt
ms.devlang: na
ms.custom: ''
ms.openlocfilehash: e743f40a1f8ff71fe93f14217b410df348d9903d
ms.sourcegitcommit: 9cdd83256b82e664bd36991d78f87ea1e56827cd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
---
# <a name="auto-provisioning-concepts"></a>Принципы автоматической подготовки устройств

Как описано в [обзоре](about-iot-dps.md), служба подготовки устройств — это вспомогательная служба, которая обеспечивает JIT-подготовку устройств для Центра Интернета вещей без необходимости вмешательства оператора. После успешной регистрации устройства подключаются непосредственно к назначенному им Центру Интернета вещей. Этот процесс называется автоматической подготовкой и обеспечивает готовую регистрацию и начальную настройку устройств.

## <a name="overview"></a>Обзор

Автоматическую подготовку Azure IoT можно разбить на три этапа.

1. **Настройка службы**. Единоразовая настройка экземпляров Центра Интернета вещей Azure и службы "Подготовка устройств к добавлению в Центр Интернета вещей", их развертывание и создание связи между ними.

   > [!NOTE]
   > Независимо от размера вашего решения Интернета вещей, даже если вы планируете поддерживать миллионы устройств, эта **настройка выполняется один раз**.

2. **Регистрация устройств**. Процесс сообщения экземпляру службы подготовки устройства об устройствах, которые попытаются зарегистрировать в будущем. Для [регистрации](concepts-service.md#enrollment) выполняется настройка сведений об удостоверении устройств в службе подготовки: индивидуальная регистрация для отдельного устройства или групповая регистрация для нескольких устройств. Идентификация основывается на [механизме аттестации](concepts-security.md#attestation-mechanism), для которого предназначено устройство. Это позволяет службе подготовки подтвердить подлинность устройства во время регистрации.

   - **Доверенный платформенный модуль**: при настройке индивидуальной регистрации удостоверение устройства основано на идентификаторе регистрации доверенного платформенного модуля и открытом ключе подтверждения. Учитывая, что доверенный платформенный модуль является [спецификацией]((https://trustedcomputinggroup.org/work-groups/trusted-platform-module/)), служба ожидает только проверку в соответствии со спецификацией, независимо от реализации доверенного платформенного модуля (аппаратной или программной). В разделе [Device provisioning: Identity attestation with TPM](https://azure.microsoft.com/blog/device-provisioning-identity-attestation-with-tpm/) (Подготовка устройств: аттестация удостоверений с помощью доверенного платформенного модуля) приведены сведения об аттестации на основе доверенного платформенного модуля. 

   - **X509**: при настройке индивидуальной или групповой регистрации удостоверение устройства основано на цифровом сертификате X.509, который передается для регистрации как PEM- или CER-файл.

   > [!IMPORTANT]  
   > Хотя это не является необходимым условием для использования служб подготовки устройств, настоятельно рекомендуется, чтобы ваше устройство использовало аппаратный модуль безопасности (HSM) для хранения конфиденциальных данных удостоверения устройства, таких как ключи и сертификаты X.509.

3. **Регистрация и настройка устройства**. Выполняется после загрузки программным обеспечением регистрации, которое создано с помощью клиентского пакета SDK службы подготовки устройств, соответствующего устройству и механизму аттестации. Это программное обеспечение устанавливает подключение к службе подготовки для аутентификации устройства и его последующей регистрации в Центре Интернета вещей. После успешной регистрации устройству предоставляется уникальный идентификатор Центра Интернета вещей и сведения о подключении, что позволяет ему извлечь начальные настройки и начать передачу данных телеметрии. В рабочих средах этот этап может начаться через несколько недель или месяцев после предыдущих двух этапов.

## <a name="roles-and-operations"></a>Роли и операции

Этапы, рассмотренные в предыдущем разделе, могут длиться несколько недель и месяцев ввиду реалий рабочих сред, в том числе времени производства, доставки, таможенных процедур и т. д. Кроме того, они охватывают действия нескольких ролей при участии различных сущностей. В этом разделе более подробно рассматриваются различные роли и операции, связанные с каждым этапом, а затем демонстрируется поток операций на блок-схеме. 

Автоматическая подготовка также накладывает требования на изготовителей устройств для обеспечения механизма аттестации. Производственные операции также могут происходить независимо от этапов автоматической подготовки, особенно в случаях, когда необходимо приобрести новые устройства после развертывания автоматической подготовки.

В оглавлении слева указан ряд кратких руководств, которые помогут понять действие автоматической подготовки на практике. Чтобы облегчить и упростить процесс обучения, используется программное обеспечение для имитации физического устройства, предназначенного для регистрации. В некоторых кратких руководствах требуется выполнять операции для нескольких ролей, включая операции для несуществующих ролей. Это связано с тем, что в этих руководствах используется имитация.

| Роль | Операция | ОПИСАНИЕ | 
|------| --------- | ------------| 
| Производитель | Кодирование идентификатора и URL-адреса регистрации | В зависимости от используемого механизма аттестации изготовитель отвечает за кодирование сведений об удостоверении устройства и URL-адреса службы подготовки устройств.<br><br>**Краткое руководство**. Так как устройство имитируется, роль изготовителя отсутствует. Ознакомьтесь с ролью разработчика, чтобы узнать, как получить эти сведения, которые используются в программировании примера приложения регистрации. |  
| | Предоставление удостоверения устройства | Являясь источником сведений об удостоверении устройства, изготовитель отвечает за их передачу оператору (или назначенному агенту) или их непосредственную регистрацию в службе подготовки устройств посредством интерфейсов API.<br><br>**Краткое руководство**. Так как устройство имитируется, роль изготовителя отсутствует. Ознакомьтесь с ролью оператора, чтобы узнать, как получить удостоверение устройства, которое используется для регистрации имитированного устройства в вашем экземпляре службы подготовки устройств. | 
| Оператор | Настройка автоматической подготовки | Эта операция соответствует первому этапу автоматической подготовки.<br><br>**Краткое руководство**. Вы выполняете роль оператора, настраивая экземпляры службы подготовки устройств и Центра Интернета вещей в своей подписке Azure. | Настройка автоматической подготовки |
|  | Регистрация удостоверения устройства | Эта операция соответствует второму этапу автоматической подготовки.<br><br>**Краткое руководство**. Вы выполняете роль оператора, регистрируя имитированное устройство в своем экземпляре службы подготовки устройств. Удостоверение устройства определяется с помощью метода аттестации, имитируемого в кратком руководстве (доверенный платформенный модуль или X.509). Чтобы узнать больше об аттестации, ознакомьтесь с ролью разработчика. | 
| Служба подготовки устройств,<br>Центр Интернета вещей | \<Все операции\> | И для производственной реализации на физических устройствах, и для кратких руководств с использованием имитированных устройств эти роли выполняются посредством служб Интернета вещей, настраиваемых в вашей подписке Azure. Роли и операции выполняются одинаково, так как для подготовки физических и имитированных устройств используются одни и те же службы Интернета вещей. | 
| Developer | Создание и развертывание программного обеспечения регистрации | Эта операция соответствует третьему этапу автоматической подготовки. Разработчик отвечает за создание и развертывание программного обеспечения регистрации на устройстве с помощью соответствующего пакета SDK.<br><br>**Краткое руководство**. Создаваемый пример приложения регистрации имитирует реальное устройство для выбранной платформы или языка, которое выполняется на вашей рабочей станции (а не развертывается на физическом устройстве). Приложение регистрации выполняет те же операции, что и приложение, развернутое на физическом устройстве. Вы задаете метод аттестации (доверенный платформенный модуль или сертификат X.509), а также URL-адрес регистрации и область идентификаторов для своего экземпляра службы подготовки устройств. Удостоверение устройства определяется логикой аттестации пакета SDK во время выполнения в зависимости от указанного метода. <ul><li>**Аттестация доверенного платформенного модуля**: на рабочей станции разработки выполняется [симулятор доверенного платформенного модуля](how-to-use-sdk-tools.md#trusted-platform-module-tpm-simulator). После его запуска используется отдельное приложение для извлечения ключа подтверждения и идентификатора регистрации доверенного платформенного модуля для регистрации удостоверения устройства. Логика аттестации пакета SDK также использует симулятор во время регистрации для предоставления маркера подписанного URL-адреса, используемого для аутентификации и проверки регистрации.</li><li>**Аттестация X509**: для [создания сертификата](how-to-use-sdk-tools.md#x509-certificate-generator) используется инструмент. После этого вы создаете файл сертификата, необходимый для регистрации. Логика аттестации пакета SDK также использует этот сертификат во время регистрации для аутентификации и проверки регистрации.</li></ul> | 
| Устройство | Загрузка и регистрация | Эта операция соответствует третьему этапу автоматической подготовки. Ее выполняет программное обеспечение регистрации устройств, созданное разработчиком. Чтобы узнать больше, ознакомьтесь с ролью разработчика. При первой загрузке выполняется следующее. <ol><li>Приложение подключается к экземпляру службы подготовки устройств в соответствии с глобальным URL-адресом и областью идентификаторов службы, указанных во время разработки.</li><li>После подключения устройство проходит аутентификацию с помощью метода аттестации и удостоверения, указанного во время регистрации.</li><li>После аутентификации устройство регистрируется в экземпляре Центра Интернета вещей, указанном экземпляром службы подготовки устройств.</li><li>После успешной регистрации в приложение регистрации передается уникальный идентификатор устройства и конечная точка Центра Интернета вещей для взаимодействия с Центром Интернета вещей.</li><li> После этого устройство может извлечь свое начальное состояние [двойника устройства](~/articles/iot-hub/iot-hub-devguide-device-twins.md) для настройки и начать передачу данных телеметрии.</li></ol>**Краткое руководство**. Так как устройство имитируется, программное обеспечение регистрации выполняется на вашей рабочей станции разработки.| 

На следующей схеме показаны роли и последовательность операций при автоматической подготовке устройства.
<br><br>
![Последовательность автоматической подготовки устройства](./media/concepts-auto-provisioning/sequence-auto-provision-device-vs.png) 

> [!NOTE]
> При необходимости изготовитель может также выполнить операцию "регистрации удостоверения устройства" с помощью интерфейсов API службы подготовки устройств (а не с помощью оператора). Подробное описание этой процедуры и многое другое можно найти в видео [Zero touch device registration with Azure IoT](https://myignite.microsoft.com/sessions/55087) (Автоматическая регистрация устройств в Azure IoT) (начиная с 41-й минуты).

## <a name="next-steps"></a>Дополнительная информация

Может быть удобно добавить эту статью в закладки, чтобы использовать при работе с соответствующими краткими руководствами по автоматической подготовке. 

Начните с краткого руководства "Настройка автоматической подготовки", которое лучше всего подходит для вашего инструмента управления. В этом руководстве описывается этап "Настройка службы":

- [Настройка автоматической подготовки с помощью Azure CLI](quick-setup-auto-provision-cli.md)
- [Настройка автоматической подготовки с помощью портала Azure](quick-setup-auto-provision.md)
- [Настройка автоматической подготовки с помощью шаблона Resource Manager](quick-setup-auto-provision-rm.md)

Затем перейдите к краткому руководству "Автоматическая подготовка имитированного устройства", подходящему для вашего механизма аттестации устройств, и выберите пакет SDK или язык для службы подготовки устройств. В этом кратком руководстве описываются этапы "Регистрация устройства" и "Регистрация и настройка устройства": 

|  | Механизм аттестации имитированного устройства | Пакет SDK или язык для краткого руководства |  |
|--|--|--|--|
|  | Доверенный платформенный модуль (TPM) | [C](quick-create-simulated-device.md)<br>[Java](quick-create-simulated-device-tpm-java.md)<br>[C#](quick-create-simulated-device-tpm-csharp.md)<br>[Python](quick-create-simulated-device-tpm-python.md) |  |
|  | Сертификат X.509 | [C](quick-create-simulated-device-x509.md)<br>[Java](quick-create-simulated-device-x509-java.md)<br>[C#](quick-create-simulated-device-x509-csharp.md)<br>[Node.js](quick-create-simulated-device-x509-node.md)<br>[Python](quick-create-simulated-device-x509-python.md) |  |




