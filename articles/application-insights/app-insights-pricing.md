---
title: "Управление ценами и объемом данных для Azure Application Insights | Документация Майкрософт"
description: "Управление объемом данных телеметрии и контроль расходов в Application Insights."
services: application-insights
documentationcenter: 
author: mrbullwinkle
manager: carmonm
ms.assetid: ebd0d843-4780-4ff3-bc68-932aa44185f6
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 05/10/2017
ms.author: mbullwin
ms.openlocfilehash: 5b3d1b9e0d176f29fbcc90410f1fe80085ec5fa8
ms.sourcegitcommit: e462e5cca2424ce36423f9eff3a0cf250ac146ad
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/01/2017
---
# <a name="manage-pricing-and-data-volume-in-application-insights"></a>Управление ценами и объемом данных в Application Insights


Цены на [Azure Application Insights][start] зависят от объема данных для каждого приложения. При низком уровне использования данных, например в процессе разработки или во время работы небольших приложений, плата может не взиматься, так как существует бесплатная квота в размере 1 ГБ для данных телеметрии.

Каждый ресурс Application Insights оплачивается как отдельная служба и включается в счет за подписку на Azure.

Доступно два тарифных плана. План по умолчанию называется базовым. При использовании корпоративного плана плата взимается на ежедневной основе, но пользователям предоставляются дополнительные возможности, такие как [непрерывный экспорт данных](app-insights-export-telemetry.md).

Если у вас возникли вопросы о принципах формирования цен на Application Insights, задайте их на нашем [форуме](https://social.msdn.microsoft.com/Forums/en-US/home?forum=ApplicationInsights). 

## <a name="the-price-plans"></a>Тарифные планы

Текущие цены в валюте вашей страны вы можете узнать на [странице цен на Application Insights][pricing].

### <a name="basic-plan"></a>План "Базовый"

План "Базовый" всегда устанавливается по умолчанию для новых ресурсов Application Insights, и его вполне достаточно для большинства пользователей.

* В рамках плана "Базовый" плата взимается в зависимости от объема данных, то есть числа байтов телеметрии, полученных службой Application Insights. Объем данных оценивается по размеру несжатых пакетов данных в формате JSON, получаемых службой Application Insights от вашего приложения.
Объем [табличных данных, импортированных в аналитику](https://docs.microsoft.com/en-us/azure/application-insights/app-insights-analytics-import), измеряется, как несжатый размер файлов, отправленных в Application Insights.  
* Для каждого приложения первый 1 ГБ предоставляется бесплатно, поэтому платить за эксперименты и процесс разработки вам, скорее всего, не придется.
* Данные [динамического потока метрик](app-insights-live-stream.md) не учитываются при расчете стоимости.
* В рамках плана "Базовый" доступен [непрерывный экспорт](app-insights-export-telemetry.md). Эта услуга повышает стоимость каждого гигабайта данных.

### <a name="enterprise-plan"></a>План "Корпоративный"

* В рамках плана "Корпоративный" ваши приложения смогут использовать все возможности Application Insights. [Непрерывный экспорт](app-insights-export-telemetry.md) и 

[соединитель Log Analytics](https://go.microsoft.com/fwlink/?LinkId=833039&amp;clcid=0x409) доступны в плане "Корпоративный" без какой-либо дополнительной платы.
* Используя план "Корпоративный", вы платите только за количество узлов, с которых данные телеметрии отправляются в приложения. 
 * *Узел* — это любой физический компьютер, виртуальная машина или экземпляр роли платформы как услуги, на котором размещено ваше приложение.
 * В число узлов не включаются компьютеры для разработки, клиентские браузеры и мобильные устройства.
 * Если приложение содержит несколько компонентов, отправляющих данные телеметрии, например веб-службу и рабочую роль сервера, такие компоненты учитываются отдельно.
 * Данные [Live Metrics Stream](app-insights-live-stream.md) не учитываются при расчете стоимости.* Сумма оплаты за подписку зависит от количества узлов, а не от количества приложений. Если вы используете пять узлов, которые отправляют телеметрию для 12 приложений, то оплата взимается за пять узлов.
* Несмотря на то что суммы в тарифах указаны за целый месяц, плата взимается только за те часы, в течение которых узел отправлял данные телеметрии из приложения. Сумма почасовой оплаты вычисляется как указанная в тарифе ежемесячная плата, разделенная на 744 (то есть на количество часов в месяце длительностью 31 день).
* Для каждого обнаруженного узла на день выделяются данные объемом 200 МБ (с детализацией по часам). Выделенные, но не использованные объемы данных не переносятся на следующий день.
 * Если вы используете тарифный план "Корпоративный", для каждой подписки ежедневно будет выделяться определенная квота на объем данных в зависимости от количества узлов, отправляющих телеметрию в ресурсы Application Insights в рамках соответствующей подписки. Например, если вы используете 5 узлов, которые круглые сутки отправляют данные, вы получите совокупную квоту в 1 ГБ на все ресурсы Application Insights в этой подписке. Неважно, какие узлы передают какой объем информации, так как включенные данные распределяются на все узлы. Если в определенный день на ресурсы Application Insights будут переданы данные в объеме, превышающем дневную квоту для этой подписки, будет взиматься плата за каждый гигабайт избыточных данных. 
 * Ежедневная квота на объем передаваемых данных вычисляется в зависимости от количества часов за соответствующий день (в формате UTC), на протяжении которых каждый узел отправлял данные телеметрии. Это количество часов делится на 24 и умножается на 200 МБ. Например, если четыре узла отправляли данные телеметрии в течение 15 часов из 24, объем включенных данных за этот день составит ((4 x 15) / 24) x 200 = 500 МБ. Если за этот день узлы отправят 1 ГБ данных, то, исходя из цены 2,30 доллара США за каждый гигабайт данных сверх квоты, плата за этот день составит 1,15 доллара США.
 * Обратите внимание, что ежедневная квота по плану "Корпоративный" не распространяется на те приложения, для которых выбран план "Базовый", а неиспользованная квота не переносится на следующие дни. 
* Ниже приведены некоторые примеры расчетов для вычисления количества узлов.
| Сценарий                               | Общее количество узлов за день |
|:---------------------------------------|:----------------:|
| 1 приложение использует 3 экземпляра службы приложений Azure и 1 виртуальный сервер. | 4. |
| 3 приложения работают на 2 виртуальных машинах, ресурсы Application Insights для этих приложений находятся в одной подписке, и для них выбран план "Корпоративный". | 2 | 
| Есть 4 приложения, ресурсы Application Insights для которых находятся в одной подписке. Для каждого приложения выполняется по 2 экземпляра в течение 16 часов с низкой нагрузкой и по 4 экземпляра в течение 8 часов максимальной нагрузки. | 13,33 | 
| Облачные службы, у которых есть по 1 рабочей роли и 1 веб-роли, каждая их которых выполняется в 2 экземплярах. | 4. | 
| В кластере Service Fabric с 5 узлами работают 50 микрослужб, для каждой из которых запущено по 3 экземпляра. | 5|

* Точные правила подсчета количества узлов зависят от того, какой пакет SDK для Application Insights использует ваше приложение. 
  * В пакете SDK версии 2.2 и более новых версий пакеты [Core SDK](https://www.nuget.org/packages/Microsoft.ApplicationInsights/) и [Web SDK](https://www.nuget.org/packages/Microsoft.ApplicationInsights.Web/) Application Insights будут считать узлами каждый узел приложения, например каждое имя компьютера для физического сервера или виртуальной машины и каждое имя экземпляра для облачных служб.  Единственным исключением будут приложения, использующие только [.NET Core](https://dotnet.github.io/) и пакет Core SDK Application Insights. В этом случае всех компьютеры считаются как один узел, так как имена узлов не используются. 
  * В более ранних версиях пакета SDK [веб-пакет SDK](https://www.nuget.org/packages/Microsoft.ApplicationInsights.Web/) ведет себя так же, как и в новых версиях, но пакет [SDK для Core](https://www.nuget.org/packages/Microsoft.ApplicationInsights/) учитывает только один узел, независимо от количества узлов приложения. 
  * Обратите внимание, что если приложение с помощью пакета SDK задает пользовательское значение для параметра roleInstance (количество экземпляров роли), то по умолчанию это же значение будет использоваться и для определения количества узлов. 
  * Если вы используете новую версию пакета SDK для приложения, которое запускается на клиентских компьютерах или мобильных устройствах, может возвращаться очень большое количество узлов (из-за большого числа клиентских компьютеров или мобильных устройств). 

### <a name="multi-step-web-tests"></a>Многошаговые веб-тесты

За [многошаговые веб-тесты](app-insights-monitor-web-app-availability.md#multi-step-web-tests) взимается дополнительная плата. Так именуются веб-тесты, в ходе которых выполняется несколько последовательных действий. 

За обычную проверку связи на одной странице отдельная плата не взимается. Объем данных, переданных в ходе простого или многошагового теста, оплачивается так же, как другие данные телеметрии из вашего приложения.
 
## <a name="operations-management-suite-subscription-entitlement"></a>Права подписки Operations Management Suite

Как [недавно было объявлено](https://blogs.technet.microsoft.com/msoms/2017/05/19/azure-application-insights-enterprise-as-part-of-operations-management-suite-subscription/), клиенты, покупающие Microsoft Operations Management Suite E1 и E2, могут получить корпоративный тарифный план Application Insights в виде дополнительного компонента без дополнительных затрат. Каждая приобретенная единица пакета Operations Management Suite E1 и E2 предоставляет право на использование одного узла Application Insights корпоративного тарифного плана. Каждый узел Application Insights корпоративного уровня включает до 200 МБ ежедневно обрабатываемых данных (отдельно от данных Log Analytics), которые хранятся в течение 90 дней. Дополнительная плата за это не взимается. 

> [!NOTE]
> Чтобы получить это право, ресурсы Application Insights должны входить в корпоративный тарифный план. Это право применяется только к узлам, поэтому, при использовании ресурсов Application Insights в базовом плане, вы не сможете воспользоваться какими-либо преимуществами. Обратите внимание, что это право не будет отображаться в расчетной стоимости в колонке "Компоненты и расценки". 
>
 
## <a name="review-pricing-plans-and-estimate-costs"></a>Просмотр тарифных планов и расчет стоимости

В Applicaition Insights легко разобраться с доступными тарифными планами и расчетной стоимостью на основе последних шаблонов использования. Откройте колонку **Компоненты и расценки** в ресурсе Application Insights на портале Azure:

![Выберите "Цены".](./media/app-insights-pricing/01-pricing.png)

**а.** Просмотрите сведения об объеме данных на месяц. К ним относятся все полученные и сохраненные данные (после любой [выборки](app-insights-sampling.md) с серверных и клиентских приложений, а также с тестов доступности).

**б.** Отдельно плата взимается за [многошаговые веб-тесты](app-insights-monitor-web-app-availability.md#multi-step-web-tests). (К ним не относятся простые тесты доступности, плата за которые взимается при выставлении счетов за используемый объем данных.)

**в.** Включите тарифный план "Корпоративный".

**г.** Пролистайте варианты управления данными, чтобы просмотреть объем данных за прошлый месяц, указать ежедневное ограничение или выборку приема.

Оплата за использование Application Insights добавляется в счет Azure. Дополнительную информацию о счете за подписку на Azure можно просмотреть в разделе выставления счетов портала Azure или на [портале выставления счетов Azure](https://account.windowsazure.com/Subscriptions). 

![В боковом меню выберите «Выставление счетов».](./media/app-insights-pricing/02-billing.png)

## <a name="data-rate"></a>Скорость передачи данных
Скорость передачи данных ограничена в трех случаях:

* **Выборка.** Эта технология уменьшает объем данных телеметрии, отправленных с серверных и клиентских приложений, с минимальным искажением метрик. Это основное средство, с помощью которого можно настроить объем данных. Дополнительные сведения см. в статье [Выборка в Application Insights](app-insights-sampling.md). 
* **Ежедневное ограничение.** При создании ресурса Application Insights на портале Azure устанавливается максимальное значение ограничения, которое составляет 500 ГБ в день. Ограничение по умолчанию при создании ресурса Application Insights в Visual Studio небольшое — всего 32,3 МБ в день. Оно предназначено для упрощения проверки. В этом случае предполагается, что пользователь будет повышать ежедневное ограничение перед развертыванием приложения в рабочую среду. Максимальное ограничение составляет 500 ГБ в день. Вы можете запросить большее ограничение для приложения с большим объемом трафика. Задавайте ежедневное ограничение внимательно. **Мы не рекомендуем достигать ограничения по ежедневному объему**, так как вы можете потерять данные за остаток дня, а также не сможете выполнить мониторинг приложения. Чтобы изменить это ограничение ежедневного объема, используйте колонку "Ограничение ежедневного объема", доступную в колонке "Управление объемом данных" (как показано ниже). Обратите внимание, что для некоторых типов подписки предусмотрен кредит, который нельзя использовать для Application Insights. Если подписка содержит предельную сумму расходов, в колонке ежедневного ограничения вы найдете инструкции по ее удалению, а также включению возможности повышения этого ограничения свыше 32,3 МБ в день.  
* **Регулирование.** Ограничивает скорость передачи данных определенным количеством событий объемом 32 КБ в секунду, с усреднением за периоды по 1 минуте. 


*Что произойдет, если приложение превысит установленную скорость регулирования?*

* Объем данных, отправляемых приложением, оценивается каждую минуту. Если он превышает среднюю минутную частоту, сервер отклоняет часть запросов. Пакет SDK создает буфер данных, а затем пытается повторно отправить их, распределяя пиковую нагрузку на интервал в несколько минут. Если приложение постоянно отправляет данные с частотой, превышающей частоту регулирования, некоторые данные будут пропущены. (Пакеты SDK для ASP.NET, Java и JavaScript пытаются повторно отправлять данные таким способом; другие пакеты SDK могут просто пропускать отрегулированные данные.) Если произошло регулирование, вы увидите соответствующее предупреждение.

*Как узнать объем данных, отправляемых приложением?*

* Откройте колонку **управления объемом данных**, чтобы увидеть диаграмму ежедневного объема данных. 
* Или же в обозревателе метрик добавьте новую диаграмму и в качестве метрики выберите **том точек данных** . Переключитесь на представление "Группировка" и сгруппируйте по **типу данных**.

## <a name="to-reduce-your-data-rate"></a>Снижение скорости передачи данных
Ниже приведены рекомендации по снижению объема данных.

* Используйте [выборку](app-insights-sampling.md). Эта технология уменьшает скорость передачи данных, не искажая значения метрик и не влияя на возможность перехода между связанными элементами в поиске. В серверных приложениях эта технология включена автоматически.
* [Ограничьте число вызовов Ajax, которые могут быть отображены](app-insights-javascript.md#detailed-configuration) на каждом представлении страницы, или отключите формирование отчетов Ajax.
* Отключите модули сбора, которые вы не используете, [отредактировав файл ApplicationInsights.config](app-insights-configuration-with-applicationinsights-config.md). Например, вы можете решить, что счетчики производительности или данные зависимостей не являются необходимыми.
* Разделите данные телеметрии, чтобы разделить ключи инструментирования. 
* Агрегируйте метрики заранее. Если в ваше приложение включены вызовы в адрес TrackMetric, вы можете снизить объем трафика путем перегрузки, которая будет получать ваши вычисления среднего значения и стандартного отклонения замеров пакетов. Кроме того, вы можете использовать [пакет предварительных статистических вычислений](https://www.myget.org/gallery/applicationinsights-sdk-labs).

## <a name="managing-the-maximum-daily-data-volume"></a>Управление максимальным ежедневным объемом данных

Ограничение ежедневного объема можно использовать для ограничения собираемых данных. Однако при достижении ограничения вся телеметрия, отправленная из приложения в течение дня, будет утеряна. Мы **не рекомендуем**, чтобы приложение достигало ограничения ежедневного объема, так как после этого вы не сможете отслеживать работоспособность и производительность приложения. 

Вместо этого используйте [выборку](app-insights-sampling.md) для настройки требуемого объема данных. Используйте ограничение ежедневного объема только в крайнем случае, если приложение начало неожиданно отправлять гораздо больше телеметрии. 

Чтобы изменить ежедневное ограничение, в разделе настроек ресурса Application Insihgts щелкните **Управление объемом данных**, а затем выберите **Ежедневное ограничение**.

![Настройка ограничения ежедневного объема данных телеметрии](./media/app-insights-pricing/daily-cap.png) 

## <a name="sampling"></a>Выборка
[Выборка](app-insights-sampling.md) позволяет уменьшить скорость отправки данных телеметрии в ваше приложение. Она позволяет искать связанные события при поиске по журналу диагностики, сохраняя правильные значения числа событий. 

Выборка — это эффективный способ сократить затраты и оставаться в пределах месячной квоты. Алгоритм выборки сохраняет связанные элементы телеметрии, поэтому, например, при использовании поиска можно найти запрос, относящийся к конкретному исключению. Алгоритм также сохраняет правильные количества, чтобы вы видели в обозревателе метрик правильные значения частоты запросов, частоты исключений и других счетчиков.

Существует несколько видов выборки.

* [Адаптивная выборка](app-insights-sampling.md) (выборка по умолчанию для пакета SDK ASP.NET), которая автоматически настраивается на объем данных телеметрии, отправляемых приложением. Она оперирует данными в пакете SDK в вашем веб-приложении, что позволяет уменьшить сетевой трафик телеметрии. 
* *Выборка приема* — это другая функция, которая работает в точке, где данные телеметрии из приложения поступают в службу Application Insights. Это не влияет на объем данных телеметрии, отправляемых из приложения, но уменьшает объем данных, сохраняемых службой. С помощью этой выборки можно уменьшить квоту, заданную для телеметрии, которая поступает из браузеров и других пакетов SDK.

Чтобы настроить выборку приема, задайте управление в колонке "Цены".

![В колонке "Quotas and pricing" (Квоты и цены) щелкните элемент "Выборки" и выберите долю выборки.](./media/app-insights-pricing/04.png)

> [!WARNING]
> В колонке "Выборка данных" отражается только значение выборки приема. В ней не отражается частота выборки, которую применяет пакет SDK для Application Insights в приложении. Если по входящей телеметрии уже сделана выборка в пакете SDK, выборка приема не применяется.
> 

Чтобы узнать фактическую частоту выборки (где бы она ни применялась), выполните такой [запрос аналитики](app-insights-analytics.md) :

    requests | where timestamp > ago(1d)
    | summarize 100/avg(itemCount) by bin(timestamp, 1h) 
    | render areachart 

Для каждой сохранившейся записи `itemCount` обозначает число исходных записей, которые эта запись представляет (1 + число предыдущих удаленных записей). 


## <a name="automation"></a>Автоматизация

Можно написать сценарий для настройки тарифного плана с помощью управления ресурсами Azure. [Подробнее](app-insights-powershell.md#price).

## <a name="limits-summary"></a>Сводная таблица ограничений
[!INCLUDE [application-insights-limits](../../includes/application-insights-limits.md)]

## <a name="next-steps"></a>Дальнейшие действия

* [Выборка](app-insights-sampling.md)

<!--Link references-->

[api]: app-insights-api-custom-events-metrics.md
[apiproperties]: app-insights-api-custom-events-metrics.md#properties
[start]: app-insights-overview.md
[pricing]: http://azure.microsoft.com/pricing/details/application-insights/

