---
title: Использование аналитики — мощного инструмента поиска Azure Application Insights | Документация Майкрософт
description: 'Использование аналитики — эффективного инструмента поиска по журналу диагностики Application Insights. '
services: application-insights
documentationcenter: ''
author: mrbullwinkle
manager: carmonm
ms.assetid: c3b34430-f592-4c32-b900-e9f50ca096b3
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: conceptual
ms.date: 03/14/2017
ms.reviewer: danha
ms.author: mbullwin
ms.openlocfilehash: 7f8f49cf88bda8e485d2365281c13680ef796196
ms.sourcegitcommit: 6f6d073930203ec977f5c283358a19a2f39872af
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "35295525"
---
# <a name="using-analytics-in-application-insights"></a>Использование аналитики в Application Insights
[Аналитика](app-insights-analytics.md) — это мощный инструмент поиска [Application Insights](app-insights-overview.md). На этих страницах описан язык запросов Log Analytics.

* **[Просмотрите видео с вводной информацией](https://applicationanalytics-media.azureedge.net/home_page_video.mp4)**.
* **[Протестируйте аналитику на смоделированных данных](https://analytics.applicationinsights.io/demo)**, если ваше приложение еще не отправляет данные в Application Insights.

## <a name="open-analytics"></a>Открытие аналитики
В домашнем ресурсе вашего приложения в Application Insights щелкните "Аналитика".

![На сайте portal.azure.com откройте ресурс Application Insights и щелкните "Аналитика".](./media/app-insights-analytics-using/001.png)

Во встроенном руководстве представлены некоторые сведения о доступных возможностях.

Смотрите [исчерпывающий обзор здесь](app-insights-analytics-tour.md).

## <a name="query-your-telemetry"></a>Запрос данных телеметрии
### <a name="write-a-query"></a>Напишите запрос
![Отображение схемы](./media/app-insights-analytics-using/150.png)

Начните с имен таблиц, перечисленных в левой части окна (либо с операторов [range](https://docs.loganalytics.io/docs/Language-Reference/Tabular-operators/range-operator) или [union](https://docs.loganalytics.io/docs/Language-Reference/Tabular-operators/union-operator)). Используйте `|` для создания конвейера [операторов](https://docs.loganalytics.io/docs/Learn/References/Useful-operators). 

IntelliSense подскажет вам операторы и элементы выражений, которые можно использовать. Щелкните значок сведений (или нажмите клавиши CTRL+ПРОБЕЛ), чтобы получить более подробное описание и примеры использования каждого элемента.

Ознакомьтесь с [обзором языка аналитики](app-insights-analytics-tour.md) и [справочником по языку](app-insights-analytics-reference.md).

### <a name="run-a-query"></a>Выполнение запроса
![Выполнение запроса](./media/app-insights-analytics-using/130.png)

1. В запросе можно использовать только однократные разрывы строк.
2. Поместите курсор внутри или в конце запроса, который необходимо выполнить.
3. Проверьте диапазон времени своего запроса. (Его можно изменить или переопределить, добавив в запрос собственное предложение [`where...timestamp...`](https://docs.loganalytics.io/docs/Learn/Tutorials/Date-and-time-operations).)
3. Щелкните "Начать", чтобы выполнить запрос.
4. Не помещайте в запрос пустые строки. На одной вкладке запроса можно хранить несколько отдельных запросов, разделив их пустыми строками. Выполняется только запрос с курсором.

### <a name="save-a-query"></a>Сохранение запроса
![Сохранение запроса](./media/app-insights-analytics-using/140.png)

1. Сохраните файл текущего запроса.
2. Откройте сохраненный файл запроса.
3. Создайте новый файл запроса.

## <a name="see-the-details"></a>Просмотр подробных сведений
Чтобы просмотреть полный список свойств какой-либо строки, разверните ее в результатах. Можно также развернуть любое свойство, которое представляет собой структурированное значение, например пользовательские измерения или список стеков в исключении.

![Развертывание строки](./media/app-insights-analytics-using/070.png)

## <a name="arrange-the-results"></a>Упорядочение результатов
Результаты, возвращаемые из запроса, можно сортировать, фильтровать, разбивать на страницы и группировать.

> [!NOTE]
> При сортировке, группировании и фильтрации в браузере запрос не выполняется повторно. При этом только переупорядочиваются результаты, возвращенные последним запросом. 
> 
> Чтобы выполнить эти задачи на сервере до возвращения результатов, создайте запрос с операторами [sort](https://docs.loganalytics.io/docs/Language-Reference/Tabular-operators/sort-operator), [summarize](https://docs.loganalytics.io/docs/Language-Reference/Tabular-operators/summarize-operator) и [where](https://docs.loganalytics.io/docs/Language-Reference/Tabular-operators/where-operator).
> 
> 

Выберите столбцы, которые необходимо просмотреть. Чтобы переупорядочить столбцы, необходимо перетащить их заголовки, а чтобы изменить их размер — перетащить их границы.

![Упорядочивание столбцов](./media/app-insights-analytics-using/030.png)

### <a name="sort-and-filter-items"></a>Сортировка и фильтрация элементов
Чтобы отсортировать результаты, щелкните заголовок столбца. Щелкните еще раз, чтобы отсортировать в другом направлении, и третий раз, чтобы восстановить исходный порядок, возвращенный запросом.

С помощью значка фильтра можно сузить область поиска.

![Сортировка и фильтрация столбцов](./media/app-insights-analytics-using/040.png)

### <a name="group-items"></a>Группирование элементов
Чтобы отсортировать по нескольким столбцам, можно использовать группирование. Сначала активируйте эту функцию, а затем перетащите заголовки столбцов в область над таблицей.

![Группа](./media/app-insights-analytics-using/060.png)

### <a name="missing-some-results"></a>Если некоторые результаты отсутствуют

Если вы считаете, что отображены не все ожидаемые результаты, этому может быть несколько причин.

* **Фильтр диапазона времени**. По умолчанию вы увидите только результаты за последние 24 часа. Существует автоматический фильтр, который ограничивает диапазон результатов, полученных из исходных таблиц. 

    Тем не менее можно изменить фильтр диапазона времени, воспользовавшись раскрывающимся меню.

    Или можно переопределить автоматический диапазон, добавив в запрос собственное [предложение `where  ... timestamp ...`](https://docs.loganalytics.io/docs/Language-Reference/Tabular-operators/where-operator). Например: 

    `requests | where timestamp > ago('2d')`

* **Ограничение результатов**. В результатах, возвращаемых с портала, есть ограничение в 10 тысяч строк. Если вы превысите его, появится предупреждение. В этом случае при сортировке результатов в таблице не всегда будут представлены все первые или последние результаты. 

    Рекомендуется избегать превышения ограничения. Используйте фильтр диапазона времени или операторы, в том числе следующие:

  * [top 100 by timestamp;](https://docs.loganalytics.io/docs/Language-Reference/Tabular-operators/top-operator) 
  * [take 100;](https://docs.loganalytics.io/docs/Language-Reference/Tabular-operators/take-operator)
  * [summarize ](https://docs.loganalytics.io/docs/Language-Reference/Tabular-operators/summarize-operator) 
  * [where timestamp > ago(3d)](https://docs.loganalytics.io/docs/Language-Reference/Tabular-operators/where-operator)

(Требуется более 10 тысяч строк? Рассмотрите возможность использования [непрерывного экспорта](app-insights-export-telemetry.md). Аналитика предназначена для анализа, а не получения необработанных данных.)

## <a name="diagrams"></a>Схемы
Выберите тип схемы, которая вам нужна:

![Выберите тип диаграммы](./media/app-insights-analytics-using/230.png)

Если у вас несколько столбцов правильных типов, можно выбрать оси X и Y, а также столбец измерений, чтобы разделить по ним результаты.

По умолчанию результаты изначально отображаются в виде таблицы, а схему вы выбираете вручную. В конце запроса можно также использовать [директиву render](https://docs.loganalytics.io/docs/Language-Reference/Tabular-operators/render-operator) , чтобы выбрать диаграмму.

### <a name="analytics-diagnostics"></a>Диагностика аналитики


Если на временной диаграмме есть внезапный пик или шаг в данных, то вы можете видеть на линии выделенную точку. Это указывает на то, что диагностика аналитики выявила сочетание свойств, которое отфильтровывает внезапные изменения. Щелкните данную точку, чтобы узнать больше о фильтре и просмотреть отфильтрованную версию. Эти сведения могут помочь определить причину изменения. 

[Диагностика внезапных изменений в телеметрии приложения](app-insights-analytics-diagnostics.md)


![Диагностика аналитики](./media/app-insights-analytics-using/analytics-diagnostics.png)

## <a name="pin-to-dashboard"></a>Закрепить на панели мониторинга
Вы можете закрепить диаграмму или таблицу на одной из [общих панелей мониторинга](app-insights-dashboards.md). Для этого просто щелкните значок булавки. 

![Щелкните значок булавки](./media/app-insights-analytics-using/pin-01.png)

Это означает, что при сборке панели мониторинга для отслеживания производительности или использования веб-служб наряду с другими метриками можно включить довольно сложный анализ. 

Если таблица содержит четыре столбца или меньше, вы можете закрепить ее на панели мониторинга. Отображаются только семь верхних строк.

### <a name="dashboard-refresh"></a>Обновление панели мониторинга
Диаграмма, закрепленная на панели мониторинга, обновляется автоматически при повторном выполнении запроса приблизительно каждый час. Вы также можете нажать кнопку "Обновить".

### <a name="automatic-simplifications"></a>Автоматические упрощения

При закреплении на панели мониторинга к диаграмме применяются определенные упрощения.

**Ограничение времени:** автоматически отображаются запросы только за последние 14 дней. Тот же эффект достигается добавлением в запрос `where timestamp > ago(14d)`.

**Ограничение количества ячеек:** если отображается диаграмма, содержащая много отдельных ячеек (как правило, линейчатая диаграмма), менее заполненные ячейки автоматически группируются в одну ячейку под названием "Другие". Например, запрос

    requests | summarize count_search = count() by client_CountryOrRegion

в аналитике выглядит следующим образом:

![Диаграмма с длинным "хвостом"](./media/app-insights-analytics-using/pin-07.png)

Но если закрепить его на панели мониторинга, он будет выглядеть так:

![Диаграмма с ограниченным количеством ячеек](./media/app-insights-analytics-using/pin-08.png)

## <a name="export-to-excel"></a>Экспорт в Excel
После выполнения запроса можно скачать CSV-файл. Щелкните **"Экспорт", Excel**.

## <a name="export-to-power-bi"></a>Экспорт в Power BI
Поместите курсор в запрос и выберите **"Экспорт", Power BI**.

![Экспорт из Log Analytics в Power BI](./media/app-insights-analytics-using/240.png)

Выполните запрос в Power BI. Вы можете задать обновление запроса по расписанию.

С помощью Power BI вы можете создавать панели мониторинга, объединяющие данные из разных источников.

[Использование данных Application Insights в Power BI](app-insights-export-power-bi.md)

## <a name="deep-link"></a>Прямая ссылка

Получите ссылку в разделе **"Экспорт", "Поделиться ссылкой"**, которую можно отправить другому пользователю. Если у пользователя есть [доступ к группе ресурсов](app-insights-resources-roles-access-control.md), запрос откроется в пользовательском интерфейсе раздела аналитики.

(В ссылке текст запроса в формате GZIP и в кодировке Base-64 отображается после "?q=". Вы можете написать код, чтобы создать прямые ссылки, которые можно предоставить пользователям. Тем не менее, мы рекомендуем запускать аналитику из кода с помощью [REST API](https://dev.applicationinsights.io/).)


## <a name="automation"></a>Служба автоматизации

Используйте [REST API доступа к данным](https://dev.applicationinsights.io/) для выполнения запросов аналитики. [Пример](https://dev.applicationinsights.io/apiexplorer/query?appId=DEMO_APP&apiKey=DEMO_KEY&query=requests%0A%7C%20where%20timestamp%20%3E%3D%20ago%2824h%29%0A%7C%20count) (использование PowerShell):

```PS
curl "https://api.applicationinsights.io/beta/apps/DEMO_APP/query?query=requests%7C%20where%20timestamp%20%3E%3D%20ago(24h)%7C%20count" -H "x-api-key: DEMO_KEY"
```

В отличие от пользовательского интерфейса аналитики REST API не добавляет ограничения по меткам времени для запросов автоматически. Чтобы не получать объемные ответы, обязательно добавляйте собственные предложения where.



## <a name="import-data"></a>Импорт данных

Можно импортировать данные из CSV-файла. Обычно это используется для импорта статических данных, которые можно объединить с таблицами из данных телеметрии. 

Например, если аутентифицированные пользователи идентифицируются в данных телеметрии по псевдониму или скрываемому идентификатору, то можно импортировать таблицу, которая позволяет сопоставить псевдонимы с настоящими именами. В результате объединения данных телеметрии запросов пользователей в отчетах аналитики можно будет идентифицировать по их настоящим именам.

### <a name="define-your-data-schema"></a>Определение схемы данных

1. Щелкните **Параметры** (в верхнем левом углу) и выберите **Источники данных**. 
2. Добавьте источник данных, следуя инструкциям. Вам будет предложено указать пример данных, который должен содержать по крайней мере десять строк. После этого можно исправить схему.

Она определяет источник данных, который затем можно будет использовать для импорта отдельных таблиц.

### <a name="import-a-table"></a>Импорт таблицы

1. Откройте определение источника данных из списка.
2. Щелкните "Отправить" и следуйте инструкциям по передаче таблицы. Данный процесс подразумевает вызов REST API, поэтому этот его очень легко автоматизировать. 

Таблица теперь доступна для использования в запросах аналитики. Она будет отображаться в Аналитике. 

### <a name="use-the-table"></a>Использование таблицы

Предположим, что определение источника данных называется `usermap` и содержит два поля, `realName` и `user_AuthenticatedId`. В таблице `requests` также есть поле `user_AuthenticatedId`, так что их легко объединить.

```AIQL

    requests
    | where notempty(user_AuthenticatedId) | take 10
    | join kind=leftouter ( usermap ) on user_AuthenticatedId 
```
Результирующая таблица запросов содержит дополнительный столбец, `realName`.

### <a name="import-from-logstash"></a>Импорт из LogStash

Если вы используете [LogStash](https://www.elastic.co/guide/en/logstash/current/getting-started-with-logstash.html), то можете использовать Аналитику для запроса журналов. Используйте [подключаемый модуль, который передает данные в Аналитику](https://github.com/Microsoft/logstash-output-application-insights). 

## <a name="video"></a>Видео

> [!VIDEO https://channel9.msdn.com/events/Connect/2016/123/player] 

[!INCLUDE [app-insights-analytics-footer](../../includes/app-insights-analytics-footer.md)]

