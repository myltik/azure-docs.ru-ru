---
title: Интеллектуальное обнаружение аномальных сбоев в Application Insights | Документация Майкрософт
description: Оповещает о необычных изменениях в частоте неудачных запросов для веб-приложения, а также выполняет диагностический анализ. Настройка не требуется.
services: application-insights
documentationcenter: ''
author: mrbullwinkle
manager: carmonm
ms.assetid: ea2a28ed-4cd9-4006-bd5a-d4c76f4ec20b
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 01/09/2017
ms.author: mbullwin; yossiy
ms.openlocfilehash: 29ae81551d4bd4be4123c8e7780b8b5ecc259f09
ms.sourcegitcommit: 870d372785ffa8ca46346f4dfe215f245931dae1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/08/2018
---
# <a name="smart-detection---failure-anomalies"></a>Интеллектуальное обнаружение аномальных сбоев
[Application Insights](app-insights-overview.md) автоматически уведомляет вас (почти в реальном времени), когда работа веб-приложения сопровождается чрезмерно частыми неудачно завершенными запросами. Эта служба обнаруживает необычное увеличение числа невыполненных HTTP-запросов или вызовов зависимостей. Невыполненными обычно считаются запросы с кодом ответа 400 или больше. Для того чтобы вам было проще определить и диагностировать проблему, в уведомление включается анализ характеристик сбоев и соответствующие данные телеметрии. Кроме того, даются ссылки на портал Application Insights для дальнейшей диагностики. Эта функция не требует настройки, так как использует алгоритмы машинного обучения для прогнозирования нормальной частоты невыполненных запросов.

Эта функция работает для веб-приложений Java и ASP.NET, размещенных в облаке или на ваших серверах. Она также работает для любого приложения, создающего данные телеметрии запросов или зависимостей (например, при наличии рабочей роли, вызывающей [TrackRequest()](app-insights-api-custom-events-metrics.md#trackrequest) или [TrackDependency()](app-insights-api-custom-events-metrics.md#trackdependency)).

Если пакет [Application Insights настроен для вашего проекта](app-insights-overview.md), а ваше приложение создает минимальный объем данных телеметрии, то системе интеллектуального обнаружения аномальных сбоев необходимо 24 часа, чтобы изучить нормальное поведение приложения. Затем система включается и может отправлять оповещения.

Вот пример оповещения.

![Пример оповещения системы интеллектуального обнаружения, содержащий связанный анализ кластера после сбоя](./media/app-insights-proactive-failure-diagnostics/013.png)

> [!NOTE]
> По умолчанию приходит более краткое сообщение, чем в этом примере. Но можно [переключиться на этот подробный формат](#configure-alerts).
>
>

Обратите внимание на то, что оно содержит:

* Количество сбоев по сравнению с обычным поведением приложения.
* Число затронутых пользователей, чтобы вы знали, насколько сильно следует беспокоиться.
* Шаблон характеристик, связанный с ошибками. В этом примере имеются конкретный код ошибки, имя запроса (операция) и версия приложения. Это позволяет сразу же определить фрагмент кода, с которого следует начать поиск. К другим возможностям может относиться определенный тип браузера или клиентской операционной системы.
* Исключения, трассировки журналов и сбои в зависимостях (базах данных или других внешних компонентах), которые могут быть связаны с описанными ошибками.
* Прямые ссылки на соответствующие поиски телеметрии в Application Insights.

## <a name="benefits-of-smart-detection"></a>Преимущества интеллектуального обнаружения
Обычные [оповещения метрик](app-insights-alerts.md) сообщают о возможном наличии проблемы. Однако система интеллектуального обнаружения начинает самостоятельно осуществлять диагностику, выполняя множество операций анализа, которые в противном случае вам пришлось бы проводить самостоятельно. Вы получаете тщательно подобранные результаты, что помогает быстро выявить первопричину проблемы.

## <a name="how-it-works"></a>Принцип работы
Система интеллектуального обнаружения отслеживает поступающие из вашего приложения данные телеметрии, а именно частоту сбоев. Это правило подсчитывает число запросов, для которых свойство `Successful request` имеет значение false, и количество вызовов зависимостей, для которых свойство `Successful call` имеет значение false. По умолчанию для запросов `Successful request == (resultCode < 400)` (если вы не написали пользовательский код для [фильтрации](app-insights-api-filtering-sampling.md#filtering) или создания собственных вызовов [TrackRequest](app-insights-api-custom-events-metrics.md#trackrequest)). 

Производительность вашего приложения обладает типичным шаблоном поведения. Одни запросы или вызовы зависимостей будут более подвержены сбоям, чем другие, а общий процент сбоев может возрастать при увеличении нагрузки. Для выявления таких аномалий система интеллектуального обнаружения использует машинное обучение.

Так как данные телеметрии поступают в Application Insights из веб-приложения, система интеллектуального обнаружения сравнивает текущее поведение с шаблонами, зарегистрированными за последние несколько дней. Если по сравнению с предыдущими показателями производительности наблюдается чрезмерное увеличение частоты отказов, запускается анализ.

При запуске анализа служба анализирует кластер по неудачному запросу, чтобы попытаться определить шаблон значений, который характеризует отказы. В приведенном выше примере анализ обнаружил, что большинство сбоев связаны с конкретным кодом ошибки, именем запроса, URL-адресом сервера и экземпляром роли. Анализ также обнаружил, что свойство операционной системы клиента распределено по нескольким значениям, и поэтому его нет в списке.

Если ваша служба инструментирована для использования этих вызовов телеметрии, то анализатор находит исключение и ошибку зависимости, связанные с запросами в выявленном кластере, а также примеры журналов трассировки, связанных с такими запросами.

Результат анализа отправляется в виде оповещения, если в настройках не указан иной способ.

Как и в случае [оповещений, настраиваемых вручную](app-insights-alerts.md), вы можете проверить состояние оповещения и настроить его в соответствующей колонке ресурса Application Insights. В отличие от других оповещений, здесь не требуется настройка интеллектуального обнаружения. При желании адреса электронной почты для отправки оповещений можно отключить или изменить.

## <a name="configure-alerts"></a>Настройка оповещений
Вы можете отключить интеллектуальное обнаружение, изменить получателей электронных сообщений, создать веб-перехватчик или предоставить согласие на получение более подробных оповещений.

Откройте страницу "Оповещения". Аномальные сбои входят в список оповещений, которые вы настроили вручную. Здесь можно увидеть его текущее состояние.

![На странице "Обзор" щелкните плитку оповещения. Либо на любой странице метрики нажмите кнопку "Оповещения".](./media/app-insights-proactive-failure-diagnostics/021.png)

Щелкните оповещение, чтобы его настроить.

![Параметр Configuration](./media/app-insights-proactive-failure-diagnostics/032.png)

Обратите внимание, что систему интеллектуального обнаружения можно отключить, но нельзя удалить (или создать еще одну).

#### <a name="detailed-alerts"></a>Подробные оповещения
Если установить флажок "Get more detailed diagnostics" (Получать более подробные диагностические данные), то электронное сообщение будет содержать дополнительные диагностические сведения. Иногда удается диагностировать проблему на основе только данных в сообщении электронной почты.

Существует небольшой риск, что более подробное оповещение может содержать конфиденциальные сведения, поскольку оно включает сообщения об исключениях и трассировке. Тем не менее это может произойти, только если код допускает передачу конфиденциальных сведений в эти сообщения.

## <a name="triaging-and-diagnosing-an-alert"></a>Рассмотрение и диагностика оповещения
Оповещение означает, что обнаружен чрезмерный рост частоты невыполненных запросов. Скорее всего, проблема возникла в приложении или его среде.

В зависимости от процента запросов и числа вовлеченных пользователей вы можете решить, насколько срочно необходимо решить проблему. В приведенном выше примере доля невыполненных запросов (22,5 %) сравнивается с нормальным показателем (1 %), из чего очевидно наличие проблемы. С другой стороны, это затронуло только 11 пользователей. Если это было ваше приложение, вы сможете оценить серьезность ситуации.

Зачастую проблему можно быстро диагностировать по имени запроса, исключениям, зависимостям и другим данным трассировки.

Существуют и некоторые другие признаки. Например, процент сбоев зависимостей в этом примере совпадает с процентом исключений (89,3 %). Из этого можно предположить, что исключение возникает непосредственно при сбое зависимости, что позволяет точно определить фрагмент кода, с которого следует начать проверку.

Для дальнейшего изучения воспользуйтесь ссылками в каждом разделе, которые укажут на [страницу поиска](app-insights-diagnostic-search.md) , относящуюся к соответствующим запросам, исключениям, зависимостям или трассировкам. Вы также можете открыть [портал Azure](https://portal.azure.com), выбрав ресурс Application Insights для своего приложения и открыв колонку "Сбои".

В этом примере щелчок ссылки "View dependency failures details" (Просмотр сведений о сбоях зависимостей) открывает колонку поиска Application Insights. В ней отображается инструкции SQL, которая содержит пример первопричины: обязательные поля содержали значения NULL и не прошли проверку при операции сохранения.

![Поиск по журналу диагностики](./media/app-insights-proactive-failure-diagnostics/051.png)

## <a name="review-recent-alerts"></a>Просмотр последних оповещений

Щелкните **Интеллектуальное обнаружение**, чтобы быстро перейти к последнему оповещению.

![Общие данные оповещения](./media/app-insights-proactive-failure-diagnostics/070.png)


## <a name="whats-the-difference-"></a>В чем разница?
Интеллектуальное обнаружение аномальных сбоев дополняет другие похожие компоненты Application Insights.

* [Оповещения метрик](app-insights-alerts.md) задаются пользователем и позволяют отслеживать самые разные метрики, включая нагрузку на ЦП, частоту запросов, время загрузки страниц и т. д. Их можно использовать, например, для того, чтобы добавить ресурсы. А интеллектуальное обнаружение аномальных сбоев, напротив, охватывает небольшой диапазон критически важных метрик (сейчас — только частоту неудачно выполненных запросов), почти в реальном времени оповещая вас о том, что частота неудачно выполненных запросов к веб-приложению намного превышает нормальный для веб-приложения уровень.

    Система интеллектуального обнаружения автоматически корректирует пороговое значение в соответствии с преобладающими условиями.

    Она начинает выполнять диагностику за вас.
* [Система интеллектуального обнаружение аномалий производительности](app-insights-proactive-performance-diagnostics.md) использует искусственный интеллект для обнаружения необычного поведения ваших метрик без необходимости в настройке. В отличие от интеллектуального обнаружения аномальных сбоев, эта функция предназначена для поиска плохо обслуживаемых сегментов вашей системы (например, определенных страниц в определенном типе браузера). Анализ выполняется ежедневно, и обнаруженные результаты обычно не требуют таких срочных действий, как оповещения. Анализ аномальных сбоев, напротив, выполняется непрерывно на основе всех поступающих данных телеметрии. Если частота сбоев сервера превысит ожидаемое значение, вы получите оповещение в течение нескольких минут.

## <a name="if-you-receive-a-smart-detection-alert"></a>При возникновении оповещения интеллектуального обнаружения
*Почему мне направлено это предупреждение?*

* Мы обнаружили аномальное увеличение количества неудачных запросов по сравнению с обычными показателями за предыдущий период. После анализа сбоев и соответствующей телеметрии мы считаем, что возникла проблема, которую необходимо решить.

*Уведомление означает, что определенно возникла какая-то неполадка?*

* Мы оповещать о нарушении или ухудшении работы приложения, однако только вы имеете полное представление о семантике и влиянии на приложение или пользователей.

*Это означает, что вы отслеживаете мои данные?*

* Нет. Служба работает полностью в автоматическом режиме. Уведомления получаете только вы. Ваши данные остаются [конфиденциальными](app-insights-data-retention-privacy.md).

*Нужно ли мне подписаться на это оповещение?*

* Нет. У каждого приложения, которое отправляет данные телеметрии запросов, имеется правило генерации оповещений интеллектуального обнаружения.

*Можно отменить подписку или настроить пересылку уведомлений моим коллегам?*

* Да, в области "Правила генерации оповещений" щелкните правило интеллектуального обнаружения, чтобы настроить его. Вы можете отключить это оповещение или изменить его получателей.

*Не могу найти письмо. Где найти уведомления на портале?*

* В журналах действий. В Azure откройте ресурс Application Insights для своего приложения и выберите "Журналы действий".

*Некоторые оповещения относятся к известным проблемам, и я не хочу получать их.*

* У нас в планах есть функция подавления оповещений.

## <a name="next-steps"></a>Дополнительная информация
Эти диагностические средства позволяют проверять данные телеметрии из приложения:

* [Обозреватель метрик](app-insights-metrics-explorer.md)
* [Обозреватель поиска](app-insights-diagnostic-search.md)
* [Аналитика, мощный язык запросов](app-insights-analytics-tour.md)

Интеллектуальное обнаружение — это полностью автоматическая функция, но, возможно, вам потребуется настроить некоторые дополнительные оповещения.

* [Настройка оповещений в Application Insights](app-insights-alerts.md)
* [Доступность веб-тестов](app-insights-monitor-web-app-availability.md)
