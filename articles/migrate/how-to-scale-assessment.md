---
title: Масштабирование обнаружения и оценки с помощью службы "Миграция Azure" | Документация Майкрософт
description: В этой статье описывается, как оценить большое число локальных компьютеров с помощью службы "Миграция Azure".
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: article
ms.date: 01/08/2018
ms.author: raynew
ms.openlocfilehash: 934f32228d2c37db58c52cf4820ccc331fccd1d3
ms.sourcegitcommit: 5b2ac9e6d8539c11ab0891b686b8afa12441a8f3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
# <a name="discover-and-assess-a-large-vmware-environment"></a>Обнаружение и оценка крупной среды VMware

В этой статье описывается, как оценить большое число локальных виртуальных машин с помощью службы [Миграция Azure](migrate-overview.md). Служба "Миграция Azure" оценивает виртуальные машины, чтобы проверить, подходят ли они для миграции в Azure. Она предоставляет оценки размера и стоимости выполнения машин в Azure.

## <a name="prerequisites"></a>предварительным требованиям

- **VMware.** Управление виртуальными машинами, которые планируется перенести, должно осуществляться с помощью vCenter Server версии 5.5, 6.0 или 6.5. Кроме того, для развертывания виртуальной машины сборщика необходим один узел ESXi версии 5.0 или более поздней.
- **Учетная запись vCenter.** Для доступа к vCenter Server требуется учетная запись, предназначенная только для чтения. Служба "Миграция Azure" использует эту учетную запись для обнаружения локальных виртуальных машин.
- **Разрешения.** На сервере vCenter Server вам потребуется разрешение для создания виртуальной машины путем импорта OVA-файла.
- **Параметры статистики.** Перед началом развертывания для сервера vCenter Server нужно задать параметры статистики уровня 3. Если уровень ниже 3, оценка будет работать, но данные о производительности хранилища и сети не будут собираться. В этом случае рекомендации по размеру будут основаны на данных производительности ЦП и памяти, а также на данных конфигурации диска и сетевых адаптеров.

## <a name="plan-azure-migrate-projects"></a>Планирование проектов службы "Миграция Azure"

Планируйте обнаружение и оценку с учетом следующих ограничений:

| **Сущность** | **Предельное число виртуальных машин** |
| ---------- | ----------------- |
| Project    | 1500             |
| Обнаружение  | 1500             |
| Оценка | 1500             |

<!-- 
- If you have fewer than 400 machines to discover and assess, you need a single project and a single discovery. Depending on your requirements, you can either assess all the machines in a single assessment or split the machines into multiple assessments. 
- If you have 400 to 1,000 machines to discover, you need a single project with a single discovery. But you will need multiple assessments to assess these machines, because a single assessment can hold up to 400 machines.
- If you have 1,001 to 1,500 machines, you need a single project with two discoveries in it.
- If you have more than 1,500 machines, you need to create multiple projects, and perform multiple discoveries, according to your requirements. For example:
    - If you have 3,000 machines, you can set up two projects with two discoveries, or three projects with a single discovery.
    - If you have 5,000 machines, you can set up four projects: three with a discovery of 1,500 machines, and one with a discovery of 500 machines. Alternatively, you can set up five projects with a single discovery in each one. 
      -->

## <a name="plan-multiple-discoveries"></a>Планирование нескольких операций обнаружения

Для выполнения нескольких операций обнаружения в одном или нескольких проектах можно использовать один и тот же сборщик службы "Миграция Azure". При планировании учитывайте следующие особенности:

- При выполнении операции обнаружения с использованием сборщика службы "Миграция Azure" можно задать для области обнаружения папку, центр данных, кластер или узел vCenter Server.
- Чтобы выполнить несколько обнаружений в vCenter Server, убедитесь, что виртуальные машины, которые нужно обнаружить, размещены в папках, центрах обработки данных, кластерах или на узлах, поддерживающих ограничение в 1500 компьютеров.
- В целях оценки рекомендуется размещать взаимозависимые компьютеры в рамках одного проекта и оценки. В vCenter Server убедитесь, что зависимые компьютеры находятся в одной папке, центре обработки данных или кластере, предназначенном для оценки.


## <a name="create-a-project"></a>Создание проекта

Создайте проект службы "Миграция Azure" в соответствии со своими требованиями.

1. На портале Azure выберите **Создать ресурс**.
2. Выполните поиск по фразе **Миграция Azure** и в результатах поиска выберите службу **Azure Migrate (preview)** (Миграция Azure (предварительная версия)). Щелкните **Создать**.
3. Укажите имя проекта и подписку Azure для него.
4. Создайте новую группу ресурсов.
5. Укажите расположение, в котором нужно создать проект, а затем выберите **Создать**. Обратите внимание, что виртуальные машины с другим целевым расположением по-прежнему можно оценить. Метаданные, собранные из локальных виртуальных машин, хранятся в расположении, которое задано для проекта.

## <a name="set-up-the-collector-appliance"></a>Настройка модуля сборщика

Служба "Миграция Azure" создает локальную виртуальную машину, известную как модуль сборщика. Эта виртуальная машина обнаруживает локальные виртуальные машины VMware, отправляет в службу "Миграция Azure" метаданные о них. Чтобы настроить модуль сборщика, скачайте OVA-файл и импортируйте его на локальный экземпляр vCenter Server.

### <a name="download-the-collector-appliance"></a>Скачивание модуля сборщика

Если у вас есть несколько проектов, то модуль сборщика для vCenter Server необходимо скачать только один раз. После скачивания и установки модуля запустите его для каждого проекта, указав уникальный идентификатор и ключ проекта.

1. В проекте службы "Миграция Azure" выберите **Начало работы** > **Обнаружение и оценка** > **Обнаружение компьютеров**.
2. В окне **Обнаружение компьютеров** выберите **Скачать**, чтобы скачать OVA-файл.
3. В окне **Копирование учетных данных проекта** скопируйте идентификатор и ключ для проекта. Они потребуются при настройке сборщика.


### <a name="verify-the-collector-appliance"></a>Проверка модуля сборщика

Прежде чем развертывать OVA-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.

2. Выполните следующую команду, чтобы создать хэш OVA-файла.

   ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```

   Пример использования: ```C:\>CertUtil -HashFile C:\AzureMigrate\AzureMigrate.ova SHA256```

3. Убедитесь, что созданный хэш соответствует следующим параметрам.

    Для OVA-файла версии 1.0.9.7

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | d5b6a03701203ff556fa78694d6d7c35
    SHA1 | f039feaa10dccd811c3d22d9a59fb83d0b01151e
    SHA256 | e5e997c003e29036f62bf3fdce96acd4a271799211a84b34b35dfd290e9bea9c

    Для OVA-файла версии 1.0.9.5

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | fb11ca234ed1f779a61fbb8439d82969
    SHA1 | 5bee071a6334b6a46226ec417f0d2c494709a42e
    SHA256 | b92ad637e7f522c1d7385b009e7d20904b7b9c28d6f1592e8a14d88fbdd3241c  

    Для OVA-файла версии 1.0.9.2

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | 7326020e3b83f225b794920b7cb421fc
    SHA1 | a2d8d496fdca4bd36bfa11ddf460602fa90e30be
    SHA256 | f3d9809dd977c689dda1e482324ecd3da0a6a9a74116c1b22710acc19bea7bb2  

    Для OVA-файла версии 1.0.8.59

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | 71139e24a532ca67669260b3062c3dad
    SHA1 | 1bdf0666b3c9c9a97a07255743d7c4a2f06d665e
    SHA256 | 6b886d23b24c543f8fc92ff8426cd782a77efb37750afac397591bda1eab8656  

    Для OVA-файла версии 1.0.8.49:

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | cefd96394198b92870d650c975dbf3b8
    SHA1 | 4367a1801cf79104b8cd801e4d17b70596481d6f
    SHA256 | fda59f076f1d7bd3ebf53c53d1691cc140c7ed54261d0dc4ed0b14d7efef0ed9

    Для OVA-файла версии 1.0.8.40:

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 |afbae5a2e7142829659c21fd8a9def3f
    SHA1 | 1751849c1d709cdaef0b02a7350834a754b0e71d
    SHA256 | d093a940aebf6afdc6f616626049e97b1f9f70742a094511277c5f59eacc41ad

## <a name="create-the-collector-vm"></a>Создание виртуальной машины сборщика

Импортируйте загруженный файл в vCenter Server.

1. В консоли клиента vSphere выберите **File** (Файл) > **Deploy OVF Template** (Развернуть шаблон OVF).

    ![Развертывание шаблона OVF](./media/how-to-scale-assessment/vcenter-wizard.png)

2. В мастере развертывания шаблона OVF выберите **Source** (Источник) и укажите расположение OVA-файла.
3. В полях**Name** (Имя) и **Location** (Расположение) укажите понятное имя виртуальной машины сборщика и объект инвентаризации, в котором будет размещена эта виртуальная машина.
4. В поле **Host/Cluster** (Узел или кластер) укажите узел или кластер, в котором будет выполняться виртуальная машина сборщика.
5. В поле "Storage" (Хранилище) укажите место хранения данных виртуальной машины сборщика.
6. В поле **Disk Format** (Формат диска) укажите тип и размер диска.
7. В поле **Network Mapping** (Сетевое сопоставление) укажите сеть, к которой будет подключена виртуальная машина сборщика. Этой сети требуется подключение к Интернету для отправки метаданных в Azure. 
8. Проверьте и подтвердите параметры и нажмите кнопку **Finish** (Готово).

## <a name="identify-the-id-and-key-for-each-project"></a>Определение идентификатора и ключа для каждого проекта

Если у вас несколько проектов, обязательно укажите идентификатор и ключ для каждого из них. Ключ необходим при запуске сборщика для обнаружения виртуальных машин.

1. В проекте выберите **Начало работы** > **Обнаружение и оценка** > **Обнаружение компьютеров**.
2. В окне **Копирование учетных данных проекта** скопируйте идентификатор и ключ для проекта. 
    ![Копирование учетных данных проекта](./media/how-to-scale-assessment/copy-project-credentials.png)

## <a name="set-the-vcenter-statistics-level"></a>Установка уровня статистики vCenter
Ниже приведен список счетчиков производительности, данные которых собираются в процессе обнаружения. По умолчанию счетчики доступны на разных уровнях в vCenter Server. 

Рекомендуем установить наибольший общий уровень (3) для статистики, чтобы данные счетчиков собирались правильно. Если задать более низкий уровень статистики vCenter, то полностью смогут быть собраны только данные нескольких счетчиков, остальные же покажут 0. Оценка может отображать неполные данные. 

В следующей таблице показаны результаты оценки, на которые повлияет отсутствие данных какого-либо счетчика.

| Счетчик                                 | Уровень | Уровень каждого устройства | Влияние на оценку                    |
| --------------------------------------- | ----- | ---------------- | ------------------------------------ |
| cpu.usage.average                       | 1     | Нет данных               | Рекомендуемый размер и стоимость виртуальной машины         |
| mem.usage.average                       | 1     | Нет данных               | Рекомендуемый размер и стоимость виртуальной машины         |
| virtualDisk.read.average                | 2     | 2                | Размер диска, стоимость хранения и размер виртуальной машины |
| virtualDisk.write.average               | 2     | 2                | Размер диска, стоимость хранения и размер виртуальной машины |
| virtualDisk.numberReadAveraged.average  | 1     | 3                | Размер диска, стоимость хранения и размер виртуальной машины |
| virtualDisk.numberWriteAveraged.average | 1     | 3                | Размер диска, стоимость хранения и размер виртуальной машины |
| net.received.average                    | 2     | 3                | Размер виртуальной машины и затраты на сеть             |
| net.transmitted.average                 | 2     | 3                | Размер виртуальной машины и затраты на сеть             |

> [!WARNING]
> Если вы только что задали более высокий уровень статистики, то для создания данных счетчиков производительности потребуется до одного дня. Поэтому рекомендуется выполнить обнаружение через один день.

## <a name="run-the-collector-to-discover-vms"></a>Запуск сборщика для обнаружения виртуальных машин

Для каждого обнаружения, которое необходимо выполнить, следует запустить сборщик для виртуальных машин в требуемой области обнаружения. Выполняйте операции обнаружения по очереди. Параллельные операции обнаружения не поддерживаются, и у всех операций обнаружения должны быть разные области.

1.  В консоли клиента vSphere щелкните правой кнопкой мыши виртуальную машину и выберите **Open Console** (Открыть консоль).
2.  Укажите язык, часовой пояс и параметры пароля для модуля.
3.  На рабочем столе щелкните ярлык **Run collector** (Запустить сборщик).
4.  В сборщике службы "Миграция Azure" откройте раздел **Set Up Prerequisites** (Настройка предварительных требований), а затем:

    a. Примите условия лицензии и прочитайте информацию от сторонних производителей.

    Сборщик проверит наличие доступа к Интернету у виртуальной машины.

    Б. Если виртуальная машина подключена к Интернету через прокси-сервер, выберите **Proxy settings** (Параметры прокси-сервера) и укажите адрес и порт прослушивания прокси-сервера. Укажите учетные данные, если для прокси-сервера требуется аутентификация.

    Сборщик проверит, запущена ли служба сборщика. Эта служба устанавливается по умолчанию на виртуальной машине сборщика.

    c. Скачайте и установите VMware PowerCLI.

5.  В разделе **Specify vCenter Server details** (Укажите сведения о vCenter Server) выполните следующие действия:
    - Укажите полное доменное имя или IP-адрес vCenter Server.
    - Для **имени пользователя** и **пароля** укажите данные учетной записи только для чтения, которую сборщик будет использовать для обнаружения виртуальных машин в vCenter Server.
    - В поле **Select scope** (Выбор области) выберите область обнаружения виртуальных машин. Сборщик может обнаруживать только виртуальные машины в указанной области. Областью может быть определенная папка, центр обработки данных или кластер. Она не должна содержать более 1000 виртуальных машин. 

6.  В поле **Specify migration project** (Выбор проекта миграции) укажите идентификатор и ключ для проекта. Если вы не скопировали их, то откройте портал Azure на виртуальной машине сборщика. На проектной странице **Обзор** выберите **Обнаружение компьютеров** и скопируйте соответствующие значения.  
7.  В окне **View collection progress** (Просмотр хода выполнения сборщика) наблюдайте за процессом обнаружения и убедитесь, что в области обнаружения собираются метаданные из виртуальных машин. Сборщик предоставляет приблизительное время завершения обнаружения.


### <a name="verify-vms-in-the-portal"></a>Проверка виртуальных машин на портале

Длительность обнаружения зависит от количества виртуальных машин, обнаружение которых выполняется. Как правило, для 100 виртуальных машин обнаружение завершается примерно через час после завершения работы сборщика. 

1. В проекте службы "Миграция Azure" выберите **Управление** > **Компьютеры**.
2. Проверьте, появились ли на портале виртуальные машины, которые нужно было обнаружить.


## <a name="next-steps"></a>Дополнительная информация

- Узнайте, как [создать группу](how-to-create-a-group.md) для оценки.
- [Узнайте больше](concepts-assessment-calculation.md) о вычислении оценок.
