---
title: Обнаружение и оценка локальных виртуальных машин VMware для миграции в Azure с помощью службы "Миграция Azure" | Документация Майкрософт
description: В этой статье описывается, как обнаруживать и оценивать локальные виртуальные машины VMware для миграции в Azure с помощью службы "Миграция Azure".
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: tutorial
ms.date: 02/27/2018
ms.author: raynew
ms.custom: mvc
ms.openlocfilehash: d70b4ea2d45c38fa53ab3c00f76c00ef6f3d7663
ms.sourcegitcommit: 5b2ac9e6d8539c11ab0891b686b8afa12441a8f3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
# <a name="discover-and-assess-on-premises-vmware-vms-for-migration-to-azure"></a>Обнаружение и оценка локальных виртуальных машин VMware для миграции в Azure

Службы [Миграция Azure](migrate-overview.md) выполняют оценку локальных рабочих нагрузок для миграции в Azure.

Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * Создайте учетную запись, которую служба "Миграция Azure" будет использовать для обнаружения локальных виртуальных машин.
> * Создайте проект службы "Миграция Azure".
> * Настройте локальную виртуальную машину сборщика для обнаружения локальных виртуальных машин VMware для оценки.
> * Сгруппируйте виртуальные машины и создайте оценку.


Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/pricing/free-trial/), прежде чем начинать работу.


## <a name="prerequisites"></a>предварительным требованиям

- **VMware.** Управление виртуальными машинами, которые планируется перенести, должно осуществляться с помощью vCenter Server версии 5.5, 6.0 или 6.5. Кроме того, необходим один узел ESXi версии 5.0 или более поздней для развертывания виртуальной машины сборщика. 
 
> [!NOTE]
> Вскоре мы планируем реализовать поддержку Hyper-V. 

- **Учетная запись vCenter Server.** Для доступа к серверу vCenter Server требуется учетная запись, предназначенная только для чтения. Служба "Миграция Azure" использует эту учетную запись для обнаружения локальных виртуальных машин.
- **Разрешения.** На сервере vCenter Server вам потребуются разрешения для создания виртуальной машины путем импорта OVA-файла. 
- **Параметры статистики.** Перед началом развертывания для сервера vCenter Server нужно задать параметры статистики уровня 3. Если указать уровень ниже 3, оценка будет работать, но данные о производительности хранилища и сети собираться не будут. Рекомендации по размеру в этом случае будут основаны на данных производительности ЦП и памяти, а также на данных конфигурации диска и сетевых адаптеров. 

## <a name="create-an-account-for-vm-discovery"></a>Создание учетной записи для обнаружения виртуальной машины

Службе "Миграция Azure" необходим доступ к серверам VMware для автоматического обнаружения виртуальных машин для оценки. Создайте учетную запись VMware со следующими свойствами. Вы укажете эту учетную запись во время установки службы "Миграция Azure".

- Тип пользователя: пользователь только для чтения (минимум).
- Разрешения: объект центра обработки данных –> распространение на дочерний объект, роль только для чтения.
- Сведения: пользователь назначается на уровне центра обработки данных и поэтому имеет доступ ко всем объектам в центре обработки данных.
- Если нужно ограничить доступ, назначьте дочерним объектам (узлы vSphere, хранилища данных, виртуальные машины и сети) роль "Без доступа" с параметром Propagate to child object (Распространить на дочерний объект).

## <a name="log-in-to-the-azure-portal"></a>Войдите на портал Azure.

Войдите на [портал Azure](https://portal.azure.com).

## <a name="create-a-project"></a>Создание проекта

1. На портале Azure щелкните **Создать ресурс**.
2. Выполните поиск по фразе **Миграция Azure** и в результатах поиска выберите службу **Миграция Azure**. Затем щелкните **Создать**.
3. Укажите имя проекта и подписку Azure для него.
4. Создайте новую группу ресурсов.
5. Укажите расположение для создания проекта и нажмите кнопку **Создать**. Проект службы "Миграция Azure" можно создать только в регионах "Западно-центральная часть США" и "Восточная часть США". При этом по-прежнему можно планировать перенос в любое целевое расположение Azure. Метаданные, собранные с локальных виртуальных машин, хранятся только в расположении, которое задано для проекта. 

    ![Служба "Миграция Azure"](./media/tutorial-assessment-vmware/project-1.png)
    


## <a name="download-the-collector-appliance"></a>Скачивание модуля сборщика

Служба "Миграция Azure" создает локальную виртуальную машину, известную как модуль сборщика. Эта виртуальная машина обнаруживает локальные виртуальные машины VMware и отправляет метаданные о них в службу "Миграция Azure". Чтобы настроить модуль сборщика, скачайте OVA-файл и импортируйте его на локальный сервер vCenter Server для создания виртуальной машины.

1. В проекте службы "Миграция Azure" щелкните **Начало работы** > **Обнаружение и оценка** > **Обнаружение компьютеров**.
2. В окне **Обнаружение компьютеров** щелкните **Скачать**, чтоб скачать OVA-файл.
3. В окне **Копирование учетных данных проекта** скопируйте идентификатор и ключ проекта. Они потребуются при настройке сборщика.

    ![Скачивание OVA-файла](./media/tutorial-assessment-vmware/download-ova.png)

### <a name="verify-the-collector-appliance"></a>Проверка модуля сборщика

Прежде чем развертывать OVA-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш OVA-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример использования: ```C:\>CertUtil -HashFile C:\AzureMigrate\AzureMigrate.ova SHA256```
3. Созданный хэш должен соответствовать этим параметрам.
    
    Для OVA-файла версии 1.0.9.7

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | d5b6a03701203ff556fa78694d6d7c35
    SHA1 | f039feaa10dccd811c3d22d9a59fb83d0b01151e
    SHA256 | e5e997c003e29036f62bf3fdce96acd4a271799211a84b34b35dfd290e9bea9c
    
    Для OVA-файла версии 1.0.9.5

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | fb11ca234ed1f779a61fbb8439d82969
    SHA1 | 5bee071a6334b6a46226ec417f0d2c494709a42e
    SHA256 | b92ad637e7f522c1d7385b009e7d20904b7b9c28d6f1592e8a14d88fbdd3241c  
    
    Для OVA-файла версии 1.0.9.2

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | 7326020e3b83f225b794920b7cb421fc
    SHA1 | a2d8d496fdca4bd36bfa11ddf460602fa90e30be
    SHA256 | f3d9809dd977c689dda1e482324ecd3da0a6a9a74116c1b22710acc19bea7bb2  
    
    Для OVA-файла версии 1.0.8.59

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | 71139e24a532ca67669260b3062c3dad
    SHA1 | 1bdf0666b3c9c9a97a07255743d7c4a2f06d665e
    SHA256 | 6b886d23b24c543f8fc92ff8426cd782a77efb37750afac397591bda1eab8656  

    Для OVA-файла версии 1.0.8.49:
    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | cefd96394198b92870d650c975dbf3b8 
    SHA1 | 4367a1801cf79104b8cd801e4d17b70596481d6f
    SHA256 | fda59f076f1d7bd3ebf53c53d1691cc140c7ed54261d0dc4ed0b14d7efef0ed9

    Для OVA-файла версии 1.0.8.40:

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | afbae5a2e7142829659c21fd8a9def3f
    SHA1 | 1751849c1d709cdaef0b02a7350834a754b0e71d
    SHA256 | d093a940aebf6afdc6f616626049e97b1f9f70742a094511277c5f59eacc41ad

## <a name="create-the-collector-vm"></a>Создание виртуальной машины сборщика

Импортируйте скачанный файл на сервер vCenter Server.

1. В консоли клиента vSphere щелкните **File** (Файл)  >  **Deploy OVF Template** (Развернуть шаблон OVF).

    ![Развертывание шаблона OVF](./media/tutorial-assessment-vmware/vcenter-wizard.png)

2. В мастере развертывания шаблона OVF выберите **Source** (Источник) и укажите расположение OVA-файла.
3. В полях**Name** (Имя) и **Location** (Расположение) укажите понятное имя виртуальной машины сборщика и объект инвентаризации, в котором будет размещена эта виртуальная машина.
5. В поле **Host/Cluster** (Узел или кластер) укажите узел или кластер, в котором будет выполняться виртуальная машина сборщика.
7. В поле "Storage" (Хранилище) укажите место хранения данных виртуальной машины сборщика.
8. В поле **Disk Format** (Формат диска) укажите тип и размер диска.
9. В поле **Network Mapping** (Сетевое сопоставление) укажите сеть, к которой будет подключена виртуальная машина сборщика. Этой сети требуется подключение к Интернету для отправки метаданных в Azure. 
10. Просмотрите и подтвердите параметры, а затем нажмите кнопку **Finish** (Готово).

## <a name="run-the-collector-to-discover-vms"></a>Запуск сборщика для обнаружения виртуальных машин

1. В консоли клиента vSphere щелкните правой кнопкой мыши виртуальную машину и выберите **Open Console** (Открыть консоль).
2. Укажите язык, часовой пояс и параметры пароля для модуля.
3. На рабочем столе щелкните ярлык **Run collector** (Запустить сборщик).
4. В сборщике службы "Миграция Azure" откройте раздел **Set Up Prerequisites** (Настройка предварительных требований).
    - Примите условия лицензии и прочитайте информацию от сторонних производителей.
    - Сборщик проверит наличие доступа к Интернету у виртуальной машины.
    - Если виртуальная машина подключена к Интернету через прокси-сервер, щелкните **Proxy settings** (Параметры прокси-сервера) и укажите адрес и порт прослушивания прокси-сервера. Укажите учетные данные, если для прокси-сервера требуется аутентификация.

    > [!NOTE]
    > Адрес прокси-сервера нужно ввести в формате http://ProxyIPAddress или http://ProxyFQDN. Поддерживается только прокси-сервер HTTP.

    - Сборщик проверит, запущена ли служба сборщика. Эта служба устанавливается по умолчанию на виртуальной машине сборщика.
    - Скачайте и установите VMware vSphere PowerCLI.

5. В разделе **Specify vCenter Server details** (Укажите сведения о vCenter Server) выполните следующие действия:
    - Укажите полное доменное имя или IP-адрес сервера vCenter Server.
    - В полях **Имя пользователя** и **Пароль** укажите данные учетной записи только для чтения, которую сборщик будет использовать для обнаружения виртуальных машин на сервере vCenter Server.
    - В поле **Область сбора данных** выберите область обнаружения виртуальных машин. Сборщик может обнаруживать только виртуальные машины в указанной области. Областью может быть определенная папка, центр обработки данных или кластер. Она не должна содержать более 1000 виртуальных машин. 

6. В разделе **Specify migration project** (Укажите проект миграции) укажите идентификатор и ключ проекта службы "Миграция Azure", скопированные на портале. Если вы не скопировали их, откройте портал Azure на виртуальной машине сборщика. На странице **Обзор** проекта щелкните **Обнаружение компьютеров** и скопируйте соответствующие значения.  
7. В окне **View collection progress** (Просмотр хода выполнения сборщика) наблюдайте за обнаружением и убедитесь, что в области обнаружения собираются метаданные с виртуальных машин. Сборщик предоставляет приблизительное время завершения обнаружения.

> [!NOTE]
> Сборщик поддерживает только "Английский (США)" в качестве языка операционной системы и языка интерфейса сборщика. Поддержка дополнительных языков будет реализована в ближайшее время.


### <a name="verify-vms-in-the-portal"></a>Проверка виртуальных машин на портале

Длительность обнаружения зависит от количества виртуальных машин, обнаружение которых выполняется. Обычно для 100 виртуальных машин после завершения работы сборщика обнаружение занимает примерно час. 

1. В проекте службы "Миграция Azure" щелкните **Управление** > **Компьютеры**.
2. Проверьте, появились ли на портале виртуальные машины, которые нужно было обнаружить.


## <a name="create-and-view-an-assessment"></a>Создание и просмотр оценки

После обнаружения виртуальных машин их можно сгруппировать и создать оценку. 

1. На странице **Обзор** проекта щелкните **+Создать оценку**.
2. Щелкните **Просмотреть все**, чтобы просмотреть свойства оценки.
3. Создайте группу и укажите ее имя.
4. Выберите компьютеры, которые необходимо добавить в группу.
5. Щелкните **Создать оценку**, чтобы создать группу и оценку.
6. После создания оценки просмотрите ее, выбрав **Обзор** > **Панель мониторинга**.
7. Щелкните **Экспорт оценки**, чтобы скачать оценку в виде файла Excel.

### <a name="assessment-details"></a>Сведения об оценке

Оценка включает в себя информацию о том, совместимы ли локальные виртуальные машины с Azure, правильный размер виртуальной машины для запуска в Azure, а также предполагаемые ежемесячные затраты в Azure. 

![Отчет об оценке](./media/tutorial-assessment-vmware/assessment-report.png)

#### <a name="azure-readiness"></a>Готовность к работе в Azure

В представлении готовности к работе в Azure в отчете об оценке отображается состояние готовности каждой виртуальной машины. В зависимости от свойств каждую виртуальную машину можно пометить как:
- готова к работе в Azure;
- условно готова к работе в Azure;
- не готова к работе в Azure;
- готовность неизвестна. 

Для виртуальных машин, которые готовы к миграции, служба "Миграция Azure" рекомендует размер виртуальной машины в Azure. Размер, рекомендуемый службой "Миграция Azure", зависит от условий определения размера, указанных в свойствах оценки. Если указано условие определения размера на основе производительности, для формирования рекомендации учитывается журнал производительности виртуальных машин. Если указано условие определения размера как для локальной виртуальной машины, при формировании рекомендации учитывается размер локальной виртуальной машины (определение размера "как есть"). В этом случае данные об использовании не учитываются. Дополнительные сведения об определении размеров в службе "Миграция Azure" см. [здесь](concepts-assessment-calculation.md). 

Служба "Миграция Azure" также определяет причину проблем готовности к работе виртуальных машин, которые не готовы или условно готовы к работе в Azure, и предоставляет рекомендации по их устранению. 

Виртуальные машины, для которых службе "Миграция Azure" не удается определить состояние готовности к работе (из-за отсутствия данных), помечаются как "готовность неизвестна".

Помимо определения готовности к работе в Azure и нужного размера в службе "Миграция Azure" также предлагаются средства, которые можно использовать для миграции виртуальной машины. Это требует более глубокого обнаружения в локальной среде. Сведения о том, как выполнить более глубокое обнаружение путем установки агентов на локальных компьютерах см. в статье [Миграция компьютеров после оценки](how-to-get-migration-tool.md). Если агенты не установлены на локальных компьютерах, можно выполнить миграцию по методике Lift-аnd-Shift с помощью [Azure Site Recovery](https://docs.microsoft.com/azure/site-recovery/site-recovery-overview). Если агенты установлены на локальном компьютере, служба "Миграция Azure" просматривает процессы, выполняемые внутри него, и определяет, является ли он компьютером базы данных. Если это компьютер базы данных, вы можете использовать для миграции [Azure Database Migration Service](https://docs.microsoft.com/azure/dms/dms-overview), а в качестве средства миграции — Azure Site Recovery.

  ![Оценка готовности](./media/tutorial-assessment-vmware/assessment-suitability.png)  

#### <a name="monthly-cost-estimate"></a>Примерная стоимость в месяц

В этом представлении отображается общая стоимость вычислений и хранения для запуска виртуальных машин в Azure, а также сведениями для каждой машины. Оценка стоимости вычисляется с учетом рекомендованного службой "Миграция Azure" размера компьютера, его дисков и свойств оценки. 

> [!NOTE]
> Оценка стоимости, предоставляемая службой "Миграция Azure", приводится для запуска локальных виртуальных машин как виртуальных машин Azure IaaS (инфраструктура как услуга). При использовании службы "Миграция Azure" не учитывается стоимость платформы как услуги (PaaS) или программного обеспечения как услуги (SaaS). 

Примерная ежемесячная стоимость вычислений и хранилища суммируется для всех виртуальных машин в группе. 

![Оценка стоимости виртуальной машины](./media/tutorial-assessment-vmware/assessment-vm-cost.png) 

#### <a name="confidence-rating"></a>Оценка достоверности

Каждая оценка в службе "Миграция Azure" связана с оценкой достоверности, которая колеблется в диапазоне от 1 до 5 звездочек (1 звезда — низкая достоверность, а 5 — высокая). Оценка достоверности назначается на основе доступности точек данных, необходимых для вычисления оценки. Оценка достоверности помогает определить надежность рекомендаций по выбору размера, предоставленных службой "Миграция Azure". 

Оценка достоверности необходима, если вы *определяете размер на основе производительности*, так как служба "Миграция Azure" может не иметь достаточного количества точек данных для определения размера на основе использования. При *определении размера как для локальной виртуальной машины* значение оценки достоверности всегда равно 5 звездам, так как в службе "Миграция Azure" есть все данные для определения размера виртуальной машины. 

Для определения размера виртуальной машины на основе производительности службе "Миграция Azure" требуются данные об использовании ЦП и памяти. Кроме того, для каждого диска, присоединенного к виртуальной машине, необходимы сведения об операциях записи и чтения в секунду и пропускной способности. Аналогичным образом, для каждого сетевого адаптера, подключенного к виртуальной машине, службе "Миграция Azure" необходимы сведения о сетевом вводе-выводе. Если какой-либо из приведенных выше показателей использования недоступен в vCenter Server, рекомендации по выбору размера, предоставленные службой "Миграция Azure", могут быть ненадежными. В зависимости от процента доступных точек данных оценка достоверности может быть такой:

   **Уровень доступности точек данных** | **Оценка достоверности**
   --- | ---
   0–20 % | 1 звезда
   21–40 % | 2 звезды
   41–60 % | 3 звезды
   61–80 % | 4 звезды
   81–100 % | 5 звезд

В процессе оценки могут быть доступны не все точки данных по одной из следующих причин.
- Для статистики в vCenter Server не задан уровень 3 и для оценки выбрано условие определения размера на основе производительности. Если для статистики в vCenter Server задан уровень меньше чем 3, данные о производительности диска и сети не собираются из vCenter Server. В этом случае рекомендации для диска и сети, предоставленные службой "Миграция Azure", не основаны на показателях их использования. Для хранения в службе "Миграция Azure" рекомендуется использовать стандартные диски. Это связано с тем, что без показателя операций ввода-вывода в секунду или пропускной способности диска служба не может определить, требуется ли в Azure диск категории "Премиум".
- Для статистики в vCenter Server был установлен уровень 3 в течение меньшего периода времени перед выполнением обнаружения. Например, рассмотрим сценарий, в котором вы зададите для статистики уровень 3 сегодня, а начнете выполнение обнаружения с помощью модуля сборщика завтра (через 24 часа). При создании оценки за один день вам будут доступны все точки данных, а значение оценки достоверности будет равно 5 звездам. Но если изменить продолжительность производительности в свойствах оценки до одного месяца, оценка достоверности снижается, так как данные о производительности диска и сети за последний месяц будут недоступны. Если необходимо рассмотреть данные о производительности за последний месяц, рекомендуется задать для статистики vCenter Server уровень 3 на один месяц, прежде чем начать выполнение обнаружения. 
- В течение периода, для которого рассчитывается оценка, несколько виртуальных машин были отключены. Если какие-либо виртуальные машины были отключены в течение некоторого времени, в vCenter Server не будет данных о производительности за этот период. 
- За период, для которого рассчитывается оценка, было создано несколько виртуальных машин. Например, вы создаете оценку для журнала производительности за последний месяц, при этом несколько виртуальных машин были созданы всего неделю назад. В таких случаях журнал производительности новых виртуальных машин не будет доступен за весь период.

> [!NOTE]
> Если оценка достоверности ниже 4 звезд, рекомендуем задать для статистики vCenter Server уровень 3, подождать в течение периода, для которого нужно сформировать оценку (1 день, 1 неделя или 1 месяц), а затем выполнить обнаружение и формирование оценки. Если не сделать этого, определение размера на основе производительности может оказаться ненадежным. Рекомендуется переключиться на режим *определения размера как для локальной ВМ*, изменив свойства оценки.
 
## <a name="next-steps"></a>Дополнительная информация

- [Узнайте](how-to-scale-assessment.md), как выполнять обнаружение и оценку в большой среде VMware.
- Узнайте, как создать группы с высоким уровнем надежности, используя [сопоставление зависимостей компьютеров](how-to-create-group-machine-dependencies.md).
- [Узнайте больше](concepts-assessment-calculation.md) о вычислении оценок.
