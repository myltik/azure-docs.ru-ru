---
title: Потоковая передача данных мониторинга Azure в концентраторы событий | Документация Майкрософт
description: Узнайте, как передать данные мониторинга Azure в концентратор событий, чтобы получить данные в партнерском решении SIEM или средстве аналитики.
author: johnkemnetz
manager: robb
editor: ''
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 3/05/2018
ms.author: johnkem
ms.openlocfilehash: 9cc4eb8d8f1494a7ea7a63297751f8e251aedf05
ms.sourcegitcommit: d98d99567d0383bb8d7cbe2d767ec15ebf2daeb2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/10/2018
---
# <a name="stream-azure-monitoring-data-to-an-event-hub-for-consumption-by-an-external-tool"></a>Потоковая передача данных мониторинга Azure в концентратор событий для потребления внешним инструментом

Azure Monitor предоставляет единый конвейер для получения доступа ко всем данным мониторинга из вашей среды Azure, позволяя легко настроить партнерское решение SIEM и средства мониторинга для использования этих данных. В этой статье описывается настройка различных уровней данных из среды Azure для отправки в одно пространство имен концентраторов событий или концентратор событий, где данные могут быть собраны внешним инструментом.

## <a name="what-data-can-i-send-into-an-event-hub"></a>Данные, которые можно отправить в концентратор событий 

В пределах вашей среды Azure существует несколько уровней данных мониторинга, а метод доступа к данным на разных уровнях несколько отличается. Как правило, эти уровни можно описать так:

- **Данные мониторинга приложений:** данные о производительности и функциональности кода, который вы написали и выполняете в Azure. Примеры данных мониторинга приложений включают в себя трассировки производительности, журналы приложений и пользовательскую телеметрию. Данные мониторинга приложений обычно собираются одним из следующих способов:
  - Посредством иснтрументирования кода с помощью пакета SDK, такого как [пакет SDK для Application Insights](../application-insights/app-insights-overview.md).
  - Путем запуска агента мониторинга, который прослушивает новые журналы приложений на компьютере, где запущено приложение, например [агент диагностики Azure для Windows](./azure-diagnostics.md) или [агент диагностики Azure для Linux](../virtual-machines/linux/diagnostic-extension.md).
- **Данные мониторинга гостевой ОС:** данные об операционной системе, в которой выполняется ваше приложение. К примерам данных мониторинга гостевой ОС относится системный журнал Linux или системные события Windows. Для сбора данных этого типа необходимо установить агент, такой как [агент диагностики Azure для Windows](./azure-diagnostics.md) или [агент диагностики Azure для Linux](../virtual-machines/linux/diagnostic-extension.md).
- **Данные мониторинга ресурсов Azure:** данные о работе ресурса Azure. Для некоторых типов ресурсов Azure, например виртуальных машин, внутри этой службы Azure нужно выполнять мониторинг гостевой ОС и приложений. Для других ресурсов Azure, таких как группы безопасности сети, данные мониторинга ресурсов являются наивысшим из доступных уровней данных (так как в этих ресурсах не выполняется гостевая ОС или приложения). Эти данные можно собирать с помощью [параметров диагностики ресурсов](./monitoring-overview-of-diagnostic-logs.md#resource-diagnostic-settings).
- **Данные мониторинга платформы Azure:** данные об операциях и управлении клиентом или подпиской Azure, а также данные о работоспособности и операциях самой платформы Azure. [Журнал действий](./monitoring-overview-activity-logs.md), включая данные о работоспособности службы и аудиты Active Directory, является примером данных мониторинга платформы. Сбор этих данных также можно настроить с помощью параметров диагностики ресурсов.

Данные из любого уровня могут отправляться в концентратор событий, где они могут быть извлечены в партнерское средство. В следующих разделах описывается, как настроить потоковую передачу данных из каждого уровня в концентратор событий. На отслеживаемом уровне данных предполагается наличие ресурсов.

## <a name="set-up-an-event-hubs-namespace"></a>Настройка пространства имен концентраторов событий

Вначале следует [создать пространство имен концентраторов событий и концентратор событий](../event-hubs/event-hubs-create.md). Они являются местом назначения всех ваших данных мониторинга. Пространство имен концентраторов событий — это логическое объединение концентраторов событий, которые совместно используют одну политику доступа. Применяется тот же принцип, что и для отдельных больших двоичных объектов в рамках одной учетной записи хранения. Обратите внимание на следующие сведения о пространстве имен концентраторов событий и концентраторах событий, которые вы создаете:
* Рекомендуем использовать пространство имен для концентраторов событий ценовой категории "Стандартный".
* Как правило, необходима только одна единица пропускной способности. Если нужно увеличить масштаб, когда растет объем использования журнала, вы всегда можете вручную добавить единицы пропускной способности для пространства имен или включить автоматическое расширение.
* Добавив единицы пропускной способности, можно увеличить ее масштаб для концентраторов событий. Добавив разделы, вы можете распараллелить потребление по нескольким клиентам. Один раздел позволяет пропускать до 20 Мбит/с или приблизительно 20 000 сообщений в секунду. Средство, использующее данные, может поддерживать или не поддерживать потребление из нескольких разделов. Если вы не знаете, какое количество разделов настроить, рекомендуем начать с четырех.
* Рекомендуем сохранять сообщения в концентраторе в течение 7 дней. В таком случае, если средство, использующее данные, выйдет из строя более чем на один день, можно будет возобновить его работу с момента ее остановки (для событий, которые произошли не ранее 7 дней назад).
* Рекомендуем использовать для концентратора событий группы объектов-получателей по умолчанию. Не нужно создавать другие группы объектов-получателей или использовать отдельную группу объектов-получателей, если вы не планируете задействовать два разных средства, которые будут использовать одни и те же данные в одном концентраторе событий.
* Выберите пространство имен концентраторов событий для журнала действий, и при помощи Azure Monitor в этом пространстве имен будет создан концентратор уведомлений с именем insights-logs-operationallogs. Для других типов журналов можно выбрать существующий концентратор событий (можно повторно использовать концентратор событий insights-logs-operationallogs) или создать концентратор событий для каждой категории журналов при помощи Azure Monitor.
* На компьютере, который получает данные из концентратора событий, как правило, необходимо открыть порт 5671 и 5672.

См. также [часто задаваемые вопросы о концентраторах событий Azure](../event-hubs/event-hubs-faq.md).

## <a name="how-do-i-set-up-azure-platform-monitoring-data-to-be-streamed-to-an-event-hub"></a>Как настроить потоковую передачу данных мониторинга платформы Azure в концентратор событий

Данные мониторинга платформы Azure поступают из двух основных источников:
1. [Журнал действий Azure](./monitoring-overview-activity-logs.md), который содержит операции создания, обновления и удаления из Resource Manager, изменения в [состоянии работоспособности службы Azure ](../service-health/service-health-overview.md), которые могут влиять на ресурсы в вашей подписке, переходы между состояниями [работоспособности ресурсов](../service-health/resource-health-overview.md) и несколько других типов событий уровня подписки. [В этой статье описаны все категории событий, которые отображаются в журнале действий Azure](./monitoring-activity-log-schema.md).
2. [Отчеты Azure Active Directory](../active-directory/active-directory-reporting-azure-portal.md), которые включают в себя журнал действий входа и журнал аудита изменений, внесенных в пределах конкретного клиента. Пока еще невозможно передать данные Azure Active Directory в концентратор событий.

### <a name="stream-azure-activity-log-data-into-an-event-hub"></a>Потоковая передача данных журнала действий Azure в концентратор событий

Чтобы отправить данные из журнала действий Azure в пространство имен концентраторов событий, настройте профиль журнала в своей подписке, [следуя этому руководству](./monitoring-stream-activity-logs-event-hubs.md). Сделайте это для каждой подписки, которую требуется отслеживать.

> [!TIP]
> Сейчас профиль журнала позволяет только выбрать пространство имен концентраторов событий, в котором создается концентратор событий с именем insights-operating-logs. Пока еще невозможно указать собственное имя концентратора событий в профиле журнала.

## <a name="how-do-i-set-up-azure-resource-monitoring-data-to-be-streamed-to-an-event-hub"></a>Как настроить потоковую передачу данных мониторинга ресурсов Azure в концентратор событий

Ресурсы Azure создают два вида данных мониторинга:
1. [Журналы диагностики ресурсов](./monitoring-overview-of-diagnostic-logs.md).
2. [Метрики](monitoring-overview-metrics.md)

Оба типа данных отправляются в концентратор событий с использованием параметра диагностики ресурсов. [Следуя этому руководству](./monitoring-stream-diagnostic-logs-to-event-hubs.md), задайте параметр диагностики в каждом ресурсе, для которого вы хотите собирать журналы.

> [!TIP]
> Вы можете использовать службу "Политика Azure", чтобы для каждого ресурса в определенной области всегда настраивался параметр диагностики. Для этого [используйте эффект DeployIfNotExists в правиле политики](../azure-policy/policy-definition.md#policy-rule). В данный момент DeployIfNotExists поддерживается только во встроенных политиках.

## <a name="how-do-i-set-up-guest-os-monitoring-data-to-be-streamed-to-an-event-hub"></a>Как настроить потоковую передачу данных мониторинга гостевой ОС в концентратор событий

Необходимо установить агент для отправки данных мониторинга гостевой ОС в концентратор событий. Для Windows или Linux укажите данные, которые следует отправлять в концентратор событий, а также сам концентратор событий в файле конфигурации и передайте этот файл конфигурации агенту, запущенному на виртуальной машине.

### <a name="stream-linux-data-to-an-event-hub"></a>Потоковая передача данных Linux в концентратор событий

[Агент диагностики Azure для Linux](../virtual-machines/extensions/diagnostics-linux.md) можно использовать для отправки данных мониторинга из компьютера Linux в концентратор событий. Для этого добавьте концентратор событий в качестве приемника в защищенных настройках JSON файла конфигурации LAD. Дополнительные сведения см. в [этой статье](../virtual-machines/extensions/diagnostics-linux.md#protected-settings).

> [!NOTE]
> Вы не можете настроить потоковую передачу данных мониторинга гостевой ОС в концентратор событий на портале. Вместо этого необходимо вручную изменить файл конфигурации.

### <a name="stream-windows-data-to-an-event-hub"></a>Потоковая передача данных Windows в концентратор событий

[Агент диагностики Azure для Windows](./azure-diagnostics.md) можно использовать для отправки данных мониторинга из компьютера Windows в концентратор событий. Для этого добавьте концентратор событий в качестве приемника в разделе privateConfig файла конфигурации WAD. Дополнительные сведения см. в [этой статье](./azure-diagnostics-streaming-event-hubs.md).

> [!NOTE]
> Вы не можете настроить потоковую передачу данных мониторинга гостевой ОС в концентратор событий на портале. Вместо этого необходимо вручную изменить файл конфигурации.

## <a name="how-do-i-set-up-application-monitoring-data-to-be-streamed-to-event-hub"></a>Как настроить потоковую передачу данных мониторинга приложения в концентратор событий

Для данных мониторинга приложений требуется инструментирование кода в пакете SDK, поэтому не существует универсального решения для маршрутизации данных мониторинга приложений в концентратор событий в Azure. Тем не менее службу [Azure Application Insights](../application-insights/app-insights-overview.md) можно использовать для сбора данных уровня приложения Azure. Если вы используете Application Insights, вы можете передавать данные мониторинга в концентратор событий, выполнив следующие действия:

1. [Настройте непрерывный экспорт](../application-insights/app-insights-export-telemetry.md) данных Application Insights в учетную запись хранения.

2. Настройте логическое приложение, активируемое по таймеру, которое [извлекает данные из хранилища BLOB-объектов ](../connectors/connectors-create-api-azureblobstorage.md#use-an-action) и [передает их как сообщение в концентратор событий](../connectors/connectors-create-api-azure-event-hubs.md#send-events-to-your-event-hub-from-your-logic-app).

## <a name="what-can-i-do-with-the-monitoring-data-being-sent-to-my-event-hub"></a>Что можно сделать с данными мониторинга, отправляемыми в концентратор событий

Маршрутизация данных мониторинга в концентратор событий с помощью Azure Monitor обеспечивает интеграцию с партнерским решением SIEM и средствами мониторинга. Для большинства средств требуется строка подключения к концентратору событий и определенные разрешения подписки Azure для чтения данных из концентратора событий. Ниже приведен неполный список средств интеграции с Azure Monitor:

* **IBM QRadar**. Модуль устройства (DSM) Microsoft Azure и протокол концентратора событий Microsoft Azure доступны для загрузки на [веб-сайте поддержки IBM](http://www.ibm.com/support). [Дополнительные сведения об интеграции с Azure.](https://www.ibm.com/support/knowledgecenter/SS42VS_DSM/c_dsm_guide_microsoft_azure_overview.html?cp=SS42VS_7.3.0)
* **Splunk**. В зависимости от настройки Splunk имеется два подхода:
    1. [Надстройка Azure Monitor для Splunk](https://splunkbase.splunk.com/app/3534/) доступна в Splunkbase и является проектом с отрытым кодом. [Документация](https://github.com/Microsoft/AzureMonitorAddonForSplunk/wiki/Azure-Monitor-Addon-For-Splunk).
    2. Если вам не удалось установить надстройку в своем экземпляре Splunk (например, при использовании прокси-сервера или запуске в Splunk Cloud), можно передать эти события в сборщик событий HTTP Splunk с помощью [этой функции, активируемой при поступлении новых сообщений в концентратор событий](https://github.com/sebastus/AzureFunctionForSplunkVS).
* **SumoLogic**. Инструкции по настройке SumoLogic для использования данных из концентратора событий [доступны здесь](https://help.sumologic.com/Send-Data/Applications-and-Other-Data-Sources/Azure-Audit/02Collect-Logs-for-Azure-Audit-from-Event-Hub).

## <a name="next-steps"></a>Дальнейшие действия
* [Архивация журнала действий Azure](monitoring-archive-activity-log.md)
* [Общие сведения о журнале действий Azure](monitoring-overview-activity-logs.md)
* [Настройка объекта webhook для оповещений журнала действий Azure](insights-auditlog-to-webhook-email.md)

