---
title: Создание графического модуля runbook в службе автоматизации Azure
description: Учебник, в котором описывается создание, тестирование и публикация простого графического модуля Runbook.
keywords: Runbook, шаблон Runbook, служба автоматизации Runbook и Azure Runbook
services: automation
ms.service: automation
author: georgewallace
ms.author: gwallace
ms.date: 04/13/2018
ms.topic: article
manager: carmonm
ms.openlocfilehash: d47a8a3d8343aaa17346cd63c055e8687f25f812
ms.sourcegitcommit: 59914a06e1f337399e4db3c6f3bc15c573079832
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/19/2018
---
# <a name="my-first-graphical-runbook"></a>Первый графический Runbook

> [!div class="op_single_selector"]
> * [Графический](automation-first-runbook-graphical.md)
> * [PowerShell](automation-first-runbook-textual-powershell.md)
> * [Рабочий процесс PowerShell](automation-first-runbook-textual.md)
> * [Python](automation-first-runbook-textual-python2.md)
> 

В данном учебнике описана процедура создания [графического модуля Runbook](automation-runbook-types.md#graphical-runbooks) в службе автоматизации Azure. Сначала вы протестируете и опубликуете простой модуль runbook и узнаете, как отслеживать состояние его заданий. Затем мы изменим модуль runbook, настроив его для фактического управления ресурсами Azure (в нашем примере это запуск виртуальной машины Azure). Затем вы завершите работу с руководством, повысив надежность модуля runbook, а также добавив параметры и условные связи.

## <a name="prerequisites"></a>предварительным требованиям

Для работы с этим учебником требуется:

* Подписка Azure. Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или [зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* [Учетная запись службы автоматизации](automation-offering-get-started.md) , чтобы хранить модуль Runbook и выполнять проверку подлинности ресурсов Azure. Эта учетная запись должна иметь разрешение на запуск и остановку виртуальной машины.
* Виртуальная машина Azure. Это не должна быть рабочая виртуальная машина, так как в процессе изучения этого руководства ее нужно будет остановить и запустить заново.

## <a name="create-runbook"></a>Создание модуля Runbook

Для начала вы создадите простой модуль runbook, при помощи которого на экран выводится текст *Hello World*.

1. На портале Azure выберите свою учетную запись службы автоматизации.

   Страница учетной записи в службе автоматизации позволяет быстро получить представление о ресурсах, доступных в этой учетной записи. Некоторые ресурсы уже должны быть доступны. Большинство из них — это модули, которые добавляются в каждую новую учетную запись службы автоматизации по умолчанию. Кроме того, вам потребуется ресурс учетных данных, упомянутый в [предварительных требованиях](#prerequisites).

2. В разделе **Управление процессами** выберите **Модули Runbook**, чтобы открыть список модулей.
3. Создайте модуль runbook. Для этого нажмите кнопку **Добавить Runbook** и выберите **Создать новый Runbook**.
4. Присвойте модулю Runbook имя *MyFirstRunbook-Graphical*.
5. В этом примере создается [графический модуль runbook](automation-graphical-authoring-intro.md), поэтому в поле **	Тип Runbook** выберите значение **Графический**.<br> ![Новый Runbook](media/automation-first-runbook-graphical/create-new-runbook.png)<br>
6. Щелкните **Создать** , чтобы создать модуль Runbook и открыть графический редактор.

## <a name="add-activities"></a>Добавление действий

Элемент управления "Библиотека" в левой части редактора позволяет добавлять действия в модуль Runbook. Добавьте командлет **Write-Output** для вывода текста при помощи модуля runbook.

1. В элементе управления "Библиотека" щелкните текстовое поле поиска и введите **Write-Output**. На следующем изображении показаны результаты поиска: <br> ![Microsoft.PowerShell.Utility](media/automation-first-runbook-graphical/search-powershell-cmdlet-writeoutput.png)
1. Прокрутите список до конца. Щелкните правой кнопкой мыши **Write-Output** и выберите пункт **Добавить на холст** или же щелкните значок многоточия рядом с командлетом и выберите пункт **Добавить на холст**.
1. Щелкните **Write-Output** на холсте. Откроется страница управления конфигурацией, где можно настроить выбранное действие.
1. В поле **Метка** по умолчанию указывается имя командлета, но можно указать и более понятное название. Введите в это поле значение *Вывод текста "Привет, мир!"*.
1. Щелкните **Параметры**, чтобы указать значения параметров командлета.

   Некоторые командлеты имеют несколько наборов параметров, и вам нужно выбрать, какой из них будет использоваться. В этом случае командлет **Write-Output** имеет только один набор параметров, поэтому выбор делать не нужно.

1. Выберите параметр **InputObject** . В этом параметре вы зададите текст для отправки в поток вывода.
1. В раскрывающемся списке **Источник данных** выберите **PowerShell expression** (Выражение PowerShell). Раскрывающийся список **Источник данных** содержит разные источники, которые можно использовать для заполнения значения параметра.

   Можно использовать выходные данные из таких источников, как другое действие, ресурс автоматизации или выражение PowerShell. В нашем случае нужно вывести только текст *Hello World*. Для этого воспользуйтесь выражением PowerShell и укажите строку.<br>

1. В поле **Выражение** введите *Привет, мир* и дважды нажмите кнопку **ОК**, чтобы вернуться к холсту.
1. Сохраните модуль Runbook, щелкнув **Сохранить**.

## <a name="test-the-runbook"></a>Тестирование модуля Runbook

Прежде чем опубликовать модуль runbook и, таким образом, сделать его доступным для рабочей среды, необходимо проверить, правильно ли он работает. Чтобы протестировать модуль Runbook, нужно запустить его **черновую** версию и проверить его работу в интерактивном режиме.

1. Выберите **Тестовая область**, чтобы открыть страницу тестирования.
1. Щелкните **Пуск** , чтобы начать тестирование. Активным должен быть только этот параметр.
1. При этом создается объект [Задание Runbook](automation-runbook-execution.md) , а его состояние отображается на панели.

   Сначала задание получает состояние *В очереди*, которое означает, что задание стало доступно рабочей роли runbook в облаке. Как только рабочая роль затребует задание, оно получит состояние *Запущено*, а с началом фактического выполнения модуля Runbook — состояние *Выполняется*.

1. Когда задание модуля Runbook будет выполнено, на экране появится результат. В этом случае вы увидите текст *Hello World*.<br> ![Привет, мир!](media/automation-first-runbook-graphical/runbook-test-results.png)
1. Закройте страницу тестирования, чтобы вернуться к холсту.

## <a name="publish-and-start-the-runbook"></a>Публикация и запуск модуля Runbook

Модуль runbook, который вы только что создали, все еще находится в режиме черновика. Прежде чем запустить модуль в рабочей среде, его нужно опубликовать. При публикации модуля Runbook существующая опубликованная версия перезаписывается черновой версией. В нашем случае опубликованной версии не существует, поскольку модуль runbook создан только что.

1. Выберите **Опубликовать**, чтобы опубликовать runbook, и нажмите кнопку **Да** в появившемся запросе.
1. Если прокурить экран влево, чтобы просмотреть runbook на странице **Модули Runbook**, для параметра **Состояние создания** отобразится значение **Опубликовано**.
1. Прокрутите экран вправо до страницы **MyFirstRunbook-Graphical**.

   Параметры в верхней части экрана позволяют запустить модуль Runbook, запланировать его запуск в определенное время или создать [Webhook](automation-webhooks.md) , чтобы модуль можно было запускать с помощью HTTP-вызова.

1. Чтобы запустить runbook, выберите **Запуск** и нажмите кнопку **Да** в появившемся запросе.
1. Откроется страница заданий с созданным заданием runbook. Убедитесь, что для **состояния задания** отображается значение **Завершено**.
1. Как только состояние модуля Runbook изменится на *Выполнено*, щелкните **Выходные данные**. Откроется страница **Выходные данные** с текстом *Hello World*.
1. Закройте страницу выходных данных.
1. Щелкните **All Logs** (Все журналы), чтобы открыть страницу "Потоки" для задания runbook. В потоке вывода должен отображаться только текст *Hello World*, но могут присутствовать и другие потоки заданий runbook, например "Подробные сведения" и "Ошибка", если модуль записывает в них какие-то данные.
1. Закройте страницы "All Logs" (Все журналы) и "Задания", чтобы вернуться к странице MyFirstRunbook-Graphical.
1. Чтобы просмотреть все задания для runbook, закройте страницу **Задание** и выберите **Задания** в разделе **РЕСУРСЫ**. Откроется список всех заданий, созданных этим модулем Runbook. В нем должно быть только одно задание, так как вы запустили задание только один раз.
1. Если щелкнуть это задание, откроется та же область заданий, что и при запуске модуля runbook. С ее помощью можно вернуться назад и просмотреть сведения о любом задании, созданном для конкретного модуля Runbook.

## <a name="create-variable-assets"></a>Создание ресурсов для переменных

Вы протестировали и опубликовали свой модуль runbook, но пока он не выполняет никаких полезных действий. Нужно, чтобы он управлял ресурсами Azure. Перед тем как настроить аутентификацию модуля runbook, нужно создать переменную и сохранить в ней идентификатор подписки. На эту переменную вы будете ссылаться при настройке действия для аутентификации (см. шаг 6). Добавив ссылку в контекст подписки, вы сможете легко работать с несколькими подписками. Прежде чем продолжить, скопируйте идентификатор подписки из элемента "Подписки" в области навигации.

1. На странице "Учетные записи службы автоматизации" выберите **Переменные** в разделе **ОБЩИЕ РЕСУРСЫ**.
1. Выберите **Добавить переменную**.
1. На странице "Новая переменная" введите в поле **Имя** значение **AzureSubscriptionId**, а в поле **Значение** — свой идентификатор подписки. Для параметра **Тип** укажите значение *Строка*, а для параметра **Шифрование** используйте значение по умолчанию.
1. Щелкните **Создать** , чтобы создать переменную.

## <a name="add-authentication"></a>Добавление аутентификации

Теперь, когда у вас есть переменная с идентификатором подписки, можно настроить модуль runbook для выполнения аутентификации. Для этого используйте учетные данные запуска от имени, которые указаны в разделе [Предварительные требования](#prerequisites). Добавьте на холст командлет **Connect-AzureRmAccount** и **ресурс** подключения учетной записи запуска от имени Azure.

1. Вернитесь к runbook и выберите **Изменить** на странице MyFirstRunbook-Graphical.
1. Так как название **Write Hello World to output** (Вывод текста Hello World) больше не нужно, щелкните значок многоточия и выберите **Удалить**.
1. В элементе управления "Библиотека" разверните узлы **Ресурсы** и **Подключения**, а затем добавьте на холст элемент **AzureRunAsConnection**. Для этого выберите **Добавить на холст**.
1. В элементе управления "Библиотека" в поле поиска введите текст **Connect-AzureRmAccount**.
1. Добавьте на холст командлет **Connect-AzureRmAccount**.
1. Наведите указатель мыши на элемент **Get Run As Connection** (Получить подключение запуска от имени), чтобы в нижней части элемента появился кружок. Щелкните этот кружок и перетащите стрелку к элементу **Connect-AzureRmAccount**. Созданная стрелка является *связью*. При запуске этот runbook выполнит действие **Get Run As Connection** (Получить подключение запуска от имени), а затем — командлет **Connect-AzureRmAccount**.<br> ![Создание связи между действиями](media/automation-first-runbook-graphical/runbook-link-auth-activities.png)
1. На холсте выберите элемент **Connect-AzureRmAccount** и в области управления конфигурацией в текстовое поле **Метка** введите текст **Выполнить вход в Azure**.
1. Щелкните **Параметры**, чтобы открыть страницу "Конфигурация параметров действия".
1. Командлет **Connect-AzureRmAccount** имеет несколько наборов параметров. Нужно выбрать один из них, прежде чем вводить значения параметров. Щелкните **Набор параметров** и выберите набор параметров **ServicePrincipalCertificate**.
1. Параметры из выбранного набора появятся на странице конфигурации параметров действия. Щелкните **APPLICATIONID**.<br> ![Добавление параметров учетной записи Azure RM](media/automation-first-runbook-graphical/Connect-AzureRmAccount-params.png)
1. На странице "Значение параметра" выберите для параметра **Источник данных** значение **Выходные данные действия**, в списке выберите **Get Run As Connection** (Получить подключение запуска от имени), в текстовом поле **Путь поля** введите текст **ApplicationId**, а затем нажмите кнопку **OК**. Для элемента "Путь поля" определяется имя свойства, так как действие выводит объект с несколькими свойствами.
1. Щелкните **CERTIFICATETHUMBPRINT** и на странице "Значение параметра" выберите для параметра **Источник данных** значение **Выходные данные действия**. В списке выберите **Get Run As Connection** (Получить подключение запуска от имени), в текстовом поле **Field path** (Путь к полю) введите **CertificateThumbprint**, а затем нажмите кнопку **OК**.
1. Щелкните **SERVICEPRINCIPAL** и на странице "Значение параметра" выберите для параметра **Источник данных** значение **ConstantValue**. Затем выберите значение **True** и нажмите кнопку **OК**.
1. Щелкните **TENANTID** и на странице "Значение параметра" выберите для параметра **Источник данных** значение **Выходные данные действия**. В списке выберите **Get Run As Connection** (Получить подключение запуска от имени), в текстовом поле **Field path** (Путь к полю) введите **TenantId**, а затем дважды нажмите кнопку **OК**.
1. В элементе управления "Библиотека" введите в поле поиска текст **Set-AzureRmContext** .
1. Добавьте на холст командлет **Set-AzureRmContext** .
1. На холсте выберите **Set-AzureRmContext** и в области управления конфигурацией в текстовое поле **Метка** введите текст **Указать идентификатор подписки**.
1. Щелкните **Параметры**, чтобы открыть страницу "Конфигурация параметров действия".
1. Командлет **Set-AzureRmContext** имеет несколько наборов параметров. Нужно выбрать один из них, прежде чем вводить значения параметров. Щелкните **Набор параметров** и выберите набор параметров **SubscriptionId**.
1. Параметры из выбранного набора появятся на странице конфигурации параметров действия. Щелкните **SubscriptionID**
1. На странице "Значение параметра" для параметра **Источник данных** выберите значение **Ресурс-контейнер переменной**, а затем в списке выберите **AzureSubscriptionId** и дважды нажмите кнопку **OК**.
1. Наведите указатель мыши на элемент **Login to Azure** (Выполнить вход в Azure), чтобы в нижней части элемента появился кружок. Щелкните этот кружок и перетащите стрелку к элементу **Specify Subscription Id**(Указать идентификатор подписки).

> [!IMPORTANT]
> Теперь **Connect-AzureRmAccount** является псевдонимом командлета **Connect-AzureRMAccount**. Если при поиске в библиотеке элементов вы не видите элемент **Connect-AzureRMAccount**, можно использовать **Connect-AzureRmAccount** или обновить модули в своей учетной записи службы автоматизации.

Теперь модуль Runbook должен выглядеть примерно так:  <br>![Настройка проверки подлинности Runbook](media/automation-first-runbook-graphical/runbook-auth-config.png)

## <a name="add-activity-to-start-a-vm"></a>Добавление действия для запуска виртуальной машины

Теперь добавьте действие **Start-AzureRmVM** для запуска виртуальной машины. Вы можете выбрать любую виртуальную машину в своей подписке Azure. Имя этой машины будет прописано в коде командлета.

1. В элементе управления "Библиотека" введите в поле поиска текст **Start-AzureRm** .
2. Добавьте на холст командлет **Start-AzureRmVM**, а затем перетащите его под элемент **Specify Subscription Id** (Указать идентификатор подписки).
1. Наведите указатель мыши на элемент **Specify Subscription Id** (Указать идентификатор подписки), чтобы в нижней части элемента появился кружок. Щелкните этот кружок и перетащите стрелку к элементу **Start-AzureRmVM**.
1. Выберите **Start-AzureRmVM**. Щелкните **Параметры**, а затем выберите **Набор параметров**, чтобы просмотреть наборы параметров для командлета **Start-AzureRmVM**. Выберите набор параметров **ResourceGroupNameParameterSetName** . Рядом с параметрами **ResourceGroupName** и **Name** стоят восклицательные знаки. Это означает, что данные параметры являются обязательными. Также оба параметра ожидают ввода строковых значений.
1. Выберите параметр **Имя**. В поле **Источник данных** выберите **Выражение PowerShell** и введите имя виртуальной машины (в двойных кавычках), которую следует запускать при помощи этого модуля runbook. Последовательно выберите **ОК**.
1. Выберите **ResourceGroupName**. Укажите для параметра **Выражение PowerShell** в поле **Выходные данные действия** и введите имя группы ресурсов, заключенное в двойные кавычки. Последовательно выберите **ОК**.
1. Щелкните область тестирования, чтобы проверить модуль runbook.
1. Щелкните **Пуск** , чтобы начать тестирование. После завершения теста проверьте, запущена ли виртуальная машина.

Теперь модуль Runbook должен выглядеть примерно так:  <br>![Настройка проверки подлинности Runbook](media/automation-first-runbook-graphical/runbook-startvm.png)

## <a name="add-additional-input-parameters"></a>Добавление дополнительных входных параметров

Сейчас модуль runbook запускает виртуальную машину в группе ресурсов, указанной в командлете **Start-AzureRmVM**. Модуль runbook был бы полезнее, если бы при его запуске мы могли указать оба значения. Для этого добавьте в модуль runbook входные параметры.

1. Откройте графический редактор, щелкнув **Изменить** в области **MyFirstRunbook-Graphical**.
1. Выберите **Входные и выходные данные**, а затем выберите **Добавить входные данные**, чтобы открыть область входных параметров для runbook.
1. Укажите для параметра *Имя* значение **ИмяВМ**. Для параметра **Тип** оставьте значение *Строка*, но для параметра **Обязательный** выберите значение *Да*. Последовательно выберите **ОК**.
1. Создайте второй обязательный входной параметр с именем *ResourceGroupName* и нажмите кнопку **ОК**, чтобы закрыть область **Входные и выходные данные**.<br> ![Входные параметры Runbook](media/automation-first-runbook-graphical/start-azurermvm-params-outputs.png)
1. Выберите действие **Start-AzureRmVM** и щелкните **Параметры**.
1. В поле **Источник данных** для параметра **Имя** задайте значение **Runbook input** (Входные данные Runbook), а затем выберите **VMName**.
1. В поле **Источник данных** для параметра **ResourceGroupName** задайте значение **Runbook input** (Входные данные Runbook), а затем выберите **ResourceGroupName**.<br> ![Параметры командлета Start-AzureVM](media/automation-first-runbook-graphical/start-azurermvm-params-runbookinput.png)
1. Сохраните модуль Runbook и откройте область тестирования. Теперь вы можете указать значения двух входных переменных, которые будут использоваться в тесте.
1. Закройте область тестирования.
1. Щелкните **Опубликовать** , чтобы опубликовать новую версию модуля Runbook.
1. Остановите виртуальную машину, запущенную на предыдущем этапе.
1. Щелкните **Пуск** , чтобы запустить модуль Runbook. Введите значения **VMName** и **ResourceGroupName** для виртуальной машины, которую нужно запустить.
1. Когда модуль Runbook будет выполнен, проверьте, запустилась ли виртуальная машина.

## <a name="create-a-conditional-link"></a>Создание условной связи

Теперь измените модуль runbook, чтобы он запускал виртуальную машину только в том случае, если она еще не запущена. Для этого добавьте в Runbook командлет **Get-AzureRmVM**, который получает текущее состояние виртуальной машины. Затем добавьте модуль кода с именем **Get Status** для рабочего процесса PowerShell. Фрагмент кода PowerShell в этом модуле будет определять состояние виртуальной машины (запущена или остановлена). Условная связь между модулем **Get Status** и действием **Start-AzureRmVM** позволит запускать действие, только если виртуальная машина остановлена. Также выведите сообщение с информацией о том, удалось ли командлету PowerShell Write-Output запустить виртуальную машину.

1. Откройте **MyFirstRunbook-Graphical** в графическом редакторе.
1. Удалите связь между элементами **Specify Subscription Id** (Указать идентификатор подписки) и **Start-AzureRmVM**. Для этого щелкните ее и нажмите клавишу *Delete*.
1. В элементе управления "Библиотека" введите в поле поиска текст **Get-AzureRm** .
1. Добавьте на холст командлет **Get-AzureRmVM** .
1. Выберите **Get-AzureRmVM**, а затем — **Набор параметров**, чтобы просмотреть наборы параметров для командлета **Get-AzureRmVM**. Выберите набор параметров **GetVirtualMachineInResourceGroupNameParamSet** . Рядом с параметрами **ResourceGroupName** и **Name** стоят восклицательные знаки. Это означает, что данные параметры являются обязательными. Также оба параметра ожидают ввода строковых значений.
1. В поле **Источник данных** для параметра **Имя** укажите значение **Runbook input** (Входные данные Runbook), а затем выберите **VMName**. Последовательно выберите **ОК**.
1. В поле **Источник данных** для параметра **ResourceGroupName** укажите значение **Runbook input** (Входные данные Runbook), а затем выберите **ResourceGroupName**. Последовательно выберите **ОК**.
1. В поле **Источник данных** для параметра **Состояние** выберите **Значение-константа**, а затем щелкните **True**. Последовательно выберите **ОК**.
1. Создайте связь, ведущую от элемента **Specify Subscription Id** (Указать идентификатор подписки) к **Get-AzureRmVM**.
1. В элементе управления "Библиотека" разверните элемент **Управление Runbook** и добавьте на холст элемент **Код**.  
1. Создайте связь, ведущую от командлета **Get-AzureRmVM** к элементу **Код**.  
1. Щелкните **Код** и в области конфигурации измените значение метки на **Get Status** (Получить состояние).
1. Выберите параметр **Код**. Откроется страница **Редактор кода**.  
1. В редакторе кода вставьте этот фрагмент кода:

    ```powershell-interactive
     $StatusesJson = $ActivityOutput['Get-AzureRmVM'].StatusesText
     $Statuses = ConvertFrom-Json $StatusesJson
     $StatusOut =""
     foreach ($Status in $Statuses){
     if($Status.Code -eq "Powerstate/running"){$StatusOut = "running"}
     elseif ($Status.Code -eq "Powerstate/deallocated") {$StatusOut = "stopped"}
     }
     $StatusOut
     ```

1. Создайте связь, ведущую от элемента **Get Status** (Получить состояние) к **Start-AzureRmVM**.<br> ![Runbook с модулем кода](media/automation-first-runbook-graphical/runbook-startvm-get-status.png)  
1. Выберите эту связь и в области конфигурации измените значение параметра **Apply condition** (Применить условие) на **Да**. Обратите внимание, что связь станет пунктирной. Это означает, что целевое действие будет выполняться только при соблюдении условия.  
1. В поле **Выражение условия**введите *$ActivityOutput['Get Status'] -eq "Stopped"*. **Start-AzureRmVM** выполняется, только если виртуальная машина остановлена.
1. В элементе управления "Библиотека" разверните узел **Командлеты** и выберите **Microsoft.PowerShell.Utility**.
1. Дважды добавьте командлет **Write-Output** на холст.
1. В первом элементе управления **Write-Output** щелкните **Параметры** и укажите для параметра **Метка** значение *Notify VM Started* (Сообщить о запуске виртуальной машины).
1. Для параметра **InputObject** измените значение в поле **Источник данных** на **PowerShell expression** (Выражение PowerShell) и введите выражение *$VMName successfully started*.
1. Во втором элементе управления **Write-Output** щелкните **Параметры** и укажите для параметра **Метка** значение *Notify VM Start Failed* (Сообщить о сбое при запуске виртуальной машины).
1. Для параметра **InputObject** измените значение в поле **Источник данных** на **PowerShell expression** (Выражение PowerShell) и введите выражение *$VMName could not start*.
1. Создайте связь, ведущую от **Start-AzureRmVM** к элементу **Notify VM Started** (Сообщить о запуске виртуальной машины), и еще одну, ведущую к элементу **Notify VM Start Failed** (Сообщить о сбое при запуске виртуальной машины).
1. Выберите связь, ведущую к элементу **Notify VM Started** (Сообщить о запуске виртуальной машины), и укажите для параметра**Apply condition** (Применить условие) значение **True**.
1. В поле **Выражение условия**введите *$ActivityOutput['Start-AzureRmVM'].IsSuccessStatusCode -eq $true*. Теперь этот элемент управления Write-Output выполняется только тогда, когда успешно запустится виртуальная машина.
1. Выберите связь, ведущую к элементу **Notify VM Start Failed** (Сообщить о сбое при запуске виртуальной машины), и укажите для параметра **Apply condition** (Применить условие) значение **True**.
1. В поле **Выражение условия**введите *$ActivityOutput['Start-AzureRmVM'].IsSuccessStatusCode -ne $true*. Теперь этот элемент управления Write-Output будет выполняться только тогда, когда виртуальная машина не сможет запуститься. Теперь runbook должен выглядеть примерно так: <br> ![Runbook с командлетом Write-Output](media/automation-first-runbook-graphical/runbook-startazurermvm-complete.png)
1. Сохраните модуль Runbook и откройте область тестирования.
1. Запустите модуль Runbook при остановленной виртуальной машине; модуль должен запуститься.

## <a name="next-steps"></a>Дополнительная информация

* Дополнительные сведения о графической разработке см. в статье [Графическая разработка в службе автоматизации Azure](automation-graphical-authoring-intro.md).
* Сведения о том, как начать работу с модулями Runbook, см. в статье [Мой первый модуль Runbook PowerShell](automation-first-runbook-textual-powershell.md).
* Чтобы приступить к работе с модулями Runbook рабочих процессов PowerShell, обратитесь к статье [Мой первый модуль Runbook рабочего процесса PowerShell](automation-first-runbook-textual.md)

