---
title: Создание задачи наблюдателя в учетной записи службы автоматизации Azure
description: Узнайте, как создать задачу наблюдателя в учетной записи службы автоматизации Azure, чтобы отслеживать создание файлов в папке.
services: automation
ms.service: automation
ms.component: process-automation
author: eamonoreilly
ms.author: eamono
ms.topic: conceptual
ms.date: 03/19/2017
ms.openlocfilehash: 0cc215d6643c86460a1d5471aa1eed8fdf18e028
ms.sourcegitcommit: eb75f177fc59d90b1b667afcfe64ac51936e2638
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/16/2018
ms.locfileid: "34194739"
---
# <a name="create-an-azure-automation-watcher-tasks-to-track-file-changes-on-a-local-machine"></a>Создание задач службы "Наблюдатель за автоматизацией Azure" для отслеживания изменений файлов на локальном компьютере

Служба автоматизации Azure использует задачи службы "Наблюдатель" для слежения за событиями и активации действий. В этом руководстве пошагово описывается создание задачи службы "Наблюдатель" для отслеживания добавления новых файлов в каталог.

Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * Импорт runbook службы "Наблюдатель"
> * Создание переменной службы автоматизации
> * Создание runbook действия
> * Создание задачи службы "Наблюдатель"
> * Активация службы "Наблюдатель"
> * Изучение выходных данных

## <a name="prerequisites"></a>предварительным требованиям

Ниже перечислены необходимые условия для выполнения инструкций из этого руководства.

* Подписка Azure. Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или [зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* [Учетная запись службы автоматизации](automation-offering-get-started.md) для хранения runbook наблюдателя, runbook действия и задачи наблюдателя.
* [Гибридная рабочая роль runbook](automation-hybrid-runbook-worker.md), в которой выполняется задача наблюдателя.

## <a name="import-a-watcher-runbook"></a>Импорт runbook службы "Наблюдатель"

В этом руководстве для поиска новых файлов в каталоге используется runbook службы "Наблюдатель" **Watch-NewFile**. Runbook службы "Наблюдатель" получает время последней записи в файлы в папке и ищет файлы, для которых это значение не превышает заданный предел. На этом шаге выполняется импорт этого runbook в учетную запись службы автоматизации.

1. Откройте учетную запись службы автоматизации и щелкните на странице **Модули Runbook**.
1. Нажмите кнопку **Просмотреть коллекцию**.
1. Найдите пункт "Watcher runbook" (Runbook службы "Наблюдатель"), выберите **Watcher runbook that looks for new files in a directory** (Runbook службы "Наблюдатель", который ищет новые файлы в каталоге) и щелкните **Импорт**.
  ![Импорт runbook службы автоматизации с помощью пользовательского интерфейса](media/automation-watchers-tutorial/importsourcewatcher.png)
1. Укажите имя и описание runbook, затем нажмите кнопку **ОК**, чтобы импортировать runbook в учетную запись службы автоматизации.
1. Щелкните **Изменить**, затем щелкните **Опубликовать**. При появлении соответствующего запроса выберите **Да** для публикации runbook.

## <a name="create-an-automation-variable"></a>Создание переменной службы автоматизации

[Переменная службы автоматизации](automation-variables.md) используется для хранения меток времени, которые приведенный выше runbook считывает из каждого файла и сохраняет. 

1. Выберите **Переменные** в разделе **Общие ресурсы**, затем щелкните **+ Добавить переменную**.
1. Введите имя "Watch-NewFileTimestamp".
1. Выберите тип "Дата и время".
1. Нажмите кнопку **Создать**. Будет создана переменная автоматизации.

## <a name="create-an-action-runbook"></a>Создание runbook действия.

Runbook действия используется в задаче службы "Наблюдатель" для работы с данными, передаваемыми в нее из runbook службы "Наблюдатель". На этом шаге импортируется предварительно определенный runbook действия Process-NewFile.

1. Перейдите к своей учетной записи службы автоматизации и в категории **Автоматизация процессов** выберите **Модули Runbook**.
1. Нажмите кнопку **Просмотреть коллекцию**.
1. Найдите пункт "Watcher action" (Действие службы "Наблюдатель"), выберите **Watcher action that processes events triggered by a watcher runbook** (Действие службы "Наблюдатель", обрабатывающее события, активированные runbook службы "Наблюдатель") и щелкните **Импорт**.
  ![Импорт runbook действия с помощью пользовательского интерфейса](media/automation-watchers-tutorial/importsourceaction.png)
1. Укажите имя и описание runbook, затем нажмите кнопку **ОК**, чтобы импортировать runbook в учетную запись службы автоматизации.
1. Щелкните **Изменить**, затем щелкните **Опубликовать**. При появлении соответствующего запроса выберите **Да** для публикации runbook.

## <a name="create-a-watcher-task"></a>Создание задачи службы "Наблюдатель"

Задача службы "Наблюдатель" состоит из двух частей. Службы "Наблюдатель" и действия. Служба "Наблюдатель" выполняется с интервалом, определенным в задаче службы "Наблюдатель". Данные из runbook службы "Наблюдатель" передаются в runbook действия. На этом этапе настраивается задача службы "Наблюдатель", указывающая на runbook службы "Наблюдатель" и runbook действия, определенные на предыдущих шагах.

1. Перейдите к своей учетной записи службы автоматизации и в категории **Автоматизация процессов** выберите **Задачи наблюдателя**.
1. Откройте страницу "Задачи наблюдателя" и нажмите кнопку **+ Добавить задачу наблюдателя**.
1. Введите имя "WatchMyFolder".

1. Нажмите **Настройка наблюдателя** и выберите runbook **Watch-NewFile**.

1. Введите следующие значения параметров.

   * **FOLDERPATH** (Путь к папке). Папка в гибридной рабочей роли, где создаются файлы. d:\examplefiles
   * **EXTENSION** (Расширение). Оставьте поле пустым, чтобы обрабатывались все расширения файлов.
   * **RECURSE** (Рекурсия). Оставьте это значение по умолчанию.
   * **RUN SETTINGS** (Параметры запуска). Выберите гибридную рабочую роль.

1. Нажмите кнопку "ОК" и щелкните "Выбрать", чтобы вернуться на страницу наблюдателя.
1. Щелкните **Настройка действия** и выберите runbook с именем Process-NewFile.
1. Введите следующие значения параметров:

   *    **EVENTDATA** (Данные событий). Оставьте это поле пустым. Данные передаются из runbook наблюдателя.  
   *    **Run Settings** (Параметры запуска). Оставьте значение Azure, так как этот runbook выполняется в службе автоматизации.

1. Нажмите кнопку **ОК** и щелкните "Выбрать", чтобы вернуться на страницу службы "Наблюдатель".
1. Нажмите кнопку **ОК**, чтобы создать задачу службы "Наблюдатель".

![Настройка действия службы "Наблюдатель" с помощью пользовательского интерфейса](media/automation-watchers-tutorial/watchertaskcreation.png)

## <a name="trigger-a-watcher"></a>Активация службы "Наблюдатель"

Чтобы проверить, работает ли служба "Наблюдатель" надлежащим образом, необходимо создать тестовый файл.

Установите удаленное подключение к гибридной рабочей роли. Откройте **PowerShell** и создайте тестовый файл в папке.
  
   ```PowerShell-interactive
   New-Item -Name ExampleFile1.txt
   ```

В следующем примере показаны ожидаемые выходные данные.

```
    Directory: D:\examplefiles


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       12/11/2017   9:05 PM              0 ExampleFile1.txt
```

## <a name="inspect-the-output"></a>Изучение выходных данных

1. Перейдите к своей учетной записи службы автоматизации и в категории **Автоматизация процессов** выберите **Задачи наблюдателя**.
1. Щелкните задачу службы "Наблюдатель" WatchMyFolder.
1. Щелкните **Просмотреть потоки наблюдателей** в разделе **Потоки**, чтобы убедиться, что службой "Наблюдатель" обнаружен новый файл и запущен runbook действия.
1. Щелкните **Просмотреть задания действий наблюдателя**, чтобы просмотреть задания runbook действия. Вы можете выбрать каждое задание, чтобы просмотреть сведения о нем.

   ![Задания действия службы "Наблюдатель" в пользовательском интерфейсе](media/automation-watchers-tutorial/WatcherActionJobs.png)

Ожидаемые выходные данные при обнаружении нового файла можно увидеть в следующем примере.

```
Message is Process new file...



Passed in data is @{FileName=D:\examplefiles\ExampleFile1.txt; Length=0}
```

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * Импорт runbook службы "Наблюдатель"
> * Создание переменной службы автоматизации
> * Создание runbook действия
> * Создание задачи службы "Наблюдатель"
> * Активация службы "Наблюдатель"
> * Изучение выходных данных

Перейдите по ссылке для получения дополнительных сведений о создании собственного runbook.

> [!div class="nextstepaction"]
> [Мой первый модуль Runbook PowerShell](automation-first-runbook-textual-powershell.md)
