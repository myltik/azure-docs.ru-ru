---
title: Интеграция системы управления версиями службы автоматизации Azure с GitHub Enterprise
description: В статье описано, как настроить интеграцию модулей Runbook системы управления версиями службы автоматизации с GitHub Enterprise.
services: automation
ms.service: automation
author: georgewallace
ms.author: gwallace
ms.date: 04/17/2018
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 685d434affd0561658ae99c50bbe7b1fc27a5572
ms.sourcegitcommit: eb75f177fc59d90b1b667afcfe64ac51936e2638
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/16/2018
ms.locfileid: "34195528"
---
# <a name="azure-automation-scenario---automation-source-control-integration-with-github-enterprise"></a>Сценарий службы автоматизации Azure: интеграция системы управления версиями службы автоматизации с GitHub Enterprise

Служба автоматизации сейчас поддерживает интеграцию системы управления версиями. Благодаря этому вы можете связать модули Runbook в своей учетной записи службы автоматизации с репозиторием системы управления версиями GitHub. Тем не менее клиенты, развернувшие [GitHub Enterprise](https://enterprise.github.com/home) для поддержки своих решений DevOps, также хотят использовать это развертывание для управления жизненным циклом модулей Runbook, разработанных для автоматизации бизнес-процессов и операций управления службами.

В этом сценарии используется компьютер Windows в центре обработки данных, настроенном в качестве гибридной рабочей роли Runbook, на котором установлены модулями Azure Resource Manager и инструменты Git. На компьютере с гибридной рабочей ролью установлен клон локального репозитория. При запуске модуля Runbook в гибридной рабочей роли каталог Git синхронизируется, а содержимое файла модуля импортируется в учетную запись службы автоматизации.

В этой статье рассказывается, как настроить такую конфигурацию в среде службы автоматизации Azure. Вы начнете работу с настройки учетных данных, обеспечивающих безопасность службы автоматизации, модулей runbook, необходимых для поддержки этого сценария, и развертывания гибридной рабочей роли Runbook в центре обработки данных. Это необходимо для запуска модулей runbook и доступа к репозиторию GitHub Enterprise для синхронизации модулей runbook с учетной записью службы автоматизации.

## <a name="getting-the-scenario"></a>Получение сценария

В сценарии используются два модуля Runbook PowerShell, которые можно импортировать непосредственно из [коллекции модулей Runbook](automation-runbook-gallery.md) на портале Azure или скачать из [коллекции PowerShell](https://www.powershellgallery.com).

### <a name="runbooks"></a>Модули Runbook

Модуль Runbook | ОПИСАНИЕ|
--------|------------|
Export-RunAsCertificateToHybridWorker | Runbook экспортирует сертификат запуска от имени из учетной записи службы автоматизации в гибридную рабочую роль, чтобы модули runbook в рабочей роли, импортируемые в учетную запись службы автоматизации, могли проходить аутентификацию с помощью Azure.|
Sync-LocalGitFolderToAutomationAccount | Runbook синхронизирует локальную папку Git на компьютере с гибридной рабочей ролью, а затем импортирует файлы runbook (PS1-файлы) в учетную запись автоматизации.|

### <a name="credentials"></a>Учетные данные

Учетные данные | ОПИСАНИЕ|
-----------|------------|
GitHRWCredential | Создаваемый ресурс учетных данных, содержащий имя и пароль пользователя с разрешениями на доступ к гибридной рабочей роли.|

## <a name="installing-and-configuring-this-scenario"></a>Установка и настройка данного сценария

### <a name="prerequisites"></a>предварительным требованиям

1. Модуль Runbook Sync-LocalGitFolderToAutomationAccount выполняет проверку подлинности с использованием [учетной записи запуска от имени Azure](automation-sec-configure-azure-runas-account.md).

2. Рабочая область Log Analytics с включенным и настроенным решением службы автоматизации Azure. Если у вас нет такой области, связанной с учетной записью службы автоматизации, используемой для установки и настройки этого сценария, она будет создана и настроена автоматически при выполнении сценария **New-OnPremiseHybridWorker.ps1** из гибридной рабочей роли Runbook.

    > [!NOTE]
    > Сейчас интеграция службы автоматизации с Log Analytics поддерживается только для следующих регионов: **Юго-Восточная Австралия**, **Восточная часть США 2**, **Юго-Восточная Азия** и **Западная Европа**.

3. Компьютер, который можно использовать в качестве выделенной гибридной рабочей роли Runbook. На нем также будут размещены ПО GitHub и файлы Runbook (*runbook*.ps1) в исходном каталоге файловой системы для синхронизации между GitHub и учетной записью службы автоматизации.

### <a name="import-and-publish-the-runbooks"></a>Импорт и публикация модулей Runbook

Чтобы импортировать модули runbook *Export-RunAsCertificateToHybridWorker* и *Sync-LocalGitFolderToAutomationAccount* из коллекции модулей runbook своей учетной записи службы автоматизации на портале Azure, выполните процедуры, описанные разделе [Импорт модуля Runbook из коллекции Runbook с помощью портала Azure](automation-runbook-gallery.md#to-import-a-runbook-from-the-runbook-gallery-with-the-azure-portal). Опубликуйте каждый импортированный в учетную запись службы автоматизации модуль Runbook.

### <a name="deploy-and-configure-hybrid-runbook-worker"></a>Развертывание и настройка гибридной рабочей роли Runbook

Если у вас нет гибридной рабочей роли Runbook, развернутой в центре обработки данных, ознакомьтесь с требованиями и выполните действия по автоматической установке, используя процедуру в гибридных рабочих ролях Runbook службы автоматизации Azure (автоматизация установки и настройки) для [Windows](automation-windows-hrw-install.md#automated-deployment) или [Linux](automation-linux-hrw-install.md#installing-linux-hybrid-runbook-worker). Установив гибридную рабочую роль на компьютере, выполните следующие действия, чтобы завершить настройку для поддержки этого сценария.

1. Войдите на компьютер, на котором размещена гибридная рабочая роль Runbook, используя учетную запись с правами локального администратора, и создайте каталог для хранения файлов runbook Git. Клонируйте внутренний репозиторий Git в этот каталог.
1. Если вы еще не создали учетную запись запуска от имени или хотите создать новую (специально предназначенную для этой цели), на портале Azure перейдите к учетным записям службы автоматизации, выберите свою учетную запись и создайте [ресурс учетных данных](automation-credentials.md). Этот ресурс должен содержать имя пользователя и пароль для пользователя с разрешениями на доступ к гибридной рабочей роли.
1. Из учетной записи службы автоматизации [измените модуль Runbook](automation-edit-textual-runbook.md) **Export-RunAsCertificateToHybridWorker**, заменив значение переменной *$Password* надежным паролем.  Заменив значение, щелкните **Опубликовать** для публикации черновой версии модуля Runbook.
1. Запустите модуль Runbook **Export-RunAsCertificateToHybridWorker**, а затем в колонке **Запуск Runbook** в разделе **Параметры запуска** щелкните **Гибридная рабочая роль**. В раскрывающемся списке выберите созданную ранее в этом сценарии группу гибридной рабочей роли.

    Сертификат будет экспортирован в гибридную рабочую роль, чтобы модули runbook в рабочей роли могли проходить аутентификацию в Azure с помощью подключения запуска от имени. Это необходимо для управления ресурсами Azure (а в этом сценарии — для импорта модулей runbook в учетную запись службы автоматизации).

1. В учетной записи службы автоматизации выберите созданную ранее группу гибридных рабочих ролей и [укажите учетную запись запуска от имени](automation-hrw-run-runbooks.md#runas-account) для нее. Затем выберите созданный (сейчас или ранее) ресурс учетных данных. После этого модуль Runbook для синхронизации сможет запускать команды Git. 
1. Запустите модуль Runbook **Sync-LocalGitFolderToAutomationAccount**, укажите следующие обязательные значения для входных параметров, а затем в колонке **Запуск Runbook** в разделе **Параметры запуска** щелкните **Гибридная рабочая роль**. В раскрывающемся списке выберите созданную ранее в этом сценарии группу гибридной рабочей роли.

   * *ResourceGroupName* — имя группы ресурсов, связанной с вашей учетной записью службы автоматизации.
   * *AutomationAccountName* — имя учетной записи службы автоматизации;
   * *GitPath* — локальная папка или файл в гибридной рабочей роли Runbook, куда Git в соответствии с настройками извлекает последние изменения.

    Это обеспечит синхронизацию локальной папки Git на компьютере гибридной рабочей роли и последующий импорт PS1-файлов из исходного каталога в учетную запись службы автоматизации.

1. Чтобы просмотреть сводные данные о состоянии заданий модуля Runbook, выберите этот модуль в колонке **Модули Runbook** учетной записи службы автоматизации и щелкните плитку **Задания**. Щелкните плитку **Все журналы** и проверьте подробный поток журнала, чтобы убедиться, что задание выполнено.

## <a name="next-steps"></a>Дополнительная информация

* Чтобы получить дополнительные сведения о типах модулей Runbook, их преимуществах и ограничениях, обратитесь к статье [Типы модулей Runbook в службе автоматизации Azure](automation-runbook-types.md)
* Дополнительные сведения о функции поддержки скриптов PowerShell см. в статье [Announcing Native PowerShell Script Support in Azure Automation](https://azure.microsoft.com/blog/announcing-powershell-script-support-azure-automation-2/) (Встроенная поддержка скриптов PowerShell в службе автоматизации Azure).
