---
title: Обработка ошибок в графических модулях Runbook в службе автоматизации Azure
description: В этой статье описывается, как реализовать логику обработки ошибок в графических модулях Runbook в службе автоматизации Azure.
services: automation
ms.service: automation
ms.component: process-automation
author: georgewallace
ms.author: gwallace
ms.date: 03/16/2018
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 14112a9a9f64f20540a8f7e1d37cd31017238e59
ms.sourcegitcommit: eb75f177fc59d90b1b667afcfe64ac51936e2638
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/16/2018
ms.locfileid: "34192716"
---
# <a name="error-handling-in-azure-automation-graphical-runbooks"></a>Обработка ошибок в графических модулях Runbook в службе автоматизации Azure

При проектировании модулей Runbook крайне важно определить различные состояния и условия, характерные для действий в модуле, например состояние успеха, состояния ожидаемых ошибок и условия непредвиденных ошибок.

Модули Runbook должны включать обработку ошибок. Чтобы проверить выходные данные действия или обработать ошибку с помощью графических модулей Runbook, можно использовать действие кода Windows PowerShell, определить условную логику в ссылке выходных данных действия или применить другой метод.          

Зачастую, если при выполнении модулей Runbook с каким-либо действием возникает устранимая ошибка, последующее действие будет обрабатываться обычным образом. Ошибка, вероятнее всего, вызовет исключение, но следующее действие по-прежнему может быть выполнено. Именно таким образом PowerShell обрабатывает ошибки.    

Во время выполнения могут возникнуть неустранимые и устранимые ошибки PowerShell. Ниже приведены различия между неустранимыми и устранимыми ошибками.

* **Неустранимая ошибка:** серьезная ошибка, возникающая во время выполнения, которая полностью прерывает выполнение команды (или скрипта). К примерам можно отнести несуществующие командлеты, синтаксические ошибки, предотвращающие выполнение командлета, или другие неустранимые ошибки.

* **Устранимая ошибка:** несерьезная ошибка, которая не останавливает выполнение. Примеры включают ошибки из-за отсутствия файла и проблемы с разрешениями.

Графические модули Runbook службы автоматизации Azure теперь включают возможность обработки ошибок. Теперь можно преобразовывать исключения в устранимые ошибки и создавать ссылки ошибок между действиями. Этот процесс позволит автору модуля Runbook настроить перехват ошибок и управлять реализованными или непредвиденными условиями.  

## <a name="when-to-use-error-handling"></a>Применение обработки ошибок

При наличии критичного действия, которое вызывает ошибку или исключение, важно предотвратить выполнение следующего действия в модуле Runbook и соответствующим образом обработать ошибку. Это особенно важно, если модули Runbook поддерживают бизнес-процессы или операции, связанные со службами.

Для каждого действия, которое может вызвать ошибку, автор модуля Runbook может добавить ссылку ошибки, указывающую на любое другое действие. Действие назначения может быть любого типа: действие кода, вызов командлета, вызов другого модуля Runbook и т. д.

Кроме того, действие назначения может также иметь исходящие ссылки. Это могут быть обычные ссылки или ссылки ошибок. Таким образом автор модуля Runbook может применять сложную логику обработки ошибок, не требующую использования действия кода. Рекомендуется создать выделенный модуль Runbook для обработки ошибок с общими функциональными возможностями. Но это необязательно. Определение логики обработки ошибок в действии кода PowerShell не является единственным методом.  

Например, рассмотрим модуль Runbook, который пытается запустить виртуальную машину и установить на нее приложение. Если виртуальная машина запускается неправильно, модуль Runbook выполняет два действия:

1. Отправляет уведомление об этой проблеме.
2. Запускает другой модуль Runbook, который автоматически подготавливает новую виртуальную машину.

В этом случае можно создать ссылку ошибки, указывающую на действие для обработки шага 1, например связать командлет **Write-Warning** с действием шага 2 (к примеру, командлет **Start-AzureRmAutomationRunbook**).

Можно также обобщить это поведение для нескольких модулей Runbook, помещая эти два действия в отдельные модули для обработки ошибок, следуя рекомендациям, приведенным выше. Перед вызовом этого модуля Runbook для обработки ошибок можно создать пользовательское сообщение на основе данных в исходном модуле и передать его как параметр в модуль для обработки ошибок.

## <a name="how-to-use-error-handling"></a>Способы использования обработки ошибок

Каждое действие настроено для преобразования исключений в устранимые ошибки. Эта функция отключена по умолчанию. Рекомендуется включить эту функцию для любого действия, требующего обработки ошибок.  

Включая эту конфигурацию, неустранимые и устранимые ошибки в действии будут обрабатываться как устранимые, а затем к ним может быть применена ссылка ошибки.  

После настройки этого параметра создайте действие, которое будет обрабатывать ошибку. Если действие вызовет ошибку, будет выполнен переход только по исходящим ссылкам ошибок, а по обычным — нет, даже если в результате выполнения действия были сформированы стандартные выходные данные.<br><br> ![Пример ссылки ошибки в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/error-link-example.png)

В следующем примере модуль Runbook получает переменную, содержащую имя компьютера виртуальной машины. Затем он пытается запустить виртуальную машину в следующем действии.<br><br> ![Пример обработки ошибок в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/runbook-example-error-handling.png)<br><br>      

Действия **Get-AutomationVariable** и **Start-AzureRmVm** настроены для преобразования исключений в ошибки. Если не удается получить переменную или запустить виртуальную машину, возникнут ошибки.<br><br> ![Параметры действия обработки ошибок в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/activity-blade-convertexception-option.png)

Ссылки ошибок ведут от этих действий к одному действию **управления ошибками** (действие кода). Это действие настраивается с помощью простого выражения PowerShell, которое использует ключевое слово *Throw* для остановки обработки, а также для *$Error.Exception.Message*, чтобы получить сообщение, описывающее текущее исключение.<br><br> ![Пример кода для обработки ошибок в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/runbook-example-error-handling-code.png)


## <a name="next-steps"></a>Дополнительная информация

* Дополнительные сведения о ссылках и их типах в графических модулях Runbook см. в статье [Графическая разработка в службе автоматизации Azure](automation-graphical-authoring-intro.md#links-and-workflow).

* Дополнительные сведения о выполнении модулей Runbook, отслеживании заданий модуля Runbook и других технических деталях см. в статье [Выполнение модуля Runbook в службе автоматизации Azure](automation-runbook-execution.md).
