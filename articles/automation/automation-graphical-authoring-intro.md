---
title: Графическая разработка в службе автоматизации Azure
description: Графическая разработка позволяет создавать модули Runbook для службы автоматизации Azure без работы с кодом. Эта статья содержит вводные сведения о графическом создании и всю информацию, необходимую, чтобы приступить к созданию графического Runbook.
services: automation
ms.service: automation
author: georgewallace
ms.author: gwallace
ms.date: 03/16/2018
ms.topic: article
manager: carmonm
ms.openlocfilehash: 42187def32ea0f0605b50e0e25b7f78ebf0c10ac
ms.sourcegitcommit: 59914a06e1f337399e4db3c6f3bc15c573079832
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/19/2018
---
# <a name="graphical-authoring-in-azure-automation"></a>Графическая разработка в службе автоматизации Azure
## <a name="introduction"></a>Введение
Графическая разработка позволяет создавать модули Runbook для службы автоматизации Azure без необходимости написания кода в рамках рабочего процесса PowerShell или использования Windows PowerShell. Вы просто добавляете на холст действия из библиотеки командлетов и других действий, а затем связываете и настраиваете их, создавая рабочий процесс. Если вам приходилось работать с System Center Orchestrator или Service Management Automation (SMA), эти действия будут для вас знакомыми.

Эта статья содержит вводные сведения о графическом создании и основные понятия, необходимые, чтобы приступить к созданию графического Runbook.

## <a name="graphical-runbooks"></a>Графические модули Runbook
Все модули Runbook в службе автоматизации Azure представляют собой рабочие процессы Windows PowerShell. Графические модули Runbook и модули Runbook графического рабочего процесса PowerShell создают код PowerShell, который запускается рабочими ролями службы автоматизации. Вы не можете непосредственно просмотреть или изменить этот код. Графический модуль Runbook можно преобразовать в графический модуль Runbook рабочего процесса PowerShell и наоборот. Эти компоненты нельзя преобразовать в текстовый модуль Runbook. Существующий текстовый модуль Runbook нельзя импортировать в графический редактор.

## <a name="overview-of-graphical-editor"></a>Обзор графического редактора
Графический редактор можно открыть на портале Azure, создав или открыв для редактирования графический Runbook.

![Графическая рабочая область](media/automation-graphical-authoring-intro/runbook-graphical-editor.png)

В следующих разделах описываются элементы управления в графическом редакторе.

### <a name="canvas"></a>Холст
Холст — это место, где формируется Runbook. Вы добавляете в Runbook действия из узлов в элементе управления "Библиотека" и соединяете их с помощью связей, чтобы определить логику Runbook.

Для увеличения и уменьшения масштаба можно использовать элементы управления в нижней части холста.

### <a name="library-control"></a>Элемент управления "Библиотека"
В элементе управления "Библиотека" можно выбрать [действия](#activities) для добавления в Runbook. Вы добавляете их на холст, где соединяете с другими действиями. Он содержит четыре раздела, описанные в следующей таблице:

| Раздел | ОПИСАНИЕ |
|:--- |:--- |
| Командлеты |Включает в себя все командлеты, которые могут использоваться в модуле Runbook. Командлеты группируются по модулям. Доступны все модули, которые установлены в вашей учетной записи службы автоматизации. |
| Модули Runbook |Содержит модули Runbook в учетной записи службы автоматизации. Эти модули Runbook можно добавлять на холст, чтобы использовать их как дочерние модули. Отображаются только однотипные изменяемые модули Runbook: только модули Runbook на основе PowerShell для графических модулей и только модули Runbook на основе рабочего процесса PowerShell для графических модулей рабочего процесса PowerShell. |
| Активы |Содержит [ресурсы службы автоматизации](http://msdn.microsoft.com/library/dn939988.aspx) в вашей учетной записи службы автоматизации, которые можно использовать в модуле Runbook. При добавлении ресурса в runbook добавляется действие рабочего процесса, которое получает выбранный ресурс. В случае ресурсов переменных можно либо добавить действие для получения переменной, либо задать переменную. |
| Элемент управления "Runbook" |Содержит действия элемента управления "Runbook", которые могут использоваться в текущем модуле Runbook. *Соединение* принимает несколько наборов входных данных и ожидает завершения их обработки, прежде чем продолжать рабочий процесс. Действие *Код* выполняет одну или несколько строк кода PowerShell или рабочего процесса PowerShell в зависимости от типа графического модуля Runbook. Это действие можно использовать в пользовательском коде или функции, которую не удается реализовать иными способами. |

### <a name="configuration-control"></a>Элемент управления "Конфигурация"
Элемент управления "Конфигурация" позволяет указывать сведения для объекта, выбранного на холсте. Свойства, доступные в этом элементе управления, зависят от типа выбранного объекта. При выборе параметра в элементе управления "Конфигурация" открываются дополнительные колонки с дополнительной информацией.

### <a name="test-control"></a>Элемент управления "Тест"
Элемент управления "Тест" не отображается при первом запуске графического редактора. Он открывается, когда вы интерактивно [тестируете графический Runbook](#graphical-runbook-procedures).

## <a name="graphical-runbook-procedures"></a>Процедуры графического Runbook
### <a name="exporting-and-importing-a-graphical-runbook"></a>Экспорт и импорт графического модуля Runbook
Можно экспортировать только опубликованную версию графического модуля Runbook. Если модуль runbook еще не опубликован, кнопка **Экспорт** недоступна. При нажатии кнопки **Экспорт** модуль runbook скачивается на локальный компьютер. Имя файла соответствует имени модуля Runbook. Расширение файла — *GRAPHRUNBOOK*.

Файл графического модуля Runbook или графического модуля Runbook рабочего процесса PowerShell можно импортировать, выбрав параметр **Импорт** при добавлении модуля. При выборе файла для импорта можно сохранить то же **имя** или ввести новое. После анализа выбранного файла в поле "Тип Runbook" отобразится тип модуля Runbook. При попытке выбрать недопустимый тип отобразится сообщение, извещающее о возможных конфликтах, а само преобразование может сопровождаться синтаксическими ошибками.

![Импортировать Runbook](media/automation-graphical-authoring-intro/runbook-import-revised20165.png)

### <a name="testing-a-graphical-runbook"></a>Тестирование графического Runbook
Вы можете протестировать черновую версию Runbook на портале Azure, оставив при этом опубликованную версию Runbook без изменений, или протестировать новую версию до ее публикации. Это позволяет проверить правильность работы Runbook перед заменой опубликованной версии. При тестировании Runbook исполняется черновой Runbook и выполняются все его действия. Журнал заданий не создается, но выходные данные отображаются в области вывода теста.

Откройте элемента управления "Тест" для Runbook, открыв Runbook для редактирования и нажав кнопку **области тестирования** .

Будет предложено ввести входные параметры, после чего вы сможете запустить runbook, нажав кнопку **Запуск**.

### <a name="publishing-a-graphical-runbook"></a>Публикация графического Runbook
У каждого Runbook в службе автоматизации Azure есть черновая и опубликованная версия. Запустить можно только опубликованную версию, а изменить — только черновую. Изменения, внесенные в черновик, не влияют на опубликованную версию. Когда черновая версия готова, ее можно опубликовать, заменив опубликованную версию содержимым черновой.

Графический Runbook можно опубликовать, открыв его для редактирования и нажав кнопку **Опубликовать** .

Если Runbook еще не опубликован, он находится в состоянии **Новый**. После публикации он находится в состоянии **Опубликован**. Если изменить Runbook после публикации, и черновая и опубликованная версии отличаются, Runbook находится в состоянии **Редактирование**.

![Состояния Runbook](media/automation-graphical-authoring-intro/runbook-statuses-revised20165.png)

Также имеется возможность восстановить опубликованную версию Runbook. При этом будут отброшены все изменения, внесенные с момента последней публикации Runbook, и черновая версия Runbook будет заменена опубликованной версией.

## <a name="activities"></a>Действия
Действия являются стандартными блоками модуля Runbook. Действием может быть командлет PowerShell, дочерний Runbook или действие рабочего процесса. Вы можете добавить действия в runbook, щелкнув его правой кнопкой мыши в элементе управления "Библиотека" и выбрав пункт **Добавить на холст**. Затем можно щелкнуть и перетащить действие, чтобы поместить его на холсте туда, куда необходимо. Расположение действия на холсте никак не влияет на работу runbook. Можно по-разному располагать runbook, однако вы поймете, что удобнее всего наглядно представить его работу.

![Добавить на холст](media/automation-graphical-authoring-intro/add-to-canvas-revised20165.png)

Выберите действие на холсте, чтобы настроить его свойства и параметры в колонке "Конфигурация". Вы можете заменить **метку** действия чем-нибудь, что будет описывать его. Исходный командлет будет выполняться без изменений, вы просто меняете его отображаемое имя, которое используется в графическом редакторе. Метки должны быть уникальными в пределах Runbook.

### <a name="parameter-sets"></a>Наборы параметров
Набор параметров определяет обязательные и необязательные параметры, которые принимают значения для определенного командлета. У каждого командлета имеется по крайней мере один набор параметров, а у некоторых их несколько. Если у командлета несколько наборов параметров, перед настройкой параметров необходимо выбрать, какой из них использовать. Параметры, которые можно настроить, зависят от выбранного набора параметров. Можно изменить набор параметров, используемый действием, щелкнув **Набор параметров** и выбрав другой набор. В этом случае все настроенные значения параметров будут потеряны.

В следующем примере у командлета Get-AzureRmVM три набора параметров. Нельзя настроить значения параметров, пока не выбран один из наборов параметров. Набор параметров ListVirtualMachineInResourceGroupParamSet предназначен для возврата всех виртуальных машин в группе ресурсов. Он включает один необязательный параметр. Набор параметров **GetVirtualMachineInResourceGroupParamSet** используется для выбора виртуальной машины, которую следует вернуть. Он включает два обязательных параметра и один необязательный.

![Набор параметров](media/automation-graphical-authoring-intro/get-azurermvm-parameter-sets.png)

#### <a name="parameter-values"></a>Значения параметров
При указании значения для параметра вы выбираете источник данных, чтобы определить, как будет указано значение. Источники данных, доступные для определенного параметра, зависят от допустимых значений для этого параметра. Например, значение NULL недоступно для параметра, который не допускает значений NULL.

| источник данных | ОПИСАНИЕ |
|:--- |:--- |
| Постоянное значение |Введите значение для параметра. Доступно только для следующих типов данных: Int32, Int64, String, Boolean, DateTime, Switch. |
| Выходные данные действия |Выходные данные действия, предшествующего текущему действию в рабочем процессе. Будут перечислены все допустимые действия. Выберите действие, чтобы использовать его выходные данные для значения параметра. Если действие выводит объект с несколькими свойствами, то можно ввести имя свойства после выбора действия. |
| Входные данные Runbook |Выберите входной параметр Runbook в качестве входных данных для параметра действия. |
| Ресурс переменной |Выберите переменную службы автоматизации в качестве входных данных. |
| Ресурс учетных данных |Выберите учетные данные службы автоматизации в качестве входных данных. |
| Ресурс сертификата |Выберите сертификат службы автоматизации в качестве входных данных. |
| Ресурс подключения |Выберите подключение службы автоматизации в качестве входных данных. |
| Выражение PowerShell |Укажите простое [выражение PowerShell](#powershell-expressions). Выражение оценивается перед выполнением действия, и его результат используется в качестве значения параметра. Вы можете использовать переменные, чтобы ссылаться на выходные данные действия или входной параметр Runbook. |
| Не настроено |Очищает все значения, которые были настроены ранее. |

#### <a name="optional-additional-parameters"></a>Необязательные дополнительные параметры
Для всех командлетов можно предоставить дополнительные параметры. Это могут быть общие параметры PowerShell или другие пользовательские параметры. Появится текстовое поле, где можно будет указать параметры с помощью синтаксиса PowerShell. Например, чтобы использовать общий параметр **Verbose**, необходимо указать **"-Verbose:$True"**.

### <a name="retry-activity"></a>Повтор действий
**Режим повтора** обеспечивает многократное выполнение действий — пока не будет выполнено определенное условие, как в цикле. Эта функция используется для действий, которые необходимо выполнить несколько раз (включая те, которые могут выполняться с ошибками), а также для проверки допустимости выходных данных действия.

Включая для действия режим повтора, можно задать условие и значение задержки. Задержка — это время (в секундах или минутах) ожидания модуля runbook перед повторным выполнением действия. Если задержка не указана, действие будет повторно выполнено сразу же после завершения.

![Задержка повтора действия](media/automation-graphical-authoring-intro/retry-delay.png)

Условие повтора — это выражение PowerShell, которое вычисляется после каждого выполнения действия. Если выражение возвращает значение True, действие выполняется повторно. Если выражение возвращает значение False, действие не выполняется повторно, а модуль runbook переходит к следующему действию.

![Задержка повтора действия](media/automation-graphical-authoring-intro/retry-condition.png)

В качестве условия повтора может использоваться переменная с именем $RetryData, которая предоставляет доступ к сведениям о попытках выполнить действие. У этой переменной есть свойства, приведенные в таблице ниже.

| Свойство | ОПИСАНИЕ |
|:--- |:--- |
| NumberOfAttempts |Количество запусков действия. |
| Выходные данные |Результат последнего выполнения действия. |
| TotalDuration |Время с момента первого запуска действия. |
| StartedAt |Время первого запуска действия в формате UTC. |

Ниже приведены примеры условий, при которых действие выполняется повторно.

    # Run the activity exactly 10 times.
    $RetryData.NumberOfAttempts -ge 10

    # Run the activity repeatedly until it produces any output.
    $RetryData.Output.Count -ge 1

    # Run the activity repeatedly until 2 minutes has elapsed.
    $RetryData.TotalDuration.TotalMinutes -ge 2

Когда вы настроите для действия условия запуска повторных попыток, действие будет отображать два напоминания. Одно включено в само действие, а второе отображается при проверке конфигурации действия.

![Визуальные индикаторы повторения действия](media/automation-graphical-authoring-intro/runbook-activity-retry-visual-cue.png)

### <a name="workflow-script-control"></a>Элемент управления сценария рабочего процесса
Элемент управления "Код" — это специальное действие, которое принимает скрипт PowerShell или рабочего процесса PowerShell (в зависимости от типа создаваемого графического модуля Runbook), обеспечивая возможности, которые иначе могут быть недоступными. Он не может принимать параметры, но может использовать переменные для выходных данных действия и входных параметров Runbook. Любые выходные данные действия добавляются в шину данных, если нет исходящей связи. Если она есть, они добавляется в выходные данные Runbook.

Например, следующий код выполняет вычисление дат с помощью входной переменной runbook — $NumberOfDays. Затем он отправляет вычисленную дату и время как выходные данные для использования последующими действиями в Runbook.

    $DateTimeNow = (Get-Date).ToUniversalTime()
    $DateTimeStart = ($DateTimeNow).AddDays(-$NumberOfDays)}
    $DateTimeStart


## <a name="links-and-workflow"></a>Связи и рабочий процесс
**Связь** в графическом Runbook соединяет два действия. Она отображается на холсте как стрелка от исходного действия к действию назначения. Действия выполняются в направлении стрелки: действие назначения запускается после завершения исходного действия.

### <a name="create-a-link"></a>Создание связи
Создайте связь между двумя действиями, выбрав исходное действие и щелкнув круг в нижней части фигуры. Перетащите стрелку к действию назначения и отпустите ее.

![Создание связи](media/automation-graphical-authoring-intro/create-link-revised20165.png)

Выберите связь, чтобы настроить ее свойства в колонке "Конфигурация". К ним также относится тип связи, который описан в следующей таблице.

| Тип связи | ОПИСАНИЕ |
|:--- |:--- |
| Конвейер |Действие назначения выполняется один раз для каждого вывода объекта из исходного действия. Действие назначения не выполняется, если исходное действие не создает выходные данные. Выходные данные из исходного действия доступны в виде объекта. |
| Последовательность |Действие назначения выполняется только один раз. Оно получает массив объектов из исходного действия. Выходные данные из исходного действия доступны в виде массива объектов. |

### <a name="starting-activity"></a>Запуск действия
Графический модуль runbook начнется с любых действий, у которых нет входящей связи. Часто это только одно действие, которое будет выступать в качестве начального действия runbook. Если у нескольких действий нет входящих связей, runbook запустится при их одновременном выполнении. Затем, по завершении каждого из них, он будет переходить по связям, выполняя другие действия.

### <a name="conditions"></a>Условия
Если для связи указано условие, действие назначения выполняется, только если условие возвращает true. В условии обычно используют переменную $ActivityOutput для получения выходных данных исходного действия.

В конвейерной связи указывается условие для одного объекта, и оно вычисляется для каждого вывода объекта исходным действием. Затем действие назначения выполняется с каждым объектом, который удовлетворяет условию. Например, если исходное действие — Get-AzureRmVm, следующий синтаксис может использоваться в условной последовательной связи для получения только виртуальных машин, входящих в группу ресурсов *Group1*.

    $ActivityOutput['Get Azure VMs'].Name -match "Group1"

Для последовательной связи условие вычисляется только один раз, так как возвращается один массив, содержащий все объекты, выведенные исходным действием. По этой причине последовательную связь нельзя использовать для фильтрации, как конвейерную связь, так как она будет просто определять, выполняется ли следующее действие. Рассмотрим в качестве примера следующий набор действий в модуле Runbook для запуска виртуальной машины.<br> ![Условная связь с последовательностями](media/automation-graphical-authoring-intro/runbook-conditional-links-sequence.png)<br>
Существуют три различные последовательные связи, которые проверяют, чтобы были предоставлены значения для двух входных параметров runbook, представляющих имя виртуальной машины и имя группы ресурсов. Это необходимо для определения действия, которое будет выполнено: запуск одной виртуальной машины, запуск всех виртуальных машин в группе ресурсов или всех виртуальных машин в подписке. Для установления последовательной связи между действиями подключения к Azure и получением одной виртуальной машины используется условная логика:

    <#
    Both VMName and ResourceGroupName runbook input parameters have values
    #>
    (
    (($VMName -ne $null) -and ($VMName.Length -gt 0))
    ) -and (
    (($ResourceGroupName -ne $null) -and ($ResourceGroupName.Length -gt 0))
    )

При использовании условной связи данные из исходного действия, доступные для других действий в этой ветви, фильтруются по условию. Если действие является источником нескольких связей, данные, доступные для действий в каждой ветви, зависят от условия в связи, присоединенной к этой ветви.

Например, действие **Start-AzureRmVm** в модуле Runbook ниже запускает все виртуальные машины. Действие включает две условные связи. В первой условной связи используется выражение *$ActivityOutput['Start-AzureRmVM'].IsSuccessStatusCode -eq $true* для фильтрации, если действие Start-AzureRmVm выполнено. А во второй — выражение *$ActivityOutput['Start-AzureRmVM'].IsSuccessStatusCode -ne $true* для фильтрации, если действию Start-AzureRmVm не удалось запустить виртуальную машину.

![Пример условной связи](media/automation-graphical-authoring-intro/runbook-conditional-links.png)

Любое действие, следующее по первой связи и использующее выходные данные действия Get-AzureVM, получит только виртуальные машины, которые были запущены на момент выполнения Get-AzureVM. Любое действие, которое следует по второй связи, получит только виртуальные машины, которые были остановлены на момент выполнения Get-AzureVM. Действие, следующее по третьей связи, получит все виртуальные машины вне зависимости от того, запущены они или нет.

### <a name="junctions"></a>Соединения
Соединение — это специальное действие, которое ожидает завершения всех входящих ветвей. Это дает возможность параллельно выполнять несколько действий и гарантировать, что все они будут завершены перед выполнением следующего шага.

Хотя у соединения может быть неограниченное число входящих связей, конвейерной может быть только одна из них. Число входящих последовательных связей не ограничено. Вы можете создать соединение с несколькими входящими конвейерными связями и сохранить runbook, но его запуск завершится ошибкой.

В приведенном ниже примере показана часть Runbook, которая запускает набор виртуальных машин, одновременно скачивая исправления для них. Соединение используется, чтобы гарантировать, что оба процесса будут выполнены, прежде чем выполнение Runbook будет продолжено.

![Соединение](media/automation-graphical-authoring-intro/runbook-junction.png)

### <a name="cycles"></a>Циклические процессы
Циклический процесс происходит, когда действие назначения обратно связано с исходным действием или другим действием, которое в конечном итоге обратно связано с его исходным действием. В настоящее время использование циклических процессов в графической разработке запрещено. Если runbook содержит циклический процесс, он будет сохранен правильно, но при его выполнении произойдет ошибка.

![Циклический процесс](media/automation-graphical-authoring-intro/runbook-cycle.png)

### <a name="sharing-data-between-activities"></a>Обмен данными между действиями
Любые данные, которые выводятся действием с исходящей связью, записываются в *шину данных* для Runbook. Любое действие в Runbook может использовать данные в шине данных, чтобы заполнить значения параметров или добавить эти данные в код сценария. Действие может обращаться к выходным данным любого предыдущего действия в рабочем процессе.

То, как данные записываются в шину данных, зависит от типа связи действия. Для **конвейерной**связи данные выводятся в виде нескольких объектов. Для **последовательной** связи данные выводятся в виде массива. Если имеется только одно значение, оно выводится в виде одноэлементного массива.

Получить доступ к данным в шине данных можно одним из двух методов. Первый — использовать источник данных **Выходные данные действия** для заполнения параметра другого действия. Если выходными данными является объект, можно указать одно свойство.

![Выходные данные действия](media/automation-graphical-authoring-intro/activity-output-datasource-revised20165.png)

Также можно получить выходные данные действия из источника данных **Выражение PowerShell** или действия **Скрипт рабочего процесса** с использованием переменной ActivityOutput. Если выходными данными является объект, можно указать одно свойство. Для переменных ActivityOutput используется следующий синтаксис.

    $ActivityOutput['Activity Label']
    $ActivityOutput['Activity Label'].PropertyName

### <a name="checkpoints"></a>Контрольные точки
В графическом модуле Runbook рабочего процесса PowerShell можно указать [контрольные точки](automation-powershell-workflow.md#checkpoints) , выбрав параметр *Создать контрольную точку модуля Runbook* для любого действия. Это настраивает создание контрольной точки после выполнения действия.

![Контрольная точка](media/automation-graphical-authoring-intro/set-checkpoint.png)

Контрольные точки доступны только в графических модулях Runbook рабочего процесса PowerShell (соответственно, в графических модулях Runbook они недоступны). При приостановке и перезапуске runbook из контрольной точки в другой рабочей роли все действия с контрольными точками должны наследоваться. Если такой модуль использует командлеты Azure, это можно сделать с помощью командлета Connect-AzureRmAccount.

## <a name="authenticating-to-azure-resources"></a>Аутентификация для доступа к ресурсам Azure
В службе автоматизации Azure для модулей runbook, которые управляют ресурсами Azure, требуется проверка подлинности. Для доступа к ресурсам Azure Resource Manager в подписке с помощью модулей Runbook службы автоматизации по умолчанию используется [учетная запись запуска от имени](automation-offering-get-started.md#creating-an-automation-account) (также называемая субъектом-службой). Эту функцию можно включить в графический runbook, добавив ресурс подключения **AzureRunAsConnection**, который использует для работы с холстом командлеты PowerShell [Get-AutomationConnection](https://technet.microsoft.com/library/dn919922%28v=sc.16%29.aspx) и [Connect-AzureRmAccount](/powershell/module/azurerm.profile/connect-azurermaccount). Это продемонстрировано в следующем примере.<br>![Действия проверки подлинности запуска от имени](media/automation-graphical-authoring-intro/authenticate-run-as-account.png)<br>
Для действия получения подключения запуска от имени (например, Get-AutomationConnection) настроено постоянное значение источника данных с именем AzureRunAsConnection.<br>![Конфигурация подключения запуска от имени](media/automation-graphical-authoring-intro/authenticate-runas-parameterset.png)<br>
Следующее действие (Connect-AzureRmAccount) добавляет учетную запись запуска от имени с выполненной аутентификацией для использования в runbook.<br>
![Набор параметров Connect-AzureRmAccount](media/automation-graphical-authoring-intro/authenticate-conn-to-azure-parameter-set.png)<br>
Для параметров **APPLICATIONID**, **CERTIFICATETHUMBPRINT** и **TENANTID** необходимо указать имя свойства для пути к полю, так как действие выводит объект с несколькими свойствами. Иначе при выполнении модуля runbook попытка выполнения проверки подлинности завершится ошибкой. Это минимальные требования для проверки подлинности модуля Runbook с использованием учетной записи запуска от имени.

Вы можете обеспечить обратную совместимость для подписчиков, которые создали учетную запись службы автоматизации с помощью [учетной записи пользователя Azure AD](automation-create-aduser-account.md) для управления классическим развертыванием Azure или для ресурсов Azure Resource Manager. В таком случае проверку подлинности следует выполнять с помощью командлета Add-AzureAccount с использованием [ресурса учетных данных](automation-credentials.md), который представляет пользователя Active Directory с доступом к учетной записи Azure.

Вы можете добавить эту функциональную возможность в графический Runbook, сначала добавив на холст ресурс учетных данных, а затем — действие Add-AzureAccount. Add-AzureAccount использует действие учетных данных в качестве входных данных. Это продемонстрировано в следующем примере.

![Действия аутентификации](media/automation-graphical-authoring-intro/authentication-activities.png)

Проходить аутентификацию необходимо при запуске Runbook и после каждой контрольной точки. Это означает добавление действия Add-AzureAccount после любого действия Checkpoint-Workflow. Так как можно использовать одно действие учетных данных, другие добавлять не требуется.

![Выходные данные действия](media/automation-graphical-authoring-intro/authentication-activity-output.png)

## <a name="runbook-input-and-output"></a>Входные и выходные данные Runbook
### <a name="runbook-input"></a>Входные данные Runbook
Может потребоваться ввод от пользователя при запуске Runbook на портале Azure или из другого Runbook, если текущий используется в качестве дочернего.
Например, если имеется Runbook, который создает виртуальную машину, при каждом запуске Runbook вам может потребоваться предоставлять такие данные, как имя виртуальной машины и другие свойства.

Для приема входных данных Runbook можно определить один или несколько входных параметров. Значения для этих параметров вводятся при каждом запуске Runbook. При запуске runbook с помощью портала Azure вам предлагается ввести значения для всех входных параметров runbook.

Входные параметры для модуля можно открыть, нажав кнопку **Вход и выход** на панели инструментов Runbook.

Откроется элемент управления **Вход и выход**, в котором можно изменить существующий входной параметр или создать новый, нажав кнопку **Добавить входные данные**.

![Добавить входные данные](media/automation-graphical-authoring-intro/runbook-edit-add-input.png)

Каждый входной параметр определяется с помощью свойств, указанных в следующей таблице:

| Свойство | ОПИСАНИЕ |
|:--- |:--- |
| ИМЯ |Уникальное имя параметра. Оно может содержать только буквы или цифры и не может содержать пробел. |
| ОПИСАНИЕ |Необязательное описание входного параметра. |
| type |Предполагаемый тип данных значения параметра. Портал Azure предоставит соответствующий элемент управления для типа данных каждого параметра при запросе ввода его значения. |
| Обязательно |Указывает, должно ли быть указано значение для параметра. Запустить Runbook не удастся, если не указать значение для каждого обязательного параметра, у которого нет определенного значения по умолчанию. |
| По умолчанию |Указывает, какое значение используется для параметра, если оно не указано. Это может быть NULL или какое-нибудь определенное значение. |

### <a name="runbook-output"></a>Выходные данные Runbook
Данные, созданные каким-либо действием, у которого нет исходящей связи, добавляются в [выходные данные runbook](http://msdn.microsoft.com/library/azure/dn879148.aspx). Выходные данные сохраняются заданием Runbook и доступны родительскому модулю Runbook, если Runbook используется как дочерний.

## <a name="powershell-expressions"></a>Выражения PowerShell
Одним из преимуществ графической разработки является возможность создавать модули Runbook, располагая минимальными знаниями о PowerShell. В настоящее время необходимо знать лишь некоторые общие принципы работы с PowerShell для заполнения определенных [значений параметров](#activities) и настройки [условий связи](#links-and-workflow). Данный раздел содержит краткое введение в выражения PowerShell для тех пользователей, которые с ними не знакомы. Полные сведения о PowerShell можно найти в статье [Создание сценариев с помощью Windows PowerShell](http://technet.microsoft.com/library/bb978526.aspx).

### <a name="powershell-expression-data-source"></a>Выражение PowerShell как источник данных 
Выражение PowerShell можно использовать в качестве источника данных для заполнения значения [параметра действия](#activities) результатами некоторого кода PowerShell. Это может быть одна строка кода, которая выполняет некоторые простые функции, или несколько строк, выполняющие определенную сложную логику. Любые выходные данные команды, не присвоенные переменной, выводятся в значении параметра.

Например, следующая команда будет выводить текущую дату.

    Get-Date

Следующие команды создают строку из текущей даты и присваивают ее переменной. Затем содержимое переменной передается в выходные данные.

    $string = "The current date is " + (Get-Date)
    $string

Следующие команды вычисляют текущую дату и возвращают строку, указывающую, является ли текущий день выходным или рабочим.

    $date = Get-Date
    if (($date.DayOfWeek = "Saturday") -or ($date.DayOfWeek = "Sunday")) { "Weekend" }
    else { "Weekday" }


### <a name="activity-output"></a>Выходные данные действия
Чтобы использовать выходные данные предыдущего действия в модуле Runbook, используйте переменную $ActivityOutput со следующим синтаксисом.

    $ActivityOutput['Activity Label'].PropertyName

Например, при наличии действия со свойством, которое требует имени виртуальной машины, можно использовать следующее выражение:

    $ActivityOutput['Get-AzureVm'].Name

При наличии свойства, требующего объект виртуальной машины вместо одного только свойства, можно вернуть весь объект, используя следующий синтаксис.

    $ActivityOutput['Get-AzureVm']

Выходные данные действия также можно использовать в более сложном выражении следующего вида, добавляющем текст к имени виртуальной машины.

    "The computer name is " + $ActivityOutput['Get-AzureVm'].Name


### <a name="conditions"></a>Условия
Используйте [операторы сравнения](https://technet.microsoft.com/library/hh847759.aspx) для сравнения значений или определения того, соответствует ли значение указанному шаблону. Оператор сравнения возвращает значение $true или $false.

Например, следующее условие определяет, *остановлена* ли виртуальная машина из действия *Get-AzureVM* в данный момент.

    $ActivityOutput["Get-AzureVM"].PowerState –eq "Stopped"

Следующее условие проверяет, находится ли та же виртуальная машина в любом состоянии, кроме *остановлено*.

    $ActivityOutput["Get-AzureVM"].PowerState –ne "Stopped"

Можно объединить несколько условий с помощью [логического оператора](https://technet.microsoft.com/library/hh847789.aspx), например **И** или **ИЛИ**. Например, следующее условие проверяет, находится ли виртуальная машина из предыдущего примера в состоянии *остановлена* или *идет остановка*.

    ($ActivityOutput["Get-AzureVM"].PowerState –eq "Stopped") -or ($ActivityOutput["Get-AzureVM"].PowerState –eq "Stopping")


### <a name="hashtables"></a>Хэш-таблицы
[Хэш-таблицы](http://technet.microsoft.com/library/hh847780.aspx) представляют собой пары "имя-значение", которые удобны для получения набора значений. Свойства для определенных действий могут ожидать хэш-таблицу вместо простого значения. Иногда хэш-таблицу называют словарем.

Хэш-таблицу можно создать, используя следующий синтаксис. Хэш-таблица может содержать любое количество записей, каждая из которых определяется именем и значением.

    @{ <name> = <value>; [<name> = <value> ] ...}

Например, следующее выражение создает хэш-таблицу для использования в источнике данных для параметра действия, который ожидает хэш-таблицу со значениями для поиска в Интернете.

    $query = "Azure Automation"
    $count = 10
    $h = @{'q'=$query; 'lr'='lang_ja';  'count'=$Count}
    $h

В следующем примере выходные данные действия *Get Twitter Connection* используются для заполнения хэш-таблицы.

    @{'ApiKey'=$ActivityOutput['Get Twitter Connection'].ConsumerAPIKey;
      'ApiSecret'=$ActivityOutput['Get Twitter Connection'].ConsumerAPISecret;
      'AccessToken'=$ActivityOutput['Get Twitter Connection'].AccessToken;
      'AccessTokenSecret'=$ActivityOutput['Get Twitter Connection'].AccessTokenSecret}



## <a name="next-steps"></a>Дальнейшие действия
* Чтобы приступить к работе с модулями Runbook рабочих процессов PowerShell, обратитесь к статье [Мой первый модуль Runbook рабочего процесса PowerShell](automation-first-runbook-textual.md)
* Чтобы начать работу с графическими модулями Runbook, см. инструкции в статье [Первый графический Runbook](automation-first-runbook-graphical.md).
* Чтобы получить дополнительные сведения о типах модулей Runbook, их преимуществах и ограничениях, обратитесь к статье [Типы модулей Runbook в службе автоматизации Azure](automation-runbook-types.md)
* Сведения о том, как выполнять аутентификацию с помощью учетной записи запуска от имени службы автоматизации см. в статье [Проверка подлинности модулей Runbook в Azure с помощью учетной записи запуска от имени](automation-sec-configure-azure-runas-account.md).

