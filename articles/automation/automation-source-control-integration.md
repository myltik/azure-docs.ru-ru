---
title: Интеграция системы управления версиями и службы автоматизации Azure
description: В этой статье описывается интеграция системы управления версиями с GitHub в службе автоматизации Azure.
services: automation
ms.service: automation
ms.component: process-automation
author: georgewallace
ms.author: gwallace
ms.date: 03/16/2018
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: a75167b6973d5cce8497c07e21d17ad071290f1d
ms.sourcegitcommit: eb75f177fc59d90b1b667afcfe64ac51936e2638
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/16/2018
ms.locfileid: "34194491"
---
# <a name="source-control-integration-in-azure-automation"></a>Интеграция системы управления версиями в службе автоматизации Azure
Интеграция системы управления версиями позволяет связать модули Runbook из вашей учетной записи службы автоматизации с репозиторием системы управления версиями GitHub. Система управления версиями позволяет работать вместе с коллегами, отслеживать изменения и выполнять откат к более ранним версиям модулей Runbook. Например, система управления версиями позволяет синхронизировать различные ветви этой системы с учетными записями службы автоматизации, предназначенными для разработки, тестирования и работы готового продукта. Таким образом, вы сможете легко разместить в рабочей учетной записи службы автоматизации тот код, который был протестирован в среде разработки.

Система управления версиями позволяет отправлять код из службы автоматизации Azure в систему управления версиями или извлекать модули Runbook из системы управления версиями в службу автоматизации Azure. В этой статье рассказывается, как настроить систему управления версиями в среде службы автоматизации Azure. Для начала настроим в службе автоматизации Azure доступ к репозиторию GitHub и рассмотрим различные операции, которые можно выполнить, используя интеграцию системы управления версиями. 

> [!NOTE]
> Система управления версиями поддерживает извлечение и отправку [модулей Runbook рабочих процессов PowerShell](automation-runbook-types.md#powershell-workflow-runbooks), а также [модулей Runbook PowerShell](automation-runbook-types.md#powershell-runbooks). [Графические модули Runbook](automation-runbook-types.md#graphical-runbooks) пока не поддерживаются.<br><br>
> 
> 

Настроить систему управления версиями в учетной записи службы автоматизации можно за два простых шага. Если у вас уже есть учетная запись GitHub, все делается за один шаг. К ним относятся:

## <a name="step-1--create-a-github-repository"></a>Шаг 1. Создание репозитория GitHub
Если у вас уже есть учетная запись GitHub и репозиторий, который вы хотите связать со службой автоматизации Azure, выполните вход в имеющуюся учетную запись и переходите к шагу 2. В противном случае перейдите на сайт [GitHub](https://github.com/), зарегистрируйтесь и [создайте репозиторий](https://help.github.com/articles/create-a-repo/).

## <a name="step-2--set-up-source-control-in-azure-automation"></a>Шаг 2. Настройка системы управления версиями в службе автоматизации Azure
1. На странице "Учетная запись автоматизации" портала Azure в разделе **Параметры учетной записи** щелкните **Система управления версиями**. 
   
1. Откроется колонка **Система управления версиями** , в которой можно указать данные учетной записи GitHub. Далее приведен список настраиваемых параметров.  
   
   | **Параметр** | **Описание** |
   |:--- |:--- |
   | Выбор источника |Укажите источник. В настоящее время поддерживается только **GitHub** . |
   | Авторизация |Щелкните кнопку **Авторизовать** , чтобы предоставить службе автоматизации Azure доступ к репозиторию GitHub. Если вы уже выполнили вход в учетную запись GitHub в другом окне, то будут использованы учетные данные этой учетной записи. После успешной авторизации на странице под свойством **Авторизация**отобразится ваше имя пользователя в GitHub. |
   | Выберите репозиторий |Выберите репозиторий GitHub из списка доступных репозиториев. |
   | Выберите ветвь |Выберите ветвь из списка доступных. Если вы не создавали ветвей, будет показана только ветвь **master** . |
   | Путь к папке Runbook |Путь к папке с модулями Runbook в репозитории GitHub, из которого требуется загружать или в который требуется отправлять код. Путь указывается в формате **/имя_папки/имя_вложенной_папки**. С вашей учетной записью службы автоматизации будут синхронизированы только модули из папки Runbook. Модули Runbook во вложенных подпапках папки с модулями Runbook **НЕ** будут синхронизированы. Чтобы синхронизировать все модули Runbook в репозитории, используйте символ **/** . |
3. Например, ваш репозиторий называется **PowerShellScripts**, и он содержит папку **RootFolder** с вложенной папкой **SubFolder**. Для выполнения синхронизации на уровне каждой папки можно использовать следующие строки:
   
   1. Чтобы синхронизировать модули Runbook из **репозитория**, укажите следующий путь к папке с модулями Runbook: */*
   2. Чтобы синхронизировать модули Runbook из **RootFolder**, укажите следующий путь к папке с модулями Runbook: */корневая_папка*
   3. Чтобы синхронизировать модули Runbook из папки **SubFolder**, укажите следующий путь к папке с модулями Runbook: */корневая_папка/вложенная_папка*.
4. После настройки параметры отобразятся на странице **Настройка системы управления версиями**.  
   
    ![Страница настройки системы управления версиями](media/automation-source-control-integration/automation_02_SourceControlConfigure.png)
5. Когда вы нажмете кнопку **ОК**, интеграция системы управления версиями будет настроена для вашей учетной записи службы автоматизации. Также должны быть обновлены сведения из учетной записи GitHub. Щелкните эту область, чтобы просмотреть весь журнал заданий синхронизации системы управления версиями.  
   
    ![Значения репозитория](media/automation-source-control-integration/automation_03_RepoValues.png)
6. После настройки системы управления версиями в вашей учетной записи службы автоматизации будут созданы следующие ресурсы службы автоматизации:  
   Два [ресурса переменных](automation-variables.md).  
   
   * Переменная **Microsoft.Azure.Automation.SourceControl.Connection** содержит значения строки подключения, как показано ниже.  
     
     | **Параметр** | **Значение** |
     |:--- |:--- |
     | ИМЯ |Microsoft.Azure.Automation.SourceControl.Connection |
     | type |Строка |
     | Значение |{"Branch":\<*имя ветви*>,"RunbookFolderPath":\<*путь к папке с модулями Runbook*>,"ProviderType":\<*для GitHub значение равно 1*>,"Repository":\<*имя репозитория*>,"Username":\<*имя пользователя GitHub*>} |

    * Переменная **Microsoft.Azure.Automation.SourceControl.OAuthToken**содержит надежно зашифрованное значение OAuthToken.  

    |**Параметр**            |**Значение** |
    |:---|:---|
    | ИМЯ  | Microsoft.Azure.Automation.SourceControl.OAuthToken |
    | type | Unknown(Encrypted) |
    | Значение | <*Зашифрованное значение OAuthToken*> |  

    ![Переменные](media/automation-source-control-integration/automation_04_Variables.png)  

    * **Система управления версиями службы автоматизации** будет добавлена в вашу учетную запись GitHub в виде авторизованного приложения. Чтобы просмотреть приложение, на домашней странице GitHub последовательно выберите **profile** (Профиль)  > **Settings** (Параметры)  > **Applications** (Приложения). Это приложение позволяет службе автоматизации Azure синхронизировать репозиторий GitHub с учетной записью службы автоматизации.  

    ![Приложение Git](media/automation-source-control-integration/automation_05_GitApplication.png)


## <a name="using-source-control-in-automation"></a>Использование системы управления версиями в службе автоматизации
### <a name="check-in-a-runbook-from-azure-automation-to-source-control"></a>Возврат модуля Runbook из службы автоматизации Azure в систему управления версиями
Возврат модуля Runbook позволяет перенести изменения, внесенные в модуль Runbook в службе автоматизации Azure, в репозиторий системы управления версиями. Для возврата модуля Runbook сделайте следующее:

1. Находясь в своей учетной записи службы автоматизации, [создайте текстовый модуль Runbook](automation-first-runbook-textual.md) или [измените существующий](automation-edit-textual-runbook.md). Этот модуль может быть модулем Runbook рабочего процесса PowerShell или сценария PowerShell.  
2. Завершив изменение модуля Runbook, сохраните его и щелкните **Возврат** на странице **Правка**.  
   
    ![Кнопка "Возврат"](media/automation-source-control-integration/automation_06_CheckinButton.png)

     > [!NOTE] 
     > При возврате модуля из службы автоматизации Azure перезаписывается код, имеющийся в системе управления версиями. Инструкция командной строки для возврата, эквивалентная команде Git, выглядит следующим образом: **git add + git commit + git push**  

1. После нажатия кнопки **Возврат** появится запрос подтверждения. Щелкните **Да**, чтобы продолжить.  
   
    ![Сообщение возврата](media/automation-source-control-integration/automation_07_CheckinMessage.png)
2. Процедура возврата запустит модуль Runbook для управления источниками **Sync-MicrosoftAzureAutomationAccountToGitHubV1**. Этот модуль Runbook подключается к GitHub и передает изменения из службы автоматизации Azure в ваш репозиторий. Чтобы просмотреть журнал заданий возврата, вернитесь на вкладку **Интеграция системы управления версиями** и откройте страницу "Синхронизация репозитория". На этой странице будут показаны все задания из системы управления версиями.  Выберите задание, которое хотите просмотреть, и щелкните его.  
   
    ![Модуль Runbook для возврата](media/automation-source-control-integration/automation_08_CheckinRunbook.png)
   
   > [!NOTE]
   > Модули Runbook системы управления версиями — это особые модули Runbook службы автоматизации, недоступные для просмотра и изменения. Они не включаются в список модулей Runbook, но в списке заданий отображаются задачи синхронизации.
   > 
   > 
3. Имя измененного модуля Runbook передается в возвращаемый модуль в качестве входного параметра. Вы можете [просмотреть сведения о задании](automation-runbook-execution.md#viewing-job-status-from-the-azure-portal), развернув модуль Runbook на странице **Синхронизация репозитория**.  
   
    ![Входные данные для возврата](media/automation-source-control-integration/automation_09_CheckinInput.png)
4. Когда задание будет завершено, обновите репозиторий GitHub, чтобы увидеть изменения.  Репозиторий должен содержать фиксацию со следующим сообщением: **Обновлено *имя модуля Runbook* в службе автоматизации Azure**.  

### <a name="sync-runbooks-from-source-control-to-azure-automation"></a>Синхронизация модулей Runbook из системы управления версиями в службу автоматизации Azure
Кнопка синхронизации на странице "Синхронизация репозитория" позволяет извлечь все модули Runbook из папки с модулями в вашем репозитории в учетную запись службы автоматизации. Один репозиторий можно синхронизировать с несколькими учетными записями службы автоматизации. Для синхронизации модуля Runbook сделайте следующее.

1. В учетной записи службы автоматизации, где настроена система управления версиями, откройте страницу **Интеграция системы управления версиями/Синхронизация репозитория** и нажмите кнопку **Синхронизировать**.  Когда появится запрос на подтверждение, щелкните **Да**.  
   
    ![Кнопка "Синхронизация"](media/automation-source-control-integration/automation_10_SyncButtonwithMessage.png)
2. Процедура синхронизации запустит модуль Runbook **Sync-MicrosoftAzureAutomationAccountFromGitHubV1**. Этот модуль подключается к GitHub и передает изменения из вашего репозитория в службу автоматизации Azure. Новое задание появится на странице **Синхронизация репозитория** , соответствующей этому действию. Для просмотра страницы сведений о задании синхронизации щелкните соответствующее задание.  
   
    ![Модуль Runbook для синхронизации](media/automation-source-control-integration/automation_11_SyncRunbook.png)

    > [!NOTE] 
    > При синхронизации из системы управления версиями черновики модулей Runbook в учетной записи службы автоматизации будут заменены **ВСЕМИ** модулями Runbook из системы управления версиями. Инструкция командной строки для синхронизации, эквивалентная команде Git, выглядит следующим образом: **git pull**


## <a name="troubleshooting-source-control-problems"></a>Устранение неполадок с системой управления версиями
Для заданий возврата или синхронизации с ошибками будет отображаться состояние "Приостановлено". Дополнительные сведения об ошибке можно просмотреть на странице задания.  В области **Все журналы** можно просмотреть все потоки PowerShell, связанные с этим заданием. Это позволяет получить данные, необходимые для устранения проблем, которые связаны с возвратом или синхронизацией. Кроме того, здесь отображается последовательность действий, выполняемых при синхронизации или возврате модуля Runbook.  

![Образ AllLogs](media/automation-source-control-integration/automation_13_AllLogs.png)

## <a name="disconnecting-source-control"></a>Отключение системы управления версиями
Чтобы отключиться от учетной записи GitHub, откройте страницу "Синхронизация репозитория" и нажмите кнопку **Отключить**. После отключения системы управления версиями все ранее синхронизированные модули Runbook останутся в вашей учетной записи службы автоматизации. При этом страница "Синхронизация репозитория" станет неактивной.  

  ![Кнопка "Отключить"](media/automation-source-control-integration/automation_12_Disconnect.png)

## <a name="next-steps"></a>Дополнительная информация
Дополнительные сведения об интеграции системы управления версиями см. в следующих ресурсах:  

* [Azure Automation: Source Control Integration in Azure Automation](https://azure.microsoft.com/blog/azure-automation-source-control-13/)  
* [Vote for your favorite source control system](https://www.surveymonkey.com/r/?sm=2dVjdcrCPFdT0dFFI8nUdQ%3d%3d)  
* [Azure Automation: Integrating Runbook Source Control using Visual Studio Team Services](https://azure.microsoft.com/blog/azure-automation-integrating-runbook-source-control-using-visual-studio-online/)  

