---
title: Настройка аутентификации Azure Active Directory для приложения служб приложений
description: Узнайте, как настроить проверку подлинности Azure Active Directory для приложения служб приложений.
author: mattchenderson
services: app-service
documentationcenter: ''
manager: syntaxc4
editor: ''
ms.assetid: 6ec6a46c-bce4-47aa-b8a3-e133baef22eb
ms.service: app-service-mobile
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 04/19/2018
ms.author: mahender
ms.openlocfilehash: 2530cb55cb054c02df5d55ccb86e959a061e2499
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
ms.locfileid: "32155302"
---
# <a name="configure-your-app-service-app-to-use-azure-active-directory-login"></a>Настройка приложения службы приложений для использования входа с помощью Azure Active Directory
[!INCLUDE [app-service-mobile-selector-authentication](../../includes/app-service-mobile-selector-authentication.md)]

В этой стать описывается, как настроить службы приложений Azure для использования Azure Active Directory в качестве поставщика проверки подлинности.

## <a name="express"> </a>Настройка Azure Active Directory с помощью стандартных параметров
1. Перейдите к своему приложению службы приложений на [портале Azure]. В левой области навигации выберите **Аутентификация или авторизация**.
2. Если параметр **Аутентификация или авторизация** не включен, выберите **Вкл**.
3. Щелкните **Azure Active Directory**, а затем в разделе **Режим управления** выберите **Экспресс**.
4. Нажмите кнопку **ОК**, чтобы зарегистрировать приложение службы приложений в Azure Active Directory. При этом новое приложение будет зарегистрировано. Чтобы выбрать имеющуюся регистрацию приложения, щелкните **Выбрать существующее приложение** и найдите имя ранее созданной регистрации приложения в своем клиенте.
   Щелкните регистрацию приложения, чтобы выбрать ее, и нажмите кнопку **ОК**. Затем нажмите кнопку **ОК** на странице параметров Azure Active Directory.
   По умолчанию служба приложений обеспечивает проверку подлинности, но не ограничивает авторизованный доступ к содержимому сайта и API. Авторизация пользователей должна быть включена в код приложения.
5. (Необязательно.) Чтобы предоставить доступ к сайту только пользователям, прошедшим проверку подлинности в Azure Active Directory, установите для параметра **Предпринимаемое действие, если проверка подлинности для запроса не выполнена** значение **Войти с использованием Azure Active Directory**. В этом случае все запросы, не прошедшие проверку подлинности, направляются для проверки подлинности с помощью Azure Active Directory.
6. Выберите команду **Сохранить**.

Теперь вы можете использовать Azure Active Directory для аутентификации в приложении службы приложений.

## <a name="advanced"> </a>(Альтернативный способ) Ручная настройка расширенных параметров Azure Active Directory
Можно также указать параметры конфигурации вручную. Этот способ рекомендуется, если клиент AAD, который вы хотите использовать, отличается от клиента, с которого вы выполняете вход в Azure. Чтобы выполнить настройку, сначала необходимо создать регистрацию в Azure Active Directory, а затем предоставить некоторые сведения о регистрации службе приложений.

### <a name="register"> </a>Регистрация приложения службы приложений в Azure Active Directory
1. Войдите на [портале Azure]и перейдите к своему приложению службы приложений. Скопируйте **URL-адрес** приложения. Он будет использоваться для настройки регистрации приложения Azure Active Directory.
2. Чтобы зарегистрировать новое приложение, перейдите к **Active Directory**, а затем выберите **Регистрации приложений** и в верхней части нажмите кнопку **Регистрация нового приложения**. 
3. На странице **Создание** введите **имя** регистрации приложения, выберите тип **Веб-приложение или API** и вставьте URL-адрес приложения (из шага 1) в поле **URL-адрес для входа**. Затем щелкните **Создать**.
4. Через несколько секунд отобразится только что созданная регистрация приложения.
5. После добавления регистрации приложения щелкните ее имя, а затем вверху выберите **Параметры** > **Свойства**. 
6. В диалоговом окне **URI кода приложения** вставьте URL-адрес приложения (из шага 1), а также в поле **URL-адрес домашней страницы** вставьте URL-адрес приложения (из шага 1), затем щелкните **Сохранить**.
7. Теперь щелкните **URL-адреса ответа** и замените **URL-адрес ответа**, вставив URL-адрес приложения (из шага 1), измените протокол, чтобы обеспечить наличие протокола **https://** (не http://), и в конце добавьте URL-адрес */.auth/login/aad/callback* (например, `https://contoso.azurewebsites.net/.auth/login/aad/callback`). Выберите команду **Сохранить**.   
8.  На этом этапе скопируйте **идентификатор** для приложения. Сохраните его для последующего использования. Он понадобится, чтобы настроить приложение службы приложений.
9. Закройте страницу **Зарегистрированное приложение**. В верхней части страницы **Регистрация приложений** нажмите кнопку **Конечные точки** и скопируйте URL-адрес **документа метаданных федерации**. 
10. Откройте новое окно браузера и перейдите по URL-адресу, вставив его и перейдя на страницу XML. В верхней части документа расположен элемент **EntityDescriptor** с атрибутом **entityID** в формате `https://sts.windows.net/`, за которым следует идентификатор GUID вашего клиента (идентификатор клиента). Скопируйте это значение — оно будет использоваться в качестве вашего **URL-адреса издателя**. Позже вы настроите приложение для его использования.

### <a name="secrets"> </a>Добавление сведений об Azure Active Directory в приложение службы приложений
1. Вернитесь к своему приложению службы приложений на [портале Azure]. Щелкните **Аутентификация или авторизация**. Если функция аутентификации или авторизации не включена, установите переключатель в положение **Вкл**. Чтобы настроить приложение, щелкните **Azure Active Directory** в списке поставщиков аутентификации. (Необязательно.) По умолчанию служба приложений обеспечивает проверку подлинности, но не ограничивает авторизованный доступ к содержимому сайта и API. Авторизация пользователей должна быть включена в код приложения. В раскрывающемся списке **Предпринимаемое действие, если проверка подлинности для запроса не выполнена** выберите **Войти с использованием Azure Active Directory**. При выборе этого параметра все запросы, не прошедшие аутентификацию, будут направляться для аутентификации в Azure Active Directory.
2. В конфигурации аутентификации Active Directory щелкните **Дополнительно** в разделе **Режим управления**. Вставьте идентификатор приложения в поле идентификатора клиента (из шага 8) и вставьте значение entityId (из шага 10) для URL-адреса издателя. Нажмите кнопку **ОК**.
3. На странице "Active Directory Authentication configuration" (Конфигурация аутентификации Active Directory) щелкните **Сохранить**.

Теперь вы можете использовать Azure Active Directory для аутентификации в приложении службы приложений.

## <a name="optional-configure-a-native-client-application"></a>(Необязательно.) Настройка собственного клиентского приложения
Azure Active Directory также позволяет регистрировать собственные клиенты, что обеспечивает больший контроль над сопоставлением разрешений. Это необходимо, если вы хотите выполнять вход с помощью библиотеки, например **библиотеки аутентификации Active Directory**.

1. Перейдите в раздел **Azure Active Directory** на [портале Azure].
2. В левой области навигации выберите **Регистрация приложений**. Щелкните **New app registration** (Создать регистрацию приложения) вверху.
4. На странице **Создание** введите **имя** регистрации приложения. Для параметра **Тип приложения** выберите значение **Машинный код**.
5. В поле **URI перенаправления** введите конечную точку */.auth/login/done* веб-сайта в формате HTTPS. Это значение должно быть аналогично *https://contoso.azurewebsites.net/.auth/login/done*. При создании приложения Windows в качестве URI используйте [идентификатор безопасности пакета](../app-service-mobile/app-service-mobile-dotnet-how-to-use-client-library.md#package-sid) .
5. Нажмите кнопку **Создать**.
6. После добавления регистрации приложения выберите ее, чтобы открыть. Найдите **идентификатор приложения** и запишите его.
7. Последовательно выберите **Все параметры** > **Необходимые разрешения** > **Добавить** > **Выбор API**.
8. Введите имя приложения службы приложений, которое было зарегистрировано ранее, чтобы найти его, а затем выберите его и нажмите кнопку **Выбрать**. 
9. Выберите **Доступ к \<имя_приложения>**. Затем щелкните **Выбрать**. Затем нажмите кнопку **Done**(Готово).

Теперь вы настроили собственное клиентское приложение, у которого есть доступ к вашему приложению службы приложений.

## <a name="related-content"> </a>Связанная информация
[!INCLUDE [app-service-mobile-related-content-get-started-users](../../includes/app-service-mobile-related-content-get-started-users.md)]

<!-- Images. -->

[0]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-webapp-url.png
[1]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app_registration.png
[2]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-create.png
[3]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-config-appidurl.png
[4]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-config-replyurl.png
[5]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-endpoints.png
[6]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-endpoints-fedmetadataxml.png
[7]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-webapp-auth.png
[8]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-webapp-auth-config.png



<!-- URLs. -->

[портале Azure]: https://portal.azure.com/
[alternative method]:#advanced
