---
title: Приобретение и настройка SSL-сертификата для службы приложений Azure | Документация Майкрософт
description: Узнайте, как приобрести сертификат службы приложений и привязать его к приложению службы приложений.
services: app-service
documentationcenter: .net
author: cephalin
manager: cfowler
tags: buy-ssl-certificates
ms.assetid: cdb9719a-c8eb-47e5-817f-e15eaea1f5f8
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/01/2017
ms.author: apurvajo;cephalin
ms.openlocfilehash: 759bd1e8be8aaebbf98e1c02d67f3e56609354aa
ms.sourcegitcommit: d74657d1926467210454f58970c45b2fd3ca088d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="buy-and-configure-an-ssl-certificate-for-your-azure-app-service"></a>Приобретение и настройка сертификата SSL для службы приложений Azure

Из этого руководства вы узнаете, как можно защитить веб-приложение, приобретя SSL-сертификат для **[службы приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714)**, безопасно сохранив его в [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-whatis) и сопоставив с личным доменом.

## <a name="step-1---log-in-to-azure"></a>Шаг 1. Вход в Azure

Войдите на портал Azure по адресу http://portal.azure.com.

## <a name="step-2---place-an-ssl-certificate-order"></a>Шаг 2. Размещение заказа на SSL-сертификат

Заказ на SSL-сертификат можно разместить, создав новый [сертификат службы приложения](https://portal.azure.com/#create/Microsoft.SSL) на **портале Azure**.

![Создание сертификата](./media/app-service-web-purchase-ssl-web-site/createssl.png)

Введите понятное **имя** для SSL-сертификата, а также **доменное имя**.

> [!NOTE]
> Это один из наиболее важных этапов процесса покупки. Не забудьте ввести правильное имя узла (пользовательский домен), который необходимо защитить с помощью этого сертификата. **НЕ** добавляйте к имени узла префикс WWW. 
>

Выберите **подписку**, **группу ресурсов** и **SKU сертификата**.

> [!TIP]
> Сертификаты службы приложений можно использовать для любой службы Azure или сторонней службы, а не только в службах приложений. Для этого нужно создать локальную копию (PFX-файл) сертификата службы приложений, чтобы использовать ее с любой службой. Дополнительные сведения см. в записи блога о [создании локальной копии (PFX-файла) сертификата службы приложения](https://blogs.msdn.microsoft.com/appserviceteam/2017/02/24/creating-a-local-pfx-copy-of-app-service-certificate/).
>

## <a name="step-3---store-the-certificate-in-azure-key-vault"></a>Шаг 3. Сохранение сертификата в Azure Key Vault

> [!NOTE]
> [Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-whatis) — это служба Azure, которая помогает защитить криптографические ключи и секреты, используемые облачными приложениями и службами.
>

Когда приобретение SSL-сертификата завершится, откройте страницу [Сертификаты службы приложений](https://portal.azure.com/#blade/HubsExtension/Resources/resourceType/Microsoft.CertificateRegistration%2FcertificateOrders).

![вставить изображение для готовности к размещению в хранилище ключей](./media/app-service-web-purchase-ssl-web-site/ReadyKV.png)

Вы увидите, что для сертификата указано состояние **Ожидание выдачи**. С этим сертификатом нужно выполнить еще некоторые действия, прежде чем его можно будет использовать.

Щелкните **Конфигурация сертификата** на странице "Свойства сертификата" и затем **Шаг 1. Хранилище**, чтобы сохранить этот сертификат в Azure Key Vault.

На странице **Состояние Key Vault** щелкните **Репозиторий Key Vault**, чтобы выбрать существующее хранилище Key Vault для хранения этого сертификата, или щелкните **Создать новое Key Vault**, чтобы создать хранилище Key Vault в той же подписке и группе ресурсов.

> [!NOTE]
> Расходы на хранение этого сертификата в Azure Key Vault будут минимальными.
> Дополнительные сведения см. в разделе с **[ценами на Azure Key Vault](https://azure.microsoft.com/pricing/details/key-vault/)**.
>

После выбора репозитория Key Vault для сохранения сертификата на элементе **Хранилище** должны появиться сведения об успешном выполнении.

![Вставить изображение с успешным сохранением в Key Vault](./media/app-service-web-purchase-ssl-web-site/KVStoreSuccess.png)

## <a name="step-4---verify-the-domain-ownership"></a>Шаг 4. Проверка владельца домена

На той же странице **Конфигурация сертификата**, которую вы использовали в шаге 3, щелкните **Шаг 2. Проверка**.

Выберите предпочтительный метод проверки домена. 

Сертификаты службы приложений поддерживают четыре типа проверки домена: проверка через службу приложений, через домен, по почте и вручную. Типы проверки подробно описаны в разделе [Дополнительно](#advanced).

> [!NOTE]
> **Проверка службы приложений** —это наиболее удобный вариант, если домен, который необходимо проверить, уже сопоставлен с приложением службы приложений в одной подписке. Преимущество этого метода в том, что приложение службы приложений уже проверило владельца домена.
>

Нажмите кнопку **Проверить**, чтобы завершить этот шаг.

![Вставить изображение с проверкой через домен](./media/app-service-web-purchase-ssl-web-site/DomainVerificationRequired.png)

После нажатия кнопки **Проверить** нажимайте кнопку **Обновить** до тех пор, пока для операции **Проверить** не появятся сведения об успешном выполнении.

![Вставить изображение с успешной проверкой в Key Vault](./media/app-service-web-purchase-ssl-web-site/KVVerifySuccess.png)

## <a name="step-5---assign-certificate-to-app-service-app"></a>Шаг 5. Назначение сертификата приложению службы приложений

> [!NOTE]
> Прежде чем выполнять действия, описанные в этом разделе, необходимо связать личное доменное имя с приложением. Дополнительные сведения см. в разделе **[Сопоставление имени личного домена с приложением Azure](app-service-web-tutorial-custom-domain.md)**.
>

На **[портале Azure](https://portal.azure.com/)** щелкните **Служба приложений** в левой части страницы.

Щелкните имя приложения, которому вы хотите назначить этот сертификат.

В разделе **Параметры** щелкните **SSL-сертификаты**.

Щелкните **Импортировать сертификат службы приложений** и выберите сертификат, который вы приобрели.

![вставить изображение для импорта сертификата](./media/app-service-web-purchase-ssl-web-site/ImportCertificate.png)

В разделе **SSL-привязки** щелкните **Add bindings** (Добавить привязки), а затем в раскрывающихся списках выберите имя домена для защиты с применением SSL, а также используемый сертификат. Также можно выбрать SSL на основе **[указания имени сервера (SNI)](http://en.wikipedia.org/wiki/Server_Name_Indication)** или IP-адреса.

![вставить изображение для привязок SSL](./media/app-service-web-purchase-ssl-web-site/SSLBindings.png)

Чтобы сохранить изменения и активировать SSL, щелкните **Добавить привязку** .

> [!NOTE]
> Если вы выбрали **SSL на основе IP-адреса** и личный домен настроен с помощью записи А, нужно выполнить приведенные ниже шаги. Подробнее они описаны в разделе [Дополнительно](#Advanced).

На этом этапе приложение должно открываться с использованием `HTTPS://`, а не `HTTP://`, что подтверждает правильность настройки сертификата.

<!--![insert image of https](./media/app-service-web-purchase-ssl-web-site/Https.png)-->

## <a name="step-6---management-tasks"></a>Шаг 6. Задачи управления

### <a name="azure-cli"></a>Инфраструктура CLI Azure

[!code-azurecli[main](../../cli_scripts/app-service/configure-ssl-certificate/configure-ssl-certificate.sh?highlight=3-5 "Bind a custom SSL certificate to a web app")] 

### <a name="powershell"></a>PowerShell

[!code-powershell[main](../../powershell_scripts/app-service/configure-ssl-certificate/configure-ssl-certificate.ps1?highlight=1-3 "Bind a custom SSL certificate to a web app")]

## <a name="advanced"></a>Расширенная

### <a name="verifying-domain-ownership"></a>Проверка принадлежности домена

Сертификаты службы приложений поддерживают еще два типа проверки домена: проверка по почте и вручную.

#### <a name="mail-verification"></a>Проверка по почте

Проверочное сообщение уже было отправлено по адресам электронной почты, связанным с этим пользовательским доменом.
Чтобы завершить шаг проверки по электронной почте, откройте сообщение и щелкните ссылку для проверки.

![Вставить изображение с проверкой по почте](./media/app-service-web-purchase-ssl-web-site/KVVerifyEmailSuccess.png)

Если необходимо повторно отправить проверочное сообщение, нажмите кнопку **Переотправить сообщение электронной почты**.

#### <a name="domain-verification"></a>Проверка домена

Этот вариант следует выбрать только для [домена службы приложений, который вы приобрели в Azure](custom-dns-web-site-buydomains-web-app.md). Azure автоматически добавляет проверочную запись типа TXT и завершает процесс.

#### <a name="manual-verification"></a>Проверка вручную

> [!IMPORTANT]
> Проверка веб-страницы HTML (работает только с номером SKU сертификата уровня "Стандартный").
>

1. Создайте HTML-файл **starfield.html**.

1. Содержимое этого файла должно полностью совпадать с именем токена проверки домена. (Токен можно скопировать на странице состояния проверки домена.)

1. Отправьте этот файл в корень веб-сервера, на котором размещается ваш домен `/.well-known/pki-validation/starfield.html`.

1. Нажмите кнопку **Обновить**, чтобы обновить состояние сертификата после завершения проверки. Проверка может занять несколько минут.

> [!TIP]
> Проверьте терминал с помощью `curl -G http://<domain>/.well-known/pki-validation/starfield.html`, ответ должен содержать `<verification-token>`.

#### <a name="dns-txt-record-verification"></a>Проверка записей типа TXT DNS

1. С помощью диспетчера DNS создайте запись типа TXT в поддомене `@` со значением, идентичным токену проверки домена.
1. Нажмите кнопку **Обновить**, чтобы обновить состояние сертификата после завершения проверки.

> [!TIP]
> Нужно создать запись типа TXT в `@.<domain>` со значением `<verification-token>`.

### <a name="assign-certificate-to-app-service-app"></a>Назначение сертификата приложению службы приложений

Если выбран **вариант SSL-подключения на основе IP** и пользовательский домен настроен с помощью записи А, необходимо выполнить следующие дополнительные шаги:

После настройки привязки SSL-подключения на основе IP вашему веб-приложению будет предоставлен выделенный IP-адрес. Этот IP-адрес можно найти на странице **Личный домен** в разделе параметров приложения прямо над разделом **Имена узлов**. Он указывается как **Внешний IP-адрес**

![вставить изображение для SSL на основе IP](./media/app-service-web-purchase-ssl-web-site/virtual-ip-address.png)

Этот IP-адрес отличается от виртуального IP-адреса, который использовался ранее при настройке записи типа A для вашего домена. Если выбрано использование SSL-подключения на основе SNI или если не настроено использование SSL, адрес для этой записи не указывается.

С помощью средств, предоставляемых регистратором имени домена, измените запись A для имени пользовательского домена, указав IP-адрес из предыдущего шага.

## <a name="rekey-and-sync-the-certificate"></a>Повторное создание ключей и синхронизация сертификата

Если вам понадобится повторно назначить ключ сертификата, выберите **Повторное создание ключей и синхронизация** на странице **Свойства сертификата**.

Для запуска процесса нажмите кнопку **Повторное создание ключей**. Этот процесс может занять от 1 до 10 минут.

![Добавить изображение для повторного создания ключа SSL](./media/app-service-web-purchase-ssl-web-site/Rekey.png)

При создании ключа развертывается новый сертификат, выданный центром сертификации.

<a name="notrenewed"></a>
## <a name="why-is-my-ssl-certificate-not-auto-renewed"></a>Почему SSL-сертификат не продлился автоматически?

Если для SSL-сертификата настроено, но не выполняется автоматическое продление, это может быть связано с состоянием ожидания проверки домена. Обратите внимание на следующее. 

- Служба GoDaddy, которая создает сертификаты службы приложений, требует проверять домен каждые три года. Администратор домена раз в три года получает сообщение электронной почты для подтверждения домена. Если вы пропустите это сообщение или не подтвердите домен, сертификат службы приложений не будет обновлен автоматически. 
- Для всех сертификатов службы приложений, выпущенных до 31 марта 2017 г., требуется повторная проверка домена при очередном обновлении (даже если для них настроено автоматическое продление). Это связано с изменением политики GoDaddy. Проверьте электронную почту и выполните однократный процесс подтверждения домена, чтобы и далее использовать автоматическое продление сертификата службы приложений. 

## <a name="more-resources"></a>Дополнительные ресурсы

* [Использование SSL-сертификата в коде приложения службы приложений Azure](app-service-web-ssl-cert-load.md)
* [FAQ : App Service Certificates](https://blogs.msdn.microsoft.com/appserviceteam/2017/07/24/faq-app-service-certificates/) (Вопросы по сертификатам службы приложений и ответы на них)