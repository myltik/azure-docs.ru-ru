---
title: Гибридные подключения к службе приложений Azure | Документация Майкрософт
description: Создание и использование гибридных подключений для доступа к ресурсам в разнородных сетях.
services: app-service
documentationcenter: ''
author: ccompy
manager: stefsch
editor: ''
ms.assetid: 66774bde-13f5-45d0-9a70-4e9536a4f619
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/20/2017
ms.author: ccompy
ms.openlocfilehash: 677642e4e97523ed71ff5857ae27263743dca535
ms.sourcegitcommit: cfd1ea99922329b3d5fab26b71ca2882df33f6c2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/30/2017
ms.locfileid: "25990825"
---
# <a name="azure-app-service-hybrid-connections"></a>Гибридные подключения к службе приложений Azure #

Гибридные подключения — это и служба в Azure, и функция в службе приложений Azure. В качестве службы их применение и возможности шире, чем функциональные возможности в службе приложений Azure. Чтобы узнать больше о гибридных подключениях и их использовании вне службы приложений, изучите раздел [Протокол гибридных подключений ретранслятора Azure][HCService].

В службе приложений гибридные подключения можно использовать для доступа к ресурсам приложений в других сетях. Они обеспечивают доступ из вашего приложения к конечной точке приложения. Гибридные подключения не являются альтернативным средством доступа к вашему приложению. При использовании в службе приложений каждое гибридное подключение сопоставляется с одной комбинацией узла TCP и TCP-порта. Это означает, что конечная точка гибридного подключения может быть размещена в любой операционной системе, а любое ваше приложение использует TCP-порт прослушивания. Гибридным подключениям не важен используемый протокол приложения или ресурсы, к которым вы обращаетесь. Они просто обеспечивают доступ к сети.  


## <a name="how-it-works"></a>Принцип работы ##
Функция гибридных подключений использует два исходящих вызова к ретранслятору служебной шины Azure. Используется подключение из библиотеки на узле, на котором выполняется приложение в службе приложений. Кроме того, используется подключение из диспетчера гибридных подключений (HCM) к ретранслятору служебной шины. HCM — это служба ретрансляции, которая развертывается в сети, в которой размещается ресурс, доступ к которому вы пытаетесь получить. 

Посредством двух соединенных подключений приложение получает TCP-туннель к фиксированной комбинации "узел:порт" на другой стороне HCM. Это подключение использует протокол TLS 1.2 для обеспечения безопасности и ключи подписанного URL-адреса (SAS) для аутентификации и авторизации.    

![Общая блок-схема гибридного подключения][1]

Когда приложение выполнит запрос DNS, который соответствует настроенной конечной точке гибридного подключения, исходящий трафик TCP будет перенаправлен дальше по этому гибридному подключению.  

> [!NOTE]
> Это означает, что для гибридного подключения следует всегда использовать DNS-имя. Некоторые клиентские программы не выполняют поиск DNS, если конечная точка использует IP-адрес, а не DNS-имя.
>
>

Существуют два типа гибридных подключений: гибридные подключения, которые предоставляются как служба в ретрансляторе служебной шины Azure, и устаревшие гибридные подключения служб BizTalk Azure. Последние на портале называются классическими гибридными подключениями. Дополнительная информация о них приведена далее в этой статье.

### <a name="app-service-hybrid-connection-benefits"></a>Преимущества гибридного подключения службы приложений ###

Гибридные подключения обладают рядом преимуществ, включая следующие:

- Приложения безопасно могут обращаться к локальным службам и системам.
- Для них не требуется конечная точка с доступом к Интернету.
- Их можно быстро и легко настроить. 
- Каждое гибридное подключение соответствует отдельной комбинации "узел:порт", что удобно с точки зрения безопасности.
- Для них обычно не требуются бреши в брандмауэре. Все подключения исходят через стандартные веб-порты.
- Так как гибридные подключения работают на уровне сети, они не зависят ни от языка, используемого приложением, ни от технологии, используемой конечной точкой.
- Их можно использовать для доступа к нескольким сетям из одного приложения. 

### <a name="things-you-cannot-do-with-hybrid-connections"></a>Что невозможно сделать с помощью гибридных подключений ###

Существует несколько вещей, которые невозможно выполнить с помощью гибридных подключений, в том числе:

- подключение диска;
- использование протокола UDP;
- доступ к службам на основе протокола TCP, использующим динамические порты (таким как пассивным режим FTP или расширенный пассивный режим FTP);
- поддержка протокола LDAP, так как он иногда требует наличие протокола UDP;
- поддержка Active Directory.

## <a name="add-and-create-hybrid-connections-in-your-app"></a>Добавление и создание гибридных подключений в приложении ##

Гибридные подключения могут создаваться с помощью приложения службы приложений или ретранслятора Azure на соответствующем портале Azure. Рекомендуется создавать гибридные подключения с помощью приложения службы приложений, которое вы хотите использовать с гибридным подключением. Чтобы создать гибридное подключение, перейдите на [портал Azure][portal] и выберите свое приложение. Выберите **Сети** > **Настройте конечные точки гибридного подключения**. Здесь можно увидеть гибридные подключения, которые были настроены для приложения.  

![Снимок экрана списка гибридных подключений][2]

Чтобы добавить новое гибридное подключение, нажмите кнопку **Добавить гибридное подключение**.  Отобразится список гибридных подключений, которые вы уже создали. Чтобы добавить одно или несколько из них в приложение, выберите соответствующие подключения, затем щелкните **Добавление выбранного гибридного подключения**.  

![Снимок экрана портала гибридных подключений][3]

Если вы хотите создать гибридное подключение, щелкните **Создать гибридное подключение**. Укажите: 

- имя конечной точки;
- имя узла конечной точки;
- порт конечной точки;
- пространство имен служебной шины, которое вы хотите использовать.

![Снимок экрана диалогового окна создания гибридного подключения][4]

Каждое гибридное подключение привязано к пространству имен служебной шины, а каждое пространство имен служебной шины находится в регионе Azure. Важно стараться использовать пространство имен служебной шины в том же регионе, в котором размещено ваше приложение, чтобы избежать сетевых задержек.

Если вы хотите удалить из приложения гибридное подключение, щелкните его правой кнопкой мыши и выберите **Отключить**.  

После добавления гибридного подключения в приложение вы сможете просмотреть сведения о нем, просто щелкнув это подключение. 

![Снимок экрана сведений о гибридном подключении][5]

### <a name="create-a-hybrid-connection-in-the-azure-relay-portal"></a>Создание гибридного подключения на портале ретранслятора Azure ###

Помимо использования элементов интерфейса портала в приложении, вы можете создавать гибридные подключения на портале ретранслятора Azure. Чтобы гибридное подключение могло использоваться службой приложений, оно должно:

* требовать авторизации клиентов;
* использовать элемент метаданных endpoint, который содержит комбинацию "узел:порт" в качестве значения.

## <a name="hybrid-connections-and-app-service-plans"></a>Гибридные подключения и планы службы приложений ##

Функция гибридных подключений доступна только для ценовых категорий (номеров SKU) "Базовый", "Стандартный", "Премиум" и "Isolated". С каждым тарифным планом связаны определенные ограничения.  

> [!NOTE] 
> Новые гибридные подключения можно создавать только на основе ретранслятора Azure. Невозможно создавать новые гибридные подключения BizTalk.
>

| Ценовой план | Количество гибридных подключений в плане |
|----|----|
| базовая; | 5 |
| Стандартная | 25 |
| Премиум | 200 |
| Isolated | 200 |

Обратите внимание на то, что в плане службы приложений показано, сколько гибридных подключений используется и какими приложениями.  

![Снимок экрана свойств плана службы приложений][6]

Выберите гибридное подключение, чтобы просмотреть сведения о нем. Вы увидите все сведения, можно было увидеть в представлении приложения. Можно также узнать, сколько приложений в том же плане использует это гибридное подключение.

Существует ограничение числа конечных точек гибридного подключения, которые могут использоваться в плане службы приложений. Однако каждое гибридное подключение может использоваться любым числом приложений в этом плане. Например, отдельное гибридное подключение, используемое в пяти отдельных приложениях в плане службы приложений, считается одним гибридным подключением.

За использование гибридных подключений взимается дополнительная плата. Изучите сведения о [ценах на Service Bus][sbpricing].

## <a name="hybrid-connection-manager"></a>Hybrid Connection Manager ##

Для работы гибридных подключений в сети, в которой размещена конечная точка гибридного подключения, необходим агент ретрансляции. Он называется Hybrid Connection Manager (HCM). Чтобы скачать HCM из приложения на [портале Azure][portal], выберите **Сети** > **Настройте конечные точки гибридного подключения**.  

Данный инструмент работает в Windows Server 2012 и более поздних версиях. После установки HCM выполняется как служба, которая подключается к ретранслятору служебной шины Azure в соответствии с настроенными конечными точками. HCM устанавливает исходящие подключения к Azure через порт 443.    

После установки HCM можно запустить HybridConnectionManagerUi.exe, чтобы использовать пользовательский интерфейс этого инструмента. Этот файл расположен в каталоге установки диспетчера гибридных подключений. В Windows 10 можно также просто выполнить поиск *пользовательского интерфейса диспетчера гибридных подключений* в поле поиска.  

![Снимок экрана диспетчера гибридных подключений][7]

При запуске пользовательского интерфейса HCM первое, что вы видите, — это таблица со списком всех гибридных подключений, настроенных с помощью этого экземпляра HCM. Если вы хотите внести изменения, сначала пройдите аутентификацию в Azure. 

Вот как можно добавить одно или несколько гибридных подключений в HCM.

1. Запустите пользовательский интерфейс HCM.
1. Щелкните **Configure another hybrid connection** (Настроить еще одно гибридное подключение).
![Снимок экрана настройки новых гибридных подключений][8]

1. Войдите в систему с использованием учетной записи Azure.
1. Выберите подписку.
1. Щелкните гибридные подключения, которые HCM должен транслировать.
![Снимок экрана гибридных подключений][9]

1. Щелкните **Сохранить**.

Теперь вы увидите добавленные гибридные подключения. Можно также выбрать настроенное гибридное подключение, чтобы просмотреть сведения о нем.

![Снимок экрана сведений о гибридном подключении][10]

Чтобы HCM мог обслуживать настроенные для него гибридные подключения, ему требуется:

- доступ к Azure по протоколу TCP через порты 80 и 443;
- доступ к конечной точке гибридного подключения по протоколу TCP;
- возможность поиска DNS на узле конечной точки и в пространстве имен служебной шины Azure.

HCM поддерживает новые гибридные подключения и гибридные подключения BizTalk.

> [!NOTE]
> Ретранслятор Azure использует для подключения веб-сокеты. Эта возможность доступна только в Windows Server 2012 и более поздних версиях. Поэтому HCM не поддерживается в версиях, предшествующих Windows Server 2012.
>

### <a name="redundancy"></a>Избыточность ###

Каждый экземпляр HCM может поддерживать несколько гибридных подключений. Кроме того, любое заданное гибридное подключение может поддерживаться несколькими HCM. Режим по умолчанию — маршрутизация трафика методом циклического перебора между настроенными экземплярами HCM для любой заданной конечной точки. Если требуется обеспечить высокий уровень доступности гибридных подключений из сети, запустите несколько экземпляров HCM на разных компьютерах. 

### <a name="manually-add-a-hybrid-connection"></a>Добавление гибридного подключения вручную ###

Если необходимо, чтобы кто-либо вне вашей подписки разместил экземпляр HCM для заданного гибридного подключения, предоставьте ему строку подключения к шлюзу для этого гибридного подключения. Ее можно найти в свойствах гибридного подключения на [портале Azure][portal]. Чтобы использовать эту строку, нажмите кнопку **Ввести вручную** в HCM и вставьте строку подключения к шлюзу.


## <a name="troubleshooting"></a>Устранение неполадок ##

Состояние "Подключено" означает, что гибридное подключение настроено по крайней мере в одном HCM и оно позволяет подключиться к Azure. Если состояние вашего гибридного подключения не **Подключено**, то оно не настроено в HCM с доступом к Azure.

Основная причина, по которой клиенты не могут подключиться к своей конечной точке, состоит в том, что для нее был указан IP-адрес, а не DNS-имя. Если приложение не может связаться с требуемой конечной точкой и был указан IP-адрес, перейдите на использование DNS-имени, являющегося действительным на узле, на котором выполняется HCM. Также убедитесь, DNS-имя правильно разрешается для узла, на котором запущен HCM. Убедитесь в наличии подключения между узлом, на котором запущен HCM, и конечной точкой гибридного подключения.  

В службе приложений из консоли "Дополнительные инструменты (Kudu)" можно вызвать инструмент tcpping. Этот инструмент может сообщить, имеется ли доступ к конечной точке TCP, но не сообщает, имеется ли доступ к конечной точке гибридного подключения. Используя этот инструмент в консоли для конечной точки гибридного подключения, можно только подтвердить, что оно использует сочетание "узел:порт".  

## <a name="biztalk-hybrid-connections"></a>Гибридные подключения BizTalk ##

Устаревшая функция гибридных подключений BizTalk была заблокирована для создания гибридных подключений. Можно продолжить использование существующих гибридных подключений BizTalk в приложениях, но создавать следует новые гибридные подключения на основе ретранслятора Azure. По сравнению с версией BizTalk новая служба обладает следующими преимуществами:

- не требуется дополнительная учетная запись BizTalk;
- используется протокол TLS версии 1.2 вместо версии 1.0;
- обмен данными с Azure осуществляется через порты 80 и 443 с помощью DNS-имени, а не посредством IP-адресов и ряда дополнительных портов.  

Чтобы добавить существующее гибридное подключение BizTalk в приложение, перейдите в приложение на [портале Azure][portal] и щелкните **Сети** > **Настройте конечные точки гибридного подключения**. В таблице классических гибридных подключений щелкните **Добавить классическое гибридное подключение**. Вы увидите список гибридных подключений BizTalk.  


<!--Image references-->
[1]: ./media/app-service-hybrid-connections/hybridconn-connectiondiagram.png
[2]: ./media/app-service-hybrid-connections/hybridconn-portal.png
[3]: ./media/app-service-hybrid-connections/hybridconn-addhc.png
[4]: ./media/app-service-hybrid-connections/hybridconn-createhc.png
[5]: ./media/app-service-hybrid-connections/hybridconn-properties.png
[6]: ./media/app-service-hybrid-connections/hybridconn-aspproperties.png
[7]: ./media/app-service-hybrid-connections/hybridconn-hcm.png
[8]: ./media/app-service-hybrid-connections/hybridconn-hcmadd.png
[9]: ./media/app-service-hybrid-connections/hybridconn-hcmadded.png
[10]: ./media/app-service-hybrid-connections/hybridconn-hcmdetails.png

<!--Links-->
[HCService]: http://docs.microsoft.com/azure/service-bus-relay/relay-hybrid-connections-protocol/
[portal]: http://portal.azure.com/
[oldhc]: http://docs.microsoft.com/azure/biztalk-services/integration-hybrid-connection-overview/
[sbpricing]: http://azure.microsoft.com/pricing/details/service-bus/
