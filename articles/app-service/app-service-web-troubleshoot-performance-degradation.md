---
title: Низкая производительность веб-приложения в службе приложений | Документация Майкрософт
description: Эта статья поможет устранить причины снижения производительности веб-приложения, размещенного в службе приложений Azure.
services: app-service\web
documentationcenter: ''
author: cephalin
manager: erikre
editor: ''
tags: top-support-issue
keywords: Производительность веб-приложения, медленное приложение, приложение работает медленно
ms.assetid: b8783c10-3a4a-4dd6-af8c-856baafbdde5
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/03/2016
ms.author: cephalin
ms.openlocfilehash: 6b71aa004095a94bea84623fd2b5dbdfc1f81af0
ms.sourcegitcommit: d1f35f71e6b1cbeee79b06bfc3a7d0914ac57275
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/22/2018
ms.locfileid: "29461848"
---
# <a name="troubleshoot-slow-web-app-performance-issues-in-azure-app-service"></a>Устранение причин низкой производительности веб-приложения в службе приложений Azure
Эта статья поможет устранить причины снижения производительности веб-приложения, размещенного в [службе приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714).

Если вам потребуется дополнительная помощь по любому из вопросов, рассматриваемых в статье, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](https://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт службы поддержки Azure](https://azure.microsoft.com/support/options/) и щелкните **Поддержка**.

## <a name="symptom"></a>Симптом
При обращении к веб-приложению загрузка страницы идет медленно и может прерваться, превысив время ожидания.

## <a name="cause"></a>Причина:
Эта проблема часто связана с проблемами на уровне приложения, например:

* слишком долгое выполнение сетевых запросов;
* неэффективный код приложения или запросы к базе данных;
* слишком высокие требования приложения к памяти и процессору;
* сбой приложения из-за исключения.

## <a name="troubleshooting-steps"></a>Действия по устранению неполадок
Процесс устранения неполадок можно разделить на три последовательных задачи.

1. [Наблюдение за поведением приложения.](#observe)
2. [Сбор данных.](#collect)
3. [Устранение проблемы.](#mitigate)

[Веб-приложения службы приложений](/services/app-service/web/) содержат несколько инструментов для каждого из этих этапов.

<a name="observe" />

### <a name="1-observe-and-monitor-application-behavior"></a>1. Наблюдение за поведением приложения
#### <a name="track-service-health"></a>Мониторинг работоспособности службы
Microsoft Azure информирует о каждом случае прерывания работы или снижения производительности службы. За работоспособностью службы можно следить на [портале Azure](https://portal.azure.com/). Дополнительные сведения см. в статье [Получение информации о работоспособности службы](../monitoring-and-diagnostics/insights-service-health.md).

#### <a name="monitor-your-web-app"></a>Мониторинг веб-приложения
Этот инструмент позволяет определить наличие проблем с приложением. В колонке веб-приложения щелкните элемент **Запросы и ошибки** . Колонка **Метрика** содержит все метрики, которые вы можете добавить.

Некоторые из этих метрик помогут вам отслеживать работу веб-приложения, например:

* средний размер рабочего набора памяти;
* Среднее время ответа
* время ЦП;
* рабочий набор памяти;
* Requests

![Мониторинг производительности веб-приложения](./media/app-service-web-troubleshoot-performance-degradation/1-monitor-metrics.png)

Дополнительные сведения можно найти в разделе 

* [Мониторинг веб-приложений в службе приложений Azure](web-sites-monitor.md)
* [Создание оповещений для служб Azure с помощью портала Azure](../monitoring-and-diagnostics/insights-receive-alert-notifications.md)

#### <a name="monitor-web-endpoint-status"></a>Мониторинг состояния конечной веб-точки
Если вы запускаете веб-приложение в ценовой категории **Стандартный**, то веб-приложения позволяют отслеживать две конечных точки из трех географических расположений.

Функция мониторинга конечных точек настраивает веб-тесты из географически распределенных местоположений, позволяя проверить время ответа и время непрерывной работы URL-адресов. Тест выполняет операцию HTTP GET для URL-адреса веб-приложения и определяет время ответа и время непрерывной работы для каждого местоположения. Для каждого настроенного расположения тест выполняется каждые пять минут.

Время непрерывной работы контролируется при помощи кодов ответов HTTP, а время ответа измеряется в миллисекундах. Тест завершается с ошибкой, если код ответа HTTP больше или равен 400 или если на ответ требуется более 30 секунд. Конечная точка считается доступной, если тесты мониторинга завершились для нее успешно для всех указанных расположений.

Настройка описана в статье [Мониторинг приложений в службе приложений Azure](web-sites-monitor.md).

Кроме того, вы можете посмотреть видео, посвященное контролю конечных точек: [Поддержка работы веб-сайтов Azure с помощью мониторинга конечных точек (со Стефаном Щаковым ((Stefan Schackow))](https://channel9.msdn.com/Shows/Azure-Friday/Keeping-Azure-Web-Sites-up-plus-Endpoint-Monitoring-with-Stefan-Schackow) .

#### <a name="application-performance-monitoring-using-extensions"></a>Контроль производительности приложений с помощью расширений
Кроме того, вы можете отслеживать производительность приложения через *расширение сайта*.

Каждое веб-приложение службы приложений дает возможность использовать расширяемую конечную точку управления, которая позволяет применять набор мощных инструментов, развернутых в виде расширений сайта. Расширения включают в себя: 

- редакторы исходного кода, например [Visual Studio Team Services](https://www.visualstudio.com/products/what-is-visual-studio-online-vs.aspx); 
- инструменты управления для подключенных ресурсов, таких как база данных MySQL, подключенная к веб-приложению.

Также доступно расширение сайта для мониторинга производительности [Azure Application Insights](/services/application-insights/). Чтобы использовать Application Insights, перестройте код с помощью пакета SDK. Кроме того, вы можете установить расширение, которое предоставляет доступ к дополнительным данным. Пакет SDK позволяет писать код для более подробного отслеживания использования и производительности приложения. Дополнительные сведения см. в разделе о [мониторинге производительности в веб-приложениях](../application-insights/app-insights-web-monitor-performance.md).

<a name="collect" />

### <a name="2-collect-data"></a>2. Сбор данных
Среда веб-приложений содержит функции диагностики, которые позволяют сохранять в журналы информацию от веб-сервера и веб-приложения. Информация разделена следующим образом: диагностика веб-сервера и диагностика приложений.

#### <a name="enable-web-server-diagnostics"></a>Включение диагностики веб-сервера
Вы можете включить или отключить такие виды журналов:

* **Подробное ведение журнала ошибок** — регистрация подробной информации об ошибке для кодов состояния HTTP, которые указывают на сбой (код состояния 400 и выше). Здесь могут содержаться сведения, которые помогут определить причину, по которой сервер вернул код ошибки.
* **Трассировка неудачно завершенных запросов** — регистрация подробной информации о неудачных запросах, включая трассировку компонентов IIS для обработки запроса и время каждого компонента. Это может быть полезно, если вы пытаетесь повысить производительность веб-приложения или определить причину конкретной ошибки HTTP.
* **Журналы веб-сервера** — регистрация сведений о HTTP-транзакциях в расширенном формате файла журнала W3C. Это удобно при определении общих показателей веб-приложения, например количества обработанных запросов или количества запросов с определенного IP-адреса.

#### <a name="enable-application-diagnostics"></a>Включение диагностики приложений
Доступно несколько параметров сбора данных о производительности приложений из веб-приложений, динамического профилирования приложения из Visual Studio или изменения кода приложения для записи в журналы дополнительных сведений и трассировок. Эти параметры можно выбрать в зависимости имеющегося уровня доступа к приложению и информации, собранной инструментами мониторинга.

##### <a name="use-application-insights-profiler"></a>Использование Application Insights Profiler
Вы можете включить Application Insights Profiler, чтобы начать запись подробных трассировок производительности. Можно просмотреть трассировки, записанные за последние пять дней, если требуется изучить проблемы, возникшие в прошлом. Этот параметр можно выбрать при условии, что у вас имеется доступ к ресурсу Application Insights веб-приложения на портале Azure.

Application Insights Profiler предоставляет статистику по времени отклика каждого веб-вызова и выполняет трассировку, что помогает определить строку кода, которая привела к медленным откликам. Иногда приложение службы приложений работает медленно из-за определенного кода, который обеспечивает низкопроизводительное выполнения. К таким кодам относится последовательный код, который может выполняться параллельно и вызывать нежелательные конфликты в базе данных. Удаление этих узких мест в коде позволяет увеличить производительность приложения, но их трудно определить без настройки сбора событий трассировки и журналов. Данные трассировки, собранные Application Insights Profiler, помогают найти строки кода, замедляющие работу приложения, и устранить эту проблему для приложений службы приложений.

 Дополнительные сведения см. в статье [Профилирование динамических веб-приложений Azure с помощью Application Insights](../application-insights/app-insights-profiler.md).

##### <a name="use-remote-profiling"></a>Используйте удаленное профилирование
Служба приложений Azure позволяет удаленно профилировать веб-приложения, интерфейсные приложения и веб-задания. Выберите этот параметр, если у вас имеется доступ к ресурсу веб-приложения и вы знаете, как воспроизвести проблему, либо вам известен точный интервал времени, на котором были выявлены проблемы производительности.

Если процесс потребляет слишком много ресурсов ЦП и выполняется медленнее, чем вы ожидали, или если задержка HTTP-запросов выше обычной, то вы можете удаленно профилировать такой процесс. Вы получите стеки вызовов с выборками циклов ЦП, по которым можно выполнить анализ действий процесса и критических путей в программном коде.

Дополнительные сведения см. в статье [Поддержка удаленного профилирования в службе приложений Azure](https://azure.microsoft.com/blog/remote-profiling-support-in-azure-app-service).

##### <a name="set-up-diagnostic-traces-manually"></a>Настройка диагностических трассировок вручную
Если у вас имеется доступ к исходному коду веб-приложения, то с помощью диагностики приложений вы сможете записывать сведения, созданные этим веб-приложением. Приложения ASP.NET могут использовать класс `System.Diagnostics.Trace` для записи информации в журнал диагностики приложений. Тем не менее необходимо изменить код приложения и повторно развернуть его. Этот метод рекомендуется в том случае, если приложение выполняется в тестовой среде.

Подробные инструкции по настройке приложения для ведения журнала вы можете изучить в статье [Включение ведения журнала диагностики для веб-приложений в службе приложений Azure](web-sites-enable-diagnostic-log.md).

#### <a name="use-the-azure-app-service-support-portal"></a>Использование портала поддержки службы приложений Azure
Веб-приложения позволяют вам просматривать HTTP-журналы, журналы событий, дампы процессов и другую информацию для диагностики неполадок, связанных с вашим приложением. Эту информацию вы сможете найти на нашем портале поддержки по адресу **http://&lt;имя приложения>.scm.azurewebsites.net/Support**

На портале поддержки службы приложений Azure вы увидите три отдельные вкладки, соответствующие трем этапам стандартного процесса устранения неполадок.

1. Наблюдение за поведением.
2. Сбор диагностических данных и запуск встроенных средств анализа.
3. Устранение неполадки.

Если проблема происходит прямо сейчас, щелкните **Анализ** > **Диагностика** > **Диагностировать**. Так вы создадите сеанс диагностики, в ходе которого будут собираться журналы HTTP, журналы просмотра событий, дампы памяти, журналы ошибок PHP и отчет о процессах PHP.

После сбора данных на портале поддержки будет выполнен их анализ и создан отчет в формате HTML.

Вы также можете загрузить собранные данные на свой компьютер. По умолчанию они сохраняются в папке D:\home\data\DaaS.

Дополнительные сведения о возможностях портала поддержки службы приложений Azure см. в записи блога [New Updates to Support Site Extension for Azure Websites](https://azure.microsoft.com/blog/new-updates-to-support-site-extension-for-azure-websites) (Новые обновления для поддержки расширения сайта поддержки для службы "Веб-сайты Azure").

#### <a name="use-the-kudu-debug-console"></a>Использование консоли отладки Kudu
Веб-приложения оснащены консолью отладки, с помощью которой вы можете получать сведения о среде, используя функции отладки, изучения, передачи файлов и конечных точек JSON. Она называется *консолью Kudu* или *панелью мониторинга SCM* веб-приложения.

Вы можете открыть эту панель по ссылке **https://&lt;имя приложения>.scm.azurewebsites.net/**.

Вот некоторые возможности консоли Kudu:

* настройки среды для вашего приложения;
* потоковая передача журналов;
* диагностический дамп;
* консоль отладки с возможностью запуска командлетов Powershell и основных команд DOS.

У консоли Kudu есть еще одна очень полезная функция. Если приложение создает обрабатываемые исключения, с помощью консоли Kudu и средства SysInternals Procdump вы можете получать дампы памяти. Эти дампы представляют собой снимок процессов, выполняемых в момент создания исключения. Вы можете использовать эти данные при анализе сложных проблем в веб-приложении.

Дополнительные сведения о возможностях консоли Kudu см. в статье об [инструментах в Интернете для веб-сайтов Microsoft Azure](https://azure.microsoft.com/blog/windows-azure-websites-online-tools-you-should-know-about/).

<a name="mitigate" />

### <a name="3-mitigate-the-issue"></a>3. Устранение проблемы
#### <a name="scale-the-web-app"></a>Масштабирование веб-приложения
В службе приложений Azure вы можете изменять масштаб выполнения приложения, чтобы увеличить его производительность и пропускную способность. Масштабирование веб-приложений предполагает два связанных действия: изменение ценовой категории для используемого плана службы приложений на более высокую с последующей настройкой некоторых параметров.

Дополнительные сведения о масштабировании см. в статье [Увеличение масштаба приложения в Azure](web-sites-scale.md).

Кроме того, вы можете запустить более одного экземпляра приложения. Увеличение масштаба не только увеличит возможности обработки, но и повысит отказоустойчивость приложения. Если прекратит работу процесс на одном экземпляре, другой экземпляр продолжит обрабатывать запросы.

Вы можете выбрать ручной или автоматический режим масштабирования.

#### <a name="use-autoheal"></a>Использование функции AutoHeal
Функция AutoHeal перезапускает рабочий процесс вашего приложения при определенных условиях, которые вы определяете в настройках (например, при изменении конфигурации, при определенном количестве запросов, при достижении ограничений памяти или времени выполнения запроса). В большинстве случаев повторный запуск процесса будет самым быстрым способом устранения проблемы. Хотя веб-приложение всегда можно вручную перезапустить на портале Azure, функция AutoHeal позволяет выполнять перезапуск автоматически. Для этого достаточно добавить в корневой файл web.config вашего веб-приложения некоторые триггеры. Эти параметры одинаково работают во всех приложениях, а не только в приложениях .NET.

Дополнительные сведения см. в статье об [автоматическом восстановлении веб-сайтов Microsoft Azure](https://azure.microsoft.com/blog/auto-healing-windows-azure-web-sites/).

#### <a name="restart-the-web-app"></a>Перезапуск веб-приложения
Обычно перезапуск — самый простой способ восстановления работы после проблемы, которая возникла один раз. Остановить или перезапустить приложение можно с помощью колонки веб-приложения на [портале Azure](https://portal.azure.com/).

 ![Перезапуск веб-приложение для устранения проблем с производительностью](./media/app-service-web-troubleshoot-performance-degradation/2-restart.png)

Управлять приложениями можно также с помощью Azure Powershell. Дополнительные сведения см. в статье [Использование Azure PowerShell с диспетчером ресурсов Azure](../powershell-azure-resource-manager.md).
