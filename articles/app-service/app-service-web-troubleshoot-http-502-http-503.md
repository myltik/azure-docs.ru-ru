---
title: Устранение ошибок "502 — недопустимый шлюз" и "503 — служба недоступна" | Документация Майкрософт
description: Устранение ошибок "502 — недопустимый шлюз" и "503 — служба недоступна", возникающих при работе веб-приложения, размещенного в службе приложений Azure.
services: app-service\web
documentationcenter: ''
author: cephalin
manager: erikre
editor: ''
tags: top-support-issue
keywords: 502 — недопустимый шлюз, 503 — служба недоступна, ошибка 503, ошибка 502
ms.assetid: 51cd331a-a3fa-438f-90ef-385e755e50d5
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/06/2016
ms.author: cephalin
ms.openlocfilehash: 397a6aaf7dc27adfa0fc0e722b8a2be5cc1d75f0
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
ms.locfileid: "22986259"
---
# <a name="troubleshoot-http-errors-of-502-bad-gateway-and-503-service-unavailable-in-your-azure-web-apps"></a>Устранение ошибок HTTP "502 — недопустимый шлюз" и "503 — служба недоступна" в работе ваших веб-приложений Azure
"502 — недопустимый шлюз" и "503 — служба недоступна" — распространенные ошибки, возникающие при работе веб-приложения, размещенного в [службе приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714). Эта статья поможет вам устранить эти ошибки.

Если вам потребуется дополнительная помощь по любому из вопросов, рассматриваемых в статье, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](https://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт службы поддержки Azure](https://azure.microsoft.com/support/options/) и щелкните **Поддержка**.

## <a name="symptom"></a>Симптом
При открытии веб-приложения браузер возвращает ошибку HTTP "502 — недопустимый шлюз" или HTTP "503 — служба недоступна".

## <a name="cause"></a>Причина:
Эта проблема часто связана с проблемами на уровне приложения, например:

* слишком долгое выполнение запросов;
* слишком высокие требования приложения к памяти и процессору;
* сбой приложения из-за исключения.

## <a name="troubleshooting-steps-to-solve-502-bad-gateway-and-503-service-unavailable-errors"></a>Действия по устранению ошибок "502 — недопустимый шлюз" и "503 — служба недоступна"
Процесс устранения неполадок можно разделить на три последовательных задачи.

1. [Наблюдение за поведением приложения.](#observe)
2. [Сбор данных.](#collect)
3. [Устранение проблемы.](#mitigate)

[Веб-приложения службы приложений](/services/app-service/web/) содержат несколько инструментов для каждого из этих этапов.

<a name="observe" />

### <a name="1-observe-and-monitor-application-behavior"></a>1. Наблюдение за поведением приложения
#### <a name="track-service-health"></a>Мониторинг работоспособности службы
Microsoft Azure информирует о каждом случае прерывания работы или снижения производительности службы. Можно следить за работоспособностью службы на [портале Azure](https://portal.azure.com/). Дополнительные сведения см. в статье [Получение информации о работоспособности службы](../monitoring-and-diagnostics/insights-service-health.md).

#### <a name="monitor-your-web-app"></a>Мониторинг веб-приложения
Этот инструмент позволяет определить наличие проблем с приложением. В колонке веб-приложения щелкните элемент **Запросы и ошибки** . Колонка **Метрика** содержит все метрики, которые вы можете добавить.

Некоторые из этих метрик помогут вам отслеживать работу веб-приложения, например:

* средний размер рабочего набора памяти;
* Среднее время ответа
* время ЦП;
* рабочий набор памяти;
* Requests

![Мониторинг веб-приложения для устранения ошибок HTTP "502 — недопустимый шлюз" и "503 — служба недоступна"](./media/app-service-web-troubleshoot-HTTP-502-503/1-monitor-metrics.png)

Дополнительные сведения можно найти в разделе 

* [Мониторинг веб-приложений в службе приложений Azure](web-sites-monitor.md)
* [Создание оповещений для служб Azure с помощью портала Azure](../monitoring-and-diagnostics/insights-receive-alert-notifications.md)

<a name="collect" />

### <a name="2-collect-data"></a>2. Сбор данных
#### <a name="use-the-azure-app-service-support-portal"></a>Использование портала поддержки службы приложений Azure
Веб-приложения позволяют вам просматривать HTTP-журналы, журналы событий, дампы процессов и другую информацию для диагностики неполадок, связанных с вашим приложением. Эту информацию вы сможете найти на нашем портале поддержки по адресу **http://&lt;имя приложения>.scm.azurewebsites.net/Support**

На портале поддержки службы приложений Azure вы увидите три отдельные вкладки, соответствующие трем этапам стандартного процесса устранения неполадок.

1. Наблюдение за поведением.
2. Сбор диагностических данных и запуск встроенных средств анализа.
3. Устранение неполадки.

Если проблема происходит прямо сейчас, щелкните **Анализ** > **Диагностика** > **Диагностировать**. Так вы создадите сеанс диагностики, в ходе которого будут собираться HTTP-журналы, журналы просмотра событий, дампы памяти, журналы ошибок PHP и отчеты процесса PHP.

После сбора данных будет выполнен их анализ и создан отчет в формате HTML.

Вы также можете загрузить собранные данные на свой компьютер. По умолчанию они сохраняются в папке D:\home\data\DaaS.

Дополнительные сведения о возможностях портала поддержки службы приложений Azure см. в описании [обновлений расширения портала поддержки Azure](https://azure.microsoft.com/blog/new-updates-to-support-site-extension-for-azure-websites).

#### <a name="use-the-kudu-debug-console"></a>Использование консоли отладки Kudu
Веб-приложения оснащены консолью отладки, с помощью которой вы можете получать сведения о среде, используя функции отладки, изучения, передачи файлов и конечных точек JSON. Она называется *консолью Kudu* или *панелью SCM* приложения.

Вы можете открыть эту панель по ссылке **https://&lt;имя приложения>.scm.azurewebsites.net/**.

Вот некоторые возможности консоли Kudu:

* настройки среды для вашего приложения;
* потоковая передача журналов;
* диагностический дамп;
* консоль отладки с возможностью запуска командлетов Powershell и основных команд DOS.

У консоли Kudu есть еще одна очень полезная функция. Если приложение создает обрабатываемые исключения, с помощью консоли Kudu и средства SysInternals Procdump вы можете получать дампы памяти. Эти дампы представляют собой снимок процессов, выполняемых в момент создания исключения. Вы можете использовать эти данные при анализе сложных проблем в веб-приложении.

Дополнительные сведения о возможностях консоли Kudu см. в статье [Azure Websites online tools you should know about](https://azure.microsoft.com/blog/windows-azure-websites-online-tools-you-should-know-about/) (Интерактивные инструменты веб-сайтов Azure, о которых вам нужно знать).

<a name="mitigate" />

### <a name="3-mitigate-the-issue"></a>3. Устранение проблемы
#### <a name="scale-the-web-app"></a>Масштабирование веб-приложения
В службе приложений Azure вы можете изменять масштаб выполнения приложения, чтобы увеличить его производительность и пропускную способность. Масштабирование веб-приложений предполагает два связанных действия: изменение ценовой категории для используемого плана службы приложений на более высокую с последующей настройкой некоторых параметров.

Дополнительные сведения о масштабировании см. в статье [Увеличение масштаба приложения в Azure](web-sites-scale.md).

Кроме того, вы можете запустить более одного экземпляра приложения. Это не только увеличит возможности обработки, но и повысит устойчивость приложения к сбоям. Если прекратит работу один экземпляр приложения, другой экземпляр продолжит обрабатывать запросы.

Вы можете выбрать ручной или автоматический режим масштабирования.

#### <a name="use-autoheal"></a>Использование функции AutoHeal
Функция AutoHeal перезапускает рабочий процесс вашего приложения при определенных условиях, которые вы определяете в настройках (например, при изменении конфигурации, при определенном количестве запросов, при достижении ограничений памяти или времени выполнения запроса). В большинстве случаев повторный запуск процесса будет самым быстрым способом устранения проблемы. Хотя веб-приложение всегда можно вручную перезапустить на портале Azure, функция AutoHeal позволяет выполнять перезапуск автоматически. Для этого достаточно добавить в корневой файл web.config вашего веб-приложения некоторые триггеры. Эти параметры одинаково работают во всех приложениях, а не только в приложениях .NET.

Дополнительные сведения см. в статье об [автоматическом восстановлении веб-сайтов Microsoft Azure](https://azure.microsoft.com/blog/auto-healing-windows-azure-web-sites/).

#### <a name="restart-the-web-app"></a>Перезапуск веб-приложения
Обычно это самый простой способ восстановления после проблемы, которая возникла один раз. Остановить или перезапустить приложение можно при помощи колонки веб-приложения на [портале Azure](https://portal.azure.com/).

 ![Перезапуск приложения для устранения ошибок HTTP "502 — недопустимый шлюз" и "503 — служба недоступна"](./media/app-service-web-troubleshoot-HTTP-502-503/2-restart.png)

Управлять приложениями можно также с помощью Azure Powershell. Дополнительные сведения см. в статье [Использование Azure PowerShell с диспетчером ресурсов Azure](../powershell-azure-resource-manager.md).

