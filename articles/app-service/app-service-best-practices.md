---
title: Рекомендации по использованию службы приложений Azure
description: Ознакомьтесь с рекомендациями и методами устранения неполадок для службы приложений Azure.
services: app-service
documentationcenter: ''
author: dariagrigoriu
manager: erikre
editor: mollybos
ms.assetid: f3359464-fa44-4f4a-9ea6-7821060e8d0d
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/01/2016
ms.author: dariagrigoriu
ms.openlocfilehash: 7c5eb6190d4a4cdfa47779d2c4d7aadac5a2fb80
ms.sourcegitcommit: f1c1789f2f2502d683afaf5a2f46cc548c0dea50
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/18/2018
ms.locfileid: "27868324"
---
# <a name="best-practices-for-azure-app-service"></a>Рекомендации по использованию службы приложений Azure
В этой статье собраны рекомендации по использованию [службы приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714). 

## <a name="colocation"></a>Совместное размещение
Если входящие в решение ресурсы Azure, например веб-приложения и базы данных, находятся в разных регионах, возможны следующие последствия:

* увеличение задержки при взаимодействии между ресурсами,
* денежные расходы на передачу данных между регионами в соответствии со [стоимостью услуг Azure](https://azure.microsoft.com/pricing/details/data-transfers).

Совместное размещение в одном и том же регионе — оптимальный вариант для ресурсов Azure, составляющих отдельное решение, таких как веб-приложение и база данных, а также учетной записи хранения, в которой хранятся содержимое или данные. При создании ресурсов следует убедиться в том, что они находятся в одном регионе Azure, если иное не диктуется особенностями вашего бизнеса или структуры решения. Вы можете переместить приложение службы приложений в тот же регион, в котором расположена база данных, с помощью [функции клонирования службы приложений](app-service-web-app-cloning.md). В настоящее время она доступна для плана службы приложений уровня "Премиум".   

## <a name="memoryresources"></a>Если приложения используют больше памяти, чем ожидалось
Если вы заметите по данным мониторинга или по рекомендациям службы, что приложение использует больше памяти, чем ожидалось, попробуйте применить [функцию автоматического восстановления службы приложений](https://azure.microsoft.com/blog/auto-healing-windows-azure-web-sites). В одном из режимов работы функция автоматического восстановления выполняет действия с учетом заданного порога использования памяти. Возможные действия включают уведомления по электронной почте, исследования с помощью дампа памяти, мгновенное реагирование с перезапуском рабочего процесса. Функция автоматического восстановления настраивается через файл web.config или через удобный пользовательский интерфейс, как описано в записи блога [App Service Support Site Extension](https://azure.microsoft.com/blog/additional-updates-to-support-site-extension-for-azure-app-service-web-apps)(Расширение сайта поддержки для службы приложений).   

## <a name="CPUresources"></a>Если приложения используют больше ресурсов ЦП, чем ожидалось
Если вы заметите по данным мониторинга или по рекомендациям службы, что приложение потребляет больше ресурсов ЦП, чем ожидалось, или регулярно создает пиковые нагрузки на ЦП, примените вертикальное или горизонтальное масштабирование плана службы приложений. Если приложение отслеживает состояние, допустимо только вертикальное масштабирование. Если же приложение работает без отслеживания состояния, горизонтальное масштабирование более предпочтительно, поскольку оно обеспечит дополнительную гибкость и больше возможностей. 

Дополнительные сведения об отслеживании состояния в приложении можно получить в видеопрезентации [Planning a Scalable End-to-End Multi-Tier Application on Microsoft Azure Web App](https://channel9.msdn.com/Events/TechEd/NorthAmerica/2014/DEV-B414#fbid=?hashlink=fbid) (Проектирование масштабируемого полнофункционального многоуровневого приложения в службе приложений Microsoft Azure). Дополнительные сведения о масштабировании службы приложений и возможностях автоматического масштабирования см. в статье [Увеличение масштаба приложения в Azure](web-sites-scale.md).  

## <a name="socketresources"></a>Если исчерпаны ресурсы сокетов
Резерв исходящих TCP-подключений обычно исчерпывается, если используемые клиентские библиотеки не поддерживают повторное использование TCP-подключений или не используют метод проверки активности (Keep-Alive) для протоколов более высокого уровня (например, HTTP). Ознакомьтесь с документацией по каждой библиотеке, на которые ссылаются приложения в вашем плане службы приложений, и убедитесь, что настройка этих библиотек и методы их вызова обеспечивают эффективное повторное использование исходящих подключений. Также выполните все приведенные в документации рекомендации по правильному созданию, освобождению и очистке подключений, чтобы избежать утечки данных во время подключений. Пока выполняется эта проверка клиентских библиотек, последствия можно временно устранить, увеличив количество экземпляров.

### <a name="nodejs-and-outgoing-http-requests"></a>Node.js и исходящие HTTP-запросы
При работе с Node.js и большим числом исходящих HTTP-запросов важна поддержка открытых соединений HTTP. Чтобы упростить код, вы можете использовать пакет `npm` [agentkeepalive](https://www.npmjs.com/package/agentkeepalive).

Обязательно выполняйте обработку ответа `http`, даже при отсутствии действий в обработчике. Если не обработать ответ надлежащим образом, в работе приложения со временем возникнут затруднения, так как не останется дополнительных сокетов.

Например, при работе с пакетом `http` или `https`:

```
var request = https.request(options, function(response) {
    response.on('data', function() { /* do nothing */ });
});
```

Если служба приложений на платформе Linux работает на компьютере с несколькими ядрами, рекомендуем использовать PM2, чтобы запустить несколько процессов Node.js для выполнения приложения. Для этого можно указать команду запуска контейнера.

Например, чтобы запустить четыре экземпляра:

```
pm2 start /home/site/wwwroot/app.js --no-daemon -i 4
```

## <a name="appbackup"></a>Когда начинаются сбои архивации приложения
Две основные причины, по которым происходят сбои архивации приложения, это недопустимые параметры хранилища и недопустимая конфигурация базы данных. Эти сбои обычно происходят при изменении ресурсов хранилища или базы данных либо в случае изменения способа доступа к этим ресурсам (например, были обновлены учетные данные для базы данных, выбранной в параметрах архивации). Обычно архивация выполняется по расписанию и требует доступа к хранилищу (для вывода резервной копии файлов) и базам данных (для копирования и чтения содержимого, добавляемого в резервную копию). В случае отсутствия доступа к любому из этих ресурсов будет постоянно происходить сбой архивации. 

При возникновении сбоев архивации просмотрите последние результаты, чтобы понять, какого типа происходит сбой. В случае сбоев доступа к хранилищу просмотрите и обновите параметры хранилища, используемые в конфигурации архивации. В случае сбоев доступа к базам данных просмотрите и обновите строки подключения в параметрах приложения. Затем обновите конфигурацию архивации соответствующим образом, добавив в нее необходимые базы данных. Дополнительные сведения об архивации приложений см. в статье [Архивация приложения в Azure](web-sites-backup.md).

## <a name="nodejs"></a>Развертывание новых приложений Node.js в службе приложений Azure
Конфигурация по умолчанию службы приложений Azure для приложений Node.js предназначена для наиболее распространенных из них. Если в конфигурации для приложения Node.js целесообразно использовать персонализированные настройки, чтобы повысить производительность или оптимизировать использование ресурсов ЦП, памяти и сети, ознакомьтесь со статьей [Рекомендации и руководство по устранению неполадок приложений Node в веб-приложениях Azure](app-service-web-nodejs-best-practices-and-troubleshoot-guide.md). В этой статье описаны параметры IISNode, которые может потребоваться настроить для приложения Node.js. В ней также рассмотрены различные сценарии и проблемы, которые могут возникнуть при работе приложения, и показано, как устранить эти проблемы.

