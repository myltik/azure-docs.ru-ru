---
title: Вопросы и ответы о производительности приложений в веб-приложениях Azure | Документация Майкрософт
description: Ответы на часто задаваемые вопросы о доступности, производительности и проблемах приложений в веб-приложениях службы приложений Azure.
services: app-service\web
documentationcenter: ''
author: genlin
manager: cshepard
editor: ''
tags: top-support-issue
ms.assetid: 2fa5ee6b-51a6-4237-805f-518e6c57d11b
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 05/11/2018
ms.author: genli
ms.openlocfilehash: 9c8eda1c4a65465a93b9c3f9caf23a6663073f26
ms.sourcegitcommit: e14229bb94d61172046335972cfb1a708c8a97a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2018
ms.locfileid: "34159296"
---
# <a name="application-performance-faqs-for-web-apps-in-azure"></a>Вопросы и ответы о производительности приложений в веб-приложениях Azure

В этой статье приведены ответы на часто задаваемые вопросы о проблемах производительности приложений в [веб-приложениях службы приложений Azure](https://azure.microsoft.com/services/app-service/web/).

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

## <a name="why-is-my-app-slow"></a>Почему приложение работает медленно?

На снижение производительности приложения могут влиять несколько факторов. Подробные инструкции по устранению неполадок см. в разделе [Устранение причин низкой производительности веб-приложения в службе приложений Azure](app-service-web-troubleshoot-performance-degradation.md).

## <a name="how-do-i-troubleshoot-a-high-cpu-consumption-scenario"></a>Как устранить проблемы, связанные с высоким уровнем потребления ресурсов ЦП?

В некоторых сценариях с высоким уровнем потребления ресурсов ЦП приложение действительно требует большего объема вычислительных ресурсов. В этом случае мы советуем выбрать более высокий уровень служб, за счет чего приложение получит все необходимые ресурсы. Кроме того, причиной высокого уровня потребления ресурсов ЦП может стать неправильный цикл или процедура кодирования. Чтобы определить причину более активного использования ресурсов ЦП, необходимо выполнить два действия. Сначала создайте дамп процесса, а затем выполните его анализ. Дополнительные сведения см. в записи блога [How to capture and analyze a dump file when intermittent High CPU happens on Azure Web App](https://blogs.msdn.microsoft.com/asiatech/2016/01/20/how-to-capture-dump-when-intermittent-high-cpu-happens-on-azure-web-app/) (Создание и анализ файла дампа при высоком уровне потребления ресурсов ЦП в веб-приложениях Azure).

## <a name="how-do-i-troubleshoot-a-high-memory-consumption-scenario"></a>Как устранить проблемы, связанные с высоким уровнем потребления памяти?

В некоторых сценариях с высоким уровнем потребления памяти приложение действительно требует большего объема вычислительных ресурсов. В этом случае мы советуем выбрать более высокий уровень служб, за счет чего приложение получит все необходимые ресурсы. Кроме того, причиной высокого уровня потребления и утечки памяти может стать ошибка в коде или процедура кодирования. Чтобы определить причину активного использования памяти, необходимо выполнить два действия. Сначала создайте дамп процесса, а затем выполните его анализ. Средство диагностики аварийного завершения из коллекции Azure Site Extensions позволяет эффективно выполнять оба этих действия. Дополнительные сведения см. в записи блога [How to capture and analyze dump for intermittent High Memory on Azure Web App](https://blogs.msdn.microsoft.com/asiatech/2016/02/02/how-to-capture-and-analyze-dump-for-intermittent-high-memory-on-azure-web-app/) (Создание и анализ файла дампа при высоком уровне потребления памяти в веб-приложениях Azure).

## <a name="how-do-i-automate-app-service-web-apps-by-using-powershell"></a>Как автоматизировать задачи веб-приложений службы приложений с помощью PowerShell?

Настроить веб-приложения службы приложений и управлять ими можно с помощью командлетов PowerShell. В записи блога [Automate web apps hosted in Azure App Service by using PowerShell](https://blogs.msdn.microsoft.com/puneetgupta/2016/03/21/automating-webapps-hosted-in-azure-app-service-through-powershell-arm-way/) (Автоматизация веб-приложений, размещенных в службе приложений Azure с помощью PowerShell) описана процедура автоматизации стандартных задач с помощью командлетов PowerShell на основе Azure Resource Manager. Кроме того, в этой записи блога приведен пример кода для различных задач управления веб-приложениями. Описание и синтаксис всех командлетов веб-приложений службы приложений см. в [этой статье](https://docs.microsoft.com/powershell/module/azurerm.websites/?view=azurermps-4.0.0).

## <a name="how-do-i-view-my-web-apps-event-logs"></a>Как просмотреть журналы событий веб-приложения?

Чтобы просмотреть журналы событий веб-приложения, сделайте следующее:

1. Перейдите на [веб-сайт Kudu](https://*yourwebsitename*.scm.azurewebsites.net).
2. В меню выберите **Консоль отладки** > **CMD**.
3. Выберите папку **LogFiles**.
4. Чтобы просмотреть журналы событий, щелкните значок карандаша рядом с файлом **eventlog.xml**.
5. Чтобы загрузить журналы, выполните командлет PowerShell `Save-AzureWebSiteLog -Name webappname`.

## <a name="how-do-i-capture-a-user-mode-memory-dump-of-my-web-app"></a>Как создать дамп памяти пользовательского режима веб-приложения?

Чтобы создать дамп памяти пользовательского режима веб-приложения, сделайте следующее:

1. Перейдите на [веб-сайт Kudu](https://*yourwebsitename*.scm.azurewebsites.net).
2. Откройте меню **Обозреватель процессов**.
3. Щелкните правой кнопкой мыши процесс **w3wp.exe** или процесс веб-задания.
4. Выберите **Download Memory Dump** (Загрузить дамп памяти) > **Full Dump** (Полный дамп).

## <a name="how-do-i-view-process-level-info-for-my-web-app"></a>Как просмотреть сведения уровня процесса о веб-приложении?

Сведения уровня процесса о веб-приложении можно просмотреть двумя способами:

*   На портале Azure выполните следующие действия.
    1. Откройте **обозреватель процессов** веб-приложения.
    2. Чтобы просмотреть сведения, выберите процесс **w3wp.exe**.
*   В консоли Kudu:
    1. Перейдите на [веб-сайт Kudu](https://*yourwebsitename*.scm.azurewebsites.net).
    2. Откройте меню **Обозреватель процессов**.
    3. Откройте меню **Свойства** процесса **w3wp.exe**.

## <a name="when-i-browse-to-my-app-i-see-error-403---this-web-app-is-stopped-how-do-i-resolve-this"></a>При переходе к приложению возникает ошибка 403 "Это веб-приложение остановлено". Как решить эту проблему?

Эта ошибка может возникнуть в трех случаях:

* затраты на веб-приложение достигли установленного предела и сайт был отключен;
* веб-приложение остановлено на портале;
* для веб-приложения достигнут предел квоты на ресурсы, который применяется к планам масштабирования "Бесплатно" или "Общий".

Чтобы определить причину ошибки и устранить ее, выполните указания из записи блога [Azure Web Apps: Error 403 — This web app is stopped](https://blogs.msdn.microsoft.com/waws/2016/01/05/azure-web-apps-error-403-this-web-app-is-stopped/) (Ошибка 403 "Это веб-приложение остановлено" в веб-приложениях Azure).

## <a name="where-can-i-learn-more-about-quotas-and-limits-for-various-app-service-plans"></a>Где можно просмотреть сведения о квотах и ограничениях для различных планов службы приложений?

Сведения о квотах и ограничениях см. в [этом разделе](../azure-subscription-service-limits.md#app-service-limits). 

## <a name="how-do-i-decrease-the-response-time-for-the-first-request-after-idle-time"></a>Как уменьшить время отклика при первом запросе после времени простоя?

По умолчанию в случае простоя в течение заданного периода времени веб-приложения выгружаются. Это позволяет сэкономить системные ресурсы. Недостатком является то, что ответ на первый запрос, отравленный после выгрузки веб-приложения, возвращается дольше. Это позволяет веб-приложению загрузиться и приступить к обработке ответов. При использовании планов обслуживания "Базовый" и "Стандартный" вы можете включить параметр **Всегда включено**, чтобы предотвратить выгрузку приложения. Это позволит избежать более длительного времени загрузки после простоя приложения. Чтобы включить параметр **Всегда включено**, сделайте следующее:

1. Откройте портал Azure и перейдите к своему веб-приложению.
2. Выберите **Параметры приложения**.
3. Установите переключатель **Всегда включено** в положение **Вкл.**

## <a name="how-do-i-turn-on-failed-request-tracing"></a>Как включить трассировку неудачно завершенных запросов?

Чтобы включить трассировку неудачно завершенных запросов, сделайте следующее:

1. Откройте портал Azure и перейдите к своему веб-приложению.
3. Выберите **Все параметры** > **Журналы диагностики**.
4. Установите переключатель **Трассировка неудачно завершенных запросов** в положение **Вкл.**
5. Щелкните **Сохранить**.
6. В колонке веб-приложения выберите **Средства**.
7. Выберите **Visual Studio Online**.
8. Если этот параметр **выключен**, **включите** его.
9. Выберите **Перейти**.
10. Выберите **Web.config**.
11. В разделе system.webServer добавьте следующую конфигурацию (для записи определенного URL-адреса):

    ```
    <system.webServer>
    <tracing> <traceFailedRequests>
    <remove path="*api*" />
    <add path="*api*">
    <traceAreas>
    <add provider="ASP" verbosity="Verbose" />
    <add provider="ASPNET" areas="Infrastructure,Module,Page,AppServices" verbosity="Verbose" />
    <add provider="ISAPI Extension" verbosity="Verbose" />
    <add provider="WWW Server" areas="Authentication,Security,Filter,StaticFile,CGI,Compression, Cache,RequestNotifications,Module,FastCGI" verbosity="Verbose" />
    </traceAreas>
    <failureDefinitions statusCodes="200-999" />
    </add> </traceFailedRequests>
    </tracing>
    ```
12. Чтобы устранить проблемы, которые приводят к снижению производительности, добавьте следующую конфигурацию (если запись запроса занимает более 30 секунд):
    ```
    <system.webServer>
    <tracing> <traceFailedRequests>
    <remove path="*" />
    <add path="*">
    <traceAreas> <add provider="ASP" verbosity="Verbose" />
    <add provider="ASPNET" areas="Infrastructure,Module,Page,AppServices" verbosity="Verbose" />
    <add provider="ISAPI Extension" verbosity="Verbose" />
    <add provider="WWW Server" areas="Authentication,Security,Filter,StaticFile,CGI,Compression, Cache,RequestNotifications,Module,FastCGI" verbosity="Verbose" />
    </traceAreas>
    <failureDefinitions timeTaken="00:00:30" statusCodes="200-999" />
    </add> </traceFailedRequests>
    </tracing>
    ```
13. Чтобы загрузить трассировки невыполненных запросов в журнал, откройте [портал](https://portal.azure.com) и перейдите на свой веб-сайт.
15. Выберите **Средства** > **Kudu** > **Перейти**.
18. В меню выберите **Консоль отладки** > **CMD**.
19. Выберите папку **LogFiles**, а затем выберите папку, имя которой начинается с **W3SVC**.
20. Чтобы открыть XML-файл, щелкните значок карандаша.

## <a name="i-see-the-message-worker-process-requested-recycle-due-to-percent-memory-limit-how-do-i-address-this-issue"></a>Отображается сообщение "Worker Process requested recycle due to 'Percent Memory' limit" (Рабочий процесс запросил перезапуск из-за предельного объема памяти). Как устранить эту проблему?

Максимальный объем памяти для 32-разрядного процесса (даже в 64-разрядной операционной системе) составляет 2 ГБ. По умолчанию в службе приложений используются 32-разрядные рабочие процессы (для совместимости с устаревшими веб-приложениями).

Мы советуем перейти на 64-разрядные процессы. Это позволит выделить для рабочей веб-роли дополнительный объем памяти. В этом случае приложение перезапустится. Спланируйте этот процесс должным образом.

Кроме того, обратите внимание, что для 64-разрядной среды требуется план обслуживания "Базовый" или "Стандартный". В 32-разрядной среде всегда используются планы обслуживания "Бесплатный" и "Общий".

Дополнительные сведения см. в статье [Настройка веб-приложений в службе приложений Azure](web-sites-configure.md).

## <a name="why-does-my-request-time-out-after-240-seconds"></a>Почему после 240 секунд истекает время запроса?

По умолчанию время ожидания простоя в Azure Load Balancer имеет значение 4 минуты. Обычно это логичное ограничение по времени отклика для веб-запроса. Если обработка веб-приложения также выполняется в фоновом режиме, мы советуем использовать веб-задания Azure. Веб-приложение Azure может вызывать веб-задания и получать уведомления при завершении фоновой обработки. Доступно несколько методов использования веб-заданий, в том числе очереди и триггеры.

Веб-задания предназначены для фоновой обработки. Ограничения на выполнение фоновой обработки в веб-задании отсутствуют. Дополнительные сведения о веб-заданиях см. в статье [Выполнение фоновых задач с веб-заданиями](web-sites-create-web-jobs.md).

## <a name="aspnet-core-applications-that-are-hosted-in-app-service-sometimes-stop-responding-how-do-i-fix-this-issue"></a>Приложения ASP.NET Core, размещенные в службе приложений, иногда перестают отвечать на запросы. Как устранить эту проблему?

Проблема, из-за которой приложение ASP.NET Core 1.0, размещенное в службе приложений, периодически перестает отвечать на запросы, может быть вызвана известной проблемой в ранней версии [Kestrel](https://github.com/aspnet/KestrelHttpServer/issues/1182). Кроме того, может появиться такое сообщение: "В указанном приложении CGI возникла ошибка, и процесс был остановлен сервером".

Эта проблема исправлена в Kestrel версии 1.0.2. Эта версия входит в состав обновления ASP.NET Core 1.0.3. Чтобы устранить эту проблему, обновите зависимости приложения для использования Kestrel 1.0.2. Кроме того, эту проблему можно решить одним из двух способов, описанных в записи блога [ASP.NET Core 1.0 slow perf issues in App Service web apps](https://blogs.msdn.microsoft.com/waws/2016/12/11/asp-net-core-slow-perf-issues-on-azure-websites) (Проблемы низкой производительности ASP.NET Core 1.0 в веб-приложениях службы приложений).


## <a name="i-cant-find-my-log-files-in-the-file-structure-of-my-web-app-how-can-i-find-them"></a>В структуре файла веб-приложения не отображаются файлы журналов. Как их найти?

Функция локального кэша службы приложений изменяет структуру папок файлов журналов и данных экземпляра службы приложений. При использовании локального кэша в этих папках создаются вложенные папки. Имя вложенных папок состоит из уникального идентификатора, заключенного в двойные кавычки, и метки времени. Каждая вложенная папка соответствует экземпляру виртуальной машины, на котором выполняется или запущено веб-приложение.

Чтобы определить, используется ли локальный кэш, перейдите на вкладку **Параметры приложения** службы приложений. Если локальный кэш используется, параметр `WEBSITE_LOCAL_CACHE_OPTION` имеет значение `Always`.

Если вы не используете локальный кэш и возникла эта ошибка, отправьте запрос на техническую поддержку.

## <a name="i-see-the-message-an-attempt-was-made-to-access-a-socket-in-a-way-forbidden-by-its-access-permissions-how-do-i-resolve-this"></a>Отображается сообщение "Сделана попытка доступа к сокету методом, запрещенным правами доступа". Как решить эту проблему?

Эта ошибка обычно возникает, если достигнут предел исходящих TCP-подключений на экземпляре виртуальной машины. В службе приложений применяются ограничения на максимальное количество исходящих подключений каждого экземпляра виртуальной машины. Дополнительные сведения см. в разделе [Ограничения на подключения между виртуальными машинами](https://github.com/projectkudu/kudu/wiki/Azure-Web-App-sandbox#cross-vm-numerical-limits).

Эта ошибка также может возникать при попытке подключения к локальному адресу из приложения. Дополнительные сведения см. в разделе [Запросы на подключения к локальным адресам](https://github.com/projectkudu/kudu/wiki/Azure-Web-App-sandbox#local-address-requests).

Дополнительные сведения об исходящих подключениях веб-приложений см. в [этой записи блога](http://www.freekpaans.nl/2015/08/starving-outgoing-connections-on-windows-azure-web-sites/).

## <a name="how-do-i-use-visual-studio-to-remote-debug-my-app-service-web-app"></a>Как выполнить удаленную отладку веб-приложения службы приложений с помощью Visual Studio?

Пошаговые указания по выполнению отладки веб-приложения с помощью Visual Studio см. в [этой записи блога](https://blogs.msdn.microsoft.com/benjaminperkins/2016/09/22/remote-debug-your-azure-app-service-web-app/).
