---
title: Создание внешней среды службы приложений Azure
description: Сведения о создании среды службы приложений во время создания приложения или с помощью пользовательского интерфейса автономного создания.
services: app-service
documentationcenter: na
author: ccompy
manager: stefsch
ms.assetid: 94dd0222-b960-469c-85da-7fcb98654241
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/13/2017
ms.author: ccompy
ms.openlocfilehash: debfff03ea9a4de4fb2cd69779d58709a6a3a34f
ms.sourcegitcommit: e221d1a2e0fb245610a6dd886e7e74c362f06467
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2018
---
# <a name="create-an-external-app-service-environment"></a>Создание внешней среды службы приложений #

Среда службы приложений — это развернутая служба приложений Azure в подсети виртуальной сети Azure. Существует два способа развертывания среды службы приложений (ASE):

- с виртуальным IP-адресом на основе внешнего IP-адреса, что часто называют внешней средой ASE;
- с виртуальным IP-адресом на основе внутреннего IP-адреса, что часто называют средой службы приложений с внутренним балансировщиком нагрузки, так как внутренней конечной точкой является внутренний балансировщик нагрузки (ILB).

В этой статье показано, как создать внешнюю среду ASE. Общие сведения о среде службы приложений см. в [этой статье][Intro]. Дополнительные сведения о создании среды ASE с внутренним балансировщиком нагрузки см. в статье [Создание и использование внутренней подсистемы балансировки нагрузки со средой службы приложений][MakeILBASE].

## <a name="before-you-create-your-ase"></a>Перед созданием среды службы приложений ##

После создания среды ASE нельзя изменить следующие параметры:

- Расположение
- Подписка
- Группа ресурсов
- Используемая виртуальная сеть
- Используемая подсеть
- Размер подсети

> [!NOTE]
> При выборе виртуальной сети и указании подсети их размер должен быть достаточно большим для дальнейшего роста. Рекомендуемый размер — `/25` с 128 адресами.
>

## <a name="three-ways-to-create-an-ase"></a>Три способа создания ASE ##

Существует три способа создания ASE:

- **При создании плана службы приложений.** При этом ASE и план службы приложений создаются одновременно.
- **Отдельно.** При этом создается пустая среда ASE. Этот более продвинутый способ создания ASE. Так вы можете создать ASE с ILB.
- **Из шаблона Azure Resource Manager.** Этот метод предназначен для опытных пользователей. Дополнительные сведения см. в статье [Создание среды службы приложений с внутренней подсистемой балансировки нагрузки с помощью шаблонов Azure Resource Manager][MakeASEfromTemplate].

Внешняя среда ASE имеет общедоступный виртуальный IP-адрес. Это означает, что весь трафик HTTP и HTTPS, передающийся в приложения в ASE, достигает доступного из Интернета IP-адреса. ASE с ILB имеет IP-адрес из подсети, используемой ASE. Приложения, размещенные в ASE с ILB, не подключены непосредственно к Интернету.

## <a name="create-an-ase-and-an-app-service-plan-together"></a>Одновременное создание среды ASE и плана службы приложений ##

План службы приложений представляет собой контейнер приложений. При создании приложения в службе приложений можно выбрать или создать план службы приложений. В средах службы приложений содержатся планы службы приложений, которые в свою очередь содержат приложения.

Чтобы создать ASE при создании плана службы приложений, сделайте следующее:

1. На [портале Azure](https://portal.azure.com/) последовательно выберите **Создать ресурс** > **Интернет и мобильные устройства** > **Веб-приложение**.

    ![Создание веб-приложения][1]

2. Выберите свою подписку. ASE и приложение создаются в одной подписке.

3. Выберите или создайте группу ресурсов. С помощью групп ресурсов можно управлять связанными ресурсами Azure как единым целым. Группы ресурсов также полезны при установке правил управления доступом на основе ролей для приложений. Дополнительные сведения см. в [обзоре Azure Resource Manager][ARMOverview].

4. Выберите используемую операционную систему. 

    * Размещение приложения Linux в ASE — новая функция, которая находится в предварительной версии, поэтому мы рекомендуем пока не добавлять в ASE приложения Linux, выполняющие рабочие нагрузки. 
    * Когда вы добавляете приложение Linux в ASE, эта ASE также переходит в режим предварительной версии. 

5. Выберите план службы приложений и щелкните **Создать**. Веб-приложения Linux и Windows не могут находиться в одном плане службы приложений, но могут находиться в одной среде службы приложений. 

    ![Новый план службы приложений][2]

6. В раскрывающемся списке **Расположение** выберите регион, где нужно создать ASE. При выборе имеющейся среды ASE новая не создается. План службы приложений создается в выбранной среде ASE. 

    > [!NOTE]
    > Поддержка Linux в ASE пока доступна только в 6 регионах: **западная часть США, восточная часть США, Западная Европа, Северная Европа, Восточная Австралия, Юго-Восточная Азия.** Так как функция Linux в ASE находится в предварительной версии, ни в коем случае НЕ ВЫБИРАЙТЕ ASE, созданную до выхода этой предварительной версии.
    >

7. Выберите **Ценовая категория** и одну из ценовых категорий (номер SKU) уровня **Isolated**. Выбор расположения и номера SKU уровня **Isolated**, недоступного в имеющейся среде ASE, создается еще одна среда в этом расположении. Чтобы запустить процесс создания ASE, нажмите кнопку **Выбрать**. Номер SKU уровня **Isolated** доступен только в среде ASE. Это также означает, что в среде ASE можно использовать только номер SKU уровня **Isolated**. 

    * На время действия предварительной версии для поддержки Linux в ASE будет действовать скидка 50 % на изолированный номер SKU (эта скидка не распространяется на фиксированную стоимость самой ASE).

    ![Выбор ценовой категории][3]

8. Введите имя среды ASE. Это имя используется в имени для обращения к приложению. Если для ASE указано имя _appsvcenvdemo_, то доменным именем будет *.appsvcenvdemo.p.azurewebsites.net*. Если затем создать веб-приложение с именем *mytestapp*, то к нему можно будет обращаться по адресу mytestapp.appsvcenvdemo.p.azurewebsites.net. В имени нельзя использовать пробелы. Если вы используете символы верхнего регистра, в доменном имени будут использоваться такие же символы нижнего регистра.

    ![Имя нового плана службы приложений][4]

9. Укажите сведения о виртуальной сети Azure. Выберите **Создать** или **Выбрать существующую**. Параметр для выбора имеющейся виртуальной сети доступен только при наличии виртуальной сети в выбранном регионе. Выбрав **Создать**, введите имя виртуальной сети. При этом будет создана виртуальная сеть диспетчера ресурсов с таким именем. Она использует адресное пространство `192.168.250.0/23` в выбранном регионе. Если вы выбрали параметр **Выбрать существующую**, вам потребуется:

    a. Выбрать блок адресов виртуальной сети (при наличии нескольких).

    Б. Введите новое имя подсети.

    c. Выбрать размер подсети. *Выберите размер, достаточный для дальнейшего роста среды ASE.* Рекомендуемый размер — `/25`. Такая подсеть содержит 128 адресов и может обслуживать среду службы приложений максимального размера. Мы не советуем задавать, например, размер `/28`, так как доступно только 16 адресов. В инфраструктуре используется не менее семи адресов, а в категории служб "Сеть Azure" — другие 5. В подсети `/28` у вас остается возможность масштабировать 4 экземпляра плана службы приложений для внешней среды ASE и только 3 экземпляра плана для ILB ASE.

    d. Выбрать диапазон IP-адресов подсети.

10. Выберите **Создать**, чтобы создать ASE. При этом также создается план службы приложений и приложение. Среда ASE, план службы приложений и приложение создаются в рамках одной подписки и в той же группе ресурсов. Если среде нужна отдельная группа ресурсов или если нужно создать среду ASE с внутренней подсистемой балансировки нагрузки, тогда воспользуйтесь инструкциями по созданию автономной среды ASE.

## <a name="create-an-ase-and-a-linux-web-app-using-a-custom-docker-image-together"></a>Создание ASE и веб-приложения Linux с помощью настраиваемого образа Docker

1. На [портале Azure](https://portal.azure.com/) последовательно выберите **Создать ресурс** > **Интернет и мобильные устройства** > **Веб-приложение для контейнеров**. 

    ![Создание веб-приложения][7]

2. Выберите свою подписку. ASE и приложение создаются в одной подписке.

3. Выберите или создайте группу ресурсов. С помощью групп ресурсов можно управлять связанными ресурсами Azure как единым целым. Группы ресурсов также полезны при установке правил управления доступом на основе ролей для приложений. Дополнительные сведения см. в [обзоре Azure Resource Manager][ARMOverview].

4. Выберите план службы приложений и щелкните **Создать**. Веб-приложения Linux и Windows не могут находиться в одном плане службы приложений, но могут находиться в одной среде службы приложений. 

    ![Новый план службы приложений][8]

5. В раскрывающемся списке **Расположение** выберите регион, где нужно создать ASE. При выборе имеющейся среды ASE новая не создается. План службы приложений создается в выбранной среде ASE. 

    > [!NOTE]
    > Поддержка Linux в ASE пока доступна только в 6 регионах: **западная часть США, восточная часть США, Западная Европа, Северная Европа, Восточная Австралия, Юго-Восточная Азия.** Так как функция Linux в ASE находится в предварительной версии, ни в коем случае НЕ ВЫБИРАЙТЕ ASE, созданную до выхода этой предварительной версии.
    >

6. Выберите **Ценовая категория** и одну из ценовых категорий (номер SKU) уровня **Isolated**. Выбор расположения и номера SKU уровня **Isolated**, недоступного в имеющейся среде ASE, создается еще одна среда в этом расположении. Чтобы запустить процесс создания ASE, нажмите кнопку **Выбрать**. Номер SKU уровня **Isolated** доступен только в среде ASE. Это также означает, что в среде ASE можно использовать только номер SKU уровня **Isolated**. 

    * На время действия предварительной версии для поддержки Linux в ASE будет действовать скидка 50 % на изолированный номер SKU (эта скидка не распространяется на фиксированную стоимость самой ASE).

    ![Выбор ценовой категории][3]

7. Введите имя среды ASE. Это имя используется в имени для обращения к приложению. Если для ASE указано имя _appsvcenvdemo_, то доменным именем будет *.appsvcenvdemo.p.azurewebsites.net*. Если затем создать веб-приложение с именем *mytestapp*, то к нему можно будет обращаться по адресу mytestapp.appsvcenvdemo.p.azurewebsites.net. В имени нельзя использовать пробелы. Если вы используете символы верхнего регистра, в доменном имени будут использоваться такие же символы нижнего регистра.

    ![Имя нового плана службы приложений][4]

8. Укажите сведения о виртуальной сети Azure. Выберите **Создать** или **Выбрать существующую**. Параметр для выбора имеющейся виртуальной сети доступен только при наличии виртуальной сети в выбранном регионе. Выбрав **Создать**, введите имя виртуальной сети. При этом будет создана виртуальная сеть диспетчера ресурсов с таким именем. Она использует адресное пространство `192.168.250.0/23` в выбранном регионе. Если вы выбрали параметр **Выбрать существующую**, вам потребуется:

    a. Выбрать блок адресов виртуальной сети (при наличии нескольких).

    Б. Введите новое имя подсети.

    c. Выбрать размер подсети. *Выберите размер, достаточный для дальнейшего роста среды ASE.* Рекомендуемый размер — `/25`. Такая подсеть содержит 128 адресов и может обслуживать среду службы приложений максимального размера. Мы не советуем задавать, например, размер `/28`, так как доступно только 16 адресов. В инфраструктуре используется не менее семи адресов, а в категории служб "Сеть Azure" — другие 5. В подсети `/28` у вас остается возможность масштабировать 4 экземпляра плана службы приложений для внешней среды ASE и только 3 экземпляра плана для ILB ASE.

    d. Выбрать диапазон IP-адресов подсети.

9.  Выберите "Настроить контейнер".
    * Введите имя пользовательского образа (можно использовать реестр контейнеров Azure, Docker Hub или частный реестр). Если вы не намерены использовать собственный пользовательский контейнер, можно просто передать свой код и использовать встроенный образ в службе приложений на Linux, выполнив приведенные выше инструкции. 

    ![Настройка контейнера][9]

10. Выберите **Создать**, чтобы создать ASE. При этом также создается план службы приложений и приложение. Среда ASE, план службы приложений и приложение создаются в рамках одной подписки и в той же группе ресурсов. Если среде нужна отдельная группа ресурсов или если нужно создать среду ASE с внутренней подсистемой балансировки нагрузки, тогда воспользуйтесь инструкциями по созданию автономной среды ASE.


## <a name="create-an-ase-by-itself"></a>Автономное создание среды ASE ##

Автономная среда ASE создается пустой. В этом случае взимается ежемесячная плата за пустую инфраструктуру. Выполните следующие действия, чтобы создать ASE с внутренним балансировщиком нагрузки или ASE в собственной группе ресурсов. После создания ASE можно создать приложения по стандартной процедуре. Выберите новую среду ASE в качестве расположения.

1. В Azure Marketplace найдите **среду службы приложений** или последовательно выберите **Создать ресурс** > **Интернет и мобильные устройства** > **Среда службы приложений**. 

2. Введите имя ASE. Оно используется для приложений, созданных в среде ASE. Если указано имя *mynewdemoase*, то именем поддомена будет *.mynewdemoase.p.azurewebsites.net*. Если затем создать веб-приложение с именем *mytestapp*, то к нему можно будет обращаться по адресу mytestapp.mynewdemoase.p.azurewebsites.net. В имени нельзя использовать пробелы. Если вы используете символы верхнего регистра, в доменном имени будут использоваться такие же символы нижнего регистра. Если используется внутренний балансировщик нагрузки, то имя среды ASE не используется в поддомене, а указывается явно во время создания среды ASE.

    ![Именование ASE][5]

3. Выберите свою подписку. Эту подписка также используют все приложения в ASE. Невозможно поместить ASE в виртуальную сеть, находящуюся в другой подписке.

4. Выберите или укажите новую группу ресурсов. Для среды ASE нужно использовать ту же группу ресурсов, что и для виртуальной сети. Если выбрать существующую виртуальную сеть, то это соответствующим образом изменит выбор группы ресурсов для среды ASE. *При использовании шаблона Resource Manager можно создать ASE с группой ресурсов, которая отличается от группы ресурсов виртуальной сети.* Сведения о создании среды ASE из шаблона см. в статье [Создание среды службы приложений с внутренней подсистемой балансировки нагрузки с помощью шаблонов Azure Resource Manager][MakeASEfromTemplate].

    ![Выбор группы ресурсов][6]

5. Выберите виртуальную сеть и расположение. Вы можете создать виртуальную сеть или выбрать имеющуюся: 

    * В случае выбора создания виртуальной сети можно указать ее имя и расположение. Если вы намерены разместить в этой ASE приложения Linux, выберите один из 6 поддерживаемых сейчас регионов: **западная часть США, восточная часть США, Западная Европа, Северная Европа, Восточная Австралия, Юго-Восточная Азия.** 
    
    * Новая виртуальная сеть имеет диапазон адресов 192.168.250.0/23 и подсеть с именем default, определенная как 192.168.250.0/24. Вы можете выбрать только виртуальную сеть диспетчера ресурсов. Параметр **Тип VIP** определяет, возможен ли доступ к среде ASE непосредственно из Интернета (внешний) или через внутреннюю подсистему балансировки нагрузки. Дополнительные сведения об этих параметрах см. в статье [Создание и использование внутренней подсистемы балансировки нагрузки со средой службы приложений][MakeILBASE]. 

      * Если для параметра **Тип VIP** выбрать значение **Внешний**, то можно будет выбрать количество внешних IP-адресов, с которыми создается система предназначенных для подключений SSL на основе IP-адреса. 
    
      * Если для параметра **VIP Type** выбрать значение **внутренний**, необходимо указать домен, который использует среда ASE. ASE можно развернуть в виртуальную сеть, использующую диапазоны общедоступных или частных адресов. Чтобы использовать виртуальную сеть с диапазоном общедоступных адресов, необходимо создать виртуальную сеть заранее. 
    
    * Если выбрать имеющуюся виртуальную сеть, при создании ASE создается подсеть. *На портале невозможно использовать предварительно созданную подсеть. Создать среду ASE с имеющейся подсетью можно с помощью шаблона Resource Manager.* Сведения о создании среды ASE из шаблона см. в статье [Создание среды службы приложений с внутренней подсистемой балансировки нагрузки с помощью шаблонов Azure Resource Manager][MakeASEfromTemplate].

## <a name="app-service-environment-v1"></a>Среда службы приложений версии 1 ##

Вы можете создавать экземпляры среды службы приложений первой версии (ASEv1). Чтобы приступить к процессу, в Marketplace найдите **среду службы приложений версии 1**. Создайте среду ASE так же, как и отдельную среду ASE. После создания ASEv1 вы получите два интерфейса и две рабочих роли. При использовании среды ASEv1 вам потребуется управлять этими интерфейсами и рабочими ролями. Они не добавляются автоматически при создании планов служб приложений. Внешний интерфейс выступает в качестве конечных точек HTTP или HTTPS и отправляет трафик в рабочие роли. Это роли, в которых размещены ваши приложения. После создания ASE можно настроить количество интерфейсов и рабочих ролей. 

Сведения об ASEv1 см. в статье [Введение в среду службы приложения][ASEv1Intro]. Дополнительные сведения о масштабировании и мониторинге среды ASEv1, а также об управлении ею см. в статье [Настройка среды службы приложений][ConfigureASEv1].

<!--Image references-->
[1]: ./media/how_to_create_an_external_app_service_environment/createexternalase-create.png
[2]: ./media/how_to_create_an_external_app_service_environment/createexternalase-aspcreate.png
[3]: ./media/how_to_create_an_external_app_service_environment/createexternalase-pricing.png
[4]: ./media/how_to_create_an_external_app_service_environment/createexternalase-embeddedcreate.png
[5]: ./media/how_to_create_an_external_app_service_environment/createexternalase-standalonecreate.png
[6]: ./media/how_to_create_an_external_app_service_environment/createexternalase-network.png
[7]: ./media/how_to_create_an_external_app_service_environment/createexternalase-createwafc.png
[8]: ./media/how_to_create_an_external_app_service_environment/createexternalase-aspcreatewafc.png
[8]: ./media/how_to_create_an_external_app_service_environment/createexternalase-configurecontainer.png



<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/virtual-networks-nsg.md
[ConfigureASEv1]: app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: app-service-app-service-environment-intro.md
[webapps]: ../app-service-web-overview.md
[mobileapps]: ../../app-service-mobile/app-service-mobile-value-prop.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: http://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/resource-group-overview.md
