---
title: Общие сведения о локальном кэше службы приложений Azure | Microsoft Docs
description: В этой статье описывается, как включить функцию локального кэша службы приложений Azure, а также как изменить его размер и запросить его состояние.
services: app-service
documentationcenter: app-service
author: SyntaxC4
manager: yochayk
editor: ''
tags: optional
keywords: ''

ms.service: app-service
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/04/2016
ms.author: cfowler

---
# Общие сведения о локальном кэше службы приложений Azure
Содержимое веб-приложения Azure хранится в службе хранилища Azure; оно доступно в долгосрочном режиме в общей папке содержимого. Эта схема рассчитана на работу с различными приложениями и имеет следующие атрибуты:

* Содержимое разделяется между несколькими экземплярами виртуальных машин в веб-приложении.
* Содержимое хранится в долгосрочном режиме и может быть изменено путем запуска веб-приложений.
* Файлы журналов и диагностических данных доступны в той же общей папке содержимого.
* При публикации нового содержимого происходит явное обновление содержимого общей папки. То же содержимое можно моментально просмотреть с помощью веб-сайта диспетчера служб, запустив веб-приложение (обычно некоторые технологии, такие как ASP.NET, перезапускают веб-приложение при каких-либо изменениях файлов, чтобы получить обновленное содержимое).

Многие веб-приложения используют все перечисленные возможности или одну из них, но некоторым веб-приложениям требуется лишь высокопроизводительное хранилище с содержимым только для чтения, из которого они могут запускаться с высоким уровнем доступности. Эти приложения могут использовать экземпляр виртуальной машины определенного локального кэша.

Функция локального кэша службы приложений Azure позволяет получить представление содержимого от лица веб-роли. Это содержимое представляет собой кэш содержимого хранилища с записью и отменой, который асинхронно создается во время запуска сайта. Когда кэш готов, сайт переключается на работу с кэшированным содержимым. Веб-приложения, работающие в локальном кэше, отличаются следующими преимуществами:

* На них не влияют задержки, возникающие во время доступа к содержимому службы хранилища Azure.
* На них не влияют запланированные обновления или незапланированные простои серверов, на которых размещена общая папка содержимого, а также любые другие перебои в работе службы хранилища Azure.
* Эти приложения реже перезапускаются после изменений, выполненных в общей папке хранилища.

## Как локальный кэш изменяет поведение службы приложений
* Локальный кэш — это копия папок /site и /siteextensions веб-приложения. Он создается на локальном экземпляре виртуальной машины во время запуска веб-приложения. Размер локального кэша каждого веб-приложения по умолчанию ограничен 300 МБ, но может быть увеличен до 1 ГБ.
* Локальный кэш доступен для чтения и записи. Но при перемещении виртуальных машин или перезапуске веб-приложения все изменения в кэше отменяются. Не следует использовать локальный кэш для приложений, которые хранят критически важные данные в хранилище содержимого.
* Веб-приложения могут продолжать записывать файлы журналов и диагностические данные, как они делают это в настоящее время. Однако файлы и данные журналов хранятся локально на виртуальной машине. Затем они периодически копируются в общее хранилище содержимого. Наилучшим вариантом является копирование в общее хранилище содержимого. Результаты обратной записи могут быть потеряны из-за внезапного сбоя экземпляра виртуальной машины.
* В структуре папок для файлов журналов и данных для веб-приложений, использующих локальный кэш, есть некоторые изменения. Теперь в папках хранилища LogFiles и Data есть вложенные папки, в которых используется следующий шаблон именования: "уникальный идентификатор + метка времени". Каждая вложенная папка соответствует экземпляру виртуальной машины, на котором запущено веб-приложение.  
* Во время публикации изменений в веб-приложении с помощью любого механизма эти же изменения публикуются в общем хранилище содержимого. Это поведение предусмотрено системой, так как публикуемое содержимое должно храниться долго. Чтобы обновить локальный кэш веб-приложения, его необходимо перезапустить. Этот шаг кажется вам избыточным? Чтобы организовать эффективный жизненный цикл, см. инструкции далее в этой статье.
* В папке D:\\Home будет размещаться локальный кэш. В папке D:\\local будет по-прежнему размещаться временное хранилище конкретной виртуальной машины.
* На веб-сайте диспетчера управления службами в качестве представления содержимого по умолчанию по-прежнему будет отображаться общая папка хранилища.

## Включение локального кэша в службе приложений
Локальный кэш настраивается с помощью нескольких зарезервированных параметров приложения. Эти параметры приложения можно настроить следующими способами.

* [Портал Azure](#Configure-Local-Cache-Portal)
* [Диспетчер ресурсов Azure](#Configure-Local-Cache-ARM)

### Настройка локального кэша на портале Azure
<a name="Configure-Local-Cache-Portal"></a>

Включите локальный кэш для каждого веб-приложения с помощью этого параметра приложения: `WEBSITE_LOCAL_CACHE_OPTION` = `Always`

![Параметры приложения на портале Azure: локальный кэш](media/app-service-local-cache/app-service-local-cache-configure-portal.png)

### Настройка локального кэша с помощью Azure Resource Manager
<a name="Configure-Local-Cache-ARM"></a>

```
...

{
    "apiVersion": "2015-08-01",
    "type": "config",
    "name": "appsettings",
    "dependsOn": [
        "[resourceId('Microsoft.Web/sites/', variables('siteName'))]"
    ],
    "properties": {
        "WEBSITE_LOCAL_CACHE_OPTION": "Always",
        "WEBSITE_LOCAL_CACHE_SIZEINMB": "300"
    }
}

...
```

## Изменение размера локального кэша
По умолчанию размер локального кэша равен **300 МБ**. Он включает папки /site и /siteextensions, которые копируются из хранилища содержимого, а также любые другие локально созданные журналы и папки данных. Чтобы увеличить это ограничение, используйте параметр приложения `WEBSITE_LOCAL_CACHE_SIZEINMB`. Размер кэша для каждого веб-приложения можно увеличить до **1 ГБ** (1000 МБ).

## Рекомендации по использованию локального кэша службы приложений
Мы рекомендуем использовать локальный кэш в сочетании с функцией [промежуточных сред](../app-service-web/web-sites-staged-publishing.md).

* Добавьте *прикрепленный* параметр приложения `WEBSITE_LOCAL_CACHE_OPTION` со значением `Always` в **рабочий** слот. Если вы используете параметр `WEBSITE_LOCAL_CACHE_SIZEINMB`, также добавьте его в рабочий слот в качестве прикрепленного параметра.
* Создайте **промежуточный** слот и выполните в нем публикацию. Если вы используете локальный кэш для рабочего слота, настройте промежуточный слот так, чтобы он не использовал локальный кэш. Таким образом упрощается жизненный цикл построения, развертывания и тестирования для промежуточного слота.
* Протестируйте свой веб-сайт относительно промежуточной области.  
* По завершении выполните [операцию переключения](../app-service-web/web-sites-staged-publishing.md#to-swap-deployment-slots) между промежуточным и рабочим слотами.  
* Прикрепленные параметры имеют имена и привязаны к слоту. Поэтому при переключении между промежуточным и рабочим слотами промежуточный слот наследует параметры локального кэша приложения. Через несколько минут новый рабочий слот будет запущен с локальным кэшем и будет разогрет после переключения. После завершения переключения слотов рабочий слот будет работать с локальным кэшем.

## Часто задаваемые вопросы
### Как узнать, можно ли использовать локальный кэш с моим веб-приложением?
Да, если веб-приложению требуется высокопроизводительное надежное хранилище содержимого, а также если это веб-приложение не сохраняет в хранилище важные данные во время работы, а его общий размер не превышает 1 ГБ. Чтобы узнать общий размер папок /site и /siteextensions, используйте расширение сайта "Использование диска веб-приложениями Azure".

### Как узнать, переключился ли мой веб-сайт на использование локального кэша?
При использовании функции локального кэша с функцией промежуточных сред операция переключения не завершится, пока не разогреется локальный кэш. Чтобы определить, работает ли веб-сайт с локальным кэшем, можно проверить переменную среды `WEBSITE_LOCALCACHE_READY` для рабочего процесса. Следуйте инструкциям на странице [переменных среды рабочего процесса](https://github.com/projectkudu/kudu/wiki/Process-Threads-list-and-minidump-gcdump-diagsession#process-environment-variable), чтобы получить доступ к переменной среды рабочего процесса для нескольких экземпляров.

### Новые изменения только что опубликованы, но они еще не отразились в моем веб-приложении. Почему?
Если веб-приложение использует локальный кэш, перезапустите сайт, чтобы применить последние изменения. Не хотите публиковать изменения на рабочем сайте? См. информацию о вариантах слотов в предыдущем разделе рекомендаций.

### Где находятся мои журналы?
Если вы используете локальный кэш, журналы и папки данных выглядят немного иначе. Однако структура вложенных папок остается прежней, за исключением того, что они размещаются во вложенной папке с именем в формате "уникальный идентификатор виртуальной машины + метка времени".

### Локальный кэш включен, но мое веб-приложение все равно перезапускается. Почему? Я подумал, что локальный кэш поможет снизить частоту перезапуска приложения.
Локальный кэш помогает предотвратить перезапуск веб-приложений, которые используют хранилище. Но ваше веб-приложение все равно может быть перезапущено во время планируемых обновлений инфраструктуры виртуальной машины. В целом при использовании локального кэша приложение перезапускается реже.

<!---HONumber=AcomDC_0330_2016-->