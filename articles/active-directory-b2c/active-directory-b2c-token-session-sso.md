---
title: Настройка маркера, сеанса и единого входа в Azure AD B2C | Документация Майкрософт
description: Конфигурация маркера, сеанса и единого входа в Azure Active Directory B2C
services: active-directory-b2c
documentationcenter: ''
author: davidmu1
manager: mtillman
editor: ''
ms.service: active-directory-b2c
ms.workload: identity
ms.topic: article
ms.date: 08/16/2017
ms.author: davidmu
ms.openlocfilehash: 925313b6f2a00826f2ec8086457315c60f70b007
ms.sourcegitcommit: 6fcd9e220b9cd4cb2d4365de0299bf48fbb18c17
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2018
---
# <a name="azure-active-directory-b2c-token-session-and-single-sign-on-configuration"></a>Azure Active Directory B2C: конфигурация маркера, сеанса и единого входа

Эта возможность обеспечивает более точный контроль указанных далее параметров, осуществляемый [для каждой политики](active-directory-b2c-reference-policies.md).

1. Время существования маркеров безопасности, выдаваемых Azure Active Directory (Azure AD) B2C.
2. Время существования сеансов веб-приложения, управляемых Azure AD B2C.
3. Форматы важных утверждений в маркерах безопасности, создаваемых Azure AD B2C.
4. Поведение единого входа (SSO) в нескольких приложениях и политиках в клиенте B2C.

Для встроенных политик можно использовать эту функцию в каталоге Azure AD B2C следующим образом:

1. Чтобы [перейти в меню функций B2C](active-directory-b2c-app-registration.md#navigate-to-b2c-settings) на портале Azure, сделайте следующее.
2. Щелкните **Sign-up or sign-in policies**(Политики регистрации или входа в систему). *Примечание. Эту функцию можно использовать с любым типом политики, а не только с **политиками входа или регистрации***.
3. Откройте политику, щелкнув ее. Например, щелкните **B2C_1_SiUpIn**.
4. Щелкните **Изменить** в верхней части меню.
5. Щелкните **Конфигурация маркера, сеанса и единого входа**.
6. Внесите нужные изменения. Сведения о доступных свойствах см. в последующих разделах.
7. Последовательно выберите **ОК**.
8. Нажмите кнопку **Сохранить** в верхней части меню.

## <a name="token-lifetimes-configuration"></a>Конфигурация времени существования маркеров

Azure AD B2C поддерживает [протокол авторизации OAuth 2.0](active-directory-b2c-reference-protocols.md) для включения безопасного доступа к защищенным ресурсам. Для реализации этой поддержки Azure AD B2C выдает различные [маркеры безопасности](active-directory-b2c-reference-tokens.md). Ниже приведены свойства, которые можно использовать для управления временем существования маркеров безопасности, выдаваемых Azure AD B2C.

* **Время существования маркера доступа и маркера идентификатора (в минутах)**: время существования маркера носителя OAuth 2.0, используемого для получения доступа к защищенному ресурсу.
  * Значение по умолчанию — 60 минут.
  * Минимум (включительно) — 5 минут.
  * Максимум (включительно) — 1440 минут.
* **Время существования маркера обновления (в днях)**. Максимальный период времени, до наступления которого маркер обновления может использоваться для получения нового маркера доступа или маркера идентификатора (и при необходимости для получения нового маркера обновления, если приложению была предоставлена область `offline_access`).
  * Значение по умолчанию — 14 дней.
  * Минимум (включительно) — 1 день.
  * Максимум (включительно) — 90 дней.
* **Скользящее время существования маркера обновления (в днях)**. По истечении этого периода времени пользователь должен будет повторно пройти проверку подлинности независимо от срока действия самого последнего маркера обновления, полученного приложением. Он предоставляется, только если установлен переключатель **Ограничено**. Значение должно быть больше или равно значению **времени существования маркера обновления (в днях)**. Если установлен переключатель **Не ограничено**, указать конкретное значение нельзя.
  * Значение по умолчанию — 90 дней.
  * Минимум (включительно) — 1 день.
  * Максимум (включительно) — 365 дней.

Ниже приведено несколько вариантов использования, которые можно реализовать с помощью этих свойств.

* Предоставление пользователю возможности находиться в мобильном приложении сколь угодно долго до тех пор, пока он активно его использует. Для этого в политике входа нужно установить переключатель **Скользящее время существования маркера обновления (в днях)** в положение **Не ограничено**.
* Обеспечение соответствия нормам и требованиям безопасности путем задания соответствующих значений времени существования маркера доступа.

    > [!NOTE]
    > Эти параметры недоступны для политик сброса пароля.
    > 
    > 

## <a name="token-compatibility-settings"></a>Параметры маркеров совместимости

Мы внесли изменения, касающиеся форматирования, в важные утверждения в маркерах безопасности, создаваемых Azure AD B2C. Это было сделано для того, чтобы улучшить поддержку стандартного протокола, а также расширить возможности взаимодействия со сторонними библиотеками удостоверений. Чтобы не нарушать работу существующих приложений, мы создали следующие свойства, чтобы позволить клиентам подключаться по необходимости.

* **Утверждение издателя (iss)** — определяет клиент Azure AD B2C, выдавший маркер.
  * `https://login.microsoftonline.com/{B2C tenant GUID}/v2.0/` — это значение по умолчанию.
  * `https://login.microsoftonline.com/tfp/{B2C tenant GUID}/{Policy ID}/v2.0/` — это значение включает идентификаторы для клиента B2C и политики, используемых в запросе маркера. Если приложению или библиотеке требуется Azure AD B2C для соответствия [спецификации OpenID Connect Discovery 1.0](http://openid.net/specs/openid-connect-discovery-1_0.html), используйте это значение.
* **Утверждение субъекта (sub)** — определяет сущность, т. е. пользователя, для которого маркер подтверждает информацию.
  * **ObjectID** — это значение по умолчанию. Добавляет идентификатор объекта пользователя из каталога в утверждение `sub` в маркере.
  * **Не поддерживается** — указывается только для обратной совместимости. Мы рекомендуем переключиться на свойство **ObjectID**, как только это станет возможно.
* **Идентификатор политики, представляющей утверждения** — определяет тип утверждения, в котором заполняется идентификатор политики, используемый в запросе маркера.
  * **tfp** — это значение по умолчанию.
  * **acr** — указывается только для обратной совместимости. Мы рекомендуем переключиться на свойство `tfp`, как только это станет возможно.

## <a name="session-behavior"></a>Режим работы сеанса

Azure AD B2C поддерживает [протокол проверки подлинности OpenID Connect](active-directory-b2c-reference-oidc.md) для включения безопасного входа в веб-приложения. Ниже приведены свойства, которые можно использовать для управления сеансами веб-приложения.

* **Время существования сеанса веб-приложения (в минутах)**. Время существования файла cookie сеанса Azure AD B2C, сохраненного в браузере пользователя после успешной проверки подлинности.
  * Значение по умолчанию — 1440 минут.
  * Минимум (включительно) — 15 минут.
  * Максимум (включительно) — 1440 минут.
* **Время ожидания сеанса веб-приложения**. Если этот переключатель установлен в положение **Абсолютное**, пользователь вынужден повторно пройти проверку подлинности по истечении периода времени, заданного параметром **Время существования сеанса веб-приложения (в минутах)**. Если этот переключатель установлен в положение **Скользящее** (по умолчанию), пользователь может находиться в веб-приложении сколь угодно долго до тех пор, пока он активно его использует.

Ниже приведено несколько вариантов использования, которые можно реализовать с помощью этих свойств.

* Обеспечение соответствия нормам и требованиям безопасности путем задания соответствующих значений времени существования сеанса веб-приложения.
* Применение принудительной повторной проверки подлинности по истечении заданного периода во время взаимодействия пользователя с высокозащищенной частью веб-приложения. 

    > [!NOTE]
    > Эти параметры недоступны для политик сброса пароля.
    > 
    > 

## <a name="single-sign-on-sso-configuration"></a>Конфигурация единого входа (SSO)
Если в клиенте B2C существует несколько приложений и политик, для управления взаимодействиями пользователей с ними можно использовать свойство **Конфигурация единого входа** . Этому свойству можно задать одно из указанных далее значений.

* **Клиент**. Это значение по умолчанию. Если выбрано это значение, несколько приложений и политик в клиенте B2C могут совместно использовать один и тот же сеанс пользователя. Например, когда пользователь входит в приложение Contoso Shopping, он (или она) также может легко войти в другое приложение — Contoso Pharmacy — непосредственно во время доступа к нему.
* **Приложение**. Это значение позволяет поддерживать сеанс пользователя исключительно для одного приложения и независимо от других приложений. Например, если требуется, чтобы пользователь выполнял вход в приложение Contoso Pharmacy (с теми же учетными данными), даже если он (или она) уже выполнил вход в Contoso Shopping, другое приложение на том же клиенте B2C. 
* **Политика**. Это значение позволяет поддерживать сеанс пользователя исключительно для политики и независимо от приложений, ее использующих. Например, если пользователь уже выполнил вход и прошел этап многофакторной проверки подлинности (MFA), он может получить доступ к более защищенным частям нескольких приложений, который будет действовать, пока не истечет срок действия сеанса, связанного с политикой.
* **Отключено**. Если задано это значение, пользователь должен осуществлять все действия по входу при каждом выполнении политики. Например, несколько пользователей могут зарегистрироваться в приложении (в сценарии с использованием общего рабочего стола), даже если все это время с приложением работает один пользователь.

    > [!NOTE]
    > Эти параметры недоступны для политик сброса пароля.
    > 
    > 

