---
title: Использование фильтрации по возрасту в Azure AD B2C | Документация Майкрософт
description: Сведения о том, как определять несовершеннолетних пользователей вашего приложения.
services: active-directory-b2c
documentationcenter: ''
author: davidmu1
manager: mtillman
editor: ''
ms.service: active-directory-b2c
ms.workload: identity
ms.topic: article
ms.date: 04/29/2018
ms.author: davidmu
ms.openlocfilehash: 9186579126525cc269f7e3f9e778e06902b30eb4
ms.sourcegitcommit: 96089449d17548263691d40e4f1e8f9557561197
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/17/2018
ms.locfileid: "34261288"
---
#<a name="using-age-gating-in-azure-ad-b2c"></a>Использование фильтрации по возрасту в Azure AD B2C

>[!IMPORTANT]
>Эта функция находится в режиме закрытой предварительной версии.  Просматривайте информацию в нашем [служебном блоге](https://blogs.msdn.microsoft.com/azureadb2c/) по мере ее доступности или обратитесь по адресу AADB2CFeedback@microsoft.com.  НЕ используйте эту функцию в рабочих каталогах. Использование новых функций такого рода может привести к потере данных и непредвиденным изменениям функциональности, пока мы не переведем их в общедоступный режим.  
>

##<a name="age-gating"></a>Фильтрация по возрасту
Фильтрация по возрасту позволяет с помощью Azure AD B2C определить несовершеннолетних пользователей приложения.  Вы можете заблокировать пользователю вход в приложение или позволить ему вернуться в приложение с дополнительными утверждениями, которые определяют возрастную группу пользователя и состояние родительского согласия для него.  

>[!NOTE]
>Родительское согласие отслеживается как атрибут пользователя с именем `consentProvidedForMinor`.  Это свойство можно обновлять с помощью API Graph. Это поле также будет использоваться при обновлении `legalAgeGroupClassification`.
>

##<a name="setting-up-your-directory-for-age-gating"></a>Настройка каталога для фильтрации по возрасту
Чтобы использовать фильтрацию по возрасту в потоке пользователей, необходимо настроить дополнительные свойства каталога. Эту операцию можно выполнить с помощью функции `Properties` в меню (которая будет доступна, только если у вас есть доступ к закрытой предварительной версии).  
1. В расширении Azure AD B2C щелкните **Свойства** для своего клиента в меню слева.
2. В разделе **Age gating** (Фильтрация по возрасту) нажмите кнопку **Настроить**.
3. Дождитесь завершения операции, и каталог будет настроен для фильтрации по возрасту.

##<a name="enabling-age-gating-in-your-user-flow"></a>Включение фильтрации по возрасту в потоке пользователей
Когда в каталоге будет настроена фильтрации по возрасту, вы сможете в дальнейшем использовать эту функцию в потоках пользователей предварительной версии.  Для этой функции требуются изменения, которые делают ее несовместимой с существующими типами потоков пользователей.  Чтобы включить фильтрацию по возрасту, сделайте следующее:
1. Создайте поток пользователей предварительной версии.
2. После его создания выберите **Свойства** в меню.
3. В разделе **Age gating** (Фильтрация по возрасту) щелкните переключатель, чтобы включить эту функцию.
4. Затем можно выбрать, как следует управлять пользователями, которые определяются как несовершеннолетние.

##<a name="what-does-enabling-age-gating-do"></a>Что дает включение фильтрации по возрасту?
Когда в потоке пользователей включена фильтрация по возрасту, взаимодействие с пользователем меняется.  При регистрации у пользователей теперь будет запрашиваться дата рождения и страна проживания наряду с атрибутами пользователя, настроенными для потока пользователей.  У пользователей, которые ранее не ввели дату рождения и страну проживания, эти сведения будут запрашиваться, когда они в следующий раз войдут в систему.  На основе этих двух значений Azure AD B2C определит, является ли пользователь несовершеннолетним, и обновит поле `ageGroup`. Значением может быть `null`, `Undefined`, `Minor`, `Adult` и `NotAdult`.  Поля `ageGroup` и `consentProvidedForMinor` затем используются для вычисления `legalAgeGroupClassification`. 

##<a name="age-gating-options"></a>Параметры фильтрации по возрасту
С помощью Azure AD B2C вы можете заблокировать доступ для несовершеннолетних пользователей без родительского согласия или разрешить им доступ и позволить приложению принимать решения о том, как взаимодействовать с ними.  

###<a name="allowing-minors-without-parental-consent"></a>Разрешение доступа несовершеннолетним пользователям без родительского согласия
Для пользовательских потоков, которые позволяют выполнять регистрацию и (или) вход, вы можете разрешить доступ к приложению несовершеннолетним пользователям без родительского согласия.  Несовершеннолетним пользователям без родительского согласия будет разрешено выполнять вход или регистрацию обычным образом и в Azure AD B2C будет выдаваться маркер идентификации с утверждением `legalAgeGroupClassification`.  Используя это утверждение, вы можете выбрать способ взаимодействия с такими пользователями, например получение родительского согласия (и обновления поля `consentProvidedForMinor`).

###<a name="blocking-minors-without-parental-consent"></a>Блокирование несовершеннолетних пользователей без родительского согласия
Для пользовательских потоков, которые позволяют выполнять регистрацию и (или) вход, вы можете заблокировать доступ к приложению для несовершеннолетних пользователей без родительского согласия.  В Azure AD B2C существует два варианта взаимодействия с заблокированными пользователями:
* Отправить JSON обратно в приложение. Этот параметр позволяет отправить ответ в приложение, которое заблокировало несовершеннолетнего пользователя.
* Показать страницу ошибки. Для пользователя отобразится страница с сообщением об отказе в доступе к приложению.

##<a name="known-issues"></a>Известные проблемы
###<a name="format-for-the-response-when-a-minor-is-blocked"></a>Формат ответа при блокировке несовершеннолетнего пользователя.
Сейчас ответ формируется неправильно. Эта ошибка будет устранена в ближайшем обновлении.

###<a name="deleting-specific-attributes-that-were-added-during-setup-can-make-your-directory-unable-to-use-age-gating"></a>Удаление конкретных атрибутов, которые были добавлены во время установки, может сделать невозможным использование фильтрации по возрасту в каталоге.
При настройке фильтрации по возрасту вы настроили каталог, используя параметр в разделе `Properties`.  Если удалить `legalCountry` или `dateOfBirth` через Graph, в каталоге больше нельзя будет использовать фильтрацию по возрасту, и эти свойства не удастся создать заново.

###<a name="list-of-countries-is-incomplete"></a>Список стран является неполным.
В настоящее время список стран для параметра legalCountry является неполным. Мы добавим остальные страны в ближайшем обновлении.