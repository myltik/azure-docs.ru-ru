---
title: 'Azure Active Directory B2C: пользовательские политики | Документация Майкрософт'
description: В этой статье описываются пользовательские политики Azure Active Directory B2C
services: active-directory-b2c
documentationcenter: ''
author: davidmu1
manager: mtillman
editor: ''
ms.service: active-directory-b2c
ms.workload: identity
ms.topic: article
ms.date: 04/04/2017
ms.author: davidmu
ms.openlocfilehash: 4c09fa5c454cee6ca9a0ed0d3fd4582b222c0c1a
ms.sourcegitcommit: 6fcd9e220b9cd4cb2d4365de0299bf48fbb18c17
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2018
---
# <a name="azure-active-directory-b2c-custom-policies"></a>Azure Active Directory B2C: пользовательские политики

[!INCLUDE [active-directory-b2c-advanced-audience-warning](../../includes/active-directory-b2c-advanced-audience-warning.md)]

## <a name="what-are-custom-policies"></a>Что такое пользовательские политики?

Пользовательские политики — это файлы конфигурации, которые определяют поведение вашего клиента Azure AD B2C. Для самых распространенных задач идентификации на портале Azure AD B2C заданы **встроенные политики**. Пользовательские политики, в свою очередь, могут быть полностью изменены разработчиком удостоверений для выполнения практически неограниченного количества задач. Чтобы определить, подходят ли пользовательские политики для вас и вашего сценария идентификации, продолжайте чтение.

## <a name="comparing-built-in-policies-and-custom-policies"></a>Сравнение встроенных политик и пользовательских политик

| | Встроенные политики | Пользовательские политики |
|-|-------------------|-----------------|
|Целевые пользователи | Все разработчики приложений с опытом работы с удостоверениями или без него | Профессионалы: системные интеграторы, консультанты и внутренние специалисты по работе с удостоверениями. Они знакомы с потоками OpenIDConnect, поставщиками удостоверений и проверкой подлинности на основе утверждений |
|Метод настройки | Портал Azure с удобным пользовательским интерфейсом | Изменение XML-файлов напрямую, а затем их отправка на портал Azure |
|Настройка пользовательского интерфейса | Полная настройка пользовательского интерфейса, включая поддержку HTML, CSS и JavaScript (требуется личный домен)<br><br>Поддержка нескольких языков для пользовательских строк | Аналогично |
| Настройка атрибутов | Стандартные и пользовательские атрибуты | Аналогично |
|Управление токенами и сеансами | Пользовательский токен и несколько параметров сеанса | Аналогично |
|Поставщики удостоверений| **Сегодня**: определенный локальный поставщик, поставщик социальных сетей<br><br>**В будущем**: OIDC, SAML, OAuth в соответствии со стандартами | **Сегодня**: OIDC, SAML, OAuth в соответствии со стандартами<br><br>**В будущем**: WsFed |
|Задачи удостоверений (примеры) | Регистрация или вход в систему локальных поставщиков и многих учетных записей социальных сетей<br><br>Самостоятельный сброс пароля<br><br>Изменение профиля<br><br>Сценарии многофакторной проверки подлинности<br><br>Настройка токенов и сеансов<br><br>Потоки токена доступа | Выполняют те же задачи, что и встроенные политики, с помощью пользовательских поставщиков удостоверений или настраиваемых областей<br><br>Подготовка пользователя в другой системе во время регистрации<br><br>Отправка приветственного сообщения почты с помощью поставщика услуг электронной почты<br><br>Использование пользовательского хранилища за пределами B2C<br><br>Проверка предоставленной пользователями информации с помощью доверенной системы через API |

## <a name="policy-files"></a>Файлы политики

Пользовательские политики представлены одним или несколькими XML-файлами, которые ссылаются друг на друга в иерархической цепочке. Элементы XML определяют: схему утверждений, преобразования утверждений, определения содержимого, поставщиков утверждений, технические профили и шаги оркестрации пути взаимодействия пользователя, а также другие элементы.

Мы советуем использовать три типа файлов политики:

- **Базовый файл**, который содержит большинство определений и для которого Azure предоставляет полный пример.  Мы советуем вносить минимальное число изменений в этот файл, чтобы упростить устранение неполадок и долгосрочное обслуживание ваших политик.
- **Файл расширения** — файл, содержащий уникальную конфигурацию вашего клиента.
- **Файл проверяющей стороны (RP)** — однозадачный файл, который может быть вызван непосредственно приложением или службой (т. е. проверяющей стороной).  Дополнительные сведения см. в статье об определениях файлов политики.  Каждой уникальной задаче требуется собственный файл проверяющей стороны и в зависимости от требований к фирменной символике их число может быть выражено как "общее количество приложений общее количество вариантов использования".


Встроенные политики в Azure AD B2C следуют описанному выше шаблону с 3 файлами, но разработчик видит только файл проверяющей стороны, в то время как портал в фоновом режиме вносит изменения в файл расширения.

## <a name="core-concepts-you-should-know-when-using-custom-policies"></a>Основные понятия, которые следует знать при использовании пользовательских политик

### <a name="azure-active-directory-b2c"></a>Azure Active Directory B2C

Служба управления удостоверениями и доступом клиентов Azure (CIAM). Служба включает в себя:

1. Пользовательский каталог в виде специализированного Azure Active Directory, который доступен через Microsoft Graph. В нем содержатся данные пользователя для локальных и федеративных учетных записей. 
2. Доступ к **инфраструктуре процедур идентификации**, которая управляет доверием между пользователями и сущностями и обменивается утверждениями между ними для выполнения задач управления удостоверениями и доступом 
3. Служба токенов безопасности (STS), выдающая токены удостоверений, токены обновления и токены доступа (и эквивалентные утверждения SAML) и проверяющая их для защиты ресурсов.

Azure AD B2C последовательно взаимодействует с поставщиками удостоверений, пользователями, другими системами и с локальным каталогом пользователей для выполнения задачи идентификации (например, вход в систему, регистрация нового пользователя, сброс пароля). Базовая платформа, устанавливающая доверие между несколькими участниками и выполняющая эти шаги, называется инфраструктурой процедур идентификации, а политика (которая также называется путем взаимодействия пользователя или инфраструктурой доверия) явно определяет субъекты, действия, протоколы и последовательность шагов для завершения.

### <a name="identity-experience-framework"></a>Инфраструктура процедур идентификации

Полностью настраиваемая управляемая политиками облачная платформа Azure, которая оркестрирует доверие между сущностями (в основном поставщиками утверждений) с использованием стандартных протоколов, таких как OpenIDConnect, OAuth, SAML, WSFed, и нескольких нестандартных (например, обмен утверждениями между системами на основе REST API). Эта инфраструктура обеспечивает удобные возможности с поддержкой HTML, CSS и JavaScript.  В настоящее время инфраструктура процедур идентификации доступна только в контексте службы Azure AD B2C. Приоритетом для нее являются задачи, связанные с CIAM.

### <a name="built-in-policies"></a>Встроенные политики

Предварительно определенные файлы конфигурации, определяющие реакцию на событие Azure AD B2C для выполнения наиболее распространенных задач идентификации (т. е. регистрации пользователей, операций входа, сброса пароля) и взаимодействия с доверенными сторонами, отношение которых также предварительно определено в Azure AD B2C (например, поставщик удостоверений Facebook, LinkedIn, учетная запись Майкрософт, учетные записи Google).  В будущем встроенные политики также смогут предоставить настройку поставщиков удостоверений, которые обычно находятся в корпоративной области, например Azure Active Directory Premium, Active Directory и AD FS, Salesforce ID Provider и т. д.


### <a name="custom-policies"></a>Пользовательские политики

Файлы конфигурации, которые определяют поведение инфраструктуры процедур идентификации в вашем клиенте Azure AD B2C. Пользовательская политика доступна в виде одного или нескольких XML-файлов (ознакомьтесь с определениями файлов политики), которые выполняются инфраструктурой процедур идентификации при вызове проверяющей стороной (например, приложением). Разработчик удостоверения может напрямую изменять пользовательские политики для выполнения практически неограниченного количества задач. Разработчики, которые настраивают пользовательские политики, должны тщательно и подробно определить доверительные связи, в частности добавить конечные точки метаданных, точные определения обмена утверждениями и настроить секретные данные, ключи и сертификаты, отличающиеся в зависимости от поставщика удостоверений.

## <a name="policy-file-definitions-for-identity-experience-framework-trustframeworks"></a>Определения файлов политики для платформ инфраструктуры процедур идентификации

### <a name="policy-files"></a>Файлы политики

Пользовательские политики представлены одним или несколькими XML-файлами, которые ссылаются друг на друга в иерархической цепочке. Элементы XML определяют: схему утверждений, преобразования утверждений, определения содержимого, поставщиков утверждений, технические профили и шаги оркестрации пути взаимодействия пользователя, а также другие элементы.  Мы советуем использовать три типа файлов политики:

- **Базовый файл**, который содержит большинство определений и для которого Azure предоставляет полный пример.  Мы советуем вносить минимальное число изменений в этот файл, чтобы упростить устранение неполадок и долгосрочное обслуживание ваших политик.
- **Файл расширения** — файл, содержащий уникальную конфигурацию вашего клиента.
- **Файл проверяющей стороны (RP)** — однозадачный файл, который может быть вызван непосредственно приложением или службой (т. е. проверяющей стороной).  Дополнительные сведения см. в статье об определениях файлов политики.  Каждой уникальной задаче требуется собственный файл проверяющей стороны и в зависимости от требований к фирменной символике их число может быть выражено как "общее количество приложений общее количество вариантов использования".

![Типы файлов политики](media/active-directory-b2c-overview-custom/active-directory-b2c-overview-custom-policy-files.png)

| Тип файла политики | Примеры имени файла | Рекомендации по использованию | Наследует от |
|---------------------|--------------------|-----------------|---------------|
| Базовая |TrustFrameworkBase.xml<br><br>Mytenant.onmicrosoft.com-B2C-1A_BASE1.xml | Включает схему основных утверждений, преобразования утверждений, поставщиков утверждений и пути взаимодействия пользователей, настроенные Майкрософт<br><br>Вносите минимальные изменения в этот файл | None |
| Расширение (EXT) | TrustFrameworkExtensions.xml<br><br>Mytenant.onmicrosoft.com-B2C-1A_EXT.xml | Объедините изменения в базовый файл<br><br>Измененные поставщики утверждений<br><br>Измененные пути взаимодействия пользователей<br><br>Пользовательские определения схем | Базовый файл |
| Проверяющая сторона (RP) | B2C_1A_sign_up_sign_in.xml| Измените параметры сеанса и фигуры токена здесь| Файл исключений (EXT-файл) |

### <a name="inheritance-model"></a>Модель наследования

Когда приложение вызывает файл политики проверяющей стороны, инфраструктура процедур идентификации в B2C добавит все элементы из базового файла, затем из файла расширений и, наконец, из файла политики проверяющей стороны, чтобы создать действующую политику.  Элементы одного и того же типа и имени в файле проверяющей стороны будут переопределять те, что находятся в файле расширений, а последние переопределят значения в базовом файле.

**Встроенные политики** в Azure AD B2C следуют описанному выше шаблону с 3 файлами, но разработчик видит только файл проверяющей стороны, в то время как портал в фоновом режиме вносит изменения в файл расширения.  Все экземпляры Azure AD B2C используют базовый файл политики, который находится под контролем команды Azure B2C и часто обновляется.

## <a name="next-steps"></a>Дополнительная информация

> [!div class="nextstepaction"]
> [Azure Active Directory B2C. Приступая к работе с настраиваемыми политиками](active-directory-b2c-get-started-custom.md)
