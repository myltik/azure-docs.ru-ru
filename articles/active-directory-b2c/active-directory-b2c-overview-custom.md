---
title: "Azure Active Directory B2C: пользовательские политики | Документация Майкрософт"
description: "В этой статье описываются пользовательские политики Azure Active Directory B2C"
services: active-directory-b2c
documentationcenter: 
author: parakhj
manager: krassk
editor: parakhj
ms.assetid: 1ff398a4-2079-4615-94f1-57de22c0aad6
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.topic: article
ms.devlang: na
ms.date: 04/04/2017
ms.author: parakhj
ms.translationtype: Human Translation
ms.sourcegitcommit: 7f8b63c22a3f5a6916264acd22a80649ac7cd12f
ms.openlocfilehash: ed82300211f54f39423c24039ca418fca9da94c3
ms.contentlocale: ru-ru
ms.lasthandoff: 05/01/2017


---
# <a name="azure-active-directory-b2c-custom-policies"></a>Azure Active Directory B2C: пользовательские политики

## <a name="what-are-custom-policies"></a>Что такое пользовательские политики?

Пользовательские политики — это файлы конфигурации, которые определяют поведение вашего клиента Azure AD B2C. Для самых распространенных задач идентификации на портале Azure AD B2C заданы **встроенные политики**. Пользовательские политики, в свою очередь, могут быть полностью изменены разработчиком удостоверений для выполнения практически неограниченного количества задач. Чтобы определить, подходят ли пользовательские политики для вас и вашего сценария идентификации, продолжайте чтение.

**Изменение пользовательских политик подходит не для всех.** Для этого требуется обучение, время запуска дольше и будущие изменения в пользовательских политиках потребуют аналогичных знаний. Прежде чем применять пользовательские политики для вашего сценария, следует рассмотреть возможность использования встроенных политик.

## <a name="comparing-built-in-policies-and-custom-policies"></a>Сравнение встроенных политик и пользовательских политик

| | Встроенные политики | Пользовательские политики |
|-|-------------------|-----------------|
|Целевые пользователи | Все разработчики приложений с опытом работы с удостоверениями или без него | Профессионалы: системные интеграторы, консультанты и внутренние специалисты по работе с удостоверениями. Они знакомы с потоками OpenIDConnect, поставщиками удостоверений и проверкой подлинности на основе утверждений |
|Метод настройки | Портал Azure с удобным пользовательским интерфейсом | Изменение XML-файлов напрямую, а затем их отправка на портал Azure |
|Настройка пользовательского интерфейса | Полная настройка пользовательского интерфейса, включая поддержку HTML, CSS и JScript (требуется личный домен)<br><br>Поддержка нескольких языков для пользовательских строк | Аналогично |
| Настройка атрибутов | Стандартные и пользовательские атрибуты | Аналогично |
|Управление токенами и сеансами | Пользовательский токен и несколько параметров сеанса | Аналогично |
|Поставщики удостоверений| **Сегодня**: определенный локальный поставщик, поставщик социальных сетей<br><br>**В будущем**: OIDC, SAML, OAuth в соответствии со стандартами | **Сегодня**: OIDC, SAML, OAuth в соответствии со стандартами<br><br>**В будущем**: WsFed |
|Задачи удостоверений (примеры) | Регистрация или вход в систему локальных поставщиков и многих учетных записей социальных сетей<br><br>Сброс паролей<br><br>Изменение профиля<br><br>Сценарии многофакторной проверки подлинности<br><br>Настройка токенов и сеансов<br><br>Потоки токена доступа | Выполняют те же задачи, что и встроенные политики, с помощью пользовательских поставщиков удостоверений или настраиваемых областей<br><br>Подготовка пользователя в другой системе во время регистрации<br><br>Отправка приветственного сообщения почты с помощью поставщика услуг электронной почты<br><br>Использование пользовательского хранилища за пределами B2C<br><br>Проверка предоставленной пользователями информации с помощью доверенной системы через API |

## <a name="policy-files"></a>Файлы политики

Пользовательские политики представлены одним или несколькими XML-файлами, которые ссылаются друг на друга в иерархической цепочке. Элементы XML определяют: схему утверждений, преобразования утверждений, определения содержимого, поставщиков утверждений, технические профили и шаги оркестрации пути взаимодействия пользователя, а также другие элементы.

Мы советуем использовать три типа файлов политики:

- **Базовый файл**, который содержит большинство определений и для которого Azure предоставляет полный пример.  Мы советуем вносить минимальное число изменений в этот файл, чтобы упростить устранение неполадок и долгосрочное обслуживание ваших политик.
- **Файл расширения** — файл, содержащий уникальную конфигурацию вашего клиента.
- **Файл проверяющей стороны (RP)** — однозадачный файл, который может быть вызван непосредственно приложением или службой (т. е. проверяющей стороной).  Дополнительные сведения см. в статье об определениях файлов политики.  Каждой уникальной задаче требуется собственный файл проверяющей стороны и в зависимости от требований к фирменной символике их число может быть выражено как "общее количество приложений общее количество вариантов использования".


Встроенные политики в Azure AD B2C следуют описанному выше шаблону с 3 файлами, но разработчик видит только файл проверяющей стороны, в то время как портал в фоновом режиме вносит изменения в файл расширения.

## <a name="core-concepts-you-should-know-when-using-custom-policies"></a>Основные понятия, которые следует знать при использовании пользовательских политик

### <a name="azure-active-directory-b2c"></a>Azure Active Directory B2C

Служба управления удостоверениями и доступом клиентов Azure (CIAM). Служба включает в себя:

1. Пользовательский каталог в виде специализированного Azure Active Directory, который доступен через Microsoft Graph. В нем содержатся данные пользователя для локальных и федеративных учетных записей. 
2. Доступ к **подсистеме идентификации**, которая оркестрирует доверие между пользователями и сущностями и обменивается утверждениями между ними для выполнения задач управления удостоверениями и доступом. 
3. Служба токенов безопасности (STS), выдающая токены удостоверений, токены обновления и токены доступа (и эквивалентные утверждения SAML) и проверяющая их для защиты ресурсов.

Azure AD B2C последовательно взаимодействует с поставщиками удостоверений, пользователями, другими системами и с локальным каталогом пользователей для выполнения задачи с удостоверением (например, вход в систему, регистрация нового пользователя, сброс пароля). Базовая платформа, устанавливающая доверие между несколькими участниками и выполняющая эти шаги, называется подсистемой идентификации, а политика (которая также называется путем взаимодействия пользователя или инфраструктурой доверия) явно определяет субъекты, действия, протоколы и последовательность шагов для завершения.

### <a name="identity-experience-engine"></a>Подсистема идентификации

Полностью настраиваемая управляемая политиками облачная платформа Azure, которая оркестрирует доверие между сущностями (в основном поставщиками утверждений) с использованием стандартных протоколов, таких как OpenIDConnect, OAuth, SAML, WSFed, и нескольких нестандартных (например, обмен утверждениями между системами на основе REST API). Эта подсистема обеспечивает удобные возможности с поддержкой HTML, CSS и JScript.  В настоящее время подсистема идентификации доступна только в контексте службы Azure AD B2C. Приоритетом для нее являются задачи, связанные с CIAM.

### <a name="built-in-policies"></a>Встроенные политики

Стандартные файлы конфигурации, которые определяют поведение Azure AD B2C при выполнении наиболее часто используемых задач с удостоверениями (т. е. регистрации пользователя, входе в учетную запись, сбросе паролей) и взаимодействуют с доверенными сторонами, чьи связи также определены в Azure AD B2C (например, поставщик удостоверений Facebook, LinkedIn, учетная запись Майкрософт, учетные записи Google).  В будущем встроенные политики также смогут предоставить настройку поставщиков удостоверений, которые обычно находятся в корпоративной области, например Azure Active Directory Premium, Active Directory и ADFS, Salesforce ID Provider и т. д.


### <a name="custom-policies"></a>Пользовательские политики

Файлы конфигурации, которые определяют поведение подсистемы идентификации в вашем клиенте Azure AD B2C. Пользовательская политика доступна как один или несколько XML-файлов (см. определения файлов политики), которые выполняются подсистемой идентификации при вызове проверяющей стороной (например, приложением). Разработчик удостоверения может напрямую изменять пользовательские политики для выполнения практически неограниченного количества задач. Разработчики, которые настраивают пользовательские политики, должны тщательно и подробно определить доверительные связи, в частности добавить конечные точки метаданных, точные определения обмена утверждениями и настроить секретные данные, ключи и сертификаты, отличающиеся в зависимости от поставщика удостоверений.

### <a name="policy-files"></a>Файлы политики

Пользовательские политики представлены одним или несколькими XML-файлами, которые ссылаются друг на друга в иерархической цепочке. Элементы XML определяют: схему утверждений, преобразования утверждений, определения содержимого, поставщиков утверждений, технические профили и шаги оркестрации пути взаимодействия пользователя, а также другие элементы. Мы советуем использовать три типа файлов политики:

- **Базовый файл**, который содержит большинство определений и для которого Azure предоставляет полный пример.  Мы советуем вносить минимальное число изменений в этот файл, чтобы упростить устранение неполадок и долгосрочное обслуживание ваших политик.
- **Файл расширения** — файл, содержащий уникальную конфигурацию вашего клиента.
- **Файл проверяющей стороны (RP)** — однозадачный файл, который может быть вызван непосредственно приложением или службой (т. е. проверяющей стороной).  Дополнительные сведения см. в статье об определениях файлов политики.  Каждой уникальной задаче требуется собственный файл проверяющей стороны и в зависимости от требований к фирменной символике их число может быть выражено как "общее количество приложений общее количество вариантов использования".

## <a name="policy-file-definitions-for-identity-experience-engine-trustframeworks"></a>Определения файлов политики для платформ подсистемы идентификации

### <a name="policy-files"></a>Файлы политики

Пользовательские политики представлены одним или несколькими XML-файлами, которые ссылаются друг на друга в иерархической цепочке. Элементы XML определяют: схему утверждений, преобразования утверждений, определения содержимого, поставщиков утверждений, технические профили и шаги оркестрации пути взаимодействия пользователя, а также другие элементы.  Мы советуем использовать три типа файлов политики:

- **Базовый файл**, который содержит большинство определений и для которого Azure предоставляет полный пример.  Мы советуем вносить минимальное число изменений в этот файл, чтобы упростить устранение неполадок и долгосрочное обслуживание ваших политик.
- **Файл расширения** — файл, содержащий уникальную конфигурацию вашего клиента.
- **Файл проверяющей стороны (RP)** — однозадачный файл, который может быть вызван непосредственно приложением или службой (т. е. проверяющей стороной).  Дополнительные сведения см. в статье об определениях файлов политики.  Каждой уникальной задаче требуется собственный файл проверяющей стороны и в зависимости от требований к фирменной символике их число может быть выражено как "общее количество приложений общее количество вариантов использования".

![Типы файлов политики](media/active-directory-b2c-overview-custom/active-directory-b2c-overview-custom-policy-files.png)

| Тип файла политики | Примеры имени файла | Рекомендации по использованию | Наследует от |
|---------------------|--------------------|-----------------|---------------|
| Базовая |TrustFrameworkBase.xml<br><br>Mytenant.onmicrosoft.com-B2C-1A_BASE1.xml | Включает схему основных утверждений, преобразования утверждений, поставщиков утверждений и пути взаимодействия пользователей, настроенные Майкрософт<br><br>Вносите минимальные изменения в этот файл | None |
| Расширение (EXT) | TrustFrameworkExtensions.xml<br><br>Mytenant.onmicrosoft.com-B2C-1A_EXT.xml | Объедините изменения в базовый файл<br><br>Измененные поставщики утверждений<br><br>Измененные пути взаимодействия пользователей<br><br>Пользовательские определения схем | Базовый файл |
| Проверяющая сторона (RP) | | | Файл расширения |

### <a name="inheritance-model"></a>Модель наследования

Когда приложение вызывает файл политики проверяющей стороны, подсистема идентификации в B2C добавит все элементы из базового файла, затем из файла расширений и, наконец, из файла политики проверяющей стороны, чтобы создать действующую политику.  Элементы одного и того же типа и имени в файле проверяющей стороны будут переопределять те, что находятся в файле расширений, а последние переопределят значения в базовом файле.

**Встроенные политики** в Azure AD B2C следуют описанному выше шаблону с 3 файлами, но разработчик видит только файл проверяющей стороны, в то время как портал в фоновом режиме вносит изменения в файл расширения.  Все экземпляры Azure AD B2C используют базовый файл политики, который находится под контролем команды Azure B2C и часто обновляется.

