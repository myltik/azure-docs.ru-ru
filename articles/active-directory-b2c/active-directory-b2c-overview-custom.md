---
title: Пользовательские политики Azure Active Directory B2C | Документация Майкрософт
description: Сведения о пользовательских политиках Azure Active Directory B2C.
services: active-directory-b2c
author: davidmu1
manager: mtillman
ms.service: active-directory
ms.workload: identity
ms.date: 04/04/2017
ms.author: davidmu
ms.component: B2C
ms.openlocfilehash: 0d507c2116aa9e420ddc0dec4999ea21d28e60fc
ms.sourcegitcommit: 6116082991b98c8ee7a3ab0927cf588c3972eeaa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/05/2018
ms.locfileid: "34709263"
---
# <a name="azure-active-directory-b2c-custom-policies"></a>Azure Active Directory B2C: пользовательские политики

[!INCLUDE [active-directory-b2c-advanced-audience-warning](../../includes/active-directory-b2c-advanced-audience-warning.md)]

## <a name="what-are-custom-policies"></a>Что такое пользовательские политики?

Пользовательские политики — это файлы конфигурации, которые определяют поведение вашего клиента Azure AD B2C. Для самых распространенных задач идентификации на портале Azure AD B2C заданы **встроенные политики**. Пользовательские политики, в свою очередь, могут быть полностью изменены разработчиком удостоверений для выполнения практически неограниченного количества задач. Чтобы определить, подходят ли пользовательские политики для вас и вашего сценария идентификации, продолжайте чтение.

## <a name="comparing-built-in-policies-and-custom-policies"></a>Сравнение встроенных политик и пользовательских политик

| | Встроенные политики | Пользовательские политики |
|-|-------------------|-----------------|
|Целевые пользователи | Все разработчики приложений с опытом работы с удостоверениями или без него | Специалисты по удостоверениям: системные интеграторы, консультанты и внутренние команды по работе с удостоверениями. Они знакомы с потоками OpenIDConnect, поставщиками удостоверений и проверкой подлинности на основе утверждений |
|Метод настройки | Портал Azure с удобным пользовательским интерфейсом | Изменение XML-файлов напрямую, а затем их отправка на портал Azure |
|Настройка пользовательского интерфейса | Полная настройка пользовательского интерфейса, включая поддержку HTML, CSS и JavaScript (требуется личный домен)<br><br>Поддержка нескольких языков для пользовательских строк | Аналогично |
| Настройка атрибутов | Стандартные и пользовательские атрибуты | Аналогично |
|Управление токенами и сеансами | Пользовательский токен и несколько параметров сеанса | Аналогично |
|Поставщики удостоверений| **Сегодня**: определенный локальный поставщик, поставщик социальных сетей<br><br>**В будущем**: OIDC, SAML, OAuth в соответствии со стандартами | **Сегодня**: OIDC, SAML, OAuth в соответствии со стандартами<br><br>**В будущем**: WsFed |
|Задачи удостоверений (примеры) | Регистрация или вход в систему с использованием локальных учетных записей и учетных записей разных социальных сетей<br><br>Самостоятельный сброс пароля<br><br>Изменение профиля<br><br>Сценарии многофакторной проверки подлинности<br><br>Настройка токенов и сеансов<br><br>Потоки токена доступа | Выполняют те же задачи, что и встроенные политики, с помощью пользовательских поставщиков удостоверений или настраиваемых областей<br><br>Подготовка пользователя в другой системе во время регистрации<br><br>Отправка приветственного сообщения почты с помощью поставщика услуг электронной почты<br><br>Использование пользовательского хранилища за пределами B2C<br><br>Проверка предоставленной пользователями информации с помощью доверенной системы через API |

## <a name="policy-files"></a>Файлы политики

Пользовательские политики представлены одним или несколькими XML-файлами, которые ссылаются друг на друга в иерархической цепочке. Элементы XML определяют схему утверждений, преобразования утверждений, определения содержимого, поставщиков утверждений, технические профили и шаги оркестрации пути взаимодействия пользователя, а также другие элементы.

Мы советуем использовать три типа файлов политики:

- **Базовый файл**, который содержит большинство определений и для которого Azure предоставляет полный пример.  Мы советуем вносить минимальное число изменений в этот файл, чтобы упростить устранение неполадок и долгосрочное обслуживание ваших политик.
- **Файл расширения** — файл, содержащий уникальную конфигурацию вашего клиента.
- **Файл проверяющей стороны (RP)** — однозадачный файл, который может вызвать непосредственно приложение или служба (т. е. проверяющая сторона).  Дополнительные сведения см. в статье об определениях файлов политики.  Каждой уникальной задаче требуется собственный файл проверяющей стороны. В зависимости от требований к фирменной символике их число может быть выражено как "общее число приложений х общее число вариантов использования".


Встроенные политики в Azure AD B2C следуют описанному выше шаблону с тремя файлами, но разработчик видит только файл проверяющей стороны, в то время как портал в фоновом режиме вносит изменения в файл расширения.

## <a name="core-concepts-you-should-know-when-using-custom-policies"></a>Основные понятия, которые следует знать при использовании пользовательских политик

### <a name="azure-active-directory-b2c"></a>Azure Active Directory B2C

Служба управления удостоверениями и доступом клиентов Azure (CIAM). Служба включает в себя:

1. Пользовательский каталог в виде специализированного Azure Active Directory, который доступен через Microsoft Graph. В нем содержатся данные пользователя для локальных и федеративных учетных записей. 
2. Доступ к инфраструктуре **Identity Experience Framework**, которая управляет доверием между пользователями и сущностями и обменивается утверждениями между ними для выполнения задач управления удостоверениями и доступом. 
3. Служба маркеров безопасности (STS), выдающая маркеры удостоверений, маркеры обновления и маркеры доступа (и эквивалентные утверждения SAML) и проверяющая их для защиты ресурсов.

Azure AD B2C последовательно взаимодействует с поставщиками удостоверений, пользователями, другими системами и с локальным каталогом пользователей для выполнения задачи идентификации (например, вход в систему, регистрация нового пользователя, сброс пароля). Базовая платформа, устанавливающая доверие между несколькими участниками и выполняющая эти шаги, называется инфраструктурой Identity Experience Framework, а политика (которая также называется путем взаимодействия пользователя или инфраструктурой доверия) явно определяет субъекты, действия, протоколы и выполняемую последовательность шагов.

### <a name="identity-experience-framework"></a>Инфраструктура процедур идентификации

Полностью настраиваемая управляемая политиками облачная платформа Azure, которая оркестрирует доверие между сущностями (в основном поставщиками утверждений) с использованием стандартных протоколов, таких как OpenIDConnect, OAuth, SAML, WSFed, и нескольких нестандартных (например, обмен утверждениями между системами на основе REST API). Эта инфраструктура обеспечивает удобные возможности с поддержкой HTML, CSS и JavaScript.  В настоящее время инфраструктура процедур идентификации доступна только в контексте службы Azure AD B2C. Приоритетом для нее являются задачи, связанные с CIAM.

### <a name="built-in-policies"></a>Встроенные политики

Предопределенные файлы конфигурации, которые определяют поведение Azure AD B2C при выполнении самых распространенных задач идентификации (т. е. регистрации пользователей, операций входа, сброса пароля) и взаимодействия с доверенными сторонами, отношение которых также предварительно определено в Azure AD B2C (например, поставщик удостоверений Facebook, LinkedIn, учетная запись Майкрософт, учетные записи Google).  В будущем встроенные политики также смогут предоставить настройку поставщиков удостоверений, которые обычно находятся в корпоративной области, например Azure Active Directory Premium, Active Directory и AD FS, Salesforce ID Provider и т. д.


### <a name="custom-policies"></a>Пользовательские политики

Файлы конфигурации, которые определяют поведение инфраструктуры процедур идентификации в вашем клиенте Azure AD B2C. Пользовательская политика доступна в виде одного или нескольких XML-файлов (ознакомьтесь с определениями файлов политики), которые выполняются инфраструктурой процедур идентификации при вызове проверяющей стороной (например, приложением). Разработчик удостоверения может напрямую изменять пользовательские политики для выполнения практически неограниченного количества задач. Разработчики, которые настраивают пользовательские политики, должны точно и подробно определить отношения доверия, чтобы добавить конечные точки метаданных, точные определения обмена утверждениями и настроить секретные данные, ключи и сертификаты, отличающиеся в зависимости от поставщика удостоверений.

## <a name="policy-file-definitions-for-identity-experience-framework-trust-frameworks"></a>Определения файлов политики для инфраструктур доверия Identity Experience Framework

### <a name="policy-files"></a>Файлы политики

Пользовательские политики представлены одним или несколькими XML-файлами, которые ссылаются друг на друга в иерархической цепочке. Элементы XML определяют: схему утверждений, преобразования утверждений, определения содержимого, поставщиков утверждений, технические профили и шаги оркестрации пути взаимодействия пользователя, а также другие элементы.  Мы советуем использовать три типа файлов политики:

- **Базовый файл**, который содержит большинство определений и для которого Azure предоставляет полный пример.  Мы советуем вносить минимальное число изменений в этот файл, чтобы упростить устранение неполадок и долгосрочное обслуживание ваших политик.
- **Файл расширения** — файл, содержащий уникальную конфигурацию вашего клиента.
- **Файл проверяющей стороны (RP)**  — однозадачный файл, который может быть вызван непосредственно приложением или службой (т. е. проверяющей стороной).  Дополнительные сведения см. в статье об определениях файлов политики.  Каждой уникальной задаче требуется собственный файл проверяющей стороны и в зависимости от требований к фирменной символике их число может быть выражено как "общее количество приложений общее количество вариантов использования".

![Типы файлов политики](media/active-directory-b2c-overview-custom/active-directory-b2c-overview-custom-policy-files.png)

| Тип файла политики | Примеры имени файла | Рекомендации по использованию | Наследует от |
|---------------------|--------------------|-----------------|---------------|
| Базовая |TrustFrameworkBase.xml<br><br>Mytenant.onmicrosoft.com-B2C-1A_BASE1.xml | Включает схему основных утверждений, преобразования утверждений, поставщиков утверждений и пути взаимодействия пользователей, настроенные Майкрософт<br><br>Вносите минимальные изменения в этот файл | None |
| Расширение (EXT) | TrustFrameworkExtensions.xml<br><br>Mytenant.onmicrosoft.com-B2C-1A_EXT.xml | Объедините изменения в базовый файл<br><br>Измененные поставщики утверждений<br><br>Измененные пути взаимодействия пользователей<br><br>Пользовательские определения схем | Базовый файл |
| Проверяющая сторона (RP) | B2C_1A_sign_up_sign_in.xml| Измените параметры сеанса и фигуры токена здесь| Файл исключений (EXT-файл) |

### <a name="inheritance-model"></a>Модель наследования

Когда приложение вызывает файл политики проверяющей стороны, инфраструктура процедур идентификации в B2C добавит все элементы из базового файла, затем из файла расширений и, наконец, из файла политики проверяющей стороны, чтобы создать действующую политику.  Элементы одного и того же типа и имени в файле проверяющей стороны будут переопределять те, что находятся в файле расширений, а последние переопределят значения в базовом файле.

**Встроенные политики** в Azure AD B2C следуют описанному выше шаблону с 3 файлами, но разработчик видит только файл проверяющей стороны, в то время как портал в фоновом режиме вносит изменения в файл расширения.  Все экземпляры Azure AD B2C используют базовый файл политики, который находится под контролем команды Azure B2C и часто обновляется.

## <a name="next-steps"></a>Дополнительная информация

> [!div class="nextstepaction"]
> [Azure Active Directory B2C. Приступая к работе с настраиваемыми политиками](active-directory-b2c-get-started-custom.md)
