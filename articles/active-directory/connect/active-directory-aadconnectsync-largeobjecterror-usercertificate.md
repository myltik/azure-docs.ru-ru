---
title: Azure AD Connect. Обработка ошибок LargeObject, вызванных атрибутом userCertificate | Документация Майкрософт
description: В этой статье представлены инструкции по устранению ошибок LargeObject, вызванных атрибутом userCertificate.
services: active-directory
documentationcenter: ''
author: billmath
manager: mtillman
editor: ''
ms.assetid: 146ad5b3-74d9-4a83-b9e8-0973a19828d9
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/13/2017
ms.component: hybrid
ms.author: billmath
ms.custom: seohack1
ms.openlocfilehash: 9866454735b33239a812dca238006299c74e5ae2
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34592812"
---
# <a name="azure-ad-connect-sync-handling-largeobject-errors-caused-by-usercertificate-attribute"></a>Синхронизация Azure AD Connect: обработка ошибок LargeObject, вызванных атрибутом userCertificate

В Azure AD для атрибута **userCertificate** принудительно применяется ограничение на максимальное число значений сертификата (**15**). Если Azure AD Connect экспортирует объект с более чем 15 значениями в службу Azure AD, она возвратит ошибку **LargeObject** со следующим сообщением:

>*"Подготовленный объект слишком велик. Сократите число значений атрибутов для этого объекта. Операция будет выполнена повторно в следующем цикле синхронизации..."*

Ошибку LargeObject могут вызвать другие атрибуты AD. Чтобы убедиться, что ошибку действительно вызвал атрибут userCertificate, необходимо проверить объект в локальной службе AD или выполнить [поиск в метавселенной Synchronization Service Manager](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnectsync-service-manager-ui-mvsearch).

Список объектов в клиенте с ошибками LargeObject можно получить одним из следующих методов:

 * Если в клиенте включена служба Azure AD Connect Health для синхронизации, вы можете ознакомиться с предоставляемым [отчетом об ошибках синхронизации](https://docs.microsoft.com/azure/active-directory/connect-health/active-directory-aadconnect-health-sync#object-level-synchronization-error-report-preview).
 
 * В электронном письме с уведомлением для ошибок синхронизации каталогов, отправляемом в конце каждого цикла синхронизации, есть список объектов с ошибками LargeObject. 
 * Если выбрать новую операцию экспорта в Azure AD, на [вкладке операций Synchronization Service Manager](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnectsync-service-manager-ui-operations) отобразится список объектов с ошибками LargeObject.
 
## <a name="mitigation-options"></a>Варианты устранения ошибок
Пока ошибка LargeObject не устранена, невозможно экспортировать другие изменения атрибутов одного объекта в Azure AD. Ниже представлены способы устранения ошибки:

 * Обновите Azure AD Connect до сборки 1.1.524.0 или более поздних версий. В Azure AD Connect сборки 1.1.524.0 стандартные правила синхронизации были обновлены: атрибуты userCertificate и userSMIMECertificate не экспортируются, если эти атрибуты имеют более 15 значений. Информацию об обновлении Azure AD Connect см. в статье [Azure AD Connect: обновление до последней версии](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version).

 * Реализуйте **исходящее правило синхронизации** в Azure AD Connect, экспортирующее **значение null, а не фактические значения для объектов с более чем 15 значениями сертификата**. Этот вариант подходит, если не нужно экспортировать значения сертификата для объектов с более чем 15 значениями в Azure AD. Дополнительные сведения о реализации этого правила синхронизации см. в следующем разделе: [Реализация правила синхронизации для ограничения экспорта атрибута userCertificate](#implementing-sync-rule-to-limit-export-of-usercertificate-attribute).

 * Сократите количество значений сертификата в локальном объекте AD (15 или меньше), удалив значения, которые больше не используются в вашей организации. Это подходящий вариант, если увеличение числа атрибутов произошло из-за сертификатов с истекшим сроком действия или неиспользуемых сертификатов. Чтобы найти, архивировать и удалить сертификаты с истекшим сроком действия в локальной версии AD, вы можете использовать [скрипт PowerShell отсюда](https://gallery.technet.microsoft.com/Remove-Expired-Certificates-0517e34f). Прежде чем удалять сертификаты, мы рекомендуем свериться с администраторами инфраструктуры открытых ключей в организации.

 * Настройте Azure AD Connect таким образом, чтобы атрибут userCertificate не экспортировался в Azure AD. В общем мы не рекомендуем этот вариант, так как атрибут может использоваться в Microsoft Online Services для реализации определенных сценариев, например:
    * Атрибут userCertificate объекта User используется в клиентах Exchange Online и Outlook для подписывания и шифрования сообщений. Дополнительные сведения об этой функции см. в статье [S/MIME для подписи и шифрования сообщений](https://technet.microsoft.com/library/dn626158(v=exchg.150).aspx).

    * Атрибут userCertificate объекта Computer используется в Azure AD для подключения локальных, присоединенных к домену устройств с Windows 10 к Azure AD. Дополнительные сведения об этой функции см. в статье [Подключение присоединенных к домену устройств к Azure AD для работы в Windows 10](https://docs.microsoft.com/azure/active-directory/active-directory-azureadjoin-devices-group-policy).

## <a name="implementing-sync-rule-to-limit-export-of-usercertificate-attribute"></a>Реализация правила синхронизации для ограничения экспорта атрибута userCertificate
Чтобы устранить ошибку LargeObject, вызванную атрибутом userCertificate, реализуйте исходящее правило синхронизации в Azure AD Connect, экспортирующее **значение null, а не фактические значения для объектов с более чем 15 значениями сертификата**. В этом разделе описываются шаги, необходимые для реализации правила синхронизации для объектов **User**. Эти же действия можно использовать для объектов **Contact** и **Computer**.

> [!IMPORTANT]
> При экспорте значения null удаляются значения сертификата, ранее экспортированные в Azure AD.

Далее шаги представлены вкратце.

1. Отключите планировщик синхронизации и убедитесь, что синхронизация не выполняется.
3. Найдите имеющееся исходящее правило синхронизации для атрибута userCertificate.
4. Создайте требуемое исходящее правило синхронизации.
5. Примените новое правило синхронизации к имеющемуся объекту с ошибкой LargeObject.
6. Примените новое правило синхронизации к остальным объектам с ошибкой LargeObject.
7. Убедитесь, что непредвиденные изменения, которые нужно экспортировать в Azure AD, отсутствуют.
8. Экспортируйте изменения в Azure AD.
9. Повторно включите планировщик синхронизации.

### <a name="step-1-disable-sync-scheduler-and-verify-there-is-no-synchronization-in-progress"></a>Шаг 1. Отключите планировщик синхронизации и убедитесь, что синхронизация не выполняется
Реализуя новое правило синхронизации, убедитесь, что синхронизация не выполняется, во избежание экспорта непреднамеренных изменений в Azure AD. Чтобы отключить встроенный планировщик синхронизации, сделайте следующее:
1. Запустите сеанс PowerShell на сервере Azure AD Connect.

2. Отключите плановую синхронизацию, выполнив командлет: `Set-ADSyncScheduler -SyncCycleEnabled $false`

> [!Note]
> Описанные выше шаги применимы только к более новым версиям (1.1.xxx.x) Azure AD Connect со встроенным планировщиком. Если вы используете более ранние версии (1.0.xxx.x) Azure AD Connect с планировщиком заданий Windows или собственный нестандартный пользовательский планировщик для запуска периодической синхронизации, необходимо отключить их соответствующим образом.

3. Запустите **Synchronization Service Manager**, выбрав "Пуск → Служба синхронизации".

4. Перейдите на вкладку **операций** и убедитесь, что на ней не отображаются операции в состоянии *Выполняется*.

### <a name="step-2-find-the-existing-outbound-sync-rule-for-usercertificate-attribute"></a>Шаг 2. Найдите имеющееся исходящее правило синхронизации для атрибута userCertificate
В системе должно иметься правило синхронизации, включенное и настроенное для экспорта атрибута userCertificate для объектов User в Azure AD. Найдите это правило синхронизации, чтобы узнать его **приоритет** и конфигурацию **фильтра области**:

1. Запустите **редактор правил синхронизации**, выбрав "Пуск → Редактор правил синхронизации".

2. Настройте фильтры поиска со следующими значениями:

    | Атрибут | Значение |
    | --- | --- |
    | Направление |**Outbound** |
    | Тип объекта метавселенной |**Person** |
    | Соединитель |*Имя вашего клиента Azure AD* |
    | Тип объекта соединителя |**user** |
    | Атрибуты метавселенной |**userCertificate** |

3. При применении стандартных правил синхронизации к соединителю Azure AD для экспорта атрибута userCertficiate для объектов User должно возвратиться правило *Из внешней среды в AAD — пользователь ExchangeOnline*.
4. Запишите значение **приоритета** этого правила синхронизации.
5. Выберите правило синхронизации и щелкните **Изменить**.
6. Во всплывающем диалоговом окне *Edit Reserved Rule Confirmation* (Изменить подтверждение зарезервированного правила) щелкните **Нет**. (Не беспокойтесь, мы не собираемся изменять это правило синхронизации.)
7. В окне изменения выберите вкладку **Scoping filter** (Фильтр области).
8. Запишите конфигурацию фильтра области. При использовании стандартного правила синхронизации должна быть **одна группа фильтров области с двумя предложениями**, включая следующие:

    | Атрибут | Оператор | Значение |
    | --- | --- | --- |
    | sourceObjectType | EQUAL | Пользователь |
    | cloudMastered | NOTEQUAL | Истина |

### <a name="step-3-create-the-outbound-sync-rule-required"></a>Шаг 3. Создайте требуемое исходящее правило синхронизации
Для нового и имеющегося правила синхронизации нужно использовать один и тот же **фильтр области**, но **приоритет** нового правила синхронизации должен быть выше, чем приоритет имеющегося. Таким образом, новое и имеющееся правила синхронизации будут применяться к одному набору объектов. При этом новое правило будет переопределять имеющееся для атрибута userCertificate. Чтобы создать правило синхронизации, сделайте следующее:
1. В редакторе правил синхронизации нажмите кнопку **Add new rule** (Добавить новое правило).
2. На вкладке **Описание** укажите следующую конфигурацию:

    | Атрибут | Значение | Сведения |
    | --- | --- | --- |
    | ИМЯ | *Укажите имя* | Например, *Из внешней среды в AAD — пользовательское переопределение для userCertificate*. |
    | ОПИСАНИЕ | *Укажите описание* | Например, *если атрибут userCertificate содержит более 15 значений, экспортировать NULL.* |
    | Подключенная система | *Выберите соединитель Azure AD* |
    | Тип объекта подключенной системы | **user** | |
    | Тип объекта метавселенной | **person** | |
    | Тип связи | **Join** | |
    | Приоритет | *Выберите число от 1 до 99* | Выбранное значение не должно использоваться в имеющихся правилах синхронизации. Оно должно быть меньше значения (и, следовательно, приоритетнее) существующего правила синхронизации. |

3. Перейдите на вкладку **Scoping filter** (Фильтр области) и примените тот же фильтр области, который используется в имеющемся правиле синхронизации.
4. Пропустите вкладку **Join rules** (Правила объединения).
5. Перейдите на вкладку **Transformations** (Преобразования), чтобы добавить новое преобразование, используя следующую конфигурацию:

    | Атрибут | Значение |
    | --- | --- |
    | Тип потока |**Expression** |
    | Целевой атрибут |**userCertificate** |
    | Исходный атрибут |*Используйте следующее выражение:* `IIF(IsNullOrEmpty([userCertificate]), NULL, IIF((Count([userCertificate])> 15),AuthoritativeNull,[userCertificate]))` |
    
6. Нажмите кнопку **Добавить**, чтобы создать правило синхронизации.

### <a name="step-4-verify-the-new-sync-rule-on-an-existing-object-with-largeobject-error"></a>Шаг 4. Примените новое правило синхронизации к имеющемуся объекту с ошибкой LargeObject.
Так вы сможете убедиться, что созданное правило синхронизации действует соответствующим образом в имеющемся объекте AD с ошибкой LargeObject, прежде чем применить его к другим объектам:
1. Откройте вкладку **Operations** (Операции) в Synchronization Service Manager.
2. Выберите последнюю операцию экспорта в Azure AD и щелкните один из объектов с ошибкой LargeObject.
3.  На всплывающем экране Connector Space Object Properties (Свойства объекта пространства соединителя) щелкните кнопку **Preview** (Предварительный просмотр).
4. На всплывающем экране предварительного просмотра выберите **Full synchronization** (Полная синхронизация) и **Commit Preview** (Просмотр перед фиксацией).
5. Закройте экран предварительного просмотра и свойств объекта пространства соединителя.
6. Откройте вкладку **Connectors** (Соединители) в Synchronization Service Manager.
7. Щелкните правой кнопкой мыши соединитель **Azure AD** и выберите команду **Run...** (Выполнить...).
8. На всплывающем экране запуска соединителя выберите шаг **Экспорт** и щелкните **ОК**.
9. Дождитесь завершения экспорта в Azure AD и убедитесь, что в этом объекте больше нет ошибок LargeObject.

### <a name="step-5-apply-the-new-sync-rule-to-remaining-objects-with-largeobject-error"></a>Шаг 5. Примените новое правило синхронизации к остальным объектам с ошибкой LargeObject
Добавив правило синхронизации, выполните шаг полной синхронизации для соединителя AD:
1. Откройте вкладку **Connectors** (Соединители) в Synchronization Service Manager.
2. Щелкните правой кнопкой мыши соединитель **AD** и выберите команду **Run...** (Выполнить...).
3. На всплывающем экране запуска соединителя выберите шаг **Full Synchronization** (Полная синхронизация) и щелкните **ОК**.
4. Дождитесь выполнения шага полной синхронизации.
5. При наличии нескольких соединителей AD повторите описанные выше действия для оставшихся соединителей AD. Как правило, для нескольких локальных каталогов требуется несколько соединителей.

### <a name="step-6-verify-there-are-no-unexpected-changes-waiting-to-be-exported-to-azure-ad"></a>Шаг 6. Убедитесь, что непредвиденные изменения, которые нужно экспортировать в Azure AD, отсутствуют
1. Откройте вкладку **Connectors** (Соединители) в Synchronization Service Manager.
2. Щелкните правой кнопкой мыши соединитель **Azure AD** и выберите команду **Search Connector Space** (Поиск пространства соединителя).
3. Во всплывающем окне Search Connector Space (Поиск пространства соединителя) сделайте следующее:
    1. В качестве области укажите **ожидающий экспорт**.
    2. Установите все 3 флажка, в том числе **Добавить**, **Изменить** и **Удалить**.
    3. Щелкните кнопку **Поиск**, чтобы вернуть все объекты с изменениями, которые нужно экспортировать в Azure AD.
    4. Убедитесь, что непредвиденные изменения отсутствуют. Чтобы проверить изменения указанного объекта, дважды щелкните его.

### <a name="step-7-export-the-changes-to-azure-ad"></a>Шаг 7. Экспортируйте изменения в Azure AD
Экспорт изменений в Azure AD
1. Откройте вкладку **Connectors** (Соединители) в Synchronization Service Manager.
2. Щелкните правой кнопкой мыши соединитель **Azure AD** и выберите команду **Run...** (Выполнить...).
4. На всплывающем экране запуска соединителя выберите шаг **Экспорт** и щелкните **ОК**.
5. Дождитесь завершения экспорта в Azure AD и убедитесь, что ошибок LargeObject больше нет.

### <a name="step-8-re-enable-sync-scheduler"></a>Шаг 8. Повторно включите планировщик синхронизации
Устранив проблему, повторно включите встроенный планировщик синхронизации:
1. Запустите сеанс PowerShell.
2. Повторно включите плановую синхронизацию, выполнив командлет: `Set-ADSyncScheduler -SyncCycleEnabled $true`

> [!Note]
> Описанные выше шаги применимы только к более новым версиям (1.1.xxx.x) Azure AD Connect со встроенным планировщиком. Если вы используете более ранние версии (1.0.xxx.x) Azure AD Connect с планировщиком заданий Windows или собственный нестандартный пользовательский планировщик для запуска периодической синхронизации, необходимо отключить их соответствующим образом.

## <a name="next-steps"></a>Дополнительная информация
Узнайте больше об [интеграции локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md).

