---
title: Сквозная проверка подлинности в Azure AD Connect — смарт-блокировка | Документы Майкрософт
description: В этой статье описано, как сквозная проверка подлинности Azure Active Directory (Azure AD) позволяет защитить локальные учетные записи от атак методом подбора пароля в облаке.
services: active-directory
keywords: сквозная проверка подлинности azure ad connect, установка active directory, необходимые компоненты для azure ad, единый вход
documentationcenter: ''
author: swkrish
manager: mtillman
ms.assetid: 9f994aca-6088-40f5-b2cc-c753a4f41da7
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/07/2018
ms.component: hybrid
ms.author: billmath
ms.openlocfilehash: 73a34809b354eb38f44656f8d7dd598a8e640857
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34591319"
---
# <a name="azure-active-directory-pass-through-authentication-smart-lockout"></a>Сквозная проверка подлинности Azure Active Directory: смарт-блокировка

## <a name="overview"></a>Обзор

Azure Active Directory (Azure AD) обеспечивает защиту от атак методом подбора пароля и предотвращает потерю доступа разрешенных пользователей к приложениям Office 365 и SaaS. Эта функция, которая называется *смарт-блокировкой*, поддерживается при входе с помощью сквозной проверки подлинности. Смарт-блокировка по умолчанию включена для всех клиентов, а не только для клиентов, использующих сквозную аутентификацию. Она обеспечивает непрерывную защиту учетных записей пользователей.

Смарт-блокировка отслеживает неудачные попытки входа в систему. По достижении заданного *порога блокировки* механизм запускает *блокировку в течение определенного периода*. Смарт-блокировка отклоняет все попытки входа злоумышленника в этот период. Если по его истечении атака продолжается, последующие неудачные попытки входа будут увеличивать продолжительность блокировки.

>[!NOTE]
>Пороговое значение блокировки по умолчанию — 10 неудачных попыток входа. Продолжительность блокировки по умолчанию — 60 секунд.

Смарт-блокировка также различает попытки входа разрешенных пользователей и злоумышленников. В большинстве случаев механизм будет блокировать только попытки входа злоумышленников. Это не позволяет злоумышленникам намеренно заблокировать вход для настоящих пользователей. Смарт-блокировка различает разрешенных пользователей и злоумышленников на основе данных о предыдущих входах, сведений об устройствах пользователей и используемых ими браузерах. Также она отслеживает пользователей и по другим признакам. Эти алгоритмы постоянно улучшаются.

Механизм сквозной проверки подлинности перенаправляет запросы на проверку пароля в локальный экземпляр Active Directory. Поэтому необходимо предотвратить блокировку злоумышленниками учетных записей Active Directory. В Active Directory есть собственные политики блокировки учетных записей, в частности политики [порогового значения блокировки учетных записей](https://technet.microsoft.com/library/hh994574(v=ws.11).aspx) и [сброса счетчика блокировки учетных записей через определенное время](https://technet.microsoft.com/library/hh994568(v=ws.11).aspx). Чтобы отфильтровать атаки в облаке, прежде чем они достигнут локального экземпляра Azure AD, настройте соответствующим образом пороговое значение блокировки AD и продолжительность блокировки.

>[!NOTE]
>>Функция смарт-блокировки предоставляется бесплатно. Она _включена_ по умолчанию для всех пользователей. Однако для изменения порогового значения блокировки и периода блокировки в Azure AD с помощью API Graph клиенту требуется лицензия Azure AD Premium P2. 

Чтобы убедиться, что локальные учетные записи пользователей AD защищены должным образом, проверьте следующее:

   * Пороговое значение блокировки Azure AD должно быть _меньше_, чем пороговое значение блокировки учетных записей Active Directory. Необходимо, чтобы пороговое значение блокировки учетных записей Active Directory как минимум в два-три раза превышало пороговое значение блокировки Azure AD.
   * Продолжительность блокировки Azure AD (в секундах) должна быть _больше_, чем время до сброса счетчика блокировки учетных записей Active Directory (в минутах).

>[!IMPORTANT]
>Сейчас администраторы не могут разблокировать учетные записи пользователей в облаке, если они заблокированы с помощью смарт-блокировки. Администраторы должны подождать, пока не завершится срок действия блокировки.

## <a name="verify-your-active-directory-account-lockout-policies"></a>Проверка политик блокировки учетных записей Active Directory

Чтобы проверить политики блокировки учетных записей Active Directory, сделайте следующее:

1.  Откройте средства управления групповыми политиками.
2.  Измените групповую политику, которая применяется ко всем пользователям, например **политику домена по умолчанию**.
3.  Последовательно выберите **Конфигурация компьютера** > **Политики** > **Параметры Windows** > **Параметры безопасности** > **Политики учетных записей** > **Политика блокировки учетной записи**.
4.  Проверьте **пороговое значение блокировки учетных записей** и **время до сброса счетчика блокировки учетных записей**.

![Политики блокировки учетных записей Active Directory](./media/active-directory-aadconnect-pass-through-authentication/pta5.png)

## <a name="use-the-graph-api-to-manage-your-tenants-smart-lockout-values-requires-a-premium-license"></a>Управление параметрами смарт-блокировки клиента с помощью API Graph (требуется лицензия Premium)

>[!IMPORTANT]
>С помощью API Graph в Azure AD Premium P2 можно изменять пороговое значение и период блокировки Azure AD. Чтобы использовать эту функцию, у вас должны быть права глобального администратора клиента.

Для просмотра, настройки и обновления параметров смарт-блокировки Azure AD можно использовать [Graph Explorer](https://developer.microsoft.com/graph/graph-explorer). Эти операции можно также выполнять программными средствами.

### <a name="view-smart-lockout-values"></a>Просмотр параметров смарт-блокировки

Чтобы просмотреть параметры смарт-блокировки клиента, сделайте следующее:

1. Войдите в Graph Explorer как глобальный администратор клиента. При необходимости предоставьте доступ для запрошенных разрешений.
2. Щелкните **Изменить разрешения** и выберите разрешение **Directory.ReadWrite.All**.
3. Настройте запрос API Graph следующим образом: задайте для версии значение **BETA**, для типа запроса — **GET**, а для URL-адреса — `https://graph.microsoft.com/beta/<your-tenant-domain>/settings`.
4. Щелкните **Выполнить запрос**, чтобы просмотреть параметры смарт-блокировки клиента. Если вы не устанавливали значений параметров клиента, вы увидите пустой набор параметров.

### <a name="set-smart-lockout-values"></a>Установка параметров смарт-блокировки

Чтобы установить параметры смарт-блокировки клиента (требуется только в первый раз), сделайте следующее:

1. Войдите в Graph Explorer как глобальный администратор клиента. При необходимости предоставьте доступ для запрошенных разрешений.
2. Щелкните **Изменить разрешения** и выберите разрешение **Directory.ReadWrite.All**.
3. Настройте запрос API Graph следующим образом: задайте для версии значение **BETA**, для типа запроса — **POST**, а для URL-адреса — `https://graph.microsoft.com/beta/<your-tenant-domain>/settings`.
4. Скопируйте и вставьте следующий запрос JSON в поле **Текст запроса**.
5. Щелкните **Выполнить запрос**, чтобы настроить параметры смарт-блокировки клиента.

```
{
  "templateId": "5cf42378-d67d-4f36-ba46-e8b86229381d",
  "values": [
    {
      "name": "LockoutDurationInSeconds",
      "value": "300"
    },
    {
      "name": "LockoutThreshold",
      "value": "5"
    },
    {
      "name" : "BannedPasswordList",
      "value": ""
    },
    {
      "name" : "EnableBannedPasswordCheck",
      "value": "false"
    }
  ]
}
```

>[!NOTE]
>Если вы не используете параметры **BannedPasswordList** и **EnableBannedPasswordCheck**, можно оставить соответствующие значения **""** (пустое) и **false**.

Используя шаги, описанные в разделе [Просмотр параметров смарт-блокировки](#view-smart-lockout-values), проверьте правильность настройки параметров клиента.

### <a name="update-smart-lockout-values"></a>Обновление параметров смарт-блокировки

Чтобы обновить параметры смарт-блокировки клиента (если они были установлены ранее), сделайте следующее:

1. Войдите в Graph Explorer как глобальный администратор клиента. При необходимости предоставьте доступ для запрошенных разрешений.
2. Щелкните **Изменить разрешения** и выберите разрешение **Directory.ReadWrite.All**.
3. [Просмотрите параметры смарт-блокировки клиента](#view-smart-lockout-values). Скопируйте идентификатор `id` (GUID) элемента с параметром **displayName**, для которого установлено значение **PasswordRuleSettings**.
4. Настройте запрос API Graph следующим образом: задайте для версии значение **BETA**, для типа запроса — **PATCH**, а для URL-адреса — `https://graph.microsoft.com/beta/<your-tenant-domain>/settings/<id>`. Используйте GUID из шага 3 для `<id>`.
5. Скопируйте и вставьте следующий запрос JSON в поле **Текст запроса**. Измените параметры смарт-блокировки соответствующим образом.
6. Щелкните **Выполнить запрос**, чтобы обновить параметры смарт-блокировки клиента.

```
{
  "values": [
    {
      "name": "LockoutDurationInSeconds",
      "value": "30"
    },
    {
      "name": "LockoutThreshold",
      "value": "4"
    },
    {
      "name" : "BannedPasswordList",
      "value": ""
    },
    {
      "name" : "EnableBannedPasswordCheck",
      "value": "false"
    }
  ]
}
```

Используя шаги, описанные в разделе [Просмотр параметров смарт-блокировки](#view-smart-lockout-values), проверьте правильность обновления параметров клиента.

## <a name="next-steps"></a>Дополнительная информация
[UserVoice](https://feedback.azure.com/forums/169401-azure-active-directory/category/160611-directory-synchronization-aad-connect). Оставить запрос на новые функции можно на форуме по Azure Active Directory.
