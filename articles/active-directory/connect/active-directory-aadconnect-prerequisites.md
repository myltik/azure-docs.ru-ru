---
title: "Azure AD Connect: оборудование и необходимые компоненты | Документация Майкрософт"
description: "В этом разделе описаны необходимые условия и требования к оборудованию для Azure AD Connect."
services: active-directory
documentationcenter: 
author: andkjell
manager: femila
editor: 
ms.assetid: 91b88fda-bca6-49a8-898f-8d906a661f07
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.translationtype: HT
ms.sourcegitcommit: 1868e5fd0427a5e1b1eeed244c80a570a39eb6a9
ms.openlocfilehash: e09017cbd6c4060ea24bb17c751277b4f4c6daf8
ms.contentlocale: ru-ru
ms.lasthandoff: 09/19/2017

---
# <a name="prerequisites-for-azure-ad-connect"></a>Необходимые условия для Azure AD Connect
В этой статье описаны необходимые условия и требования к оборудованию для Azure AD Connect.

## <a name="before-you-install-azure-ad-connect"></a>Перед установкой Azure AD Connect
Прежде чем установить Azure AD Connect и обновить DirSync, вам потребуется ряд элементов.

### <a name="azure-ad"></a>Azure AD
* Подписка Azure или [пробная подписка Azure](https://azure.microsoft.com/pricing/free-trial/). Она необходима только для доступа к порталу Azure и не требуется для использования Azure AD Connect. Если вы используете PowerShell или Office 365, то для работы с Azure AD Connect подписка Azure не требуется. При наличии лицензии на Office 365 можно также использовать портал Office 365. Платная лицензия на Office 365 также позволяет перейти на портал Azure с портала Office 365.
  * Кроме того, можно использовать [портал Azure](https://portal.azure.com). Для этого не нужна лицензия Azure AD.
* [Добавьте и подтвердите домен](../active-directory-domains-add-azure-portal.md) , который вы планируете использовать в Azure AD. Например, если вы планируете использовать для своих пользователей домен contoso.com, убедитесь, что он был подтвержден и вы используете не просто домен по умолчанию contoso.onmicrosoft.com.
* Клиент Azure AD по умолчанию может вмещать 50 тыс. объектов. После подтверждения домена этот предел увеличивается до 300 тыс. объектов. Если вам нужно еще больше объектов в Azure AD, необходимо отправить обращение в службу технической поддержки, чтобы дополнительно увеличить данный предел. Если вам необходимо более 500 тыс. объектов, то потребуется лицензия, например на Office 365, Azure AD Basic, Azure AD Premium или Enterprise Mobility + Security.

### <a name="prepare-your-on-premises-data"></a>Подготовка локальных данных
* Прежде чем выполнять синхронизацию с Azure AD и Office 365, воспользуйтесь инструментом [IdFix](https://support.office.com/article/Install-and-run-the-Office-365-IdFix-tool-f4bd2439-3e41-4169-99f6-3fabdfa326ac) для выявления в каталоге ошибок, таких как повторяющиеся записи или проблемы с форматированием.
* Просмотрите [необязательные функции синхронизации, которые можно включить в Azure AD](active-directory-aadconnectsyncservice-features.md) , и решите, какие их них необходимо использовать.

### <a name="on-premises-active-directory"></a>Локальная служба Active Directory
* Версия схемы и режим работы леса AD должны предполагать использование ОС Windows Server, начиная с версии 2003. Контроллеры домена могут работать под управлением любой версии, если выполняются требования к схеме и уровню леса.
* Если вы планируете использовать **компонент обратной записи паролей**, то контроллеры домена должны работать под управлением Windows Server 2008 (с последним пакетом обновления) или более поздней версии. Если контроллеры доменов используют версию Windows Server 2008, предшествующую R2, необходимо также применить [исправление KB2386717](http://support.microsoft.com/kb/2386717).
* Контроллер домена, используемый Azure AD, должен быть доступен для записи. RODC (контроллер домена только для чтения) **не поддерживается**, и Azure AD Connect не будет поддерживать перенаправления для записи.
* **Не поддерживаются** локальные леса и домены, использующие одноуровневые домены.
* **Не поддерживаются** локальные леса и домены, использующие NetBIOS-имена с точками.
* Рекомендуется [включить корзину Active Directory](active-directory-aadconnectsync-recycle-bin.md).

### <a name="azure-ad-connect-server"></a>Сервер Azure AD Connect
* Службу Azure AD Connect нельзя установить на Small Business Server или Windows Server Essentials. Сервер должен использовать Windows Server Standard или более поздней версии.
* На сервере Azure AD Connect должен быть установлен полный графический интерфейс пользователя. Установка на ядро сервера **не поддерживается**.
* Azure AD Connect необходимо установить на сервер под управлением ОС Windows Server, начиная с версии 2008. Это может быть контроллер домена или рядовой сервер, если используются стандартные параметры. Если используются пользовательские параметры, сервер также может работать в автономном режиме и может быть не присоединен к домену.
* При установке Azure AD Connect в Windows Server 2008 или Windows Server 2008 R2 обязательно примените последние обновления из Центра обновления Windows. Установка на сервер без обновлений невозможна.
* Если планируется использовать функцию **синхронизации паролей**, то сервер Azure AD Connect должен работать под управлением Windows Server 2008 R2 с пакетом обновления 1 (SP1) или более поздней версии.
* Если вы планируете использовать **групповую управляемую учетную запись службы**, то сервер Azure AD Connect должен работать под управлением Windows Server 2012 или более поздней версии.
* На сервере Azure AD Connect должна быть установлена платформа [.NET Framework 4.5.1](#component-prerequisites) или более поздней версии и среда [Microsoft PowerShell 3.0](#component-prerequisites) или более поздней версии.
* На сервере Azure AD Connect должна быть отключена групповая политика транскрипции PowerShell.
* При развертывании служб федерации Active Directory (AD FS) серверы, на которых будут установлены службы AD FS или прокси-служба веб-приложения, должны работать под управлением Windows Server 2012 R2 или более поздней версии. [удаленное управление Windows](#windows-remote-management) .
* При развертывании служб федерации Active Directory необходимы [SSL-сертификаты](#ssl-certificate-requirements).
* При развертывании служб федерации Active Directory необходимо настроить [разрешение имен](#name-resolution-for-federation-servers).
* Если глобальный администратор активировал Многофакторную идентификацию (MFA), то URL-адрес **https://secure.aadcdn.microsoftonline-p.com** должен быть в списке надежных сайтов. Если он не добавлен, вам будет предложено добавить этот сайт в список надежных сайтов перед появлением запроса MFA. Добавить его в список надежных сайтов можно в Internet Explorer.

### <a name="sql-server-used-by-azure-ad-connect"></a>SQL Server, используемый Azure AD Connect
* Azure AD Connect требуется база данных SQL Server для хранения учетных данных. По умолчанию устанавливается SQL Server 2012 Express LocalDB (облегченная версия SQL Server Express). Размер экземпляра SQL Server Express может достигать 10 ГБ, позволяя управлять примерно 100 000 объектов. Если вам нужно управлять более значительным числом объектов каталога, в мастере установки укажите другую установку SQL Server.
* При использовании отдельного SQL Server действуют следующие требования:
  * Azure AD Connect поддерживает все версии Microsoft SQL Server, начиная с SQL Server 2008 (с последним пакетом обновления) и заканчивая SQL Server 2016 с пакетом обновления 1 (SP1). База данных SQL Microsoft Azure в качестве базы данных **не поддерживается** .
  * Необходимо использовать параметры сортировки SQL без учета регистра. Их можно определить по суффиксу \_CI_ в имени. Параметры сортировки с учетом регистра, имена которых содержат суффикс \_CS_, **не поддерживаются**.
  * На один экземпляр SQL может приходиться только один модуль синхронизации. Совместное использование экземпляра SQL модулями FIM/MIM Sync, DirSync и Azure AD Sync **не поддерживается**.

### <a name="accounts"></a>Учетные записи
* Учетная запись глобального администратора Azure AD для клиента Azure AD, с которым необходима интеграция. Это должна быть **учебная или рабочая учетная запись**. **Учетную запись Майкрософт** использовать нельзя.
* Учетная запись администратора предприятия для локальной службы Active Directory при использовании экспресс-параметров или обновлении с DirSync.
* [Учетные записи в Active Directory](active-directory-aadconnect-accounts-permissions.md) при использовании пути установки с пользовательскими параметрами.

### <a name="connectivity"></a>Соединение
* Для серверов Azure AD Connect требуется разрешение DNS как для интрасети, так и для Интернета. DNS-сервер должен иметь возможность разрешения имен как для локальной службы Active Directory, так и для конечных точек Azure AD.
* Если в вашей интрасети есть брандмауэры и вам необходимо открыть порты между серверами Azure AD Connect и контроллерами доменов, то дополнительные сведения см. в статье [Порты и протоколы, необходимые для гибридной идентификации](active-directory-aadconnect-ports.md).
* Если прокси-сервер или брандмауэр ограничивает доступные URL-адреса, то на нем необходимо открыть URL-адреса, указанные в разделе [URL-адреса и диапазоны IP-адресов Office 365](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2).
  * Если вы используете платформу Microsoft Cloud в Германии или облако Microsoft Azure для государственных организаций, то сведения об URL-адресах см. в статье [Azure AD Connect: специальные рекомендации для экземпляров](active-directory-aadconnect-instances.md).
* Azure AD Connect (версия 1.1.614.0 и более поздние версии) по умолчанию использует TLS 1.2 для шифрования связи между модулем синхронизации и Azure AD. Если TLS 1.2 не поддерживается для базовой операционной системы, Azure AD Connect последовательно пытается перейти на более старые протоколы (TLS 1.1 и TLS 1.0). Например, Azure AD Connect под управлением Windows Server 2008 использует TLS 1.0, так как в Windows Server 2008 не поддерживается TLS 1.1 или TLS 1.2.
* До версии 1.1.614.0 Azure AD Connect по умолчанию использует TLS 1.0 для шифрования связи между модулем синхронизации и Azure AD. Чтобы перейти на использование TLS 1.2, нужно выполнить инструкции из раздела [Включение протокола TLS 1.2 для Azure AD Connect](#enable-tls-12-for-azure-ad-connect).
* Если для подключения к Интернету используется прокси-сервер, то в файл **C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\machine.config** необходимо добавить приведенные ниже параметры, чтобы мастер установки и функция синхронизации Azure AD Connect могли подключаться к Интернету и Azure AD. Этот текст необходимо добавить в конец указанного файла. В этом коде &lt;PROXYADRESS&gt; означает фактический IP-адрес или имя узла прокси-сервера.

```
    <system.net>
        <defaultProxy>
            <proxy
            usesystemdefault="true"
            proxyaddress="http://<PROXYADDRESS>:<PROXYPORT>"
            bypassonlocal="true"
            />
        </defaultProxy>
    </system.net>
```

* Если на прокси-сервере требуется аутентификация, то [учетная запись службы](active-directory-aadconnect-accounts-permissions.md#azure-ad-connect-sync-service-account) должна находиться в домене. Кроме того, во время установки вам необходимо указать путь к [настраиваемой учетной записи службы](active-directory-aadconnect-get-started-custom.md#install-required-components). Нужно также внести другое изменение в файле machine.config. С этим изменением в файле machine.config мастер установки и модуль синхронизации будут отвечать на запросы на аутентификацию от прокси-сервера. На всех страницах мастера установки, за исключением страницы **Настройка**, используются учетные данные пользователя, выполнившего вход. На странице **Настройка** перед завершением работы мастера установки контекст переключается на созданную вами [учетную запись службы](active-directory-aadconnect-accounts-permissions.md#azure-ad-connect-sync-service-account). Раздел machine.config должен выглядеть следующим образом.

```
    <system.net>
        <defaultProxy enabled="true" useDefaultCredentials="true">
            <proxy
            usesystemdefault="true"
            proxyaddress="http://<PROXYADDRESS>:<PROXYPORT>"
            bypassonlocal="true"
            />
        </defaultProxy>
    </system.net>
```

* Когда в процессе синхронизации каталогов Azure AD Connect отправляет веб-запрос в Azure AD, то для ответа Azure AD может потребоваться до 5 минут. Для прокси-серверов обычно настраивается время ожидания простоя подключения. Убедитесь, что в настройках для этого параметра задано не менее 6 минут.

Дополнительную информацию об [элементе defaultProxy](https://msdn.microsoft.com/library/kd3cf2ex.aspx) вы можете найти на сайте MSDN.  
В случае проблем с подключением изучите статью [Устранение неполадок подключения в Azure AD Connect](active-directory-aadconnect-troubleshoot-connectivity.md).

### <a name="other"></a>Другие
* Необязательно: тестовая учетная запись пользователя для проверки синхронизации.

## <a name="component-prerequisites"></a>Предварительные требования к компонентам
### <a name="powershell-and-net-framework"></a>PowerShell и .Net Framework
Работа Azure AD Connect основана на Microsoft PowerShell и .NET Framework 4.5.1. На сервере должна быть установлена эта или более поздняя версия. В зависимости от установленной версии Windows Server выполните следующие действия.

* Windows Server 2012R2
  * Microsoft PowerShell устанавливается по умолчанию. Никаких действий не требуется.
  * Платформа .NET Framework 4.5.1 и более поздних версий распространяется через Центр обновления Windows. Убедитесь, что установлены последние обновления для Windows Server в панели управления.
* Windows Server 2008R2 и Windows Server 2012
  * Последняя версия Microsoft PowerShell доступна в составе платформы **Windows Management Framework 4.0**, которую можно скачать из [центра загрузки Майкрософт](http://www.microsoft.com/downloads).
  * .NET Framework 4.5.1 и более поздние версии платформы доступны в [центре загрузки Майкрософт](http://www.microsoft.com/downloads).
* Windows Server 2008
  * Последняя поддерживаемая версия PowerShell доступна в составе платформы **Windows Management Framework 3.0**, которую можно скачать в [Центре загрузки Майкрософт](http://www.microsoft.com/downloads).
  * .NET Framework 4.5.1 и более поздние версии платформы доступны в [центре загрузки Майкрософт](http://www.microsoft.com/downloads).

### <a name="enable-tls-12-for-azure-ad-connect"></a>Включение протокола TLS 1.2 для Azure AD Connect
До версии 1.1.614.0 Azure AD Connect по умолчанию использует TLS 1.0 для шифрования связи между сервером модуля синхронизации и Azure AD. Его можно изменить, настроив приложения .Net таким образом, чтобы на сервере по умолчанию использовался протокол TLS 1.2. Дополнительные сведения о протоколе TLS 1.2 см. в статье [Советы по безопасности (Microsoft) (2960358)](https://technet.microsoft.com/security/advisory/2960358).

1. В Windows Server 2008 включить протокол TLS 1.2 нельзя. Требуется Windows Server 2008 R2 или более поздней версии. У вас должно быть установлено исправление для .NET 4.5.1. См. статью [Советы по безопасности (Microsoft) (2960358)](https://technet.microsoft.com/security/advisory/2960358). Это исправление или его более поздняя версия может быть уже установлена на вашем сервере.
2. Если вы используете Windows Server 2008 R2, убедитесь, что протокол TLS 1.2 включен. На сервере с Windows Server 2012 или более поздней версии протокол TLS 1.2 должен быть уже включен.
   ```
   [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2]
   [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client] "DisabledByDefault"=dword:00000000 "Enabled"=dword:00000001
   [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server] "DisabledByDefault"=dword:00000000 "Enabled"=dword:00000001
   ```
3. Для любой операционной системы задайте этот ключ реестра и перезагрузите сервер.
   ```
   HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v4.0.30319
   "SchUseStrongCrypto"=dword:00000001
   ```
4. Если вы также хотите включить протокол TLS 1.2 между сервером с модулем синхронизации и удаленным экземпляром SQL Server, установите версии, необходимые для [поддержки протокола TLS 1.2 для Microsoft SQL Server](https://support.microsoft.com/kb/3135244).

## <a name="prerequisites-for-federation-installation-and-configuration"></a>Предварительные требования для установки и настройки федерации
### <a name="windows-remote-management"></a>Удаленное управление Windows
При использовании средства Azure AD Connect для развертывания служб федерации Active Directory или прокси-сервера веб-приложения ознакомьтесь с приведенными ниже требованиями.

* Если целевой сервер входит в домен, убедитесь, что включено удаленное управление Windows.
  * В командном окне PSH с повышенными привилегиями выполните команду `Enable-PSRemoting –force`.
* Если целевой сервер — это не входящий в домен WAP-компьютер, существует несколько дополнительных требований.
  * На целевом компьютере (WAP):
    * с помощью оснастки «Службы» убедитесь, что служба WinRM (Windows Remote Management/WS-Management) запущена;
    * В командном окне PSH с повышенными привилегиями выполните команду `Enable-PSRemoting –force`.
  * На компьютере, где запущен мастер (если целевой компьютер не присоединен к домену или присоединен к ненадежному домену), выполните следующие действия.
    * В командном окне PSH с повышенными привилегиями выполните команду `Set-Item WSMan:\localhost\Client\TrustedHosts –Value <DMZServerFQDN> -Force –Concatenate`.
    * В диспетчере серверов:
      * Добавьте узел DMZ WAP в пул компьютеров (Диспетчер серверов -> Управление -> Добавление серверов -> DNS (вкладка)).
      * В диспетчере серверов на вкладке «Все серверы» щелкните правой кнопкой мыши WAP-сервер и выберите параметр «Управлять как», введите локальные учетные данные (не домена) для WAP-компьютера.
      * Чтобы проверить возможность удаленного подключения из PSH, в диспетчере серверов на вкладке «Все сервера» щелкните правой кнопкой мыши WAP-сервер и выберите Windows PowerShell. Должен открыться удаленный сеанс PSH для проверки возможности создания удаленных сеансов PowerShell.

### <a name="ssl-certificate-requirements"></a>Требования к сертификатам SSL
* Настоятельно рекомендуем использовать один и тот же SSL-сертификат на всех узлах фермы AD FS, а также на всех прокси-серверах веб-приложений.
* Это должен быть сертификат X509.
* На серверах федерации в тестовой лабораторной среде можно использовать самозаверяющий сертификат. Однако для рабочей среды рекомендуется получить сертификат из общедоступного центра сертификации.
  * Если вы не используете общедоступный доверенный сертификат, убедитесь, что сертификат, установленный на каждом прокси- сервере веб-приложений, является доверенным (на локальном сервере и на всех серверах федерации).
* Идентификатор сертификата должен совпадать с именем службы федерации (например sts.contoso.com).
  * Идентификатор является расширением альтернативного имени субъекта (SAN) типа dNSName. При отсутствии записей SAN имя субъекта указывается как обычное имя.  
  * В сертификате может быть несколько записей SAN, если одна из них соответствует имени службы федерации.
  * Если вы планируете использовать присоединение Workplace Join, то необходимо дополнительное имя SAN со значением **enterpriseregistration.**, за которым следует суффикс имени участника-пользователя (UPN) вашей организации, например **enterpriseregistration.contoso.com**.
* Сертификаты на основе ключей CryptoAPI следующего поколения (CNG) и поставщики хранилища ключей не поддерживаются. Это означает, что необходимо использовать сертификаты, выданные CSP (поставщиком служб шифрования), а не KSP (поставщиком хранилища ключей).
* Поддерживаются групповые сертификаты.

### <a name="name-resolution-for-federation-servers"></a>Разрешение имен для серверов федерации
* Настройте записи DNS для имени службы федерации AD FS (например, sts.contoso.com) для интрасети (внутренний DNS-сервер) и экстрасети (общедоступный DNS-сервер вашего регистратора доменных имен). Для записи DNS интрасети обязательно используйте записи A, а не записи CNAME. Это необходимо для правильной работы проверки подлинности Windows на компьютере, добавленном в домен.
* Если вы развертываете несколько серверов AD FS или прокси-сервер веб-приложения, убедитесь, что вы настроили балансировщик нагрузки и на него указывают записи DNS для имени службы федерации AD FS (например, sts.contoso.com).
* Чтобы встроенная проверка подлинности Windows работала с приложениями браузера в вашей интрасети, использующими Internet Explorer, необходимо, чтобы имя службы федерации AD FS (например, sts.contoso.com) было добавлено в зону интрасети IE. Имя службы можно указать в групповой политике и развернуть на всех компьютерах, присоединенных к домену.

## <a name="azure-ad-connect-supporting-components"></a>Вспомогательные компоненты Azure AD Connect
Ниже приведен перечень компонентов, которые Azure AD Connect установит на сервере, где установлен Azure AD Connect. Этот список предназначен для базовой установки Express. Если на странице "Установить службы синхронизации" вы выбрали другой выпуск SQL Server, то SQL Express LocalDB не устанавливается локально.

* Azure AD Connect Health
* Помощник по входу в Microsoft Online Services для ИТ-специалистов (установлен, но не обязателен)
* Программы командной строки Microsoft SQL Server 2012
* Microsoft SQL Server 2012 Express LocalDB
* Microsoft SQL Server 2012 Native Client
* Распространяемый пакет Microsoft Visual C++ 2013

## <a name="hardware-requirements-for-azure-ad-connect"></a>Требования к оборудованию для Azure AD Connect
В следующей таблице содержатся минимальные требования к компьютеру синхронизации с Azure AD Connect.

| Количество объектов в Active Directory | ЦП | Память | Размер жесткого диска |
| --- | --- | --- | --- |
| Менее 10 000 |1,6 ГГц |4 ГБ |70 ГБ |
| 10 000–50 000 |1,6 ГГц |4 ГБ |70 ГБ |
| 50 000–100 000 |1,6 ГГц |16 ГБ |100 ГБ |
| При наличии 100 000 объектов или более необходима полная версия SQL Server | | | |
| 100 000–300 000 |1,6 ГГц |32 ГБ |300 ГБ |
| 300 000–600 000 |1,6 ГГц |32 ГБ |450 ГБ |
| Более 600 000 |1,6 ГГц |32 ГБ |500 ГБ |

Для компьютеров, где выполняются AD FS или серверы веб-приложений, предъявляются следующие минимальные требования:

* процессор: двухъядерный с тактовой частотой 1,6 ГГц или выше;
* память: 2 ГБ или более;
* виртуальная машина Azure: конфигурация A2 или выше.

## <a name="next-steps"></a>Дальнейшие действия
Узнайте больше об [интеграции локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md).

