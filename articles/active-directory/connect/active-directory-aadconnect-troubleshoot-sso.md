---
title: 'Azure Active Directory Connect: устранение неполадок с простым единым входом | Документы Майкрософт'
description: В этом разделе описывается устранение неполадок с простым единым входом Azure Active Directory.
services: active-directory
keywords: что такое Azure AD Connect, установка Active Directory, необходимые компоненты для Azure AD, единый вход
documentationcenter: ''
author: swkrish
manager: mtillman
ms.assetid: 9f994aca-6088-40f5-b2cc-c753a4f41da7
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/12/2018
ms.component: hybrid
ms.author: billmath
ms.openlocfilehash: 205df47c36cb1d6925e232f06c0f1355c40ae973
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34592234"
---
# <a name="troubleshoot-azure-active-directory-seamless-single-sign-on"></a>Устранение неполадок с простым единым входом Azure Active Directory

Эта статья поможет вам найти информацию об устранении распространенных неполадок с простым единым входом Azure Active Directory (Azure AD).

## <a name="known-issues"></a>Известные проблемы

- В некоторых случаях включение простого единого входа может занять до 30 минут.
- Если отключить и повторно включить эффективный единый вход для клиента, пользователи не смогут применять единый вход, пока не истечет срок действия их кэшированных билетов Kerberos (как правило, они действительны в течение 10 часов).
- Браузер Microsoft Edge не поддерживается.
- После успешного единого входа пользователю не предоставляется возможность выбрать вариант **Оставаться в системе**. Из-за этого сценарии сопоставления SharePoint и OneDrive не поддерживаются.
- Клиенты Office версии ниже 16.0.8730.xxxx не поддерживают неинтерактивной вход с помощью простого единого входа. Для входа в эти клиенты пользователю нужно ввести свое имя пользователя, но не пароль.
- Простой единый вход не работает в конфиденциальном режиме просмотра в Firefox.
- Простой единый вход не работает в Internet Explorer с включенным режимом повышенной защиты.
- Простой единый вход не работает в браузерах на мобильных устройствах с iOS и Android.
- Если пользователь входит в состав слишком большого количества групп в Active Directory, скорее всего, билет Kerberos этого пользователя будет слишком большим для обработки, что приведет к сбою простого единого входа. HTTPS-запросы Azure AD могут включать заголовки с максимальным размером 16 КБ. Размер билетов Kerberos должен быть гораздо меньше, чтобы можно было разместить другие артефакты Azure AD, такие как файлы cookie. Рекомендуем сократить количество членов в группах и повторить попытку.
- При синхронизации 30 лесов Active Directory или больше простой единый вход через Azure AD Connect включить невозможно. Чтобы избежать этого, можно [вручную включить](#manual-reset-of-azure-ad-seamless-sso) эту функцию на своем клиенте.
- Добавление URL-адреса службы Azure AD (https://autologon.microsoftazuread-sso.com) в зону "Надежные сайты" вместо зоны "Местная интрасеть" *блокирует вход пользователей*.
- Отключение типа шифрования **RC4_HMAC_MD5** для протокола Kerberos в параметрах Active Directory нарушит работу простого единого входа. В редакторе "Управление групповыми политиками" убедитесь, что для параметра политики **RC4_HMAC_MD5** (щелкните **"Конфигурация компьютера" > "Параметры Windows" > "Параметры безопасности" > "Локальные политики" > "Параметры безопасности" > "Network Security: Configure encryption types allowed for Kerberos" (Сетевая безопасность: настройка типов шифрования, разрешенных для Kerberos)**) задано значению "Включено".

## <a name="check-status-of-feature"></a>Проверка состояния функции

Убедитесь, что функция простого единого входа по-прежнему **включена** в клиенте. Можно проверить состояние, перейдя в область **Azure AD Connect** в [центре администрирования Azure Active Directory](https://aad.portal.azure.com/).

![Центр администрирования Active Directory Azure — область "Azure AD Connect"](./media/active-directory-aadconnect-sso/sso10.png)

С помощью мыши просмотрите все леса AD, которые были настроены для использования простого единого входа.

![Центр администрирования Azure Active Directory — область простого единого входа](./media/active-directory-aadconnect-sso/sso13.png)

## <a name="sign-in-failure-reasons-in-the-azure-active-directory-admin-center-needs-a-premium-license"></a>Причины сбоя единого входа в центре администрирования Azure Active Directory (требуется лицензия Premium)

Если к клиенту привязана лицензия Azure AD Premium, вы можете также изучить [отчет о действиях при входе](../active-directory-reporting-activity-sign-ins.md) в [центре администрирования Azure Active Directory](https://aad.portal.azure.com/).

![Центр администрирования Azure Active Directory — отчет о действиях входа](./media/active-directory-aadconnect-sso/sso9.png)

Перейдите в раздел **Azure Active Directory** > **Вход в систему** в [центре администрирования Azure Active Directory](https://aad.portal.azure.com/) и щелкните конкретное действие входа пользователя. Найдите поле **КОД ОШИБКИ ВХОДА**. Сопоставьте значение этого поля c причиной сбоя и способом разрешения с помощью следующей таблицы.

|Код ошибки входа|Причина ошибки входа|Способы устранения:
| --- | --- | ---
| 81001 | Билет Kerberos пользователя слишком большой. | Сократите список членства пользователя в группах и повторите попытку.
| 81002 | Не удалось проверить билет Kerberos пользователя. | Изучите [контрольный список по устранению неполадок](#troubleshooting-checklist).
| 81003 | Не удалось проверить билет Kerberos пользователя. | Изучите [контрольный список по устранению неполадок](#troubleshooting-checklist).
| 81004 | Проверка подлинности Kerberos завершилась сбоем. | Изучите [контрольный список по устранению неполадок](#troubleshooting-checklist).
| 81008 | Не удалось проверить билет Kerberos пользователя. | Изучите [контрольный список по устранению неполадок](#troubleshooting-checklist).
| 81009 | Не удалось проверить билет Kerberos пользователя. | Изучите [контрольный список по устранению неполадок](#troubleshooting-checklist).
| 81010 | Не удалось выполнить простой единый вход, так как срок действия билета Kerberos пользователя истек или этот билет недопустим. | Пользователю следует войти с устройства, присоединенного к домену, в корпоративной сети.
| 81011 | Не удалось найти объект-пользователь на основе сведений в билете Kerberos пользователя. | Используйте Azure AD Connect для синхронизации сведений о пользователе с Azure AD.
| 81012 | Пользователь, пытающийся выполнить вход в Azure AD, и пользователь устройства отличаются. | Пользователю нужно войти с другого устройства.
| 81013 | Не удалось найти объект-пользователь на основе сведений в билете Kerberos пользователя. |Используйте Azure AD Connect для синхронизации сведений о пользователе с Azure AD. 

## <a name="troubleshooting-checklist"></a>Контрольный список по устранению неполадок

Используйте следующий контрольный список для устранения неполадок простого единого входа.

- Проверьте, включена ли функция простого единого входа в Azure AD Connect. Если функцию не удается включить (например, из-за заблокированного порта), обеспечьте соблюдение всех [предварительных требований](active-directory-aadconnect-sso-quick-start.md#step-1-check-the-prerequisites).
- Если вы включили и [присоединение к Azure AD](../active-directory-azureadjoin-overview.md), и эффективный единый вход для клиента, убедитесь, что проблема не связана с присоединением к Azure AD. Единый вход при присоединении Azure AD имеет приоритет над эффективным единым входом, если устройство зарегистрировано в Azure AD и присоединено к домену. При едином входе с присоединением к Azure AD отображается плитка входа с надписью "Подключено к Windows".
- Убедитесь, что URL-адрес Azure AD (https://autologon.microsoftazuread-sso.com) указан в параметрах зоны интрасети пользователя.
- Убедитесь, что корпоративное устройство присоединено к домену Active Directory.
- Убедитесь, что пользователь вошел в систему с этого устройства с помощью доменной учетной записи Active Directory.
- Убедитесь, что учетная запись пользователя относится к лесу Active Directory, в котором настроен простой единый вход.
- Убедитесь, что устройство подключено к корпоративной сети.
- Убедитесь, что время на устройстве синхронизировано с временем в Active Directory и на контроллерах доменов, и что разница между временем на контроллерах домена не превышает пяти минут.
- Выведите список билетов Kerberos на устройстве с помощью команды `klist` из командной строки. Убедитесь в наличии билетов, выданных для учетной записи компьютера `AZUREADSSOACCT`. Билеты Kerberos пользователей обычно действительны в течение 10 часов. В Active Directory могут быть заданы другие параметры.
- Если отключить и повторно включить эффективный единый вход для клиента, пользователи не смогут применять единый вход, пока не истечет срок действия их кэшированных билетов Kerberos.
- Удалите имеющиеся билеты Kerberos с устройства с помощью команды `klist purge` и повторите попытку.
- Чтобы определить наличие проблем, связанных с JavaScript, просмотрите журналы консоли из браузера (в разделе **Средства разработчика**).
- Просмотрите [журналы контроллеров домена](#domain-controller-logs).

### <a name="domain-controller-logs"></a>Журналы контроллеров домена

Если на контроллере домена включен аудит успешных попыток, то каждый раз, когда пользователь входит в систему с использованием простого единого входа, в журнал событий заносится запись безопасности. Эти события безопасности можно найти с помощью приведенного ниже запроса. (Найдите событие **4769**, связанное с учетной записью компьютера **AzureADSSOAcc$**.)

```
    <QueryList>
      <Query Id="0" Path="Security">
    <Select Path="Security">*[EventData[Data[@Name='ServiceName'] and (Data='AZUREADSSOACC$')]]</Select>
      </Query>
    </QueryList>
```

## <a name="manual-reset-of-the-feature"></a>Ручной сброс функции

Если устранение неполадок не помогло, можно сбросить вручную эту функцию на клиенте. Выполните следующие действия на локальном сервере, на котором выполняется Azure AD Connect.

### <a name="step-1-import-the-seamless-sso-powershell-module"></a>Шаг 1. Импортируйте модуль PowerShell для простого единого входа

1. Скачайте и установите [помощник по входу в Microsoft Online Services](http://go.microsoft.com/fwlink/?LinkID=286152).
2. Скачайте и установите [64-разрядную версию модуля Azure Active Directory для Windows PowerShell](http://go.microsoft.com/fwlink/p/?linkid=236297).
3. Перейдите в папку `%programfiles%\Microsoft Azure Active Directory Connect`.
4. Импортируйте модуль PowerShell для простого единого входа с помощью следующей команды: `Import-Module .\AzureADSSO.psd1`.

### <a name="step-2-get-the-list-of-active-directory-forests-on-which-seamless-sso-has-been-enabled"></a>Шаг 2. Получение списка лесов Active Directory, для которых включен простой единый вход

1. Откройте сеанс PowerShell от имени администратора. В PowerShell вызовите `New-AzureADSSOAuthenticationContext`. При запросе введите учетные данные глобального администратора своего клиента.
2. Вызовите `Get-AzureADSSOStatus`. Эта команда выводит список лесов Active Directory (см. список "Домены"), в которых включена эта функция.

### <a name="step-3-disable-seamless-sso-for-each-active-directory-forest-where-youve-set-up-the-feature"></a>Шаг 3. Отключение простого единого входа для каждого леса Active Directory, в котором настроена эта функция

1. Вызовите `$creds = Get-Credential`. При запросе введите свои учетные данные администратора домена для нужного леса Active Directory.
2. Вызовите `Disable-AzureADSSOForest -OnPremCredentials $creds`. Эта команда удаляет учетную запись компьютера `AZUREADSSOACCT` с локального контроллера домена для конкретного леса Active Directory.
3. Повторите предыдущие шаги для каждого леса Active Directory, в котором настроена эта функция.

### <a name="step-4-enable-seamless-sso-for-each-active-directory-forest"></a>Шаг 4. Включение простого единого входа для каждого леса Active Directory

1. Вызовите `Enable-AzureADSSOForest`. При запросе введите свои учетные данные администратора домена для нужного леса Active Directory.
2. Повторите предыдущие шаги для каждого леса Active Directory, в котором должна быть настроена эта функция.

### <a name="step-5-enable-the-feature-on-your-tenant"></a>Шаг 5. Включить функцию в своем клиенте

Чтобы включить эту функцию в клиенте, вызовите `Enable-AzureADSSO` и введите **true** в командной строке `Enable:`.
