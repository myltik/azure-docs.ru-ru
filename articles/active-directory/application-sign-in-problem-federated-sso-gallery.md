---
title: Проблемы с входом в приложение из коллекции, для которого настроен федеративный единый вход | Документы Майкрософт
description: Рекомендации по конкретным ошибкам при входе в приложение, для которого настроен федеративный единый вход на базе SAML с помощью Azure AD
services: active-directory
documentationcenter: ''
author: ajamess
manager: mtillman
ms.assetid: ''
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: asteen
ms.openlocfilehash: fa1387c3eb11899bb74418b2ff1af4a5d22a73d9
ms.sourcegitcommit: 59914a06e1f337399e4db3c6f3bc15c573079832
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/20/2018
ms.locfileid: "29384843"
---
# <a name="problems-signing-in-to-a-gallery-application-configured-for-federated-single-sign-on"></a>Проблемы с входом в приложение из коллекции, для которого настроен федеративный единый вход

Чтобы устранить проблему, нужно проверить конфигурации приложения в Azure AD следующим образом:

-   Выполнены все действия по настройке для приложения из коллекции Azure.

-   Идентификатор и URL-адрес ответа, настроенные в AAD, совпадают с ожидаемыми значениями в приложении.

-   Для приложения назначены пользователи.

## <a name="application-not-found-in-directory"></a>Приложение не найдено в каталоге

*Ошибка AADSTS70001: приложение с идентификатором "https://contoso.com" не найдено в каталоге*.

**Возможная причина**

Атрибут Issuer, отправляемый из приложения в Azure AD в запросе SAML, не соответствует значению идентификатора, настроенному в приложении Azure AD.

**Способы устранения:**

Убедитесь, что атрибут Issuer в запросе SAML совпадает со значением идентификатора, настроенным в Azure AD:

1.  Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор** или **соадминистратор**.

2.  Откройте **расширение Azure Active Directory**, щелкнув **Все службы** в верхней части главного меню навигации слева.

3.  В поле фильтра поиска введите **Azure Active Directory** и выберите элемент **Azure Active Directory**.

4.  В меню навигации Azure Active Directory слева выберите **Корпоративные приложения**.

5.  Щелкните **Все приложения**, чтобы открыть полный список приложений.

  * Если нужное приложение отсутствует в списке, в верхней части списка **Все приложения** воспользуйтесь элементом управления **Фильтр**, указав в нем для параметра **Показать** значение **Все приложения**.

6.  Выберите приложение, для которого нужно настроить единый вход.

7.  После загрузки приложения выберите пункт **Единый вход** в меню навигации этого приложения слева.

8.  Перейдите в раздел **Домены и URL-адреса приложения**. Убедитесь, что значение в поле "Идентификатор" совпадает со значением идентификатора в сообщении об ошибке.

После обновления значения идентификатора в Azure AD, чтобы его подходящее значение отправлялось приложением в запросе SAML, вход в приложение должен заработать.

## <a name="the-reply-address-does-not-match-the-reply-addresses-configured-for-the-application"></a>Адрес ответа не соответствует адресам ответа, настроенным для приложения.

*Ошибка AADSTS50011: адрес ответа "https://contoso.com" не соответствует адресам ответа, настроенным для приложения*.

**Возможная причина**

Значение AssertionConsumerServiceURL в запросе SAML не соответствует значению URL-адреса ответа или шаблону, настроенному в Azure AD. Значение AssertionConsumerServiceURL в запросе SAML является URL-адресом, отображаемым в сообщении об ошибке.

**Способы устранения:**

Проверьте, что значение AssertionConsumerServiceURL в запросе SAML соответствует значению URL-адреса ответа, настроенному в Azure AD.

1.  Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор** или **соадминистратор**.

2.  Откройте **расширение Azure Active Directory**, щелкнув **Все службы** в верхней части главного меню навигации слева.

3.  В поле фильтра поиска введите **Azure Active Directory** и выберите элемент **Azure Active Directory**.

4.  В меню навигации Azure Active Directory слева выберите **Корпоративные приложения**.

5.  Щелкните **Все приложения**, чтобы открыть полный список приложений.

  * Если нужное приложение отсутствует в списке, в верхней части списка **Все приложения** воспользуйтесь элементом управления **Фильтр**, указав в нем для параметра **Показать** значение **Все приложения**.

6.  Выберите приложение, для которого нужно настроить единый вход.

7.  После загрузки приложения выберите пункт **Единый вход** в меню навигации этого приложения слева.

8.  Перейдите в раздел **Домены и URL-адреса приложения**. Проверьте или измените значение в текстовом поле "URL-адрес ответа" в соответствии со значением AssertionConsumerServiceURL в запросе SAML.  
    * Если текстовое поле "URL-адрес ответа" не отображается, установите флажок **Показывать дополнительные параметры URL-адреса**.

После обновления значения URL-адреса ответа в Azure AD, чтобы его подходящее значение отправлялось приложением в запросе SAML, вход в приложение должен заработать.

## <a name="user-not-assigned-a-role"></a>Не назначена роль пользователя

*Ошибка AADSTS50105: выполнившему вход пользователю "brian@contoso.com" не назначена роль для приложения*.

**Возможная причина**

Пользователю не предоставлен доступ к приложению в Azure AD.

**Способы устранения:**

Чтобы напрямую назначить одного или нескольких пользователей для приложения, выполните указанные ниже действия.

1.  Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор**.

2.  Откройте **расширение Azure Active Directory**, щелкнув **Все службы** в верхней части главного меню навигации слева.

3.  В поле фильтра поиска введите **Azure Active Directory** и выберите элемент **Azure Active Directory**.

4.  В меню навигации Azure Active Directory слева выберите **Корпоративные приложения**.

5.  Щелкните **Все приложения**, чтобы открыть полный список приложений.

  * Если нужное приложение отсутствует в списке, в верхней части списка **Все приложения** воспользуйтесь элементом управления **Фильтр**, указав в нем для параметра **Показать** значение **Все приложения**.

6.  Выберите из списка приложение, которое необходимо назначить пользователю.

7.  После загрузки приложения в меню навигации слева щелкните **Пользователи и группы**.

8.  В верхней части списка **Пользователи и группы** нажмите кнопку **Добавить**, чтобы открыть область **Добавление назначения**.

9.  В области **Добавление назначения** щелкните **Пользователи и группы**.

10. В поле поиска **Поиск по имени или адресу электронной почты** введите **полное имя** или **адрес электронной почты** пользователя, которого требуется назначить.

11. Наведите указатель мыши на **пользователя** в списке, чтобы отобразить **флажок**. Чтобы добавить пользователя в список **Выбрано**, установите флажок рядом с фотографией или логотипом профиля этого пользователя.

12. **Необязательно.** Если вы хотите **добавить более одного пользователя**, в поле **Поиск по имени или адресу электронной почты** введите **полное имя** или **адрес электронной почты** другого пользователя и установите флажок, чтобы добавить этого пользователя в список **Выбрано**.

13. Выбрав всех пользователей, щелкните **Выбрать**, чтобы добавить их в список пользователей и групп, которые будут назначены для приложения.

14. **Необязательно.** В области **Добавление назначения** щелкните **Выбор ролей**, чтобы выбрать роль, которая будет назначена указанным пользователям.

15. Нажмите кнопку **Назначить**, чтобы назначить приложение выбранным пользователям.

Через некоторое время выбранные пользователи смогут запускать эти приложения с помощью методов, приведенных в описании решения.

## <a name="not-a-valid-saml-request"></a>Недопустимый запрос SAML

*Ошибка AADSTS75005: запрос не является допустимым сообщением протокола Saml2*.

**Возможная причина**

Azure AD не поддерживает запрос SAML, отправленный приложением для единого входа. К наиболее распространенным проблемам относятся:

-   Отсутствие обязательных полей в запросе SAML

-   Метод кодировки запроса SAML

**Способы устранения:**

1.  Захватите запрос SAML. Сведения о захвате запроса SAML см. в учебнике [Отладка единого входа на основе SAML в приложения в Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/active-directory-saml-debugging).

2.  Свяжитесь с разработчиком приложения и передайте ему следующее:

   -   Запрос SAML

   -   [Требования к протоколу SAML единого входа в Azure](https://docs.microsoft.com/azure/active-directory/develop/active-directory-single-sign-on-protocol-reference)

Он должен проверить, поддерживается ли в Azure AD реализация единого входа на базе SAML.

## <a name="no-resource-in-requiredresourceaccess-list"></a>Нет ресурсов в списке requiredResourceAccess

*Ошибка AADSTS65005: клиентское приложение запросило доступ к ресурсу "00000002-0000-0000-c000-000000000000". Этот запрос не выполнен, так как клиент не указал данный ресурс в своем списке requiredResourceAccess*.

**Возможная причина**

Поврежден объект приложения.

**Решение. Вариант 1**

Чтобы решить проблему, добавьте уникальное значение идентификатора в конфигурацию Azure AD. Чтобы добавить значение идентификатора, сделайте следующее:

1.  Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор** или **соадминистратор**.

2.  Откройте **расширение Azure Active Directory**, щелкнув **Все службы** в верхней части главного меню навигации слева.

3.  В поле фильтра поиска введите **Azure Active Directory** и выберите элемент **Azure Active Directory**.

4.  В меню навигации Azure Active Directory слева выберите **Корпоративные приложения**.

5.  Щелкните **Все приложения**, чтобы открыть полный список приложений.

  * Если нужное приложение отсутствует в списке, воспользуйтесь элементом управления **Фильтр** в верхней части списка **Все приложения**, указав в нем для параметра **Показать** значение **Все приложения**.

6.  Выберите приложение, для которого был настроен единый вход.

7.  После загрузки приложения выберите пункт **Единый вход** в меню навигации этого приложения слева.

8.  В разделе **Домен и URL-адрес** установите флажок **Показывать дополнительные параметры URL-адреса**.

9.  В текстовом поле **Идентификатор** введите уникальный идентификатор для приложения.

10. Нажмите кнопку **Сохранить**, чтобы сохранить конфигурацию.


**Решение. Вариант 2**

Если приведенный выше вариант 1 не работает, попробуйте удалить приложение из каталога. После этого добавьте и перенастройте его, следуя указанным ниже действиям:

1.  Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор** или **соадминистратор**.

2.  Откройте **расширение Azure Active Directory**, щелкнув **Все службы** в верхней части главного меню навигации слева.

3.  В поле фильтра поиска введите **Azure Active Directory** и выберите элемент **Azure Active Directory**.

4.  В меню навигации Azure Active Directory слева выберите **Корпоративные приложения**.

5.  Щелкните **Все приложения**, чтобы открыть полный список приложений.

  * Если нужное приложение отсутствует в списке, в верхней части списка **Все приложения** воспользуйтесь элементом управления **Фильтр**, указав в нем для параметра **Показать** значение **Все приложения**.

6.  Выберите приложение, для которого нужно настроить единый вход.

7.  Щелкните **Удалить** слева в верхней части области **Обзор** для приложения.

8.  Обновите Azure AD и добавьте приложение из коллекции Azure AD. После этого настройте приложение.

<span id="_Hlk477190176" class="anchor"></span>После повторной настройки приложения вход в него должен заработать.

## <a name="certificate-or-key-not-configured"></a>Не настроен сертификат или ключ

*Ошибка AADSTS50003: не настроен ключ подписывания*.

**Возможная причина**

Поврежден объект приложения, и Azure AD не распознает сертификат, настроенный для приложения.

**Способы устранения:**

Чтобы удалить и создать сертификат, выполните следующие действия:

1.  Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор** или **соадминистратор**.

2.  Откройте **расширение Azure Active Directory**, щелкнув **Все службы** в верхней части главного меню навигации слева.

3.  В поле фильтра поиска введите **Azure Active Directory** и выберите элемент **Azure Active Directory**.

4.  В меню навигации Azure Active Directory слева выберите **Корпоративные приложения**.

5.  Щелкните **Все приложения**, чтобы открыть полный список приложений.

 * Если нужное приложение отсутствует в списке, в верхней части списка **Все приложения** воспользуйтесь элементом управления **Фильтр**, указав в нем для параметра **Показать** значение **Все приложения**.

6.  Выберите приложение, для которого нужно настроить единый вход.

7.  После загрузки приложения выберите пункт **Единый вход** в меню навигации этого приложения слева.

8.  В разделе **Сертификат подписи SAML** щелкните **Создать сертификат**.

9.  Выберите срок действия. Нажмите кнопку **Сохранить**.

10. Установите флажок **Сделать сертификат активным**, чтобы переопределить активный сертификат. Нажмите кнопку **Сохранить** в верхней части области и активируйте сертификат возобновления.

11. В разделе **Сертификат подписи SAML** щелкните **Удалить**, чтобы удалить **неиспользуемый** сертификат.

## <a name="problem-when-customizing-the-saml-claims-sent-to-an-application"></a>Проблема при настройке утверждений SAML, отправляемых в приложение

Чтобы узнать, как настроить утверждения атрибута SAML, отправляемые в приложение, ознакомьтесь с разделом [Сопоставление утверждений в Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-claims-mapping).

## <a name="next-steps"></a>Дополнительная информация
[Отладка единого входа на основе SAML в приложения в Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/active-directory-saml-debugging)
