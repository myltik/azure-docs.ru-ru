---
title: Руководство по настройке Workday для автоматической подготовки пользователей с помощью Azure Active Directory | Документация Майкрософт
description: Узнайте, как использовать Workday в качестве источника данных удостоверений для Active Directory и Azure Active Directory.
services: active-directory
author: asmalser-msft
documentationcenter: na
manager: mtillman
ms.assetid: 1a2c375a-1bb1-4a61-8115-5a69972c6ad6
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 01/26/2018
ms.author: asmalser
ms.openlocfilehash: b632622868480638174b616780441e13c16a52c0
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
---
# <a name="tutorial-configure-workday-for-automatic-user-provisioning"></a>Руководство по настройке Workday для автоматической подготовки пользователей

Цель этого руководства — показать, какие действия необходимо выполнить для импорта пользователей из Workday в Active Directory и Azure Active Directory с необязательной обратной записью некоторых атрибутов в Workday. 



## <a name="overview"></a>Обзор

Для подготовки учетных записей пользователей [служба подготовки пользователей Azure Active Directory](active-directory-saas-app-provisioning.md) интегрируется с [API отдела кадров Workday](https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Get_Workers.html). Azure AD использует это подключение для включения следующих рабочих процессов подготовки пользователей:

* **Подготовка пользователей в Active Directory** — синхронизация выбранных групп пользователей из Workday в один или несколько лесов Active Directory. 

* **Подготовка только облачных пользователей в Azure Active Directory** — гибридных пользователей, которые существуют в Active Directory и Azure Active Directory, можно подготавливать в Azure Active Directory с помощью [AAD Connect](connect/active-directory-aadconnect.md). Однако подготавливать с помощью службы подготовки пользователей Azure AD непосредственно из Workday в Azure Active Directory можно только облачных пользователей.

* **Обратная запись адресов электронной почты в Workday** — служба подготовки пользователей Azure AD может выполнять обратную запись выбранных атрибутов пользователей Azure AD (например, адрес электронной почты) в Workday.

### <a name="what-human-resources-scenarios-does-it-cover"></a>Для каких сценариев работы отдела кадров это подходит?

Рабочие процессы подготовки пользователей Workday, поддерживаемые службой подготовки пользователей Azure AD, позволяют автоматизировать следующие сценарии работы отдела кадров и управления жизненным циклом удостоверений.

* **Наем новых сотрудников**. При добавлении нового сотрудника в Workday учетная запись пользователя автоматически создается в Active Directory, Azure Active Directory и при необходимости в Office 365 и [других приложениях SaaS, поддерживаемых Azure AD](active-directory-saas-app-provisioning.md) с обратной записью адреса электронной почты в Workday.

* **Обновления атрибута и профиля сотрудника**. При обновлении записи сотрудника в Workday (например, имени, должности или руководителя) его учетная запись пользователя будет автоматически обновлена в Active Directory, Azure Active Directory и при необходимости в Office 365 и [других приложениях SaaS, поддерживаемых Azure AD](active-directory-saas-app-provisioning.md).

* **Увольнения сотрудников**. При увольнении сотрудника в Workday его учетная запись пользователя будет автоматически отключена в Active Directory, Azure Active Directory и при необходимости в Office 365 и [других приложениях SaaS, поддерживаемых Azure AD](active-directory-saas-app-provisioning.md).

* **Повторные наймы сотрудников**. При повторном поступлении сотрудника на работу в Workday его старая учетная запись может быть автоматически активирована повторно или повторно подготовлена (в зависимости от вашего желания) в Active Directory, Azure Active Directory и при необходимости в Office 365 и [других приложениях SaaS, поддерживаемых Azure AD](active-directory-saas-app-provisioning.md).

### <a name="who-is-this-user-provisioning-solution-best-suited-for"></a>Кому это решение подготовки пользователей подходит лучше всего?

Это решение подготовки пользователей в Workday сейчас находится на этапе общедоступной предварительной версии и идеально подходит для:

* организаций, которым необходимо готовое облачное решение для подготовки пользователей в Workday;

* организаций, которым требуется прямая подготовка пользователей из Workday в Active Directory или Azure Active Directory;

* организаций, которым требуется подготавливать пользователей с помощью данных, полученных из модуля HCM Workday (см. раздел об [операции Get_Workers](https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Get_Workers.html)); 

* организаций, которым необходимо синхронизировать процессы присоединения, перемещения и удаления пользователей с одним или несколькими лесами Active Directory, доменами и подразделениями на основе только данных изменений, обнаруженных в модуле HCM Workday (см. раздел об [операции Get_Workers](https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Get_Workers.html));

* организаций, использующих Office 365 для электронной почты.


## <a name="planning-your-solution"></a>Планирование решения

Прежде чем приступить к интеграции Workday, проверьте, выполнены ли указанные ниже предварительные условия, и прочтите следующее руководство о том, как сопоставить текущую архитектуру Active Directory и требования к подготовке пользователей с решениями, предоставляемыми Azure Active Directory.

### <a name="prerequisites"></a>предварительным требованиям

Сценарий, описанный в этом учебнике, предполагает, что у вас уже имеется:

* Действительная подписка AD Premium P1 с правами глобального администратора.
* Клиент реализации Workday для целей тестирования и интеграции.
* Права администратора в Workday для создания пользователя системы интеграции и внесения изменений для проверки данных о сотруднике в целях тестирования.
* Для подготовки пользователей в Active Directory на присоединенном к домену сервере службы Windows 2012 или более поздней версии должен быть размещен [локальный агент синхронизации](https://go.microsoft.com/fwlink/?linkid=847801).
* [Azure AD Connect](connect/active-directory-aadconnect.md) для синхронизации между Active Directory и Azure AD.

### <a name="solution-architecture"></a>Архитектура решения

Azure AD предоставляет широкий набор соединителей подготовки, упрощающих управление подготовкой и жизненным циклом удостоверений из Workday в Active Directory, Azure AD, приложениях SaaS и т. д. Используемые функции и процедура настройки решения будут зависеть от среды и требований вашей организации. Сначала определите количество имеющихся и развернутых компонентов в организации, дав ответы на следующие вопросы.

* Сколько используется лесов Active Directory?
* Сколько используется доменов Active Directory?
* Сколько используется подразделений Active Directory?
* Сколько используется клиентов Azure Active Directory?
* Существуют ли пользователи, которых нужно подготовить в Active Directory и Azure Active Directory (т. е. гибридные пользователи)?
* Существуют ли пользователи, которых нужно подготовить в Azure Active Directory, но не в Active Directory (т. е. только облачные пользователи)?
* Нужно ли выполнить обратную запись адресов электронной почты пользователей в Workday?


Получив ответы на эти вопросы, можно запланировать развертывание подготовки Workday, следуя инструкциям ниже.

#### <a name="using-provisioning-connector-apps"></a>Использование приложения соединителя подготовки

Azure Active Directory поддерживает готовые соединители подготовки для Workday и множества других приложений SaaS. 

Один соединитель подготовки взаимодействует с API одной исходной системой и помогает подготавливать данные в одной целевой системе. Большинство соединителей подготовки, поддерживаемых Azure AD, предназначены для одной исходной и целевой систем (например, Azure AD в ServiceNow) и могут быть настроены путем простого добавления нужного приложения из коллекции приложений Azure AD (например, ServiceNow). 

Между экземплярами соединителя подготовки и экземплярами приложений в Azure AD существует связь "один к одному":

| Исходная система | Целевая система |
| ---------- | ---------- | 
| Клиент Azure AD | Приложение SaaS |


Однако при работе с Workday и Active Directory следует учитывать ряд исходных и целевых систем:

| Исходная система | Целевая система | Заметки |
| ---------- | ---------- | ---------- |
| Workday | Лес Active Directory | Каждый лес обрабатывается как отдельная целевая система. |
| Workday | Клиент Azure AD | Требуется только для облачных пользователей. |
| Лес Active Directory | Клиент Azure AD | Сейчас этот поток обрабатывается AAD Connect. |
| Клиент Azure AD | Workday | Для обратной записи адресов электронной почты. |

Чтобы упростить эти несколько рабочих процессов для нескольких исходных и целевых систем, Azure AD предоставляет ряд приложений соединителей подготовки, которые можно добавлять из коллекции приложений Azure AD.

![Коллекция приложений Azure AD](./media/active-directory-saas-workday-inbound-tutorial/WD_Gallery.PNG)

* **Подготовка Workday в Active Directory** — это приложение упрощает подготовку учетной записи пользователя из Workday в одном лесу Active Directory. Если имеется несколько лесов, можно добавить один экземпляр этого приложения из коллекции приложений Azure AD для каждого леса Active Directory, в котором требуется подготовка.

* **Подготовка Workday в Azure AD** — так как AAD Connect представляет собой инструмент, который должен использоваться для синхронизации пользователей Active Directory с Azure Active Directory, это приложение можно применять для упрощения подготовки только облачных пользователей из Workday в одном клиенте Azure Active Directory.

* **Обратная запись Workday** — это приложение упрощает обратную запись адресов электронной почты пользователей из Azure Active Directory в Workday.

> [!TIP]
> Стандартное приложение Workday используется для настройки единого входа между Workday и Azure Active Directory. 

В оставшихся разделах этого руководства рассматриваются процедуры установки и настройки этих специальных приложений соединителей подготовки. Выбор приложений, которые требуется настроить, будет зависеть от того, в каких системах необходимо выполнить подготовку, и сколько лесов Active Directory и клиентов Azure AD находится в вашей среде.

![Обзор](./media/active-directory-saas-workday-inbound-tutorial/WD_Overview.PNG)

## <a name="configure-a-system-integration-user-in-workday"></a>Настройка пользователя системной интеграции в Workday
Общее требование всех соединителей подготовки Workday состоит в том, что для подключения к API отдела кадров Workday необходимы учетные данные для учетной записи системной интеграции Workday. В этом разделе описывается создание учетной записи системного интегратора в Workday.

> [!NOTE]
> Эту процедуру можно обойти и использовать учетную запись глобального администратора Workday в качестве учетной записи системной интеграции. Такой вариант подойдет для демонстраций, но не рекомендуется для рабочих развертываний.

### <a name="create-an-integration-system-user"></a>Создание пользователя системы интеграции

**Создание пользователя системы интеграции:**

1. Войдите в клиент Workday с помощью учетной записи администратора. В области **Workday Workbench** введите в поле поиска "create user", а затем щелкните ссылку **Create Integration System User** (Создать пользователя системы интеграции). 
   
    ![Создание пользователя](./media/active-directory-saas-workday-inbound-tutorial/IC750979.png "Создание пользователя")
2. Завершите задачу **Создание пользователя системы интеграции** , указав имя пользователя и пароль для нового пользователя системы интеграции.  
 * Не устанавливайте флажок **Require New Password at Next Sign In** (Запросить новый пароль при следующем входе), так как этот пользователь будет осуществлять вход в систему программными средствами. 
 * Для параметра **Session Timeout Minutes** (Время ожидания сеанса в минутах) оставьте значение по умолчанию 0, что не позволит сеансам пользователя завершаться раньше времени. 
   
    ![Создание пользователя системы интеграции](./media/active-directory-saas-workday-inbound-tutorial/IC750980.png "Создание пользователя системы интеграции")

### <a name="create-a-security-group"></a>Создание группы безопасности
Необходимо создать ничем не ограниченную группу безопасности системы интеграции и назначить ей пользователя.

**Создание группы безопасности:**

1. Введите в поле поиска текст "создать группу безопасности", а затем щелкните **Создать группу безопасности**. 
   
    ![Создание группы безопасности](./media/active-directory-saas-workday-inbound-tutorial/IC750981.png "Создание группы безопасности")
2. Завершите задачу **создания группы безопасности**.  
3. Выберите **Integration System Security Group (Unconstrained)** (Группа безопасности системы интеграции без ограничений) в раскрывающемся списке **Type of Tenanted Security Group** (Тип клиентский группы безопасности).
4. Создайте группу безопасности, в которую явно будут добавлены участники. 
   
    ![Создание группы безопасности](./media/active-directory-saas-workday-inbound-tutorial/IC750982.png "Создание группы безопасности")

### <a name="assign-the-integration-system-user-to-the-security-group"></a>Назначение пользователя системы интеграции группе безопасности

**Назначение пользователя системы интеграции:**

1. Введите в поле поиска текст "изменить группу безопасности", а затем щелкните **Изменить группу безопасности**. 
   
    ![Изменение группы безопасности](./media/active-directory-saas-workday-inbound-tutorial/IC750983.png "Изменение группы безопасности")
2. Найдите и выберите новую группу безопасности интеграции по имени. 
   
    ![Изменение группы безопасности](./media/active-directory-saas-workday-inbound-tutorial/IC750984.png "Изменение группы безопасности")
3. Добавьте нового пользователя системы интеграции в новую группу безопасности. 
   
    ![Группа безопасности системы](./media/active-directory-saas-workday-inbound-tutorial/IC750985.png "Группа безопасности системы")  

### <a name="configure-security-group-options"></a>Настройка параметров группы безопасности
На этом шаге вы предоставите группе безопасности разрешения политики безопасности домена для данных рабочей роли.

**Настройка параметров группы безопасности:**

1. В поле поиска введите **политики безопасности домена**, а затем щелкните ссылку **Domain Security Policies for Functional Area** (Политики безопасности домена для функциональной области).  
   
    ![Политики безопасности домена](./media/active-directory-saas-workday-inbound-tutorial/IC750986.png "Политики безопасности домена")  
2. Найдите систему и выберите функциональную область **Система** .  Последовательно выберите **ОК**.  
   
    ![Политики безопасности домена](./media/active-directory-saas-workday-inbound-tutorial/IC750987.png "Политики безопасности домена")  
3. В списке политик безопасности для функциональной области системы разверните узел **Администрирование безопасности** и выберите политику безопасности домена **External Account Provisioning**.  
   
    ![Политики безопасности домена](./media/active-directory-saas-workday-inbound-tutorial/IC750988.png "Политики безопасности домена")  
4. Нажмите кнопку **Изменить разрешения**, а затем на странице диалогового окна **Изменение разрешений** добавьте новую группу безопасности в список групп безопасности с разрешениями интеграции **Get** и **Put**. 
   
    ![Изменение разрешения](./media/active-directory-saas-workday-inbound-tutorial/IC750989.png "Изменение разрешения")  
    
5. Повторите шаги 1–4 выше для каждой из оставшихся политик безопасности:

| Операция | Политика безопасности домена |
| ---------- | ---------- | 
| Get и Put | Worker Data: Public Worker Reports |
| Get и Put | Worker Data: Work Contact Information |
| Получить | Worker Data: All Positions |
| Получить | Worker Data: Current Staffing Information |
| Получить | Worker Data: Business Title on Worker Profile |
   
    
### <a name="activate-security-policy-changes"></a>Активация изменений политики безопасности

**Активация изменений политики безопасности:**

1. Введите "активировать" в поле поиска и затем нажмите ссылку **Активировать ожидающие изменения политики безопасности**. 
   
    ![Активация](./media/active-directory-saas-workday-inbound-tutorial/IC750992.png "Активация") 
2. Начните выполнять задачу активации ожидающих изменений политики безопасности: введите комментарий для проведения аудита и нажмите кнопку **ОК**. 
   
    ![Активация ожидающих изменений безопасности](./media/active-directory-saas-workday-inbound-tutorial/IC750993.png "Активация ожидающих изменений безопасности")   
3. Завершите задачу на следующем экране, установив флажок **Confirm** (Подтверждаю) и нажав кнопку **ОК**. 
   
    ![Активация ожидающих изменений безопасности](./media/active-directory-saas-workday-inbound-tutorial/IC750994.png "Активация ожидающих изменений безопасности")  

## <a name="configuring-user-provisioning-from-workday-to-active-directory"></a>Настройка подготовки пользователей из Workday в Active Directory
Следуйте этим инструкциям по настройке подготовки учетной записи пользователя из Workday в каждом лесу Active Directory, в котором необходимо выполнить подготовку.

### <a name="planning"></a>Планирование

Перед началом настройки подготовки пользователей в лес Active Directory ответьте на следующие вопросы. Ответы на эти вопросы определяют, как необходимо задать фильтры области и атрибуты сопоставления. 

* **Каких пользователей в Workday нужно подготовить в этот лес Active Directory?**

   * *Пример: пользователи, у которых атрибут "Company" Workday содержит значение "Contoso", а атрибут "Worker_Type" — "Regular"*.

* **Каким образом пользователи направляются в разные подразделения организации (OU)?**

   * *Пример: пользователи направляются в подразделения, соответствующие расположению офиса, как определено в атрибутах "Municipality" и "Country_Region_Reference" Workday*.

* **Как необходимо заполнить следующие атрибуты в Active Directory?**

   * Общее имя (cn)
      * *Пример: используйте значение User_ID Workday, задаваемое отделом кадров*.
      
   * Идентификатор сотрудника (employeeId)
      * *Пример: используйте значение Worker_ID Workday*.
      
   * Имя учетной записи SAM (sAMAccountName)
      * *Пример: используйте значение User_ID Workday, отфильтрованное с помощью выражения подготовки Azure AD для удаления недопустимых символов*.
      
   * Имя участника-пользователя (userPrincipalName)
      * *Пример: используйте значение User_ID Workday с выражением подготовки Azure AD для добавления доменного имени*.

* **Каким образом необходимо сопоставить пользователей Workday и Active Directory?**

  * *Пример: пользователи с определенным значением "Worker_ID" Workday сопоставляются с пользователями Active Directory, у которых "employeeID" имеет то же значение. Если значение Worker_ID не найдено в Active Directory, создайте пользователя.*
  
* **Содержит ли лес Active Directory идентификаторы пользователей, необходимые для работы логики сопоставления?**

  * *Пример: если это новое развертывание Workday, мы настоятельно рекомендуем, предварительно заполнить Active Directory правильными значениями Worker_ID Workday (или значением выбранного уникального идентификатора) с целью максимального упрощения логики сопоставления.*
    
    
### <a name="part-1-adding-the-provisioning-connector-app-and-creating-the-connection-to-workday"></a>Часть 1. Добавление приложения соединителя подготовки и создание подключения к Workday

**Настройка подготовки Workday в Active Directory.**

1.  Перейдите на сайт <https://portal.azure.com>.

2.  В области навигации слева выберите **Azure Active Directory**.

3.  Щелкните **Корпоративные приложения**, а затем — **Все приложения**.

4.  Выберите **Добавить приложение** и выберите категорию **Все**.

5.  Выполните поиск по условию **Подготовка Workday в Active Directory** и добавьте это приложение из коллекции.

6.  После добавления приложения и отображения экрана сведений о приложений выберите **Подготовка**.

7.  Для параметра **Режим подготовки** **к работе** выберите значение **Автоматически**.

8.  В разделе **Учетные данные администратора** заполните поля следующим образом.

   * **Имя пользователя администратора** — введите имя пользователя учетной записи системы интеграции Workday с указанием имени домена клиента. **Оно должно иметь примерно следующий вид: username@contoso4**

   * **Пароль администратора** — введите пароль учетной записи системы интеграции Workday.

   * **URL-адрес клиента** — введите URL-адрес конечной точки веб-служб Workday для вашего клиента. Он должен иметь следующий вид: https://wd3-impl-services1.workday.com/ccx/service/contoso4, где contoso4 заменяется правильным именем клиента, а wd3-impl — правильной строкой среды.

   * **Лес Active Directory** — имя леса Active Directory, возвращаемое командлетом PowerShell Get-ADForest. Как правило, это строка вида: *contoso.com*

   * **Контейнер Active Directory** — введите строку контейнера, содержащую всех пользователей в вашем лесу AD. Пример: *OU=Standard Users,OU=Users,DC=contoso,DC=test*

   * **Адрес электронной почты для уведомлений** — введите адрес электронной почты и установите флажок "send email if failure occurs" (Отправлять по электронной почте в случае сбоя).

   * Нажмите кнопку **Проверить подключение**. Если проверка подключения выполнена успешно, нажмите кнопку **Сохранить** в верхней части. В случае неудачи дважды проверьте правильность учетных данных Workday в приложении Workday. 

![Портал Azure](./media/active-directory-saas-workday-inbound-tutorial/WD_1.PNG)

### <a name="part-2-configure-attribute-mappings"></a>Часть 2. Настройка сопоставлений атрибутов 

В этом разделе вы настроите потоки данных пользователя из Workday в Active Directory.

1.  На вкладке "Подготовка" в разделе **Сопоставления** щелкните **Synchronize Workday Workers to OnPremises** (Синхронизировать работников Workday с локальной средой).

2.  В поле **Область исходного объекта** можно выбрать, какие наборы пользователей в Workday должны учитываться при подготовке в AD, определив набор фильтров на основе атрибутов. Область по умолчанию — "Все пользователи в Workday". Примеры фильтров

   * Пример: охват пользователей с идентификаторами рабочих ролей в диапазоне от 1000000 до 2000000

      * Атрибут: WorkerID

      * Оператор: REGEX Match

      * Значение: (1[0–9][0–9][0–9][0–9][0–9][0–9])

   * Пример: только сотрудники, а не временные работники 

      * Атрибут: EmployeeID

      * Оператор: IS NOT NULL

3.  В поле **Действия с целевыми объектами** можно в глобальном масштабе отфильтровать, какие действия разрешены для выполнения в Active Directory. Самыми распространенными являются **создание** и **обновление**.

4.  В разделе **Сопоставление атрибутов** можно определить, как отдельные атрибуты Workday сопоставляются с атрибутами Active Directory.

5. Щелкните существующее сопоставление атрибута, чтобы его обновить, или **Добавить новое сопоставление** в нижней части экрана, чтобы добавить новые сопоставления. Отдельное сопоставление атрибутов поддерживает следующие свойства:

      * **Тип сопоставления**

         * **Прямой** — записывает значение атрибута Workday без изменений в атрибут AD.

         * **Константа** — записывает статическое постоянное строковое значение в атрибут AD.

         * **Выражение** — позволяет записывать пользовательское значение в атрибут AD на основании одного или нескольких атрибутов Workday. [Дополнительные сведения см. в статье о выражениях](active-directory-saas-writing-expressions-for-attribute-mappings.md).

      * **Исходный атрибут** — атрибут пользователя из Workday. Если нужный вам атрибут отсутствует, см. раздел [Настройка списка атрибутов пользователя Workday](#customizing-the-list-of-workday-user-attributes).

      * **Значение по умолчанию** — необязательно. Если исходный атрибут имеет пустое значение, сопоставление запишет это значение.
            В наиболее распространенной конфигурации это поле остается пустым.

      * **Целевой атрибут** — атрибут пользователя в Active Directory.

      * **Сопоставление объектов с помощью этого атрибута** — должно ли это сопоставление использоваться для уникальной идентификации пользователей между Workday и Active Directory. Как правило, оно задается в поле ИД работника для Workday, который обычно сопоставляется с одним из атрибутов ИД сотрудника в Active Directory.

      * **Приоритет сопоставления** — возможность указания нескольких атрибутов сопоставления. При указании нескольких атрибутов сопоставления они вычисляются в порядке, заданном в этом поле. Как только соответствие найдено, дальнейшие атрибуты сопоставления не вычисляются.

      * **Применить это сопоставление**
       
         * **Всегда** — применить это сопоставление как при создании, так и при обновлении пользователей

         * **Только при создании** — применить это сопоставление только при создании пользователей

6. Чтобы сохранить сопоставления, щелкните **Сохранить** в верхней части раздела "Сопоставление атрибутов".

![Портал Azure](./media/active-directory-saas-workday-inbound-tutorial/WD_2.PNG)

**Ниже приведено несколько примеров сопоставлений атрибутов между Workday и Active Directory с некоторыми общими выражениями**.

-   Выражение, которое сопоставляется с атрибутом parentDistinguishedName, используется для подготовки пользователей для разных подразделений на основе одного или нескольких исходных атрибутов Workday. В этом примере пользователи помещаются в разные подразделения в зависимости от города, в котором они находятся.

-   Атрибут userPrincipalName в Active Directory создается путем объединения идентификатора пользователя Workday с суффиксом домена.

-   [Документацию о написании выражений см. здесь](active-directory-saas-writing-expressions-for-attribute-mappings.md). Сюда входят примеры, демонстрирующие удаление специальных символов.

  
| АТРИБУТ WORKDAY | АТРИБУТ ACTIVE DIRECTORY |  ИДЕНТИФИКАТОР СОПОСТАВЛЕНИЯ? | СОЗДАНИЕ ИЛИ ОБНОВЛЕНИЕ |
| ---------- | ---------- | ---------- | ---------- |
| **WorkerID**  |  EmployeeID | **Да** | Записывается только при создании | 
| **UserID**    |  cn    |   |   Записывается только при создании |
| **Join("@",[UserID], "contoso.com")**   | userPrincipalName     |     | Записывается только при создании 
| **Replace(Mid(Replace(\[UserID\], , "(\[\\\\/\\\\\\\\\\\\\[\\\\\]\\\\:\\\\;\\\\|\\\\=\\\\,\\\\+\\\\\*\\\\?\\\\&lt;\\\\&gt;\])", , "", , ), 1, 20), , "([\\\\.)\*\$](file:///\\.)*$)", , "", , )**      |    sAMAccountName            |     |         Записывается только при создании |
| **Switch(\[Active\], , "0", "True", "1",)** |  accountDisabled      |     | Создание и обновление |
| **FirstName**   | givenName       |     |    Создание и обновление |
| **LastName**   |   sn   |     |  Создание и обновление |
| **PreferredNameData**  |  displayName |     |   Создание и обновление |
| **Company**         | company   |     |  Создание и обновление |
| **SupervisoryOrganization**  | department  |     |  Создание и обновление |
| **ManagerReference**   | manager  |     |  Создание и обновление |
| **BusinessTitle**   |  title     |     |  Создание и обновление | 
| **AddressLineData**    |  streetAddress  |     |   Создание и обновление |
| **Municipality**   |   l   |     | Создание и обновление |
| **CountryReferenceTwoLetter**      |   co |     |   Создание и обновление |
| **CountryReferenceTwoLetter**    |  c  |     |         Создание и обновление |
| **CountryRegionReference** |  st     |     | Создание и обновление |
| **WorkSpaceReference** | physicalDeliveryOfficeName    |     |  Создание и обновление |
| **PostalCode**  |   postalCode  |     | Создание и обновление |
| **PrimaryWorkTelephone**  |  TelephoneNumber   |     | Создание и обновление |
| **Fax**      | facsimileTelephoneNumber     |     |    Создание и обновление |
| **Mobile**  |    mobile       |     |       Создание и обновление |
| **LocalReference** |  preferredLanguage  |     |  Создание и обновление |                                               
| **Switch(\[Municipality\], "OU=Standard Users,OU=Users,OU=Default,OU=Locations,DC=contoso,DC=com", "Dallas", "OU=Standard Users,OU=Users,OU=Dallas,OU=Locations,DC=contoso,DC=com", "Austin", "OU=Standard Users,OU=Users,OU=Austin,OU=Locations,DC=contoso,DC=com", "Seattle", "OU=Standard Users,OU=Users,OU=Seattle,OU=Locations,DC=contoso,DC=com", “London", "OU=Standard Users,OU=Users,OU=London,OU=Locations,DC=contoso,DC=com")**  | parentDistinguishedName     |     |  Создание и обновление |
  
### <a name="part-3-configure-the-on-premises-synchronization-agent"></a>Часть 3. Настройка локального агента синхронизации

Для подготовки в локальной среде Active Directory необходимо установить агент на присоединенном к домену сервере в требуемом лесу Active Directory. Для выполнения этой процедуры требуются учетные данные администратора домена или администратора предприятия.

**[Локальный агент синхронизации можно скачать здесь](https://go.microsoft.com/fwlink/?linkid=847801)**.

После установки агента выполните приведенные ниже команды Powershell, чтобы настроить агент для вашей среды.

**Команда 1**

> cd "C:\Program Files\Microsoft Azure AD Connect Provisioning Agent\Modules\AADSyncAgent" Agent\\Modules\\AADSyncAgent

> Import-Module "C:\Program Files\Microsoft Azure AD Connect Provisioning Agent\Modules\AADSyncAgent\AADSyncAgent.psd1"

**Команда 2**

> Add-ADSyncAgentActiveDirectoryConfiguration

* Входные данные: для параметра "Имя каталога" введите имя леса AD, как введено в части \#2.
* Входные данные: имя и пароль администратора для леса Active Directory.

**Команда 3**

> Add-ADSyncAgentAzureActiveDirectoryConfiguration

* Входные данные: имя и пароль глобального администратора для вашего клиента Azure AD.

>[!IMPORTANT]
>В настоящее время существует известная проблема, когда учетные данные глобального администратора не работают, если в них используется личный домен (например, admin@contoso.com). В качестве обходного пути создайте и используйте учетную запись глобального администратора с доменом onmicrosoft.com (например, admin@contoso.onmicrosoft.com)

>[!IMPORTANT]
>В настоящее время существует известная проблема, когда учетные данные глобального администратора не работают, если для них включена многофакторная проверка подлинности. Чтобы избежать этого, отключите многофакторную проверку подлинности для глобального администратора.


**Команда 4**

> Get-AdSyncAgentProvisioningTasks

* Действие: проверка возвращения данных. Эта команда автоматически обнаруживает приложения подготовки Workday в клиенте Azure AD. Выходные данные примера:

> Name: My AD Forest
>
> Enabled: True
>
> DirectoryName: mydomain.contoso.com
>
> Credentialed: False
>
> Identifier: WDAYdnAppDelta.c2ef8d247a61499ba8af0a29208fb853.4725aa7b-1103-41e6-8929-75a5471a5203

**Команда 5**

> Start-AdSyncAgentSynchronization -Automatic

**Команда 6**

> net stop aadsyncagent

**Команда 7**

> net start aadsyncagent

>[!TIP]
>Помимо команды "net" в PowerShell, служба агента синхронизации также может быть запущена и остановлена с помощью **Services.msc**. Если при выполнении команд PowerShell возникают ошибки, убедитесь, что **агент подготовки Microsoft Azure AD Connect** запущен в **Services.msc**.

![Службы](./media/active-directory-saas-workday-inbound-tutorial/Services.png)  

**Дополнительная настройка для клиентов из стран Европейского Союза**

Если клиент Azure Active Directory находится в одном из центров обработки данных ЕС, выполните следующие дополнительные шаги.

1. Откройте **Services.msc** и остановите службу **агента подготовки Microsoft Azure AD Connect**.
2. Перейдите в папку установки агента (например, C:\Program Files\Microsoft Azure AD Connect Provisioning Agent).
3. Откройте файл **SyncAgnt.exe.config** в текстовом редакторе.
4. Замените https://manage.hub.syncfabric.windowsazure.com/Management на **https://eu.manage.hub.syncfabric.windowsazure.com/Management**.
5. Замените https://provision.hub.syncfabric.windowsazure.com/Provisioning на **https://eu.provision.hub.syncfabric.windowsazure.com/Provisioning**.
6. Сохраните файл **SyncAgnt.exe.config**.
7. Откройте **Services.msc** и запустите службу **агента подготовки Microsoft Azure AD Connect**.

**Устранение неполадок агента**

[Журнал событий Windows](https://technet.microsoft.com/library/cc722404(v=ws.11).aspx) на компьютере Windows Server с агентом содержит события всех операций, выполняемых агентом. Чтобы просмотреть эти события:
    
1. Откройте файл **Eventvwr.msc**.
2. Выберите **Журналы Windows > Приложение**.
3. Просмотрите все события, зарегистрированные для источника **AADSyncAgent**. 
4. Проверьте наличие ошибок и предупреждений.

Если возникла проблема с разрешениями учетных данных Active Directory или Azure Active Directory, содержащимися в командах PowerShell, вы увидите следующую ​​ошибку: 
    
![Журналы событий](./media/active-directory-saas-workday-inbound-tutorial/Windows_Event_Logs.png) 


### <a name="part-4-start-the-service"></a>Часть 4. Запуск службы
После завершения частей 1–3 можно запустить службу подготовки на портале Azure.

1.  На вкладке **Подготовка** установите для параметра **Состояние подготовки** значение **Вкл**.

2. Выберите команду **Сохранить**.

3. Будет запущена начальная синхронизация, которая может длиться переменное число часов в зависимости от количества пользователей в Workday.

4. В любой момент можно проверить вкладку **Журналы аудита** на портале Azure, чтобы узнать, какие действия выполнила служба подготовки. В журналах аудита перечислены все отдельные события синхронизации, выполняемые службой подготовки, например, какие пользователи считываются из Workday и впоследствии будут добавлены или обновлены в Active Directory. **[Подробные инструкции о том, как читать журналы аудита, см. в руководстве об отчетах по подготовке](active-directory-saas-provisioning-reporting.md)**.

5.  Проверьте [журнал событий Windows](https://technet.microsoft.com/library/cc722404(v=ws.11).aspx) на компьютере Windows Server с установленным агентом на наличие новых ошибок и предупреждений. Эти события можно просмотреть, запустив **Eventvwr.msc** на сервере и выбрав **Журналы Windows > Приложение**. Все сообщения, относящиеся к подготовке, записываются для источника **AADSyncAgent**. 
    

6. После завершения на вкладке **Подготовка** будет создан сводный отчет аудита, как показано ниже.

![Портал Azure](./media/active-directory-saas-workday-inbound-tutorial/WD_3.PNG)


## <a name="configuring-user-provisioning-to-azure-active-directory"></a>Настройка подготовки пользователей в Active Directory
Настройка подготовки в Azure Active Directory будет зависеть от требований к подготовке, как описано в следующей таблице.

| Сценарий | Решение |
| -------- | -------- |
| **Необходимо подготовить пользователей в Active Directory и Azure AD** | Используйте **[AAD Connect](connect/active-directory-aadconnect.md)**. |
| **Необходимо подготовить пользователей только в Active Directory** | Используйте **[AAD Connect](connect/active-directory-aadconnect.md)**. |
| **Необходимо подготовить пользователей только в Azure AD (только в облаке)** | Используйте приложение **Подготовка Workday в Azure Active Directory** из коллекции приложений. |

Инструкции по настройке Azure AD Connect см. в [документации по Azure AD Connect](connect/active-directory-aadconnect.md).

В следующих разделах описана настройка подключения между Workday и Azure AD для подготовки только облачных пользователей.

> [!IMPORTANT]
> Выполните следующую процедуру только в том случае, если существуют только облачные пользователи, которых необходимо подготовить в Azure AD, а не в локальной службе Active Directory.

### <a name="part-1-adding-the-azure-ad-provisioning-connector-app-and-creating-the-connection-to-workday"></a>Часть 1. Добавление приложения соединителя подготовки Azure AD и создание подключения к Workday

**Настройка подготовки только облачных пользователей Workday в Azure Active Directory**

1.  Перейдите на сайт <https://portal.azure.com>.

2.  В области навигации слева выберите **Azure Active Directory**.

3.  Щелкните **Корпоративные приложения**, а затем — **Все приложения**.

4.  Выберите **Добавить приложение**, а затем выберите категорию **Все**.

5.  Выполните поиск по условию **Подготовка Workday в Azure AD** и добавьте это приложение из коллекции.

6.  После добавления приложения и отображения экрана сведений о приложений выберите **Подготовка**.

7.  Для параметра **Режим подготовки** **к работе** выберите значение **Автоматически**.

8.  В разделе **Учетные данные администратора** заполните поля следующим образом.

   * **Имя пользователя администратора** — введите имя пользователя учетной записи системы интеграции Workday с указанием имени домена клиента. Оно должно иметь примерно следующий вид: username@contoso4

   * **Пароль администратора** — введите пароль учетной записи системы интеграции Workday.

   * **URL-адрес клиента** — введите URL-адрес конечной точки веб-служб Workday для вашего клиента. Он должен иметь следующий вид: https://wd3-impl-services1.workday.com/ccx/service/contoso4, где contoso4 заменяется правильным именем клиента, а wd3-impl — правильной строкой среды. Если этот URL-адрес неизвестен, свяжитесь с вашим партнером по интеграции Workday или представителем службы поддержки, чтобы определить правильный URL-адрес для использования.

   * **Адрес электронной почты для уведомлений** — введите адрес электронной почты и установите флажок "send email if failure occurs" (Отправлять по электронной почте в случае сбоя).

   * Нажмите кнопку **Проверить подключение**.

   * Если проверка подключения выполнена успешно, нажмите кнопку **Сохранить** в верхней части. В случае неудачи дважды проверьте правильность URL-адреса и учетных данных Workday в приложении Workday.


### <a name="part-2-configure-attribute-mappings"></a>Часть 2. Настройка сопоставлений атрибутов 

В этом разделе вы настроите потоки данных пользователя из Workday в Active Directory только для облачных пользователей.

1.  На вкладке "Подготовка" в разделе **Сопоставления** щелкните **Synchronize Workers to Azure AD** (Синхронизировать работников с Azure AD).

2.   В поле **Область исходного объекта** можно выбрать, какие наборы пользователей в Workday должны учитываться при подготовке в Azure AD, определив набор фильтров на основе атрибутов. Область по умолчанию — "Все пользователи в Workday". Примеры фильтров

   * Пример: охват пользователей с идентификаторами рабочих ролей в диапазоне от 1000000 до 2000000

      * Атрибут: WorkerID

      * Оператор: REGEX Match

      * Значение: (1[0–9][0–9][0–9][0–9][0–9][0–9])

   * Пример: только временные работники, а не сотрудники

      * Атрибут: ContingentID

      * Оператор: IS NOT NULL

3.  В поле **Действия с целевыми объектами** можно в глобальном масштабе отфильтровать, какие действия разрешены для выполнения в Azure AD. Самыми распространенными являются **создание** и **обновление**.

4.  В разделе **Сопоставление атрибутов** можно определить, как отдельные атрибуты Workday сопоставляются с атрибутами Active Directory.

5. Щелкните существующее сопоставление атрибута, чтобы его обновить, или **Добавить новое сопоставление** в нижней части экрана, чтобы добавить новые сопоставления. Отдельное сопоставление атрибутов поддерживает следующие свойства:

   * **Тип сопоставления**

      * **Прямой** — записывает значение атрибута Workday без изменений в атрибут AD.

      * **Константа** — записывает статическое постоянное строковое значение в атрибут AD.

      * **Выражение** — позволяет записывать пользовательское значение в атрибут AD на основании одного или нескольких атрибутов Workday. [Дополнительные сведения см. в статье о выражениях](active-directory-saas-writing-expressions-for-attribute-mappings.md).

   * **Исходный атрибут** — атрибут пользователя из Workday. Если нужный вам атрибут отсутствует, см. раздел [Настройка списка атрибутов пользователя Workday](#customizing-the-list-of-workday-user-attributes).

   * **Значение по умолчанию** — необязательно. Если исходный атрибут имеет пустое значение, сопоставление запишет это значение.
            В наиболее распространенной конфигурации это поле остается пустым.

   * **Целевой атрибут** — атрибут пользователя в Azure AD.

   * **Сопоставление объектов с помощью этого атрибута** — должно ли это сопоставление использоваться для уникальной идентификации пользователей между Workday и Azure AD. Как правило, оно задается в поле ИД работника для Workday, который обычно сопоставляется с атрибутом ИД сотрудника (новым) или атрибутом расширения в Azure AD.

   * **Приоритет сопоставления** — возможность указания нескольких атрибутов сопоставления. При указании нескольких атрибутов сопоставления они вычисляются в порядке, заданном в этом поле. Как только соответствие найдено, дальнейшие атрибуты сопоставления не вычисляются.

   * **Применить это сопоставление**

     * **Всегда** — применить это сопоставление как при создании, так и при обновлении пользователей

     * **Только при создании** — применить это сопоставление только при создании пользователей

6. Чтобы сохранить сопоставления, щелкните **Сохранить** в верхней части раздела "Сопоставление атрибутов".

### <a name="part-3-start-the-service"></a>Часть 3. Запуск службы
После завершения частей 1–2 можно запустить службу подготовки.

1.  На вкладке **Подготовка** установите для параметра **Состояние подготовки** значение **Вкл**.

2. Выберите команду **Сохранить**.

3. Будет запущена начальная синхронизация, которая может длиться переменное число часов в зависимости от количества пользователей в Workday.

4. Отдельные события синхронизации можно просмотреть на вкладке **Журналы аудита**. **[Подробные инструкции о том, как читать журналы аудита, см. в руководстве об отчетах по подготовке](active-directory-saas-provisioning-reporting.md)**.

5. После завершения на вкладке **Подготовка** будет создан сводный отчет аудита, как показано ниже.


## <a name="configuring-writeback-of-email-addresses-to-workday"></a>Настройка обратной записи адресов электронной почты в Workday
Ниже приведены инструкции по настройке обратной записи адресов электронной почты пользователей из Azure Active Directory в Workday.

### <a name="part-1-adding-the-provisioning-connector-app-and-creating-the-connection-to-workday"></a>Часть 1. Добавление приложения соединителя подготовки и создание подключения к Workday

**Настройка подготовки Workday в Active Directory.**

1.  Перейдите на сайт <https://portal.azure.com>.

2.  В области навигации слева выберите **Azure Active Directory**.

3.  Щелкните **Корпоративные приложения**, а затем — **Все приложения**.

4.  Выберите **Добавить приложение**, а затем выберите категорию **Все**.

5.  Выполните поиск по условию **Обратная запись Workday** и добавьте это приложение из коллекции.

6.  После добавления приложения и отображения экрана сведений о приложений выберите **Подготовка**.

7.  Для параметра **Режим подготовки** **к работе** выберите значение **Автоматически**.

8.  В разделе **Учетные данные администратора** заполните поля следующим образом.

   * **Имя пользователя администратора** — введите имя пользователя учетной записи системы интеграции Workday с указанием имени домена клиента. Оно должно иметь примерно следующий вид: username@contoso4

   * **Пароль администратора** — введите пароль учетной записи системы интеграции Workday.

   * **URL-адрес клиента** — введите URL-адрес конечной точки веб-служб Workday для вашего клиента. Он должен иметь следующий вид: https://wd3-impl-services1.workday.com/ccx/service/contoso4, где contoso4 заменяется правильным именем клиента, а wd3-impl — правильной строкой среды (если необходимо).

   * **Адрес электронной почты для уведомлений** — введите адрес электронной почты и установите флажок "send email if failure occurs" (Отправлять по электронной почте в случае сбоя).

   * Нажмите кнопку **Проверить подключение**. Если проверка подключения выполнена успешно, нажмите кнопку **Сохранить** в верхней части. В случае неудачи дважды проверьте правильность URL-адреса и учетных данных Workday в приложении Workday.


### <a name="part-2-configure-attribute-mappings"></a>Часть 2. Настройка сопоставлений атрибутов 


В этом разделе вы настроите потоки данных пользователя из Workday в Active Directory.

1.  На вкладке "Подготовка" в разделе **Сопоставления** щелкните **Synchronize Azure AD Users to Workday** (Синхронизировать пользователей Azure AD с Workday).

2.  В поле **Область исходного объекта** при необходимости можно отфильтровать, для каких групп пользователей в Azure Active Directory нужно выполнить обратную запись адресов электронной почты в Workday. Область по умолчанию — "Все пользователи в Azure AD". 

3.  В разделе **Сопоставление атрибутов** можно определить, как отдельные атрибуты Workday сопоставляются с атрибутами Active Directory. По умолчанию задано сопоставление для адреса электронной почты. Тем не менее необходимо обновить ИД сопоставления для обеспечения соответствия пользователей Azure AD их соответствующим записям в Workday. Распространенный метод сопоставления заключается в синхронизации ИД работника или ИД сотрудника Workday с extensionAttribute1-15 в Azure AD. Затем этот атрибут используется в Azure AD для обратного сопоставления пользователей в Workday.

4.  Чтобы сохранить сопоставления, щелкните **Сохранить** в верхней части раздела "Сопоставление атрибутов".

### <a name="part-3-start-the-service"></a>Часть 3. Запуск службы
После завершения частей 1–2 можно запустить службу подготовки.

1.  На вкладке **Подготовка** установите для параметра **Состояние подготовки** значение **Вкл**.

2. Выберите команду **Сохранить**.

3. Будет запущена начальная синхронизация, которая может длиться переменное число часов в зависимости от количества пользователей в Workday.

4. Отдельные события синхронизации можно просмотреть на вкладке **Журналы аудита**. **[Подробные инструкции о том, как читать журналы аудита, см. в руководстве об отчетах по подготовке](active-directory-saas-provisioning-reporting.md)**.

5. После завершения на вкладке **Подготовка** будет создан сводный отчет аудита, как показано ниже.


## <a name="customizing-the-list-of-workday-user-attributes"></a>Настройка списка атрибутов пользователя Workday
Подготовка приложений Workday для Active Directory и Azure AD включает стандартный список атрибутов пользователей Workday, которые вы можете выбирать. Но эти списки не являются исчерпывающими. Приложение Workday поддерживает сотни пользовательских атрибутов, которые могут быть стандартными или уникальными для клиента Workday. 

Служба подготовки Azure AD позволяет настроить список или атрибут Workday, чтобы включить все атрибуты, отображаемые в операции [Get_Workers](https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Get_Workers.html), в API Human Resources.

Для этого используйте [Workday Studio](https://community.workday.com/studio-download) для извлечения выражений XPath, представляющих атрибуты, которые вы хотите использовать. Затем добавьте их в конфигурацию подготовки с помощью расширенного редактора атрибутов на портале Azure.

**Чтобы получить выражение XPath для атрибута пользователя Workday, сделайте следующее:**

1. Скачайте и установите [Workday Studio](https://community.workday.com/studio-download). Вам потребуется учетная запись сообщества Workday для доступа к установщику.

2. Скачайте файл Workday Human_Resources.wdsl по этому URL-адресу: https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Human_Resources.wsdl

3. Запустите Workday Studio.

4. На панели команд выберите **Workday > Test Web Service (Workday > Тестировать веб-службу) в параметре Tester (Тестер)**.

5. Щелкните **External** (Внешний) и выберите WSDL-файл Human_Resources, скачанный на шаге 2.

    ![Workday Studio](./media/active-directory-saas-workday-inbound-tutorial/WDstudio1.PNG)

6. Задайте для поля **Location** (Расположение) значение `https://IMPL-CC.workday.com/ccx/service/TENANT/Human_Resources`. Замените значение IMPL-CC фактическим типом экземпляра и значение TENANT (Клиент) реальным именем клиента.

7. Задайте для параметра **Operation** значение **Get_Workers**.

8.  Щелкните ссылку **configure** (Настроить) под областями Request/Response (Запрос/Ответ), чтобы задать учетные данные Workday. Установите флажок **Authentication** (Аутентификация), а затем введите имя пользователя и пароль учетной записи системы интеграции Workday. Имя пользователя должно иметь формат name@tenant. Оставьте флажок возле параметра **WS-Security UsernameToken**.

    ![Workday Studio](./media/active-directory-saas-workday-inbound-tutorial/WDstudio2.PNG)

9. Нажмите кнопку **ОК**.

10. В области **Request** (Запрос) вставьте XML-код, показанный ниже, и задайте для параметра **Employee_ID** идентификатор сотрудника реального пользователя в клиенте Workday. Выберите пользователя, у которого заполнен атрибут, который вы хотите извлечь.

    ```
    <?xml version="1.0" encoding="UTF-8"?>
    <env:Envelope xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
      <env:Body>
        <wd:Get_Workers_Request xmlns:wd="urn:com.workday/bsvc" wd:version="v21.1">
          <wd:Request_References wd:Skip_Non_Existing_Instances="true">
            <wd:Worker_Reference>
              <wd:ID wd:type="Employee_ID">21008</wd:ID>
            </wd:Worker_Reference>
          </wd:Request_References>
          <wd:Response_Group>
            <wd:Include_Reference>true</wd:Include_Reference>
            <wd:Include_Personal_Information>true</wd:Include_Personal_Information>
            <wd:Include_Employment_Information>true</wd:Include_Employment_Information>
            <wd:Include_Management_Chain_Data>true</wd:Include_Management_Chain_Data>
            <wd:Include_Organizations>true</wd:Include_Organizations>
            <wd:Include_Reference>true</wd:Include_Reference>
            <wd:Include_Transaction_Log_Data>true</wd:Include_Transaction_Log_Data>
            <wd:Include_Photo>true</wd:Include_Photo>
            <wd:Include_User_Account>true</wd:Include_User_Account>
            <wd:Include_Roles>true</wd:Include_Roles>
          </wd:Response_Group>
        </wd:Get_Workers_Request>
      </env:Body>
    </env:Envelope>
    ```
 
11. Нажмите кнопку **Send Request** (Отправить запрос) (с зеленой стрелкой), чтобы выполнить команду. Если команда выполнена успешно, ответ должен отображаться в области **Response** (Ответ). Убедитесь, что ответ содержит данные идентификатора пользователя, которые вы ввели, и не содержит ошибок.

12. Если команда выполнена успешно, скопируйте XML-код из области **Response** (Ответ) и сохраните его как XML-файл.

13. В командной строке Workday Studio выберите **File > Open File** (Файл > Открыть файл) и выберите только что сохраненный XML-файл. Откроется в редакторе XML Workday Studio.

    ![Workday Studio](./media/active-directory-saas-workday-inbound-tutorial/WDstudio3.PNG)

14. В дереве файлов перейдите к файлу **/env:Envelope > env:Body > wd:Get_Workers_Response > wd:Response_Data > wd:Worker**, чтобы найти данные пользователя. 

15. В разделе **wd:Worker** найдите атрибут, который вы хотите добавить, и выберите его.

16. Скопируйте выражение XPath для выбранного атрибута из поля **Document Path** (Путь к документу).

17. Удалите префикс **/env:Envelope/env:Body/wd:Get_Workers_Response/wd:Response_Data/** из скопированного выражения. 

18. Если последний элемент в скопированном выражении является узлом (например, /wd:Birth_Date), добавьте **/text()** в конец выражения. Это необязательно делать, если последний элемент является атрибутом (например, /@wd:type).

19. Результат должен выглядеть приблизительно так: `wd:Worker/wd:Worker_Data/wd:Personal_Data/wd:Birth_Date/text()`. Скопируйте его на портал Azure.


**Чтобы добавить настраиваемый атрибут пользователя Workday в конфигурацию подготовки, сделайте следующее:**

1. Откройте [портал Azure](https://portal.azure.com) и перейдите к разделу "Подготовка" приложения подготовки Workday, как описано ранее в этом руководстве.

2. Задайте для параметра **Состояние подготовки** значение **Выкл.** и нажмите кнопку **Сохранить**. После этих действий внесенные вами изменения вступят в силу, только когда вы закончите процедуру.

3. В разделе **Сопоставления** выберите **Локальная синхронизация сотрудников** или **Синхронизация сотрудников с Azure AD**.

4. Прокрутите вниз до следующего экрана и выберите **Показать расширенные параметры**.

5. Выберите ссылку **Изменить список атрибутов для Workday**.

    ![Workday Studio](./media/active-directory-saas-workday-inbound-tutorial/WDstudio_AAD1.PNG)

6. Прокрутите страницу вниз до списка атрибутов, где находятся поля для заполнения.

7. В поле **Имя** введите отображаемое имя для атрибута.

8. В поле **Тип** выберите тип, соответствующий атрибуту (чаще всего это **строка**).

9. В поле **Выражение API** введите выражение XPath, скопированное из Workday Studio. Пример: `wd:Worker/wd:Worker_Data/wd:Personal_Data/wd:Birth_Date/text()`

10. Нажмите кнопку **Добавить атрибут**.

    ![Workday Studio](./media/active-directory-saas-workday-inbound-tutorial/WDstudio_AAD2.PNG)

11. Нажмите кнопку **Сохранить** выше, а затем — **Да** в диалоговом окне. Закройте экран сопоставления атрибутов, если он еще открыт.

12. Вернитесь на вкладку **Подготовка**. Выберите **Локальная синхронизация сотрудников** или **Синхронизация сотрудников с Azure AD**.

13. Выберите **Добавить новое сопоставление**.

14. Новый атрибут должен появиться в **Атрибут источника**.

15. В случае необходимости добавьте сопоставление для нового атрибута.

16. В конце не забудьте задать для параметра **Состояние подготовки** значение **Вкл.** и сохранить это изменение.


## <a name="known-issues"></a>Известные проблемы

* В настоящее время при выполнении команды PowerShell **Add-ADSyncAgentAzureActiveDirectoryConfiguration** возникает известная проблема, когда учетные данные глобального администратора не работают, если в них используется личный домен (например, admin@contoso.com). В качестве обходного пути создайте и используйте учетную запись глобального администратора Azure AD с доменом onmicrosoft.com (например, admin@contoso.onmicrosoft.com)

* Предыдущая проблема, когда журналы аудита не отображались в клиентах Azure AD, расположенных в Европейском Союзе, устранена. Однако для клиентов Azure AD в ЕС требуется дополнительная настройка агента. Дополнительные сведения см. в разделе [Часть 3. Настройка локального агента синхронизации](#Part 3: Configure the on-premises synchronization agent)

## <a name="gdpr-compliance"></a>Соответствие GDPR

[Общий регламент по защите данных (GDPR)](http://ec.europa.eu/justice/data-protection/reform/index_en.htm) является законом о защите и конфиденциальности данных Европейского союза (ЕС). GDPR устанавливает правила для компаний, правительственных учреждений, некоммерческих организаций и других организаций, которые предлагают товары и услуги жителям государств ЕС или собирают и анализируют связанные с ними данные. 

Служба подготовки Azure AD соответствует требованиям GDPR, как и прочие службы и компоненты Майкрософт. Дополнительные сведения об истории применения GDPR в корпорации Майкрософт приведены в [условиях предоставления услуг](https://www.microsoftvolumelicensing.com/DocumentSearch.aspx?Mode=3&DocumentTypeId=31).

Тем не менее, так как решение для подготовки Workday для Active Directory требует установки агента синхронизации на сервере, присоединенном к домену, нужно также отслеживать соответствие GDPR некоторых событий.
 
Этот агент создает записи в **журнале событий Windows**, которые могут содержать личные сведения.

Соответствие GDPR можно обеспечить двумя способами.

1. Можно по запросу извлекать данные для пользователя и удалять эти данные из журналов событий Windows. 
2. Можно также хранить журналы событий Windows, порожденные процессом AADSyncAgent, в течение 48 часов.

Сведения о том, как настроить хранение данных журналов событий Windows, см. в разделе [Settings for event logs](https://technet.microsoft.com/library/cc952132.aspx) (Параметры журналов событий). Общие сведения о журнале событий Windows см. в [этой статье](https://msdn.microsoft.com/library/windows/desktop/aa385772.aspx).


## <a name="next-steps"></a>Дополнительная информация

* [Сведения о просмотре журналов и получении отчетов о действиях по подготовке](https://docs.microsoft.com/azure/active-directory/active-directory-saas-provisioning-reporting)
* [Узнайте, как настроить единый вход Azure Active Directory в Workday](active-directory-saas-workday-tutorial.md).
* [Узнайте, как интегрировать другие приложения SaaS с Azure Active Directory](active-directory-saas-tutorial-list.md).

