---
title: Как и для чего приложения добавляются в Azure Active Directory
description: Что означает добавление приложения в Azure AD и каким образом это осуществляется?
services: active-directory
documentationcenter: ''
author: CelesteDG
manager: mtillman
editor: ''
ms.assetid: 3321d130-f2a8-4e38-b35e-0959693f3576
ms.service: active-directory
ms.component: develop
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/18/2018
ms.author: celested
ms.custom: aaddev
ms.openlocfilehash: c9ebfcba59e3f46fb30f4cd2402ec4ebb606f6d0
ms.sourcegitcommit: e14229bb94d61172046335972cfb1a708c8a97a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2018
---
# <a name="how-and-why-applications-are-added-to-azure-ad"></a>Как и почему приложения добавляются в Azure AD
Есть два представления приложений в Azure AD: 
* [Объекты приложений](active-directory-application-objects.md#application-object) — их можно считать определением приложения, несмотря на то что есть [исключения](#notes-and-exceptions).
* [Субъекты-службы](active-directory-application-objects.md#service-principal-object) — их можно считать экземпляром приложения. Субъекты-службы обычно ссылаются на объект приложения, а на один объект приложения могут ссылаться несколько субъектов-служб в каталогах.

## <a name="what-are-application-objects-and-where-do-they-come-from"></a>Что такое объекты приложений и откуда они берутся?
[Объекты приложений](active-directory-application-objects.md#application-object) (которыми можно управлять на портале Azure с помощью процедуры [Регистрация приложений](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ApplicationsListBlade)) описывают приложение для Azure AD и могут считаться определением приложения, так как предоставляют службе сведения о том, как выдавать маркеры безопасности для приложения в соответствии с его параметрами. Объект приложения будет существовать только в своем домашнем каталоге, даже если это мультитенантное приложение, поддерживающее субъекты-службы в других каталогах. В объекте приложения могут содержаться любые из следующих сведений (а также дополнительные сведения, не упомянутые здесь):
* имя, логотип и издатель;
* URL-адреса ответа
* секретные ключи (симметричные и/или асимметричные ключи, применяемые для проверки подлинности приложения);
* зависимости API (OAuth);
* опубликованные API-интерфейсы, ресурсы, области (OAuth);
* Роли приложения (RBAC)
* метаданные и конфигурации единого входа;
* Метаданные и конфигурация для подготовки пользователя
* Метаданные и конфигурация прокси-сервера

Объекты приложений можно создать несколькими способами, включая следующие:
* регистрация приложения на портале Azure;
* создание приложения с помощью Visual Studio и его настройка для использования проверки подлинности Azure AD;
* когда администратор добавляет приложение из коллекции приложений (при этом также создается субъект-служба);
* создание приложения с помощью API Graph Microsoft, API Graph Azure AD или PowerShell;
* множество остальных методов, включая различные возможности разработки в Azure и обозревателе API-интерфейсов в центрах разработчиков.

## <a name="what-are-service-principals-and-where-do-they-come-from"></a>Что такое субъекты-службы и откуда они берутся?
[Субъекты-службы](active-directory-application-objects.md#service-principal-object) (которыми можно управлять с помощью процедуры [Корпоративные приложения](https://portal.azure.com/#blade/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/AllApps/menuId/)) — это то, что фактически управляет приложением, подключая его к Azure AD. Их можно считать экземпляром приложения в вашем каталоге. В любом приложении может быть только один объект приложения (зарегистрированный в каталоге home) и один или несколько объектов субъекта-службы, представляющих экземпляры приложения в каждом каталоге, в котором оно действует. 

Субъект-служба может содержать:

* обратную ссылку на объект приложения через свойство идентификатора приложения;
* записи назначений для локальных пользователей и ролей приложения в группе;
* записи разрешений для локальных пользователей и администраторов, предоставленные приложению
  * (например, разрешение для приложения на доступ к электронной почте конкретного пользователя);
* записи локальных политик, включая политику условного доступа;
* записи запасных локальных параметров для приложения:
  * утверждает правила преобразования.
  * Сопоставление атрибутов (подготовка пользователей)
  * специфические для каталога роли приложения (если приложение поддерживает настраиваемые роли);
  * специфическое для каталога имя или логотип.

Как и объекты приложений, субъекты-службы тоже можно создать несколькими способами, включая следующие:

* Когда пользователи входят в стороннее приложение, интегрированное с Azure AD.
  * Во время входа пользователям предлагается предоставлять приложению разрешение на право доступа к своему профилю и прочие разрешения. Когда первый пользователь дает свое согласие, субъект-служба, которая представляет приложение, добавляется в каталог.
* Когда пользователи входят в веб-службы Microsoft, например [Office 365](http://products.office.com/).
  * Когда вы подписываетесь на Office 365 или начинаете работать с пробной версией, в каталоге создается один или несколько субъектов-служб, которые представляют различные службы, используемые для предоставления всех возможностей, связанных с Office 365.
  * Некоторые службы Office 365, например SharePoint, создают субъекты-службы на постоянной основе, чтобы обеспечивать безопасное взаимодействие между компонентами, включая рабочие процессы.
* Когда администратор добавляет приложение из коллекции приложений (при этом также создается объект базового приложения).
* Добавление приложения для использования [Azure AD Application Proxy](https://msdn.microsoft.com/library/azure/dn768219.aspx).
* Подключение приложения для единого входа в систему с помощью SAML или единого входа по паролю (SSO).
* Программным путем через API Graph Azure AD или PowerShell.

## <a name="how-are-application-objects-and-service-principals-related-to-each-other"></a>Каким образом объекты приложений и субъекты-службы связаны друг с другом?
В приложении один объект приложения находится в домашнем каталоге, на который ссылается один или несколько субъектов-служб в каждом из каталогов, в которых оно работает (включая домашний каталог приложения).
![Схема, на которой показаны объекты приложения и субъекты-службы, взаимодействующие друг с другом и экземплярами Azure AD.][apps_service_principals_directory]

На предыдущей схеме показано, что корпорация Майкрософт поддерживает два внутренних каталога (слева), которые она использует для публикации приложений:

* Один служит для приложений Microsoft (каталог служб Microsoft)
* другой — для предварительно интегрированных сторонних приложений (каталог коллекции приложений).

Издатели и поставщики приложений, которые интегрируются с Azure AD, должны иметь каталог публикации (показано справа под названием "Some SaaS Directory" (Каталог SaaS)).

К приложениям, которые вы добавляете самостоятельно (представлены как **App (yours)** (Приложение (ваше)) на схеме), относятся:

* приложения, которые вы разработали (интегрировали с Azure AD);
* приложения, которые вы подключили для единого входа;
* приложения, которые вы опубликовали с помощью прокси-сервера приложений Azure AD.

### <a name="notes-and-exceptions"></a>Примечания и исключения
* Не все субъекты-службы указывают на объект приложения. Когда была первоначально создана система Azure AD, количество служб, предоставляемых приложений, было небольшим, и субъекта-службы было достаточно для установления удостоверения приложения. По своей форме первоначальный субъект-служба был похож на учетную запись службы Windows Server Active Directory. Поэтому субъекты-службы можно по-прежнему создавать, используя различные способы, например с помощью Azure AD PowerShell без предварительного создания объекта приложения. Перед созданием субъекта-службы интерфейсу API Graph Azure AD требуется объект приложения.
* В настоящее время не все приведенные выше сведения предоставляются программно. Ниже перечислены только сведения, доступные в пользовательском интерфейсе:
  * утверждает правила преобразования.
  * Сопоставление атрибутов (подготовка пользователей)
* Более подробные сведения об объектах субъекта-службы и приложений см. в справочной документации по Azure AD Graph REST API.
  * [Приложения](https://msdn.microsoft.com/library/azure/ad/graph/api/entity-and-complex-type-reference#application-entity)
  * [Субъект-служба](https://msdn.microsoft.com/library/azure/ad/graph/api/entity-and-complex-type-reference#serviceprincipal-entity)

## <a name="why-do-applications-integrate-with-azure-ad"></a>Зачем интегрировать приложения с Azure AD?
Приложения добавляются в Azure AD, чтобы использовать одну или несколько служб, предоставляемых данной системой, включая следующее:

* проверка подлинности и авторизация приложения;
* проверка подлинности и авторизация пользователей;
* SSO с помощью федерации или пароля;
* подготовка пользователей и синхронизация;
* управление доступом на основе ролей (использование каталога для определения ролей приложения с целью выполнения проверок авторизации в приложении на основе ролей);
* службы авторизации OAuth (используемые приложением Office 365 и другими приложениями корпорации Майкрософт для авторизации доступа к API-интерфейсам и ресурсам);
* публикация приложений и прокси-сервер (публикация приложения из частной сети в Интернете).

## <a name="who-has-permission-to-add-applications-to-my-azure-ad-instance"></a>Кто имеет право добавлять приложения в мой экземпляр Azure AD?
Тогда как некоторые задачи могут выполнять только глобальные администраторы (например, добавлять приложения из коллекции приложений и настраивать приложение для использования прокси-сервера приложения), по умолчанию все пользователи в вашем каталоге имеют разрешения регистрировать объекты приложений, которые они разрабатывают, и решать по своему усмотрению, к каким приложениям предоставлять общий доступ или каким приложениям предоставлять доступ к данным своей организации через согласие. Когда первый пользователь в вашем каталоге входит в приложение и предоставляет разрешения, в клиенте создается субъект-служба. В противном случае сведения о предоставлении разрешений будут храниться в существующем субъекте-службе.

Предоставление пользователям прав регистрировать приложения и предоставлять разрешения может изначально насторожить, но имейте в виду следующее:


* В течение многих лет приложения могли использовать Windows Server Active Directory для проверки подлинности пользователей и не требовали регистрации приложения или его записи в каталоге. Теперь организациям будет четко видно, сколько приложений используют каталог и в каких целях.
* Делегировав эти обязанности пользователям, администраторам больше не нужно будет выполнять процесс регистрации и публикации приложения самостоятельно. В случае со службами федерации Active Directory (ADFS) существовала определенная вероятность, что администратор должен был добавлять приложение в качестве проверяющей стороны от имени разработчиков. Теперь разработчики могут все делать сами.
* Очень удобно, когда пользователи могут входить в приложения с помощью своих учетных записей организации для выполнения бизнес-задач. Если впоследствии они покидают организацию, то они автоматически теряют доступ к своим учетным записям в приложении, которое они ранее использовали.
* Очень удобно записывать (фиксировать) данные, к которым был организован общий доступ, а также приложение, которое применялось для этого. Данные сегодня переносить значительно легче, и очень удобно записывать (фиксировать) данные, к которым был предоставлен общий доступ, а также приложение, которое применялось для этого.
* Владельцы API, которые используют Azure AD для процесса OAuth, точно указывают разрешения, которые пользователи могут предоставлять приложениям, а также разрешения, для выдачи которых требуется согласие администратора. Только администраторы могут предоставлять разрешения в больших масштабах и более значимые разрешения, тогда как пользователь может предоставлять разрешения только относительно собственных данных и возможностей.
* Операции пользователей по добавлению приложений и предоставления им права на доступ к данным могут подлежать аудиту, поэтому вы можете просматривать отчеты об аудите на портале Azure, чтобы определить, каким образом приложение было добавлено в каталог.

Если вы все равно хотите запретить пользователям в вашем каталоге регистрировать приложения и входить в приложения без утверждения администратора, можно изменить два параметра, чтобы отключить эти возможности.

* Чтобы запретить пользователям предоставлять разрешения для приложений от собственного имени:
  1. На портале Azure перейдите к разделу [Параметры пользователя](https://portal.azure.com/#blade/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/UserSettings/menuId/) в разделе корпоративных приложений.
  2. Для параметра **Users can consent to apps accessing company data on their behalf** (Пользователи могут разрешать приложениям доступ к корпоративным данным от своего имени) задайте значение **Нет**. 
     *Обратите внимание, что если принято решение отключить возможность пользователя предоставлять разрешения, администратору потребуется самому предоставлять разрешения на любое новое приложение, которое пользователю необходимо использовать.*
* Чтобы запретить пользователям регистрировать свои приложения:
  1. На портале Azure перейдите к разделу [Параметры пользователя](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/UserSettings) в разделе Azure Active Directory.
  2. Для параметра **Users can register applications** (Пользователи могут регистрировать приложения) задайте значение **Нет**.

> [!NOTE]
> Корпорация Майкрософт сама использует конфигурацию по умолчанию, в которой пользователи могут регистрировать приложения и предоставлять разрешения на использование приложений от своего имени.

<!--Image references-->
[apps_service_principals_directory]:../media/active-directory-how-applications-are-added/HowAppsAreAddedToAAD.jpg

