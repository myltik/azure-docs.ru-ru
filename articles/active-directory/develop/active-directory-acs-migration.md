---
title: Перенос из службы контроля доступа Azure | Документация Майкрософт
description: Варианты перемещения приложений и служб из службы контроля доступа Azure
services: active-directory
documentationcenter: dev-center-name
author: CelesteDG
manager: mtillman
editor: ''
ms.assetid: 820acdb7-d316-4c3b-8de9-79df48ba3b06
ms.service: active-directory
ms.component: develop
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 11/14/2017
ms.author: celested
ms.reviewer: dastrock
ms.openlocfilehash: c1c86f21d5a99cf251b0b83f41576c2cdaf96dfb
ms.sourcegitcommit: e14229bb94d61172046335972cfb1a708c8a97a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2018
ms.locfileid: "34157611"
---
# <a name="migrate-from-the-azure-access-control-service"></a>Перенос из службы контроля доступа Azure

Служба контроля доступа Azure, относящаяся к Azure Active Directory (Azure AD), прекратит функционирование 7 ноября 2018 года. До того времени приложения и службы, использующие службу контроля доступа, должны быть полностью перенесены в другой механизм проверки подлинности. В этой статье описываются рекомендации, которые помогут текущим клиентам спланировать отказ от использования службы контроля доступа. Если в настоящее время вы не используете службу контроля доступа, не предпринимайте никаких действий.


## <a name="overview"></a>Обзор

Служба контроля доступа — это облачная служба проверки подлинности, которая предлагает простой способ проверки подлинности и авторизации пользователей для получения доступа к веб-приложениям и службам. Она позволяет реализовать множество функциональных возможностей проверки подлинности и авторизации в своем коде. Служба контроля доступа в основном используется разработчиками и архитекторами клиентов Microsoft .NET, веб-приложений ASP.NET и веб-служб Windows Communication Foundation (WCF).

Варианты использования службы контроля доступа (ACS) можно разделить на три основные категории:

- Проверка подлинности в определенных облачных службах Майкрософт, включая служебную шину Azure и Dynamics CRM. Клиентские приложения получают маркеры из службы контроля доступа, а затем проходят с их помощью проверку подлинности в этих службах и выполняют различные действия.
- Добавление проверки подлинности в веб-приложения, как пользовательские, так и предварительно упакованные (например, SharePoint). Пассивная проверка подлинности службы контроля доступа позволяет входить в веб-приложения с помощью учетной записи Майкрософт (ранее Live ID) и с помощью учетных записей Google, Facebook, Yahoo, Azure AD и служб федерации Active Directory (AD FS).
- Защита пользовательских веб-служб с помощью маркеров, выданных службой контроля доступа. Использование активной проверки подлинности гарантирует, что к веб-службам могут получить доступ только доверенные клиенты, прошедшие проверку подлинности в службе контроля доступом.

В разделах ниже рассматривается каждый из этих вариантов использования и рекомендуемые стратегии переноса. 

> [!WARNING]
> В большинстве случаев, чтобы перенести имеющиеся приложения и службы на более новые технологии, нужно значительно изменить код. Мы советуем немедленно приступить к планированию и непосредственно к самому переносу, чтобы избежать возможных сбоев и простоев.

Служба контроля доступа содержит следующие компоненты:

- Служба маркеров безопасности (STS), которая получает запросы на проверку подлинности и взамен выдает маркеры безопасности.
- Классический портал Azure, где можно создавать, удалять, включать и отключать пространства имен службы контроля доступа.
- Отдельный портал управления контролем доступа, где можно настроить пространства имен службы контроля доступа.
- Служба управления, позволяющая автоматизировать функции порталов.
- Модуль правил преобразования маркеров, с помощью которого можно определить сложную логику обработки выходного формата маркеров, выданных службой контроля доступа.

Чтобы использовать эти компоненты, необходимо создать одно или несколько пространств имен службы контроля доступа. *Пространство имен* — это выделенный экземпляр службы контроля доступа, с которым ваши службы и приложения обмениваются данными. Пространство имен изолировано от всех других клиентов службы контроля доступа. Они используют собственные пространства имен. Пространство имен в службе контроля доступом имеет выделенный URL-адрес, который выглядит следующим образом:

```HTTP
https://<mynamespace>.accesscontrol.windows.net
```

По этому URL-адресу выполняется весь обмен данными с STS и операции управления. Для разных целей используются разные пути. Чтобы определить, используют ли службы или приложения службу контроля доступа, отслеживайте трафик к https://<namespace>.accesscontrol.windows.net. Любой трафик к этому URL-адресу обрабатывается с помощью службы контроля доступа, и его нужно прекратить. 

Исключением является весь трафик к `https://accounts.accesscontrol.windows.net`. Трафик к этому URL-адресу уже обрабатывается другой службой. Прекращение поддержки службы контроля доступа **не** влияет на него. 

Дополнительные сведения о службе ACS см. в статье [Служба Access Control Service 2.0](https://msdn.microsoft.com/library/hh147631.aspx).

## <a name="retirement-schedule"></a>График прекращения использования

По состоянию на ноябрь 2017 г. все компоненты службы контроля доступа полностью поддерживаются и находятся в рабочем режиме. Единственным ограничением является [невозможность создания новых пространств имен контроля доступа через классический портал Azure](https://azure.microsoft.com/blog/acs-access-control-service-namespace-creation-restriction/).

Вот график устаревания компонентов службы контроля доступа:

- **Ноябрь 2017 года**. [Прекращается использование](https://blogs.technet.microsoft.com/enterprisemobility/2017/09/18/marching-into-the-future-of-the-azure-ad-admin-experience-retiring-the-azure-classic-portal/) интерфейса администрирования Azure AD на классическом портале Azure. На этом этапе управлять пространством имен службы контроля доступа можно по следующему новому выделенному URL-адресу: `http://manage.windowsazure.com?restoreClassic=true`. По этому URL-адресу можно просматривать существующие пространства имен, включать, отключать и удалять их.
- **2 апреля 2018 года**. Использование классического портала Azure полностью прекращено, то есть управление пространствами имен службы контроля доступа через любой URL-адрес больше недоступно. Вы больше не сможете отключить, включить, удалить или перечислить пространства имен контроля доступа. Однако портал управления службы контроля доступа будет полностью функционален и размещен по адресу `https://\<namespace\>.accesscontrol.windows.net`. Все другие компоненты службы контроля доступом будут по-прежнему работать в обычном режиме.
- **7 ноября 2018 года**. Все компоненты службы контроля доступа будут окончательно отключены. К ним относится портал управления службы контроля доступа, служба управления, STS и модуль правил преобразования маркеров. На этом этапе все запросы, адресованные службе контроля доступа (размещенной по адресу \<пространство имен\>.accesscontrol.windows.net) будут завершаться с ошибкой. До этого времени вы должны перенести все имеющиеся приложения и службы на другие технологии.


## <a name="migration-strategies"></a>Стратегии миграции

В следующих разделах приведены общие рекомендации по переходу с службы контроля доступа на другие технологии Майкрософт.

### <a name="clients-of-microsoft-cloud-services"></a>Клиенты облачных служб Майкрософт

Каждая из облачных служб Майкрософт, которые принимают маркеры, выданные службой контроля доступа, поддерживает по крайней мере один альтернативный способ проверки подлинности. Правильный же механизм зависит от каждой службы, поэтому мы советуем воспользоваться рекомендациями из соответствующей документации. Для удобства ниже приведен каждый набор документации.

| Service | Руководство |
| ------- | -------- |
| Azure Service Bus | [Переход от службы контроля доступа Azure Active Directory к авторизации подписанного URL-адреса](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-migrate-acs-sas) |
| Ретрансляция служебной шины Azure | [Переход от службы контроля доступа Azure Active Directory к авторизации подписанного URL-адреса](https://docs.microsoft.com/azure/service-bus-relay/relay-migrate-acs-sas) |
| Управляемый кэш Azure | [Переход на кэш Redis для Azure](https://docs.microsoft.com/azure/redis-cache/cache-faq#which-azure-cache-offering-is-right-for-me) |
| Azure DataMarket | [Переход на API-интерфейсы Cognitive Services](https://docs.microsoft.com/azure/machine-learning/studio/datamarket-deprecation) |
| Службы BizTalk | [Переход на компонент Logic Apps службы приложений Azure](https://docs.microsoft.com/azure/machine-learning/studio/datamarket-deprecation) |
| Службы мультимедиа Azure | [Azure Media Services announces support for Azure AD and deprecation of Access Control authentication](https://azure.microsoft.com/blog/azure-media-service-aad-auth-and-acs-deprecation/) (Команда разработчиков служб мультимедиа Azure анонсирует поддержку проверки подлинности AAD и объявление проверки подлинности ACS устаревшей) |
| Служба архивации Azure | [Вопросы об агенте службы Azure Backup](https://docs.microsoft.com/azure/backup/backup-azure-file-folder-backup-faq) |

<!-- Dynamics CRM: Migrate to new SDK, Dynamics team handling privately -->
<!-- Azure RemoteApp deprecated in favor of Citrix: http://www.zdnet.com/article/microsoft-to-drop-azure-remoteapp-in-favor-of-citrix-remoting-technologies/ -->
<!-- Exchange push notifications are moving, customers don't need to move -->
<!-- Retail federation services are moving, customers don't need to move -->
<!-- Azure StorSimple: TODO -->
<!-- Azure SiteRecovery: TODO -->


### <a name="sharepoint-customers"></a>Клиенты SharePoint

Клиенты SharePoint 2013, SharePoint 2016 и SharePoint Online давно используют службу контроля доступа для аутентификации в облачных, локальных и гибридных средах. Прекращение использования службы контроля доступа повлияет на некоторые функции и варианты использования SharePoint. В таблице ниже приведены краткие инструкции по миграции для некоторых из наиболее популярных компонентов SharePoint, использующих службу контроля доступа.

| Функция | Руководство |
| ------- | -------- |
| Аутентификация пользователей из Azure AD | Ранее в Azure AD не поддерживались маркеры SAML 1.1, необходимые SharePoint для аутентификации, и служба контроля доступа использовалась в качестве посредника, обеспечивающего совместимость SharePoint с форматами маркеров Azure AD. Теперь можно [непосредственно подключить SharePoint к Azure AD с помощью политик выдачи маркеров](https://docs.microsoft.com/Office365/Enterprise/using-azure-ad-for-sharepoint-server-authentication). |
| [Аутентификация приложений и аутентификация между серверами в локальной среде SharePoint](https://technet.microsoft.com/library/jj219571(v=office.16).aspx) | Не зависит от прекращения использования службы контроля доступа. Какие-либо изменения не требуются. | 
| [Авторизация с низким уровнем доверия для надстроек SharePoint (при размещении у поставщика и размещении в SharePoint)](https://docs.microsoft.com/sharepoint/dev/sp-add-ins/three-authorization-systems-for-sharepoint-add-ins) | Не зависит от прекращения использования службы контроля доступа. Какие-либо изменения не требуются. |
| [Гибридный поиск в облаке SharePoint](https://blogs.msdn.microsoft.com/spses/2015/09/15/cloud-hybrid-search-service-application/) | Не зависит от прекращения использования службы контроля доступа. Какие-либо изменения не требуются. |

### <a name="web-applications-that-use-passive-authentication"></a>Веб-приложения, использующие пассивную проверку подлинности

Для веб-приложений, использующих службу контроля доступа для проверки подлинности пользователей, эта служба предоставляет веб-разработчикам и архитекторам таких приложений следующие функции и возможности:

- Тесная интеграция с Windows Identity Foundation (WIF).
- Федерация с учетными записями Google, Facebook, Yahoo, Azure Active Directory, ADFS и учетными записями Майкрософт.
- Поддержка следующих протоколов проверки подлинности: OAuth 2.0 (черновой вариант 13), WS-Trust и Web Services Federation (WS-Federation).
- Поддержка следующих форматов маркеров: JWT, SAML 1.1, SAML 2.0 и SWT.
- Возможность обнаружения домашней области, интегрированная в WIF, благодаря которой пользователи могут выбирать тип учетной записи для входа. Эта возможность реализована в веб-приложении и полностью настраиваемая.
- Преобразование маркеров, позволяющее настраивать утверждения, полученные веб-приложением из службы контроля доступа, в том числе:
    - отправка утверждений от поставщиков удостоверений;
    - добавление дополнительных настраиваемых утверждений;
    - выдача утверждений при определенных условиях на основе простой логики If-Then.

К сожалению, ни одна служба не предлагает все соответствующие возможности. Следует оценить, какие возможности службы контроля доступа требуются, а затем выбрать одну из доступных служб: [Azure Active Directory](https://azure.microsoft.com/develop/identity/signin/), [Azure Active Directory B2C](https://azure.microsoft.com/services/active-directory-b2c/) (Azure AD B2C) или другую облачную службу проверки подлинности.

#### <a name="migrate-to-azure-active-directory"></a>Переход на Azure Active Directory

Приложения и службы можно непосредственно интегрировать с Azure Active Directory. Azure AD — это облачный поставщик удостоверений для рабочих или учебных учетных записей Майкрософт, а также поставщик удостоверений для Office 365, Azure и многих других служб. Он предоставляет такие же возможности федеративной проверки подлинности, что и служба контроля доступа, но не поддерживает множество других функций этой службы. 

Основной пример — федерация с поставщиками удостоверений социальных сетей, таких как Facebook, Google и Yahoo. Если пользователи входят в систему с этим типом учетных данных, тогда решение Azure AD не подходит вам. 

Azure AD также всегда поддерживает одинаковые со службой контроля доступа протоколы проверки подлинности. Хотя обе эти службы поддерживают, например, протокол OAuth, его реализация, требующая изменения кода в процессе миграции, существенно отличается.

Однако Azure AD предоставляет несколько потенциальных преимуществ клиентам службы контроля доступа. Эта служба изначально поддерживает размещенные в облаке рабочие и учебные учетные записи Майкрософт, которые часто используют клиенты службы контроля доступа. 

Клиент Azure AD также можно включить в федерацию с одним или несколькими экземплярами локального каталога Active Directory через AD FS. Таким образом в приложении могут проходить проверку подлинности как облачные пользователи, так и пользователи, размещенные в локальной среде. Кроме того, Azure AD поддерживает протокол WS-Federation, за счет чего эту службу сравнительно легко интегрировать с веб-приложениями с помощью WIF.

В таблице ниже приводится сравнительная характеристика возможностей, которые предоставляют веб-приложениям службы контроля доступа и Azure AD. 

В целом *Azure Active Directory — это, скорее всего, правильный выбор, если нужно, чтобы после переноса пользователи входили в систему только с помощью рабочих и учебных учетных записей Майкрософт*.

| Функция | Поддержка службы контроля доступа | Поддержка Azure AD |
| ---------- | ----------- | ---------------- |
| **Типы учетных записей** | | |
| Рабочие и учебные учетные записи Майкрософт | Поддерживаются | Поддерживаются |
| Учетные записи Windows Server Active Directory и AD FS |— Поддерживаются через федерацию с клиентом Azure AD <br />— Поддерживаются через прямую федерацию с AD FS | Поддерживаются только через федерацию с клиентом Azure AD | 
| Учетные записи других корпоративных систем управления удостоверениями |— Возможно через федерацию с клиентом Azure AD <br />— Поддерживаются через прямую федерацию | Возможно через федерацию с клиентом Azure AD |
| Личные учетные записи Майкрософт | Поддерживаются | Поддерживаются только через протокол OAuth 2.0 Azure AD | 
| Учетные записи Facebook, Google, Yahoo | Поддерживаются | Не поддерживаются ни при каких обстоятельствах |
| **Совместимость с протоколами и пакетом SDK** | | |
| WIF | Поддерживаются | Поддерживается, но с определенными условиями |
| Сертификат | Поддерживаются | Поддерживаются |
| OAuth 2.0 | Поддерживается черновая версия 13 | Поддерживается RFC 6749 (последняя спецификация) |
| WS-Trust | Поддерживаются | Не поддерживается |
| **Форматы маркеров** | | |
| JWT | Поддерживается в бета-версии | Поддерживаются |
| SAML 1.1 | Поддерживаются | Предварительный просмотр |
| SAML 2.0 | Поддерживаются | Поддерживаются |
| SWT | Поддерживаются | Не поддерживается |
| **Настройки** | | |
| Настраиваемый пользовательский интерфейс обнаружения домашней области и выбора учетной записи | Загружаемый код, который можно включить в приложения | Не поддерживается |
| Передача пользовательских сертификатов для подписи маркера | Поддерживаются | Поддерживаются |
| Настройка утверждений в маркерах |— Отправка входящих утверждений от поставщиков удостоверений<br />— Получение маркера доступа от поставщика удостоверений как утверждения<br />— Выдача исходящих утверждений на основе значений входящих утверждений<br />— Выдача исходящих утверждений с постоянными значениями |— Не может отправлять утверждения от федеративных поставщиков удостоверений<br />— Не может получить маркер доступа от поставщика удостоверений как утверждение<br />— Не может выдавать исходящие утверждения на основе значений входящих утверждений<br />— Не может выдавать исходящие утверждения с постоянными значениями<br />— Может выдавать исходящие утверждения на основе свойств пользователя, синхронизированного с Azure AD |
| **Автоматизация** | | |
| Автоматизация задач настройки и управления | Поддерживается через службу управления контролем доступа | Поддерживается через Microsoft Graph и API Graph Azure AD |

Если вы решите, что Azure AD является лучшим способом миграции, следует рассмотреть два способа интеграции приложений и служб с этой службой.

Чтобы использовать WS-Federation и WIF для интеграции с Azure AD, рекомендуем подход, описанный в статье [Настройка федеративного единого входа для приложения не из коллекции](https://docs.microsoft.com/azure/active-directory/application-config-sso-how-to-configure-federated-sso-non-gallery). В этой статье описана настройка единого входа на основе SAML в Azure AD, но этот способ можно применить и к WS-Federation. При использовании этого подхода требуется лицензия Azure AD Premium. Такой подход имеет два преимущества:

- Вы получаете полную гибкость настройки маркера Azure AD. Вы можете настраивать утверждения, выданные Azure AD, в соответствии с маркерами службы контроля доступа. Это особенно касается утверждения идентификатора имени и пользователя. Необходимо убедиться, что идентификаторы пользователей, выданные Azure AD, соответствуют выданным службой контроля доступам. Это позволит получать согласованные идентификаторы даже после изменения технологии.
- Вы можете настроить сертификат для подписи маркера, специфичный для вашего приложения, временем существования которого управляете вы.

<!--

Possible nameIdentifiers from Access Control (via AAD or AD FS):
- AD FS - Whatever AD FS is configured to send (email, UPN, employeeID, what have you)
- Default from AAD using App Registrations, or Custom Apps before ClaimsIssuance policy: subject/persistent ID
- Default from AAD using Custom apps nowadays: UPN
- Kusto can't tell us distribution, it's redacted

-->

> [!NOTE]
> При использовании этого подхода требуется лицензия Azure AD Premium. Если вы клиент ACS и вам требуется лицензия Premium, чтобы настроить единый вход в приложение, обратитесь к нам, и мы предоставим лицензии разработчика.

Кроме того, вы можете использовать [этот пример кода](https://github.com/Azure-Samples/active-directory-dotnet-webapp-wsfederation), в котором реализован немного другой подход к настройке WS-Federation. В этом примере кода используется не WIF, а ПО промежуточного слоя ASP.NET 4.5 OWIN. Однако инструкции по регистрации подходят и к приложениям, использующим WIF, но в этом случае лицензия Azure AD Premium не требуется. 

Если вы выбрали этот подход, необходимо разобраться со [сменой ключей подписывания в Azure AD](https://docs.microsoft.com/azure/active-directory/develop/active-directory-signing-key-rollover). В нем выдача маркеров осуществляется с помощью общего ключа подписывания Azure AD. По умолчанию WIF не обновляет ключи подписывания автоматически. Когда Azure AD сменяет свои общие ключи подписывания, WIF необходимо подготовить к принятию изменений.

Если вы можете выполнить интеграцию с Azure AD через протоколы OpenID Connect или OAuth, мы советуем применить этот подход. Подробную документацию и руководства разработчика по интеграции Azure AD с веб-приложением см. в [этой статье](https://aka.ms/aaddev).

<!-- TODO: If customers ask about authZ, let's put a blurb on role claims here -->

#### <a name="migrate-to-azure-active-directory-b2c"></a>Переход на Azure Active Directory B2C

Еще один вариант переноса, который следует рассмотреть, — это Azure AD B2C. Azure AD B2C — это облачная служба проверки подлинности, аналогичная службе контроля доступа. Она позволяет разработчикам развернуть в облачной службе логику управления удостоверениями и проверки подлинности сторонних поставщиков. Эта платная служба (с уровнями "Бесплатный" и "Премиум") предназначена для клиентов, создающих приложения, которые могут иметь миллионы активных пользователей.

Одна из наиболее привлекательных возможностей Azure AD B2C (как и службы контроля доступа) заключается в поддержке большого количества разных типов учетных записей. С помощью Azure AD B2C пользователи могут выполнять вход, используя свою учетную запись Майкрософт, учетные записи Facebook, Google, LinkedIn, GitHub или Yahoo и многие другие. Кроме того, Azure AD B2C поддерживает локальные учетные записи — имена пользователей и пароли, создаваемые пользователями специально для определенного приложения. Azure AD B2C также предоставляет широкие возможности расширяемости, с помощью которых можно настроить потоки входа. 

Однако эта служба не поддерживает все протоколы проверки подлинности и форматы маркеров, необходимые клиентам службы контроля доступа. С помощью Azure AD B2C также нельзя получить маркеры и запросить дополнительные сведения о пользователе от поставщика удостоверений, корпорации Майкрософт или иным способом.

В таблице ниже приводится сравнительная характеристика возможностей, которые предоставляют веб-приложениям служба контроля доступа и Azure AD B2C. В целом *Azure AD B2C — это, скорее всего, правильный выбор для переноса, если приложение ориентировано на пользователей или поддерживает большое количество разных типов учетных записей*.

| Функция | Поддержка службы контроля доступа | Поддержка Azure AD B2C |
| ---------- | ----------- | ---------------- |
| **Типы учетных записей** | | |
| Рабочие и учебные учетные записи Майкрософт | Поддерживаются | Поддерживаются через пользовательские политики  |
| Учетные записи Windows Server Active Directory и AD FS | Поддерживаются через прямую федерацию с AD FS | Поддерживаются через федерации SAML с помощью настраиваемых политик |
| Учетные записи других корпоративных систем управления удостоверениями | Поддерживаются через прямую федерацию по протоколу WS-Federation | Поддерживаются через федерации SAML с помощью настраиваемых политик |
| Личные учетные записи Майкрософт | Поддерживаются | Поддерживаются | 
| Учетные записи Facebook, Google, Yahoo | Поддерживаются | Учетные записи Facebook и Google поддерживаются по умолчанию, Yahoo — через федерацию OpenID Connect с помощью настраиваемых политик |
| **Совместимость с протоколами и пакетом SDK** | | |
| Windows Identity Foundation | Поддерживаются | Не поддерживается |
| Сертификат | Поддерживаются | Не поддерживается |
| OAuth 2.0 | Поддерживается черновая версия 13 | Поддерживается RFC 6749 (последняя спецификация) |
| WS-Trust | Поддерживаются | Не поддерживается |
| **Форматы маркеров** | | |
| JWT | Поддерживается в бета-версии | Поддерживаются |
| SAML 1.1 | Поддерживаются | Не поддерживается |
| SAML 2.0 | Поддерживаются | Не поддерживается |
| SWT | Поддерживаются | Не поддерживается |
| **Настройки** | | |
| Настраиваемый пользовательский интерфейс обнаружения домашней области и выбора учетной записи | Загружаемый код, который можно включить в приложения | Возможность полной конфигурации пользовательского интерфейса через настраиваемые каскадные таблицы стилей |
| Передача пользовательских сертификатов для подписи маркера | Поддерживаются | Настраиваемые ключи подписывания (не сертификаты) поддерживаются через пользовательские политики |
| Настройка утверждений в маркерах |— Отправка входящих утверждений от поставщиков удостоверений<br />— Получение маркера доступа от поставщика удостоверений как утверждения<br />— Выдача исходящих утверждений на основе значений входящих утверждений<br />— Выдача исходящих утверждений с постоянными значениями |— Может отправлять утверждения от поставщиков удостоверений; для некоторых утверждений требуются пользовательские политики<br />— Не может получить маркер доступа от поставщика удостоверений как утверждение<br />— Может выдавать исходящие утверждения на основе значений входящих утверждений через пользовательские политики<br />— Может выдавать исходящие утверждения с постоянными значениями через пользовательские политики |
| **Автоматизация** | | |
| Автоматизация задач настройки и управления | Поддерживается через службу управления контролем доступа |— Создавать пользователей можно через API Azure AD Graph<br />— Не может программно создавать клиенты, приложения или политики B2C |

Если вы решите перенести свои приложения и службы в Azure AD B2C, сначала изучите следующие материалы:

- [Документация по Azure AD B2C](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-overview)
- [Пользовательские политики Azure AD B2C](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-overview-custom)
- [Цены на Azure Active Directory B2C](https://azure.microsoft.com/pricing/details/active-directory-b2c/)


#### <a name="migrate-to-ping-identity-or-auth0"></a>Перенос в Ping Identity или Auth0

В некоторых случаях может выясниться, что Azure AD и Azure AD B2C не могут заменить службу контроля доступа в веб-приложениях без внесения значительных изменений в код. К некоторым распространенным примерам относятся следующие:

- веб-приложения, использующие WIF или WS-Federation для входа через поставщиков удостоверений социальных сетей, например Google или Facebook;
- веб-приложения, устанавливающие прямую федерацию с корпоративным поставщиком удостоверений по протоколу WS-Federation;
- веб-приложения, которым требуется маркер доступа, выданный поставщиком удостоверений социальных сетей (например, Google или Facebook), в качестве утверждения в токенах, выданных службой контроля доступа;
- веб-приложения со сложными правилами преобразования токенов, которые службы Azure AD и Azure AD B2C не могут воспроизвести;
- мультитенантные веб-приложения, использующие ACS для централизованного управления федерацией с многими различными поставщиками удостоверений.

В таких случаях рассмотрите возможность переноса веб-приложения в другую облачную службу проверки подлинности. Мы советуем изучить следующие варианты. Каждый из них предоставляет те же возможности, что и служба контроля доступа.



|     |     | 
| --- | --- |
| ![Auth0](./media/active-directory-acs-migration/rsz_auth0.png) | [Auth0](https://auth0.com/acs) — это гибкая облачная служба идентификации, поддерживающая почти все возможности ACS (для нее доступно [общее руководство по переходу для клиентов службы контроля доступа](https://auth0.com/acs)). |
| ![Проверка связи](./media/active-directory-acs-migration/rsz_ping.png) | [Ping Identity](https://www.pingidentity.com) предлагает два решения, аналогичные возможностям ACS. PingOne — это облачная служба идентификации, которая поддерживает многие из тех же функций, что и служба ACS. PingFederate представляет собой аналогичную службу идентификации в локальной среде, которая обеспечивает большую гибкость. Дополнительные сведения по их использованию см. в [этом руководстве](https://www.pingidentity.com/en/company/blog/2017/11/20/migrating_from_microsoft_acs_to_ping_identity.html). |

Мы работаем с Ping Identity и Auth0, чтобы гарантировать, что у всех клиентов службы контроля доступа есть пути переноса своих приложений и служб, которые позволяют уменьшить объем работы, необходимый для перемещения.

<!--

## Sharepoint 2010, 2013, 2016

TODO: Azure AD only, use Azure AD SAML 1.1 tokens, when we bring it back online.
Other IDPs: use Auth0? https://auth0.com/docs/integrations/sharepoint.

-->

### <a name="web-services-that-use-active-authentication"></a>Веб-службы, использующие активную проверку подлинности

Для веб-служб, которые защищены с помощью маркеров, выпущенных службой контроля доступа, предлагаются следующие функции и возможности:

- Возможность зарегистрировать одно или несколько *удостоверений службы* в пространстве имен ACS. Удостоверения служб можно использовать для запроса маркеров.
- Поддержка запроса маркеров по протоколу OAuth WRAP и OAuth 2.0 (черновой вариант 13), используя следующие типы учетных данных:
    - простой пароль, созданный для удостоверения службы;
    - подписанный маркер SWT, использующий симметричный ключ или сертификат X509;
    - маркер SAML, выданный доверенным поставщиком удостоверений (обычно это экземпляр ADFS).
- Поддержка маркеров следующих форматов: JWT, SAML 1.1, SAML 2.0 и SWT.
- Простые правила преобразования маркеров.

Удостоверения службы в ACS обычно позволяют реализовать проверку подлинности между серверами. 

#### <a name="migrate-to-azure-active-directory"></a>Переход на Azure Active Directory

При использовании этого типа потока проверки подлинности мы советуем перейти на [Azure Active Directory](https://azure.microsoft.com/develop/identity/signin/). Azure AD — это облачный поставщик удостоверений для рабочих или учебных учетных записей Майкрософт, а также поставщик удостоверений для Office 365, Azure и многих других служб. 

За счет реализации предоставления учетных данных клиента OAuth служба Azure AD обеспечивает проверку подлинности между серверами. В таблице ниже приводится сравнительная характеристика возможностей проверки подлинности между серверами в службе контроля доступа и Azure AD.

| Функция | Поддержка службы контроля доступа | Поддержка Azure AD |
| ---------- | ----------- | ---------------- |
| Регистрация веб-службы | Создание проверяющей стороны на портале управления ACS | Создание веб-приложения Azure AD на портале Azure |
| Регистрация клиента | Создание удостоверения службы на портале управления ACS | Создание другого веб-приложения Azure AD на портале Azure |
| Используемый протокол |— Протокол OAuth WRAP<br />— Предоставление учетных данных клиента OAuth 2.0 (черновой вариант 13) | Предоставление учетных данных клиента OAuth 2.0 |
| Методы проверки подлинности клиента |— Простой пароль<br />— Подписанный маркер SWT<br />— Токен SAML из федеративного поставщика удостоверений |— Простой пароль<br />— Подписанный маркер JWT |
| Форматы маркеров |— JWT<br />— SAML 1.1<br />— SAML 2.0<br />— SWT<br /> | Только JWT |
| Преобразование маркеров |— Добавление пользовательских утверждений<br />— Простая логика выдачи утверждения If-Then | Добавление пользовательских утверждений | 
| Автоматизация задач настройки и управления | Поддерживается через службу управления контролем доступа | Поддерживается через Microsoft Graph и API Graph Azure AD |

Рекомендации по реализации межсерверных сценариев см. в следующих источниках:

- [Azure Active Directory для разработчиков](https://aka.ms/aaddev)
- [Calling web APIs in a daemon or long-running process](https://github.com/Azure-Samples/active-directory-dotnet-daemon) (Вызов веб-API в длительном процессе или процессе с использованием управляющей программы)
- [Authenticating to Azure AD in daemon apps with certificates](https://github.com/Azure-Samples/active-directory-dotnet-daemon-certificate-credential) (Проверка подлинности приложений управляющей программы в Azure AD с помощью сертификатов)

#### <a name="migrate-to-ping-identity-or-auth0"></a>Перенос в Ping Identity или Auth0

В некоторых случаях может оказаться, что учетных данных клиента Azure AD и предоставления разрешения OAuth недостаточно для замены службы контроля доступа в архитектуре без значительных изменений кода. К некоторым распространенным примерам относятся следующие:

- проверка подлинности между серверами с помощью токена в форматах, отличных от JWT;
- проверка подлинности между серверами с помощью входящего маркера, предоставленного внешним поставщиком удостоверений;
- проверка подлинности между серверами с правилами преобразования маркеров, которые Azure AD не может воспроизвести.

В таких случаях рассмотрите возможность переноса веб-приложения в другую облачную службу проверки подлинности. Мы советуем изучить следующие варианты. Каждый из них предоставляет те же возможности, что и служба контроля доступа.

|     |     | 
| --- | --- |
| ![Auth0](./media/active-directory-acs-migration/rsz_auth0.png) | [Auth0](https://auth0.com/acs) — это гибкая облачная служба идентификации, поддерживающая почти все возможности ACS (для нее доступно [общее руководство по переходу для клиентов службы контроля доступа](https://auth0.com/acs)). |
| ![Проверка связи](./media/active-directory-acs-migration/rsz_ping.png) | [Ping Identity](https://www.pingidentity.com) предлагает два решения, аналогичные возможностям ACS. PingOne — это облачная служба идентификации, которая поддерживает многие из тех же функций, что и служба ACS. PingFederate представляет собой аналогичную службу идентификации в локальной среде, которая обеспечивает большую гибкость. Дополнительные сведения по их использованию см. в [этом руководстве](https://www.pingidentity.com/en/company/blog/2017/11/20/migrating_from_microsoft_acs_to_ping_identity.html). |

Мы работаем с Ping Identity и Auth0, чтобы гарантировать, что у всех клиентов службы контроля доступа есть пути переноса своих приложений и служб, которые позволяют уменьшить объем работы, необходимый для перемещения.

## <a name="questions-concerns-and-feedback"></a>Вопросы, проблемы и отзывы

Мы понимаем, что сведения о переносе в этой статье подходят не всем, и некоторым клиентам ACS требуются советы и рекомендации по определению правильного плана. Если вы хотите обсудить сценарии переноса и связанные с этим процессом вопросы, оставьте комментарий на этой странице.
