---
title: Приложения с подстановочным знаком в прокси приложения Azure Active Directory | Документация Майкрософт
description: Узнайте, как использовать приложения с подстановочным знаком в прокси приложения Azure Active Directory.
services: active-directory
documentationcenter: ''
author: barbkess
manager: mtillman
ms.service: active-directory
ms.component: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/21/2018
ms.author: barbkess
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: bf50c63b351c711b2b6fc5091109289635036513
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34589514"
---
# <a name="wildcard-applications-in-the-azure-active-directory-application-proxy"></a>Приложения с подстановочным знаком в прокси приложения Azure Active Directory 

Настройка большого количества локальных приложений в Azure Active Directory (Azure AD) может быстро привести к потере управления ими породить ненужные риски возникновения ошибок конфигурации, если многие из них требуют применения одинаковых параметров. [Прокси приложения Azure AD](manage-apps/application-proxy.md) позволяет устранить эту проблему, используя публикацию приложений с подстановочным знаком для одновременной публикации нескольких приложений и управления ими. Это решение дает следующие возможности.

-   Уменьшение дополнительных временных затрат на администрирование.
-   Уменьшение числа потенциальных ошибок конфигурации.
-   Предоставление пользователям безопасного доступа к дополнительным ресурсам.

В этой статье представлены сведения, необходимые для настройки публикации приложений с подстановочным знаком в вашей среде.


## <a name="create-a-wildcard-application"></a>Создание приложения с подстановочным знаком 

Можно создать приложение с подстановочным знаком (*), если имеется группа приложений с одинаковой конфигурацией. Потенциальными кандидатами для приложения с подстановочным знаком являются приложения, совместно использующие следующее:

- группа пользователей, имеющая доступ к этим приложениям;
- метод единого входа;
- протокол доступа (HTTP, HTTPS).

Можно публиковать приложения с помощью подстановочных знаков, если внутренние и внешние URL-адреса представлены в следующем формате:

> http(s)://*.\<domain\>

Например, `http(s)://*.adventure-works.com`. Хотя внутренние и внешние URL-адреса могут содержать разные домены, рекомендуется, чтобы они совпадали. При публикации приложения появится сообщение об ошибке, если один из URL-адресов не содержит подстановочный знак.

При наличии дополнительных приложений с другими параметрами конфигурации их необходимо будет опубликовать как отдельные приложения, чтобы перезаписать параметры по умолчанию, заданные для подстановочного знака. Приложения без подстановочного знака всегда имеют приоритет над приложениями с подстановочным знаком. С точки зрения конфигурации это самые обычные приложения.

При создании приложения с подстановочным знаком используется тот же [процесс публикации приложения](manage-apps/application-proxy-publish-azure-portal.md), что и для всех других приложений. Единственное отличие заключается в добавлении подстановочного знака в URL-адреса и, возможно, настройке единого входа.


## <a name="prerequisites"></a>предварительным требованиям

### <a name="custom-domains"></a>Личные домены

Хотя [личные домены](manage-apps/application-proxy-configure-custom-domain.md) не являются обязательными для других приложений, они являются необходимым условием для создания приложений с подстановочным знаком. Для создания личных доменов необходимо:

1. Создать проверенный домен в Azure. 
2. Передать SSL-сертификат в формате PFX на прокси приложения.

Рассмотрите возможность использования сертификата с подстановочным знаком для сопоставления с приложением, которое вы собираетесь создать. Кроме того, можно использовать сертификат, который предназначенный только для определенных приложений. В этом случае только приложения, указанные в этом сертификате, будут доступны с помощью данного приложения с подстановочным знаком.

По соображениям безопасности это требование является обязательным, и подстановочные знаки не будут поддерживаться для приложений, которые не могут использовать личный домен во внешнем URL-адресе.

### <a name="dns-updates"></a>Обновления DNS

При использовании личных доменов необходимо создать запись DNS с помощью записи CNAME для внешнего URL-адреса (например, `*.adventure-works.com`), которая указывает на внешний URL-адрес конечной точки прокси приложения. Запись CNAME для приложений с подстановочным знаком должна указывать на соответствующие внешние URL-адреса.

> `<yourAADTenantId>.tenant.runtime.msappproxy.net`

Чтобы убедиться, что запись CNAME правильно настроена, можно использовать [nslookup](https://docs.microsoft.com/windows-server/administration/windows-commands/nslookup) на одной из целевых конечных точек, например `expenses.adventure-works.com`.  Полученный ответ должен содержать упомянутый выше псевдоним (`<yourAADTenantId>.tenant.runtime.msappproxy.net`).


## <a name="considerations"></a>Рекомендации


### <a name="accepted-formats"></a>Допустимые форматы

Для приложений с подстановочным знаком **внутренний URL-адрес** должен указан в формате `http(s)://*.<domain>`. 

![AppId](./media/active-directory-application-proxy-wildcard\22.png)


При настройке **внешнего URL-адреса** необходимо использовать следующий формат: `https://*.<custom domain>`. 

![AppId](./media/active-directory-application-proxy-wildcard\21.png)

Другие позиции подстановочного знака, несколько подстановочных знаков или другие строки регулярных выражений не поддерживаются и порождают ошибки.


### <a name="excluding-applications-from-the-wildcard"></a>Исключение приложений из приложения с подстановочным знаком

Приложение можно исключить из приложения с подстановочным знаком:

- опубликовав исключаемое приложение как обычное приложение; 
- включив подстановочный знак только для определенных приложений с помощью параметров DNS.  


Публикация приложения в качестве обычного приложения является предпочтительным способом исключения из приложения с подстановочным знаком. Публиковать исключенные приложения следует перед публикацией приложений с подстановочным знаком, чтобы обеспечить их исключение с самого начала. Чем определеннее приложение, тем выше его приоритет: приложение, опубликованное как `budgets.finance.adventure-works.com`, имеет приоритет над приложением `*.finance.adventure-works.com`, которое, в свою очередь, имеет приоритет над приложением `*.adventure-works.com`. 

Можно также ограничить применение подстановочного знака только определенными приложениями с помощью параметров управления DNS. Рекомендуется создать запись CNAME, которая содержит подстановочный знак и соответствует формату настроенного внешнего URL-адреса. Однако вместо этого можно указать определенные URL-адреса приложений для подстановочных знаков. Например, вместо `*.adventure-works.com` можно указать `hr.adventure-works.com`, а вместо `expenses.adventure-works.com` и `travel.adventure-works.com individually` — `000aa000-11b1-2ccc-d333-4444eee4444e.tenant.runtime.msappproxy.net`. 

При использовании этого подхода необходима еще одна запись CNAME для значения `AppId.domain`, например `00000000-1a11-22b2-c333-444d4d4dd444.adventure-works.com`, которое указывает на то же расположение. Значение **AppId** можно найти на странице свойств приложения с подстановочным знаком.

![AppId](./media/active-directory-application-proxy-wildcard\01.png)



### <a name="setting-the-homepage-url-for-the-myapps-panel"></a>Задание URL-адреса домашней страницы панели MyApps

Приложение с подстановочным знаком представлено всего одним элементом на [панели MyApps](https://myapps.microsoft.com). По умолчанию этот элемент скрыт. Чтобы отобразить его и позволить пользователям переходить на конкретную страницу, выполните следующее.

1. Следуйте указаниям по [настройке URL-адреса домашней страницы](manage-apps/application-proxy-configure-custom-home-page.md).
2. На странице свойств приложения для параметра **Show Application** (Показать приложение) задайте значение **true**.

### <a name="kerberos-constrained-delegation"></a>Ограниченное делегирование Kerberos

Для приложений, использующих [ограниченное делегирование Kerberos в качестве метода единого входа](manage-apps/application-proxy-configure-single-sign-on-with-kcd.md), имя субъекта-службы, указанное для метода единого входа, также может потребовать использования подстановочного знака. Например, может именем субъекта-службы может быть `HTTP/*.adventure-works.com`. Вам по-прежнему нужно настроить отдельные имена субъектов-служб на внутренних серверах (например, `http://expenses.adventure-works.com and HTTP/travel.adventure-works.com`).



## <a name="scenario-1-general-wildcard-application"></a>Сценарий 1. Общее приложение с подстановочным знаком

В этом сценарии требуется опубликовать три разных приложения.

- `expenses.adventure-works.com`
- `hr.adventure-works.com`
- `travel.adventure-works.com`

Все три приложения:

- используются всеми пользователями;
- используют *встроенную проверку подлинности Windows*; 
- имеют одинаковые свойства.


Опубликовать приложение с подстановочным знаком можно, выполнив действия, описанные в разделе [Публикация приложений с помощью прокси приложения Azure AD](manage-apps/application-proxy-publish-azure-portal.md). В этом сценарии предполагается:

- наличие клиента со следующим Идентификатором: `000aa000-11b1-2ccc-d333-4444eee4444e`; 

- наличие настроенного проверенного домена `adventure-works.com`;

- создание записи **CNAME**, которая указывает `*.adventure-works.com` на `000aa000-11b1-2ccc-d333-4444eee4444e.tenant.runtime.msappproxy.net`.

После выполнения [описанных действий](manage-apps/application-proxy-publish-azure-portal.md) создайте приложение прокси приложения в клиенте. В этом примере подстановочный знак используется в следующих полях.

- Внутренний URL-адрес:

    ![Внутренний URL-адрес](./media/active-directory-application-proxy-wildcard\42.png)


- Внешний URL-адрес:

    ![Внешний URL-адрес](./media/active-directory-application-proxy-wildcard\43.png)

 
- Внутреннее имя субъекта-службы приложения 

    ![Конфигурация имени субъекта-службы](./media/active-directory-application-proxy-wildcard\44.png)


Опубликовав приложение с подстановочным знаком, вы сможете получить доступ к трем приложениям, переходя по привычным URL-адресам (например, `travel.adventure-works.com`).

Конфигурация реализует следующую структуру.

![AppId](./media/active-directory-application-proxy-wildcard\05.png)

| Цвет | ОПИСАНИЕ |
| ---   | ---         |
| Синий  | Приложения явным образом опубликованы и доступны на портале Azure. |
| Серый  | Приложения доступны через родительское приложение. |




## <a name="scenario-2-general-wildcard-application-with-exception"></a>Сценарий 2. Общее приложение с подстановочным знаком с исключением

В этом сценарии помимо трех общих приложений имеется еще одно приложение `finance.adventure-works.com`, которое должно быть доступно только финансовому отделу. При текущей структуре приложений финансовое приложение было бы доступно всем сотрудникам через приложение с подстановочным знаком. Чтобы изменить это, исключите его из приложения с подстановочным знаком, настроив финансовое приложение как отдельное приложение с более строгими разрешениями.



Необходимо обеспечить наличие записи CNAME, указывающей `finance.adventure-works.com` на определенную конечную точку приложения, заданную на странице прокси приложения для приложения. В данном случае выберите `finance.adventure-works.com` указывает на `https://finance-awcycles.msappproxy.net/`. 

После выполнения [описанных действий](manage-apps/application-proxy-publish-azure-portal.md) в этом сценарии необходимо выполнить следующую настройку.


- Во **внутреннем URL-адресе** укажите **finance** вместо подстановочного знака. 

    ![Внутренний URL-адрес](./media/active-directory-application-proxy-wildcard\52.png)

- Во **внешнем URL-адресе** укажите **finance** вместо подстановочного знака. 

    ![Внешний URL-адрес](./media/active-directory-application-proxy-wildcard\53.png)

- Во внутреннем имени субъекта-службы приложения вместо подстановочного знака укажите **finance**.

    ![Конфигурация имени субъекта-службы](./media/active-directory-application-proxy-wildcard\54.png)


Эта конфигурация реализует следующий сценарий.

![Сценарий](./media/active-directory-application-proxy-wildcard\09.png)

Так как `finance.adventure-works.com` является более точным URL-адресом, чем `*.adventure-works.com`, он имеет более высокий приоритет. Пользователи, переходящие по адресу `finance.adventure-works.com`, используют функции, указанные в финансовом приложении. В этом случае доступ к `finance.adventure-works.com` имеют только сотрудники финансового отдела.

Если вы опубликовали несколько приложений для финансового отдела и используете проверенный домен `finance.adventure-works.com`, то можно опубликовать другое приложение с подстановочным знаком `*.finance.adventure-works.com`. Так как оно определено точнее, чем общее приложение `*.adventure-works.com`, оно имеет более высокий приоритет в случае, когда пользователь обращается к приложению в домене finance.


## <a name="next-steps"></a>Дополнительная информация

Ознакомьтесь также с информацией по смежным темам:

- **Личные домены**: [Работа с пользовательскими доменами в прокси приложения Azure AD](manage-apps/application-proxy-configure-custom-domain.md).

- **Публикация приложений**: [Публикация приложений с помощью прокси приложения Azure AD](manage-apps/application-proxy-publish-azure-portal.md).


