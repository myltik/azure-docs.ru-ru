---
title: Запись выражений для сопоставления атрибутов в Azure Active Directory | Документация Майкрософт
description: Узнайте, как использовать сопоставление выражений для преобразования значений атрибутов в допустимый формат при автоматической подготовке объектов приложения SaaS в Azure Active Directory.
services: active-directory
documentationcenter: ''
author: MarkusVi
manager: mtillman
ms.assetid: b13c51cd-1bea-4e5e-9791-5d951a518943
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/15/2018
ms.author: markvi
ms.openlocfilehash: f1cf83044eb4f001ba341cabd0771b267c3f996d
ms.sourcegitcommit: 59914a06e1f337399e4db3c6f3bc15c573079832
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/20/2018
---
# <a name="writing-expressions-for-attribute-mappings-in-azure-active-directory"></a>Запись выражений для сопоставления атрибутов в Azure Active Directory
При настройке подготовки для приложения SaaS одним из типов сопоставления атрибутов, которые можно указать, является сопоставление выражений. Для этого необходимо написать выражение, похожее на скрипт. Оно позволит вам преобразовать данные пользователей в форматы, более подходящие для приложений SaaS.

## <a name="syntax-overview"></a>Общие сведения о синтаксисе
Синтаксис выражений для сопоставления атрибутов напоминает функции Visual Basic для приложений (VBA).

* Все выражение должно определяться функциями, состоящими из имени и следующих за ним в скобках аргументов:  <br>
  *Имя_функции(<<аргумент 1>>, <<argument N>>)*
* Функции можно вкладывать одну в другую. Например:  <br> *Функция1(функция2(<<argument1>>))*
* В функцию можно передавать следующие три типа аргументов.
  
  1. Атрибуты, которые должны быть заключены в квадратные скобки. Например: [имя_атрибута].
  2. Строковые константы, которые должны быть заключены в двойные кавычки. Например: "США".
  3. Другие функции. Например: функция_один(<<argument1>>, функция_два(<<argument2>>)).
* Если в строковых константах необходимо использовать обратную косую черту (\) или кавычки (""), такие символы следует экранировать обратной косой чертой (\). Например: "Название компании: \"Contoso\"".

## <a name="list-of-functions"></a>Список функций
[Append](#append) &nbsp;&nbsp;&nbsp;&nbsp; [FormatDateTime](#formatdatetime) &nbsp;&nbsp;&nbsp;&nbsp; [Join](#join) &nbsp;&nbsp;&nbsp;&nbsp; [Mid](#mid) &nbsp;&nbsp;&nbsp;&nbsp; [Not](#not) &nbsp;&nbsp;&nbsp;&nbsp; [Replace](#replace) &nbsp;&nbsp;&nbsp;&nbsp; [SingleAppRoleAssignment](#singleapproleassignment)&nbsp;&nbsp;&nbsp;&nbsp; [StripSpaces](#stripspaces) &nbsp;&nbsp;&nbsp;&nbsp; [Switch](#switch)

- - -
### <a name="append"></a>Добавить
**Функция:**<br> Append(source, suffix)

**Описание.**<br> Получает исходное строковое значение и присоединяет к его концу суффикс.

**Параметры:**<br> 

| ИМЯ | Обязательно/повторяется | type | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно |Строка |Как правило, имя атрибута из исходного объекта. |
| **суффикс** |Обязательно |Строка |Строка, которую необходимо присоединить к концу исходного значения. |

- - -
### <a name="formatdatetime"></a>FormatDateTime
**Функция:**<br> FormatDateTime(source, inputFormat, outputFormat)

**Описание.**<br> Преобразовывает строку даты из одного формата в другой.

**Параметры:**<br> 

| ИМЯ | Обязательно/повторяется | type | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно |Строка |Как правило, имя атрибута из исходного объекта. |
| **входной_формат** |Обязательно |Строка |Предполагаемый формат исходного значения. Поддерживаемые форматы см. по адресу [http://msdn.microsoft.com/library/8kb3ddd4%28v=vs.110%29.aspx](http://msdn.microsoft.com/library/8kb3ddd4%28v=vs.110%29.aspx). |
| **выходной_формат** |Обязательно |Строка |Формат вывода даты. |

- - -
### <a name="join"></a>Объединение
**Функция:**<br> Join(separator, source1, source2, …)

**Описание.**<br> Функция Join() схожа с функцией Append() за исключением того, что она может объединять несколько строковых значений **source** в одну строку. При этом каждое значение разделяется строкой **separator**.

Если одно из исходных значений является атрибутом с несколькими значениями, все значения в этом атрибуте будут объединены, а между ними будут значения разделителя.

**Параметры:**<br> 

| ИМЯ | Обязательно/повторяется | type | Заметки |
| --- | --- | --- | --- |
| **разделитель** |Обязательно |Строка |Строка, используемая для разделения исходных значений, когда они объединяются в одну строку. Если разделитель не требуется, может не иметь значения (""). |
| **source1  … sourceN ** |Обязательно, количество повторов может меняться |Строка |Строковые значения для объединения. |

- - -
### <a name="mid"></a>Mid
**Функция:**<br> Mid(source, start, length)

**Описание.**<br> Возвращает подстроку исходного значения. Подстрокой является строка, содержащая только некоторые символы из исходной строки.

**Параметры:**<br> 

| ИМЯ | Обязательно/повторяется | type | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно |Строка |Как правило, имя атрибута. |
| **start** |Обязательно |целое число |Индекс положения в строке **source**, откуда должна начинаться подстрока. Первый символ в строке будет иметь индекс 1, второй символ — индекс 2 и т. д. |
| **длина** |Обязательно |целое число |Длина подстроки. Если длина превышает размер **исходной** строки, функция возвращает подстроку из **начала** индекса и до конца **исходной** строки. |

- - -
### <a name="not"></a>not
**Функция:**<br> Not(источник)

**Описание.**<br> Обращает логическое значение **source**. Если значение **source** равно *True*, возвращается значение *False*. В противном случае возвращает значение*True*.

**Параметры:**<br> 

| ИМЯ | Обязательно/повторяется | type | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно |Логическая строка |Предполагаемые значения **source** : True или False. |

- - -
### <a name="replace"></a>Замените
**Функция:**<br> Replace(source, oldValue, regexPattern, regexGroupName, replacementValue, replacementAttributeName, template)

**Описание.**<br>
Заменяет значения в пределах строки. Ее работа зависит от указанных параметров.

* Если указаны параметры **oldValue** и **replacementValue**:
  
  * заменяет все вхождения старого значения в источнике значениями замены.
* Если указаны параметры **oldValue** и **template**:
  
  * заменяет все экземпляры **oldValue** в **template** значением **source**.
* Если указаны параметры **regexPattern**, **regexGroupName**, **replacementValue**:
  
  * заменяет все значения, сопоставимые с шаблоном старого значения регулярного выражения в исходной строке, значением замены.
* Если указаны параметры **regexPattern**, **regexGroupName**, **replacementPropertyName**:
  
  * Если для **source** не указано значение, возвращается **source**.
  * Если для **source** не указано значение, используется **regexPattern** и **regexGroupName** для извлечения значения замены из свойства с **replacementPropertyName**. В качестве результата возвращается значение замены.

**Параметры:**<br> 

| ИМЯ | Обязательно/повторяется | type | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно |Строка |Как правило, имя атрибута из исходного объекта. |
| **старое_значение** |Необязательно |Строка |Значение для замены в **source** или **template**. |
| **шаблон_регулярного_выражения** |Необязательно |Строка |Шаблон регулярного выражения для значения, заменяемого в **source**. Или, при использовании имени свойства замены, шаблон для извлечения значения из свойства замены. |
| **имя_группы_регулярного_выражения** |Необязательно |Строка |Имя группы в **regexPattern**. Значение этой группы будет извлечено из свойства замены как значение замены, только если используется имя свойства замены. |
| **значение_замены** |Необязательно |Строка |Новое значение для замены старого. |
| **имя_атрибута_замены** |Необязательно |Строка |Имя атрибута, используемого для значения замены, если источник не имеет значение. |
| **шаблон** |Необязательно |Строка |Если указано значение **template**, будет выполнен поиск **oldValue** в шаблоне с последующей заменой исходным значением. |

- - -
### <a name="singleapproleassignment"></a>SingleAppRoleAssignment
**Функция:**<br> SingleAppRoleAssignment([appRoleAssignments])

**Описание.**<br> Возвращает один объект appRoleAssignment из списка всех объектов appRoleAssignment, назначенных пользователю для заданного приложения. Эта функция необходима для преобразования объекта appRoleAssignment в отдельную строку имени роли. Обратите внимание на то, что рекомендуется назначать только один объект appRoleAssignment одному пользователю одновременно. При назначении нескольких ролей невозможно предсказать возвращаемую строку роли.

**Параметры:**<br> 

| ИМЯ | Обязательно/повторяется | type | Заметки |
| --- | --- | --- | --- |
| **[appRoleAssignments]** |Обязательно |Строка |Объект **[appRoleAssignments]**. |

- - -
### <a name="stripspaces"></a>StripSpaces
**Функция:**<br> StripSpaces(source)

**Описание.**<br> Удаляет все пробелы (« ») из исходной строки.

**Параметры:**<br> 

| ИМЯ | Обязательно/повторяется | type | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно |Строка |**источник** , которое необходимо обновить. |

- - -
### <a name="switch"></a>Switch
**Функция:**<br> Switch(source, defaultValue, key1, value1, key2, value2, …)

**Описание.**<br> Если значение **source** соответствует **key**, возвращается **value** для этого параметра **key**. Если значение **source** не соответствует ни одному параметру, то возвращается **defaultValue**.  Параметры **key** и **value** должны всегда быть парными. Для функции необходимо всегда использовать четное количество параметров.

**Параметры:**<br> 

| ИМЯ | Обязательно/повторяется | type | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно |Строка |**Source** , которое необходимо обновить. |
| **defaultValue** |Необязательно |Строка |Значение по умолчанию, которое необходимо использовать, если источник не соответствует ни одному ключу. Может быть пустой строкой (""). |
| **key** |Обязательно |Строка |Параметр **key**, с которым сравнивается значение **source**. |
| **значение** |Обязательно |Строка |Значение, которым заменяется значение **source** , соответствующее ключу. |

## <a name="examples"></a>Примеры
### <a name="strip-known-domain-name"></a>Извлечение известного доменного имени
Необходимо извлечь известное доменное имя из адреса электронной почты пользователя, чтобы получить имя пользователя. <br>
Например, если домен — contoso.com, можно использовать следующее выражение:

**Выражение:** <br>
`Replace([mail], "@contoso.com", , ,"", ,)`

**Пример ввода и вывода:** <br>

* **Входные данные** (mail): "john.doe@contoso.com"
* **Выходные данные**: john.doe

### <a name="append-constant-suffix-to-user-name"></a>Добавление суффикса константы к имени пользователя
При использовании Salesforce Sandbox может потребоваться добавить дополнительный суффикс ко всем именам пользователей перед их синхронизацией.

**Выражение:** <br>
`Append([userPrincipalName], ".test"))`

**Пример ввода и вывода:** <br>

* **Входные данные**: (userPrincipalName): "John.Doe@contoso.com"
* **Выходные данные**: "John.Doe@contoso.com.test"

### <a name="generate-user-alias-by-concatenating-parts-of-first-and-last-name"></a>Создание псевдонима пользователя путем сцепления частей имени и фамилии
Необходимо создать псевдоним пользователя, используя первые три буквы имени и первые пять букв фамилии пользователя.

**Выражение:** <br>
`Append(Mid([givenName], 1, 3), Mid([surname], 1, 5))`

**Пример ввода и вывода:** <br>

* **ВВОД** : (givenName): "John"
* **ВВОД** : (surname): "Doe"
* **Выходные данные**: "JohDoe"

### <a name="remove-diacritics-from-a-string-and-convert-to-lowercase"></a>Удаление диакритических знаков из строки и преобразование символов в нижний регистр
Необходимо удалить специальные символы из строки и преобразовать символы верхнего регистра в нижний.

**Выражение:** <br>
`Replace(Replace(Replace(Replace(Replace(Replace(Replace( Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace( Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace([givenName], , "([Øø])", , "oe", , ), , "[Ææ]", , "ae", , ), , "([äãàâãåáąÄÃÀÂÃÅÁĄA])", , "a", , ), , "([B])", , "b", , ), , "([CçčćÇČĆ])", , "c", , ), , "([ďĎD])", , "d", , ), , "([ëèéêęěËÈÉÊĘĚE])", , "e", , ), , "([F])", , "f", , ), , "([G])", , "g", , ), , "([H])", , "h", , ), , "([ïîìíÏÎÌÍI])", , "i", , ), , "([J])", , "j", , ), , "([K])", , "k", , ), , "([ľłŁĽL])", , "l", , ), , "([M])", , "m", , ), , "([ñńňÑŃŇN])", , "n", , ), , "([öòőõôóÖÒŐÕÔÓO])", , "o", , ), , "([P])", , "p", , ), , "([Q])", , "q", , ), , "([řŘR])", , "r", , ), , "([ßšśŠŚS])", , "s", , ), , "([TŤť])", , "t", , ), , "([üùûúůűÜÙÛÚŮŰU])", , "u", , ), , "([V])", , "v", , ), , "([W])", , "w", , ), , "([ýÿýŸÝY])", , "y", , ), , "([źžżŹŽŻZ])", , "z", , ), " ", , , "", , )`

**Пример ввода и вывода:** <br>

* **Входные данные** (givenName): "Zoë".
* **Выходные данные**: "zoe".

### <a name="output-date-as-a-string-in-a-certain-format"></a>Вывод даты в виде строки в определенном формате
Необходимо отправить в приложение SaaS даты в определенном формате. <br>
Например, требуется отформатировать даты для ServiceNow.

**Выражение:** <br>

`FormatDateTime([extensionAttribute1], "yyyyMMddHHmmss.fZ", "yyyy-MM-dd")`

**Пример ввода и вывода:**

* **ВВОД** : (extensionAttribute1): "20150123105347.1Z"
* **Выходные данные**: "2015-01-23"

### <a name="replace-a-value-based-on-predefined-set-of-options"></a>Замена значения на основе предопределенного набора параметров
Необходимо определить часовой пояс пользователя на основе кода государства, сохраненного в Azure AD. <br>
Если код государства не совпадает с предопределенными параметрами, используйте значение по умолчанию «Australia/Sydney».

**Выражение:** <br>

`Switch([state], "Australia/Sydney", "NSW", "Australia/Sydney","QLD", "Australia/Brisbane", "SA", "Australia/Adelaide")`

**Пример ввода и вывода:**

* **ВВОД** : (state): "QLD"
* **ВЫВОД**: "Australia/Brisbane"

## <a name="related-articles"></a>Связанные статьи
* [Указатель статьей по управлению приложениями в Azure Active Directory](active-directory-apps-index.md)
* [Автоматическая подготовка пользователей и ее отзыв для приложений SaaS](active-directory-saas-app-provisioning.md)
* [Настройка сопоставления атрибутов для подготовки пользователей](active-directory-saas-customizing-attribute-mappings.md)
* [Фильтры области для подготовки пользователей](active-directory-saas-scoping-filters.md)
* [Автоматическая подготовка пользователей и групп из Azure Active Directory в приложениях с использованием SCIM](active-directory-scim-provisioning.md)
* [Уведомления о подготовке учетных записей](active-directory-saas-account-provisioning-notifications.md)
* [Список учебников по интеграции приложений SaaS](active-directory-saas-tutorial-list.md)

