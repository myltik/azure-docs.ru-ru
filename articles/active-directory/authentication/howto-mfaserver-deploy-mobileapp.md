---
title: Веб-служба мобильного приложения сервера Azure MFA | Документация Майкрософт
description: Приложение Microsoft Authenticator предлагает возможность дополнительной внешней аутентификации.  Это позволяет серверу Azure Multi-Factor Authentication отправлять push-уведомления пользователям.
services: multi-factor-authentication
documentationcenter: ''
author: MicrosoftGuyJFlo
manager: mtillman
ms.assetid: 6c8d6fcc-70f4-4da4-9610-c76d66635b8b
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 08/23/2017
ms.author: joflore
ms.reviewer: richagi
ms.custom: it-pro
ms.openlocfilehash: 4a6d4f903ff47970cb1fc6b3964ea78c735d5113
ms.sourcegitcommit: fa493b66552af11260db48d89e3ddfcdcb5e3152
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2018
---
# <a name="enable-mobile-app-authentication-with-azure-multi-factor-authentication-server"></a>Включение аутентификации мобильных приложений с помощью сервера Многофакторной идентификации Azure

Приложение Microsoft Authenticator предлагает возможность дополнительной внешней проверки. Вместо автоматического телефонного вызова или отправки SMS пользователю при входе в систему служба Многофакторной идентификации Azure отправляет push-уведомление в приложение Microsoft Authenticator, которое установлено на смартфоне или планшете пользователя. Чтобы выполнить вход, пользователю в приложении нужно просто коснуться элемента **Проверить** (или ввести ПИН-код и коснуться элемента "Проверить подлинность").

Использование мобильного приложения для двухфакторной проверки используется является предпочтительным, когда телефонная связь ненадежна. При использовании такого приложения, как генератор OATH-токенов, не требуется подключение к сети или Интернету.

В зависимости от среды вам может потребоваться развернуть веб-службу мобильного приложения на серверном компьютере, где установлен сервер Многофакторной идентификации Azure, или на другом сервере с выходом в Интернет.

> [!IMPORTANT]
> Если вы установили сервер многофакторной проверки подлинности версии 8.0 или выше, большая часть описанных ниже действий не требуется. Аутентификацию мобильного приложения можно настроить, следуя инструкциям в разделе [Настройка мобильного приложения](#configure-the-mobile-app-settings-in-the-azure-multi-factor-authentication-server).

## <a name="requirements"></a>Требования

Чтобы использовать приложение Microsoft Authenticator и чтобы оно успешно взаимодействовало с веб-службой мобильного приложения, необходимо выполнить следующие условия.

* Сервер Многофакторной идентификации Azure версии 6.0 и выше
* Необходимо установить веб-службу мобильного приложения на веб-сервере с выходом в Интернет, на котором выполняются службы Microsoft® [Internet Information Services (IIS) 7.x или более поздней версией](http://www.iis.net/).
* Необходимо установить и зарегистрировать компонент ASP.NET 4.0.30319, а также установить для него значение "Разрешено".
* К обязательным службам роли относятся ASP.NET и совместимость с метабазой IIS 6.
* Веб-служба мобильного приложения должна быть доступна через общедоступный URL-адрес.
* Веб-служба мобильного приложения должна быть защищена сертификатом SSL.
* Необходимо установить пакет SDK веб-службы для Многофакторной идентификации Azure в IIS 7.x или более поздней версии на том же **компьютере, на котором установлен сервер Многофакторной идентификации Azure**.
* Безопасность пакета SDK веб-службы для Многофакторной идентификации Azure должен обеспечивать сертификат SSL.
* Веб-служба мобильного приложения должна иметь возможность подключиться к пакету SDK веб-службы для Многофакторной идентификации Azure по протоколу SSL.
* Веб-служба мобильного приложения должна иметь возможность пройти аутентификацию для пакета SDK веб-службы для Многофакторной идентификации Azure с использованием данных учетной записи службы, которая входит в группу безопасности PhoneFactor Admins. Эта учетная запись службы и группа существуют в Active Directory, если сервер Многофакторной идентификации Azure установлен на сервере, присоединенном к домену. Эта учетная запись службы и группа существуют локально на сервере Многофакторной идентификации Azure, если он не присоединен к домену.

## <a name="install-the-mobile-app-web-service"></a>Установить веб-службу мобильного приложения.

Перед установкой веб-службы мобильного приложения необходимо учитывать следующее.

* Устанавливать веб-службу мобильного приложения необязательно при наличии версии 8.0 и выше. В этом случае выполните только шаги из раздела [Настройка мобильного приложения](#configure-the-mobile-app-settings-in-the-azure-multi-factor-authentication-server).
* Требуется учетная запись службы, которая принадлежит к группе PhoneFactor Admins. Вы можете использовать ту же учетную запись, что и для установки пользовательского портала.
* Рекомендуется открыть веб-браузер на веб-сервере с выходом в Интернет и перейти по URL-адресу пакета SDK веб-службы, указанному в файле web.config. Если веб-служба успешно откроется в браузере, у вас будут запрошены учетные данные для входа. Введите имя пользователя и пароль, которые были введены в файл web.config, в точности так, как они отображены в файле. Убедитесь, что не отображаются предупреждения или ошибки сертификата.
* Если обратный прокси-сервер или брандмауэр размещен перед веб-сервером веб-службы мобильного приложения и выполняет разгрузку SSL, то вы можете изменить файл web.config веб-службы мобильного приложения, чтобы веб-служба мобильного приложения могла использовать протокол HTTP вместо HTTPS. Для подключения мобильного приложения брандмауэру или обратному прокси-серверу по-прежнему требуется протокол SSL. Добавьте приведенный ключ в раздел \<appSettings\>.

        <add key="SSL_REQUIRED" value="false"/>

### <a name="install-the-web-service-sdk"></a>Установить пакет SDK веб-службы.

В обоих сценариях, если пакет SDK веб-службы для Многофакторной идентификации Azure еще **не** установлен на сервере Многофакторной идентификации Azure (MFA), выполните инструкции, приведенные ниже.

1. Откройте консоль сервера Многофакторной идентификации.
2. Перейдите в раздел **SDK веб-службы** и нажмите кнопку **Установить SDK веб-службы**.
3. Завершите установку с использованием значений по умолчанию, если не нужно изменять их по какой-то причине.
4. Привяжите SSL-сертификат к сайту в IIS.

Если у вас есть вопросы о настройке SSL-сертификата на сервере IIS, ознакомьтесь со статьей [How to Set Up SSL on IIS 7](https://docs.microsoft.com/iis/manage/configuring-security/how-to-set-up-ssl-on-iis) (Как настроить SSL-сертификат на сервере IIS 7).

Пакет SDK веб-службы должен быть защищен сертификатом SSL. Для этой цели подходит самозаверяющий сертификат. Импортируйте сертификат в хранилище "Доверенные корневые центры сертификации" учетной записи локального компьютера на веб-сервере пользовательского портала, чтобы этот сертификат был доверенным при подключении SSL.

![Настройка конфигурации сервера MFA, вкладка "SDK веб-службы"](./media/howto-mfaserver-deploy-mobileapp/sdk.png)

### <a name="install-the-service"></a>Установка службы

1. **На сервере Многофакторной идентификации** выберите папку установки.
2. Перейдите в папку, в которой установлен сервер Многофакторной идентификации Azure. По умолчанию используется папка **C:\Program Files\Azure Multi-factor Authentication**.
3. Найдите файл установки **MultiFactorAuthenticationMobileAppWebServiceSetup64**. Если на сервере **нет** выхода в Интернет, скопируйте файл установки на сервер с выходом в Интернет.
4. Если на сервере MFA **нет** выхода в Интернет, перейдите на **сервер с выходом в Интернет**.
5. Запустите файл установки **MultiFactorAuthenticationMobileAppWebServiceSetup64** от имени администратора и при необходимости измените сайт и замените имя виртуального каталога коротким именем.
6. По завершении установки перейдите в расположение **C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService** (или в соответствующий каталог на основе имени виртуального каталога) и измените файл web.config.

   * Найдите раздел **WEB_SERVICE_SDK_AUTHENTICATION_USERNAME** и замените **value=""** на **value="DOMAIN\User"** где DOMAIN\User — учетная запись службы, принадлежащая группе PhoneFactor Admins.
   * Найдите раздел **WEB_SERVICE_SDK_AUTHENTICATION_PASSWORD** и измените **value=""** на **value="Password"**, где Password — это пароль для учетной записи службы, указанной в предыдущей строке.
   * Найдите параметр **pfMobile App Web Service_pfwssdk_PfWsSdk** и измените значение **http://localhost:4898/PfWsSdk.asmx** на URL-адрес пакета SDK для веб-службы (например, https://mfa.contoso.com/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx).
   * Сохраните файл Web.Config и закройте Блокнот.

   > [!NOTE]
   > Так как для этого подключения используется протокол SSL, в ссылке на пакет SDK веб-службы нужно указать **полное доменное имя (FQDN)**, а **не IP-адрес**. SSL-сертификат выдается для имени FQDN, и используемый URL-адрес должен соответствовать имени в сертификате.

7. Если веб-сайт, на котором установлена веб-служба мобильного приложения, еще не привязан к публично подписанному сертификату, установите сертификат на сервере, затем откройте диспетчер IIS и привяжите сертификат к этому веб-сайту.
8. Откройте веб-браузер на любом компьютере и перейдите по URL-адресу на страницу, с которой была установлена веб-служба мобильного приложения (например, https://mfa.contoso.com/MultiFactorAuthMobileAppWebService). Убедитесь, что не отображаются предупреждения или ошибки сертификата.
9. Дополнительные сведения о методах, доступных в пакете SDK для веб-служб, см. в файле справки сервера MFA.
10. Теперь, когда веб-служба мобильного приложения установлена, необходимо настроить сервер Многофакторной идентификации Azure для работы с порталом.

## <a name="configure-the-mobile-app-settings-in-the-azure-multi-factor-authentication-server"></a>Настроить параметры мобильного приложения на сервере Многофакторной идентификации Azure.

1. В консоли сервера Многофакторной идентификации щелкните значок пользовательского портала. Если пользователям разрешено управлять своими методами аутентификации, на вкладке "Параметры" в группе **Разрешить пользователям выбирать метод** установите флажок **Мобильное приложение**. Если не включить эту функцию, пользователям придется обращаться в службу поддержки для завершения активации мобильного приложения.
2. Установите флажок **Разрешить пользователям активировать мобильное приложение**.
3. Установите флажок **Разрешить регистрацию пользователей**.
4. Щелкните значок **мобильного приложения**.
5. Если вы используете версию 8.0 или выше, пропустите следующий шаг — введите URL-адрес, который используется с виртуальным каталогом, созданным при установке MultiFactorAuthenticationMobileAppWebServiceSetup64 (например, https://mfa.contoso.com/MultiFactorAuthMobileAppWebService/) в поле **URL-адрес веб-службы мобильного приложения:**.
6. В поле **Имя учетной записи** введите название компании или организации, которое будет отображаться в мобильном приложений для этой учетной записи.
   ![Настройка сервера MFA, параметры для мобильного приложения](./media/howto-mfaserver-deploy-mobileapp/mobile.png)

## <a name="next-steps"></a>Дополнительная информация

- [Расширенные сценарии с использованием Многофакторной идентификации Azure и VPN сторонних поставщиков](howto-mfaserver-nps-vpn.md).
