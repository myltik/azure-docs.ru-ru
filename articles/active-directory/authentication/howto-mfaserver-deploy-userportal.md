---
title: Пользовательский портал на сервере MFA Azure | Документация Майкрософт
description: Начало работы с Azure MFA и пользовательским порталом.
services: multi-factor-authentication
ms.service: active-directory
ms.component: authentication
ms.topic: get-started-article
ms.date: 08/23/2017
ms.author: joflore
author: MicrosoftGuyJFlo
manager: mtillman
ms.reviewer: richagi
ms.openlocfilehash: 38f75b8fc48f6fdcafd4c6ae25ec0f52641b2c05
ms.sourcegitcommit: 870d372785ffa8ca46346f4dfe215f245931dae1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/08/2018
---
# <a name="user-portal-for-the-azure-multi-factor-authentication-server"></a>Пользовательский портал для сервера Многофакторной идентификации Azure

Пользовательский портал — это веб-сайт IIS, с помощью которого пользователи могут зарегистрироваться в службе Многофакторной идентификации Microsoft Azure (MFA) и управлять своими учетными записями. Пользователь может изменить свой номер телефона, ПИН-код или обойти двухфакторную проверку подлинности при следующем входе в систему.

Пользователи входят на пользовательский портал, используя привычное имя пользователя и пароль, а затем отвечают на телефонный вызов при двухфакторной проверке подлинности или на секретные вопросы, чтобы пройти проверку подлинности. Если регистрация пользователей разрешена, они настраивают свой номер телефона и ПИН-код при первом входе на пользовательский портал.

Для администраторов пользовательского портала можно настроить и предоставить разрешение на добавление новых и обновление существующих пользователей.

В зависимости от среды вам может потребоваться развернуть пользовательский портал на том же сервере, где установлен сервер Многофакторной идентификации, или на другом сервере, доступном в Интернете.

![Пользовательский портал MFA](./media/howto-mfaserver-deploy-userportal/portal.png)

> [!NOTE]
> Пользовательский портал доступен только на сервере Многофакторной идентификации. При использовании службы Многофакторной идентификации в облаке предоставьте пользователям ссылку на статью [Настройка учетной записи для двухфакторной проверки подлинности](./../../multi-factor-authentication/end-user/multi-factor-authentication-end-user-first-time.md) или [Управление параметрами двухфакторной проверки подлинности](./../../multi-factor-authentication/end-user/multi-factor-authentication-end-user-manage-settings.md).

## <a name="install-the-web-service-sdk"></a>Установить пакет SDK веб-службы.

В обоих сценариях, если пакет SDK веб-службы для Многофакторной идентификации Azure еще **не** установлен на сервере Многофакторной идентификации Azure (MFA), выполните инструкции, приведенные ниже.

1. Откройте консоль сервера Многофакторной идентификации.
2. Перейдите в раздел **SDK веб-службы** и нажмите кнопку **Установить SDK веб-службы**.
3. Завершите установку с использованием значений по умолчанию, если не нужно изменять их по какой-то причине.
4. Привяжите SSL-сертификат к сайту в IIS.

Если у вас есть вопросы о настройке SSL-сертификата на сервере IIS, ознакомьтесь со статьей [How to Set Up SSL on IIS 7](https://docs.microsoft.com/iis/manage/configuring-security/how-to-set-up-ssl-on-iis) (Как настроить SSL-сертификат на сервере IIS 7).

Пакет SDK веб-службы должен быть защищен сертификатом SSL. Для этой цели подходит самозаверяющий сертификат. Импортируйте сертификат в хранилище "Доверенные корневые центры сертификации" учетной записи локального компьютера на веб-сервере пользовательского портала, чтобы этот сертификат был доверенным при подключении SSL.

![Настройка конфигурации сервера MFA, вкладка "SDK веб-службы"](./media/howto-mfaserver-deploy-userportal/sdk.png)

## <a name="deploy-the-user-portal-on-the-same-server-as-the-azure-multi-factor-authentication-server"></a>Развертывание пользовательского портала на сервере, на котором расположен сервер Многофакторной идентификации Azure

Чтобы установить пользовательский портал на **том же сервере**, на котором установлен сервер Многофакторной идентификации Azure, нужно выполнить следующие условия:

* Необходимо установить службы IIS, включая ASP.NET и роль совместимости метабазы IIS 6 (для IIS 7 или более поздней версии).
* Иметь учетную запись с правами администратора для компьютера и домена, если это применимо. Чтобы создать группы безопасности Active Directory для учетной записи, необходимо иметь разрешения.
* Защитите пользовательский портал с помощью SSL-сертификата.
* Защитите пакет SDK веб-службы для Многофакторной идентификации Azure с помощью сертификата SSL.

Чтобы развернуть пользовательский портал, сделайте следующее:

1. Откройте консоль сервера Многофакторной идентификации Azure, в меню слева щелкните значок **Пользовательский портал**, а затем выберите **Install User Portal** (Установить пользовательский портал).
2. Завершите установку с использованием значений по умолчанию, если не нужно изменять их по какой-то причине.
3. Привяжите SSL-сертификат к сайту в IIS.

   > [!NOTE]
   > Этот сертификат SSL обычно является публично подписанным SSL-сертификатом.

4. Откройте веб-браузер на любом компьютере и перейдите по URL-адресу, с использованием которого установлен пользовательский портал (например, https://mfa.contoso.com/MultiFactorAuth). Убедитесь, что не отображаются предупреждения или ошибки сертификата.

![Установка пользовательского портала сервера MFA](./media/howto-mfaserver-deploy-userportal/install.png)

Если у вас есть вопросы о настройке SSL-сертификата на сервере IIS, ознакомьтесь со статьей [How to Set Up SSL on IIS 7](https://docs.microsoft.com/iis/manage/configuring-security/how-to-set-up-ssl-on-iis) (Как настроить SSL-сертификат на сервере IIS 7).

## <a name="deploy-the-user-portal-on-a-separate-server"></a>Развертывание пользовательского портала на отдельном сервере

Если сервер, на котором установлен сервер Многофакторной идентификации Azure, недоступен в Интернете, необходимо установить пользовательский портал на **отдельном сервере с выходом в Интернет**.

Если организация использует приложение Microsoft Authenticator в качестве одного из методов проверки и необходимо развернуть пользовательский портал на отдельном сервере, выполните следующие требования:

* Используйте версию 6.0 или более позднюю версию сервера Многофакторной идентификации Azure.
* Установите пользовательский портал на веб-сервере с выходом в Интернет под управлением Microsoft IIS, начиная с версии 6.x и выше.
* Если используется IIS 6.x, убедитесь, что версия ASP.NET 2.0.50727 установлена и зарегистрирована и для нее задано значение **Разрешено**.
* При использовании IIS 7.x или более поздней версии убедитесь, что для служб IIS включена обычная проверка подлинности, ASP.NET и обеспечена совместимость с метабазой IIS 6.
* Защитите пользовательский портал с помощью SSL-сертификата.
* Защитите пакет SDK веб-службы для Многофакторной идентификации Azure с помощью сертификата SSL.
* Пользовательский портал должен иметь возможность подключаться к пакету SDK веб-службы Многофакторной идентификации Azure по протоколу SSL.
* Пользовательский портал должен иметь возможность выполнить проверку подлинности для пакета SDK веб-службы Многофакторной идентификации Azure с использованием учетных данных учетной записи службы, которая входит в группу безопасности PhoneFactor Admins. Эта учетная запись службы и группа должны размещаться в Active Directory, если сервер Многофакторной идентификации установлен на сервере, присоединенном к домену. Эта учетная запись службы и группа существуют локально на сервере Многофакторной идентификации Azure, если он не присоединен к домену.

Чтобы установить пользовательский портал на сервере, отличном от сервера Многофакторной идентификации Azure, нужно выполнить следующее.

1. **На сервере MFA** перейдите в папку установки (пример: C:\Program Files\Multi-Factor Authentication Server) и скопируйте файл **MultiFactorAuthenticationUserPortalSetup64** в расположение, доступное для сервера, доступного в Интернете, где выполняется установка.
2. **На сервере, доступном в Интернете**, запустите файл установки MultiFactorAuthenticationUserPortalSetup64 от имени администратора и при необходимости измените сайт и замените имя виртуального каталога коротким именем.
3. Привяжите SSL-сертификат к сайту в IIS.

   > [!NOTE]
   > Этот сертификат SSL обычно является публично подписанным SSL-сертификатом.

4. Перейдите к папке **C:\inetpub\wwwroot\MultiFactorAuth**
5. Измените файл Web.Config в блокноте

    * Найдите раздел **USE_WEB_SERVICE_SDK** и замените **value="false"** на **value="true"**
    * Найдите раздел **WEB_SERVICE_SDK_AUTHENTICATION_USERNAME** и замените **value=""** на **value="DOMAIN\User"** где DOMAIN\User — учетная запись службы, принадлежащая группе PhoneFactor Admins.
    * Найдите раздел **WEB_SERVICE_SDK_AUTHENTICATION_PASSWORD** и измените **value=""** на **value="Password"**, где Password — это пароль для учетной записи службы, указанной в предыдущей строке.
    * Найдите значение **https://www.contoso.com/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx** и измените этот заполнитель для URL-адреса на URL-адрес пакета SDK веб-службы, который мы установили на шаге 2.
    * Сохраните файл Web.Config и закройте Блокнот.

6. Откройте веб-браузер на любом компьютере и перейдите по URL-адресу, с использованием которого установлен пользовательский портал (например, https://mfa.contoso.com/MultiFactorAuth). Убедитесь, что не отображаются предупреждения или ошибки сертификата.

Если у вас есть вопросы о настройке SSL-сертификата на сервере IIS, ознакомьтесь со статьей [How to Set Up SSL on IIS 7](https://docs.microsoft.com/iis/manage/configuring-security/how-to-set-up-ssl-on-iis) (Как настроить SSL-сертификат на сервере IIS 7).

## <a name="configure-user-portal-settings-in-the-azure-multi-factor-authentication-server"></a>Настройка параметров пользовательского портала на сервере Многофакторной идентификации Azure

Теперь, когда пользовательский портал установлен, необходимо настроить сервер Многофакторной идентификации Azure для работы с порталом.

1. В консоли сервера Многофакторной идентификации Azure щелкните значок **пользовательского портала**. На вкладке "Параметры" в текстовом поле **User Portal URL** (URL-адрес пользовательского портала) введите URL-адрес пользовательского портала. Если включена функция электронной почты, этот URL-адрес будет вставляться в сообщения, отправляемые пользователям в процессе их импорта на сервер Многофакторной идентификации Azure.
2. Выберите параметры, которые необходимо использовать на пользовательском портале. Например, если пользователям разрешено выбирать методы проверки подлинности, убедитесь, что установлен флажок **Разрешить пользователям выбирать метод** и что указаны методы для выбора.
3. Определите администраторов на вкладке **Администраторы**. Вы можете создавать детализированные административные разрешения, используя флажки и раскрывающиеся меню в полях добавления или изменения.

Дополнительная настройка
- **Вопросы безопасности** — определите утвержденные контрольные вопросы для своей среды и язык, на котором они отображаются.
- **Переданные сеансы** — настройте интеграцию пользовательского портала с веб-сайтом на основе форм при помощи MFA.
- **Доверенные IP-адреса** — разрешите пользователям пропускать MFA при проверке подлинности с доверенных IP-адресов или диапазонов.

![Настройка пользовательского портала сервера MFA](./media/howto-mfaserver-deploy-userportal/config.png)

Сервер Многофакторной идентификации Azure предоставляет несколько параметров для пользовательского портала. Следующая таблица содержит список этих параметров и объяснение их использования.

| Параметры пользовательского портала | ОПИСАНИЕ |
|:--- |:--- |
| URL-адрес пользовательского портала | Введите URL-адрес размещения портала. |
| Основная проверка подлинности | Укажите тип проверки подлинности при входе в систему на портале. Проверка подлинности Windows, Radius или LDAP. |
| Разрешить пользователям входить в систему | Позволяет пользователю ввести имя пользователя и пароль на странице входа для пользовательского портала. Если этот параметр не выбран, поля будут недоступны. |
| Разрешить регистрацию пользователей | Позволяет пользователю зарегистрироваться в службе Многофакторной идентификации, открывая окно настройки, которое запрашивает у него дополнительные сведения, например номер телефона. Запрос дополнительного номера телефона позволяет пользователям указать второй номер телефона. Запрос OATH-токена сторонних производителей позволяет пользователям указать его. |
| Разрешить пользователям инициировать одноразовый обход проверки | Позволяет пользователям инициировать одноразовый обход проверки. Выбранный параметр вступит в силу при следующем входе пользователя в систему. Запрос времени действия обхода проверки позволяет пользователю изменить время действия обхода проверки по умолчанию в 300 секунд. Если пользователь не изменил время действия, обход проверки действителен только в течение 300 секунд. |
| Разрешить пользователям выбирать способ связи | Позволяет пользователю выбрать свой основной способ связи. Это может быть телефонный звонок, текстовое сообщение, мобильное приложение или OATH-токен. |
| Разрешить пользователям выбирать язык | Позволяет пользователям изменить язык для телефонного вызова, текстового сообщения, мобильного приложения или OATH-токена. |
| Разрешить пользователям активировать мобильное приложение | Позволяет пользователям создать код активации для завершения процесса активации мобильного приложения, используемого с сервером.  Кроме того, можно задать количество устройств, на которых можно активировать приложение (от 1 до 10). |
| Использовать секретные вопросы для резервного входа | Позволяет использовать секретные вопросы при сбое двухфакторной проверки подлинности. Можно указать количество секретных вопросов, на которые нужно дать верные ответы. |
| Разрешить пользователям привязывать OATH-токены сторонних производителей | Позволяет пользователю указать OATH-токен сторонних производителей. |
| Использовать OATH-токен для резервного входа | Позволяет использовать OATH-токен при сбое двухфакторной проверки подлинности. Также можно указать время ожидания сеанса в минутах. |
| Включение ведения журналов | Включает ведение журнала на пользовательском портале. Файлы журнала расположены в папке: C:\Program Files\Multi-Factor Authentication Server\Logs. |

Эти параметры становятся доступными для пользователя на портале, как только они будут включены и пользователь войдет на пользовательский портал.

![Параметры пользовательского портала](./media/howto-mfaserver-deploy-userportal/portalsettings.png)

### <a name="self-service-user-enrollment"></a>Самостоятельная регистрация пользователей

Если вы хотите, чтобы пользователи входили в систему и регистрировались, необходимо выбрать параметры **Разрешить пользователям входить в систему** и **Разрешить регистрацию пользователей** на вкладке "Параметры". Помните, что выбранные параметры повлияют на процесс входа пользователя в систему.

Например, когда пользователь открывает пользовательский портал впервые, он перенаправляется на страницу настройки Многофакторной идентификации Azure. В зависимости от того, как вы настроили службу Многофакторной идентификации Azure, пользователь сможет выбрать свой способ проверки подлинности.

Если в качестве метода проверки подлинности выбран или предварительно настроен голосовой звонок, пользователю предлагается ввести свой основной номер телефона и при необходимости добавочный номер. Пользователю также можно разрешить ввести дополнительный номер телефона.

![Регистрация основного и резервного телефонов](./media/howto-mfaserver-deploy-userportal/backupphone.png)

Если при проверке подлинности пользователю нужно использовать ПИН-код, ему предлагается создать ПИН-код. После ввода номеров телефонов и ПИН-кода (если используется) пользователь нажимает кнопку **Позвоните мне для проверки подлинности**. Служба Многофакторной идентификации Azure выполнит проверку с помощью звонка на основной телефонный номер пользователя. Пользователь должен ответить на звонок, ввести свой ПИН-код (если используется) и нажать кнопку # для перехода к следующему этапу процесса самостоятельной регистрации.

Если в качестве метода проверки подлинности выбрана или предварительно настроена проверка подлинности с помощью текстовых сообщений, пользователю предлагается ввести номер мобильного телефона. Если пользователь должен использовать ПИН-код при проверке подлинности, ему также предлагается ввести ПИН-код.  После ввода номера телефона и ПИН-кода (если используется) пользователь нажимает кнопку **Отправьте мне SMS для проверки подлинности**. После этого служба Многофакторной идентификации Azure отправляет проверочное текстовое сообщение на мобильный телефон пользователя. Пользователь получит текстовое сообщение с одноразовым паролем. Затем он отвечает на сообщение, указав этот пароль и ПИН-код (если используется).

![Текстовые сообщения пользовательского портала](./media/howto-mfaserver-deploy-userportal/text.png)

Если выбран метод проверки с помощью мобильного приложения, пользователю предлагается установить на устройство приложение Microsoft Authenticator и создать код активации. После установки приложения пользователь нажимает кнопку "Создать код активации".

> [!NOTE]
> Чтобы использовать приложение Microsoft Authenticator, пользователь должен включить push-уведомления для своего устройства.

На странице будут отображены код активации и URL-адрес, а также картинка со штрихкодом. Если пользователь должен использовать ПИН-код при проверке подлинности, ему дополнительно предлагается ввести ПИН-код. Пользователь вводит код активации и URL-адрес в приложение Microsoft Authenticator или сканирует штрихкод с помощью сканера штрихкодов и нажимает кнопку "Активировать".

После завершения активации пользователь нажимает кнопку **Проверить мою подлинность**. После этого служба Многофакторной идентификации Azure выполняет проверку для мобильного приложения. Пользователь должен ввести свой ПИН-код (если используется) и нажать кнопку «Выполнить проверку подлинности» в своем мобильном приложении для перехода к следующему этапу процесса самостоятельной регистрации.

Если администраторы настроили использование секретных вопросов и ответов на сервере Многофакторной идентификации Azure, пользователь будет перенаправлен на страницу "Секретные вопросы". Пользователю необходимо выбрать секретные вопросы и указать ответы на выбранные вопросы.

![Секретные вопросы пользовательского портала](./media/howto-mfaserver-deploy-userportal/secq.png)

На этом самостоятельная регистрация пользователя завершена. Пользователь вошел на пользовательский портал. В будущем пользователи смогут в любой момент войти на портал для изменения своих номеров телефонов, ПИН-кодов, методов проверки подлинности и секретных вопросов, если изменение методов разрешено администраторами.

## <a name="next-steps"></a>Дополнительная информация

- [Развертывание веб-службы мобильных приложений для сервера Многофакторной идентификации Azure](howto-mfaserver-deploy-mobileapp.md).