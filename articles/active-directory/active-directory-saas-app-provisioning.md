---
title: Автоматическая подготовка пользователей для приложения SaaS в Azure AD | Документы Майкрософт
description: Общие сведения об использовании Azure AD для автоматической подготовки, отзыва и постоянного обновления учетных записей пользователей в нескольких приложениях SaaS сторонних разработчиков.
services: active-directory
documentationcenter: ''
author: asmalser-msft
manager: mtillman
editor: ''
ms.assetid: 58c5fa2d-bb33-4fba-8742-4441adf2cb62
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 09/15/2017
ms.author: asmalser
ms.openlocfilehash: 72f796f0a4522b66feb55b827b02a83dcfdd3a01
ms.sourcegitcommit: c52123364e2ba086722bc860f2972642115316ef
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2018
ms.locfileid: "34069899"
---
# <a name="automate-user-provisioning-and-deprovisioning-to-saas-applications-with-azure-active-directory"></a>Автоматическая подготовка пользователей и ее отзыв для приложений SaaS в Azure Active Directory
## <a name="what-is-automated-user-provisioning-for-saas-apps"></a>Что такое автоматическая подготовка пользователей для приложений SaaS
Служба Azure Active Directory (Azure AD) предоставляет возможность автоматизировать процесс создания, обслуживания и удаления удостоверений пользователей в облачных приложениях ([SaaS](https://azure.microsoft.com/overview/what-is-saas/)), таких как Dropbox, Salesforce, ServiceNow и другие.

**Ниже приведены некоторые примеры возможностей, которые предоставляет эта функция.**

* Автоматическое создание новых учетных записей в соответствующих системах для новых членов вашей команды или организации.
* Автоматическая деактивация учетных записей в соответствующих системах, когда люди покидают команду или организацию.
* Постоянное обновление удостоверений в ваших приложениях и системах при внесении изменений в каталог или в систему управления персоналом.
* Подготовка не созданных пользователями объектов, таких как группы, в приложениях, которые их поддерживают.

**Автоматическая подготовка пользователей также предусматривает такие возможности:**

* Сопоставление существующих удостоверений в исходных и целевых системах.
* Настраиваемые сопоставления атрибутов, которые определяют, какие данные пользователя должны поступать из исходной системы в целевую систему.
* Необязательная отправка сообщения с оповещением об ошибке при подготовке.
* Составление отчетов и журналов действий для упрощения отслеживания и устранения неполадок.

## <a name="why-use-automated-provisioning"></a>Для чего нужна автоматическая подготовка
Вот несколько основных причин, по которым стоит использовать эту функцию:

* Исключение затрат, неэффективности и ошибок, связанных с человеческим фактором, которые могут возникать в ходе выполнения подготовки вручную.
* Исключение затрат, связанных с размещением и поддержкой специально разработанных решений и сценариев для подготовки.
* Возможность обезопасить свою организацию, мгновенно удаляя из ключевых приложений SaaS удостоверения пользователей, которые покидают вашу организацию.
* Максимальное упрощение импорта большого количества пользователей в конкретное приложение SaaS или систем.
* Удобство применения единого набора политик, определяющих подготавливаемых пользователей и возможность входа в приложение.


## <a name="how-does-automatic-provisioning-work"></a>Как работает автоматическая подготовка
    
**Служба подготовки Azure AD** подготавливает пользователей для приложений SaaS и других систем путем подключения к конечным точкам API управления пользователями, предоставляемыми каждым поставщиком приложений. Эти конечные точки API управления пользователями позволяют Azure AD создавать, обновлять и удалять пользователей путем программирования. Для выбранных приложений служба подготовки может также создавать, обновлять и удалять дополнительные объекты, связанные с удостоверениями, такие как группы и роли. 

![Подготовка](./media/active-directory-saas-app-provisioning/provisioning0.PNG)
*Рис. 1. Служба подготовки Azure AD*

![Исходящая подготовка](./media/active-directory-saas-app-provisioning/provisioning1.PNG)
*Рис. 2. "Исходящий" рабочий процесс подготовки пользователей из Azure AD в популярные приложения SaaS*

![Входящая подготовка](./media/active-directory-saas-app-provisioning/provisioning2.PNG)
*Рис. 3."Входящий" рабочий процесс подготовки пользователей из популярных приложений управления кадрами (HCM) в Azure Active Directory и Windows Server Active Directory*


## <a name="what-applications-and-systems-can-i-use-with-azure-ad-automatic-user-provisioning"></a>Какие приложения и системы можно использовать с автоматической подготовкой пользователей Azure AD

Azure AD предлагает предварительно интегрированную поддержку множества популярных приложений SaaS и систем управления кадрами, а также универсальную поддержку приложений, которые реализуют определенные части стандарта SCIM 2.0.

Перечень всех приложений, для которых Azure AD поддерживает предварительно интегрированный соединитель подготовки, приведен в [списке руководств по приложениям для подготовки пользователей](active-directory-saas-tutorial-list.md).

Сведения о том, как добавить поддержку подготовки пользователей Azure AD в приложение, см. в разделе [Использование SCIM для автоматической подготовки пользователей и групп Azure Active Directory для приложений](active-directory-scim-provisioning.md).

Для того чтобы связаться с командой инженеров Azure AD для обеспечения подготовки в других приложениях, отправьте сообщение через [форум отзывов Azure Active Directory](https://feedback.azure.com/forums/374982-azure-active-directory-application-requests/filters/new?category_id=172035).    

> [!NOTE]
> Чтобы приложение поддерживало автоматическую подготовку пользователей, сначала оно должно предоставить необходимые API управления пользователями, которые позволят внешним программам автоматизировать создание, обслуживание и удаление пользователей. Таким образом не все приложения SaaS совместимы с этой функцией. Для приложений, поддерживающих интерфейсы API для управления пользователями, команда инженеров Azure AD сможет собрать соединитель подготовки для этих приложений. Приоритет для этой работы устанавливается в соответствии с требованиями текущих и потенциальных заказчиков. 
    
    
## <a name="how-do-i-set-up-automatic-provisioning-to-an-application"></a>Как настроить автоматический вход в приложение

Настройка службы подготовки Azure AD для выбранного приложения начинается на **[портале Azure](https://portal.azure.com)**. В разделе **Azure Active Directory > Корпоративные приложения** выберите **Добавить**, а затем **Все** и добавьте одно из следующих в зависимости от вашего сценария:

* Все приложения в разделе **Популярные приложения** поддерживают автоматическую подготовку. Дополнительные приложения см. в [списке руководств по приложениям для подготовки пользователей](active-directory-saas-tutorial-list.md).

* Используйте параметр "Приложение не из коллекции" для специально разработанных интеграций SCIM.

![Коллекция](./media/active-directory-saas-app-provisioning/gallery.png)

На экране управления приложениями настройка выполняется на вкладке **Подготовка**.

![Параметры](./media/active-directory-saas-app-provisioning/provisioning_settings0.PNG)


* **Учетные данные администратора** нужно указать в службе подготовки Azure AD, которая позволит подключаться к API управления пользователями, предоставляемому приложением. В этом разделе также описывается включение уведомлений по электронной почте, отправляемых в случае ошибки учетных данных или перемещения задания подготовки в [карантин](#quarantine).

* Можно настроить**сопоставления атрибутов**, которые определяют, какие поля в исходной системе (например, Azure AD) будут синхронизированы с соответствующими полями в целевой системе (например, ServiceNow). Если целевое приложение поддерживает его, этот раздел позволит дополнительно настроить подготовку групп в дополнение к учетным записям пользователей. "Сопоставление свойств" позволяет выбрать, какие поля используются для сопоставления учетных записей между этими системами. [Выражения](active-directory-saas-writing-expressions-for-attribute-mappings.md) позволяют изменять и преобразовывать значения, полученные из исходной системы, до того как они будут записаны в целевую систему. Дополнительные сведения см. в статье [Настройка сопоставлений атрибутов для подготовки пользователей для приложений SaaS в Azure Active Directory](active-directory-saas-customizing-attribute-mappings.md).

![Параметры](./media/active-directory-saas-app-provisioning/provisioning_settings1.PNG)

* **Фильтры области** сообщают службе подготовки, какие пользователи и группы в исходной системе должны быть подготовлены и/или отозваны в целевой системе. Есть два аспекта для фильтров области, которые оцениваются вместе и определяют, кто находится в области для подготовки:

    * **Filter on attribute values** (Фильтровать по значениям атрибутов) — меню "Область исходного объекта" в сопоставлениях атрибутов позволяет фильтровать определенные значения атрибутов. Например, вы можете указать, что в области подготовки должны быть только пользователи с атрибутом отдела "Продажи". Дополнительные сведения см. в разделе [Подготовка приложений на основе атрибутов с использованием фильтров области](active-directory-saas-scoping-filters.md).

    * **Filter on assignments** (Фильтровать по назначениям) — меню "Область" в разделе "Подготовка > Параметры" портала позволяет указать, должны ли быть подготовлены только "назначенные" пользователи и группы или все пользователи в каталоге Azure AD. Дополнительные сведения см. в статье [Назначение пользователя или группы корпоративному приложению в Azure Active Directory](active-directory-coreapps-assign-user-azure-portal.md).
    
* **Параметры** управляют работой службы подготовки приложений, в том числе запущенных.

* **Журналы аудита** предоставляют записи каждой операции, выполненной службой подготовки Azure AD. Дополнительные сведения см. в статье [Руководство по отчетам об автоматической подготовке учетных записей пользователей](active-directory-saas-provisioning-reporting.md).

![Параметры](./media/active-directory-saas-app-provisioning/audit_logs.PNG)

> [!NOTE]
> Для настройки службы подготовки пользователей Azure AD и управления ею можно также использовать [API Microsoft Graph](https://developer.microsoft.com/graph/docs/api-reference/beta/resources/synchronization-overview).


## <a name="what-happens-during-provisioning"></a>Что происходит при подготовке

Когда исходной системой является Azure AD, служба подготовки использует [функцию разностных запросов API Graph Azure AD](https://msdn.microsoft.com/Library/Azure/Ad/Graph/howto/azure-ad-graph-api-differential-query) для отслеживания пользователей и групп. Служба подготовки выполняет начальную синхронизацию исходной и целевой систем, после чего осуществляет периодическую добавочную синхронизацию. 

### <a name="initial-sync"></a>начальная синхронизация
При запуске служба подготовки выполняет самую первую синхронизацию и осуществляет следующие действия:

1. Запрашивает всех пользователей и все группы из исходной системы, получая все атрибуты, определенные в [сопоставлениях атрибутов](active-directory-saas-customizing-attribute-mappings.md).
2. Фильтрует полученных пользователей и группы с помощью настроенных [назначений](active-directory-coreapps-assign-user-azure-portal.md) или [фильтров области на основе атрибутов](active-directory-saas-scoping-filters.md).
3. При обнаружении пользователя для назначения или пользователя в области для подготовки служба запрашивает у целевой системы соответствующего пользователя с помощью указанных [совпадающих атрибутов](active-directory-saas-customizing-attribute-mappings.md#understanding-attribute-mapping-properties). Пример. Если имя userPrincipal в исходной системе является совпадающим атрибутом и соответствует атрибуту userName в целевой системе, то служба подготовки запрашивает у целевой системы атрибуты userName, которые соответствуют значениям имени userPrincipal в исходной системе.
4. Если соответствующий пользователь в целевой системе не найден, он создается с использованием атрибутов, возвращенных из исходной системы.
5. Если соответствующий пользователь найден, он обновляется с помощью атрибутов, предоставляемых исходной системой.
6. Если сопоставления атрибутов содержат "ссылочные" атрибуты, то служба выполняет дополнительные обновления в целевой системе, чтобы создать и привязать указанные в ссылках объекты. Например, пользователь может использовать атрибут Manager в целевой системе, который связан с другим пользователем, созданным в целевой системе.
7. Сохраняет водяной знак в конце начальной синхронизации, который обеспечивает начальную точку для последующих добавочных синхронизаций.

Некоторые приложения, такие как ServiceNow, Google Apps и Box, подготавливают не только пользователей, но и группы и их участников. В таких случаях, если подготовка групп включена в [сопоставления](active-directory-saas-customizing-attribute-mappings.md), то служба подготовки синхронизирует пользователей и группы, а затем синхронизирует членство в группах. 

### <a name="incremental-syncs"></a>Добавочная синхронизация
Каждая последующая операция синхронизации, осуществляемая после начальной синхронизации, выполняет следующие действия.

1. Запрашивает у исходной системы всех пользователей и все группы, которые были обновлены с момента сохранения последнего водяного знака.
2. Фильтрует полученных пользователей и группы с помощью настроенных [назначений](active-directory-coreapps-assign-user-azure-portal.md) или [фильтров области на основе атрибутов](active-directory-saas-scoping-filters.md).
3. При обнаружении пользователя для назначения или пользователя в области для подготовки служба запрашивает у целевой системы соответствующего пользователя с помощью указанных [совпадающих атрибутов](active-directory-saas-customizing-attribute-mappings.md#understanding-attribute-mapping-properties).
4. Если соответствующий пользователь в целевой системе не найден, он создается с использованием атрибутов, возвращенных из исходной системы.
5. Если соответствующий пользователь найден, он обновляется с помощью атрибутов, предоставляемых исходной системой.
6. Если сопоставления атрибутов содержат "ссылочные" атрибуты, то служба выполняет дополнительные обновления в целевой системе, чтобы создать и привязать указанные в ссылках объекты. Например, пользователь может использовать атрибут Manager в целевой системе, который связан с другим пользователем, созданным в целевой системе.
7. Если пользователь, который ранее был в области для подготовки, удаляется из нее (включая отмену назначения), то служба отключает этого пользователя в целевой системе при обновлении.
8. Если пользователь, который ранее был в области для подготовки, отключается или обратимо удаляется в исходной системе, то служба отключает этого пользователя в целевой системе при обновлении.
9. Если пользователь, который ранее был в области для подготовки, необратимо удаляется в исходной системе, то служба удаляет этого пользователя в целевой системе. В Azure AD пользователи необратимо удаляются через 30 дней после обратимого удаления.
10. Сохраняет новый водяной знак в конце добавочной синхронизации, который обеспечивает начальную точку для последующих добавочных синхронизаций.

>[!NOTE]
> Можно также отключить операции создания, обновления или удаления с помощью флажков **Действия с целевыми объектами** в разделе [Сопоставления атрибутов](active-directory-saas-customizing-attribute-mappings.md). Логикой отключения пользователей во время обновления также управляет сопоставление атрибутов из поля, например accountEnabled.

Служба подготовки будет выполнять полную добавочную синхронизацию неопределенно долгое время через интервалы, определенные в [отдельном руководстве по каждому приложению](active-directory-saas-tutorial-list.md), пока не произойдет одно из следующих событий.

* Служба останавливается вручную с помощью портала Azure или соответствующей команды API Graph. 
* Активируется новая начальная синхронизации с помощью параметра **Clear state and restart** (Очистить состояние и перезапустить) на портале Azure или с помощью соответствующей команды API Graph. При этом удаляются все сохраненные водяные знаки, а все исходные объекты должны быть оценены повторно.
* Из-за изменений сопоставлений атрибутов или фильтров области активируется новая начальная синхронизация. При этом также удаляются все сохраненные водяные знаки, а все исходные объекты должны быть оценены повторно.
* Процесс подготовки переходит в карантин (см. ниже) из-за высокой частоты ошибок и остается в карантине более четырех недель. В этом случае служба будет автоматически отключена.

### <a name="errors-and-retries"></a>Ошибки и повторные попытки 
Если отдельного пользователя в целевой системе не удается добавить, обновить или удалить из-за ошибки в этой системе, то данная операция будет повторена при следующем цикле синхронизации. Если операция с пользователем продолжает завершаться сбоем, то повторные попытки будут выполняться с меньшей частотой вплоть до одной попытки в день. Чтобы устранить ошибку, администраторы должны будут проверить [журналы аудита](active-directory-saas-provisioning-reporting.md) на наличие событий "дополнительной обработки", чтобы определить первопричину и предпринять соответствующие действия. Ниже перечислены распространенные ошибки.

* Не заполнен атрибут пользователей в исходной системе, требуемый в целевой системе.
* У пользователей в исходной системе имеется значение атрибута, для которого в целевой системе установлено уникальное ограничение, и это же значение присутствует в другой записи пользователя.

Эти ошибки можно устранить, настроив значения атрибутов для затронутого пользователя в исходной системе или настроив сопоставления атрибутов таким образом, чтобы не возникали конфликты.   

### <a name="quarantine"></a>Карантин
Если большинство или все вызовы к целевой системе последовательно завершаются сбоем из-за ошибки (например, в случае недопустимых учетных данных администратора), то задание подготовки переходит в "карантин". Об этом сообщается в [сводном отчете о подготовке](active-directory-saas-provisioning-reporting.md) и по электронной почте, если на портале Azure были настроены уведомления по электронной почте. 

После перехода в карантин частота добавочной синхронизации постепенно уменьшается до одного раза в день. 

Задание подготовки будет удалено из карантина после исправления всех связанных с помещением в карантин ошибок, после чего начнется следующий цикл синхронизации. Если задания подготовки остается в карантине более четырех недель, оно отключается.


## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

**Сколько времени займет подготовка моих пользователей?**

Производительность будет отличаться в зависимости от того, выполняет задание подготовки начальную синхронизацию или добавочную синхронизацию.

Длительность начальной синхронизации будет напрямую зависеть от количества пользователей, групп и участников групп в исходной системе. Очень маленькие исходные системы с несколькими сотнями объектов могут выполнять начальную синхронизацию в течение нескольких минут. Однако синхронизация исходных систем с сотнями тысяч или миллионами объединенных объектов может занять очень много времени.

Время, необходимое для добавочной синхронизации, зависит от числа изменений, обнаруженных в данном цикле синхронизации. Если обнаружено менее 5000 изменений пользователей или членства в группах, как правило, для их синхронизации достаточно 40-минутного цикла. 

Обратите внимание на то, что общая производительность зависит от исходной и целевой систем. Некоторые целевые системы накладывают ограничения на частоту запросов и используют регулирование, что может снизить производительность во время больших операций синхронизации, и предварительно созданные соединители подготовки Azure AD для этих систем это учитывают.

Производительность также снижается, если возникает большое количество ошибок (записываются в [журнал аудита](active-directory-saas-provisioning-reporting.md)) и служба подготовки перешла в состояние "карантина".

**Как можно повысить производительность синхронизации?**

Большинство проблем производительности возникает во время начальной синхронизации систем с большим числом групп и членов групп.

Если синхронизация групп или членства в группах не является обязательной, то производительность синхронизации можно заметно повысить следующим образом.

1. В меню **Подготовка > Параметры > Область** выберите **Синхронизовать все** вместо синхронизации назначенных пользователей и групп.
2. Используйте [фильтры области](active-directory-saas-scoping-filters.md) вместо назначений для фильтрации списка подготовленных пользователей.

> [!NOTE]
> Для приложений, поддерживающих подготовку имен групп и свойств групп (например, ServiceNow и Google Apps), отключение этой функции также уменьшит время, необходимое для начальной синхронизации. Если вы не хотите подготавливать имена групп и членство в группах для своего приложения, вы можете отключить подготовки в [сопоставлениях атрибутов](active-directory-saas-customizing-attribute-mappings.md) конфигурации подготовки.

**Как я могу отслеживать процесс выполнения текущего задания по подготовке?**

Дополнительные сведения см. в статье [Руководство по отчетам об автоматической подготовке учетных записей пользователей](active-directory-saas-provisioning-reporting.md).

**Как я узнаю, что подготовка пользователей не была произведена успешно?**

Все ошибки записываются в журналы аудита Azure AD. Дополнительные сведения см. в статье [Руководство по отчетам об автоматической подготовке учетных записей пользователей](active-directory-saas-provisioning-reporting.md).

**Как создать приложение, которое работает со службой подготовки?**

Ознакомьтесь с разделом [Использование SCIM для автоматической подготовки пользователей и групп Azure Active Directory для приложений](https://docs.microsoft.com/azure/active-directory/active-directory-scim-provisioning).

**Как отправить отзыв команде инженеров?**

Связаться с нами можно через [форум обратной связи Azure Active Directory](https://feedback.azure.com/forums/169401-azure-active-directory/).


## <a name="related-articles"></a>Связанные статьи
* [Список учебников по интеграции приложений SaaS](active-directory-saas-tutorial-list.md)
* [Настройка сопоставления атрибутов для подготовки пользователей](active-directory-saas-customizing-attribute-mappings.md)
* [Запись выражений для сопоставления атрибутов](active-directory-saas-writing-expressions-for-attribute-mappings.md)
* [Фильтры области для подготовки пользователей](active-directory-saas-scoping-filters.md)
* [Автоматическая подготовка пользователей и групп из Azure Active Directory в приложениях с использованием SCIM](active-directory-scim-provisioning.md)
* [Общие сведения об API синхронизации Azure AD](https://developer.microsoft.com/graph/docs/api-reference/beta/resources/synchronization-overview)
* [Step-by-step deployment plan for outbound user provisioning of an application](https://aka.ms/userprovisioningdeploymentplan) (Поэтапный план развертывания для подготовки исходящих пользователей приложения)

