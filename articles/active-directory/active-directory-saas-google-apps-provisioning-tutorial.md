---
title: Руководство по настройке Google Apps для автоматической подготовки пользователей с помощью Azure Active Directory | Документация Майкрософт
description: Узнайте, как настроить автоматическую подготовку и отзыв учетных записей пользователей из Azure AD в Google Apps.
services: active-directory
documentationCenter: na
author: jeevansd
manager: mtillman
ms.assetid: 6dbd50b5-589f-4132-b9eb-a53a318a64e5
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/26/2018
ms.author: jeedes
ms.openlocfilehash: d5c68e709b72e4032eca76dd35103df50030ccca
ms.sourcegitcommit: b6319f1a87d9316122f96769aab0d92b46a6879a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2018
---
# <a name="tutorial-configure-google-apps-for-automatic-user-provisioning"></a>Руководство по настройке Google Apps для автоматической подготовки пользователей

Цель этого руководства — показать, как настроить автоматическую подготовку и отзыв учетных записей пользователей из Azure Active Directory (Azure AD) в Google Apps.

## <a name="prerequisites"></a>предварительным требованиям

Сценарий, описанный в этом руководстве, предполагает, что у вас уже имеется:

*   клиент Azure Active Directory;
*   Действительный клиент для Google Apps for Work или Google Apps for Education. Для любой из этих служб можно воспользоваться бесплатной пробной учетной записью.
*   Учетная запись пользователя Google Apps с разрешениями администратора команды.

## <a name="assign-users-to-google-apps"></a>Назначение пользователей Google Apps

В Azure Active Directory для определения того, какие пользователи должны получать доступ к выбранным приложениям, используется концепция, называемая "назначение". В контексте автоматической подготовки учетной записи синхронизированы будут только те пользователи и группы, которые были "назначены" приложению в Azure AD.

Перед настройкой и включением службы подготовки необходимо решить, каким пользователям или группам в Azure AD требуется доступ к приложению Google Apps. После принятия решения можно назначить этих пользователей приложению Google Apps, следуя инструкциям в статье [Назначение пользователя или группы корпоративному приложению в Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-coreapps-assign-user-azure-portal).

> [!IMPORTANT]
> Мы рекомендуем назначить одного пользователя Azure AD в Google Apps для тестирования конфигурации подготовки. Дополнительных пользователей и группы можно будет назначить позже.

> При назначении пользователя в Google Apps необходимо выбрать роль **Пользователь** или **Группа** в диалоговом окне назначения. Роль **Доступ по умолчанию** не подходит для подготовки.

## <a name="enable-automated-user-provisioning"></a>Включение автоматической подготовки пользователей

В этом разделе описывается процесс подключения Azure AD к API подготовки учетных записей пользователей Google Apps. Он также поможет вам настроить службу подготовки для создания, обновления или отключения учетных записей назначенных пользователей в Google Apps на основе назначений пользователя или группы в Azure AD.

>[!TIP]
>Для Google Apps можно также включить единый вход на основе SAML. Для этого следуйте инструкциям на [портале Azure](https://portal.azure.com). Единый вход можно настроить независимо от автоматической подготовки, хотя эти две возможности дополняют друг друга.

### <a name="configure-automatic-user-account-provisioning"></a>Настройка автоматической подготовки учетных записей пользователей

> [!NOTE]
> Одним из способов автоматизации подготовки пользователей для Google Apps является использование средства синхронизации каталогов [Google Apps Directory Sync (GADS)](https://support.google.com/a/answer/106368?hl=en), которое позволяет локально подготовить удостоверения Active Directory для Google Apps. В этом же руководстве мы рассмотрим подготовку к использованию Google Apps пользователей Azure Active Directory (облако) и групп, поддерживающих почту. 

1. Войдите в [консоль администратора Google Apps](http://admin.google.com/) с использованием учетной записи администратора и выберите **Security** (Безопасность). Если эта ссылка не отображается, она может быть скрыта в меню **More Controls** (Другие элементы управления) в нижней части экрана.
   
    ![Выбор страницы Security (Безопасность)][10]

2. На странице **Security** (Безопасность) выберите **API Reference** (Справочник по API).
   
    ![Выбор справочника по API][15]

3. Выберите команду **Enable API access**(Включить доступ через API).
   
    ![Выбор справочника по API][16]

    > [!IMPORTANT]
    > Имя каждого пользователя в Azure Active Directory, которого вы хотите подготовить для Google Apps, *необходимо* привязать к личному домену. Например, такие имена пользователей, как bob@contoso.onmicrosoft.com, не будут приняты Google Apps, а bob@contoso.com — будут. Вы можете изменить текущий домен пользователя, изменив его свойства в Azure AD. Инструкции по настройке личного домена в Azure Active Directory и Google Apps приведены ниже.
      
4. Если вы еще не добавили имя личного домена в Azure Active Directory, сделайте следующее:
  
    a. На [портале Azure](https://portal.azure.com) в области навигации слева выберите **Active Directory**. Выберите свой каталог в списке каталогов. 

    Б. Выберите **Доменное имя** в левой области навигации, а затем — **Добавить**.
     
     ![Домен](./media/active-directory-saas-google-apps-provisioning-tutorial/domain_1.png)

     ![Добавление домена](./media/active-directory-saas-google-apps-provisioning-tutorial/domain_2.png)

    c. Введите имя домена в поле **Доменное имя** . Необходимо ввести доменное имя, которое вы будете использовать в Google Apps. Затем нажмите кнопку **Добавить домен**.
     
     ![Доменное имя](./media/active-directory-saas-google-apps-provisioning-tutorial/domain_3.png)

    d. Нажмите кнопку **Далее**, чтобы перейти на страницу проверки. Для подтверждения того, что домен принадлежит вам, измените его записи DNS в соответствии со значениями, приведенными на этой странице. Вы можете выполнить проверку с помощью **записей MX** или **записей типа TXT**. Для этого выберите соответствующее значение в поле **Тип записи**. 
    
    Более подробные инструкции по подтверждению доменного имени в Azure AD см. в статье [Создание записи DNS для любого поставщика услуг размещения DNS для Office 365](https://go.microsoft.com/fwLink/?LinkID=278919&clcid=0x409).
     
     ![Домен](./media/active-directory-saas-google-apps-provisioning-tutorial/domain_4.png)

    д. Повторите описанные выше действия для всех доменов, которые вы хотите добавить в свой каталог.

    > [!NOTE]
    Для подготовки пользователей имя личного домена Google Apps должно совпадать с доменным именем исходного экземпляра Azure AD. Если они не совпадают, вы можете решить проблему, настроив сопоставление атрибутов.


5. После подтверждения всех доменов в Azure AD необходимо подтвердить их в Google Apps. Для каждого домена, который еще не зарегистрирован в Google Apps, сделайте следующее:
   
    a. В [консоли администратора Google Apps](http://admin.google.com/) выберите **Domains** (Домены).
     
     ![Выбор доменов][20]

    Б. Выберите **Add a domain or a domain alias** (Добавить домен или псевдоним домена).
     
     ![Добавление нового домена][21]

    c. Выберите **Add another domain** (Добавить другой домен), а затем введите имя домена, который нужно добавить.
     
     ![Ввод доменного имени][22]

    d. Выберите **Continue and verify domain ownership** (Перейти к проверке владельца домена). Затем выполните действия, подтверждающие, что вы владеете доменным именем. Подробные инструкции по проверке домена в Google Apps см. на странице [Подтверждение права собственности на сайт в Google Apps](https://support.google.com/webmasters/answer/35179).

    д. Повторите описанные выше шаги для других доменов, которые нужно добавить в Google Apps.
     
     > [!WARNING]
     > Если вы измените основной домен клиента Google Apps после того, как настроите единый вход в Azure AD, вам необходимо будет повторить шаг 3, описанный в разделе [Шаг 2. Включение единого входа](#step-two-enable-single-sign-on).
       
6. В [консоли администратора Google Apps](http://admin.google.com/) выберите **Admin Roles** (Роли администраторов).
   
     ![Выбор Google Apps][26]

7. Определите, какую учетную запись администратора вы хотите использовать для управления подготовкой пользователей. Чтобы назначить этой учетной записи **административную роль**, измените для этой роли свойство **Privileges** (Привилегии). Убедитесь, что для учетной записи выбраны все параметры в разделе **Admin API Privileges** (Административные права доступа к API). Это позволит использовать ее для подготовки.
   
     ![Выбор Google Apps][27]
   
    > [!NOTE]
    > При настройке рабочей среды рекомендуется создать учетную запись администратора Google Apps специально для этого шага. Этим учетным записям должна быть назначена роль администратора с необходимыми правами доступа к API.
     
8. На [портале Azure](https://portal.azure.com) перейдите в раздел **Azure Active Directory** > **Корпоративные приложения** > **Все приложения**.

9. Если в Google Apps уже настроен единый вход, найдите свой экземпляр Google Apps с помощью поля поиска. В противном случае щелкните **Добавить** и выполните поиск **Google Apps** в коллекции приложений. Выберите приложение **Google Apps** в результатах поиска и добавьте его в список приложений.

10. Выберите экземпляр Google Apps, а затем перейдите на вкладку **Подготовка**.

11. Для параметра **Режим подготовки к работе** выберите значение **Automatic** (Автоматически). 

     ![Подготовка](./media/active-directory-saas-google-apps-provisioning-tutorial/provisioning.png)

12. В разделе **Учетные данные администратора** выберите **Авторизовать**. В новом окне браузера откроется диалоговое окно авторизации Google Apps.

13. Подтвердите, что вы готовы предоставить Azure Active Directory разрешение на внесение изменений в клиент Google Apps. Нажмите кнопку **Принять**.
    
     ![Подтверждение разрешения][28]

14. На портале Azure выберите **Проверить подключение**, чтобы убедиться, что Azure AD может подключиться к приложению Google Apps. Если подключение отсутствует, убедитесь, что у учетной записи Google Apps есть разрешения администратора команды. Затем повторите шаг **авторизации**.

15. В поле **Почтовое уведомление** введите адрес электронной почты пользователя или группы, которые должны получать уведомления об ошибках подготовки, а затем установите флажок.

16. Щелкните **Сохранить**.

17. В разделе **Сопоставления** выберите **Synchronize Azure Active Directory Users to Google Apps** (Синхронизировать пользователей Azure Active Directory с Google Apps).

18. В разделе **Сопоставления атрибутов** просмотрите пользовательские атрибуты, которые синхронизированы из Azure AD в Google Apps. Атрибуты, выбранные как свойства **Matching**, используются для сопоставления учетных записей пользователей в Google Apps для операций обновления. Чтобы зафиксировать изменения, щелкните **Сохранить**.

19. Чтобы включить службу подготовки Azure AD для Google Apps, в разделе **Параметры** измените значение параметра **Состояние подготовки** на **Включено**.

20. Щелкните **Сохранить**.

После этого будет запущена начальная синхронизация всех пользователей и групп, назначенных для Google Apps в разделе "Пользователи и группы". Начальная синхронизация занимает больше времени, чем последующие операции синхронизации, которые выполняются примерно каждые 40 минут, если служба запущена. В разделе **Сведения о синхронизации** можно отслеживать ход выполнения и переходить по ссылкам для просмотра журналов действий. В эти журналы записываются все действия, выполняемые службой подготовки в приложении Google Apps.

Дополнительные сведения о чтении журналов подготовки Azure AD см. в руководстве по [отчетам об автоматической подготовке учетных записей](active-directory-saas-provisioning-reporting.md).

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Управление подготовкой учетных записей пользователей для корпоративных приложений](active-directory-saas-tutorial-list.md)
* [Что такое доступ к приложениям и единый вход с помощью Azure Active Directory?](manage-apps/what-is-single-sign-on.md)
* [Настройка единого входа](active-directory-saas-google-apps-tutorial.md)



<!--Image references-->

[10]: ./media/active-directory-saas-google-apps-provisioning-tutorial/gapps-security.png
[15]: ./media/active-directory-saas-google-apps-provisioning-tutorial/gapps-api.png
[16]: ./media/active-directory-saas-google-apps-provisioning-tutorial/gapps-api-enabled.png
[20]: ./media/active-directory-saas-google-apps-provisioning-tutorial/gapps-domains.png
[21]: ./media/active-directory-saas-google-apps-provisioning-tutorial/gapps-add-domain.png
[22]: ./media/active-directory-saas-google-apps-provisioning-tutorial/gapps-add-another.png
[24]: ./media/active-directory-saas-google-apps-provisioning-tutorial/gapps-provisioning.png
[25]: ./media/active-directory-saas-google-apps-provisioning-tutorial/gapps-provisioning-auth.png
[26]: ./media/active-directory-saas-google-apps-provisioning-tutorial/gapps-admin.png
[27]: ./media/active-directory-saas-google-apps-provisioning-tutorial/gapps-admin-privileges.png
[28]: ./media/active-directory-saas-google-apps-provisioning-tutorial/gapps-auth.png
