---
title: Создание масштабируемого набора Azure, в котором используются виртуальные машины низкого приоритета (предварительная версия) | Документация Майкрософт
description: Узнайте, как создавать масштабируемый набор виртуальных машин Azure, в котором используются виртуальные машины низкого приоритета для экономии затрат.
services: virtual-machine-scale-sets
documentationcenter: ''
author: mmccrory
manager: rajraj
editor: ''
tags: azure-resource-manager
ms.assetid: ''
ms.service: virtual-machine-scale-sets
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/01/2018
ms.author: memccror
ms.openlocfilehash: 5c0726ea0da288d5306e28b101e4d3b59605b443
ms.sourcegitcommit: 870d372785ffa8ca46346f4dfe215f245931dae1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/08/2018
ms.locfileid: "33894913"
---
# <a name="low-priority-vms-on-scale-sets-preview"></a>Виртуальные машины низкого приоритета в масштабируемых наборах (предварительная версия)

Использование виртуальных машин низкого приоритета в масштабируемых наборах позволяет воспользоваться нашей неиспользуемой емкостью при значительной экономии затрат. В любой момент времени, когда Azure понадобится эта емкость, инфраструктура Azure вытеснит виртуальные машины низкого приоритета. Поэтому низкоприоритетные виртуальные машины прекрасно подходят для рабочих нагрузок, для которых допустимы прерывания, таких как задания пакетной обработки, среды разработки или тестирования, большие вычислительные рабочие нагрузки и другие.

Объем доступной неиспользуемой емкости может варьироваться в зависимости от размера, региона, времени суток и многого другого. При развертывании низкоприоритетных виртуальных машин в масштабируемых наборах Azure выделит их (если имеется емкость), но соглашение об уровне обслуживания (SLA) для этих виртуальных машин отсутствует. Низкоприоритетный масштабируемый набор развертывается в одном домене сбоя и не гарантирует высокого уровня доступности.

## <a name="eviction-policy"></a>Политика вытеснения

При создании низкоприоритетных масштабируемых наборов можно установить политику вытеснения *Отменить выделение* (по умолчанию) или *Удалить*. 

Политика *Отменить выделение* переводит вытесненные виртуальные машины в остановленное состояние (отменяет распределение), что позволяет повторно развернуть вытесненные экземпляры. Однако нет гарантии, что распределение будет выполнено успешно. Виртуальные машины, распределение которых отменено, будут учитываться в квоте экземпляра масштабируемого набора, и вам будет выставлен счет за базовые диски. 

Если вы хотите, чтобы ваши виртуальные машины в низкоприоритетном масштабируемом наборе были удалены при их вытеснении, можно настроить для политики вытеснения действие *Удалить*. Если установлена политика вытеснения с действием удаления, то можно создавать новые виртуальные машины, увеличивая свойство количества экземпляров масштабируемого набора. Вытесненные виртуальные машины удаляются вместе с их базовыми дисками, и поэтому вы не будете платить за хранение. Также можно использовать функцию автомасштабирования масштабируемых наборов, чтобы автоматически попытаться компенсировать вытесненные виртуальные машины, однако нет гарантии, что распределение будет успешным. Рекомендуется использовать функцию автомасштабирования на низкоприоритетных масштабируемых наборах, только когда вы устанавливаете политику вытеснения с действием удаления, чтобы избежать затрат за диски и превышения пределов квоты. 

> [!NOTE]
> На этапе предварительной версии можно установить политику вытеснения с помощью [портала Azure](#use-the-azure-portal) и [шаблонов Azure Resource Manager](#use-azure-resource-manager-templates). 

## <a name="deploying-low-priority-vms-on-scale-sets"></a>Развертывание виртуальных машин низкого приоритета в масштабируемых наборах

Чтобы развернуть виртуальные машины низкого приоритета в масштабируемых наборах, можно установить для нового параметра *Priority* значение *Low*. Все виртуальные машины в масштабируемом наборе будут настроены как низкоприоритетные. Чтобы создать масштабируемый набор с виртуальными машинами низкого приоритета, используйте один из следующих способов.
- [портал Azure](#use-the-azure-portal)
- [Azure CLI 2.0](#use-the-azure-cli-20)
- [Azure PowerShell](#use-azure-powershell)
- [Шаблоны диспетчера ресурсов Azure](#use-azure-resource-manager-templates)

## <a name="use-the-azure-portal"></a>Использование портала Azure

Процесс создания масштабируемого набора с низкоприоритетными виртуальными машинами такой же, как описано в [статье о начале работы](quick-create-portal.md). При развертывании масштабируемого набора можно задать флаг низкого приоритета и политику вытеснения: ![Виртуальные машины низкого приоритета в масштабируемых наборах (предварительная версия)](media/virtual-machine-scale-sets-use-low-priority/vmss-low-priority-portal.png).

## <a name="use-the-azure-cli-20"></a>Использование Azure CLI 2.0

Процесс создания масштабируемого набора с низкоприоритетными виртуальными машинами такой же, как описано в [статье о начале работы](quick-create-cli.md). Просто добавьте параметр "--Priority" при вызове CLI и установите для него значение *Low*, как показано в примере ниже.

```azurecli
az vmss create \
    --resource-group myResourceGroup \
    --name myScaleSet \
    --image UbuntuLTS \
    --upgrade-policy-mode automatic \
    --admin-username azureuser \
    --generate-ssh-keys \
    --priority Low
```

## <a name="use-azure-powershell"></a>Использование Azure PowerShell

Процесс создания масштабируемого набора с низкоприоритетными виртуальными машинами такой же, как описано в [статье о начале работы](quick-create-powershell.md).
Просто добавьте параметр "-Priority" в командлет [New-AzureRmVmssConfig](/powershell/module/azurerm.compute/new-azurermvmssconfig) и установите для него значение *Low*, как показано в примере ниже.

```powershell
$vmssConfig = New-AzureRmVmssConfig `
    -Location "East US 2" `
    -SkuCapacity 2 `
    -SkuName "Standard_DS2" `
    -UpgradePolicyMode Automatic `
    -Priority "Low"
```

## <a name="use-azure-resource-manager-templates"></a>Использование шаблонов Azure Resource Manager

Создание масштабируемого набора, использующего низкоприоритетные виртуальные машины, описано в статьях о начале работы для [Linux](quick-create-template-linux.md) и [Windows](quick-create-template-windows.md). Добавьте свойство "priority" в тип ресурса *Microsoft.Compute/virtualMachineScaleSets/virtualMachineProfile* в шаблоне и укажите *Low* в качестве значения. Обязательно используйте API версии *2018-03-01* или более поздней версии. 

Чтобы установить политику вытеснения с действием удаления, добавьте параметр "evictionPolicy" и задайте для него значение *delete*.

В следующем примере создается масштабируемый набор низкоприоритетных виртуальных машин Linux с именем *myScaleSet* в регионе *Западно-центральная часть США*, которые будут *удалены* при вытеснении.

```json
{
  "type": "Microsoft.Compute/virtualMachineScaleSets",
  "name": "myScaleSet",
  "location": "East US 2",
  "apiVersion": "2018-03-01",
  "sku": {
    "name": "Standard_DS2_v2",
    "capacity": "2"
  },
  "properties": {
    "upgradePolicy": {
      "mode": "Automatic"
    },
    "virtualMachineProfile": {
       "priority": "Low",
       "evictionPolicy": "delete",
       "storageProfile": {
        "osDisk": {
          "caching": "ReadWrite",
          "createOption": "FromImage"
        },
        "imageReference":  {
          "publisher": "Canonical",
          "offer": "UbuntuServer",
          "sku": "16.04-LTS",
          "version": "latest"
        }
      },
      "osProfile": {
        "computerNamePrefix": "myvmss",
        "adminUsername": "azureuser",
        "adminPassword": "P@ssw0rd!"
      }
    }
  }
}
```
## <a name="faq"></a>Часто задаваемые вопросы

### <a name="can-i-convert-existing-scale-sets-to-low-priority-scale-sets"></a>Можно ли преобразовать существующие масштабируемые наборы в низкоприоритетные масштабируемые наборы?
Нет, установить флаг низкого приоритета можно только во время создания.

### <a name="can-i-create-a-scale-set-with-both-regular-vms-and-low-priority-vms"></a>Можно ли создать масштабируемый набор с обычными и низкоприоритетными виртуальными машинами?
Нет, масштабируемый набор не поддерживает более одного типа приоритета.

### <a name="how-is-quota-managed-for-low-priority-vms"></a>Как выполняется управление квотой для низкоприоритетных виртуальных машин?
Для низкоприоритетных и обычных виртуальных машин используется один и тот же пул квоты. 

### <a name="can-i-use-autoscale-with-low-priority-scale-sets"></a>Можно ли использовать автомасштабирование для низкоприоритетных масштабируемых наборов?
Да, для низкоприоритетного масштабируемого набора можно задать правила автомасштабирования. В случае вытеснения виртуальных машин служба автомасштабирования попытается создать новые низкоприоритетные виртуальные машины. Однако помните, что получение этой емкости не гарантируется. 

### <a name="does-autoscale-work-with-both-eviction-policies-deallocate-and-delete"></a>Учитываются ли при автомасштабировании обе политики вытеснения (отмена распределения и удаление)?
При использовании автомасштабирования рекомендуется установить для политики вытеснения действие удаления. Причина этого состоит в том, что экземпляры, распределение которых отменено, учитываются в емкости масштабируемого набора. При использовании автомасштабирования, скорее всего, вы быстро достигнете целевого количества из-за вытесненных экземпляров, распределение которых отменено. 

## <a name="next-steps"></a>Дополнительная информация
Теперь, когда вы создали масштабируемый набор с виртуальными машинами низкого приоритета, попробуйте развернуть [автомасштабируемый шаблон с параметром низкого приоритета](https://github.com/Azure/vm-scale-sets/tree/master/preview/lowpri).

Ознакомьтесь со сведениями о ценах на [странице для определения тарифа масштабируемых наборов виртуальных машин](https://azure.microsoft.com/pricing/details/virtual-machine-scale-sets/linux/).