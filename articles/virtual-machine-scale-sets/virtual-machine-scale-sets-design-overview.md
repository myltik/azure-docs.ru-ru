---
title: "Рекомендации по проектированию для масштабируемых наборов виртуальных машин Azure | Документация Майкрософт"
description: "Узнайте о рекомендациях по проектированию для масштабируемых наборов виртуальных машин Azure"
keywords: "Виртуальная машина Linux, наборы масштабирования виртуальных машин"
services: virtual-machine-scale-sets
documentationcenter: 
author: gatneil
manager: madhana
editor: tysonn
tags: azure-resource-manager
ms.assetid: c27c6a59-a0ab-4117-a01b-42b049464ca1
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 06/01/2017
ms.author: negat
ms.openlocfilehash: 0b05359938f4da544c4cb2a6fe60cfaf228478e1
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="design-considerations-for-scale-sets"></a>Рекомендации по проектированию масштабируемых наборов
В этом разделе рассматриваются вопросы проектирования наборов масштабирования виртуальных машин. Сведения о том, что такое масштабируемые наборы виртуальных машин, см. в статье [Обзор масштабируемых наборов виртуальных машин](virtual-machine-scale-sets-overview.md).

## <a name="when-to-use-scale-sets-instead-of-virtual-machines"></a>Когда следует использовать масштабируемые наборы вместо виртуальных машин
Как правило, масштабируемые наборы полезны при развертывании инфраструктуры высокой доступности с набором виртуальных машин одинаковой конфигурации. Тем не менее некоторые возможности доступны только в масштабируемых наборах, а другие — только в виртуальных машинах. Чтобы принять взвешенное решение о том, какую технологию использовать в том или ином случае, нужно сначала рассмотреть некоторые часто используемые возможности, доступные в масштабируемых наборах.

### <a name="scale-set-specific-features"></a>Возможности масштабируемого набора

- Указав конфигурацию масштабируемого набора, можно просто обновить свойство capacity, чтобы развертывать больше виртуальных машин параллельно. Это гораздо проще, чем написание скрипта для оркестрации развертывания множества отдельных виртуальных машин в параллельном режиме.
- [Автоматическое масштабирование Azure можно использовать для масштабируемого набора](./virtual-machine-scale-sets-autoscale-overview.md), но не для отдельных виртуальных машин.
- Вы можете [пересоздать образ виртуальных машин масштабируемого набора](https://docs.microsoft.com/rest/api/virtualmachinescalesets/manage-a-vm), но [не отдельных виртуальных машин](https://docs.microsoft.com/rest/api/compute/virtualmachines).
- Виртуальные машины масштабируемого набора можно [избыточно подготовить](./virtual-machine-scale-sets-design-overview.md), чтобы улучшить надежность и сократить время развертывания. С отдельными виртуальными машинами это можно сделать только написав пользовательский код.
- Чтобы упростить развертывание обновлений в виртуальных машинах масштабируемого набора, можно указать [политику обновления](./virtual-machine-scale-sets-upgrade-scale-set.md). Обновления для отдельных виртуальных машин необходимо оркестрировать самостоятельно.

### <a name="vm-specific-features"></a>Возможности отдельных виртуальных машин

С другой стороны, некоторые возможности доступны только в виртуальных машинах (по крайней мере на данный момент):

- Диски данных можно присоединить к определенной виртуальной машине, но подключенные диски данных настраиваются для всех виртуальных машин в масштабируемом наборе.
- Непустые диски данных можно подключить к отдельным виртуальным машинам, но не к виртуальным машинам в масштабируемом наборе.
- Можно сделать моментальный снимок отдельной виртуальной машины, но не машины в масштабируемом наборе.
- Можно записать образ отдельной виртуальной машины, но не машины в масштабируемом наборе.
- Отдельную виртуальную машину можно перенести из собственных дисков в управляемые. Для виртуальных машин в масштабируемом наборе это невозможно.
- Сетевым адаптерам отдельных виртуальных машин можно присвоить общедоступные IP-адреса IPv6, но этого нельзя сделать для виртуальных машин в масштабируемом наборе. Обратите внимание, что общедоступные IP-адреса IPv6 можно назначить подсистемам балансировки нагрузки как для отдельных виртуальных машин, так и для виртуальных машин масштабируемого набора.

## <a name="storage"></a>Хранилище

### <a name="scale-sets-with-azure-managed-disks"></a>Масштабируемые наборы с компонентом "Управляемые диски" Azure
Вместо обычных учетных записей хранения Azure для создания масштабируемых наборов можно использовать [компонент "Управляемые диски" Azure](../virtual-machines/windows/managed-disks-overview.md). Компонент "Управляемые диски" обеспечивает следующие преимущества:
- Вам не нужно заранее создавать набор учетных записей хранения Azure для виртуальных машин из масштабируемого набора.
- Вы можете определить [подключенные диски данных](virtual-machine-scale-sets-attached-disks.md) для виртуальных машин в масштабируемом наборе.
- Масштабируемые наборы можно настроить для [поддержки до 1000 виртуальных машин в наборе](virtual-machine-scale-sets-placement-groups.md). 

При наличии имеющегося шаблона можно также [обновить шаблон для использования компонента "Управляемые диски"](virtual-machine-scale-sets-convert-template-to-md.md).

### <a name="user-managed-storage"></a>Управляемое пользователем хранилище
Масштабируемый набор без компонента "Управляемые диски" Azure сохраняет диски операционной системы виртуальных машин в наборе в учетных записях хранения пользователей. Чтобы достичь максимального числа операций ввода-вывода и воспользоваться преимуществами _избыточной подготовки_ (см. ниже), мы рекомендуем использовать не более 20 виртуальных машин на одну учетную запись хранения. Мы также рекомендуем, чтобы имена учетных записей хранения начинались с разных букв. Это поможет распределить нагрузку между разными внутренними системами. 


## <a name="overprovisioning"></a>Избыточная подготовка
В настоящее время масштабируемый набор по умолчанию избыточно подготавливает виртуальные машины. Если избыточная подготовка включена, то масштабируемый набор фактически запускает больше виртуальных машин, чем указано, а затем удаляет лишние виртуальные машины после успешной подготовки запрошенного количества виртуальных машин. Избыточная подготовка повышает процент успешной подготовки к работе и сокращает процесс развертывания. Счета за дополнительные виртуальные машины не выставляются, и они не учитываются в квоте.

Хотя избыточная подготовка повышает процент успешной подготовки, он может вызывать проблемы, если в приложении не предусмотрена обработка ситуаций, когда виртуальные машины появляются и удаляются. Чтобы отключить избыточную подготовку, включите в шаблон следующую строку: `"overprovision": "false"`. Дополнительные сведения об этом можно найти в [документации по REST API для масштабируемого набора](/rest/api/virtualmachinescalesets/create-or-update-a-set).

Если выключить избыточную подготовку для масштабируемого набора, использующего учетную запись хранения пользователя, для учетной записи хранения может использоваться более 20 виртуальных машин. Из соображений производительности операций ввода-вывода мы не рекомендуем использовать более 40 виртуальных машин. 

## <a name="limits"></a>Ограничения
Масштабируемый набор, созданный на основе образа Marketplace (также известный как образ платформы) и настроенный для использования компонента "Управляемые диски" Azure, может содержать до 1000 виртуальных машин. Если настроить для масштабируемого набора поддержку более 100 виртуальных машин, не все сценарии будут выполняться одинаково (например, балансировка нагрузки). Дополнительные сведения см. в статье [Работа с крупными масштабируемыми наборами виртуальных машин](virtual-machine-scale-sets-placement-groups.md). 

В настоящее время масштабируемый набор, настроенный с помощью учетных записей хранения пользователей, ограничен 100 виртуальными машинами (и 5 учетными записями хранения для такого масштаба).

Масштабируемый набор, созданный на основе пользовательского образа и настроенный с использованием службы "Управляемые диски" Azure, может содержать до 300 виртуальных машин. Если масштабируемый набор настроен с учетными записями хранения пользователя, он должен создавать все VHD операционной системы в рамках одной учетной записи хранения. Поэтому рекомендуемое максимальное число виртуальных машин в наборе масштабирования на основе пользовательского образа и пользовательского хранилища равно 20. Если отключить избыточную подготовку, этот предел можно повысить до 40.

Для дополнительных виртуальных машин сверх этого значения необходимо развернуть несколько наборов масштабирования, как показано в [этом шаблоне](https://github.com/Azure/azure-quickstart-templates/tree/master/301-custom-images-at-scale).

