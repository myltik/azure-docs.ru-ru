---
title: "Создание графовой базы данных Azure Cosmos DB с помощью Java | Документация Майкрософт"
description: "В этой статье представлен пример кода Java, который можно использовать для подключения и выполнения запросов к данным графа в Azure Cosmos DB с помощью Gremlin."
services: cosmos-db
documentationcenter: 
author: dennyglee
manager: jhubbard
editor: 
ms.assetid: daacbabf-1bb5-497f-92db-079910703046
ms.service: cosmos-db
ms.custom: quick start connect, mvc
ms.workload: 
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: hero-article
ms.date: 08/07/2017
ms.author: denlee
ms.translationtype: HT
ms.sourcegitcommit: caaf10d385c8df8f09a076d0a392ca0d5df64ed2
ms.openlocfilehash: afa4fe6cdef298e4504ddcf3e344ee6a5c181653
ms.contentlocale: ru-ru
ms.lasthandoff: 08/08/2017

---
# <a name="azure-cosmos-db-create-a-graph-database-using-java-and-the-azure-portal"></a>Azure Cosmos DB: создание графовой базы данных с помощью Java и портала Azure

Azure Cosmos DB — это глобально распределенная многомодельная служба базы данных Майкрософт. Вы можете быстро создавать и запрашивать документы, пары "ключ — значение" и базы данных графов, используя преимущества возможностей глобального распределения и горизонтального масштабирования Azure Cosmos DB. 

Выполнив это краткое руководство, вы создадите графовую базу данных с помощью средств портала Azure для Azure Cosmos DB. В этом руководстве также объясняется, как быстро создать консольное приложение Java с помощью графовой базы данных и драйвера OSS [Gremlin Java](https://mvnrepository.com/artifact/org.apache.tinkerpop/gremlin-driver). Указания в этом руководстве применимы к любой операционной системе, с которой может работать Java. Выполнив инструкции из руководства, вы узнаете, как создавать и изменять ресурсы графов с помощью пользовательского интерфейса или программных средств. 

## <a name="prerequisites"></a>Предварительные требования

* [Комплект разработчика Java (JDK 1.7+)](http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html)
    * В Ubuntu выполните команду `apt-get install default-jdk`, чтобы установить JDK.
    * Обязательно настройте переменную среды JAVA_HOME так, чтобы она указывала на папку, в которой установлен пакет JDK.
* [Скачайте](http://maven.apache.org/download.cgi) и [установите](http://maven.apache.org/install.html) двоичный архив [Maven](http://maven.apache.org/).
    * В Ubuntu выполните команду `apt-get install maven`, чтобы установить Maven.
* [Git.](https://www.git-scm.com/)
    * В Ubuntu выполните команду `sudo apt-get install git`, чтобы установить Git.

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]

## <a name="create-a-database-account"></a>Создание учетной записи базы данных

Перед созданием графовой базы данных необходимо создать учетную запись графовой базы данных Gremlin с Azure Cosmos DB.

[!INCLUDE [cosmos-db-create-dbaccount-graph](../../includes/cosmos-db-create-dbaccount-graph.md)]

## <a name="add-a-graph"></a>Добавление графа

Теперь вы можете использовать обозреватель данных на портале Azure для создания базы данных графов. 

1. На портале Azure в меню навигации слева щелкните **Обозреватель данных (предварительная версия)**. 
2. В колонке **Обозреватель данных (ознакомительная версия)** щелкните **New Graph** (Создать граф), а затем заполните страницу, используя следующие сведения.

    ![Обозреватель данных на портале Azure](./media/create-graph-java/azure-cosmosdb-data-explorer.png)

    Настройка|Рекомендуемое значение|Описание
    ---|---|---
    Идентификатор базы данных|sample-database|Идентификатор новой базы данных. Имя базы данных может иметь длину от 1 до 255 символов и не может содержать `/ \ # ?` или пробел.
    Идентификатор графа|sample-graph|Идентификатор нового графа. Для имен графов предусмотрены те же требования к знакам, что и для идентификаторов баз данных.
    Емкость хранилища| 10 ГБ|Оставьте значение по умолчанию. Это емкость хранилища базы данных.
    Пропускная способность|400 ЕЗ|Оставьте значение по умолчанию. Вы можете увеличить масштаб пропускной способности позже, если необходимо уменьшить задержку.
    Единиц запроса в минуту|Отключить|Оставьте значение по умолчанию. Если вам нужно обработать рабочие нагрузки с высоким уровнем колебания, вы можете включить компонент [Единиц запроса в минуту](request-units-per-minute.md) позже.
    Ключ секции|Не указывайте|В этом руководстве не нужно указывать ключ раздела.

3. После заполнения формы нажмите кнопку **ОК**.

## <a name="clone-the-sample-application"></a>Клонирование примера приложения

Теперь необходимо клонировать приложение графа из GitHub. Задайте строку подключения и выполните ее. Вы узнаете, как можно упростить работу с данными программным способом. 

1. Откройте окно терминала Git, например Git Bash, и выполните команду `cd`, чтобы перейти в рабочий каталог.  

2. Выполните команду ниже, чтобы клонировать репозиторий с примером. 

    ```bash
    git clone https://github.com/Azure-Samples/azure-cosmos-db-graph-java-getting-started.git
    ```

## <a name="review-the-code"></a>Просмотр кода

Сделаем краткий обзор того, что происходит в приложении. Откройте файл `Program.java` из папки \src\GetStarted и найдите следующие строки кода. 

* Инициализация Gremlin `Client` из конфигурации в файле `src/remote.yaml`.

    ```java
    cluster = Cluster.build(new File("src/remote.yaml")).create();
    ...
    client = cluster.connect();
    ```

* Выполнение шагов Gremlin с использованием метода `client.submit`.

    ```java
    ResultSet results = client.submit(gremlin);

    CompletableFuture<List<Result>> completableFutureResults = results.all();
    List<Result> resultList = completableFutureResults.get();

    for (Result result : resultList) {
        System.out.println(result.toString());
    }
    ```

## <a name="update-your-connection-string"></a>Обновление строки подключения

1. Откройте файл src/remote.yaml. 

3. Укажите значения *hosts* (узлы), *username* (имя пользователя) и *password* (пароль) в файле src/remote.yaml. Остальные параметры не нужно изменять.

    Настройка|Рекомендуемое значение|Описание
    ---|---|---
    Узлы|[***.graphs.azure.com]|См. снимок экрана после этой таблицы. Это значение Gremlin URI на странице обзора портала Azure, указанное в квадратных скобках и без окончания :443/.<br><br>Его также можно получить на вкладке "Ключи" с помощью значения URI, удалив https://, изменив документы на диаграммы и удалив окончание 443/.
    Имя пользователя|/dbs/sample-database/colls/sample-graph|Ресурс в формате `/dbs/<db>/colls/<coll>`, где `<db>` — это имя существующей базы данных, а `<coll>` — имя существующей коллекции.
    Пароль|*Первичный главный ключ*|См. второй снимок экрана после этой таблицы. Это значение первичного ключа, которое можно найти на странице "Ключи" портала Azure в поле "Первичный ключ". Скопируйте значение с помощью кнопки копирования справа от поля.

    Для значения Hosts скопируйте значение **Gremlin URI** на странице **Обзор**. Если это значение отсутствует, см. в строке "Узлы" в таблице выше инструкции по созданию Gremlin URI в колонке "Ключи".
![Просмотр и копирование значения Gremlin URI на странице "Обзор" на портале Azure](./media/create-graph-java/gremlin-uri.png)

    Для значения пароля скопируйте **первичный ключ** в колонке **Ключи**: ![Просмотр и копирование первичного ключа на портале Azure из страницы "Ключи"](./media/create-graph-java/keys.png)

## <a name="run-the-console-app"></a>Запуск консольного приложения

1. В окне терминала Git перейдите в папку azure-cosmos-db-graph-java-getting-started с помощью команды `cd`.

2. В окне терминала Git введите команду `mvn package`, чтобы установить необходимые пакеты Java.

3. В окне терминала Git выполните команду `mvn exec:java -D exec.mainClass=GetStarted.Program`, чтобы запустить приложение Java.

В окне терминала появятся вершины, добавляемые в граф. После выполнения программы снова откройте в веб-браузере портал Azure. 

<a id="add-sample-data"></a>
## <a name="review-and-add-sample-data"></a>Просмотр и добавление демонстрационных данных

Теперь можно вернуться в обозреватель данных, чтобы просмотреть вершины, добавленные в граф, и добавить дополнительные точки данных.

1. В обозревателе данных разверните узел **sample-database**/**sample-graph**, щелкните **Граф** и нажмите кнопку **Применить фильтр**. 

   ![Создание документов в обозревателе данных на портале Azure](./media/create-graph-java/azure-cosmosdb-data-explorer-expanded.png)

2. В списке **результатов** обратите внимание на новых пользователей, добавленных в граф. Выберите пользователя **ben**. Вы увидите, что он связан с пользователем robin. В обозревателе графа можно перемещать вершины, увеличивать и уменьшать масштаб и увеличивать размер области обозревателя графа. 

   ![Новые вершины в графе в обозревателе данных на портале Azure](./media/create-graph-java/azure-cosmosdb-graph-explorer-new.png)

3. Добавим новых пользователей в граф с помощью обозревателя данных. Нажмите кнопку **New Vertex** (Создать вершину), чтобы добавить данные в граф.

   ![Создание документов в обозревателе данных на портале Azure](./media/create-graph-java/azure-cosmosdb-data-explorer-new-vertex.png)

4. Введите метку *пользователя* и укажите следующие ключи и значения для создания первой вершины в графе. Обратите внимание, что вы можете создать уникальные свойства для каждого пользователя в графе. Требуется только ключ идентификатора.

    key|value|Примечания
    ----|----|----
    id|ashley|Уникальный идентификатор вершины. Если не указать идентификатор, он создастся автоматически.
    gender|Женский| 
    Технология | java | 

    > [!NOTE]
    > В этом кратком руководстве мы создадим несекционированную коллекцию. Но если вы создаете секционированную коллекцию, указав ключ раздела во время создания коллекции, включите ключ раздела в качестве ключа каждой новой вершины. 

5. Нажмите кнопку **ОК**. Чтобы увидеть кнопку **ОК** в нижней части экрана, может потребоваться развернуть экран.

6. Еще раз нажмите кнопку **New Vertex** (Создать вершину), чтобы добавить нового пользователя. Введите метку *пользователя* и укажите следующие ключи и значения:

    key|value|Примечания
    ----|----|----
    id|rakesh|Уникальный идентификатор вершины. Если не указать идентификатор, он создастся автоматически.
    gender|Мужской| 
    Учебное заведение|MIT| 

7. Нажмите кнопку **ОК**. 

8. Нажмите кнопку **Применить фильтр** с фильтром по умолчанию `g.V()`. Все пользователи теперь отображаются в списке **Результаты**. По мере добавления новых данных используйте фильтры для ограничения результатов. По умолчанию обозреватель данных использует фильтр `g.V()` для получения всех вершин в графе. Но вы можете заменить его другим [запросом к графу](tutorial-query-graph.md), например `g.V().count()`, чтобы получить количество всех вершин в графе в формате JSON.

9. Теперь можно будет соединить пользователей rakesh и ashley. Выберите в списке **Результаты** пользователя **ashley**, а затем нажмите кнопку редактирования рядом с разделом **Целевые объекты** в нижнем правом углу. Чтобы отобразить область **Свойства**, может потребоваться развернуть окно.

   ![Изменение целевого объекта вершины в графе](./media/create-graph-java/azure-cosmosdb-data-explorer-edit-target.png)

10. В поле **Целевой объект** введите *rakesh*, затем в поле **Граничная метка** введите слово *знает* и установите флажок.

   ![Создание связи между пользователями ashley и rakesh в обозревателе данных](./media/create-graph-java/azure-cosmosdb-data-explorer-set-target.png)

11. Теперь выберите пользователя **rakesh** в списке результатов. Вы увидите, что пользователи ashley и rakesh связаны. 

   ![Две вершины, связанные в обозревателе данных](./media/create-graph-java/azure-cosmosdb-graph-explorer.png)

    В обозревателе данных также можно создавать хранимые процедуры, триггеры и определяемые пользователем функции, чтобы реализовать бизнес-логику на стороне сервера и масштабировать пропускную способность. Это средство позволяет использовать все встроенные возможности программного доступа к данным, доступные в API-интерфейсах, к которым вы можете быстро получить доступ на портале Azure.



## <a name="review-slas-in-the-azure-portal"></a>Просмотр соглашений об уровне обслуживания на портале Azure

[!INCLUDE [cosmosdb-tutorial-review-slas](../../includes/cosmos-db-tutorial-review-slas.md)]

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы не собираетесь использовать это приложение дальше, удалите все ресурсы, созданные в ходе работы с этим руководством, на портале Azure, сделав следующее: 

1. В меню слева на портале Azure щелкните **Группы ресурсов**, а затем выберите имя созданного ресурса. 
2. На странице группы ресурсов щелкните **Удалить**, в текстовом поле введите имя ресурса для удаления и щелкните **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

В этом кратком руководстве вы узнали, как создать учетную запись Azure Cosmos DB, граф с помощью обозревателя данных, а также как запустить приложение. Теперь вы можете создавать более сложные запросы и внедрять эффективную логику обхода графа с помощью Gremlin. 

> [!div class="nextstepaction"]
> [Как выполнять запросы к данным в базе данных Azure Cosmos DB с помощью API Graph (предварительная версия)](tutorial-query-graph.md)


