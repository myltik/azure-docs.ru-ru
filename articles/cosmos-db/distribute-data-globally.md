---
title: Глобальное распределение данных с помощью Azure Cosmos DB | Документация Майкрософт
description: Сведения о георепликации в масштабах планеты, отработке отказа и восстановлении данных с помощью глобальных баз данных из Azure Cosmos DB — глобально распределенной многомодельной службы базы данных.
services: cosmos-db
documentationcenter: ''
author: SnehaGunda
manager: kfile
ms.assetid: ba5ad0cc-aa1f-4f40-aee9-3364af070725
ms.service: cosmos-db
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/26/2018
ms.author: sngun
ms.openlocfilehash: 967e7458d43dccd4601440138b7445eb876b9f01
ms.sourcegitcommit: 59914a06e1f337399e4db3c6f3bc15c573079832
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/19/2018
---
# <a name="how-to-distribute-data-globally-with-azure-cosmos-db"></a>Как работает глобальное распределение данных в Azure с помощью Cosmos DB
Среда Azure вездесуща: она используется более чем в 50 географических регионах по всему миру и постоянно растет. Благодаря повсеместному присутствию одной из отличительных возможностей, предлагаемых Azure разработчикам, является возможность легко выполнять сборку, развертывание и управление глобально распределенными приложениями. 

[Azure Cosmos DB](../cosmos-db/introduction.md) — это глобально распределенная, многомодельная служба базы данных Майкрософт, необходимая для работы с критически важными приложениями. Эта служба базы данных обеспечивает готовое к использованию глобальное распределение, [гибкое масштабирование пропускной способности и хранилища](../cosmos-db/partition-data.md) по всему миру, задержки менее 10 миллисекунд на уровне 99-го процентиля, [пять четко определенных моделей согласованности](consistency-levels.md), а также гарантированную высокую доступность — все это согласно [ведущим в отрасли комплексным соглашениям об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/cosmos-db/). Azure Cosmos DB [автоматически индексирует все данные](http://www.vldb.org/pvldb/vol8/p1668-shukla.pdf) без необходимости управлять схемами или индексами. В этой службе поддерживается множество моделей данных, включая документы, пары "ключ-значение", графы и базы данных столбцов. Изначально являясь облачной службой, система Azure Cosmos DB с самого начала была разработана для обеспечения мультитенантности и глобального распространения.


![Коллекция Azure Cosmos DB, секционированная и распределенная по трем регионам](./media/distribute-data-globally/global-apps.png)

**Отдельный контейнер Azure Cosmos DB, секционированный и распределенный по нескольким регионам Azure**

Как мы узнали при разработке Azure Cosmos DB, не стоит добавлять возможности глобального распространения опосредованно. Их невозможно "прикрутить" к "односайтовой" СУБД. Возможности, предлагаемые глобально распределенной базой данных, выходят за пределы возможностей традиционного географического аварийного восстановления (Geo-DR), предлагаемых "односайтовыми" базами данных. Односайтовые базы данных, предлагающие возможности Geo-DR, являются строгим подмножеством глобально распределенных баз данных. 

Благодаря готовому к использованию глобальному распространению, предлагаемому Azure Cosmos DB, разработчикам не придется создавать собственные шаблоны репликации, либо применяя шаблон Lambda (например, [репликацию AWS DynamoDB](https://github.com/awslabs/dynamodb-cross-region-library/blob/master/README.md)) к журналу базы данных, либо выполняя "двойную запись" в нескольких регионах. Мы *не* рекомендуем эти подходы, так как они не позволяют гарантировать правильность применяемых методов и обеспечить полноценные соглашения об уровне обслуживания. 

В этой статье содержится обзор возможностей глобального распространения Azure Cosmos DB. Мы также опишем уникальный подход Azure Cosmos DB к предоставлению исчерпывающих соглашений об уровне обслуживания. 

## <a id="EnableGlobalDistribution"></a>Включение готового к использованию глобального распространения
Azure Cosmos DB предоставляет следующие возможности, позволяющие легко создавать глобально распределенные приложения. Эти возможности доступны через [интерфейсы REST API](https://docs.microsoft.com/rest/api/cosmos-db-resource-provider/) поставщика ресурсов Azure Cosmos DB, а также на портале Azure.

Просмотрите следующее видео, чтобы ознакомиться с готовой к использованию функцией глобального распределения в Azure Cosmos DB в действии.

> [!VIDEO https://www.youtube.com/embed/1D06yjTVxt8]
>

### <a id="RegionalPresence"></a>Повсеместное географическое присутствие 
Azure постоянно расширяет свое географическое присутствие, добавляя [новые регионы](https://azure.microsoft.com/regions/) в сеть. Azure Cosmos DB относится к *базовым службам* в Azure, она доступна во всех новых регионах Azure по умолчанию. Это позволяет связать географический регион со своей учетной записью базы данных Azure Cosmos DB, как только Azure откроет новый регион для осуществления операций.

### <a id="UnlimitedRegionsPerAccount"></a>Связывание неограниченного количества регионов с учетной записью базы данных Azure Cosmos DB
Azure Cosmos DB позволяет связать любое количество регионов Azure с учетной записью базы данных Azure Cosmos DB. Кроме ограничений, связанных с определением геозон (например, Китай, Германия), ничто не ограничивает количество регионов, которые можно связать с учетной записью базы данных Azure Cosmos DB. На следующем рисунке показана учетная запись базы данных, охватывающая 25 регионов Azure.  

![Учетная запись базы данных Azure Cosmos DB, охватывающая 25 регионов Azure](./media/distribute-data-globally/spanning-regions.png)

**Учетная запись базы данных Azure Cosmos DB клиента, охватывающая 25 регионов Azure**


### <a id="PolicyBasedGeoFencing"></a>Определение геозон на основе политик
В Azure Cosmos DB реализована поддержка определения геозон на основе политик. Определение геозон является важной составляющей для соблюдения ограничений, связанных с управлением данных и соответствием требованиям, и оно может не допустить связывание определенного региона с вашей учетной записью. К примерам определения геозон относятся (но не ограничиваются ими) охват глобальным распределением регионов в независимом облаке (например, в Китае и Германии) или в пределах границ государственного налогообложения (например, в Австралии). Политики управляются с помощью метаданных подписки Azure.

### <a id="DynamicallyAddRegions"></a>Динамическое добавление и удаление регионов
Azure Cosmos DB позволяет в любой момент добавить (связать) или удалить (отменить связь) регионы в учетной записи базы данных (см. [предыдущий рисунок](#UnlimitedRegionsPerAccount)). Посредством параллельной репликации данных в секциях Azure Cosmos DB гарантирует, что при добавлении нового региона он становится доступным для работы в течение 30 минут в любой точке мира (при условии, что объем данных составляет не более 100 ТБ). 

### <a id="FailoverPriorities"></a>Приоритеты отработки отказа
Чтобы обеспечить точную последовательность региональной отработки отказа при сбое, Azure Cosmos DB позволяет присвоить *приоритет* различным регионам, связанным с учетной записью базы данных (см. следующий рисунок). Azure Cosmos DB гарантирует, что последовательность автоматической отработки отказа происходит в порядке указанных приоритетов. Дополнительные сведения о региональной отработке отказа см. в статье об [автоматической отработке отказа между регионами для обеспечения непрерывности бизнес-процессов в Azure Cosmos DB](regional-failover.md).


![Настройка приоритетов отработки отказа с помощью Azure Cosmos DB](./media/distribute-data-globally/failover-priorities.png)

**Клиент Azure Cosmos DB может настроить порядок приоритета отработки отказа (правая область) для регионов, связанных с учетной записью базы данных**

### <a id="ConsistencyLevels"></a>Несколько четко определенных моделей согласованности для глобально распределенных баз данных
Azure Cosmos DB поддерживает [несколько четко определенных, интуитивно понятных и практичных моделей согласованности](consistency-levels.md) с соответствующими соглашениями об уровне обслуживания. Можно выбрать определенную модель согласованности (из списка доступных вариантов) в зависимости от рабочей нагрузки и сценариев. 

### <a id="TunableConsistency"></a>Настраиваемая согласованность для глобально реплицируемых баз данных
Azure Cosmos DB позволяет программно переопределить и понизить выбранный по умолчанию уровень согласованности для каждого запроса во время выполнения. 

### <a id="DynamicallyConfigurableReadWriteRegions"></a>Динамически настраиваемые регионы чтения и записи
Azure Cosmos DB позволяет настраивать регионы, связанные с базой данных, как регионы для чтения, записи или чтения и записи. 

### <a id="ElasticallyScaleThroughput"></a>Эластичное масштабирование пропускной способности в регионах Azure
Вы можете эластично масштабировать контейнер Azure Cosmos DB, программно подготавливая пропускную способность. Пропускная способность применяется ко всем регионам, на которые распределяется контейнер Azure Cosmos DB.

### <a id="GeoLocalReadsAndWrites"></a>Локальные операции чтения и записи
Ключевым преимуществом глобально распределенной базы данных является высокоскоростной доступ к данным в любой точке мира. Azure Cosmos DB предлагает операции чтения и записи с низкой задержкой и 99-м процентилем по всему миру. Это гарантирует, что все операции чтения обслуживаются в ближайшем (локальном) регионе. Для обслуживания запроса на чтение используется кворум, являющийся локальным для региона, в котором выполняется чтение. Это относится и к операциям записи. Запись подтверждается только после того, как большинство реплик надежно зафиксируют запись локально, но без проверки на удаленных репликах для подтверждения операций записи. Иначе говоря, протокол репликации Azure Cosmos DB работает с учетом предположения о том, что кворумы чтения и записи всегда являются локальными для регионов, в которых выдается запрос.

### <a id="ManualFailover"></a>Отработка отказа вручную
Azure Cosmos DB позволяет активировать отработку отказа учетной записи базы данных, чтобы проверить *комплексные* характеристики доступности всего приложения (за пределами базы данных). Так как гарантируется безопасность и жизнеспособность средств обнаружения сбоев и выбора лидера, Azure Cosmos DB гарантирует *полную защиту от потери данных* при инициируемой клиентом ручной отработке отказа.

### <a id="AutomaticFailover"></a>Автоматическая отработка отказа
Azure Cosmos DB поддерживает автоматическую отработку отказа в случае сбоя одного или нескольких регионов. Во время региональной отработки отказа Azure Cosmos DB поддерживает параметры задержки при чтении, гарантированной бесперебойной работы, согласованности и пропускной способности, определенные соглашениями об уровне обслуживания. Azure Cosmos DB задает максимальную продолжительность операции автоматической отработки отказа. Это период потенциальной потери данных во время регионального сбоя.

### <a id="GranularFailover"></a>Выбор степени детализации отработки отказа
В настоящее время возможности автоматической и ручной отработки отказа предоставляются на уровне учетной записи базы данных. Обратите внимание на то, что внутренние процессы Azure Cosmos DB разработаны для обеспечения *автоматической* отработки отказа с большей степенью детализации: до базы данных, контейнера или даже секции (контейнера, содержащего диапазон ключей). 

### <a id="MultiHomingAPIs"></a>Множественная адресация в Azure Cosmos DB
Azure Cosmos DB позволяет взаимодействовать с базой данных, используя *логические* (независящие от региона) или *физические* (зависящие от региона) конечные точки. Применение логических конечных точек гарантирует, что приложение сможет явным образом использовать множественную адресацию в случае отработки отказа. Физическая же конечная точка предоставляет приложению детализированный контроль для перенаправления операций чтения и записи в определенные регионы.

Сведения о настройке параметров чтения для [API SQL](../cosmos-db/tutorial-global-distribution-sql-api.md), [API Gremlin](../cosmos-db/tutorial-global-distribution-graph.md), [API таблиц](../cosmos-db/tutorial-global-distribution-table.md) и [API MongoDB](../cosmos-db/tutorial-global-distribution-mongodb.md) можно найти в приведенных ниже статьях.

### <a id="TransparentSchemaMigration"></a>Прозрачный и согласованный перенос схемы и индекса базы данных 
Azure Cosmos DB является полностью [бессхемной](http://www.vldb.org/pvldb/vol8/p1668-shukla.pdf) службой. Уникальное устройство ядра СУБД Azure Cosmos DB позволяет автоматически и синхронно индексировать все принимаемые данные, не требуя от пользователя схемы или вторичных индексов. Это дает возможность быстро выполнять итерацию глобально распределенного приложения, не беспокоясь о переносе схемы и индекса базы данных или координировании многоэтапных развертываний изменений схемы в приложении. Azure Cosmos DB гарантирует, что любые изменения политик индексации, внесенные вами явным образом, не приведут к снижению производительности или доступности.  

### <a id="ComprehensiveSLAs"></a>Исчерпывающие соглашения об уровне обслуживания (не только высокий уровень доступности)
Являясь глобально распределенной службой базы данных, Azure Cosmos DB предлагает четко определенные комплексные соглашения об уровне обслуживания, регулирующие характеристики базы данных (**доступность**, **задержка**, **пропускная способность** и **согласованность**) независимо от количества связанных с ней регионов.  

## <a id="LatencyGuarantees"></a>Гарантии относительно задержки
Ключевым преимуществом такой глобально распределенной службы базы данных, как Azure Cosmos DB, является высокоскоростной доступ к данным в любой точке мира. Azure Cosmos DB предлагает гарантированную низкую задержку на уровне 99-го процентиля (99th) для различных операций базы данных. Протокол репликации, который использует Azure Cosmos DB, гарантирует, что операции базы данных (и операции чтения, и операции записи) всегда выполняются в локальном для клиента регионе. Соглашение об уровне обслуживания Azure Cosmos DB, регулирующее задержку, обеспечивает гарантии на уровне 99-го процентиля для операций чтения, индексированных операций записи (синхронно) и запросов для различных размеров запроса и ответа. Гарантии задержки для операций записи включают в себя надежную фиксацию кворумом большинства в локальном регионе.

### <a id="LatencyAndConsistency"></a>Взаимосвязь задержки и согласованности 
Чтобы глобально распределенная служба смогла обеспечить строгую согласованность в глобально распределенной инфраструктуре, ей требуется синхронно реплицировать операции записи или синхронно выполнять операции чтения между регионами. Скорость света и доступность глобальной сети предписывают, что строгая согласованность приведет к большей задержке и уменьшит доступность операций базы данных. Таким образом, чтобы гарантировать низкую задержку на уровне 99-го процентиля и 99,99 % доступности для всех учетных записей в одном регионе и всех учетных записей в нескольких регионах с нестрогой согласованностью, а также 99,999 % доступности для всех учетных записей базы данных в нескольких регионах, служба должна задействовать асинхронную репликацию. Из этого также следует, что служба должна обеспечивать [четко определенные модели нестрогой согласованности](consistency-levels.md), которые будут менее надежны, чем модели строгой согласованности (чтобы предоставить гарантии низкой задержки и доступности), и, в идеальном случае, более надежны, чем согласованность в конечном счете (с использованием интуитивной модели программирования).

Azure Cosmos DB гарантирует, что операции чтения не требуется обращаться к репликам в нескольких регионах, чтобы обеспечить определенный гарантированный уровень согласованности. Точно так же гарантируется, что операция записи не блокируются, если данные реплицируются во всех регионах (т. е. операции записи асинхронно реплицируются в регионах). Для учетных записей базы данных в нескольких регионах доступны модель строгой и несколько моделей нестрогой согласованности. 

### <a id="LatencyAndAvailability"></a>Взаимосвязь задержки и доступности 
Задержка и доступность — это две стороны одной медали. Мы говорим о задержке операции в устойчивом состоянии и ее доступности в случае сбоев и секционирования сети. С точки зрения приложения медленное выполнение операций базы данных не отличается от недоступности базы данных. 

Чтобы отличать большую задержку и недоступность, Azure Cosmos DB использует абсолютную верхнюю границу задержки для различных операций базы данных. Если операция базы данных выполняется дольше, чем позволяет это значение, то Azure Cosmos DB возвращает ошибку времени ожидания. Соглашение об уровне обслуживания Azure Cosmos DB, регулирующее доступность, гарантирует, что время ожидания считается в соответствии с этим соглашением. 

### <a id="LatencyAndThroughput"></a>Взаимосвязь задержки и пропускной способности
Azure Cosmos DB не принуждает выбирать между задержкой и пропускной способностью. Учитываются соглашения об уровне обслуживания для задержки на уровне 99-го перцентиля и для пропускной способности, которую вы подготовили. 

## <a id="ConsistencyGuarantees"></a>Гарантии согласованности
Хотя [модель строгой согласованности](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf) является золотым стандартом программирования данных, за нее приходится дорого расплачиваться повышенной задержкой (в устойчивом состоянии) и снижением доступности (в случае сбоев). 

Azure Cosmos DB предлагает четко определенную модель программирования, позволяющую обеспечить согласованность реплицируемых данных. Чтобы вы могли легко создавать глобально распределенные приложения с множественной адресацией, модели согласованности, предоставляемые Azure Cosmos DB, не зависят от региона, из которого обслуживаются операции чтения и записи. 

Соглашение об уровне обслуживания Azure Cosmos DB, регулирующее согласованность, гарантирует, что 100 % запросов на чтение будут соответствовать гарантированному значению для запрошенной вами модели согласованности (на уровне учетной записи базы данных или запроса). Запрос на чтение считается соответствующим соглашению об уровне обслуживания, регулирующему согласованность, если удовлетворяются гарантии согласованности, связанные с уровнем согласованности. В следующей таблице указаны гарантии согласованности, соответствующие определенным моделям согласованности, предлагаемым Azure Cosmos DB.

<table>
    <tr>
        <td><strong>Модель согласованности</strong></td>
        <td><strong>Характеристики согласованности</strong></td>
        <td><strong>Соглашение об уровне обслуживания</strong></td>
    </tr>
        <tr>
        <td>Уровень согласованности Strong (сильная)</td>
        <td>Линеаризуемость</td>
        <td>100 %</td>
    </tr>
    <tr>
        <td rowspan="3">Ограниченная с запаздыванием</td>
        <td>Монотонное чтение (в пределах региона)</td>
        <td>100 %</td>
    </tr>
    <tr>
        <td>Согласованность префиксов</td>
        <td>100 %</td>
    </tr>
    <tr>
        <td>Предел запаздывания &lt; K, T</td>
        <td>100 %</td>
    </tr>
<tr>
        <td rowspan="3">Сеанс</td>
        <td>Чтение собственной записи</td>
        <td>100 %</td>
    </tr>
    <tr>
        <td>Монотонное чтение</td>
        <td>100 %</td>
    </tr>
    <tr>
        <td>Согласованность префиксов</td>
        <td>100 %</td>
    </tr>
    <tr>
        <td>Согласованность префиксов</td>
        <td>Согласованность префиксов</td>
        <td>100 %</td>
    </tr>
</table>

**Гарантии согласованности, связанные с заданной моделью согласованности в Azure Cosmos DB**


### <a id="ConsistencyAndAvailability"></a>Взаимосвязь согласованности и доступности
Следствие [теоремы CAP](https://people.eecs.berkeley.edu/~brewer/cs262b-2004/PODC-keynote.pdf) [о невыполнимости](http://www.glassbeam.com/sites/all/themes/glassbeam/images/blog/10.1.1.67.6951.pdf) подтверждает, что в случае сбоев система действительно не может оставаться доступной и обеспечивать линеаризуемую согласованность. Служба базы данных должна реализовать или модель CP, или модель AP, где система CP отказывается от доступности в пользу линеаризуемой согласованности, а система AP — от [линеаризуемой согласованности](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf) в пользу доступности. Служба Azure Cosmos DB не нарушает требуемую модель согласованности, что формально относит ее к системам CP. Однако на практике согласованность не ограничена принципом "все или ничего". Существует несколько четко определенных моделей согласованности, как и диапазон от линеаризуемой согласованности до согласованности в конечном счете. В Azure Cosmos DB мы попытались определить несколько моделей нестрогой согласованности, которые подходят для реальных сценариев и являются интуитивно понятными. Azure Cosmos DB позволяет избежать компромиссов согласованности и доступности, предлагая [несколько четко определенных моделей нестрогой согласованности](consistency-levels.md) и 99,99 % доступность для всех учетных записей в одном регионе, а также 99,999 % доступность операций чтения и записи для всех учетных записей базы данных в нескольких регионах. 

### <a id="ConsistencyAndAvailability"></a>Взаимосвязь согласованности и задержки
Более исчерпывающий вариант теоремы CAP был называется [PACELC](http://cs-www.cs.yale.edu/homes/dna/papers/abadi-pacelc.pdf). В нем учитываются компромиссы между задержкой и согласованностью в устойчивом состоянии. В этой теореме утверждается, что в устойчивом состоянии СУБД должна выбрать между согласованностью и задержкой. Предлагая несколько моделей нестрогой согласованности (с асинхронными репликацией и локальными операциями чтения, а также кворумом записи), Azure Cosmos DB гарантирует, что все операции чтения и записи будут локальными для регионов чтения и записи соответственно. Это позволяет Azure Cosmos DB предложить гарантии низкой задержки в регионе для этих моделей согласованности.  

### <a id="ConsistencyAndThroughput"></a>Взаимосвязь согласованности и пропускной способности
Так как реализация конкретной модели согласованности зависит от выбора [типа кворума](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf), пропускная способность также зависит от выбора модели согласованности. Например, в Azure Cosmos DB плата за единицу запроса (ЕЗ) для строго согласованных операций чтения примерно в *два раза* выше, чем для операций чтения, согласованных в конечном счете. В этом случае для достижения такой же пропускной способности необходимо подготовить двойное количество ЕЗ.


![Взаимосвязь между согласованностью и пропускной способностью](./media/distribute-data-globally/consistency-and-throughput.png)

**Взаимосвязь между нагрузкой операций чтения и определенной моделью согласованности в Azure Cosmos DB**

## <a id="ThroughputGuarantees"></a>Гарантии пропускной способности 
Azure Cosmos DB позволяет эластично масштабировать пропускную способность (а также ресурсы хранилища) в любом количестве регионов в зависимости от потребностей. 

![Распределенные и секционированные коллекции Azure Cosmos DB](../cosmos-db/media/introduction/azure-cosmos-db-global-distribution.png)

**Отдельный контейнер Azure Cosmos DB горизонтально секционируется (разделяется на три секции ресурсов в регионе), а затем глобально распределяется по трем регионам Azure**

Контейнер Azure Cosmos DB распределяется в двух плоскостях — в пределах региона (1) и между регионами (2). Этот процесс описывается далее. 

* **Локальное распределение**. В пределах отдельного региона контейнер Azure Cosmos DB развертывается горизонтально с точки зрения *секций ресурсов*. Каждая секция ресурсов управляет набором ключей и является строго согласованной и высокодоступной, так как физически ее представляют четыре реплики (т. н. *набор реплик*), для которых выполняется репликация конечного автомата. Azure Cosmos DB — это полностью управляемая ресурсами система, в которой секции ресурсов отвечают за предоставление своей доли пропускной способности в пределах бюджета выделенных ей системных ресурсов. Масштабирование контейнера Azure Cosmos DB является абсолютно прозрачным для пользователей. Azure Cosmos DB управляет секциями ресурсов, разделяя и объединяя их при изменении потребностей в ресурсах хранилища и пропускной способности. 
* **Глобальное распределение**. Если база данных находится в нескольких регионах, то каждая секция ресурсов распределяется по ним. Секции ресурсов, обладающие одинаковым набором ключей в разных регионах, образуют *набор секций* (см. [предыдущий рисунок](#ThroughputGuarantees)).  Секции ресурсов в наборе секций координируются с помощью репликации конечного автомата в нескольких регионах, связанных с базой данных. В зависимости от того, какой уровень согласованности задан, секции ресурсов в наборе секций настраиваются динамически с помощью различных топологий (например, "звезда", подключение шлейфом, "дерево" и т. д.). 

Благодаря чрезвычайно гибкому управлению секциями, балансировке нагрузки и строгому управлению ресурсами Azure Cosmos DB позволяет эластично масштабировать пропускную способность в нескольких регионах Azure, связанных с контейнером или базой данных Azure Cosmos DB. Изменение подготовленной пропускной способности — это операция времени выполнения в Azure Cosmos DB. Как и для других операций баз данных, Azure Cosmos DB гарантирует абсолютную верхнюю границу задержки для запроса на изменение подготовленной пропускной способности. Например, на следующем рисунке показан контейнер клиента с эластично подготавливаемой по требованию пропускной способностью (меняющейся от 1 до 10 млн запросов в секунду в двух регионах).

![Эластичная подготовка пропускной способности в Azure Cosmos DB](./media/distribute-data-globally/elastic-throughput.png)

**Контейнер клиента с эластично подготавливаемой пропускной способностью (меняющейся от 1 до 10 млн запросов в секунду)**

### <a id="ThroughputAndConsistency"></a>Взаимосвязь пропускной способности и согласованности 
То же, что и [взаимосвязь согласованности и пропускной способности](#ConsistencyAndThroughput).

### <a id="ThroughputAndAvailability"></a>Взаимосвязь пропускной способности и доступности
Служба Azure Cosmos DB продолжает обеспечивать высокий уровень доступности при изменении подготовленной пропускной способности. Она прозрачно управляет секциями ресурсов (например, выполняет операции разделения, объединения и клонирования) и гарантирует, что эти операции не снижают производительность или уровень доступности, пока приложение эластично увеличивает или уменьшает пропускную способность. 

## <a id="AvailabilityGuarantees"></a>Гарантии доступности
Azure Cosmos DB обеспечивает 99,99 % доступность в соответствии с соглашением об уровне обслуживания для всех учетных записей баз данных в пределах одного и нескольких регионов с нестрогой согласованностью и 99,999 % доступность для чтения для всех учетных записей баз данных в пределах нескольких регионов. Как уже упоминалось, гарантии доступности Azure Cosmos DB включают в себя абсолютную верхнюю границу задержки для каждой операции в плоскостях данных и управления. Гарантии доступности не меняются при изменении числа регионов или географического расстояния между ними. Гарантии доступности применяются как к ручной, так и к автоматической отработке отказа. Azure Cosmos DB предлагает прозрачные интерфейсы API множественной адресации, благодаря которым ваше приложение сможет работать с логическими конечными точками и прозрачно перенаправлять запросы в новый регион в случае отработки отказа. Приложение не потребуется развертывать повторно при региональной отработке отказа, и соглашения об уровне обслуживания, регулирующие доступность, всегда соблюдаются.

### <a id="AvailabilityAndConsistency"></a>Взаимосвязь доступности с согласованностью, задержкой и пропускной способностью
Взаимосвязь доступности с согласованностью, задержкой и пропускной способностью описывается в разделах [Взаимосвязь согласованности и доступности](#ConsistencyAndAvailability), [Взаимосвязь задержки и доступности](#LatencyAndAvailability) и [Взаимосвязь пропускной способности и доступности](#ThroughputAndAvailability). 

## <a id="CustomerFacingSLAMetrics"></a>Метрики соглашения об уровне обслуживания для клиентов
Azure Cosmos DB явным образом предоставляет метрики пропускной способности, задержек, согласованности и доступности. Эти метрики можно использовать программно или через портал Azure (см. следующий рисунок). Можно также настроить оповещения для различных пороговых значений с помощью Azure Application Insights.
 

![Видимые клиентам метрики Azure Cosmos DB](./media/distribute-data-globally/customer-slas.png)

**Метрики пропускной способности, задержек, согласованности и доступности явным образом доступны для каждого клиента**

## <a id="Next Steps"></a>Дальнейшие действия
* Сведения о реализации глобальной репликации для учетной записи Azure Cosmos DB с помощью портала Azure см. в [этой статье](tutorial-global-distribution-sql-api.md).
* Сведения о реализации архитектуры с несколькими базами данных master с помощью Azure Cosmos DB см. в [этой статье](multi-region-writers.md).
* Сведения о том, как автоматическая и ручная отработки отказа работают в Azure Cosmos DB, см. в [этой статье](regional-failover.md).

## <a id="References"></a>Справочные материалы
1. Eric Brewer. [Towards Robust Distributed Systems](https://people.eecs.berkeley.edu/~brewer/cs262b-2004/PODC-keynote.pdf)
2. Eric Brewer. [CAP Twelve Years Later – How the rules have changed](http://informatik.unibas.ch/fileadmin/Lectures/HS2012/CS341/workshops/reportsAndSlides/PresentationKevinUrban.pdf)
3. Gilbert, Lynch. - [Brewer's Conjecture and Feasibility of Consistent, Available, Partition Tolerant Web Services](http://www.glassbeam.com/sites/all/themes/glassbeam/images/blog/10.1.1.67.6951.pdf) (Гипотеза Брюера и возможность создания согласованных доступных веб-служб, совместимых с секционированием)
4. Дэниэл Абади. [Consistency Tradeoffs in Modern Distributed Database Systems Design](http://cs-www.cs.yale.edu/homes/dna/papers/abadi-pacelc.pdf)
5. Martin Kleppmann. [Please stop calling databases CP or AP](https://martin.kleppmann.com/2015/05/11/please-stop-calling-databases-cp-or-ap.html)
6. Peter Bailis et al. [Probabilistic Bounded Staleness (PBS) for Practical Partial Quorums](http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf)
7. Naor and Wool. [Load, Capacity and Availability in Quorum Systems](http://www.cs.utexas.edu/~lorenzo/corsi/cs395t/04S/notes/naor98load.pdf)
8. Herlihy and Wing. [Lineralizability: A correctness condition for concurrent objects](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf)
9. [Соглашение об уровне обслуживания для Azure Cosmos DB](https://azure.microsoft.com/support/legal/sla/cosmos-db/)
