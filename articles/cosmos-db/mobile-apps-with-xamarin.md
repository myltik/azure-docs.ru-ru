---
title: Создание мобильных приложений с помощью Xamarin и Azure Cosmos DB | Документация Майкрософт
description: В этом руководстве описывается создание приложений с помощью Xamarin iOS, Android или Forms, а также Azure Cosmos DB. Azure Cosmos DB — это быстро растущая облачная база данных глобального масштаба для мобильных приложений.
services: cosmos-db
author: SnehaGunda
manager: kfile
ms.service: cosmos-db
ms.devlang: dotnet
ms.topic: tutorial
ms.date: 11/15/2017
ms.author: sngun
ms.openlocfilehash: b70a16c2f4c17a8cee008bee342a9c3693d1eb4b
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34614498"
---
# <a name="build-mobile-applications-with-xamarin-and-azure-cosmos-db"></a>Создание мобильных приложений с помощью Xamarin и Azure Cosmos DB

Большинство мобильных приложений хранят данные в облаке, а Azure Cosmos DB — одна из облачных баз данных для мобильных приложений. В ней есть все, что необходимо для разработчика мобильных приложений. Это полностью управляемая база данных как услуга, которая масштабируется по запросу. Она может прозрачно передавать ваши данные пользователям, где бы они ни находились, непосредственно в ваше приложение. С помощью [пакета SDK Azure Cosmos DB для .NET Core](sql-api-sdk-dotnet-core.md) можно настроить в мобильных приложениях Xamarin взаимодействие непосредственно с Azure Cosmos DB без служб среднего уровня.

В этой статье содержится руководство по созданию мобильных приложений с помощью Xamarin и Azure Cosmos DB. Полный исходный код для руководства можно найти в материалах по [Xamarin и Azure Cosmos DB на сайте GitHub](https://github.com/Azure/azure-documentdb-dotnet/tree/master/samples/xamarin). Помимо прочего, этот код включает возможности управления пользователями и разрешениями.

## <a name="azure-cosmos-db-capabilities-for-mobile-apps"></a>Возможности Azure Cosmos DB для мобильных приложений
Azure Cosmos DB предоставляет следующие основные возможности для разработчиков мобильных приложений:

![Возможности Azure Cosmos DB для мобильных приложений](media/mobile-apps-with-xamarin/documentdb-for-mobile.png)

* Широкие возможности запросов к данным без схемы. Azure Cosmos DB хранит данные в виде бессхемных документов JSON в разнородных коллекциях. Она предлагает [запросы с широкими возможностями и обеспечивает их быстрое выполнение](sql-api-sql-query.md), так что вам не нужно беспокоиться о схемах или индексах.
* Высокая пропускная способность. Для чтения и записи документов с помощью Azure Cosmos DB достаточно нескольких миллисекунд. Разработчики могут указать необходимую пропускную способность, и Azure Cosmos DB учтет ее в соглашении, обеспечивающем доступность на уровне 99,99% для всех учетных записей в пределах одного и нескольких регионов с нестрогой согласованностью и доступность для чтения на уровне 99,999 % для всех учетных записей базы данных в пределах нескольких регионов.
* Безграничные возможности масштабирования. Коллекции Azure Cosmos DB [увеличиваются по мере расширения приложения](partition-data.md). Вы можете начать с данных небольшого объема и пропускной способности в сотни запросов в секунду. Коллекции или базы данных могут достигать какой угодно пропускной способности (например, 100 миллионов запросов в секунду) и объема данных в несколько петабайт.
* Глобальное распределение. Пользователи мобильных приложений перемещаются по всему миру. Azure Cosmos DB — это [глобально распределенная база данных](distribute-data-globally.md). Щелкните карту, чтобы данные были доступными для пользователей.
* Встроенные средства для расширенной проверки подлинности. С помощью Azure Cosmos DB можно легко реализовать популярные возможности, например [данные пользователей](https://aka.ms/documentdb-xamarin-todouser) или многопользовательские общие данные, без настраиваемого сложного кода проверки подлинности.
* Геопространственные запросы. Многие мобильные приложения включают геоконтекстные возможности уже сегодня. Благодаря первоклассной поддержке [геопространственных типов](geospatial.md) Azure Cosmos DB позволяет с легкостью реализовать эти возможности.
* Двоичные вложения. Данные приложения часто включают большие двоичные объекты. Встроенная поддержка вложений упрощает использование Azure Cosmos DB как центра служб для данных приложения.

## <a name="azure-cosmos-db-and-xamarin-tutorial"></a>Руководство по Azure Cosmos DB и Xamarin
В этом руководстве описывается создание мобильного приложения с помощью Xamarin и Azure Cosmos DB. Полный исходный код для руководства можно найти в [материалах по Xamarin и Azure Cosmos DB на сайте GitHub](https://github.com/Azure/azure-documentdb-dotnet/tree/master/samples/xamarin).

### <a name="get-started"></a>Начало работы
Начать работу с Azure Cosmos DB очень просто. Перейдите на портал Azure и создайте учетную запись Azure Cosmos DB. Откройте вкладку **Быстрый запуск**. Скачайте пример списка дел Xamarin Forms, который уже подключен к учетной записи Azure Cosmos DB. 

![Быстрый запуск Azure Cosmos DB для мобильных приложений](media/mobile-apps-with-xamarin/cosmos-db-quickstart.png)

Или же, если у вас есть приложение Xamarin, вы можете добавить [пакет NuGet для Azure Cosmos DB](sql-api-sdk-dotnet-core.md). Azure Cosmos DB поддерживает общие библиотеки для Xamarin.iOS, Xamarin.Android и Xamarin Forms.

### <a name="work-with-data"></a>Работа с данными
Записи данных хранятся в Azure Cosmos DB как бессхемные документы JSON в разнородных коллекциях. В одной коллекции можно хранить документы с разной структурой.

```cs
    var result = await client.CreateDocumentAsync(collectionLink, todoItem);
```

В проектах Xamarin можно использовать запросы LINQ к бессхемным данным:

```cs
    var query = await client.CreateDocumentQuery<ToDoItem>(collectionLink)
                    .Where(todoItem => todoItem.Complete == false)
                    .AsDocumentQuery();

    Items = new List<TodoItem>();
    while (query.HasMoreResults) {
        Items.AddRange(await query.ExecuteNextAsync<TodoItem>());
    }
```
### <a name="add-users"></a>Добавление пользователей
Как и многие примеры для начала работы, скачанный пример Azure Cosmos DB проходит проверку подлинности в службе с помощью главного ключа, жестко заданного в коде приложения. Это значение по умолчанию не подходит для приложения, которое должно выполняться за пределами локального эмулятора. Если неавторизованный пользователь получает главный ключ, все данные в учетной записи Azure Cosmos DB могут быть скомпрометированы. Вместо этого приложению требуется предоставить доступ только к записям пользователя, выполнившего вход. Azure Cosmos DB позволяет разработчикам предоставлять приложениям разрешение на чтение или чтение и запись в коллекции, наборе документов, сгруппированных по ключу раздела, или в конкретном документе. 

Чтобы изменить приложение списка дел на многопользовательское приложение списка дел, сделайте следующее: 

  1. Добавьте функцию входа в свое приложение с помощью Facebook, Active Directory или любого другого поставщика.

  2. Создайте коллекцию Azure Cosmos DB UserItems с помощью ключа раздела **/userId**. Если указать ключ раздела для коллекции, Azure Cosmos DB сможет осуществлять неограниченное масштабирование по мере того, как растет количество пользователей приложения, а также продолжать выполнять быстрые запросы.

  3. Добавьте брокер маркера ресурса Azure Cosmos DB. Это простой веб-API, выполняющий проверку подлинности пользователей и выдающий временные маркеры для входа пользователей с правом доступа только к документам в разделе пользователя. В этом примере брокер маркера ресурса размещен в службе приложений.

  4. Измените приложение для проверки подлинности брокера маркера ресурса с помощью Facebook и запросите маркеры ресурса для вошедших в систему пользователей Facebook. Затем можно получить доступ к данным пользователей в коллекции UserItems.  

Полный образец кода из этого примера можно найти в материалах по [брокеру маркера ресурса на сайте GitHub](http://aka.ms/documentdb-xamarin-todouser). Решение показано на схеме ниже.

![Пользователи Azure Cosmos DB и брокер разрешений](media/mobile-apps-with-xamarin/documentdb-resource-token-broker.png)

Если вам нужно, чтобы два пользователя получили доступ к одному и тому же списку дел, вы можете добавить дополнительные разрешения к маркеру доступа в брокере маркера ресурса.

### <a name="scale-on-demand"></a>Масштабирование по необходимости
Azure Cosmos DB — это управляемая база данных как услуга. Вам не нужно беспокоиться о подготовке виртуальных машин или увеличении количества ядер по мере роста базы пользователей. Необходимо лишь указать для Azure Cosmos DB, сколько операций в секунду (пропускная способность) требуется для вашего приложения. Пропускную способность можно указать в единицах запроса в секунду (ЕЗ) на вкладке **Масштаб**. Например, для чтения документа размером 1 КБ требуется 1 ЕЗ. Можно также настроить оповещения для метрики **Пропускная способность**, чтобы отслеживать рост трафика и программно изменять пропускную способность при появлении предупреждений.

![Пропускная способность масштабирования по запросу в Azure Cosmos DB](media/mobile-apps-with-xamarin/cosmos-db-xamarin-scale.png)

### <a name="go-planet-scale"></a>Переход на глобальный масштаб
По мере роста популярности у вашего приложения могут появиться пользователи по всему миру. Или может вам нужно подготовиться к непредвиденным событиям. Перейдите на портал Azure и откройте учетную запись Azure Cosmos DB. Щелкните карту, чтобы настроить непрерывную репликацию своих данных в любое количество регионов по всему миру. Эта возможность предоставит пользователям доступ к данным в любой точке мира. Вы можете также добавить политики отработки отказа, чтобы подготовиться к любым непредвиденным обстоятельствам.

![Масштабирование Azure Cosmos DB в географических регионах](media/mobile-apps-with-xamarin/cosmos-db-xamarin-replicate.png)

Поздравляем! Вы создали решение, и теперь у вас есть мобильное приложение, разработанное с помощью Xamarin и Azure Cosmos DB. Аналогичные действия можно выполнить для создания приложений Cordova, в которых используется пакет SDK JavaScript для Azure Cosmos DB, и собственных приложений iOS или Android с использованием REST API для Azure Cosmos DB.

## <a name="next-steps"></a>Дополнительная информация
* Просмотрите исходный код для [Xamarin и Azure Cosmos DB на сайте GitHub](https://github.com/Azure/azure-documentdb-dotnet/tree/master/samples/xamarin).
* Скачайте [пакет SDK .NET Core для Azure Cosmos DB](sql-api-sdk-dotnet-core.md).
* Ознакомьтесь с другими примерами кода для [приложений .NET](sql-api-dotnet-samples.md).
* Узнайте о [расширенных возможностях запросов в Azure Cosmos DB](sql-api-sql-query.md).
* Узнайте о [геопространственной поддержке в Azure Cosmos DB](geospatial.md).



