---
title: "Оперативные архивация и восстановление с помощью Azure Cosmos DB | Документация Майкрософт"
description: "Узнайте, как автоматически архивировать и восстанавливать базы данных с помощью Azure Cosmos DB."
keywords: "архивация и восстановление, оперативная архивация"
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 06/23/2017
ms.author: raprasa
ms.translationtype: Human Translation
ms.sourcegitcommit: cb4d075d283059d613e3e9d8f0a6f9448310d96b
ms.openlocfilehash: a438b5079ae48c82fb2dbd5ce4547302364e0ef5
ms.contentlocale: ru-ru
ms.lasthandoff: 06/26/2017


---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a>Автоматическая оперативная архивация и восстановление с помощью Azure Cosmos DB
Azure Cosmos DB автоматически выполняет архивацию всех ваших данных с регулярными интервалами. Автоматическая архивация не влияет на производительность или доступность операций баз данных. Для обеспечения устойчивости в случае региональной аварии все архивные копии хранятся отдельно в другой службе хранилища, а также глобально реплицируются. Автоматическая архивация предназначена для решения аварийного восстановления или сценариев, при которых контейнер Cosmos DB случайно удаляется и затем требуется восстановление данных.  

В начале этой статьи приводится краткий обзор понятий избыточности и доступности данных в Cosmos DB, а затем рассматривается архивация. 

## <a name="high-availability-with-cosmos-db---a-recap"></a>Высокая доступность в Cosmos DB — обзор
Служба Cosmos DB создана по принципу [глобального распределения](distribute-data-globally.md). Она позволяет масштабировать пропускную способность между несколькими регионами Azure, выполнять отработку отказа на основе политик, а также предоставляет прозрачные API-интерфейсы с размещением в нескольких регионах. Так как система управления базами данных предлагает [соглашения об уровне обслуживания с показателем доступности 99,99 %](https://azure.microsoft.com/support/legal/sla/cosmos-db), все операции записи в Cosmos DB надежно фиксируются на локальных дисках с соблюдением кворума реплик в локальном центре обработки данных, прежде чем подтверждаются клиенту. Обратите внимание, что высокая доступность Cosmos DB основана на использовании локальных хранилищ и не зависит от технологий внешнего хранения. Кроме того, если ваша учетная запись базы данных связана с более чем одним регионом Azure, то ваши операции записи также реплицируются между другими регионами. Для масштабирования пропускной способности и доступа к данным с небольшой задержкой можно указать любое количество регионов чтения, связанных с учетной записью базы данных. В каждом регионе чтения (реплицированные) данные надежно хранятся в наборе реплик.  

Как показано на следующей схеме, отдельный контейнер Cosmos DB является [горизонтально секционированным](partition-data.md). "Секция" на этой схеме обозначается кружком, а высокая доступность каждой секции обеспечивается набором реплик. Это локальное распределение в одном регионе Azure (обозначается осью X). Затем каждая секция (с соответствующим набором реплик) глобально распределяется по нескольким регионам, связанным с учетной записью базы данных (например, на данном рисунке указаны три региона — восточная часть США, западная часть США и центральная Индия). Набор секций — это глобально распределенная сущность, состоящая из нескольких копий данных в каждом регионе (обозначается осью Y). Вы можете назначить приоритет регионам, связанным с вашей учетной записью базы данных, и в случае аварии Cosmos DB прозрачно выполнит отработку отказа в следующий регион. Также можно вручную смоделировать отработку отказа, чтобы протестировать комплексную доступность приложения.  

На следующем рисунке показана высокая степень избыточности, обеспечиваемая Cosmos DB.

![Высокая степень избыточности, обеспечиваемая Cosmos DB](./media/online-backup-and-restore/redundancy.png)

![Высокая степень избыточности, обеспечиваемая Cosmos DB](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a>Полная, автоматическая и оперативная архивация
Что, если вы удалили свой контейнер или базу данных? При использовании Cosmos DB не только ваши данные, но и архивные копии ваших данных остаются высоко избыточными и устойчивыми к региональным авариям. В настоящее время такая автоматическая архивация выполняется примерно каждые четыре часа, и последние 2 резервные копии всегда сохраняются. Если данные были случайно удалены или повреждены, то [обратитесь в службу поддержки Azure](https://azure.microsoft.com/support/options/) в течение 8 часов. 

Архивация не влияет на производительность или доступность операций баз данных. Cosmos DB выполняет архивацию в фоновом режиме, не используя подготовленные ЕЗ, не снижая производительность и не влияя на доступность базы данных. 

В отличие от данных, сохраненных внутри Cosmos DB, автоматические архивные копии хранятся в службе хранилища BLOB-объектов Azure. Для обеспечения эффективной передачи данных с небольшой задержкой моментальный снимок архивной копии передается в экземпляр хранилища BLOB-объектов Azure в том же регионе, который является текущим регионом записи вашей учетной записи базы данных Cosmos DB. Для обеспечения устойчивости к региональным авариям каждый моментальный снимок данных архивной копии в хранилище BLOB-объектов Azure повторно реплицируется в другой регион с помощью геоизбыточного хранилища (GRS). На следующей схеме показано, как весь контейнер Cosmos DB (в данном примере — все три основные секции в западной части США) архивируется в удаленную учетную запись хранилища BLOB-объектов в западной части США, а затем реплицируется через GRS в восточную часть США. 

На следующем рисунке показана периодически выполняемая полная архивация всех сущностей Cosmos DB в геоизбыточное хранилище Azure.

![Периодически выполняемая полная архивация всех сущностей Cosmos DB в геоизбыточное хранилище Azure](./media/online-backup-and-restore/automatic-backup.png)

## <a name="retention-period-for-a-given-snapshot"></a>Срок хранения моментального снимка
Как описано выше, мы создаем моментальные снимки данных каждые 4 часа и последние два снимка храним в течение 30 дней. Согласно требованиям соответствия нормативам по истечении 90 дней моментальные снимки удаляются.

Если вы хотите использовать собственные моментальные снимки, вы можете использовать параметр экспорта в JSON в [инструменте переноса данных](import-data.md#export-to-json-file) в Azure Cosmos DB, чтобы запланировать дополнительные резервные копии. 

## <a name="restore-database-from-the-online-backup"></a>Восстановление базы данных из оперативного архива
Если вы случайно удалите данные, то можете [отправить запрос](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) или [позвонить в службу поддержки Azure](https://azure.microsoft.com/support/options/), чтобы восстановить данные из последней созданной автоматически резервной копии. Чтобы восстановить определенный моментальный снимок архива службе Cosmos DB требуется, чтобы данные были нам доступны хотя бы в течение цикла архивации для данного снимка.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы реплицировать базу данных в нескольких центрах обработки данных, ознакомьтесь со статьей [Как работает глобальное распределение данных в Azure Cosmos DB?](distribute-data-globally.md) 

Для обращения в службу поддержки Azure [отправьте запрос с портала Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).


