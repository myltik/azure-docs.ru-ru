---
title: Масштабирование и размещение Функций Azure | Документация Майкрософт
description: Дополнительные сведения о выборе между планом потребления для решения "Функции Azure" и планом службы приложений.
services: functions
documentationcenter: na
author: ggailey777
manager: cfowler
editor: ''
tags: ''
keywords: azure functions, functions, consumption plan, app service plan, event processing, webhooks, dynamic compute, serverless architecture
ms.assetid: 5b63649c-ec7f-4564-b168-e0a74cb7e0f3
ms.service: functions
ms.devlang: multiple
ms.topic: reference
ms.tgt_pltfrm: multiple
ms.workload: na
ms.date: 12/12/2017
ms.author: glenga
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 3b4bf8d8ca43110dcfa4aeaed279a8e340e5d529
ms.sourcegitcommit: d28bba5fd49049ec7492e88f2519d7f42184e3a8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2018
---
# <a name="azure-functions-scale-and-hosting"></a>Масштабирование и размещение Функций Azure

Службу "Функции Azure" можно запускать в двух разных режимах: план потребления и план службы приложений Azure. План потребления автоматически выделяет вычислительные ресурсы в процессе выполнения кода, масштабируя их в соответствии с нагрузкой и уменьшая, когда код не выполняется. Нет необходимости платить за бездействующие виртуальные машины и заранее резервировать ресурсы. В этой статье описан план потребления модели [бессерверного](https://azure.microsoft.com/overview/serverless-computing/) приложения. Дополнительную информацию о том, как действует план службы приложений, см. в статье [Подробный обзор планов службы приложений Azure](../app-service/azure-web-sites-web-hosting-plans-in-depth-overview.md). 

>[!NOTE]  
> [Размещение Linux](functions-create-first-azure-function-azure-cli-linux.md) сейчас доступно только в плане служб приложений.

Если вы не знакомы с Функциями Azure, см. [эту статью](functions-overview.md).

При создании приложения-функции необходимо настроить план размещения для функций приложения. В обоих режимах функции выполняет экземпляр *узла службы "Функции Azure"*. Тип плана определяет следующее:

* Способ развертывания экземпляров узла.
* Ресурсы, доступные для каждого узла.

Сейчас тип плана размещения нужно выбирать во время создания приложения-функции. После этого вы не сможете его изменить. 

В рамках плана службы приложений можно переходить между уровнями для выделения разного объема ресурсов. В плане потребления для Функций Azure автоматически обрабатывается все распределение ресурсов.

## <a name="consumption-plan"></a>План потребления

При использовании плана потребления экземпляры узла Azure Functions динамически добавляются и удаляются в зависимости от количества входящих событий. Этот план автоматически масштабируется, и вы платите за вычислительные ресурсы только тогда, когда ваши функции запущены. В плане потребления функция может выполняться не более 10 минут. 

> [!NOTE]
> Время ожидания по умолчанию для функций по плану потребления равно 5 минутам. Для приложения-функции значение можно увеличить до 10 минут, изменив свойство `functionTimeout` в файле проекта [host.json](functions-host-json.md#functiontimeout).

Плата начисляется на основе числа операций выполнения, времени выполнения и объема использованной памяти. Плата начисляется совокупно за использование всех функций приложения-функции. Дополнительные сведения см. на [странице цен на Функции Azure].

План потребления является планом размещения по умолчанию. Он включает следующие преимущества:
- Оплата насчитывается только при выполнении функций.
- Масштабирование выполняется автоматически, даже во время периодов высокой нагрузки.

## <a name="app-service-plan"></a>План службы приложений

Если используется план службы приложений, приложения-функции выполняются на выделенных виртуальных машинах со следующими номерами SKU: "Базовый", "Стандартный", "Премиум" и "Изолированный", как и для веб-приложений, приложений API и мобильных приложений. Виртуальные машины выделяются для приложений службы приложений. Это означает, что узел функций всегда работает. Планы служб приложений поддерживают Linux.

План службы приложений стоит использовать в следующих случаях:
- У вас есть неиспользуемые виртуальные машины, в которых уже запущены другие экземпляры служб приложений.
- Предполагается, что функции-приложения будут выполняться непрерывно или почти непрерывно. В этом случае план службы приложений может быть более экономичным.
- Вам требуется больше ресурсов ЦП или памяти, чем доступно в плане потребления.
- Вам необходимо выполнять функции дольше максимального времени выполнения, разрешенного в плане потребления (10 минут).
- Вам требуются функции, доступные только в плане службы приложений, например поддержка среды службы приложений, подключение к виртуальной сети или VPN и виртуальные машины больших размеров. 
- Вы хотите запустить приложение-функцию в Linux или вы хотите предоставить пользовательский образ, в котором будут выполняться функции.

При работе с виртуальной машиной затраты не зависят от числа операций выполнения, времени выполнения и объема использованной памяти. В результате вы не будете платить больше, чем стоит выделенный экземпляр виртуальной машины. Дополнительную информацию о том, как действует план службы приложений, см. в статье [Подробный обзор планов службы приложений Azure](../app-service/azure-web-sites-web-hosting-plans-in-depth-overview.md). 

С помощью плана службы приложений вы можете выполнить развертывание вручную, добавив дополнительные экземпляры виртуальных машин, или же включить автоматическое масштабирование. Дополнительные сведения см. в статье [Масштабирование числа экземпляров вручную или автоматически](../monitoring-and-diagnostics/insights-how-to-scale.md?toc=%2fazure%2fapp-service-web%2ftoc.json). Вы можете также увеличивать масштаб, используя разные планы службы приложений. Дополнительные сведения см. в статье [Увеличение масштаба приложения в Azure](../app-service/web-sites-scale.md). 

Если вы планируете запускать функции JavaScript в плане службы приложений, выберите выбрать план с меньшим количеством виртуальных процессоров. Дополнительные сведения см. в разделе [Рекомендации для функций JavaScript](functions-reference-node.md#considerations-for-javascript-functions).  

<!-- Note: the portal links to this section via fwlink https://go.microsoft.com/fwlink/?linkid=830855 --> 
<a name="always-on"></a>
###Всегда включено

При использовании плана службы приложений следует включить параметр **Всегда включено**, чтобы ваше приложение-функция выполнялось правильно. В плане службы приложений среда выполнения функции перейдет в состояние бездействия через несколько минут отсутствия активности, поэтому только триггеры HTTP могут на самом деле "пробудить" ваши функции. Точно так же параметр "Всегда включено" должен быть включен для веб-заданий. 

Параметр "Всегда включено" доступен только для плана службы приложений. В плане потребления платформа активирует приложения-функции автоматически.

## <a name="storage-account-requirements"></a>Требования к учетной записи хранения

И для плана потребления, и для плана службы приложений для приложения-функции требуется общая учетная запись хранения Azure, которая поддерживает хранилища BLOB-объектов, очередей, файлов и таблиц Azure. Для внутренних операций, таких как управление триггерами и ведение журнала выполнения функций, Функции Azure используют службу хранилища Azure. Некоторые учетные записи хранения не поддерживают очереди и таблицы. Например, это относится к учетным записям хранения только для больших двоичных объектов (включая хранилище уровня "Премиум") и учетным записям хранения общего назначения с репликацией ZRS. Эти учетные записи будут отфильтрованы из колонки **Учетная запись хранения** при создании приложения-функции.

<!-- JH: Does using a PRemium Storage account improve perf? -->

Дополнительные сведения о типах учетных записей хранилища см. в разделе [Введение в службы хранилища Azure](../storage/common/storage-introduction.md#azure-storage-services).

## <a name="how-the-consumption-plan-works"></a>Как работает план потребления

В рамках плана потребления контроллер масштабирования автоматически масштабирует ресурсы ЦП и памяти, добавляя дополнительные экземпляры узлов функций в зависимости от количества событий, которые активируют функции. Каждый экземпляр узла Функций ограничен 1,5 ГБ памяти.  Экземпляр узла представляет собой приложение-функцию. Это значит, что все функции в приложении-функции совместно используют ресурсы в пределах экземпляра и в то же время масштабируются.

При использовании плана потребления файлы кода функции хранятся в файловых ресурсах Azure в основной учетной записи хранения службы "Функции Azure". При удалении основной учетной записи хранения приложения-функции, файлы кода функции будут удалены без возможности восстановления.

> [!NOTE]
> При использовании триггера большого двоичного объекта в плане потребления обработка новых больших двоичных объектов может осуществляться с задержкой до 10 минут, если приложение-функция стало неактивным. После запуска приложения-функции большие двоичные объекты обрабатываются немедленно. Во избежание подобных задержек при холодном запуске используйте план службы приложений со включенной функцией Always On или же триггер службы "Сетка событий". Дополнительные сведения см. в разделе [Триггер](functions-bindings-storage-blob.md#trigger).

### <a name="runtime-scaling"></a>Масштабирование среды выполнения

Решение "Функции Azure" использует компонент, называемый *контроллером масштабирования*, чтобы отслеживать скорость событий и определять, необходимо ли выполнять масштабирование. Контроллер масштабирования использует эвристику для каждого типа триггеров. Например, при использовании триггера хранилища очередей Azure масштабирование выполняется в зависимости от длины запроса и возраста самого старого сообщения в очереди.

Единицей масштаба является приложение-функция. При масштабировании приложения-функции выделяются дополнительные ресурсы для выполнения нескольких экземпляров узла службы "Функции Azure". И наоборот, когда потребность в вычислительных ресурсах уменьшается, контроллер масштабирования удаляет экземпляры узла функции. Если никакие функции не выполняются, то число экземпляров в приложении-функции в конечном итоге сократится до нуля.

![Мониторинг событий и создание экземпляров с помощью контроллера масштабирования](./media/functions-scale/central-listener.png)

### <a name="understanding-scaling-behaviors"></a>Основные сведения о действиях при масштабировании

Масштабирование может зависеть от ряда факторов и выполняться по-разному в зависимости от выбранного триггера и языка. Однако существуют некоторые аспекты масштабирования, присутствующие в системе сегодня:
* Отдельное приложение-функция масштабируется максимум до 200 экземпляров. Один экземпляр может обрабатывать одновременно более одного сообщения или запроса, поэтому для количества одновременных выполнений не установлено ограничение.
* Новые экземпляры могут выделяться только один раз в 10 секунд.

Для различных триггеров также могут быть установлены разные ограничения масштабирования, а также ограничения, указанные в следующем документе:

* [Концентратор событий](functions-bindings-event-hubs.md#trigger---scaling)

### <a name="best-practices-and-patterns-for-scalable-apps"></a>Рекомендации и шаблоны для масштабируемых приложений

В приложении-функции существует множество аспектов, влияющих на качество его масштабирования, в том числе конфигурация узла, используемый объем среды выполнения и эффективность использования ресурсов.  Дополнительные сведения см. в [разделе о масштабируемости статьи о вопросах производительности](functions-best-practices.md#scalability-best-practices).

### <a name="billing-model"></a>Модель выставления счетов

Выставление счетов для плана потребления подробно описано на [странице цен на Функции Azure]. Использование вычисляется на уровне приложения-функции. При этом учитывается только время выполнения кода функции. Счета выставляются по следующим единицам: 
* **Потребление ресурсов в гигабайтах в секунду (ГБ/с)**. Вычисляется как сочетание объема памяти и времени выполнения для всех функций, выполняемых в приложении-функции. 
* **Выполнения**. Вычисляются при каждом выполнении функции в ответ на событие.

[странице цен на Функции Azure]: https://azure.microsoft.com/pricing/details/functions
