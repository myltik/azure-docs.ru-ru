---
title: "Сохранение файлов в Azure Cloud Shell (предварительная версия) | Документация Майкрософт"
description: "Пошаговое руководство по сохранению файлов в Azure Cloud Shell."
services: 
documentationcenter: 
author: jluk
manager: timlt
tags: azure-resource-manager
ms.assetid: 
ms.service: azure
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 08/21/2017
ms.author: juluk
ms.translationtype: HT
ms.sourcegitcommit: 83f19cfdff37ce4bb03eae4d8d69ba3cbcdc42f3
ms.openlocfilehash: 61a8bfcf3704f361432400771d8fcc8b81927b53
ms.contentlocale: ru-ru
ms.lasthandoff: 08/21/2017

---

# <a name="persist-files-in-azure-cloud-shell"></a>Сохранение файлов в Azure Cloud Shell
Azure Cloud Shell использует преимущества хранилища файлов Azure для сохранения файлов между сеансами.

## <a name="set-up-a-clouddrive-file-share"></a>Настройка файлового ресурса `clouddrive`
При первом запуске Azure Cloud Shell предлагает привязать новый или существующий файловый ресурс, чтобы сохранять файлы между сеансами.

### <a name="create-new-storage"></a>Создание хранилища

Если вы используете базовые параметры и выбрали только подписку, Cloud Shell создаст три ресурса от вашего имени в поддерживаемом регионе, находящемся ближе всего к вам:
* группу ресурсов `cloud-shell-storage-<region>`;
* учетную запись хранения `cs<uniqueGuid>`;
* файловый ресурс `cs-<user>-<domain>-com-<uniqueGuid>`.

![Настройка подписки](media/basic-storage.png)

Файловый ресурс подключается как `clouddrive` в вашем каталоге `$Home`. Он используется для хранения созданного образа размером 5 ГБ, который автоматически обновляет и сохраняет данные в каталоге `$Home`. Подключение выполняется один раз, и для последующих сеансов файловый ресурс подключается автоматически.

### <a name="use-existing-resources"></a>Использование существующих ресурсов

С помощью расширенных параметров можно привязать существующие ресурсы. Когда появится запрос на настройку хранилища, щелкните **Показать дополнительные настройки**, чтобы просмотреть дополнительные параметры. Существующие файловые ресурсы получают образ размером 5 ГБ для сохранения каталога `$Home`. Раскрывающиеся меню фильтруются с учетом региона Cloud Shell и учетных записей локально избыточного и геоизбыточного хранилищ.

![Настройка группы ресурсов](media/advanced-storage.png)

### <a name="restrict-resource-creation-with-an-azure-resource-policy"></a>Ограничение создания ресурсов с помощью политик ресурсов Azure
Учетные записи хранения, создаваемые в Cloud Shell, помечаются тегом `ms-resource-usage:azure-cloud-shell`. Если вы хотите запретить пользователям создавать учетные записи хранения в Cloud Shell, создайте [политику ресурсов Azure на основе тегов](https://docs.microsoft.com/azure/azure-resource-manager/resource-manager-policy-tags) для этого конкретного тега.

## <a name="how-cloud-shell-works"></a>Как работает Cloud Shell
Cloud Shell сохраняет файлы с помощью обоих приведенных ниже методов.
* Создание образа диска для каталога `$Home` для хранения всего содержимого этого каталога. Этот образ диска сохраняется как `acc_<User>.img` в `fileshare.storage.windows.net/fileshare/.cloudconsole/acc_<User>.img`, и для него выполняется автоматическая синхронизация изменений.

* Подключение выбранного файлового ресурса как `clouddrive` в каталоге `$Home`. Это позволяет взаимодействовать с ним напрямую. `/Home/<User>/clouddrive` сопоставляется с `fileshare.storage.windows.net/fileshare`.
 
> [!NOTE]
> Все файлы в каталоге `$Home`, такие как ключи SSH, сохраняются в образе диска пользователя, который хранится в подключенном файловом ресурсе. Соблюдайте рекомендации при сохранении информации в каталоге `$Home` и подключенном файловом ресурсе.

## <a name="use-the-clouddrive-command"></a>Использование команды `clouddrive`
В Cloud Shell можно выполнить команду `clouddrive`, что позволит вручную обновить файловый ресурс, подключенный к Cloud Shell.
![Выполнение команды clouddrive](media/clouddrive-h.png)

## <a name="mount-a-new-clouddrive"></a>Подключение нового `clouddrive`

### <a name="prerequisites-for-manual-mounting"></a>Предварительные требования для подключения вручную
Можно обновить файловый ресурс, который связан с Cloud Shell, с помощью команды `clouddrive mount`.

При подключении имеющегося файлового ресурса учетные записи хранения должны:
* Относиться к локально избыточному или геоизбыточному хранилищу, чтобы обеспечить поддержку файловых ресурсов.
* Находиться в назначенном вам регионе. При подключении назначенный вам регион указывается в имени группы ресурсов `cloud-shell-storage-<region>`.

### <a name="supported-storage-regions"></a>Поддерживаемые регионы хранилища
Файлы Azure должны находиться в том же регионе, что и компьютер Cloud Shell, к которому вы их подключаете. Кластеры Cloud Shell находятся в следующих регионах:
|Область|Регион|
|---|---|
|Северная и Южная Америка|Восточная часть США, юго-центральный регион США, западная часть США|
|Европа|Северная Европа, Западная Европа|
|Азиатско-Тихоокеанский регион|Центральная Индия, Юго-Восточная Азия|

### <a name="the-clouddrive-mount-command"></a>Команда `clouddrive mount`

> [!NOTE]
> При подключении нового файлового ресурса будет создан новый пользовательский образ для каталога `$Home`, так как предыдущий образ `$Home` хранится в предыдущем файловом ресурсе.

Выполните команду `clouddrive mount` со следующими параметрами:

```
clouddrive mount -s mySubscription -g myRG -n storageAccountName -f fileShareName
```

Чтобы просмотреть дополнительные сведения, выполните `clouddrive mount -h`, как показано ниже.

![Выполнение команды clouddrive mount](media/mount-h.png)

## <a name="unmount-clouddrive"></a>Отключение `clouddrive`
Файловый ресурс, подключенный к Cloud Shell, можно отключить в любое время. После отключения файлового ресурса вам будет предложено подключить новый файловый ресурс до следующего сеанса.

Чтобы удалить общую папку из Cloud Shell, сделайте следующее.
1. Запустите `clouddrive unmount`.
2. Подтвердите запросы.

Файловый ресурс будет существовать до его удаления вручную. Cloud Shell больше не будет искать эту общую папку для последующих сеансов.

Чтобы просмотреть дополнительные сведения, выполните `clouddrive unmount -h`, как показано ниже.

![Выполнение команды clouddrive unmount](media/unmount-h.png)

> [!WARNING]
> При выполнении этой команды ресурсы не удаляются. Однако в результате ручного удаления группы ресурсов, учетной записи хранения или общего файлового ресурса, сопоставленных с Cloud Shell, каталог образов `$Home` и другие файлы в общем файловом ресурсе будут безвозвратно удалены. Это действие невозможно отменить.

## <a name="list-clouddrive-file-shares"></a>Вывод списка файловых ресурсов `clouddrive`
Чтобы узнать, какой файловый ресурс подключается как `clouddrive`, выполните приведенную ниже команду `df`. 

В пути к каталогу clouddrive указано имя учетной записи хранения и файловый ресурс в URL-адресе. Например, `//storageaccountname.file.core.windows.net/filesharename`

```
justin@Azure:~$ df
Filesystem                                               1K-blocks     Used Available Use% Mounted on
overlay                                                   30428648 15585636  14826628  52% /
tmpfs                                                       986704        0    986704   0% /dev
tmpfs                                                       986704        0    986704   0% /sys/fs/cgroup
/dev/sda1                                                 30428648 15585636  14826628  52% /etc/hosts
shm                                                          65536        0     65536   0% /dev/shm
//mystoragename.file.core.windows.net/fileshareName        6291456  5242944   1048512  84% /usr/justin/clouddrive
/dev/loop0                                                 5160576   601652   4296780  13% /home/justin
```

## <a name="transfer-local-files-to-cloud-shell"></a>Передача локальных файлов в Cloud Shell
Каталог `clouddrive` синхронизируется c колонкой хранилища на портале Azure. Используйте эту колонку для перемещения локальных файлов в файловый ресурс и из него. Обновленные файлы в Cloud Shell отобразятся в графическом пользовательском интерфейсе хранилища файлов после обновления колонки.

### <a name="download-files"></a>Скачивание файлов

![Вывод списка локальных файлов](media/download.png)
1. На портале Azure перейдите к подключенному файловому ресурсу.
2. Выберите целевой файл.
3. Нажмите кнопку **Скачать**.

### <a name="upload-files"></a>Отправка файлов

![Локальные файлы для передачи](media/upload.png)
1. Перейдите к подключенному файловому ресурсу.
2. Нажмите кнопку **Отправить**.
3. Выберите файл или файлы, которые необходимо передать.
4. Подтвердите передачу.

Теперь эти файлы должны появиться в каталоге `clouddrive` в Cloud Shell.

## <a name="next-steps"></a>Дальнейшие действия
[Краткое руководство по Cloud Shell](quickstart.md) <br>
[Хранилище файлов](https://docs.microsoft.com/azure/storage/storage-introduction#file-storage) <br>
[Использование тегов для организации ресурсов в Azure](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-using-tags) <br>

