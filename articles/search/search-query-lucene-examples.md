---
title: Примеры запросов Lucene для службы поиска Azure | Документация Майкрософт
description: Синтаксис запросов Lucene для поиска нечетких соответствий, поиска с учетом расположения, повышения приоритета слов, поиска по регулярным выражениям и поиска с использованием подстановочных знаков.
author: LiamCa
manager: jlembicz
tags: Lucene query analyzer syntax
services: search
ms.service: search
ms.topic: conceptual
ms.date: 04/20/2018
ms.author: liamca
ms.openlocfilehash: 46e03834cb307ea103a8794616f6f38227881272
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
---
# <a name="lucene-query-syntax-examples-for-building-queries-in-azure-search"></a>Примеры синтаксиса запросов Lucene для создания запросов в службе поиска Azure
При создании запросов для поиска Azure можно использовать [простой синтаксис запросов](https://docs.microsoft.com/rest/api/searchservice/simple-query-syntax-in-azure-search) по умолчанию или альтернативное [средство синтаксического анализа запросов Lucene в службе поиска Azure](https://docs.microsoft.com/rest/api/searchservice/lucene-query-syntax-in-azure-search). Средство синтаксического анализа запросов Lucene поддерживает более сложные конструкции запросов, а именно: запросы, относящиеся к полям, поиск нечетких соответствий, поиск с учетом расположения, повышение приоритета слов и поиск по регулярным выражениям.

В этой статье можно пошагово выполнить примеры полного синтаксиса операций запросов.

## <a name="viewing-the-examples-in-jsfiddle"></a>Просмотр примеров в JSFiddle

Все примеры в этой статье представляют собой запросы, выполняемые с предварительно загруженным индексом поиска в [JSFiddle](https://jsfiddle.net), интерактивном редакторе кода для сценариев теста и HTML. 

Для запуска запросов щелкните правой кнопкой мыши URL-адреса примеров запросов, чтобы открыть JSFiddle в отдельном окне браузера.

> [!NOTE]
> В следующих примерах используется индекс поиска, состоящий из должностей, доступных на основе набора данных, полученных в рамках проекта [по открытым данным г. Нью-Йорк](https://nycopendata.socrata.com/) . Эти данные не являются текущими или завершенными. Индекс включен в службу "песочницы", предоставляемую корпорацией Майкрософт. Для использования этих запросов подписка Azure или служба поиска Azure не требуется.
>


## <a name="how-to-invoke-full-lucene-parsing"></a>Способы вызова полного синтаксического анализа Lucene

Во всех примерах в этой статье задается параметр поиска **queryType=full**, указывающий, что полный синтаксис обрабатывается средством синтаксического анализа запросов Lucene. 

**Пример 1.** Щелкните правой кнопкой мыши приведенный ниже фрагмент запроса, чтобы открыть его в новой странице браузера, где загружается JSFiddle и выполняется запрос.

* [&queryType=full&search=*](http://fiddle.jshell.net/liamca/gkvfLe6s/1/?index=nycjobs&apikey=252044BE3886FE4A8E3BAA4F595114BB&query=api-version=2017-11-11%26searchFields=business_title%26$select=business_title%26queryType=full%26search=*)

В новом окне браузера отобразится исходный код JavaScript и рядом с ним выходные данные HTML. Сценарий ссылается на полный запрос (не только на фрагмент, как показано в ссылке). Полный запрос доступен по URL-адресам примеров в этой статье. 

Этот запрос возвращает документы из нашего индекса вакансий New York City (nycjobs, загруженного в службу "песочницы"). Для краткости в запросе указано, что должны возвращаться только названия должностей. Полный базовый запрос выглядит следующим образом:

    http://fiddle.jshell.net/liamca/gkvfLe6s/1/?index=nycjobs&apikey=252044BE3886FE4A8E3BAA4F595114BB&query=api-version=2017-11-11%26searchFields=business_title%26$select=business_title%26queryType=full%26search=*

Параметр **searchFields** ограничивает поиск полем должности. Параметр **queryType** имеет значение **full**, предписывающее службе поиска Azure использовать средство синтаксического анализа запросов Lucene для этого запроса.

> [!NOTE]
> Общие сведения об обработке запросов см. в статье [Как работает полнотекстовый поиск в службе поиска Azure](search-lucene-query-architecture.md). Дополнительные сведения о параметрах поиска см. в разделе [Поиск документов (REST API поиска Azure)](https://docs.microsoft.com/rest/api/searchservice/Search-Documents).
>

### <a name="fielded-query-operation"></a>Операция запроса, относящегося к полю
Вы можете изменить приведенные в этой статье примеры, задав конструкцию **fieldname:searchterm** , чтобы определить операции запроса, относящегося к полю, где поле представляет собой одно слово, а условие поиска — одно слово или фразу, иногда с логическими операторами. Некоторые примеры:

* business_title:(senior NOT junior)
* state:("New York" AND "New Jersey")

Добавьте несколько строк в кавычках, если необходимо, чтобы обе строки считались одной сущностью, как в приведенном случае поиска двух разных городов в поле расположения. Кроме того, оператор должен быть указан в верхнем регистре, как в случае с NOT и AND.

Поле, указанное в **fieldname:searchterm**, должно поддерживать возможность поиска. Дополнительные сведения об использовании атрибутов индекса в определениях полей см. в статье [Create Index (Azure Search Service REST API)](https://docs.microsoft.com/rest/api/searchservice/create-index) (Создание индексов (REST API службы поиска Azure)).

**Пример 2**. Щелкните правой кнопкой мыши приведенный ниже фрагмент запроса, чтобы выполнить его. Этот запрос осуществляет поиск должностей, содержащих слово "senior", а не "junior":

* [&queryType=full&search= business_title:senior NOT junior](http://fiddle.jshell.net/liamca/gkvfLe6s/1/?index=nycjobs&apikey=252044BE3886FE4A8E3BAA4F595114BB&query=api-version=2017-11-11%26$select=business_title%26queryType=full%26search=business_title:senior+NOT+junior)

## <a name="fuzzy-search-example"></a>Пример поиска нечетких соответствий
Операция поиска нечетких соответствий позволяет найти совпадения в словах с аналогичной конструкцией. В [документации Lucene](https://lucene.apache.org/core/4_10_2/queryparser/org/apache/lucene/queryparser/classic/package-summary.html) поиск нечетких соответствий основан на [расстоянии Дамерау — Левенштейна](https://en.wikipedia.org/wiki/Damerau%e2%80%93Levenshtein_distance).

Чтобы выполнить поиск нечетких соответствий, необходимо добавить символ тильды "~" в конце слова. Дополнительно можно поставить цифру от 0 до 2, указывающую расстояние редактирования. Например, "blue~" или "blue~1" вернет результаты с "blue", "blues" и "glue".

**Пример 3.** Щелкните правой кнопкой мыши приведенный ниже фрагмент запроса. Этот запрос осуществляет поиск должностей со словом "associate" (написанного с ошибкой):

* [&queryType=full&search= business_title:asosiate~](http://fiddle.jshell.net/liamca/gkvfLe6s/1/?index=nycjobs&apikey=252044BE3886FE4A8E3BAA4F595114BB&query=api-version=2017-11-11%26$select=business_title%26queryType=full%26search=business_title:asosiate~)

> [!Note]
> Нечеткие запросы не [анализируются](https://docs.microsoft.com/azure/search/search-lucene-query-architecture#stage-2-lexical-analysis), что может оказаться непредвиденным, если ожидается морфологический поиск или лемматизация. Лексический анализ выполняется только для полными терминами (запрос термина или запрос фразы). Типы запросов с неполными терминами (запрос с префиксом, запрос с подстановочными знаками, запрос с регулярными выражениями, нечеткий запрос) добавляются непосредственно к дереву запроса в обход этапа анализа. Единственное преобразование для неполных терминов запроса — преобразование в нижний регистр.
>

## <a name="proximity-search-example"></a>Пример поиска с учетом расположения
Операция поиска с учетом расположения позволяет найти слова, расположенные рядом в документе. Вставьте символ тильды "~" в конце фразы, а затем — цифру, обозначающую количество слов, определяющее границу близости. Например, если ввести "hotel airport"~5, будут найдены слова "hotel" и "airport", расположенные в пределах 5 слов друг от друга в документе.

**Пример 4**. Щелкните запрос правой кнопкой мыши. Осуществляется поиск должностей, содержащих словосочетание "senior analyst", разделенное не более чем одним словом:

* [&queryType=full&search=business_title:"senior analyst"~1](http://fiddle.jshell.net/liamca/gkvfLe6s/1/?index=nycjobs&apikey=252044BE3886FE4A8E3BAA4F595114BB&query=api-version=2017-11-11%26$select=business_title%26queryType=full%26search=business_title:%22senior%20analyst%22~1)

**Пример 5.** Выполните эту операцию поиска снова, при этом не допуская разделения словосочетания "senior analyst" другими словами.

* [&queryType=full&search=business_title:"senior analyst"~0](http://fiddle.jshell.net/liamca/gkvfLe6s/1/?index=nycjobs&apikey=252044BE3886FE4A8E3BAA4F595114BB&query=api-version=2017-11-11%26$select=business_title%26queryType=full%26search=business_title:%22senior%20analyst%22~0)

## <a name="term-boosting-examples"></a>Пример повышения приоритета термина
При повышении приоритета слов документы сортируются по приоритету, т. е. документы, в которых содержится условие поиска, имеют высший приоритет по отношению к документам, в которых его нет. Этот тип запроса отличается от профилей повышения, так как они повышают приоритет определенных полей, а не определенных слов. В следующем примере показаны эти различия.

Рассмотрим профиль повышения, который повышает приоритет совпадений в определенном поле, таком как **genre** в примере musicstoreindex. Повышение значимости слов может использоваться для дальнейшего повышения приоритета определенных условий поиска относительно других. Например, при вводе запроса "rock^2 electronic" документы, содержащие это условие поиска в поле **genre** , становятся приоритетнее документов, содержащих это условие поиска в других полях, поддерживающих поиск, в индексе. Кроме того, документы, содержащие слово "rock", будут иметь более высокий приоритет, чем документы, содержащие слово "electronic", так как введен коэффициент повышения приоритета (2).

Чтобы повысить приоритет условия поиска, используйте символ крышки "^" и коэффициент повышения приоритета (число) в конце этого условия. Чем выше коэффициент повышения приоритета, тем приоритетнее условие поиска относительно других. Коэффициент повышения приоритета по умолчанию — 1. Несмотря на то, что коэффициент повышения приоритета должен быть положительным числом, он может быть меньше 1 (например, 0,2).

**Пример 6**. Щелкните запрос правой кнопкой мыши. Выполняется поиск должностей, содержащих словосочетание "computer analyst". В результате этого поиска должности, содержащие оба слова "computer" и "analyst", не найдены, а должности со словом "analyst" выведены в верхней части результатов.

* [&queryType=full&search=business_title:computer analyst](http://fiddle.jshell.net/liamca/gkvfLe6s/1/?index=nycjobs&apikey=252044BE3886FE4A8E3BAA4F595114BB&query=api-version=2017-11-11%26$select=business_title%26queryType=full%26search=business_title:computer%5e2%20analyst)

**Пример 7.** Выполните этот поисковой запрос снова, при этом повышая приоритет результатов, содержащих слово computer, относительно результатов, содержащих слово analyst, если оба слова не встречаются одновременно.

* [&queryType=full&search=business_title:computer^2 analyst](http://fiddle.jshell.net/liamca/gkvfLe6s/1/?index=nycjobs&apikey=252044BE3886FE4A8E3BAA4F595114BB&query=api-version=2017-11-11%26$select=business_title%26queryType=full%26search=business_title:computer%5e2%20analyst)

## <a name="regular-expression-example"></a>Пример поиска с использованием регулярного выражения
Операция поиска по регулярным выражениям позволяет найти совпадение в зависимости от содержимого между косыми чертами "/", как указано в документации [класса RegExp](http://lucene.apache.org/core/4_10_2/core/org/apache/lucene/util/automaton/RegExp.html).

**Пример 8**. Щелкните запрос правой кнопкой мыши. Выполняется поиск должностей, содержащих слово "Senior" или "Junior".

* `&queryType=full&$select=business_title&search=business_title:/(Sen|Jun)ior/`

URL-адрес для этого примера неправильно отображается на странице. Для решения этой проблемы скопируйте URL-адрес ниже и вставьте его в строку URL-адреса в браузере: `http://fiddle.jshell.net/liamca/gkvfLe6s/1/?index=nycjobs&apikey=252044BE3886FE4A8E3BAA4F595114BB&query=api-version=2017-11-11%26queryType=full%26$select=business_title%26search=business_title:/(Sen|Jun)ior/)`

## <a name="wildcard-search-example"></a>Пример поиска с использованием подстановочных знаков
Вы можете использовать распознаваемый синтаксис для поиска с использованием одного (?) или нескольких (\*) подстановочных знаков. Обратите внимание, что средство синтаксического анализа запросов Lucene поддерживает использование этих символов для поиска одного слова, а не фразы.

**Пример 9**. Щелкните запрос правой кнопкой мыши. Выполняется поиск должностей, содержащих в начале"prog". В результате будут найдены должности со словами "programming" и "programmer".

* [&queryType=full&$select=business_title&search=business_title:prog*](http://fiddle.jshell.net/liamca/gkvfLe6s/1/?index=nycjobs&apikey=252044BE3886FE4A8E3BAA4F595114BB&query=api-version=2017-11-11%26queryType=full%26$select=business_title%26search=business_title:prog*)

Символ "*" или "?" не может находиться в начале поискового запроса.

## <a name="next-steps"></a>Дополнительная информация
Попробуйте указать средство синтаксического анализа запросов Lucene в коде. Чтобы узнать о том, как настроить запросы поиска для .NET и REST API, воспользуйтесь приведенными ссылками. В этих ссылках используется простой синтаксис по умолчанию, поэтому потребуется применить полученные из этой статьи знания, чтобы задать **queryType**.

* [Отправка запросов в индекс службы поиска Azure с помощью пакета SDK для .NET](search-query-dotnet.md)
* [Отправка запросов в индекс службы поиска Azure с помощью REST API](search-query-rest-api.md)

## <a name="see-also"></a>См. также

 [Как работает полнотекстовый поиск в службе поиска Azure](search-lucene-query-architecture.md)