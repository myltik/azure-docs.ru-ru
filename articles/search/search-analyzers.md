---
title: Анализаторы в службе поиска Azure | Документация Майкрософт
description: Назначьте анализаторы доступным для поиска текстовым полям в индексе, чтобы заменить стандартный, используемый по умолчанию анализатор Lucene стандартными настраиваемыми альтернативными вариантами или вариантами для определенных языков.
services: search
ms.service: search
ms.topic: conceptual
ms.date: 09/11/2017
ms.author: heidist
manager: cgronlun
author: HeidiSteen
ms.openlocfilehash: e858966fb5a15b84af1952399a5eff3ca50d0d59
ms.sourcegitcommit: fa493b66552af11260db48d89e3ddfcdcb5e3152
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2018
ms.locfileid: "31795703"
---
# <a name="analyzers-in-azure-search"></a>Анализаторы в службе поиска Azure

*Анализатор* — это компонент [полнотекстового поиска](search-lucene-query-architecture.md), отвечающий за обработку текста в строках запросов и индексированных документах. Во время анализа стандартными являются следующие преобразования:

+ удаляются слова, которые не представляют смысла (стоп-слова), и пунктуация;
+ фразы и слова, которые пишутся через дефис, разбиваются на составные части;
+ для слов с заглавными буквами используются строчные буквы.
+ слова редуцируются до корня для поиска соответствий независимо от временных форм.

Лингвистические анализаторы преобразовывают входной текст в примитивные или начальные формы, которые эффективны для хранилищ информации и для извлечения файлов. Преобразование происходит во время индексирования, когда создается индекс, а затем снова во время поиска, когда выполняется считывание индекса. Чтобы получить ожидаемые результаты поиска, используйте один и тот же анализатор текста для обоих операций.

По умолчанию служба "Поиск Azure" использует [стандартный анализатор Lucene](https://lucene.apache.org/core/4_0_0/analyzers-common/org/apache/lucene/analysis/standard/StandardAnalyzer.html). Можно переопределить значение по умолчанию для каждого поля. В данной статье описывается набор вариантов и предлагаются рекомендации по настраиваемому анализу. В ней также представлены примеры конфигураций для основных сценариев.

## <a name="supported-analyzers"></a>Поддерживаемые анализаторы

В списке ниже описаны анализаторы, поддерживаемые в службе поиска Azure.

| Категория | ОПИСАНИЕ |
|----------|-------------|
| [Стандартный анализатор Lucene](https://lucene.apache.org/core/4_0_0/analyzers-common/org/apache/lucene/analysis/standard/StandardAnalyzer.html) | По умолчанию. Не требуется спецификация или настройка. Этот универсальный анализатор подходит для большинства языков и сценариев.|
| Стандартные анализаторы | Представлены в виде готового продукта для использования "как есть" с ограниченными возможностями настройки. <br/>Есть два типа: специализированные и зависящие от языка. Они являются стандартными, так как ссылаться на них можно по имени без необходимости какой-либо настройки. <br/><br/>[Специализированные анализаторы (независящие от языка)](https://docs.microsoft.com/rest/api/searchservice/custom-analyzers-in-azure-search#AnalyzerTable) используются для текстовых входных данных, требующих специализированной или минимальной обработки. К стандартным анализаторам, независящим от языка, относятся **Asciifolding**, **Keyword**, **Pattern**, **Simple**, **Stop**, **Whitespace**.<br/><br/>[Анализаторы языка](https://docs.microsoft.com/rest/api/searchservice/language-support) используются, когда требуется расширенная лингвистическая поддержка отдельных языков. Поиск Azure поддерживает 35 анализаторов языка Lucene и 50 анализаторов обработки естественного языка Майкрософт. |
|[Пользовательские анализаторы](https://docs.microsoft.com/rest/api/searchservice/Custom-analyzers-in-Azure-Search) | Определенная пользователем конфигурация сочетания имеющихся элементов, которая состоит из одного лексического анализатора (обязательно) и необязательных фильтров (char или маркеров).|

Вы можете настроить стандартный анализатор, например **Pattern** или **Stop**, чтобы использовать альтернативные варианты, описанные в разделе [Predefined Analyzers Reference](https://docs.microsoft.com/rest/api/searchservice/custom-analyzers-in-azure-search#AnalyzerTable) (Справочник по стандартным анализаторам). Только несколько стандартных анализаторов содержат параметры, которые можно настроить. Как и в случае любой другой настройки, присвойте новой конфигурации имя, например *myPatternAnalyzer*, чтобы отличать ее от анализатора Pattern Lucene.

## <a name="how-to-specify-analyzers"></a>Как указать анализатор

1. (Только для пользовательских анализаторов.) Создайте раздел **analyzer** в определении индекса. Дополнительные сведения см. в статье о [создании индекса](https://docs.microsoft.com/rest/api/searchservice/create-index), а также в разделе о [создании пользовательских анализаторов](https://docs.microsoft.com/rest/api/searchservice/Custom-analyzers-in-Azure-Search#create-a-custom-analyzer).

2. В [определении поля](https://docs.microsoft.com/rest/api/searchservice/create-index) в индексе задайте для свойства **analyzer** имя целевого анализатора (например, `"analyzer" = "keyword"`). Допустимые значения: стандартный анализатор, анализатор языка или пользовательский анализатор, также определенный в схеме индекса.

3. Кроме того, вместо одного свойства **analyzer** вы можете задать различные анализаторы для индексирования и создания запросов, используя параметры полей **indexAnalyzer** и **searchAnalyzer**. 

3. Добавление анализатора в определение поля влечет за собой операцию записи в индекс. При добавлении свойства **analyzer** в имеющийся индекс учтите следующее.
 
 | Сценарий | Влияние | Действия |
 |----------|--------|-------|
 | Добавление нового поля | минимальный | Если поле еще не существует в схеме, то редакция поля не требуется, так как поле еще физически не присутствует в вашем индексе. Для этой задачи используется команда [Обновить указатель](https://docs.microsoft.com/rest/api/searchservice/update-index) и [mergeOrUpload](https://docs.microsoft.com/rest/api/searchservice/addupdate-or-delete-documents).|
 | Добавьте анализатор в имеющееся индексированное поле. | перестроение | Инвертированный индекс для этого поля нужно воссоздать с нуля, а содержимое для этих полей нужно повторно проиндексировать. <br/> <br/>Для разрабатываемых индексов [удалите](https://docs.microsoft.com/rest/api/searchservice/delete-index) и [создайте](https://docs.microsoft.com/rest/api/searchservice/create-index) индекс, чтобы выбрать новое определение поля. <br/> <br/>Для индексов в производственной среде необходимо создать поле, чтобы указать измененное определение и начать использовать его. Для внедрения нового поля используется команда [Обновить указатель](https://docs.microsoft.com/rest/api/searchservice/update-index) и [mergeOrUpload](https://docs.microsoft.com/rest/api/searchservice/addupdate-or-delete-documents). Позже в рамках планового обслуживания индекса можно очистить его, чтобы удалить устаревшие поля. |

## <a name="tips-and-best-practices"></a>Советы и рекомендации

В этом разделе даны рекомендации по работе с анализаторами.

### <a name="one-analyzer-for-read-write-unless-you-have-specific-requirements"></a>Использование одного анализатора для чтения и записи при отсутствии особых требований

Служба поиска Azure позволяет указать различные анализаторы для индексирования и поиска с помощью дополнительных параметров полей — `indexAnalyzer` и `searchAnalyzer`. Если их не указать, анализатор с заданным свойством `analyzer` будет использоваться для двух операций — индексирования и поиска. Если не указать `analyzer`, будет использоваться стандартный анализатор Lucene.

Мы рекомендуем использовать один анализатор для индексации и запросов при отсутствии специальных требований. Обязательно тщательно протестируйте его. Когда обработка текста отличается по времени поиска и индексирования, появляется риск несовпадения терминов запроса и индексирования, если конфигурации анализаторов поиска и индексации не согласованы.

### <a name="test-during-active-development"></a>Тестирование во время активной разработки

Переопределение стандартного анализатора требует перестроения индекса. Если это возможно, перед обработкой индекса в рабочей среде решите, для какого анализатора его использовать во время активной разработки.

### <a name="inspect-tokenized-terms"></a>Изучение терминов, снабженных маркером

Если поиск не возвращает ожидаемые результаты, скорее всего маркер не соответствует условиям поиска терминов в запросе и терминам, снабженным маркером в индексе. Если маркеры не одинаковые, совпадения не материализуются. Чтобы изучить выходные данные создателя маркеров, мы рекомендуем использовать [API анализа](https://docs.microsoft.com/rest/api/searchservice/test-analyzer) в качестве инструмента исследования. Ответ содержит маркеры, которые создаются определенным анализатором.

### <a name="compare-english-analyzers"></a>Сравнение анализаторов английского языка

[Search Analyzer Demo](http://alice.unearth.ai/) — это стороннее демонстрационное приложение, которое показывает параллельное сравнение стандартного анализатора Lucene, анализатора английского языка Lucene и обработчика естественного языка Майкрософт (английского языка). Ошибка индекса устранена. Он содержит текст из популярных историй. Для всех данных поиска, которые вы вводите, результаты каждого анализатора отображаются в соседних областях. Они предоставляют информацию о том, как анализатор обрабатывает одну и ту же строку. 

## <a name="examples"></a>Примеры

В примерах ниже приведены определения анализатора для нескольких ключевых сценариев.

<a name="Example1"></a>
### <a name="example-1-custom-options"></a>Пример 1. Настраиваемые параметры

В этом примере демонстрируется определение анализатора с настраиваемыми параметрами. Настраиваемые параметры для фильтров типа char, лексических анализаторов и фильтров маркеров указываются отдельно как именованные конструкции, а затем в определении анализатора на них приводятся ссылки. Стандартные элементы используются "как есть" и сослаться на них можно с помощью имени.

Вот описание этого примера:

* Анализаторы являются свойством класса поля для поля, поддерживающего поиск.
* Пользовательский анализатор входит в определение индекса. Он может быть незначительно настроенным (например, настройка одного параметра в одном фильтре) или настроенным в нескольких местах.
* В таком случае пользовательский анализатор "my_analyzer" в свою очередь использует настроенный стандартный лексический анализатор "my_standard_tokenizer" и два фильтра маркеров: с нижним регистром и настроенный фильтр типа asciifolding — "my_asciifolding".
* Он также определяет настраиваемый фильтр char "map_dash", чтобы заменить все дефисы знаками подчеркивания перед разметкой (стандартный лексический анализатор останавливается на дефисе, а не знаках подчеркивания).

~~~~
  {
     "name":"myindex",
     "fields":[
        {
           "name":"id",
           "type":"Edm.String",
           "key":true,
           "searchable":false
        },
        {
           "name":"text",
           "type":"Edm.String",
           "searchable":true,
           "analyzer":"my_analyzer"
        }
     ],
     "analyzers":[
        {
           "name":"my_analyzer",
           "@odata.type":"#Microsoft.Azure.Search.CustomAnalyzer",
           "charFilters":[
              "map_dash"
           ],
           "tokenizer":"my_standard_tokenizer",
           "tokenFilters":[
              "my_asciifolding",
              "lowercase"
           ]
        }
     ],
     "charFilters":[
        {
           "name":"map_dash",
           "@odata.type":"#Microsoft.Azure.Search.MappingCharFilter",
           "mappings":["-=>_"]
        }
     ],
     "tokenizers":[
        {
           "name":"my_standard_tokenizer",
           "@odata.type":"#Microsoft.Azure.Search.StandardTokenizer",
           "maxTokenLength":20
        }
     ],
     "tokenFilters":[
        {
           "name":"my_asciifolding",
           "@odata.type":"#Microsoft.Azure.Search.AsciiFoldingTokenFilter",
           "preserveOriginal":true
        }
     ]
  }
~~~~

<a name="Example2"></a>
### <a name="example-2-override-the-default-analyzer"></a>Пример 2. Переопределение анализатора по умолчанию

Стандартный анализатор является анализатором по умолчанию. Предположим, что необходимо заменить анализатор по умолчанию другим стандартным анализатором, например анализатором шаблона. Если не нужно задавать настраиваемые параметры, вам достаточно указать его имя в определении поля.

Элемент "analyzer" переопределяет стандартный анализатор для каждого поля. Масштабное переопределение отсутствует. В этом примере `text1` использует анализатор шаблона, а значение `text2`, которое не указывает анализатор, использует значение по умолчанию.

~~~~
  {
     "name":"myindex",
     "fields":[
        {
           "name":"id",
           "type":"Edm.String",
           "key":true,
           "searchable":false
        },
        {
           "name":"text1",
           "type":"Edm.String",
           "searchable":true,
           "analyzer":"pattern"
        },
        {
           "name":"text2",
           "type":"Edm.String",
           "searchable":true
        }
     ]
  }
~~~~

<a name="Example3"></a>
### <a name="example-3-different-analyzers-for-indexing-and-search-operations"></a>Пример 3. Другие анализаторы для индексирования и поиска

API включает в себя дополнительные атрибуты индекса для указания других анализаторов для индексирования и поиска. Атрибуты `searchAnalyzer` и `indexAnalyzer` нужно указывать в сочетании, заменив отдельный атрибут `analyzer`.


~~~~
  {
     "name":"myindex",
     "fields":[
        {
           "name":"id",
           "type":"Edm.String",
           "key":true,
           "searchable":false
        },
        {
           "name":"text",
           "type":"Edm.String",
           "searchable":true,
           "indexAnalyzer":"whitespace",
           "searchAnalyzer":"simple"
        },
     ],
  }
~~~~

<a name="Example4"></a>
### <a name="example-4-language-analyzer"></a>Пример 4. Анализатор языка

Поля, содержащие строки на разных языках, могут использовать анализатор языка, тогда как другие поля используют анализатор по умолчанию (или используют некоторые другие стандартные или настраиваемые анализаторы). При использовании анализатора языка он должен применяться и для индексирования, и для поиска. Поля, для которых используется анализатор языка, не могут иметь разные анализаторы для индексирования и поиска.

~~~~
  {
     "name":"myindex",
     "fields":[
        {
           "name":"id",
           "type":"Edm.String",
           "key":true,
           "searchable":false
        },
        {
           "name":"text",
           "type":"Edm.String",
           "searchable":true,
           "indexAnalyzer":"whitespace",
           "searchAnalyzer":"simple"
        },
        {
           "name":"text_fr",
           "type":"Edm.String",
           "searchable":true,
           "analyzer":"fr.lucene"
        }
     ],
  }
~~~~

## <a name="next-steps"></a>Дополнительная информация

+ Ознакомьтесь с комплексным обзором [работы полнотекстового поиска в поиске Azure](search-lucene-query-architecture.md). В этой статье используются примеры для пояснения режимов, являющихся, на первый взгляд, нелогичными.

+ Попробуйте использовать другой синтаксис запросов на основе примеров в статьях о [поиске документов](https://docs.microsoft.com/rest/api/searchservice/search-documents#examples) или [простом синтаксисе запросов](https://docs.microsoft.com/rest/api/searchservice/simple-query-syntax-in-azure-search) в проводнике поиска на портале.

+ Узнайте, как применить [лексические анализаторы для конкретного языка](https://docs.microsoft.com/rest/api/searchservice/language-support).

+ [Настройте пользовательские анализаторы](https://docs.microsoft.com/rest/api/searchservice/custom-analyzers-in-azure-search) для минимальной или специализированной обработки определенных полей.

+ [Сравните стандартный анализатор и анализатор английского языка](http://alice.unearth.ai/) в смежных областях на этом демонстрационном веб-сайте. 

## <a name="see-also"></a>См. также

 [Search Documents (Azure Search Service REST API)](https://docs.microsoft.com/rest/api/searchservice/search-documents) (Поиск по документам (REST API службы поиска Azure)) 

 [Простой синтаксис запросов](https://docs.microsoft.com/rest/api/searchservice/simple-query-syntax-in-azure-search) 

 [Lucene query syntax in Azure Search](https://docs.microsoft.com/rest/api/searchservice/lucene-query-syntax-in-azure-search) (Синтаксис запросов Lucene в службе поиска Azure) 
 
 [Обработка результатов поиска](https://docs.microsoft.com/azure/search/search-pagination-page-layout)

<!--Image references-->
[1]: ./media/search-lucene-query-architecture/architecture-diagram2.png
