---
title: Руководство по службе поиска Azure. Индексирование, отправка запросов и фильтрация с помощью портала | Документация Microsoft
description: Чтобы создать индекс для службы поиска Azure, воспользуйтесь готовым примером данных на портале Azure. Научитесь использовать полнотекстовой поиск, поиск нечетких соответствий, геопространственный поиск, а также работать с фильтрами, аспектами и многими другими возможностями.
author: HeidiSteen
manager: cgronlun
tags: azure-portal
services: search
ms.service: search
ms.topic: tutorial
ms.date: 04/20/2018
ms.author: heidist
ms.openlocfilehash: 9ee88b254131b40fdf1e01b771afa92127734e18
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
ms.locfileid: "32190039"
---
# <a name="create-query-and-filter-an-azure-search-index-in-the-portal"></a>Создание и фильтрация индекса службы "Поиск Azure", а также отправка запросов к нему

Возьмите готовый пример набора данных с портала Azure, чтобы быстро создать индекс для службы поиска Azure с помощью мастера **импорта данных**. Научитесь использовать полнотекстовой поиск, поиск нечетких соответствий, геопространственный поиск, а также работать с фильтрами и аспектами в **обозревателе поиска**.  

В этой статье в общих чертах (без примеров кода) описывается использование готовых данных, которые позволяют сразу приступить к написанию интересных запросов. Хотя инструменты портала не заменяют код, они могут быть полезны для выполнения следующих задач:

+ практическое обучение для ознакомления с основными возможностями;
+ создание прототипа индекса до написания кода в мастере **импорта данных**;
+ тестирование запросов и анализ синтаксиса в **обозревателе поиска**;
+ просмотр опубликованного в службе индекса и поиск его атрибутов.

**Оценка времени:** примерно 15 минут, если учетная запись и служба уже зарегистрированы. 

Кроме того, ознакомьтесь с [вводными сведениями о программировании службы поиска Azure в приложении .NET с помощью кода](search-howto-dotnet-sdk.md).

## <a name="prerequisites"></a>предварительным требованиям

В этом руководстве предполагается наличие [подписки Azure](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A261C142F) и [службы поиска Azure](search-create-service-portal.md). 

Если вы не хотите подготавливать службу сейчас, можно просмотреть 6-минутное [обзорное видео о службе поиска Azure](https://channel9.msdn.com/Events/Connect/2016/138), демонстрирующее шаги в этом руководстве, начиная с 3 минуты.

## <a name="find-your-service"></a>Поиск службы
1. Войдите на [портале Azure](https://portal.azure.com).
2. Откройте служебную панель службы поиска Azure. Если вы не закрепили плитку службы на панели мониторинга, ее можно найти следующим образом: 
   
   * В области навигации слева щелкните **Все службы**.
   * В поле поиска введите *поиск*, чтобы получить список служб поиска в своей подписке. Служба появится в списке. 

## <a name="check-for-space"></a>Проверка доступного пространства
Многие пользователи предпочитают начать работу с бесплатной службой. В бесплатной версии можно использовать только три индекса, три источника данных и три индексатора. Перед началом работы убедитесь, что у вас достаточно места для дополнительных элементов. В этом руководстве каждый объект создается один раз. 

> [!TIP] 
> Плитки на панели мониторинга службы содержат сведения о количестве имеющихся индексов, индексаторов и источников данных. На плитке индексатора отображаются индикаторы успешных и неудачных операций. Щелкните плитку, чтобы просмотреть количество индексаторов. 
>
> ![Плитки для индексаторов и источников данных][1]
>

## <a name="create-index"></a> Создание индекса и загрузка данных
Поисковые запросы выполняют итерацию по *индексу* , содержащему доступные для поиска данные, метаданные и конструкции, которые используются для оптимизации способов поиска.

Чтобы выполнить эту задачу с помощью портала, мы будем использовать встроенный пример набора данных. Индексатор сможет просканировать его с помощью мастера **импорта данных**. 

#### <a name="step-1-start-the-import-data-wizard"></a>Шаг 1. Запуск мастера импорта данных
1. На панели мониторинга службы поиска Azure щелкните в командной строке **Импорт данных**. Запустится мастер, который создает и заполняет индекс.
   
    ![Команда импорта данных][2]

2. В окне мастера щелкните **Источник данных** > **Примеры** > **realestate-us-sample**. Для этого источника данных задано имя, тип и сведения о подключении. После создания он становится существующим источником данных, который можно повторно использовать в других операциях импорта.

    ![Пример набора данных][9]

3. Нажмите кнопку **ОК**, чтобы использовать его.

#### <a name="step-2-define-the-index"></a>Этап 2. Определение индекса
Как правило, индекс нужно создавать вручную с использованием кода, но мастер может создавать индекс для любого источника данных, который он может просканировать. Для индекса необходимо указать как минимум имя и коллекцию полей, а одно поле отметить как ключ документа, однозначно определяющий его.

Поля имеют типы данных и атрибуты. Флажки в верхней части — это *атрибуты индекса*, которые определяют, как используется поле. 

* **Доступный для получения** означает, что поле будет показано в списке результатов поиска. Вы можете снять этот флажок напротив отдельных полей, чтобы исключить их из результатов поиска (например, если такие поля используются только в выражениях фильтра). 
* Атрибуты **Фильтруемый**, **Сортируемый** и **Аспектируемый** определяют, может ли поле использоваться в структуре фильтруемой, сортируемой или фасетной навигации. 
* **Доступный для поиска** включает поле в полнотекстовый поиск. Строки доступны для поиска. Поиск по числовым и логическим полям часто исключается. 

По умолчанию мастер сканирует источник данных на наличие уникального идентификатора, который будет использоваться в качестве основы для ключевого поля. Строки помечаются как доступные для получения и для поиска, а целые числа — как доступные для получения, сортируемые, фильтруемые и аспектируемые.

  ![Созданный индекс для примера, относящегося к недвижимости][3]

Нажмите кнопку **ОК**, чтобы создать индекс.

#### <a name="step-3-define-the-indexer"></a>Этап 3. Определение индексатора
В мастере **импорта данных** щелкните **Индексатор** > **Имя** и введите имя индексатора. 

Этот объект определяет исполняемый процесс. Вы можете задать для него повторяющееся расписание. А пока используйте параметр по умолчанию, чтобы однократно и немедленно запустить индексатор после нажатия кнопки **ОК**.  

  ![индексатор для примера, относящегося к недвижимости][8]

## <a name="check-progress"></a>Проверка хода выполнения
Чтобы отслеживать импорт данных, на панели мониторинга службы прокрутите вниз и дважды щелкните плитку **Индексаторы**. Откроется список индексаторов. В списке вы увидите только что созданный индексатор с состоянием, указывающим на выполнение или завершение, а также количество проиндексированных документов.

   ![Сообщение о ходе обработки индексатором][4]

## <a name="query-index"></a> Запрос индекса
Теперь индекс службы поиска может создавать запросы. **Проводник поиска** — это средство работы с запросами, встроенное в портал. Это поле для поиска, с помощью которого можно проверить, возвращаются ли ожидаемые результаты поиска. 

> [!TIP]
> В [обзорном видео о службе поиска Azure](https://channel9.msdn.com/Events/Connect/2016/138) следующие действия демонстрируются начиная с 6:08.
>

1. Щелкните **Проводник поиска** на панели команд.

   ![Команда обозревателя поиска][5]

2. Щелкните **Изменить индекс** на панели команд, чтобы переключиться на пример *realestate-us-sample*.

   ![Команды индекса и API][6]

3. Щелкните **Задать версию API** на панели команд, чтобы просмотреть доступные интерфейсы REST API. Предварительные версии API обеспечивают доступ к новым функциям, которые еще не являются общедоступными. Для приведенных ниже запросов используйте общедоступную версию (2017-11-11), если не указано иное. 

    > [!NOTE]
    > [REST API службы поиска Azure](https://docs.microsoft.com/rest/api/searchservice/search-documents) и [библиотека .NET](search-howto-dotnet-sdk.md#core-scenarios) полностью эквивалентны, но **обозреватель поиска** может обрабатывать только вызовы REST. Он поддерживает и [простой синтаксис запросов](https://docs.microsoft.com/rest/api/searchservice/simple-query-syntax-in-azure-search), и [средство полного синтаксического анализа запросов Lucene](https://docs.microsoft.com/rest/api/searchservice/lucene-query-syntax-in-azure-search), а также все параметры поиска, доступные в операциях [поиска документов](https://docs.microsoft.com/rest/api/searchservice/search-documents).
    > 

4. В строке поиска введите приведенные ниже строки запроса и нажмите кнопку **Поиск**.

  ![Пример поискового запроса][7]

**`search=seattle`**

+ С помощью параметра **search** вводится ключевое слово для полнотекстового поиска. В нашем случае будут возвращены результаты для округа Кинг, штат Вашингтон, содержащие слово *Seattle* в любом доступном для поиска поле в документе. 

+ **Обозреватель поиска** возвращает результаты в подробном JSON-файле, который трудно читать, если документы имеют высокую плотность структуры. В зависимости от документов может понадобиться написать код, который обрабатывает результаты поиска для извлечения важных элементов. 

+ Документы содержат все поля, помеченные как доступные для получения в индексе. Чтобы просмотреть атрибуты индекса на портале, на плитке **Индексы** щелкните *realestate-us-sample*.

**`search=seattle&$count=true&$top=100`**

+ Символ **&** используется для добавления параметров поиска, которые можно указать в любом порядке. 

+  Параметр **$count=true** возвращает число всех возвращенных документов. Запросы фильтра можно проверять, наблюдая за изменениями результатов, возвращаемых параметром **$count=true**. 

+ Параметр **$top=100** возвращает 100 документов с самым высоким рангом. По умолчанию служба поиска Azure возвращает первые 50 лучших соответствий. Увеличить или уменьшить это число можно с помощью параметра **$top**.


## <a name="filter-query"></a> Фильтрация запроса

Фильтры включаются в запросы поиска при добавлении параметра **$filter**. 

**`search=seattle&$filter=beds gt 3`**

+ Параметр **$filter** возвращает результаты, соответствующие указанным условиям. В этом случае жилье, где более 3 спален. 

+ Синтаксис фильтра — это конструкция OData. Дополнительные сведения см. в статье [OData Expression Syntax for Azure Search](https://docs.microsoft.com/rest/api/searchservice/odata-expression-syntax-for-azure-search) (Синтаксис выражений OData для службы поиска Azure).

## <a name="facet-query"></a> Аспектирование запроса

Фильтры аспектов включаются в запросы поиска. Параметр аспекта можно использовать для возврата суммарного количества документов, которые соответствуют указанному значению аспекта. 

**`search=*&facet=city&$top=2`**

+ **search=*** является пустым полем поиска. Пустые поля поиска выполняют поиск по всему. Одна из причин отправки пустого запроса — отфильтровать или аспектировать полный набор документов. Например, вы хотите, чтобы структура аспектированной навигации состояла из всех городов в индексе.

+  Параметр **facet** возвращает структуру навигации, которую можно передать в элемент управления пользовательского интерфейса. Он возвращает категории и количество. В нашем случае категории основаны на количестве городов. Служба поиска Azure не поддерживает агрегирование, но приблизительный результат можно получить с помощью параметра `facet`, который возвращает количество документов в каждой категории.

+ Параметр **$top=2** возвращает два документа и демонстрирует, что `top` можно использовать для уменьшения или увеличения количества результатов.

**`search=seattle&facet=beds`**

+ Этот запрос задает аспект beds (кровати) для поиска по тексту документов, содержащих *Seattle*. Условие *beds* можно указать в качестве аспекта, так как это поле помечено как доступное для извлечения, фильтрации и аспектирования в индексе, а содержащиеся в нем значения (числовые, от 1 до 5) подходят для упорядочивания списков по группам (списки с 3 или 4 спальнями). 

+ Аспектировать можно только фильтруемые поля. В результатах могут быть возвращены только поля, доступные для получения.

## <a name="highlight-query"></a> Добавление выделения

Выделение совпадений — это форматирование совпадений, найденных в конкретном поле, по ключевому слову. Если условие поиска глубоко скрыто в описании, выделение совпадений позволяет легче его найти. 

**`search=granite countertops&highlight=description`**

+ В этом примере отформатированную фразу *granite countertops* легче найти в поле описания.

**`search=mice&highlight=description`**

+ Полнотекстовой поиск находит словоформы со схожей семантикой. В этом случае если задать ключевое слово поиска "мыши", то в результатах поиска отобразится текст, где будет выделено слово "мышь", для домов, где завелись эти грызуны. Различные формы одно и того же слова могут отображаться в результатах за счет лингвистического анализа. 

+ Поиск Azure поддерживает 56 анализаторов от Lucene и корпорации Майкрософт. По умолчанию служба поиска Azure использует стандартный анализатор Lucene. 

## <a name="fuzzy-search"></a> Использование поиска нечетких соответствий

При стандартном поиске слова с ошибками, например *самамиш* для города Саммамиш в Сиэтле, не будут распознаны как совпадения. Для обработки ошибок можно использовать поиск нечетких соответствий, описанный в следующем примере.

**`search=samamish`**

+ В этом примере неверно указано название пригорода Сиэтла.

**`search=samamish~&queryType=full`**

+ Чтобы включить поиск нечетких соответствий, укажите символ **~** и используйте средство полного синтаксического анализа запросов, которое интерпретирует и правильно анализирует синтаксис с символом **~**. 

+ Поиск нечетких соответствий доступен, если вы настроили использование средства полного синтаксического анализа запросов с помощью параметра **queryType=full**. Дополнительные сведения о сценариях запроса при использовании средства полного синтаксического анализа запросов см. в статье [Lucene query syntax in Azure Search](https://docs.microsoft.com/rest/api/searchservice/lucene-query-syntax-in-azure-search) (Синтаксис запросов Lucene в службе поиска Azure).

+ Если параметр **queryType** не задан, используется простое средство синтаксического анализа запросов по умолчанию. Это средство работает быстрее, но если вам требуется поиск нечетких соответствий, регулярные выражения, поиск с учетом расположения или расширение типов запросов, вам понадобится средство полного синтаксического анализа. 

## <a name="geo-search"></a> Пробное использование геопространственного поиска

Для поддержки геопространственного поиска нужно задать [тип данных edm.GeographyPoint](https://docs.microsoft.com/rest/api/searchservice/supported-data-types) для поля, содержащего координаты. Геопространственный поиск — это тип фильтра, описанный в статье [OData Expression Syntax for Azure Search](https://docs.microsoft.com/rest/api/searchservice/odata-expression-syntax-for-azure-search) (Синтаксис выражений OData для службы поиска Azure). 

**`search=*&$count=true&$filter=geo.distance(location,geography'POINT(-122.121513 47.673988)') le 5`**

+ Пример запроса фильтрует все результаты по данным о положении и выводит те, которые находятся на расстоянии менее 5 километров от заданной точки (по координатам широты и долготы). Если добавить параметр **$count**, можно увидеть, сколько результатов возвращается при изменении расстояния или координат. 

+ Геопространственный поиск полезен в том случае, когда в приложении поиска есть функция поиска соседних объектов или используется навигация по карте. Однако это не полнотекстовой поиск. Если нужно выполнить поиск для определенного города или страны, помимо координат, добавьте поля, содержащие названия города или страны.

## <a name="next-steps"></a>Дополнительная информация

+ Вы можете изменять все только что созданные объекты. После первого запуска мастера вы можете вернуться назад и просмотреть или изменить отдельные компоненты: индекс, индексатор или источник данных. Некоторые изменения, например изменение типа данных поля, недоступны в индексе, но большинство свойств и настроек можно изменять.

  Чтобы просмотреть отдельные компоненты, на панели мониторинга щелкните плитку **Индекс**, **Индексатор** или **Источники данных**. Отобразится список имеющихся объектов. Дополнительные сведения об операциях изменения индекса, не требующих его перестройки, см. в статье [Update Index (Azure Search Service REST API)](https://docs.microsoft.com/rest/api/searchservice/update-index) (Обновление индекса (REST API службы поиска Azure)).

+ Попробуйте использовать средства и выполнить действия для других источников данных. Пример набора данных `realestate-us-sample` находится в базе данных SQL Azure, которую может просканировать служба поиска Azure. Помимо базы данных SQL Azure служба поиска Azure может сканировать и получать индекс из плоских структур данных в хранилище таблиц Azure, хранилище BLOB-объектов, SQL Server на виртуальной машине Azure и Azure Cosmos DB. Все эти источники данных поддерживаются в мастере. В коде можно с легкостью заполнить индекс с помощью *индексатора*.

+ Все другие неиндексированные источники данных поддерживаются через модель передачи, где код передает новые и измененные наборы строк в JSON-файле в индекс. Дополнительные сведения см. в статье [Add, Update or Delete Documents (Azure Search Service REST API)](https://docs.microsoft.com/rest/api/searchservice/addupdate-or-delete-documents) (Добавление, обновление и удаление документов (REST API службы поиска Azure)).

Дополнительные сведения о других возможностях, упоминаемых в этом руководстве, см. в следующих статьях.

* [Индексаторы в службе поиска Azure](search-indexer-overview.md)
* [Create Index (Azure Search Service REST API) (Создание индекса (REST API службы поиска Azure)). Содержит подробное описание атрибутов индекса.](https://docs.microsoft.com/rest/api/searchservice/create-index)
* [Обозреватель поиска](search-explorer.md)
* [Search Documents (Azure Search Service REST API) (Поиск по документам (REST API службы поиска Azure)). Содержит примеры синтаксиса запросов.](https://docs.microsoft.com/rest/api/searchservice/search-documents)


<!--Image references-->
[1]: ./media/search-get-started-portal/tiles-indexers-datasources2.png
[2]: ./media/search-get-started-portal/import-data-cmd2.png
[3]: ./media/search-get-started-portal/realestateindex2.png
[4]: ./media/search-get-started-portal/indexers-inprogress2.png
[5]: ./media/search-get-started-portal/search-explorer-cmd2.png
[6]: ./media/search-get-started-portal/search-explorer-changeindex-se2.png
[7]: ./media/search-get-started-portal/search-explorer-query2.png
[8]: ./media/search-get-started-portal/realestate-indexer2.png
[9]: ./media/search-get-started-portal/import-datasource-sample2.png