---
title: Служба рендеринга пакетной службы Azure. Облачный рендеринг | Документация Майкрософт
description: Выполнение заданий рендеринга на виртуальных машинах Azure непосредственно из Maya с оплатой по мере использования.
services: batch
author: dlepow
manager: jeconnoc
ms.service: batch
ms.topic: hero-article
ms.date: 05/10/2018
ms.author: danlep
ms.openlocfilehash: df1b2da7628e6c3f9f4bcbb02a936c33aad49698
ms.sourcegitcommit: fc64acba9d9b9784e3662327414e5fe7bd3e972e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/12/2018
---
# <a name="get-started-with-the-batch-rendering-service"></a>Приступая к работе со службой рендеринга пакетной службы

Служба рендеринга пакетной службы Azure предлагает возможности рендеринга в масштабах облака с оплатой по мере использования. Служба рендеринга пакетной службы обрабатывает планирование заданий и их постановку в очередь, управление сбоями и повторными попытками, а также автоматическое масштабирование заданий рендеринга. Пакетная служба рендеринга поддерживает такие приложения для рендеринга, как [Autodesk Maya](https://www.autodesk.com/products/maya/overview), [3ds Max](https://www.autodesk.com/products/3ds-max/overview), [Arnold](https://www.autodesk.com/products/arnold/overview) и [V-Ray](https://www.chaosgroup.com/vray/maya). Подключаемый модуль пакетной службы для Maya 2017 упрощает запуск задания рендеринга в Azure непосредственно с рабочего стола.

Благодаря Maya и 3ds Max можно выполнять задания с помощью классического приложения [Batch Labs](https://github.com/Azure/BatchLabs) или [интерфейса командной строки шаблонов пакетной службы](batch-cli-templates.md). Интерфейс командной строки пакетной службы Azure позволяет выполнять пакетные задания без написания кода. Вместо этого вы можете создавать пулы, задания и задачи пакетной службы с помощью файлов шаблонов. Дополнительные сведения см. в статье [Использование шаблонов интерфейса командной строки для пакетной службы Azure и передачи файлов (предварительная версия)](batch-cli-templates.md).


## <a name="supported-applications"></a>Поддерживаемые приложения

На сегодня служба рендеринга пакетной службы поддерживает следующие приложения:

На узлах рендеринга CentOS 7:
- Autodesk Maya I/O 2017 обновление 5 (версия сборки: 201708032230);
- Autodesk Maya I/O 2018 обновление 2 (версия сборки: 201711281015);
- Autodesk Arnold for Maya 2017 (Arnold версии 5.0.1.1) MtoA-2.0.1.1-2017;
- Autodesk Arnold for Maya 2018 (Arnold версии 5.0.1.4) MtoA-2.1.0.3-2018;
- Chaos Group V-Ray for Maya 2017 (версия 3.60.04); 
- Chaos Group V-Ray for Maya 2018 (версия 3.60.04); 
- Blender (2.68).

На узлах рендеринга Windows Server 2016:
- Autodesk Maya I/O 2017 обновление 5 (версия 17.4.5459); 
- Autodesk Maya I/O 2018 обновление 2 (версия 18.2.0.6476); 
- Autodesk 3ds Max I/O 2018 обновление 4 (версия 20.4.0.4254); 
- Autodesk Arnold for Maya (Arnold версии 5.0.1.1) MtoA-2.0.1.1-2017;
- Autodesk Arnold for Maya (Arnold версии 5.0.1.4) MtoA-2.0.2.3-2018;
- Autodesk Arnold for 3ds Max (Arnold версии 5.0.2.4) (версия 1.2.926); 
- Chaos Group V-Ray for Maya (версия 3.52.03); 
- Chaos Group V-Ray for 3ds Max (версия 3.60.02);
- Blender (2.79).


## <a name="prerequisites"></a>предварительным требованиям

Чтобы использовать эту службу, вам потребуется:

- [учетная запись Azure;](https://azure.microsoft.com/free/)
- **учетная запись пакетной службы Azure.** Чтобы узнать о создании учетной записи пакетной службы на портале Azure, ознакомьтесь со статьей [Создание учетной записи пакетной службы на портале Azure](batch-account-create-portal.md).
- **Учетная запись хранения Azure.** Ресурсы, используемые для задания рендеринга, обычно хранятся в службе хранилища Azure. Вы можете автоматически создать учетную запись хранения при настройке учетной записи пакетной службы. Вы также можете использовать имеющуюся учетную запись хранения. Параметры учетной записи хранения в пакетной службе см. в [обзоре функций пакетной службы](batch-api-basics.md#azure-storage-account).
- **Переменные среды.** Если решение изменяет переменные среды, убедитесь, что значения `AZ_BATCH_ACCOUNT_URL` и `AZ_BATCH_SOFTWARE_ENTITLEMENT_TOKEN` указаны без изменений при вызове любого из лицензированных приложений, перечисленных выше. В противном случае вы можете столкнуться с проблемами активации программного обеспечения.
- **BatchLabs** (необязательно). [BatchLabs](https://azure.github.io/BatchLabs) — это бесплатное автономное клиентское средство с множеством функций для создания, отладки и мониторинга приложений пакетной службы Azure. Не обязательно использовать службу рендеринга, но она пригодится при разработке и отладке решений пакетной службы.

Чтобы использовать подключаемый модуль пакетной службы для Maya, вам потребуется:

- [Autodesk Maya 2017](https://www.autodesk.com/products/maya/overview).
- Поддерживаемый отрисовщик, например Arnold для Maya или V-Ray для Maya.

## <a name="basic-batch-concepts"></a>Основные понятия пакетной службы

Прежде чем начать использовать службу рендеринга пакетной службы, стоит ознакомиться с некоторыми понятиями пакетной службы, включая вычислительные узлы, пулы и задания. Дополнительные сведения о пакетной службе Azure в целом см. в статье [Выполнение реальных параллельных рабочих нагрузок с использованием пакетной службы](batch-technical-overview.md).

### <a name="pools"></a>Пулы

Пакетная служба представляет собой службу платформы для выполнения ресурсоемких вычислений (например, рендеринга) в **пуле** **вычислительных узлов**. Каждый вычислительный узел в пуле — это виртуальная машина Azure под управлением Windows или Linux. 

Дополнительные сведения о пулах пакетной службы и вычислительных узлах см. в разделах о [пуле](batch-api-basics.md#pool) и [вычислительном узле](batch-api-basics.md#compute-node) в статье [Разработка решений для крупномасштабных параллельных вычислений с использованием пакетной службы](batch-api-basics.md).

### <a name="jobs"></a>Задания

**Задание** пакетной службы — это набор задач, выполняющихся на вычислительных узлах в пуле. При отправке задания рендеринга пакетная служба делит задание на задачи и распределяет задачи между вычислительными узлами в пуле для их выполнения.

[Портал Azure](https://ms.portal.azure.com/) можно использовать для мониторинга заданий и диагностики задач, завершившихся сбоем. Для этого необходимо загрузить журналы приложений, а также удаленно подключиться к отдельным виртуальным машинам по протоколу RDP или SSH. Для управления, мониторинга и отладки можно также использовать [средство Batch Labs](https://azure.github.io/BatchLabs).

Дополнительные сведения о заданиях пакетной службы см. в разделе о [задании](batch-api-basics.md#job) в статье [Разработка решений для крупномасштабных параллельных вычислений с использованием пакетной службы](batch-api-basics.md).

## <a name="options-for-provisioning-required-applications"></a>Возможности подготовки необходимых приложений

Чтобы преобразовать задание для просмотра, может потребоваться несколько приложений, например сочетание Maya и Арнольд или 3ds Max и V-Ray, а также при необходимости другие сторонние подключаемые модули. Кроме того, для некоторых клиентов могут понадобиться конкретные версии этих приложений. Таким образом существует несколько методов, доступных для подготовки необходимых приложений и программного обеспечения.

### <a name="pre-configured-vm-images"></a>Предварительно настроенные образы виртуальной машины

Azure предоставляет образы Windows и Linux, каждый из которых имеет отдельную предварительно установленную и готовую к использованию версию Maya, 3ds Max, Arnold и V-Ray. При создании пула образы можно выбрать на [портале Azure](https://portal.azure.com), в подключаемом модуле Maya или в [Batch Labs](https://azure.github.io/BatchLabs).

На портале Azure и в Batch Labs можно установить один из образов виртуальной машины с предварительно установленными приложениями следующим образом. В разделе пулов учетной записи пакетной службы выберите **Создать**, а затем в разделе **Добавить пул** из раскрывающегося списка **Image type** (Тип образа) выберите **Отрисовка и вывод графики (Linux и Windows)**.

![Выбор типа образа для учетной записи пакетной службы](./media/batch-rendering-service/add-pool.png)

Прокрутите список вниз и в разделе **Лицензирование графики и рендеринга** щелкните **Выберите программное обеспечение и расценки**. Выберите одну или несколько лицензий на программное обеспечение.

![Выбор лицензий для графики и рендеринга пула](./media/batch-rendering-service/graphics-licensing.png)

Определенные версии лицензий соответствуют версиям, приведенным в разделе "Поддерживаемые приложения" выше.

### <a name="custom-images"></a>Пользовательские образы

Пакетная служба Azure позволяет предоставлять собственные пользовательские образы. Этот параметр позволяет настроить виртуальную машину с нужными приложениями и конкретными версиями. Дополнительные сведения см. в статье [Использование пользовательского образа для создания пула виртуальных машин](https://docs.microsoft.com/azure/batch/batch-custom-images). Обратите внимание, что Autodesk и Chaos Group изменили Arnold и V-Ray соответственно, чтобы проверить соответствие нашей собственной службы лицензирования. Необходимо убедиться, что у вас установлены версии приложений, для которых предоставляется эта поддержка. В противном случае вы не сможете использовать лицензирование с оплатой за использование. Для Maya или 3ds Max не требуется проверять лицензию, так как для текущих опубликованных версий не требуется сервер лицензирования при автономном запуске (в пакетном режиме или в режиме командной строки). Если вы не знаете, как использовать эту возможность, обратитесь в службу поддержки Azure.

## <a name="options-for-submitting-a-render-job"></a>Параметры для отправки задания рендеринга

В зависимости от используемого приложения 3D имеются различные способы для отправки заданий рендеринга в службу.

### <a name="maya"></a>Maya

С Maya можно использовать следующие средства:

- [подключаемый модуль пакетной службы для Maya](https://docs.microsoft.com/azure/batch/batch-rendering-service#use-the-batch-plug-in-for-maya-to-submit-a-render-job);
- классическое приложение [Batch Labs](https://azure.github.io/BatchLabs);
- [интерфейс командной строки шаблонов пакетной службы](batch-cli-templates.md).

### <a name="3ds-max"></a>3ds Max

С 3ds Max можно использовать следующие средства:

- классическое приложение [Batch Labs](https://azure.github.io/BatchLabs) (руководство по использованию шаблонов 3ds Max Batch Labs см. в репозитории с [данными Batch Labs](https://github.com/Azure/BatchLabs-data/tree/master/ncj/3dsmax));
- [интерфейс командной строки шаблонов пакетной службы](batch-cli-templates.md).

Шаблоны 3ds Max Batch Labs позволяют преобразовать сцены VRay и Arnold для просмотра с помощью службы отрисовки пакетной службы Azure. Имеется два варианта шаблона для VRay и Arnold: для стандартных сцен и для более сложных сцен, требующих файл пути 3ds Max к ресурсам и текстурам (MXP-файл). Дополнительные сведения о шаблонах 3ds Max Batch Labs см. в репозитории [данных Batch Labs](https://github.com/Azure/BatchLabs-data/tree/master/ncj/3dsmax) на GitHub.

Кроме того, можно использовать [пакет SDK пакетной службы для Python](https://docs.microsoft.com/azure/batch/batch-python-tutorial), чтобы интегрировать службу рендеринга с имеющимся конвейером.


## <a name="use-the-batch-plug-in-for-maya-to-submit-a-render-job"></a>Использование подключаемого модуля пакетной службы для Maya для отправки задания рендеринга

С помощью подключаемого модуля пакетной службы для Maya можно отправить задание в пакетную службу рендеринга непосредственно с Maya. В следующих разделах описывается, как настроить задание из подключаемого модуля, а затем отправить его. 

### <a name="load-the-batch-plug-in-for-maya"></a>Загрузка подключаемого модуля пакетной службы для Maya

Подключаемый модуль пакетной службы можно найти в [GitHub](https://github.com/Azure/azure-batch-maya/releases). Распакуйте архив в любой каталог по своему усмотрению: Можно загрузить подключаемый модуль непосредственно из каталога *azure_batch_maya*.

Чтобы загрузить подключаемый модуль в Maya:

1. Запустите Maya.
2. Выберите **Window** (Окно) > **Settings/Preferences (Параметры)** > **Plug-in Manager** (Диспетчер подключаемых модулей).
3. Щелкните **Обзор**.
4. Найдите и выберите *azure_batch_maya/plug-in/AzureBatch.py*.

### <a name="authenticate-access-to-your-batch-and-storage-accounts"></a>Аутентификация доступа к учетным записям хранения и пакетной службы

Чтобы использовать подключаемый модуль, необходимо пройти аутентификацию с помощью ключей учетной записи хранения Azure и пакетной службы Azure. Чтобы получить ключи учетной записи:

1. Выведите подключаемый модуль в Maya и выберите вкладку **Config** (Конфигурация).
2. Перейдите на [портал Azure](https://portal.azure.com).
3. Выберите **Учетные записи пакетной службы** в меню слева. При необходимости щелкните **Больше служб** и выполните фильтрацию по запросу _Пакетная служба_.
4. Найдите нужную учетную запись пакетной службы в списке.
5. Выберите пункт меню **Ключи**, чтобы отобразить имя учетной записи, ее URL-адрес и ключи доступа:
    - Вставьте URL-адрес учетной записи пакетной службы в поле **службы** в подключаемом модуле пакетной службы.
    - Вставьте имя учетной записи в поле **учетной записи пакетной службы**.
    - Вставьте основной ключ учетной записи в поле **ключа пакетной службы**.
7. Выберите учетные записи хранения в меню слева. При необходимости щелкните **Больше служб** и выполните фильтрацию по запросу _хранение_.
8. Найдите нужную учетную запись хранения в списке.
9. Выберите пункт меню **Ключи доступа**, чтобы отобразить имя и ключи учетной записи хранения.
    - Вставьте имя учетной записи хранения в поле **Storage Account** (Учетная запись хранения) в подключаемом модуле пакетной службы.
    - Вставьте основной ключ учетной записи в поле **Storage Key** (Ключ хранилища).
10. Щелкните **Authenticate** (Проверка подлинности), чтобы обеспечить доступ подключаемого модуля к обеим учетным записям.

После успешной аутентификации подключаемый модуль задает для поля состояния значение **Authenticated** (Проверка подлинности выполнена): 

![Аутентификация учетных записей хранения и пакетной службы](./media/batch-rendering-service/authentication.png)

### <a name="configure-a-pool-for-a-render-job"></a>Настройка пула для задания рендеринга

После проверки подлинности учетных записей хранения и пакетной службы можно настроить пул для задания рендеринга. Подключаемый модуль сохраняет выбранные параметры между сеансами. После настройки предпочитаемой конфигурации не нужно менять ее, пока в этом не будет необходимости.

В следующих разделах описываются соответствующие параметры, доступные на вкладке **Submit** (Отправить).

#### <a name="specify-a-new-or-existing-pool"></a>Указание нового или существующего пула

Чтобы указать пул, в котором будет выполняться задание рендеринга, выберите вкладку **Submit** (Отправить). Эта вкладка предоставляет возможности для создания пула или выбора уже существующего:

- Вы можете выбрать параметр по умолчанию **Auto provision a pool for this job** (Автоматически подготавливать пул для этого задания). При выборе этого параметра пакетная служба создает пул исключительно для текущего задания и автоматически удаляет его по завершении задания рендеринга. Этот вариант лучше использовать, если вам необходимо выполнить одно задание рендеринга.
- Вы можете выбрать параметр **Reuse an existing persistent pool** (Повторно использовать существующий пул). Если пул уже существует (находится в состоянии простоя), можно указать его для запуска задания рендеринга. Для этого выберите его из раскрывающегося списка. Повторное использование существующего пула сокращает время, необходимое для подготовки пула.  
- Вы можете выбрать параметр **Create a new persistent pool** (Создать постоянный пул). При выборе этого параметра для выполнения задания создается пул. Пул не удаляется после завершения задания, так что его можно повторно использовать для следующих заданий. Выберите этот параметр, если нужно постоянно выполнять задания рендеринга. Для выполнения следующих заданий можно выбрать вариант **повторного использования существующего пула**, чтобы использовать постоянный пул, созданный для первого задания.

![Указание пула, образа операционной системы, размера виртуальной машины и лицензии](./media/batch-rendering-service/submit.png)

Дополнительные сведения о том, как взимается плата за виртуальные машины Azure, см. на странице [часто задаваемых вопросов о ценах для Linux](https://azure.microsoft.com/pricing/details/virtual-machines/linux/#faq) и [Windows](https://azure.microsoft.com/pricing/details/virtual-machines/windows/#faq).

#### <a name="specify-the-os-image-to-provision"></a>Указание образа операционной системы для подготовки

Можно указать тип образа операционной системы, который будет использоваться для подготовки вычислительных узлов в пуле, на вкладке **Env** (Среда). На сегодня пакетная служба поддерживает следующие варианты образов для заданий рендеринга:

|Операционная система  |Образ —  |
|---------|---------|
|Linux     |Пакетная служба для CentOS |
|Windows     |Пакетная служба для Windows |

#### <a name="choose-a-vm-size"></a>Выбор размера виртуальной машины

На вкладке **Env** (Среда) можно указать размер виртуальной машины. Дополнительные сведения о доступных размерах виртуальных машин см. в статьях [Размеры виртуальных машин Linux в Azure](../virtual-machines/linux/sizes.md) и [Размеры виртуальных машин Windows в Azure](../virtual-machines/windows/sizes.md). 

![Указание параметров образа ОС и размера ВМ на вкладке среды](./media/batch-rendering-service/environment.png)

#### <a name="specify-licensing-options"></a>Указание вариантов лицензирования

На вкладке **Env** (Среда) можно указать лицензии, которые будут использоваться. Доступные параметры: 

- **Maya** — по умолчанию.
- **Arnold** — доступен, если он определяется как активный модуль рендеринга в Maya.

 Если вы хотите выполнить рендеринг с помощью собственной лицензии, можно настроить конечную точку лицензии, добавив соответствующие переменные среды в таблицу. Для этого должны быть отключены параметры лицензирования по умолчанию.

> [!IMPORTANT]
> Пока виртуальные машины запущены в пуле, за использование лицензий выставляются счета, даже если машины в настоящее время не используются для рендеринга. Чтобы избежать дополнительных затрат, перейдите на вкладку **Pools** (Пулы) и измените размер на 0 узлов, пока вы не будете готовы к запуску другого задания рендеринга. 
>
>

#### <a name="manage-persistent-pools"></a>Управление постоянными пулами

На вкладке **Pools** (Пулы) вы можете управлять имеющимся постоянным пулом. При выборе пула из списка отобразится его текущее состояние.

Используя вкладку **Pools** (Пулы), можно также удалить пул и изменить в нем количество виртуальных машин. Можно изменить размер пула до 0 узлов, чтобы избежать расходов между рабочими нагрузками.

![Просмотр, изменение размера и удаление пулов](./media/batch-rendering-service/pools.png)

### <a name="configure-a-render-job-for-submission"></a>Настройка задания рендеринга для отправки

После указания параметров для пула, который будет выполнять задание рендеринга, настройте само задание. 

#### <a name="specify-scene-parameters"></a>Указание параметров сцены

Подключаемый модуль пакетной службы обнаруживает, какой механизм рендеринга сейчас используется в Maya и отображает соответствующие параметры рендеринга на вкладке **Submit** (Отправить). Эти параметры включают первый кадр, конечный кадр, префикс выходных данных и шаг кадра. Вы можете переопределить параметры рендеринга файла сцены, указав другие параметры в подключаемом модуле. Изменения, внесенные в параметры подключаемого модуля, не сохраняются для параметров рендеринга файла сцены, поэтому можно вносить изменения для каждого отдельного задания без необходимости повторной отправки файла сцены.

Подключаемый модуль выдает предупреждение, если механизм рендеринга, выбранный в Maya, не поддерживается.

Если подключаемый модуль открыт и вы загружаете новую сцену, нажмите кнопку **Refresh** (Обновить) для обновления параметров.

#### <a name="resolve-asset-paths"></a>Разрешение путей к ресурсам

При загрузке подключаемого модуля он проверяет файл сцены на наличие любых внешних ссылок на файл. Эти ссылки отображаются на вкладке **Assets** (Ресурсы). Если указанный путь не удалось разрешить, подключаемый модуль попытается найти файл в нескольких расположениях по умолчанию, включая:

- расположение файла сцены; 
- каталог _sourceimages_ текущего проекта;
- текущий рабочий каталог. 

Если ресурс по-прежнему не удается найти, отобразится значок предупреждения:

![Отсутствующие ресурсы, отображаемые со значком предупреждения](./media/batch-rendering-service/missing_assets.png)

Если известно расположение неразрешенной ссылки на файл, можно щелкнуть значок предупреждения, чтобы получить запрос на добавление пути поиска. Подключаемый модуль затем использует этот путь поиска, чтобы попытаться разрешить все отсутствующие ресурсы. Можно добавить любое количество дополнительных путей поиска.

Когда ссылка будет разрешена, она появится в списке с зеленым значком:

![Разрешенные ресурсы с зеленым значком](./media/batch-rendering-service/found_assets.png)

Если сцена требует другие файлы, не обнаруженные подключаемым модулем, можно добавить дополнительные файлы или каталоги. Используйте кнопки **Add Files** (Добавить файлы) и **Add Directory** (Добавить каталог). При загрузке новой сцены (пока подключаемый модуль открыт) необходимо нажать кнопку **Refresh** (Обновить) для обновления ссылок сцены.

#### <a name="upload-assets-to-an-asset-project"></a>Отправка ресурсов в проект ресурсов

При отправке задания рендеринга соответствующие файлы, отображенные на вкладке **Assets** (Ресурсы), автоматически отправляются в службу хранилища Azure как проект ресурсов. Также можно отправить файлы ресурсов независимо от задания рендеринга. Для этого используйте кнопку **Upload** (Отправить) на вкладке **Assets** (Ресурсы). Имя проекта ресурсов указано в поле **Project** (Проект). По умолчанию оно соответствует имени текущего проекта Maya. После передачи файлов ресурсов сохраняется структура локального файла. 

После отправки на ресурсы может ссылаться любое количество заданий рендеринга. Все переданные ресурсы доступны для любого задания, которое ссылается на проект ресурсов, независимо от того, включены ли они в сцене. Чтобы изменить проект ресурсов, на который ссылается следующее задание, измените имя в поле **Project** (Проект) на вкладке **Assets** (Ресурсы). Если есть файлы, на которые имеются ссылки, которые не нужно отправлять, запретите их выбор, используя зеленую кнопку.

#### <a name="submit-and-monitor-the-render-job"></a>Отправка и отслеживание задания рендеринга

После настройки задания рендеринга в подключаемом модуле нажмите кнопку **Submit Job** (Отправить задание) на вкладке **Submit** (Отправить), чтобы отправить задание в пакетную службу:

![Отправка задания рендеринга](./media/batch-rendering-service/submit_job.png)

Вы можете отслеживать задание, которое выполняется, используя вкладку **Jobs** (Задания) в подключаемом модуле. Выберите задание из списка, чтобы отобразить его текущее состояние. Вы также можете использовать эту вкладку, чтобы отменить и удалить задания, а также загрузить выходные данные и журналы рендеринга. 

Чтобы загрузить выходные данные, измените поле **выходных данных**, чтобы задать нужный каталог назначения. Щелкните значок шестеренки, чтобы запустить фоновый процесс, который отслеживает задание и загружает выходные данные по мере выполнения: 

![Просмотр состояния задания и загрузка выходных данных](./media/batch-rendering-service/jobs.png)

Вы можете закрыть Maya, не прерывая процесс загрузки.

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о пакетной службе см. в статье [Выполнение реальных параллельных рабочих нагрузок с использованием пакетной службы](batch-technical-overview.md).
