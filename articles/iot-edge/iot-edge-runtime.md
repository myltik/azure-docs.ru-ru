---
title: Общие сведения о среде выполнения Azure IoT Edge | Документация Майкрософт
description: Узнайте о среде выполнения Azure IoT Edge и возможностях, которые она предоставляет для пограничных устройств.
author: kgremban
manager: timlt
ms.author: kgremban
ms.date: 02/15/2018
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: 4c44713d6b58edd3a18b0d20992d31dec7377fa7
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34632080"
---
# <a name="understand-the-azure-iot-edge-runtime-and-its-architecture---preview"></a>Общие сведения о среде выполнения Azure IoT Edge и ее архитектуре (предварительная версия)

Среда выполнения Azure IoT Edge — это коллекция программ, которую необходимо установить на устройстве, чтобы оно считалось устройством IoT Edge. В совокупности компоненты среды выполнения IoT Edge позволяют устройствам IoT Edge получать код для запуска на границе и пересылки результатов. 

Среда выполнения IoT Edge выполняет следующие функции на пограничных устройствах IoT Edge:

* установка и обновление рабочих нагрузок на устройстве;
* поддержание стандартов безопасности Azure IoT Edge на устройстве;
* поддержание рабочего состояния [модулей IoT Edge][этой статье];
* передача данных о состоянии работоспособности модуля в облако для удаленного мониторинга;
* упрощение взаимодействия между подчиненными конечными устройствами и устройством IoT Edge;
* упрощение взаимодействия между модулями на устройстве IoT Edge;
* упрощение взаимодействия между устройством IoT Edge и облаком.

![Среда выполнения IoT Edge передает аналитические сведения и информацию о работоспособности модуля в Центр Интернета вещей][1]

Обязанности среды выполнения IoT Edge делятся на две категории: управление модулями и обмен данными. Эти две роли выполняются двумя компонентами, которые составляют среду выполнения IoT Edge. Концентратор IoT Edge отвечает за обмен данными, а агент IoT Edge управляет развертыванием и мониторингом модулей. 

И агент Edge, и концентратор Edge являются модулями и, как любые другие модули, выполняются на устройстве IoT Edge. Дополнительные сведения о работе модулей см. в [этой статье]. 

## <a name="iot-edge-hub"></a>Концентратор IoT Edge

Концентратор IoT Edge — это один из двух модулей, составляющих среду выполнения Azure IoT Edge. Он действует в качестве локального прокси-сервера для Центра Интернета вещей, предоставляя те же конечные точки протокола, что и Центр Интернета вещей. Эта согласованность означает, что клиенты (устройства или модули) могут подключаться к среде выполнения IoT Edge так же, как к Центру Интернета вещей. 

>[!NOTE]
> На этапе общедоступной предварительной версии концентратор Edge поддерживает только клиенты, которые подключаются с помощью MQTT.

Концентратор Edge не является полной версией выполняемого локально Центра Интернета вещей. Есть некоторые вещи, которые цент Edge автоматически делегирует Центру Интернета вещей. Например, концентратор Edge переадресовывает запросы на проверку подлинности в Центр Интернета вещей при первом подключении устройства. После установки первого подключения сведения о безопасности будут кэшированы локально концентратором Edge. Последующие подключения от этого устройства не проходят проверку подлинности в облаке. 

>[!NOTE]
> На этапе общедоступной предварительной версии среда выполнения должна быть подключена при каждой попытке проверки подлинности устройства.

Чтобы сократить пропускную способность, используемую решением IoT Edge, концентратор Edge оптимизирует количество фактических подключений к облаку. Концентратор Edge принимает логические подключения от клиентов, например модулей или конечных устройств, и объединяет их для одного физического подключения к облаку. Сведения об этом процессе прозрачны для остальной части решения. Клиенты думают, что имеют собственное подключение к облаку, несмотря на то что передача данных выполняется через одно подключение. 

![Концентратор Edge действует в качестве шлюза между несколькими физическими устройствами и облаком][2]

Концентратор Edge может определить, подключен ли он к Центру Интернета вещей. Если подключение потеряно, концентратор Edge сохранит сообщения или операции обновления двойников локально. Когда подключение будет снова установлено, он выполнит синхронизацию всех данных. Расположение, используемое для этого временного кэша, определяется свойством двойника модуля в концентраторе Edge. Размер кэша не ограничен и будет увеличиваться, пока у устройства есть емкость хранилища. 

>[!NOTE]
>Перед тем как продукт станет общедоступным, будет добавлен элемент управления дополнительными параметрами кэширования.

### <a name="module-communication"></a>Обмен данными между модулями

Концентратор Edge облегчает взаимодействие между модулями. Благодаря использованию концентратора Edge в качестве брокера сообщений модули независимы друг от друга. Модулям необходимо указывать только те входы, на которые они принимают сообщения, и выходы, на которые они записывают сообщения. Затем разработчик решений совмещает эти входы и выходы вместе, чтобы модули обрабатывали данные в порядке, определенном для этого решения. 

![Концентратор Edge облегчает обмен данными между модулями][3]

Для отправки данных в концентратор Edge модуль вызывает метод SendEventAsync. Первый аргумент указывает, в какой выход нужно отправить сообщение. Следующий псевдокод отправляет сообщение в output1:

   ```csharp
   DeviceClient client = new DeviceClient.CreateFromConnectionString(moduleConnectionString, settings); 
   await client.OpenAsync(); 
   await client.SendEventAsync(“output1”, message); 
   ```

Для получения сообщений зарегистрируйте обратный вызов, который обрабатывает сообщения, приходящие в определенный вход. Следующий псевдокод регистрирует функцию messageProcessor для обработки всех сообщений, полученных в input1:

   ```csharp
   await client.SetEventHandlerAsync(“input1”, messageProcessor, userContext);
   ```

Разработчик решений отвечает за указание правил, определяющих, как концентратор Edge передает сообщения между модулями. Правила маршрутизации определяются в облаке и помещаются в концентратор Edge в его двойник устройства. Тот же синтаксис для маршрутов Центра Интернета вещей используется при определении маршрутов между модулями в Azure IoT Edge. 

<!--- For more info on how to declare routes between modules, see []. --->   

![Маршруты между модулями][4]

## <a name="iot-edge-agent"></a>Агент IoT Edge

Агент IoT Edge — это другой модуль, который составляет среду выполнения Azure IoT Edge. Он отвечает за создание экземпляров модулей, обеспечивая их работу и сообщение о состоянии модулей обратно в Центр Интернета вещей. Так же как и любой другой модуль, агент Edge использует его двойник модуля для хранения данных конфигурации. 

Чтобы начать выполнение агента Edge, выполните команду запуска azure-iot-edge-runtime-ctl.py. Агент получает свой двойник модуля из Центра Интернета вещей и проверяет словарь модулей. Словарь модулей — это коллекция модулей, которые нужно запустить. 

Каждый элемент в словаре модулей содержит определенные сведения о модуле и используется агентом Edge для управления жизненным циклом модуля. Ниже приведены некоторые из наиболее интересных свойств: 

* **settings.image**. Образ контейнера, который агент Edge использует для запуска модуля. Агент Edge должен быть настроен с учетными данными для реестра контейнера, если образ защищен паролем. Чтобы настроить агент Edge, выполните следующую команду: `azure-iot-edge-runtime-ctl.py –configure`.
* **settings.createOptions**.Строка, которая передается напрямую в управляющую программу Docker при запуске контейнера модуля. Добавление параметров Docker в это свойство позволяет настроить дополнительные параметры, такие как перенаправление портов или подключение томов, в контейнере модуля.  
* **status**.Состояние, в котором агент Edge помещает модуль. Обычно это значение — *running*, так как большинству пользователей требуется, чтобы агент Edge немедленно запускал все модули на устройстве. Однако можно указать начальное состояние модуля, который должен быть остановлен, и дождаться нужного времени, чтобы сообщить агенту Edge о запуске модуля. Агент Edge сообщает состояние каждого модуля обратно в облако в сообщаемых свойствах. Различие между требуемым свойством и сообщаемым свойством является индикатором некорректно работающего устройства. Ниже перечислены поддерживаемые состояния:
   * Downloading;
   * Выполнение
   * Unhealthy;
   * Сбой
   * Остановлено
* **restartPolicy**. То, как агент Edge перезапускает модуль. Ниже перечислены возможные значения.
   * "Never". Агент Edge никогда не перезапускает модуль.
   * "onFailure". Агент Edge перезапускает модуль в случае аварийного завершения. Если модуль завершается без сбоев, агент Edge не перезапускает его.
   * "Unhealthy". Если модуль завершается со сбоем или неработоспособен, агент Edge перезапускает его.
   * "Always". Если модуль завершается со сбоем, неработоспособен или завершает работу каким-либо образом, агент Edge перезапускает его. 

Агент IoT Edge отправляет ответ среды выполнения в центр IOT. Ниже перечислены возможные ответы:
  * 200 – OK
  * 400 — конфигурация развертывания имеет неправильный формат или недопустима.
  * 417 — у устройства нет заданной конфигурации развертывания.
  * 412 — версия схемы в конфигурации развертывания недопустима.
  * 406 — устройство Edge работает в автономном режиме или не отправляет отчеты о состоянии.
  * 500 — ошибка среды выполнения Edge.

### <a name="security"></a>Безопасность

Агент IoT Edge играет важную роль в обеспечении безопасности устройства IoT Edge. Например, он выполняет такие действия, как проверка образа модуля перед запуском. Эти возможности будут добавлены в общедоступной версии функций 2. 

<!-- For more information about the Azure IoT Edge security framework, see []. -->

## <a name="next-steps"></a>Дополнительная информация

- [Общие сведения о модулях Центра IoT Edge Azure — предварительная версия][этой статье]

<!-- Images -->
[1]: ./media/iot-edge-runtime/Pipeline.png
[2]: ./media/iot-edge-runtime/Gateway.png
[3]: ./media/iot-edge-runtime/ModuleEndpoints.png
[4]: ./media/iot-edge-runtime/ModuleEndpointsWithRoutes.png

<!-- Links -->
[этой статье]: iot-edge-modules.md
