---
title: Использование аутентификации Azure AD для доступа к API служб мультимедиа Azure с помощью REST | Документация Майкрософт
description: Узнайте, как обращаться к API служб мультимедиа Azure с помощью аутентификации Azure Active Directory, используя REST.
services: media-services
documentationcenter: ''
author: willzhan
manager: cfowler
editor: ''
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/26/2017
ms.author: willzhan;juliako;johndeu
ms.openlocfilehash: ed78d6c6d4c695b841dbfbf917cd1681adc44ee7
ms.sourcegitcommit: e221d1a2e0fb245610a6dd886e7e74c362f06467
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2018
ms.locfileid: "33785993"
---
# <a name="use-azure-ad-authentication-to-access-the-azure-media-services-api-with-rest"></a>Использование аутентификации Azure AD для доступа к API служб мультимедиа Azure с помощью REST

Процесс аутентификации Azure AD в службах мультимедиа Azure можно выполнить двумя способами.

- **Аутентификация пользователя** позволяет проверить подлинность пользователя, который использует приложение для взаимодействия с ресурсами служб мультимедиа Azure. Интерактивное приложение должно сначала запросить у пользователя учетные данные. Примером может послужить приложение консоли управления, которое используется авторизованными пользователями для мониторинга заданий кодирования или потоковой трансляции. 
- **Аутентификация субъекта-службы** позволяет проверить подлинность службы. Этот метод аутентификации обычно используют приложения, которые выполняют службы управляющей программы, службы среднего уровня или запланированные задания, например веб-приложения, приложения-функции, приложения логики, интерфейсы API или микрослужбы.

    В этом руководстве показано, как использовать аутентификацию **субъекта-службы** Azure AD для доступа к API AMS с помощью REST. 

    > [!NOTE]
    > **Субъект-служба** — это лучшая методика для большинства приложений, подключающихся к службам мультимедиа Azure. 

Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * Получение сведений об аутентификации с портала Azure
> * Получение токена доступа с помощью Postman.
> * Проверка API **ресурсов** с помощью токена доступа


> [!IMPORTANT]
> Службы мультимедиа в настоящее время поддерживают модель аутентификации с помощью службы контроля доступа Azure. Тем не менее авторизация посредством службы контроля доступа будет объявлена устаревшей 1 июня 2018 года. Мы рекомендуем как можно быстрее перейти на использование модели аутентификации Azure AD.

## <a name="prerequisites"></a>предварительным требованиям

- Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?ref=microsoft.com&utm_source=microsoft.com&utm_medium=docs&utm_campaign=visualstudio), прежде чем начинать работу.
- [Создание учетной записи служб мультимедиа Azure с помощью портала Azure](media-services-portal-create-account.md).
- Ознакомьтесь со статьей [Доступ к API служб мультимедиа Azure с помощью аутентификации Azure AD](media-services-use-aad-auth-to-access-ams-api.md).
- Установите клиент REST [Postman](https://www.getpostman.com/) для выполнения REST API, как показано в этой статье. 

    В этом руководстве мы используем **Postman**, но подойдет любое средство REST. Другие варианты включают **Visual Studio Code** с подключаемым модулем REST или **Telerik Fiddler**. 

## <a name="get-the-authentication-information-from-the-azure-portal"></a>Получение сведений об аутентификации с портала Azure

### <a name="overview"></a>Обзор

Чтобы получить доступ к API служб мультимедиа, необходимо собрать следующие данные.

|Параметр|Пример|ОПИСАНИЕ|
|---|-------|-----|
|Домен клиента Azure Active Directory|microsoft.onmicrosoft.com|Azure AD в качестве конечной точки службы токенов безопасности (STS) создается в следующем формате: https://login.microsoftonline.com/{your-aad-tenant-name.onmicrosoft.com}/oauth2/token. Azure AD выдает маркер JWT для доступа к ресурсам (маркер доступа).|
|Конечная точка REST API|https://amshelloworld.restv2.westus.media.azure.net/api/|Это конечная точка, к которой отправляются все вызовы REST API служб мультимедиа в вашем приложении.|
|Идентификатор клиента (идентификатор приложения)|f7fbbb29-a02d-4d91-bbc6-59a2579259d2|Идентификатор приложения (клиента) Azure AD. Идентификатор клиента необходим для получения токена доступа. |
|Секрет клиента|+mUERiNzVMoJGggD6aV1etzFGa1n6KeSlLjIq+Dbim0=|Ключи приложений Azure AD (секрет клиента). Секрет клиента необходим для получения токена доступа.|

### <a name="get-aad-auth-info-from-the-azure-portal"></a>Получение сведений об Azure Active Directory с портала Azure

Чтобы получить сведения, сделайте следующее:

1. Войдите на [портал Azure](http://portal.azure.com).
2. Перейдите к экземпляру службы мультимедиа Azure.
3. Выберите **Доступ через API**.
4. Щелкните **Подключение к API служб мультимедиа Azure с помощью субъекта-службы**.

    ![Доступ через API](./media/connect-with-rest/connect-with-rest01.png)

5. Выберите имеющееся **приложение Azure AD** или создайте новое (как показано ниже).

    > [!NOTE]
    > Чтобы запрос REST служб мультимедиа Azure был успешно выполнен, у вызывающего пользователя должна быть роль **участника** или **владельца** для учетной записи служб мультимедиа, к которой он пытается получить доступ. Если вы получите сообщение The remote server returned an error: (401) Unauthorized (Удаленный сервер вернул ошибку: не авторизовано (401)), см. раздел [Управление доступом](media-services-use-aad-auth-to-access-ams-api.md#access-control).

    Если необходимо создать новое приложение Azure AD, выполните следующее.
    
    1. Нажмите кнопку **Создать**.
    2. Введите имя.
    3. Нажмите кнопку **Создать** еще раз.
    4. Нажмите кнопку **Save**(Сохранить).

    ![Доступ через API](./media/connect-with-rest/new-app.png)

    Новое приложение отображается на странице.

6. Получите **идентификатор клиента** (приложения).
    
    1. Выберите приложение.
    2. В окне справа находится **идентификатор клиента**. 

    ![Доступ через API](./media/connect-with-rest/existing-client-id.png).

7.  Получите **ключ** приложения (секрет клиента). 

    1. Нажмите кнопку **Управление приложением** (обратите внимание, что сведения об идентификаторе клиента находятся над **идентификатором приложения**). 
    2. Щелкните **Ключи**.
    
        ![Доступ через API](./media/connect-with-rest/manage-app.png)
    3. Создайте ключ приложения (секрет клиента), заполнив поля **описания** и **срока действия** и нажав кнопку **Сохранить**.
    
        После **этого** отобразится значение ключа. Скопируйте его, прежде чем выйти из колонки.

    ![Доступ через API](./media/connect-with-rest/connect-with-rest03.png)

Вы можете добавить значения параметров подключения AD в файл web.config или app.config для дальнейшего использования в коде.

> [!IMPORTANT]
> **Ключ клиента** является важным секретом и должен быть защищен надлежащим образом в хранилище ключей или зашифрован в рабочей среде.

## <a name="get-the-access-token-using-postman"></a>Получение токена доступа с помощью Postman

В этом разделе показано, как использовать **Postman** для выполнения REST API, который возвращает токен носителя JWT (токен доступа). Чтобы вызвать любой REST API служб мультимедиа, необходимо добавить заголовок Authorization к вызовам, а к каждому вызову — значение Bearer *токен_доступа* (как показано в следующем разделе этого руководства). 

1. Откройте **Postman**.
2. Выберите **POST**.
3. Введите URL-адрес, содержащий имя клиента, в следующем формате: имя клиента должно заканчиваться на **.onmicrosoft.com**, а URL-адрес — на **oauth2/token**. 

    https://login.microsoftonline.com/{your-aad-tenant-name.onmicrosoft.com}/oauth2/token

4. Выберите вкладку **Headers** (Заголовки).
5. Введите данные **заголовков**, используя сетку данных "ключ — значение". 

    ![Сетка данных](./media/connect-with-rest/headers-data-grid.png)

    Кроме того, можно щелкнуть ссылку **Массовое изменение** в окне Postman справа и вставить следующий код.

        Content-Type:application/x-www-form-urlencoded
        Keep-Alive:true

6. Перейдите на вкладку **Body** (Текст).
7. Введите сведения с помощью сетки данных "ключ— значение" (замените значения идентификатора и секрета клиента). 

    ![Сетка данных](./media/connect-with-rest/data-grid.png)

    Кроме того, можно нажать **Bulk Edit** (Массовое изменение) в окне Postman справа и вставить следующий текст (замените значения идентификатора и секрета клиента):

        grant_type:client_credentials
        client_id:{Your Client ID that you got from your AAD Application}
        client_secret:{Your client secret that you got from your AAD Application's Keys}
        resource:https://rest.media.azure.net

8. Нажмите кнопку **Отправить**.

    ![получение токена](./media/connect-with-rest/connect-with-rest04.png)

Возвращенный ответ содержит **токен доступа**, который необходим для доступа к любым API AMS.

## <a name="test-the-assets-api-using-the-access-token"></a>Проверка API **ресурсов** с помощью токена доступа

В этом разделе показано, как получить доступ к API **ресурсов** с помощью **Postman**.

1. Откройте **Postman**.
2. Выберите **GET**.
3. Вставьте конечную точку REST API (например, https://amshelloworld.restv2.westus.media.azure.net/api/Assets)
4. Перейдите на вкладку **Authorization** (Авторизация). 
5. Выберите **Bearer Token** (Токен носителя).
6. Вставьте токен, который был создан в предыдущем разделе.

    ![получение токена](./media/connect-with-rest/connect-with-rest05.png)

    > [!NOTE]
    > Версия пользовательского интерфейса Postman для Mac и ПК может быть разной. Если в версии Mac в раскрывающемся списке раздела **Authentication** (Аутентификация) отсутствует параметр Bearer Token (Токен носителя), необходимо вручную добавить заголовок **Authorization** на клиенте Mac.

   ![Заголовок аутентификации](./media/connect-with-rest/auth-header.png)

7. Выберите **Headers** (Заголовки).
5. В окне Postman справа щелкните ссылку **Bulk Edit** (Массовое изменение).
6. Вставьте следующие заголовки.

        x-ms-version:2.15
        Accept:application/json
        Content-Type:application/json
        DataServiceVersion:3.0
        MaxDataServiceVersion:3.0

7. Нажмите кнопку **Отправить**.

Возвращенный ответ содержит ресурсы, которые находятся в вашей учетной записи.

## <a name="next-steps"></a>Дополнительная информация

* Пример кода доступен в разделе [Azure AD Authentication for Azure Media Services Access: Both via REST API](https://github.com/willzhan/WAMSRESTSoln) (Аутентификация Azure AD для доступа к службам мультимедиа Azure с помощью REST API)
* [Передача файлов в учетную запись служб мультимедиа с помощью .NET](media-services-dotnet-upload-files.md)
