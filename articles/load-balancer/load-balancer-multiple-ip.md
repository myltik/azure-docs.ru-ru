---
title: Балансировка нагрузки в конфигурациях с несколькими IP-адресами в Azure | Документация Майкрософт
description: Балансировка нагрузки между основной и дополнительной IP-конфигурациями.
services: load-balancer
documentationcenter: na
author: KumudD
manager: timlt
editor: na
ms.assetid: 244907cd-b275-4494-aaf7-dcfc4d93edfe
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/25/2017
ms.author: kumud
ms.openlocfilehash: 3bf2f793baec4a0fdacadd7fb6d3d6784aa17f29
ms.sourcegitcommit: d98d99567d0383bb8d7cbe2d767ec15ebf2daeb2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/10/2018
ms.locfileid: "33940193"
---
# <a name="load-balancing-on-multiple-ip-configurations-by-using-the-azure-portal"></a>Балансировка нагрузки в конфигурациях с несколькими IP-адресами с помощью портала Azure

> [!div class="op_single_selector"]
> * [Портал](load-balancer-multiple-ip.md)
> * [PowerShell](load-balancer-multiple-ip-powershell.md)
> * [ИНТЕРФЕЙС КОМАНДНОЙ СТРОКИ](load-balancer-multiple-ip-cli.md)


В этой статье описывается, как использовать Azure Load Balancer в конфигурации, когда каждому дополнительному адаптеру сетевого интерфейса (сетевой адаптер) назначено несколько IP-адресов. На схеме ниже показан наш сценарий.

![Сценарий использования балансировщика нагрузки](./media/load-balancer-multiple-ip/lb-multi-ip.PNG)

В этом сценарии мы будем использовать следующую конфигурацию:

- Две виртуальные машины под управлением Windows.
- Каждая виртуальная машина оснащена основным и дополнительным сетевым адаптером.
- Каждый дополнительный сетевой адаптер имеет две IP-конфигурации.
- На каждой виртуальной машине размещены два веб-сайта: contoso.com и fabrikam.com.
- Каждый веб-сайт привязан к IP-конфигураций дополнительного сетевого адаптера.
- Azure Load Balancer используется, чтобы предоставить два интерфейсных IP-адреса, по одному для каждого веб-сайта. Интерфейсные IP-адреса позволяют направить трафик в соответствующую IP-конфигурацию для каждого веб-сайта.
- Один и тот же номер порта используется для обоих внешних интерфейсов, как и для обоих IP-адресов внутренних пулов.

## <a name="prerequisites"></a>предварительным требованиям

В нашем примере сценария предполагается, что у вас есть группа ресурсов с именем **contosofabrikam** со следующей конфигурацией.

- Группа ресурсов содержит виртуальную сеть с именем **myVNet**.
- Сеть **myVNet** содержит две виртуальные машины с именем **VM1** и **VM2**.
- VM1 и VM2 находятся в одной и той же группе доступности с именем **myAvailset**. 
- VM1 и VM2 имеют основные сетевые адаптеры с именами **VM1NIC1** и **VM2NIC1** соответственно. 
- VM1 и VM2 имеют дополнительные сетевые адаптеры с именами **VM1NIC2** и **VM2NIC2** соответственно.

Ознакомьтесь с дополнительными сведениями о [создании виртуальных машин с несколькими сетевыми адаптерами с помощью PowerShell](../virtual-machines/windows/multiple-nics.md).

## <a name="perform-load-balancing-on-multiple-ip-configurations"></a>Выполнение балансировки нагрузки в конфигурациях с несколькими IP-адресами

Чтобы реализовать сценарий, описанный в этой статье, выполните указанные ниже действия.

### <a name="step-1-configure-the-secondary-nics"></a>Шаг 1. Настройка дополнительных сетевых адаптеров

Каждому дополнительному сетевому адаптеру каждой виртуальной машины в виртуальной сети назначьте IP-конфигурацию.  

1. Войдите на портал Azure по адресу http://portal.azure.com. Войдите в систему с использованием учетной записи Azure.

2. В верхней левой части экрана щелкните значок **Группа ресурсов**. Затем выберите группу ресурсов, в которой расположены виртуальные машины (например, **contosofabrikam**). На панели **Группы ресурсов** отображаются все ресурсы и сетевые адаптеры для виртуальных машин.

3. Каждому дополнительному сетевому адаптеру каждой виртуальной машины назначьте IP-конфигурацию.

    1. Выберите сетевой адаптер, который необходимо настроить.
    
    2. Щелкните **IP configurations** (Конфигурации IP). В верхней части следующей колонки выберите **Добавить**.

    3. В разделе **Add IP configurations** (Добавление IP-конфигураций) назначьте сетевому адаптеру вторую IP-конфигурацию: 

        1. Введите имя второй IP-конфигурации. (Например, для VM1 и VM2 имя IP-конфигураций будет **VM1NIC2 ipconfig2** и **VM2NIC2 ipconfig2** соответственно.)

        2. В разделе **Частный IP-адрес** для параметра **Выделение** выберите значение **Статическое**.

        3. Нажмите кнопку **ОК**.

Назначив дополнительному сетевому адаптеру вторую IP-конфигурацию, вы увидите ее в разделе параметров **IP-конфигурации** для заданного сетевого адаптера.

### <a name="step-2-create-the-load-balancer"></a>Шаг 2. Создание подсистемы балансировки нагрузки

Создайте подсистему балансировки нагрузки, используя следующую конфигурацию:

1. Войдите на портал Azure по адресу http://portal.azure.com. Войдите в систему с использованием учетной записи Azure.

2. Вверху слева последовательно выберите **Создать ресурс** > **Сети** > **Load Balancer**. Далее выберите **Создать**.

3. В разделе **Create load balancer** (Создание подсистемы балансировки нагрузки) введите имя для балансировщика нагрузки. В этом сценарии мы используем имя **mylb**.

4. В разделе **Общедоступный IP-адрес** создайте общедоступный IP-адрес с именем **PublicIP1**.

5. В разделе **Группа ресурсов** выберите имеющуюся группу ресурсов, связанную с вашими виртуальными машинами (например, **contosofabrikam**). Выберите расположение для развертывания подсистемы балансировки нагрузки и нажмите кнопку **OK**.

Подсистема балансировки нагрузки начнет развертывание. Для успешного выполнения развертывания может потребоваться несколько минут. После развертывания подсистема балансировки нагрузки отобразится как ресурс в группе ресурсов.

### <a name="step-3-configure-the-front-end-ip-pool"></a>Шаг 3. Настройка пула внешних IP-адресов

Настройте интерфейсные пулы IP-адресов подсистемы балансировки нагрузки для каждого веб-сайта (contoso.com и fabrikam.com).

1. На портале щелкните **Больше служб**. В поле фильтра введите **общедоступный IP-адрес**, а затем выберите **Общедоступные IP-адреса**. В верхней части следующей колонки выберите **Добавить**.

2. Настройте два общедоступных IP-адреса (**PublicIP1** и **PublicIP2**) для обоих веб-сайтов (contoso.com и fabrikam.com).

    1. Введите имя внешнего IP-адреса.

    2. В разделе **Группа ресурсов** выберите имеющуюся группу ресурсов, связанную с вашими виртуальными машинами (например, **contosofabrikam**).

    3. Выберите то же **расположение**, что и для виртуальных машин.

    4. Нажмите кнопку **ОК**.

    После создания IP-адресов они отобразятся в разделе **общедоступных IP-адресов**.

3. <a name="step3-3"></a>На портале щелкните **Больше служб**. В поле фильтра введите **подсистема балансировки нагрузки** и выберите **Подсистема балансировки нагрузки**. 

4. Выберите подсистему балансировки нагрузки (**mylb**), которую необходимо связать с пулом внешних IP-адресов.

5. В разделе **Параметры** выберите **Интерфейсная IP-конфигурация**. В верхней части следующей колонки выберите **Добавить**.

6. Введите имя для внешнего IP-адреса (например, **contosofe** или **fabrikamfe**).

7. <a name="step3-7"></a>Выберите **IP-адрес**. В разделе **Выбрать общедоступный IP-адрес** выберите IP-адреса для интерфейсных компонентов (**PublicIP1** или **PublicIP2**).

8. Создайте второй внешний IP-адрес, повторив шаги с <a href="#step3-3">3</a> по <a href="#step3-7">7</a> из этого раздела.

После настройки интерфейсного пула IP-адреса отображаются в параметрах **конфигурации интерфейсных IP-адресов** подсистемы балансировки нагрузки. 
    
### <a name="step-4-configure-the-back-end-pool"></a>Шаг 4. Настройка серверного пула

Настройте внутренние пулы адресов подсистемы балансировки нагрузки для каждого веб-сайта (contoso.com и fabrikam.com).
        
1. На портале щелкните **Больше служб**. В поле фильтра введите **подсистема балансировки нагрузки** и выберите **Подсистема балансировки нагрузки**.

2. Выберите подсистему балансировки нагрузки (**mylb**), которую необходимо связать с внутренними пулами.

3. В разделе **Параметры** выберите **Внутренние пулы**. Введите имя внутреннего пула (например, **contosopool** или **fabrikampool**). В верхней части следующей колонки выберите **Добавить**. 

4. Для параметра **Связано с** выберите значение **Группа доступности**.

5. Для параметра **Группа доступности** выберите значение **myAvailset**.

6. Назначьте виртуальным машинам IP-конфигурации целевых сетей. 

    ![Настройка внутренних пулов для подсистемы балансировки нагрузки](./media/load-balancer-multiple-ip/lb-backendpool.PNG)
    
    1. В качестве **целевой виртуальной машины** выберите виртуальную машину, которую необходимо связать с внутренним пулом (например, **VM1** или **VM2**).

    2. В качестве **сетевой IP-конфигурации** выберите конфигурацию IP-адреса дополнительного сетевого адаптера для виртуальной машины, выбранной на предыдущем шаге (например, **VM1NIC2-ipconfig2** или **VM2NIC2-ipconfig2**).

7. Нажмите кнопку **ОК**.

Настроив внутренний пул, IP-адреса отобразятся в разделе параметров **Внутренний пул** подсистемы балансировки нагрузки.

### <a name="step-5-configure-the-health-probe"></a>Шаг 5. Настройка проверки работоспособности

Настройте проверку работоспособности для подсистемы балансировки нагрузки, сделав следующее:

1. На портале щелкните **Больше служб**. В поле фильтра введите **подсистема балансировки нагрузки** и выберите **Подсистема балансировки нагрузки**.

2. Выберите подсистему балансировки нагрузки (**mylb**), для которой необходимо добавить проверку работоспособности.

3. В разделе **Параметры** выберите **Проверка работоспособности**. В верхней части следующей колонки выберите **Добавить**. 

4. Введите имя проверки работоспособности (например, **HTTP**). Нажмите кнопку **ОК**.

### <a name="step-6-configure-load-balancing-rules"></a>Шаг 6. Настройка правил балансировки нагрузки

Настройте правила балансировки нагрузки для каждого веб-сайта (contoso.com и fabrikam.com).
    
1. <a name="step6-1"></a>В разделе **Параметры** выберите **Health probe** (Проверка работоспособности). В верхней части следующей колонки выберите **Добавить**. 

2. Выберите **имя** правила балансировки нагрузки (например, **HTTPc** для contoso.com или **HTTPf** для fabrikam.com).

3. Для **внешних IP-адресов** выберите внешний IP-адрес, который вы создали ранее (например **contosofe** или **fabrikamfe**).

4. Для **порта** и **порта сервера**, оставьте значение по умолчанию — **80**.

5. Для параметра **Плавающий IP-адрес (direct server return)** выберите значение **Включено**.

6. <a name="step6-6"></a>Нажмите кнопку **OK**.

7. Создайте второе правило балансировки нагрузки, повторив шаги с <a href="#step6-1">1</a> по <a href="#step6-6">6</a> из этого раздела.

После настройки правил они отображаются в разделе параметров **Правила балансировки нагрузки** подсистемы балансировки нагрузки.

### <a name="step-7-configure-dns-records"></a>Шаг 7. Настройка записей DNS

На последнем шаге необходимо настроить записи ресурсов DNS, чтобы они указывали на соответствующие интерфейсные IP-адреса подсистемы балансировки нагрузки. Домены можно разместить в Azure DNS. Дополнительные сведения об использовании Azure DNS с подсистемой балансировки нагрузки см. в разделе [Использование Azure DNS с другими службами Azure](../dns/dns-for-azure-services.md).

## <a name="next-steps"></a>Дополнительная информация
- Узнайте больше о том, как объединять службы балансировки нагрузки, в статье [Использование служб балансировки нагрузки в Azure](../traffic-manager/traffic-manager-load-balancing-azure.md).
- Узнайте, как управлять подсистемой балансировки нагрузки и устранять неполадки с помощью разных видов журналов в [Log Analytics для Azure Load Balancer](../load-balancer/load-balancer-monitor-log.md).
