---
title: Azure Load Balancer уровня "Стандартный" и зоны доступности | Документация Майкрософт
description: Azure Load Balancer уровня "Стандартный" и зоны доступности
services: load-balancer
documentationcenter: na
author: KumudD
manager: jeconnoc
editor: ''
ms.assetid: ''
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/29/2018
ms.author: kumud
ms.openlocfilehash: f5d46fda6bdb32c1a5000883c6aedb2da15e796a
ms.sourcegitcommit: 20d103fb8658b29b48115782fe01f76239b240aa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2018
ms.locfileid: "30322800"
---
# <a name="standard-load-balancer-and-availability-zones"></a>Azure Load Balancer уровня "Стандартный" и зоны доступности

Номер SKU уровня "Стандартный" Azure Load Balancer поддерживает сценарии [зон доступности](../availability-zones/az-overview.md). В Load Balancer уровня "Стандартный" внедрены несколько новых концепций, позволяющих оптимизировать доступность в комплексном сценарии путем выравнивания ресурсов с зонами, а также распределения их между зонами.  См. статью [Общие сведения о зонах доступности в Azure (предварительная версия)](../availability-zones/az-overview.md), чтобы узнать о том, что такое зоны доступности, какие регионы сейчас поддерживают зоны доступности, а также о других связанных понятиях и продуктах. Зоны доступности в сочетании с Load Balancer уровня "Стандартный" — это обширный и универсальный набор функций, с помощью которого можно создавать множество различных сценариев.  Просмотрите этот документ, чтобы получить представление об этих [понятиях](#concepts) и [руководство по разработке](#design) основного сценария.

>[!NOTE]
>Похожие темы рассматриваются в статье [Зоны доступности Azure](https://aka.ms/availabilityzones). 

## <a name="concepts"></a> Концепции зон доступности, применимые к Load Balancer

Между ресурсами Load Balancer и фактической инфраструктурой нет прямой связи. При создании Load Balancer экземпляр не создается. Ресурсы Load Balancer представляют собой объекты, в которых можно выразить, как служба Azure должна запрограммировать свою готовую мультитенантную инфраструктуру, чтобы получить сценарий, который вы хотите создать.  Это важно в контексте зон доступности, так как один ресурс Load Balancer может управлять программированием инфраструктуры в нескольких зонах доступности, в то время как служба, избыточная в пределах зоны, представляет собой один ресурс с точки зрения клиента.

Функции ресурса Load Balancer выражаются в виде внешнего интерфейса, правила, проверки работоспособности и определения внутреннего пула.

В контексте зон доступности поведение и свойства ресурса Load Balancer описываются как избыточные в пределах зоны или зональные.  Избыточные в пределах зоны и зональные описывают зональность свойства.  В контексте Load Balancer избыточное в пределах зоны всегда означает *все зоны*, а зональное означает обеспечение работы службы в *одной зоне*.

Как внешний, так и внутренний Load Balancer поддерживают избыточные в пределах зоны и зональные сценарии и могут направлять трафик в различных зонах при необходимости (*распределение нагрузки между зонами*).

Ресурс Load Balancer сам по себе является региональным и никогда не бывает зональным.  И виртуальная сеть, и подсеть всегда являются региональными и никогда не бывают зональными.

### <a name="frontend"></a>Внешний интерфейс

Внешний интерфейс Load Balancer — это внешняя IP-конфигурация, ссылающаяся на открытый ресурс IP-адреса или частный IP-адрес в подсети ресурса виртуальной сети.  Он формирует конечную точку с балансировкой нагрузки, где предоставляется ваша служба.

Ресурс Load Balancer может одновременно содержать зональные и избыточные в пределах зоны внешние интерфейсы. 

Когда открытый ресурс IP-адреса предоставляется зоне, зональность (или ее отсутствие) является неизменяемой.  Если вы хотите изменить или опустить зональность внешнего интерфейса общедоступного IP-адреса, необходимо повторно создать общедоступный IP-адрес в соответствующей зоне.  

Зональность внешнего интерфейса внутреннего Load Balancer можно изменить путем удаления и повторного создания внешнего интерфейса, изменения или опущения зональности.

Если используется несколько внешних интерфейсов, см. важные сведения в [этой статье](load-balancer-multivip-overview.md).

#### <a name="zone-redundant-by-default"></a>Избыточность в пределах зоны по умолчанию

В регионе с зонами доступности внешний интерфейс Load Balancer уровня "Стандартный" является избыточным в пределах зоны по умолчанию.  Один IP-адрес внешнего интерфейса может продолжать работу в случае сбоя зоны и может использоваться для достижения всех элементов внутреннего пула независимо от зоны. Это не означает, что путь к данным будет без помех, но все повторные попытки или повторная установка подключения будут выполняться успешно. Схемы избыточности DNS не являются обязательными. Один IP-адрес внешнего интерфейса одновременно обслуживается развертываниями независимой инфраструктуры в каждой зоне доступности.  Избыточное в пределах зоны означает, что все входящие или исходящие потоки обслуживаются всеми зонами доступности в регионе одновременно с использованием одного IP-адреса.

В одной или нескольких зонах доступности может произойти сбой, и путь к данным выдерживает его, пока одна зона в регионе остается работоспособной. Конфигурация, избыточная в пределах зоны, используется по умолчанию и не требует никаких дополнительных действий.  Когда регион получит возможность поддерживать зоны доступности, имеющийся внешний интерфейс автоматически становится избыточным в пределах зоны.

Создайте общедоступный IP-адрес, избыточный в пределах зоны, для внутреннего Load Balancer уровня "Стандартный", используя следующий скрипт. Если вы используете существующие шаблоны Resource Manager в конфигурации, добавьте раздел **sku** в эти шаблоны.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "public_ip_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
```

Создайте IP-адрес внешнего интерфейса, избыточного в пределах зоны, для внутреннего Load Balancer уровня "Стандартный", используя следующий скрипт. Если вы используете существующие шаблоны Resource Manager в конфигурации, добавьте раздел **sku** в эти шаблоны.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/loadBalancers",
            "name": "load_balancer_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
            "properties": {
                "frontendIPConfigurations": [
                    {
                        "name": "zone_redundant_frontend",
                        "properties": {
                            "subnet": {
                                "Id": "[variables('subnetRef')]"
                            },
                            "privateIPAddress": "10.0.0.6",
                            "privateIPAllocationMethod": "Static"
                        }
                    },
                ],
```

#### <a name="optional-zone-guarantee"></a>Гарантия дополнительной зоны

Вы можете гарантировать внешний интерфейс одной зоне, что называется *зональным внешним интерфейсом*.  Это означает, что любой входящий и исходящий поток обслуживается одной зоной в регионе.  Ваш внешний интерфейс разделяет работоспособность зоны.  На путь к данным не оказывают влияние сбои в зонах за исключением случаев, где это гарантировано. Зональные внешние интерфейсы можно использовать для предоставления IP-адреса каждой зоне доступности.  Кроме того, зональные внешние интерфейсы можно использовать напрямую или интегрировать их с продуктом балансировки нагрузки DNS, таким как [диспетчер трафика](../traffic-manager/traffic-manager-overview.md) (если внешний интерфейс состоит из общедоступных IP-адресов), и использовать одно DNS-имя, которое клиент разрешит в несколько зональных IP-адресов.  Их также можно использовать для предоставления каждой зоне конечных точек с балансировкой нагрузки, чтобы выполнять мониторинг каждой зоны по отдельности.  Если вы хотите использовать эти концепции совместно (избыточные в пределах зоны и зональные для одной и той же серверной части), см. [этот документ](/load-balancer-multivip-overview.md).

При использовании общедоступного внешнего интерфейса Load Balancer добавьте параметр *zones* в общедоступный IP-адрес, на который ссылается внешняя IP-конфигурация.  

При использовании внутреннего интерфейса Load Balancer добавьте параметр *zones* во внешнюю IP-конфигурацию внутреннего IP-адреса. Зональный внешний интерфейс приводит к тому, что Load Balancer гарантирует IP-адрес в подсети для конкретной зоны.

Создайте зональный общедоступный IP-адрес уровня "Стандартный" в зоне доступности 1, используя приведенный ниже скрипт. Если вы используете существующие шаблоны Resource Manager в конфигурации, добавьте раздел **sku** в эти шаблоны.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "public_ip_standard",
            "location": "region",
            "zones": [ "1" ],
            "sku":
            {
                "name": "Standard"
            },
```

Создайте внешний интерфейс внутреннего Load Balancer уровня "Стандартный" в зоне доступности 1, используя приведенный ниже скрипт.

Если вы используете существующие шаблоны Resource Manager в конфигурации, добавьте раздел **sku** в эти шаблоны. Кроме того, задайте свойство **zones** в IP-конфигурации внешнего интерфейса дочернего ресурса.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/loadBalancers",
            "name": "load_balancer_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
            "properties": {
                "frontendIPConfigurations": [
                    {
                        "name": "zonal_frontend_in_az1",
                        "zones": [ "1" ],
                        "properties": {
                            "subnet": {
                                "Id": "[variables('subnetRef')]"
                            },
                            "privateIPAddress": "10.0.0.6",
                            "privateIPAllocationMethod": "Static"
                        }
                    },
                ],
```

### <a name="cross-zone-load-balancing"></a>Распределение нагрузки между зонами

Распределение нагрузки между зонами — это возможность Load Balancer достичь конечной точки серверной части в любой из зон. Она не зависит от внешнего интерфейса и его зональности.

Если нужно выровнять и гарантировать развертывание с единой зоной, выровняйте ресурсы зонального внешнего интерфейса и зональной серверной части для одной и той же зоны. Никаких действий от пользователя не требуется.

### <a name="backend"></a>Серверная часть

Load Balancer работает с виртуальными машинами.  Любая виртуальная машина в одной виртуальной сети может быть частью внутреннего пула независимо от того, гарантирована ли она зоне и какой зоне она гарантирована.

Если вы хотите выровнять и гарантировать свой внешний интерфейс и серверную часть с одной зоной, просто поместите виртуальные машины в одной и той же зоне в соответствующем внутреннем пуле.

Если вы хотите обратить виртуальные машины в нескольких зонах, просто поместите виртуальные машины из нескольких зон в один и тот же внутренний пул.  При использовании наборов для масштабирования виртуальных машин можно поместить один или несколько этих наборов в один и тот же внутренний пул.  И каждый из этих наборов для масштабирования виртуальных машин может находиться в одной или нескольких зонах.

### <a name="outbound-connections"></a>Исходящие подключения

[Исходящие подключения](load-balancer-outbound-connections.md) обслуживаются всеми зонами и автоматически являются избыточными в пределах зоны в регионе с зонами доступности, если виртуальная машина связана с общедоступным Load Balancer и избыточным в пределах зоны внешним интерфейсом.  Распределения портов SNAT исходящего подключения выдерживают сбои зоны.  

В свою очередь, если виртуальная машина связана с общедоступным Load Balancer и зональным внешним интерфейсом, исходящие подключения гарантированно обслуживаются одной зоной.  Исходящие подключения разделяют работоспособность соответствующей зоны.

Предварительное распределение портов SNAT и алгоритм остаются неизменными вне зависимости от использования зон.

### <a name="health-probes"></a>Пробы работоспособности.

Ваши имеющиеся определения проверки работоспособности остаются неизменными без использования зон доступности.  Но мы развернули модель работоспособности на уровне инфраструктуры. 

При использовании внешних интерфейсов, избыточных в пределах зоны, Load Balancer развертывает свою внутреннюю модель работоспособности, чтобы независимо проверить достижимость виртуальной машины из каждой зоны доступности, а также завершить работу путей между зонами, в которых, возможно, произошел сбой без вмешательства пользователей.  Если заданный путь не доступен из инфраструктуры Load Balancer одной зоны в виртуальную машину в другой зоне, Load Balancer может обнаружить этот сбой и избежать его. Другие зоны, которые могут достичь этой виртуальной машины, могут продолжать обслуживать виртуальную машину из своих соответствующих внешних интерфейсов.  Поэтому во время сбоев в каждой зоне могут быть немного отличающиеся распределения потоков при защите общей работоспособности вашей комплексной службы.

## <a name="design"></a> Рекомендации по проектированию

Load Balancer является универсальным в контексте зон доступности. Вы можете выровнять зоны или избрать избыточность в пределах зоны.  Повышение доступности достигается за счет возрастающей сложности. Вам необходимо выполнять проектирование для обеспечения доступности оптимальной производительности.  Давайте рассмотрим некоторые важные рекомендации по проектированию.

### <a name="automatic-zone-redundancy"></a>Автоматическая избыточность в пределах зоны

С помощью Load Balancer можно использовать всего один IP-адрес в качестве внешнего интерфейса, избыточного в пределах зоны. Избыточный в пределах зоны IP-адрес может безопасно обслуживать зональный ресурс в любой из зон и выдерживает один или несколько сбоев зоны, пока одна зона остается работоспособной внутри региона. И наоборот, зональный внешний интерфейс является уменьшением службы в единую зону и разделяет участь соответствующей зоны.

Избыточность зон не подразумевает отсутствие помех в пути к данным или плоскости управления. Это явно плоскость данных. Избыточные в пределах зоны потоки могут использовать любые зоны, а потоки клиента будут использовать все работоспособные зоны в регионе. В случае сбоя зоны потоки трафика, поступающие с помощью работоспособных зон на тот момент времени, не затрагиваются.  Потоки трафика, поступающие из зоны на момент сбоя зоны, могут быть затронуты, но приложения могут восстанавливаться и эти потоки могут возобновляться в оставшихся работоспособных зонах в пределах региона при повторной передаче или установке подключения, как только Azure сосредоточится вокруг зоны сбоя.

### <a name="xzonedesign"></a> Границы между зонами

Важно понимать, что каждый раз, когда комплексная служба пересекает границу зоны, вы разделяете участь не одной зоны, а потенциально нескольких зон.  В результате комплексная служба может быть недоступной в незональных развертываниях.

Избегайте случайного добавления зависимостей между зонами, которые аннулируют повышение доступности при использовании зон доступности.  Если ваше приложение состоит из нескольких компонентов и вы хотите быть устойчивым к сбоям зоны, необходимо обеспечить стойкость достаточного количества важных компонентов в случае сбоя зоны.  Например, один критически важный компонент для вашего приложения может повлиять на все приложение, если он просто находится в зоне, которая не выдерживает сбоев.  Кроме того, также рассмотрите возможность восстановления зоны и каким образом ваше приложение будет объединяться. Давайте рассмотрим некоторые ключевые моменты, которые вы можете использовать для поиска вопросов о вашем конкретном сценарии.

- Если приложение состоит из двух компонентов, таких как IP-адрес и виртуальная машина с управляемым диском, и они гарантированы в зоне 1 и зоне 2, при сбое в зоне 1 ваша комплексная служба не выдержит сбоя в зоне 1.  Не нарушайте границы зоны, если вы не до конца понимаете, что создаете опасный режим сбоя.

- Если приложение состоит из двух компонентов, таких как IP-адрес и виртуальная машина с управляемым диском, и они гарантированно будут избыточными в пределах зоны и зоне 1 соответственно, ваша комплексная служба будет выдерживать сбой зоны 2, зоны 3 или обоих зон, если не произошел сбой зоны 1.  Тем не менее вы не сможете узнать о работоспособности службы, если наблюдаете только за достижимостью внешнего интерфейса.  Рассмотрите возможность разработки более сложной модели работоспособности и производительности.  Возможно, вы сможете использовать концепции избыточности в пределах зоны и зональности совместно, чтобы получить больше информации и расширить возможности управляемости.

- Если приложение состоит из двух компонентов, таких как внешний интерфейс Load Balancer, избыточный в пределах зоны, и набор для масштабирования виртуальных машин между зонами в трех зонах, ваши ресурсы в зонах, которые не подвержены влиянию сбоя, будут доступны, но производительность вашей комплексной службы может снизиться во время сбоя зоны. С точки зрения инфраструктуры ваше развертывание может выдержать один или несколько сбоев зоны, и в результате этого возникают следующие вопросы:
  - Понимаете ли вы, каким образом приложение получает сведения о таких сбоях и сниженной производительности?
  - Необходимо ли вам принять меры безопасности в службе, чтобы принудительно выполнить отработку отказа в пару регионов при необходимости?
  - Каким образом вы будете отслеживать, обнаруживать и избегать такую ситуацию? Возможно, вы сможете расширить возможности мониторинга производительности вашей комплексной службы с помощью диагностики Load Balancer уровня "Стандартный". Выясните, что доступно, а также что может потребоваться расширить для получения полного представления.

- Зоны помогут упростить распознавание сбоев.  Тем не менее сбой зоны не отличается от других сбоев, когда дело доходит до основных понятий, таких как истечение времени ожидания, повторные попытки и алгоритмы отсрочки. Несмотря на то, что Azure Load Balancer предоставляет пути, избыточные в пределах зоны, и пытается выполнить восстановление быстро на уровне пакетов в реальном времени, в начале сбоя могут возникнуть повторные передачи или повторные установки подключения, и важно понимать, каким образом приложение справляется со сбоями. Схема балансировки нагрузки выдержит сбой, но необходимо оценить следующее:
  - При сбое зоны распознает ли его комплексная служба и каким образом вы выполните восстановление в случае утери сведений о состоянии?
  - При возврате из зоны понимает ли приложение, как безопасно выполнить объединение?

### <a name="zonalityguidance"></a> Избыточность в пределах зоны и зональность

Избыточность в пределах зоны обеспечивает независимость от зоны и в то же время параметр устойчивости с одним IP-адресом для службы.  Это в свою очередь может упростить работу.  Избыточность в пределах зоны также предусматривает мобильность между зонами, а также может безопасно использоваться с ресурсами в любой зоне.  Кроме того, она не потеряет актуальности со временем в регионах без зон доступности, что может ограничить изменения, необходимые после того, как регион получит зоны доступности.  Синтаксис конфигурации для IP-адреса, избыточного в пределах зоны, или внешнего интерфейса выполняется успешно в любом регионе, включая регионы без зон доступности.

Зональность может обеспечить явные гарантии в зону, разделяя состояние работоспособности зоны. Связывание зонального IP-адреса или зонального внешнего интерфейса Load Balancer может быть необходимым или целесообразным атрибутом, особенно если вложенный ресурс является зональной виртуальной машиной в одной и той же зоне.  Или, возможно, вашему приложению требуются явные сведения о зоне, в которой находится ресурс, и вы хотите явно узнать о доступности в отдельных зонах.  Вы можете предоставить несколько зональных внешних интерфейсов для комплексной службы, распределенных между зонами (то есть, зональные внешние интерфейсы на зону для нескольких зональных наборов для масштабирования виртуальных машин).  И если ваши зональные внешние интерфейсы являются общедоступными IP-адресами, несколько этих внешних интерфейсов можно использовать, чтобы предоставить службе [диспетчер трафика](../traffic-manager/traffic-manager-overview.md).  Или можно использовать несколько зональных внешних интерфейсов для получения сведений о работоспособности и производительности каждой зоны с помощью решений мониторинга сторонних производителей и предоставить полную службу с внешним интерфейсом, избыточным в пределах зоны. Необходимо только обслуживать зональные ресурсы с помощью зональных внешних интерфейсов, выровненных с той же зоной, и избегать потенциально опасных сценариев работы между зонами для зональных ресурсов.  Зональные ресурсы существуют только в регионах, где существуют зоны доступности.

Не зная архитектуры службы, невозможно определить, какая рекомендация является наиболее предпочтительной.

## <a name="limitations"></a>Ограничения

- Хотя плоскость данных является полностью избыточной в пределах зоны (если не указана зональная гарантия), операции плоскости управления не являются полностью избыточными в пределах зоны.

## <a name="next-steps"></a>Дополнительная информация
- Узнайте о [зонах доступности](../availability-zones/az-overview.md)
- Узнайте больше об [Azure Load Balancer уровня "Стандартный"](load-balancer-standard-overview.md).
- Узнайте, как [распределять нагрузку виртуальных машин в рамках зоны с помощью Load Balancer уровня "Стандартный" с зональным внешним интерфейсом](load-balancer-standard-public-zonal-cli.md).
- Узнайте, как [распределять нагрузку виртуальных машин по зонам с помощью Load Balancer уровня "Стандартный" с избыточным в пределах зоны интерфейсным сервером](load-balancer-standard-public-zone-redundant-cli.md).
