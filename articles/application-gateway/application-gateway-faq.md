---
title: Часто задаваемые вопросы о шлюзе приложений Azure
description: На этой странице содержатся ответы на часто задаваемые вопросы о шлюзе приложений Azure
services: application-gateway
author: vhorne
manager: jpconnock
ms.service: application-gateway
ms.topic: article
ms.workload: infrastructure-services
ms.date: 3/29/2018
ms.author: victorh
ms.openlocfilehash: d5861df9dbfe554f966d19a8e3ed77b55f1f2cd2
ms.sourcegitcommit: b6319f1a87d9316122f96769aab0d92b46a6879a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2018
ms.locfileid: "34355854"
---
# <a name="frequently-asked-questions-for-application-gateway"></a>Часто задаваемые вопросы о шлюзе приложений

## <a name="general"></a>Общие сведения

**В. Что такое шлюз приложений?**

Шлюз приложений Azure является контроллером доставки приложений (ADC) как услуг, предлагающих для приложений разные функции балансировки нагрузки уровня 7. Это высокодоступная и масштабируемая служба, которая полностью управляется Azure.

**В. Какие функции поддерживает шлюз приложений?**

Шлюз приложений поддерживает разгрузку SSL и сквозной режим связи SSL, брандмауэр веб-приложения, сопоставление сеансов на основе файлов cookie, маршрутизацию на основе URL-пути, размещение нескольких сайтов и другие функции. Полный список поддерживаемых функций см. в статье [Обзор шлюза приложений](application-gateway-introduction.md).

**В. Какова разница между шлюзом приложений и Azure Load Balancer?**

Шлюз приложений — балансировщик нагрузки уровня 7. Это означает, что он работает только с веб-трафиком (HTTP, HTTPS и WebSocket). Он поддерживает такие функции, как завершение SSL-подключений, сопоставление сеансов на основе файлов cookie и циклический перебор для распределения нагрузки трафика. С балансировщиком нагрузки доступна балансировка трафика уровня 4 (протоколы TCP и UDP).

**В. Какие протоколы поддерживает шлюз приложений?**

Шлюз приложений поддерживает протоколы HTTP, HTTPS, HTTP/2 и WebSocket.

**В. Как шлюз приложений поддерживает протокол HTTP/2?**

Поддержка протокола HTTP/2 доступна только для клиентов, подключающихся к прослушивателям шлюза приложений. Подключение к внутренним пулам серверов осуществляется по протоколу HTTP/1.1. 

Поддержка HTTP/2 отключена по умолчанию. В следующем фрагменте кода Azure PowerShell показано, как его включить.

```
$gw = Get-AzureRmApplicationGateway -Name test -ResourceGroupName hm
$gw.EnableHttp2 = $true
Set-AzureRmApplicationGateway -ApplicationGateway $gw
```

**В. Какие ресурсы в настоящее время поддерживаются как часть серверного пула?**

Внутренние пулы могут состоять из сетевых адаптеров, масштабируемых наборов виртуальных машин, общедоступных IP-адресов, внутренних IP-адресов, полных доменных имен и таких мультитенантых серверных частей, как веб-приложения Azure. Участники серверного пула шлюза приложений не привязаны к группе доступности. Они могут располагаться в кластерах, центрах обработки данных или за пределами портала Azure, пока у них есть возможность подключения по IP.

**В. В каких регионах доступна служба?**

Шлюз приложений доступен во всех регионах глобальной платформы Azure. Он также доступен в [Azure для Китая](https://www.azure.cn/) и [Azure для государственных организаций](https://azure.microsoft.com/overview/clouds/government/).

**В. Это специальное развертывание для подписки или общее для всех клиентов?**

Шлюз приложений — это специальное развертывание в вашей виртуальной сети.

**В. Поддерживается ли перенаправление протоколов HTTP -> HTTPS?**

Перенаправление поддерживается. Дополнительные сведения см. в статье [Общие сведения о перенаправлении для шлюза приложений](application-gateway-redirect-overview.md).

**В. В каком порядке обрабатываются прослушиватели?**

Прослушиватели обрабатываются в том порядке, в котором они указаны. Поэтому если основной прослушиватель соответствует поступившему запросу, он обработает этот запрос первым.  Чтобы обеспечить маршрутизацию трафика в соответствующую внутреннюю службу, многосайтовые прослушиватели следует настроить до основного прослушивателя.

**В. Где найти IP-адрес и DNS-имя шлюза приложений?**

При использовании общедоступного IP-адреса в качестве конечной точки эти сведения вы можете найти в ресурсах общедоступного IP-адреса или на странице обзора для шлюза приложений на портале. Для внутренних IP-адресов эту информацию можно найти на странице обзора.

**В. Меняются ли IP-адрес и DNS-имя в течение времени существования шлюза приложений?**

Виртуальный IP-адрес может измениться, если шлюз приложений остановлен и запущен клиентом. DNS-имя, связанное со шлюзом приложений, не меняется никогда. По этой причине мы рекомендуем использовать псевдоним CNAME и настроить его для DNS-адреса шлюза приложений.

**В. Поддерживает ли шлюз приложений статические IP-адреса?**

Нет, шлюз приложений не поддерживает статические общедоступные IP-адреса, но поддерживает статические внутренние.

**В. Поддерживает ли шлюз приложений несколько общедоступных IP-адресов в шлюзе?**

Шлюз приложений поддерживает только один общедоступный IP-адрес.

**В. Поддерживает ли шлюз приложений заголовки X-Forwarded-For?**

Да, шлюз приложений поддерживает заголовки X-Forwarded-For, X-Forwarded-Proto и X-Forwarded-Port в запросах, направленных к внутренней службе. Формат заголовка X-Forwarded-For представляет собой разделенный запятыми список вида "IP-адрес:порт". Допустимые значения для заголовка X-Forwarded-Proto — HTTP или HTTPS. Заголовок X-Forwarded-Port указывает порт, в котором запрос достигает шлюза приложений.

**В. Сколько времени требуется для развертывания шлюза приложений? Работает ли шлюз приложений во время обновления?**

Подготовка новых развертываний шлюза приложений может занять до 20 минут. Изменения в размере или числе экземпляров не нарушают работу шлюза приложений, он остается активным во время обновления.

## <a name="configuration"></a>Параметр Configuration

**В. Всегда ли шлюз приложений развертывается в виртуальной сети?**

Да, шлюз приложений всегда развертывается в подсети виртуальной сети. Эта подсеть может содержать только шлюзы приложений.

**В. Может ли шлюз приложений взаимодействовать с экземплярами за пределами виртуальной сети?**

Шлюз приложений может взаимодействовать с экземплярами за пределами виртуальной сети, к которой он относится, при наличии подключения по IP. Если вы планируете использовать внутренние IP-адреса в качестве участников серверного пула, потребуется [пиринговая связь между виртуальными сетями](../virtual-network/virtual-network-peering-overview.md) или [VPN-шлюз](../vpn-gateway/vpn-gateway-about-vpngateways.md).

**В. Можно ли еще что-нибудь развернуть в подсети шлюза приложений?**

Нет, но вы можете развернуть другие шлюзы приложений в подсети.

**В. Поддерживаются ли группы безопасности сети в подсети шлюза приложений?**

Группы безопасности сети поддерживаются подсетью шлюза приложений со следующими ограничениями:

* Для портов 65503–65534 должны быть размещены исключения, чтобы внутренние службы работали правильно.

* Исходящее подключение к Интернету не может быть заблокировано.

* Трафик из тега AzureLoadBalancer должен быть разрешен.

**В. Какие у шлюза приложений ограничения? Можно ли увеличить эти ограничения?**

Сведения об ограничениях см. в разделе [Ограничения шлюза приложений](../azure-subscription-service-limits.md#application-gateway-limits).

**В. Можно ли использовать шлюз приложений одновременно для внешнего и внутреннего трафика?**

Да, каждый шлюз приложений может иметь один внутренний IP-адрес и один внешний.

**В. Поддерживается ли пиринговая связь между виртуальными сетями?**

Да, поддерживается, что положительно сказывается на балансировке трафика в других виртуальных сетях.

**В. Можно ли взаимодействовать с локальными серверами, если они подключены через туннели ExpressRoute или VPN?**

Да, при условии, что разрешен трафик.

**В. Может ли один серверный пул обслуживать несколько приложений, используя разные порты?**

Поддерживается архитектура микрослужб. Вам потребуется настроить несколько параметров HTTP для проверки различных портов.

**В. Поддерживают ли пользовательские пробы подстановочные знаки или регулярные выражения в данных ответа?**

Нет, не поддерживают. 

**В. Как обрабатываются правила?**

Правила обрабатываются в том порядке, в котором они были настроены. Многосайтовые правила рекомендуется настраивать до основных правил, чтобы снизить вероятность маршрутизации трафика в неправильную внутреннюю службу, так как основное правило будет сопоставляться с трафиком в соответствии с портом до оценки многосайтового правила.

**В. Что означает поле "Узел" для пользовательских проб?**

Это поле указывает имя узла, куда необходимо отправить пробу. Применяется только в случае, когда в шлюзе приложений настроено многосайтовое подключение. В противном случае используется значение 127.0.0.1. Это значение отличается от имени узла виртуальной машины и имеет следующий формат: \<протокол\>://\<узел\>:\<порт\>\<путь\>.

**В. Можно ли добавить в список разрешений доступ шлюза приложений к нескольким исходным IP-адресам?**

Это можно сделать с помощью групп безопасности сети в подсети шлюза приложений. Следующие ограничения должны быть установлены для подсети в указанном порядке приоритета:

* Разрешить входящий трафик из исходного IP-адреса или диапазона IP-адресов.

* Разрешить входящие запросы от всех источников на порты 65503–65534 для [просмотра работоспособности серверной части ](application-gateway-diagnostics.md).

* Разрешить пробы Azure Load Balancer (тег AzureLoadBalancer) и входящего виртуального сетевого трафика (тег VirtualNetwork) в [группах безопасности сети](../virtual-network/security-overview.md).

* Запретить весь другой входящий трафик с помощью правила, запрещающего любой трафик.

* Разрешить исходящий трафик в Интернет для всех назначений.

## <a name="performance"></a>Производительность

**В. Каким образом шлюз приложений поддерживает высокий уровень доступности и масштабируемость?**

Если развернуто два или больше экземпляров, шлюз приложений поддерживает сценарии обеспечения высокой доступности. Azure распределяет эти экземпляры по доменам сбоя и обновления, чтобы гарантировать, что все экземпляры не завершатся ошибкой в одно и то же время. Шлюз приложений поддерживает масштабируемость путем добавления нескольких экземпляров одного шлюза для распределения нагрузки.

**В. Как добиться сценария аварийного восстановления в центрах обработки данных с помощью шлюза приложений?**

Клиенты могут использовать диспетчер трафика для распределения трафика между несколькими шлюзами приложений в разных центрах обработки данных.

**В. Поддерживается ли автоматическое масштабирование?**

Нет, не поддерживается, но есть метрика пропускной способности, используемая для оповещений при достижении порогового значения. При добавлении экземпляров или изменении размеров вручную шлюз не перезапускается, и это не влияет на существующий трафик.

**В. Вызывает ли увеличение или уменьшение масштабирования, выполненное вручную, простой?**

Нет, не вызывает. Экземпляры распределяются по доменам сбоя и обновления.

**В. Поддерживает ли шлюз приложений фильтрацию подключений?**

Да. Вы можете настроить фильтрацию подключений, чтобы изменить участников во внутреннем пуле без прерывания. Это позволит обеспечить передачу данных по имеющимся подключениям в предыдущий пункт назначения, пока подключение не будет закрыто или не истечет настроенное время ожидания. Обратите внимание, этот фильтр подключений ожидает завершения только текущих активных соединений. Шлюз приложений не учитывает состояние сеанса приложения.


**В. Можно ли изменить размер экземпляра со среднего на большой без прерывания?**

Да, можно. Azure распределяет экземпляры по доменам сбоя и обновления, чтобы гарантировать, что все экземпляры не завершатся ошибкой в одно и то же время. Шлюз приложений поддерживает масштабирование путем добавления нескольких экземпляров одного шлюза для распределения нагрузки.

## <a name="ssl-configuration"></a>Настройка SSL

**В. Какие сертификаты поддерживает шлюз приложений?**

Поддерживаются самозаверяющие сертификаты, сертификаты ЦС и групповые. Сертификаты высокой надежности не поддерживаются.

**В. Какие текущие комплекты шифров поддерживает шлюз приложений?**

Ниже представлены текущие комплекты шифров, поддерживаемые шлюзом приложений. Дополнительные сведения о настройке параметров SSL см. в статье [Настройка версий политики SSL и комплектов шифров на шлюзе приложений](application-gateway-configure-ssl-policy-powershell.md).

- TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
- TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
- TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384
- TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256
- TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA
- TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA
- TLS_DHE_RSA_WITH_AES_256_GCM_SHA384
- TLS_DHE_RSA_WITH_AES_128_GCM_SHA256
- TLS_DHE_RSA_WITH_AES_256_CBC_SHA
- TLS_DHE_RSA_WITH_AES_128_CBC_SHA
- TLS_RSA_WITH_AES_256_GCM_SHA384
- TLS_RSA_WITH_AES_128_GCM_SHA256
- TLS_RSA_WITH_AES_256_CBC_SHA256
- TLS_RSA_WITH_AES_128_CBC_SHA256
- TLS_RSA_WITH_AES_256_CBC_SHA
- TLS_RSA_WITH_AES_128_CBC_SHA
- TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
- TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
- TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384
- TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256
- TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA
- TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA
- TLS_DHE_DSS_WITH_AES_256_CBC_SHA256
- TLS_DHE_DSS_WITH_AES_128_CBC_SHA256
- TLS_DHE_DSS_WITH_AES_256_CBC_SHA
- TLS_DHE_DSS_WITH_AES_128_CBC_SHA
- TLS_RSA_WITH_3DES_EDE_CBC_SHA
- TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA

**В. Поддерживает ли также шлюз приложений повторное шифрование трафика к внутренней службе?**

Да, шлюз поддерживает разгрузку SSL и сквозной режим связи SSL, повторно шифрующие трафик к внутренней службе.

**В. Можно ли настроить политику SSL для контроля версий протокола SSL?**

Да, вы можете настроить шлюз приложений, чтобы запретить версии TLS 1.0, TLS 1.1 и TLS 1.2. Протоколы SSL версий 2.0 и 3.0 уже отключены по умолчанию, и их настройки нельзя изменить.

**В. Можно ли настроить комплекты шифров и порядок политик?**

Да, имеется возможность [настроить комплекты шифров](application-gateway-ssl-policy-overview.md). При определении пользовательской политики необходимо включить хотя бы один из следующих комплектов шифров. Шлюз приложений использует SHA256 для управления серверной частью.

* TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 
* TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256
* TLS_DHE_RSA_WITH_AES_128_GCM_SHA256
* TLS_RSA_WITH_AES_128_GCM_SHA256
* TLS_RSA_WITH_AES_256_CBC_SHA256
* TLS_RSA_WITH_AES_128_CBC_SHA256

**В. Какое количество SSL-сертификатов поддерживается?**

Поддерживается до 20 сертификатов.

**В. Сколько сертификатов проверки подлинности поддерживается для повторного шифрования внутренней службы?**

Поддерживается до 10 сертификатов. По умолчанию — 5.

**В. Интегрируется ли шлюз приложений с Azure Key Vault изначально?**

Нет, он не интегрируется с этим хранилищем.

## <a name="web-application-firewall-waf-configuration"></a>Настройка брандмауэра веб-приложения (WAF)

**В. Доступны ли функции SKU категории "Стандартный" в SKU WAF?**

Да, доступны.

**В. Какую версию CRS поддерживает шлюз приложений?**

Шлюз приложений поддерживает [2.2.9](application-gateway-crs-rulegroups-rules.md#owasp229) и CRS [3.0](application-gateway-crs-rulegroups-rules.md#owasp30).

**В. Как отслеживать WAF?**

WAF отслеживается с помощью журнала ведения диагностики. Дополнительные сведения см. в статье [Мониторинг работоспособности серверной части, ведение журнала диагностики и метрики для шлюза приложений](application-gateway-diagnostics.md).

**В. Блокирует ли трафик режим обнаружения?**

Нет, режим обнаружения только регистрирует трафик, активирующий правило WAF.

**В. Как настроить правила WAF?**

Да, правила WAF можно настраивать. Дополнительные сведения об этом см. в статье [Настройка правил брандмауэра веб-приложения на портале](application-gateway-customize-waf-rules-portal.md).

**В. Какие правила на сегодняшний день доступны?**

В настоящее время WAF поддерживает CRS версий [2.2.9](application-gateway-crs-rulegroups-rules.md#owasp229) и [3.0](application-gateway-crs-rulegroups-rules.md#owasp30), что обеспечивает базовую защиту от наиболее важных уязвимостей, определенных открытым проектом безопасности веб-приложений (OWASP). Список 10 распространенных уязвимостей доступен [здесь](https://www.owasp.org/index.php/Top10#OWASP_Top_10_for_2013).

* Защита от внедрения кода SQL.

* Защита от межсайтовых сценариев.

* Защита от распространенных сетевых атак, в том числе от внедрения команд, несанкционированных HTTP-запросов, разделения HTTP-запросов и атак с включением удаленного файла.

* Защита от нарушений протокола HTTP.

* Защита от аномалий протокола HTTP, например отсутствия агента пользователя узла и заголовков accept.

* Защита от программ-роботов, программ-обходчиков и сканеров.

 * Обнаружение распространенных неправильных конфигураций приложений (Apache, IIS и т. д.).

**В. Поддерживает ли WAF также защиту от атак DDoS?**

Нет, не поддерживает.

## <a name="diagnostics-and-logging"></a>Диагностика и ведение журнала

**В. Какие типы журналов доступны для шлюза приложений?**

Для шлюза приложений доступны три журнала. Дополнительные сведения о журналах и других диагностических возможностях см. в статье [Мониторинг работоспособности серверной части, ведение журнала диагностики и метрики для шлюза приложений](application-gateway-diagnostics.md).

- **ApplicationGatewayAccessLog**. В журнале доступа содержится каждый запрос, переданный во внешний интерфейс шлюза приложений. Здесь указаны такие данные, как IP-адрес вызывающего объекта, запрашиваемый URL-адрес, задержка ответа, код возврата, входящие и исходящие байты. Данные для журнала доступа собираются каждые 300 секунд. Этот журнал содержит одну запись для каждого экземпляра шлюза приложений.
- **ApplicationGatewayPerformanceLog**. В журнал производительности записываются сведения о производительности каждого экземпляра, включая общее число обработанных запросов, пропускную способность в байтах, число неудачных запросов, а также число работоспособных и неработоспособных серверных экземпляров.
- **ApplicationGatewayFirewallLog**. Журнал брандмауэра содержит запросы, которые были зарегистрированы в режиме обнаружения или предотвращения на шлюзе приложений, на котором настроен брандмауэр веб-приложения.

**В. Как узнать, работоспособны ли участники серверного пула?**

Вы можете использовать командлет PowerShell `Get-AzureRmApplicationGatewayBackendHealth` или проверить работоспособность через портал, ознакомившись со сведениями в статье [Мониторинг работоспособности серверной части, ведение журнала диагностики и метрики для шлюза приложений](application-gateway-diagnostics.md).

**В. Что такое политика хранения журналов диагностики?**

Журналы диагностики находятся в учетных записях хранения клиентов, и клиенты могут задать политику хранения в зависимости от своих предпочтений. Журналы диагностики также можно отправить в концентратор событий или службу Log Analytics. Дополнительные сведения см. в статье [Мониторинг работоспособности серверной части, ведение журнала диагностики и метрики для шлюза приложений](application-gateway-diagnostics.md).

**В. Как получить журналы аудита для шлюза приложений?**

Для шлюза приложений доступны журналы аудита. Чтобы перейти к такому журналу, на портале в колонке меню шлюза приложений щелкните **Журнал действий**. 

**В. Можно ли настроить оповещения с помощью шлюза приложений?**

Да, шлюз приложений поддерживает оповещения, которые настраиваются на основе метрик. На сегодняшний день у шлюза приложений есть метрика пропускной способности, для которой можно настроить оповещения. Дополнительные сведения об оповещениях см. в статье [Получение уведомлений об оповещениях](../monitoring-and-diagnostics/insights-receive-alert-notifications.md).

**В. Запрос работоспособности серверной части возвращает неизвестное состояние. Чем это может быть вызвано?**

Самая распространенная причина — доступ к внутренней службе заблокирован группой безопасности сети (NSG) или пользовательской службой DNS. Дополнительные сведения см. в статье [Мониторинг работоспособности серверной части, ведение журнала диагностики и метрики для шлюза приложений](application-gateway-diagnostics.md).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о шлюзе приложений см. в [этой статье](overview.md)
