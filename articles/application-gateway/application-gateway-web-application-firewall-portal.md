---
title: "Создание или обновление шлюза приложений с добавлением брандмауэра веб-приложения | Документация Майкрософт"
description: "Узнайте, как создать шлюз приложений с брандмауэром веб-приложения с помощью портала."
services: application-gateway
documentationcenter: na
author: davidmu1
manager: timlt
editor: tysonn
tags: azure-resource-manager
ms.assetid: b561a210-ed99-4ab4-be06-b49215e3255a
ms.service: application-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/03/2017
ms.author: davidmu
ms.openlocfilehash: bfc06c1b44974fd17a3794654503d21d6407a917
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="create-an-application-gateway-with-a-web-application-firewall-by-using-the-portal"></a>Создание шлюза приложений с брандмауэром веб-приложения с помощью портала

> [!div class="op_single_selector"]
> * [Портал Azure](application-gateway-web-application-firewall-portal.md)
> * [PowerShell](application-gateway-web-application-firewall-powershell.md)
> * [Интерфейс командной строки Azure](application-gateway-web-application-firewall-cli.md)

Узнайте, как создать шлюз приложений с брандмауэром веб-приложения (WAF),

WAF в шлюзе приложений Azure защищает веб-приложения от таких распространенных сетевых атак, как атаки путем внедрения кода SQL, атаки межсайтовых сценариев и захваты сеанса. WAF обеспечивает защиту от многих распространенных сетевых уязвимостей в рамках проекта OWASP.

## <a name="scenarios"></a>Сценарии

В этой статье представлены два сценария. В первом сценарии рассматривается [создание шлюза приложений с WAF](#create-an-application-gateway-with-web-application-firewall), а во втором — [добавление WAF в имеющийся шлюз приложений](#add-web-application-firewall-to-an-existing-application-gateway).

![Пример сценария][scenario]

> [!NOTE]
> В шлюз приложений можно добавить пользовательские пробы работоспособности, адреса внутренних пулов и дополнительные правила. Эти приложения настраиваются после настройки шлюза приложения, а не во время первоначального развертывания.

## <a name="before-you-begin"></a>Перед началом работы

 Шлюзу приложений требуется собственная подсеть. При создании виртуальной сети обязательно оставьте достаточно адресного пространства для нескольких подсетей. После развертывания шлюза приложений в подсети в нее можно добавлять только дополнительные шлюзы приложений.

## <a name="add-web-application-firewall-to-an-existing-application-gateway"></a>Добавление брандмауэра веб-приложения в имеющийся шлюз приложений

В этом примере имеющийся шлюз приложений обновляется для поддержки WAF, работающего в режиме **предотвращения**.

1. На портале Azure в области **Избранное** выберите **Все ресурсы**. Выберите имеющийся шлюз приложений в колонке **Все ресурсы**. Если выбранная подписка имеет несколько ресурсов, в поле **Filter by name** (Фильтровать по имени) введите имя, чтобы быстро получить доступ к необходимой зоне DNS.

   ![Выбор имеющегося шлюза приложений][1]

2. Щелкните **Брандмауэр веб-приложения** и обновите параметры шлюза приложений. После завершения обновления выберите **Сохранить**. 

3. Ниже перечислены параметры, позволяющие обновить имеющийся шлюз приложений для поддержки WAF.

   | **Параметр** | **Значение** | **Дополнительные сведения**
   |---|---|---|
   |**Обновление до уровня WAF**| Флажок установлен | Этот параметр задает для шлюза приложений уровень WAF.|
   |**Состояние брандмауэра**| Включено | Этот параметр включает для брандмауэра уровень WAF.|
   |**Режим брандмауэра** | Предотвращение | Этот параметр определяет способ обработки вредоносного трафика в WAF. В режиме **Обнаружение** события только регистрируются в журнале. В режиме **Предотвращение** события регистрируются в журнале, а также останавливается вредоносный трафик.|
   |**Набор правил**|3.0|Этот параметр определяет [основной набор правил](application-gateway-web-application-firewall-overview.md#core-rule-sets), используемый для защиты элементов внутреннего пула.|
   |**Настройка отключенных правил**|Varies|Чтобы предотвратить возможные ложные срабатывания, этот параметр позволяет отключить определенные [правила и группы правил](application-gateway-crs-rulegroups-rules.md).|

    >[!NOTE]
    > При обновлении имеющегося шлюза приложений до номера SKU WAF размер SKU изменяется на **Средний**. После завершения настройки этот параметр можно перенастроить.

    ![Основные параметры][2-1]

    > [!NOTE]
    > Чтобы просмотреть журналы WAF, включите диагностику и выберите **ApplicationGatewayFirewallLog**. Для числа экземпляров выберите значение **1**. Это касается только режима тестирования. Мы не советуем указывать для числа экземпляров значение **2**, так как развертывание не попадает под действие соглашения об уровне обслуживания. При использовании WAF шлюзы уровня "Мелкий" недоступны.

## <a name="create-an-application-gateway-with-a-web-application-firewall"></a>Создание шлюза приложений с брандмауэром веб-приложения

Вы узнаете:

* как создать средний шлюз приложений WAF с двумя экземплярами;
* как создать виртуальную сеть AdatumAppGatewayVNET с зарезервированным блоком CIDR (10.0.0.0/16);
* как создать подсеть с именем Appgatewaysubnet и блоком CIDR (10.0.0.0/28);
* как настроить сертификат для разгрузки SSL.

1. Выполните вход на [портал Azure](https://portal.azure.com). Если у вас нет учетной записи, вы можете зарегистрироваться для получения [бесплатной пробной версии на один месяц](https://azure.microsoft.com/free).

2. В области **Избранное** портала щелкните **Создать**.

3. В колонке **Создать** выберите **Сети**. В колонке **Сети** щелкните **Шлюз приложений**, как показано на следующем изображении.

    ![Создание шлюза приложений][1]

4. В открывшейся колонке **Основы** введите приведенные ниже значения и нажмите кнопку **ОК**.

   | **Параметр** | **Значение** | **Дополнительные сведения**
   |---|---|---|
   |**Имя**|AdatumAppGateway|Имя шлюза приложений.|
   |**Уровень**|WAF|Доступные значения: "Стандартный" или "WAF". Дополнительные сведения о WAF см. в статье [Брандмауэр веб-приложения (WAF)](application-gateway-web-application-firewall-overview.md).|
   |**Размер номера SKU**|Средний|При выборе уровня "Стандартный" можно задать **мелкий**, **средний** и **большой** размер. При выборе уровня WAF можно задать только **средний** или **большой** размер.|
   |**Число экземпляров**|2|Число экземпляров шлюза приложений для обеспечения высокого уровня доступности. Используйте число экземпляров, равное 1, только для тестирования.|
   |**Подписка**|[Ваша подписка]|Выберите подписку для создания шлюза приложений.|
   |**Группа ресурсов**|**Создать:** AdatumAppGatewayRG|Создайте группу ресурсов. Имя группы ресурсов должно быть уникальным в пределах выбранной подписки. Дополнительные сведения о группах ресурсов см. в разделе [Группы ресурсов](../azure-resource-manager/resource-group-overview.md?toc=%2fazure%2fapplication-gateway%2ftoc.json#resource-groups) статьи "Общие сведения об Azure Resource Manager".|
   |**Расположение**|Запад США||

   ![Настройка основных параметров][2-2]

5. В колонке **Параметры**, которая отображается под областью **Виртуальная сеть**, щелкните **Выберите виртуальную сеть**. В колонке **Выбрать виртуальную сеть** щелкните **Создать**.

   ![Выбор виртуальной сети][2]

6. В колонке **Create virtual network blade** (Создать виртуальную сеть) введите приведенные ниже значения и нажмите кнопку **ОК**. В поле **Подсеть** в колонке **Параметры** указывается выбранная подсеть.

   |**Параметр** | **Значение** | **Дополнительные сведения** |
   |---|---|---|
   |**Имя**|AdatumAppGatewayVNET|Имя шлюза приложений.|
   |**Пространство адресов**|10.0.0.0/16| Это адресное пространство виртуальной сети.|
   |**Имя подсети**|AppGatewaySubnet|Имя подсети для шлюза приложений.|
   |**Диапазон адресов подсети**|10.0.0.0/28 | Эта подсеть позволяет создать дополнительные подсети в виртуальной сети для элементов внутреннего пула.|

7. В колонке **Параметры** в разделе **Frontend IP configuration** (Интерфейсная IP-конфигурация) выберите для параметра **Тип IP-адреса** значение **Общедоступный**.

8. В колонке **Параметры** в разделе **Общедоступный IP-адрес** щелкните **Выберите общедоступный IP-адрес**. В колонке **Выбрать общедоступный IP-адрес** щелкните **Создать**.

   ![Выбор общедоступного IP-адреса][3]

9. В колонке **Создать общедоступный IP-адрес** примите значение по умолчанию и нажмите кнопку **ОК**. В поле **Общедоступный IP-адрес** указывается выбранный общедоступный IP-адрес.

10. В колонке **Параметры** в разделе **Listener configuration** (Конфигурация прослушивателя) для параметра **Протокол** выберите **HTTPS**. Например, для использования **HTTPS** требуется сертификат. Для сертификата требуется закрытый ключ. Предоставьте экспортированный PFX-файл сертификата и введите пароль к нему.

11. Настройте определенные параметры **WAF**.

   |**Параметр** | **Значение** | **Дополнительные сведения** |
   |---|---|---|
   |**Состояние брандмауэра**| Включено| Этот параметр позволяет включить или отключить WAF.|
   |**Режим брандмауэра** | Предотвращение| Этот параметр определяет действия, предпринимаемые WAF в отношении вредоносного трафика. В режиме **Обнаружение** трафик только регистрируется. В режиме **Предотвращение** трафик регистрируется в журнале и останавливается, поступает сообщение "403 — не авторизовано".|


12. Просмотрите страницу **сводки** и нажмите кнопку **ОК**. Теперь шлюз приложений поставлен в очередь и создан.

13. После создания шлюза приложений перейдите к нему на портале, чтобы продолжить его настройку.

    ![Представление ресурса шлюза приложений][10]

В результате выполнения этих действий создается базовый шлюз приложений с параметрами по умолчанию для прослушивателя, внутреннего пула, протокола HTTP серверной части и правил. Вы сможете изменить эти параметры в соответствии с развертыванием после успешного завершения подготовки.

> [!NOTE]
> Для защиты шлюзов приложений, созданных с помощью базовой конфигурации WAF, настраивается CRS 3.0.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы настроить псевдоним личного домена для [общедоступного IP-адреса](../dns/dns-custom-domain.md#public-ip-address), можно использовать Azure DNS или другой поставщик DNS.

Чтобы настроить журнал ведения диагностики для регистрации событий, которые обнаружил или предотвратил WAF, ознакомьтесь со статьей [Работоспособность серверной части, журналы диагностики и метрики для шлюза приложений](application-gateway-diagnostics.md).

Чтобы создать пользовательские пробы работоспособности, см. статью [Создание пользовательской пробы для шлюза приложений с помощью портала](application-gateway-create-probe-portal.md).

Чтобы настроить разгрузку SSL и убрать дорогостоящую подписку SSL с веб-серверов, ознакомьтесь со статьей [Настройка шлюза приложений для разгрузки SSL с помощью портала](application-gateway-ssl-portal.md).

<!--Image references-->
[1]: ./media/application-gateway-web-application-firewall-portal/figure1.png
[2]: ./media/application-gateway-web-application-firewall-portal/figure2.png
[2-1]: ./media/application-gateway-web-application-firewall-portal/figure2-1.png
[2-2]: ./media/application-gateway-web-application-firewall-portal/figure2-2.png
[3]: ./media/application-gateway-web-application-firewall-portal/figure3.png
[10]: ./media/application-gateway-web-application-firewall-portal/figure10.png
[scenario]: ./media/application-gateway-web-application-firewall-portal/scenario.png
