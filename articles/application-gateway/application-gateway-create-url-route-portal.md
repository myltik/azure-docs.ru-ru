---
title: Создание шлюза приложений с правилами маршрутизации на основе URL-пути при помощи портала Azure
description: Узнайте, как создать правила маршрутизации на основе URL-пути для шлюза приложений и масштабируемый набор виртуальных машин с помощью портала Azure.
services: application-gateway
author: vhorne
manager: jpconnock
tags: azure-resource-manager
ms.service: application-gateway
ms.topic: article
ms.workload: infrastructure-services
ms.date: 3/26/2018
ms.author: victorh
ms.openlocfilehash: 4ffaeedf125b6f74aeb88e22248040c6c3ef001c
ms.sourcegitcommit: 3c3488fb16a3c3287c3e1cd11435174711e92126
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/08/2018
ms.locfileid: "34356177"
---
# <a name="create-an-application-gateway-with-path-based-routing-rules-using-the-azure-portal"></a>Создание шлюза приложений с правилами маршрутизации на основе URL-пути при помощи портала Azure | Документация Майкрософт

Для настройки [правил маршрутизации на основе URL-пути](application-gateway-url-route-overview.md) при создании [шлюза приложений](application-gateway-introduction.md) можно использовать портал Azure. В этом руководстве мы создадим серверные пулы с использованием виртуальных машин. Затем мы создадим правила маршрутизации, которые обеспечивают поступление веб-трафика на соответствующие серверы в пуле.

В этой статье раскрываются следующие темы:

> [!div class="checklist"]
> * Создание шлюза приложений
> * создание виртуальных машин для внутренних серверов;
> * создание серверных пулов с внутренними серверами;
> * создание серверного прослушивателя;
> * создание правила маршрутизации на основе пути.

![Пример маршрутизации для URL-адресов](./media/application-gateway-create-url-route-portal/scenario.png)

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="log-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу [http://portal.azure.com](http://portal.azure.com)

## <a name="create-an-application-gateway"></a>Создание шлюза приложений

Виртуальная сеть необходима для обмена данными между создаваемыми ресурсами. В этом примере создаются две подсети: одна для шлюза приложений, а другая — для внутренних серверов. Вы можете создать виртуальную сеть во время создания шлюза приложений.

1. Нажмите кнопку **Создать** в верхнем левом углу портала Azure.
2. Щелкните **Сети**, а затем в списке "Рекомендованные" выберите **Шлюз приложений**.
3. Введите следующие значения для шлюза приложений:

    - *myAppGateway* — для имени шлюза приложений.
    - *myResourceGroupAG* — для новой группы ресурсов.

    ![Создание шлюза приложений](./media/application-gateway-create-url-route-portal/application-gateway-create.png)

4. Оставьте значения по умолчанию для остальных параметров и нажмите кнопку **ОК**.
5. Щелкните **Выбрать виртуальную сеть**, выберите **Создать**, а затем введите следующие значения для виртуальной сети:

    - *myVNet* — имя виртуальной сети;
    - *10.0.0.0/16* — диапазон адресов виртуальной сети;
    - *myAGSubnet* — имя подсети;
    - *10.0.0.0/24* — диапазон адресов подсети.

    ![Создание виртуальной сети](./media/application-gateway-create-url-route-portal/application-gateway-vnet.png)

6. Нажмите кнопку **ОК**, чтобы создать виртуальную сеть и подсеть.
7. Щелкните **Выбрать общедоступный IP-адрес**, выберите **Создать**, а затем введите имя общедоступного IP-адреса. В этом примере общедоступный IP-адрес — *myAGPublicIPAddress*. Оставьте значения по умолчанию для остальных параметров и нажмите кнопку **ОК**.
8. Примите значения по умолчанию для конфигурации прослушивателя, оставьте брандмауэр веб-приложения отключенным и нажмите кнопку **ОК**.
9. Просмотрите параметры на странице сводки и нажмите кнопку **ОК**, чтобы создать сетевые ресурсы и шлюз приложений. Процесс создания шлюза приложений может занять несколько минут. Дождитесь успешного завершения развертывания, прежде чем переходить к следующему разделу.

### <a name="add-a-subnet"></a>Добавление подсети

1. Щелкните **Все ресурсы** в меню слева, а затем из списка ресурсов выберите **myVNet**.
2. Щелкните **Подсети**, а затем — **Подсеть**.

    ![Создание подсети](./media/application-gateway-create-url-route-portal/application-gateway-subnet.png)

3. Введите *myBackendSubnet* в качестве имени подсети и нажмите кнопку **ОК**.

## <a name="create-virtual-machines"></a>Создание виртуальных машин

В этом примере создаются три виртуальные машины, используемые в качестве внутренних серверов для шлюза приложений. Вы также установите службы IIS на виртуальных машинах, чтобы убедиться, что шлюз приложений успешно создан.

1. Нажмите кнопку **Создать**.
2. Щелкните **Вычисления**, а затем в списке "Рекомендованные" выберите **Windows Server 2016 Datacenter**.
3. Введите следующие значения для виртуальной машины:

    - *myVM1* — для имени виртуальной машины;
    - *azureuser* — для имени пользователя учетной записи администратора;
    - *Azure123456!* — пароль.
    - Щелкните **Use existing** (Использовать существующую), а затем выберите *myResourceGroupAG*.

4. Последовательно выберите **ОК**.
5. Выберите значение **DS1_V2** в качестве размера виртуальной машины и нажмите кнопку **Выбрать**.
6. Убедитесь, что выбрана виртуальная сеть **myVNet** и подсеть **myBackendSubnet**. 
7. Щелкните **Отключено**, чтобы отключить диагностику загрузки.
8. Нажмите кнопку **ОК**, просмотрите параметры на странице сводки и нажмите кнопку **Создать**.

### <a name="install-iis"></a>Установка служб IIS

1. Откройте интерактивную оболочку и убедитесь, что для нее задано значение **PowerShell**.

    ![Установка пользовательского расширения](./media/application-gateway-create-url-route-portal/application-gateway-extension.png)

2. Чтобы установить службы IIS, выполните на виртуальной машине следующие команды: 

    ```azurepowershell-interactive
    $publicSettings = @{ "fileUris" = (,"https://raw.githubusercontent.com/davidmu1/samplescripts/master/appgatewayurl.ps1");  "commandToExecute" = "powershell -ExecutionPolicy Unrestricted -File appgatewayurl.ps1" }
    Set-AzureRmVMExtension `
      -ResourceGroupName myResourceGroupAG `
      -Location eastus `
      -ExtensionName IIS `
      -VMName myVM1 `
      -Publisher Microsoft.Compute `
      -ExtensionType CustomScriptExtension `
      -TypeHandlerVersion 1.4 `
      -Settings $publicSettings
    ```

3. Создайте еще две виртуальные машины и установите службы IIS, используя только что выполненные указания. Введите *myVM2* и *myVM3* в качестве имен и значений VMName в Set-AzureRmVMExtension.

## <a name="create-backend-pools-with-the-virtual-machines"></a>Создание серверных пулов с виртуальными машинами

1. Выберите **Все ресурсы** и щелкните **myAppGateway**.
2. Щелкните **Серверные пулы**. Пул по умолчанию был создан автоматически с помощью шлюза приложений. Щелкните **appGatewayBackendPool**.
3. Щелкните **Добавить целевой объект**, чтобы добавить *myVM1* в appGatewayBackendPool.

    ![Добавление внутренних серверов](./media/application-gateway-create-url-route-portal/application-gateway-backend.png)

4. Выберите команду **Сохранить**.
5. Выберите **Серверные пулы** и нажмите кнопку **Добавить**.
6. Введите имя *imagesBackendPool* и добавьте *myVM2* с помощью параметра **Добавить целевой объект**.
7. Последовательно выберите **ОК**.
8. Еще раз щелкните **Добавить**, чтобы добавить другой серверный пул с именем *videoBackendPool*, и добавьте в него *myVM3*.

## <a name="create-a-backend-listener"></a>Создание серверного прослушивателя

1. Щелкните **Прослушиватели** и выберите **Основные**.
2. Введите *myBackendListener* в качестве имени, задайте *myFrontendPort* в качестве имени интерфейсного порта, а затем укажите *8080* в качестве порта для прослушивателя.
3. Последовательно выберите **ОК**.

## <a name="create-a-path-based-routing-rule"></a>Создание правила маршрутизации на основе пути

1. Щелкните **Правила** и выберите **На основе пути**.
2. Введите имя *rule2*.
3. Введите *Images* в качестве имени первого пути. Введите для пути значение */images/**. Выберите для серверного пула значение **imagesBackendPool**.
4. Введите *Video* в качестве имени второго пути. Введите для пути значение */video/**. Выберите для серверного пула значение **videoBackendPool**.

    ![Создание правила на основе пути](./media/application-gateway-create-url-route-portal/application-gateway-route-rule.png)

5. Последовательно выберите **ОК**.

## <a name="test-the-application-gateway"></a>Тестирование шлюза приложений

1. Выберите **Все ресурсы** и щелкните **myAGPublicIPAddress**.

    ![Запись общедоступного IP-адреса шлюза приложений](./media/application-gateway-create-url-route-portal/application-gateway-record-ag-address.png)

2. Скопируйте общедоступный IP-адрес и вставьте его в адресную строку браузера. Например, http://http://40.121.222.19.

    ![Тестирование базового URL-адреса в шлюзе приложений](./media/application-gateway-create-url-route-portal/application-gateway-iistest.png)

3. Измените URL-адрес на http://&lt;ip-address&gt;:8080/images/test.htm и замените &lt;ip-address&gt; своим IP-адресом. Результат должен быть примерно таким:

    ![Тестирование URL-адреса изображений в шлюзе приложений](./media/application-gateway-create-url-route-portal/application-gateway-iistest-images.png)

4. Измените URL-адрес на http://&lt;ip-address&gt;:8080/video/test.htm и замените &lt;ip-address&gt; своим IP-адресом. Результат должен быть примерно таким:

    ![Тестирование URL-адреса видео в шлюзе приложений](./media/application-gateway-create-url-route-portal/application-gateway-iistest-video.png)

## <a name="next-steps"></a>Дополнительная информация

Из этой статьи вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание шлюза приложений
> * создание виртуальных машин для внутренних серверов;
> * создание серверных пулов с внутренними серверами;
> * создание серверного прослушивателя;
> * создание правила маршрутизации на основе пути.

Чтобы узнать больше о шлюзах приложений и связанных с ними ресурсах, перейдите к статьям с инструкциями.
