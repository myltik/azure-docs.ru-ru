---
title: Настройка имени личного домена для конечной точки хранилища BLOB-объектов Azure | Документация Майкрософт
description: С помощью портала Azure сопоставьте собственное каноническое имя (CNAME) с конечной точкой хранилища BLOB-объектов в учетной записи хранения Azure.
services: storage
author: tamram
manager: jeconnoc
ms.service: storage
ms.topic: article
ms.date: 05/25/2017
ms.author: tamram
ms.openlocfilehash: 2b776e8f40f6972a60f933b0104312b119439f38
ms.sourcegitcommit: fbba5027fa76674b64294f47baef85b669de04b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/24/2018
ms.locfileid: "29559933"
---
# <a name="configure-a-custom-domain-name-for-your-blob-storage-endpoint"></a>Настройка пользовательского доменного имени для конечной точки хранилища BLOB-объектов

Можно настроить пользовательский домен для доступа к BLOB-данным в учетной записи хранения Azure. Конечной точкой по умолчанию для хранилища BLOB-объектов является `<storage-account-name>.blob.core.windows.net`. После сопоставления личного домена и поддомена, например **www.contoso.com**, с конечной точкой больших двоичных объектов для вашей учетной записи хранения пользователи также смогут, используя этот домен, получать доступ к данным больших двоичных объектов в учетной записи хранения.

> [!IMPORTANT]
> Служба хранилища Azure пока не поддерживает протокол HTTPS для личных доменов. Тем временем вы можете [использовать Azure CDN для доступа к BLOB-объектам с помощью личных доменов по протоколу HTTPS](storage-https-custom-domain-cdn.md).
>

В следующей таблице приведено несколько примеров URL-адресов для данных больших двоичных объектов, расположенных в учетной записи хранения с именем **mystorageaccount**. Пользовательский домен, зарегистрированный для этой учетной записи хранения: **www.contoso.com**

| Тип ресурса | URL-адрес по умолчанию | URL-адрес личного домена |
| --- | --- | --- |
| Учетная запись хранения | http://mystorageaccount.blob.core.windows.net | http://www.contoso.com |
| BLOB-объект |http://mystorageaccount.blob.core.windows.net/mycontainer/myblob | http://www.contoso.com/mycontainer/myblob |
| Корневой контейнер | http://mystorageaccount.blob.core.windows.net/myblob или http://mystorageaccount.blob.core.windows.net/$root/myblob| http://www.contoso.com/myblob или http://www.contoso.com/$root/myblob |

## <a name="direct-vs-intermediary-domain-mapping"></a>Прямое и промежуточное сопоставление доменов

Вы можете указать личный домен для конечной точки большого двоичного объекта в учетной записи хранения двумя способами: прямое сопоставление CNAME и с помощью промежуточного поддомена *asverify*.

### <a name="direct-cname-mapping"></a>Прямое сопоставление CNAME

Первым и самым простым методом является создание записи канонического имени (CNAME), сопоставляющей личный домен и поддомен непосредственно с конечной точкой больших двоичных объектов. Запись CNAME — это компонент службы доменных имен (DNS), позволяющий сопоставить исходный и конечный домены. В этом случае исходным доменом является ваш личный домен и поддомен, например *www.contoso.com*. Конечный домен является конечной точкой службы BLOB-объектов, например *mystorageaccount.blob.core.windows.net*.

Прямой метод рассматривается в разделе [Регистрация личного домена](#register-a-custom-domain).

### <a name="intermediary-mapping-with-asverify"></a>Промежуточное сопоставление с помощью *asverify*

Во втором методе также применяются записи CNAME, но сначала используется специальный поддомен **asverify**, распознаваемый Azure, который позволяет избежать простоя.

Однако процесс сопоставления личного домена с конечной точкой большого двоичного объекта приводит к краткому периоду простоя домена на время его регистрации на [портале Azure](https://portal.azure.com). Если личный домен в это время поддерживает приложение с Соглашением об уровне обслуживания (SLA), не допускающим простоя, то в качестве промежуточного этапа регистрации можно использовать поддомен Azure *asverify*, обеспечивающий доступ пользователей к вашему домену во время сопоставления DNS.

Промежуточный метод рассматривается в разделе [Регистрация личного домена для учетной записи хранения с помощью промежуточного поддомена *asverify*](#register-a-custom-domain-using-the-asverify-subdomain).

## <a name="register-a-custom-domain"></a>Регистрация личного домена
Эта процедура используется для регистрации личного домена, если допускается кратковременная недоступность домена для пользователей домена или если на личном домене в данный момент не размещается никакое приложение. Службу Azure DNS можно использовать для настройки пользовательского DNS-имени для вашего хранилища BLOB-объектов Azure. Дополнительные сведения см. в статье [Использование Azure DNS для указания параметров личного домена для службы Azure](https://docs.microsoft.com/azure/dns/dns-custom-domain#blob-storage).

Если личный домен поддерживает приложение, не допускающее простоя, то следует использовать процедуру, описанную в разделе [Регистрация личного домена для учетной записи хранения с помощью промежуточного поддомена *asverify*](#register-a-custom-domain-using-the-asverify-subdomain).

Чтобы настроить имя личного домена, необходимо создать запись CNAME в DNS. Запись CNAME определяет псевдоним для имени домена. В этом случае она сопоставляет адрес личного домена с конечной точкой хранилища BLOB-объектов для учетной записи хранения.

Как правило, можно управлять параметрами DNS домена на веб-сайте регистратора домена. Каждый регистратор имеет похожий, но немного отличный способ указания записи CNAME, хотя используется одна и та же концепция. Некоторые базовые пакеты регистрации домена не предлагают настройки DNS, поэтому может потребоваться обновить пакет регистрации домена, прежде чем создавать запись CNAME.

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).
1. В колонке меню в разделе **Служба BLOB-объектов** выберите **Личный домен**, чтобы открыть колонку *Личный домен*.
1. Войдите на веб-сайт своего регистратора и перейдите на страницу управления DNS. Это может быть такой раздел, как **Доменное имя**, **DNS** или **Управление сервером доменных имен**.
1. Найдите раздел управления записями CNAME. Может понадобиться перейти на страницу дополнительных параметров и найти слова **CNAME**, **Псевдоним** или **Поддомены**.
1. Создайте запись CNAME и укажите псевдоним поддомена, например **www** или **photos**. Введите имя узла, являющегося конечной точкой службы BLOB-объектов, в формате **mystorageaccount.blob.core.windows.net** (где *mystorageaccount* — имя вашей учетной записи хранения). Имя узла отображается в первом элементе колонки *Личный домен* на [портале Azure](https://portal.azure.com).
1. На [портале Azure](https://portal.azure.com) в колонке *Личный домен* в текстовом поле введите имя личного домена, включая поддомен. Например, если домен — **contoso.com** и ваш псевдоним поддомена — **www**, введите **www.contoso.com**. Если используется поддомен **photos**, введите **photos.contoso.com**. Поддомен является *обязательным*.
1. В колонке **Личный домен** выберите *Сохранить*, чтобы зарегистрировать личный домен. Если регистрация прошла успешно, появится уведомление портала о том, что учетная запись хранения успешно обновлена.

Как только ваша новая запись CNAME распространится через DNS, пользователи смогут просматривать данные больших двоичных объектов с помощью личного домена при наличии соответствующих разрешений.

## <a name="register-a-custom-domain-using-the-asverify-subdomain"></a>Регистрация личного домена с помощью поддомена *asverify*
Эта процедура используется для регистрации пользовательского домена, который в данное время поддерживает приложения с соглашением об уровне обслуживания, запрещающим простои. Создав запись CNAME, указывающую с `asverify.<subdomain>.<customdomain>` на `asverify.<storageaccount>.blob.core.windows.net`, можно выполнить предварительную регистрацию домена в Azure. Затем можно создать вторую запись CNAME, указывающую c `<subdomain>.<customdomain>` на `<storageaccount>.blob.core.windows.net`. С этого момента трафик для личного домена будет направляться в конечную точку большого двоичного объекта.

Поддомен **asverify** представляет собой специальный поддомен, распознаваемый Azure. Добавляя `asverify` в свой поддомен, вы разрешаете Azure распознавать ваш пользовательский домен без изменения DNS-записи для этого домена. После изменения записи DNS для домена она будет без простоя сопоставлена с конечной точкой большого двоичного объекта.

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).
1. В колонке меню в разделе **Служба BLOB-объектов** выберите **Личный домен**, чтобы открыть колонку *Личный домен*.
1. Войдите на веб-сайт своего поставщика DNS и перейдите на страницу управления DNS. Это может быть такой раздел, как **Доменное имя**, **DNS** или **Управление сервером доменных имен**.
1. Найдите раздел управления записями CNAME. Может понадобиться перейти на страницу дополнительных параметров и найти слова **CNAME**, **Псевдоним** или **Поддомены**.
1. Создайте запись CNAME и укажите псевдоним поддомена, который содержит поддомен *asverify*. Например, **asverify.www** или **asverify.photos**. Введите имя узла, являющегося конечной точкой службы BLOB-объектов, в формате **asverify.mystorageaccount.blob.core.windows.net** (где **mystorageaccount** — имя вашей учетной записи хранения). Имя узла отображается во втором элементе колонки *Личный домен* на [портале Azure](https://portal.azure.com).
1. На [портале Azure](https://portal.azure.com) в колонке *Личный домен* в текстовом поле введите имя личного домена, включая поддомен. Не включайте *asverify*. Например, если домен — **contoso.com** и ваш псевдоним поддомена — **www**, введите **www.contoso.com**. Если используется поддомен **photos**, введите **photos.contoso.com**. Поддомен является обязательным.
1. Выберите флажок **Использовать непрямую проверку CNAME**.
1. В колонке **Личный домен** выберите *Сохранить*, чтобы зарегистрировать личный домен. Если регистрация прошла успешно, появится уведомление портала о том, что учетная запись хранения успешно обновлена. На этом этапе ваш пользовательский домен был проверен Azure, но трафик, идущий в ваш домен, еще не маршрутизирован в вашу учетную запись хранения.
1. Вернитесь на веб-сайт поставщика DNS и создайте другую запись CNAME, сопоставляющую поддомен с конечной точкой службы BLOB-объектов. Например, можно указать дочерний домен как **www** или **photos** (без *asverify*), а имя узла как **mystorageaccount.blob.core.windows.net** (где **mystorageaccount** — имя вашей учетной записи хранения). Это действие завершает регистрацию пользовательского домена.
1. Наконец, можно удалить запись CNAME, содержащую поддомен **asverify**, так как она была необходима только в качестве промежуточного шага.

Как только ваша новая запись CNAME распространится через DNS, пользователи смогут просматривать данные больших двоичных объектов с помощью личного домена при наличии соответствующих разрешений.

## <a name="test-your-custom-domain"></a>Проверка личного домена

Чтобы подтвердить, что личный домен действительно сопоставлен с конечной точкой службы BLOB-объектов, создайте большой двоичный объект в общедоступном контейнере учетной записи хранения. Затем, чтобы получить доступ к этому BLOB-объекту, используйте в веб-браузере URI следующего формата:

`http://<subdomain.customdomain>/<mycontainer>/<myblob>`

Например, можно использовать следующий URI для доступа к веб-форме в контейнере **myforms** на личном поддомене **photos.contoso.com**:

`http://photos.contoso.com/myforms/applicationform.htm`

## <a name="deregister-a-custom-domain"></a>Отмена регистрации личного домена

Чтобы отменить регистрацию личного домена для конечной точки хранилища BLOB-объектов, воспользуйтесь одной из следующих процедур.

### <a name="azure-portal"></a>Портал Azure

Выполните следующие действия на портале Azure, чтобы удалить настройку личного домена.

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).
1. В колонке меню в разделе **Служба BLOB-объектов** выберите **Личный домен**, чтобы открыть колонку *Личный домен*.
1. Очистите содержимое текстового поля, в котором указано имя вашего личного домена.
1. Нажмите кнопку **Сохранить**.

После успешного удаления личного домена появится уведомление портала о том, что ваша учетная запись хранения успешно обновлена.

### <a name="azure-cli-20"></a>Azure CLI 2.0

Воспользуйтесь командой интерфейса командной строки [az storage account update](https://docs.microsoft.com/cli/azure/storage/account#az_storage_account_update) и укажите пустую строку (`""`) в качестве значения аргумента `--custom-domain`, чтобы отменить регистрацию личного домена.

* Формат команды:

  ```azurecli
  az storage account update \
      --name <storage-account-name> \
      --resource-group <resource-group-name> \
      --custom-domain ""
  ```

* Пример команды:

  ```azurecli
  az storage account update \
      --name mystorageaccount \
      --resource-group myresourcegroup \
      --custom-domain ""
  ```

### <a name="powershell"></a>PowerShell

Воспользуйтесь командлетом PowerShell [Set-AzureRmStorageAccount](/powershell/module/azurerm.storage/set-azurermstorageaccount) и укажите пустую строку (`""`) для значения аргумента `-CustomDomainName`, чтобы отменить регистрацию личного домена.

* Формат команды:

  ```powershell
  Set-AzureRmStorageAccount `
      -ResourceGroupName "<resource-group-name>" `
      -AccountName "<storage-account-name>" `
      -CustomDomainName ""
  ```

* Пример команды:

  ```powershell
  Set-AzureRmStorageAccount `
      -ResourceGroupName "myresourcegroup" `
      -AccountName "mystorageaccount" `
      -CustomDomainName ""
  ```

## <a name="next-steps"></a>Дополнительная информация
* [Сопоставление содержимого Azure CDN с пользовательским доменом](../../cdn/cdn-map-content-to-custom-domain.md)
* [Использование Azure CDN для доступа к BLOB-объектам с помощью личных доменов по протоколу HTTPS](storage-https-custom-domain-cdn.md)
