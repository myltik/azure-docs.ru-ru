---
title: Использование службы "Импорт и экспорт Azure" для передачи данных в службу хранилища Azure и обратно | Документация Майкрософт
description: Сведения о создании заданий импорта и экспорта на портале Azure для передачи данных в службу хранилища Azure и обратно.
author: muralikk
manager: syadav
services: storage
ms.service: storage
ms.topic: article
ms.date: 03/22/2018
ms.author: muralikk
ms.openlocfilehash: 4d6177fe0a50c531ba6c4b3e87eaa08299af2ddd
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
---
# <a name="use-the-microsoft-azure-importexport-service-to-transfer-data-to-azure-storage"></a>Использование службы "Импорт и экспорт Microsoft Azure" для передачи данных в службу хранилища Azure
В этой статье предоставляются пошаговые инструкции по использованию службы "Импорт и экспорт Azure" для безопасного переноса больших объемов данных в хранилище BLOB Azure и файлов Azure при отправке дисков в центр обработки данных Azure. Кроме того, эту службу можно использовать, чтобы переносить данные из службы хранилища Azure на жесткие диски и передавать на локальные сайты. Данные с одного внутреннего диска SATA можно импортировать в хранилище BLOB-объектов Azure или хранилище файлов Azure. 

> [!IMPORTANT] 
> Эта служба принимает только внутренние жесткие диски SATA или SSD. Другие варианты устройств не поддерживаются. Не отправляйте внешние HDD или запоминающие устройства, подключаемые к сети, так как они будут возвращены, если это возможно, или отменены.
>
>

Выполните следующие действия, если данные на диске необходимо импортировать в службу хранилища Azure.
### <a name="step-1-prepare-the-drives-using-waimportexport-tool-and-generate-journal-files"></a>Шаг 1. Подготовка дисков с помощью средства WAImportExport и создание файлов журнала

1.  Определите данные, которые нужно импортировать в службу хранилища Azure. Вы можете импортировать папки или отдельные файлы на локальном сервере или в сетевой папке.
2.  В зависимости от общего объема данных приобретите необходимое количество 2,5-дюймовых твердотельных накопителей или 2,5-дюймовых (3,5-дюймовых) жестких дисков SATA II или III.
3.  Подключите жесткие диски напрямую с помощью SATA или с помощью внешних адаптеров USB на компьютере с Windows.
1.  Создайте один том NTFS на каждом жестком диске и присвойте ему букву диска. Точки подключения не используются.
2.  Чтобы включить шифрование на компьютере Windows, включите шифрование BitLocker на томе NTFS. Используйте инструкции отсюда: https://technet.microsoft.com/library/cc731549(v=ws.10).aspx.
3.  Полностью скопируйте данные на эти зашифрованные отдельные тома NTFS на дисках, используя копирование и вставку, перетаскивание, Robocopy или любое другое подобное средство.
7.  Скачайте WAImportExport V1 отсюда: https://www.microsoft.com/en-us/download/details.aspx?id=42659
8.  Распакуйте содержимое в папку waimportexportv1 по умолчанию. Например, C:\WaImportExportV1.  
9.  Выполните запуск от имени администратора и откройте PowerShell или командную строку и перейдите в папку с распакованным содержимым. Например, cd C:\WaImportExportV1.
10. Скопируйте приведенную ниже команду в текстовый редактор и отредактируйте ее, чтобы создать командную строку:

    ```
    ./WAImportExport.exe PrepImport /j:JournalTest.jrn /id:session#1 /sk:***== /t:D /bk:*** /srcdir:D:\ /dstdir:ContainerName/ /skipwrite 
    ```
    
    Параметры командной строки описаны в следующей таблице:

    |Параметр  |ОПИСАНИЕ  |
    |---------|---------|
    |/j:     |Имя файла журнала с расширением .jrn. Файл журнала создается для каждого диска. Рекомендуем использовать в качестве имени файла журнала серийный номер диска.         |
    |/sk:     |Ключ учетной записи хранения Azure.         |
    |/t:     |Буква отправляемого диска. Например, диск `D`.         |
    |/bk:     |Ключ BitLocker для диска. Числовой пароль из выходных данных ` manage-bde -protectors -get D: `      |
    |/srcdir:     |Буква отправляемого диска и `:\`. Например, `D:\`.         |
    |/dstdir:     |Имя целевого контейнера в службе хранилища Azure.         |
    |/skipwrite:     |Параметр, который указывает, что новые данные не требуется копировать и что на диске нужно подготовить существующие данные.         |
1. Повторите шаг 10 для каждого диска, который необходимо отправить.
2. Файл журнала с именем, указанным с параметром /j:, создается при каждом запуске командной строки.

### <a name="step-2-create-an-import-job-on-azure-portal"></a>Шаг 2. Создание задания импорта на портале Azure

1. Войдите на портал по адресу https://portal.azure.com/ и выберите "Больше служб -> Хранилище -> Задания импорта и экспорта", а затем щелкните **Create Import/export Job** (Создать задание импорта или экспорта).

2. В разделе "Основы" выберите "Импорт в Azure", введите строку для имени задания, выберите подписку, введите или выберите группу ресурсов. Введите описательное имя для задания импорта. Обратите внимание,что вводимое имя может содержать только строчные буквы, цифры, дефисы и подчеркивания, кроме того, оно должно начинаться с буквы и не содержать пробелов. Выбранное имя будет использоваться для отслеживания выполняемых заданий, а также после их завершения.

3. В разделе "Сведения о задании" передайте файлы журналов диска, полученные на этапе подготовки диска. Если использовалась версия 1 waimportexport.exe, необходимо передать один файл для каждого подготовленного диска. Выберите учетную запись хранилища, в которую будут импортированы данные, в разделе учетной записи хранения Import destination (Место назначение импорта). Расположение места назначения автоматически заполняется с учетом выбранного региона учетной записи хранения.
   
   ![Создание задание импорта – шаг 3](./media/storage-import-export-service/import-job-03.png)
4. В разделе "Сведения о возврате" выберите перевозчик из раскрывающегося списка и введите его доступный номер учетной записи, созданной с помощью этого перевозчика. Корпорация Майкрософт использует эту учетную запись для отправки дисков обратно после завершения задания импорта. Укажите полное и допустимое имя контактного лица, телефон, адрес электронной почты, адрес, город, почтовый индекс, страну (провинцию) и страну (регион).
   
5. В разделе "Сводка" предоставляется адрес доставки центра данных Azure для доставки дисков в Azure DC. Убедитесь, что в метке доставки упомянуто имя задания и полный адрес. 

6. Нажмите кнопку ОК на странице "Сводка" для завершения создания задания импорта.

### <a name="step-3-ship-the-drives-to-the-azure-datacenter-shipping-address-provided-in-step-2"></a>Шаг 3. Отправка дисков доставки в центр обработки данных Azure по адресу, указанному на шаге 2
Для отправки пакета в центр обработки данных Azure можно использовать службу FedEx, UPS или DHL.

### <a name="step-4-update-the-job-created-in-step2-with-tracking-number-of-the-shipment"></a>Шаг 4. Обновление созданного на шаге 2 задания с указанием номера отслеживания посылки
После отправки дисков вернитесь на страницу **импорта или экспорта** на портале Azure, чтобы обновить номер отслеживания с помощью шагов, описанных ниже: а) найдите и щелкните задание импорта; б) щелкните **Update job status and tracking info once drives are shipped** (Обновить сведения о состоянии задания и отслеживания после отправления дисков); в) установите флажок Mark as shipped (Пометить как отправленный); г) укажите номер перевозчика и отслеживания.
Если номер отслеживания не обновляется в течение 2 недель с момента создания задания, срок действия задания истекает. Ход выполнения задания можно отслеживать на панели мониторинга портала. Описание каждого состояния см. в разделе [Просмотр состояния задания](#viewing-your-job-status).

## <a name="when-should-i-use-the-azure-importexport-service"></a>Когда следует использовать службу "Импорт и экспорт Azure"?
Службу "Импорт и экспорт Azure" можно использовать, если отправка или скачивание данных по сети занимают слишком много времени, а увеличение пропускной способности сети нерентабельно.

Эту службу можно использовать в следующих сценариях:

* Перенос данных в облако: быстрое и эффективное перемещение больших объемов данных в Azure.
* Распространение содержимого: быстрая отправка данных на веб-сайты клиентов.
* Резервное копирование: создание резервных копий локальных данных для хранения в службе хранилища Azure.
* Восстановление данных: восстановление большого объема данных в хранилище и его перенос в локальное расположение.

## <a name="prerequisites"></a>предварительным требованиям
В этом разделе перечислены предварительные требования, которые должны выполняться для работы с этой службой. Изучите их перед отправкой дисков.

### <a name="storage-account"></a>Учетная запись хранения
Для использования службы "Импорт и экспорт Azure" необходимо иметь подписку Azure, а также одну или несколько учетных записей хранения. Функция импорта и экспорта Azure поддерживает только классические учетные записи, учетные записи хранилища BLOB-объектов Azure и учетные записи хранения общего назначения версии 1. Каждое задание может использоваться для обмена данными только с одной учетной записью хранения. Другими словами, отдельное задание импорта и экспорта не может распространяться на несколько учетных записей хранения. Сведения о создании учетной записи хранения см. в разделе [Создание учетной записи хранения](storage-create-storage-account.md#create-a-storage-account).

> [!IMPORTANT] 
> Служба импорта и экспорта Azure не поддерживает учетные записи хранения с включенной функцией [конечных точек службы для виртуальных сетей](../../virtual-network/virtual-network-service-endpoints-overview.md). 
> 
> 

### <a name="data-types"></a>Типы данных
Службу "Импорт и экспорт Azure" можно использовать для копирования данных в **блочные** или **страничные** BLOB-объекты или **файлы**. Кроме того, с ее помощью можно экспортировать из службы хранилища Azure только **блочные**, **страничные** или **добавочные** BLOB-объекты. Служба поддерживает только импорт файлов Azure в службу хранилища Azure. На данный момент функция экспорта файлов Azure не поддерживается.

### <a name="job"></a>Задание
Чтобы начать процесс импорта или экспорта из хранилища, необходимо сначала создать задание. Заданием может являться задание импорта или задание экспорта:

* Создайте задание импорта, если необходимо передать локальные данные в учетную запись хранения Azure.
* Создайте задание экспорта, если необходимо передать данные, которые в настоящее время хранятся в вашей учетной записи хранения, на отправленные корпорации Майкрософт жесткие диски. При создании задания вы уведомляете службу импорта и экспорта о том, что отправите один или несколько жестких дисков в центр обработки данных Azure.

* При создании задания импорта необходимо отправить жесткие диски, содержащие файлы данных.
* При создании задания экспорта необходимо отправить пустые жесткие диски.
* Отправлять можно до десяти жестких дисков на задание.

Задание импорта или экспорта можно создать с помощью портала Azure или [REST API импорта и экспорта службы хранилища Azure](/rest/api/storageimportexport).

> [!Note]
> Интерфейсы API RDFE не будут поддерживаться после 28 февраля 2018 года. Чтобы продолжить использование службы, перейдите на [интерфейсы REST API для импорта и экспорта ARM](https://github.com/Azure/azure-rest-api-specs/blob/master/specification/storageimportexport/resource-manager/Microsoft.ImportExport/stable/2016-11-01/storageimportexport.json). 

### <a name="waimportexport-tool"></a>Средство WAImportExport
Создание задания **импорта** начинается с подготовки дисков, которые будут отправлены для импорта данных. Чтобы подготовить диски, их необходимо подключить к локальному серверу и запустить средство WAImportExport на локальном сервере. Это средство позволяет копировать данные на диск, шифровать на нем данные с использованием технологии BitLocker и создавать файлы журналов дисков.

В файлах журналов хранятся сведения о задании и диске, такие как серийный номер диска и имя учетной записи хранения. Этот файл журнала не хранится на диске. Он используется при создании задания импорта. Пошаговые инструкции по созданию заданий приводятся ниже в этой статье.

Средство WAImportExport совместимо только с 64-разрядной операционной системой Windows. Поддерживаемые версии перечислены в разделе [Операционная система](#operating-system) .

Скачайте [последнюю версию средства WAImportExport](http://download.microsoft.com/download/3/6/B/36BFF22A-91C3-4DFC-8717-7567D37D64C5/WAImportExportV2.zip). Дополнительные сведения об использовании средства WAImportExport см. в [этой статье](storage-import-export-tool-how-to.md).

>[!NOTE]
>**Предыдущая версия.** [Скачайте средство WAImportExpot версии 1](http://download.microsoft.com/download/0/C/D/0CD6ABA7-024F-4202-91A0-CE2656DCE413/WaImportExportV1.zip) и ознакомьтесь с [руководством по его использованию](storage-import-export-tool-how-to-v1.md). Это средство не поддерживает **подготовку дисков с предварительно записанными на них данными**. Используйте версию 1 инструмента WAImportExpot, если доступен только ключ SAS.

>

### <a name="hard-disk-drives"></a>Жесткие диски
Служба "Импорт и экспорт" поддерживает только 2,5-дюймовые твердотельные накопители и 2,5- или 3,5-дюймовые внутренние жесткие диски SATA II или III. Отдельное задание импорта и экспорта может включать не более 10 жестких дисков или твердотельных накопителей, каждый из которых может быть любого размера. Большое количество дисков можно распределить по нескольким заданиям. Вы можете создать неограниченное количество заданий. 

В заданиях импорта на диске обрабатывается только первый том данных. Том с данными должен быть отформатирован в NTFS.

> [!IMPORTANT]
> Эта служба не поддерживает внешние жесткие диски, имеющие встроенный USB-адаптер. Кроме того, невозможно использовать диски во внешнем корпусе. Не отправляйте внешние жесткие диски.
> 
> 

Ниже приведен список внешних адаптеров USB, используемых для копирования данных на внутренние жесткие диски. Anker 68UPSATAA-02BU Anker 68UPSHHDS-BU Startech SATADOCK22UE Orico 6628SUS3-C-BK (6628 Series) Thermaltake BlacX Hot-Swap SATA External Hard Drive Docking Station (USB 2.0 & eSATA)

### <a name="encryption"></a>Шифрование
Данные на диске должны быть зашифрованы с помощью технологии шифрования дисков BitLocker. Это шифрование защитит данные во время пересылки.

Для заданий импорта данные можно шифровать двумя способами. Первый способ — задать параметр при использовании CSV-файла набора данных во время запуска средства WAImportExport в процессе подготовки диска. Второй способ — включить шифрование BitLocker на диске вручную и указать ключ шифрования в CSV-файле набора данных во время запуска окна командной строки средства WAImportExport в процессе подготовки диска.

В случае экспорта после копирования данных на диск и прежде чем передать его вам, служба выполняет шифрование BitLocker. Ключ шифрования предоставляется пользователю на портале Azure.  

### <a name="operating-system"></a>Операционная система
Для подготовки жесткого диска с помощью средства WAImportExport перед отправкой его в Azure можно использовать следующие 64-разрядные операционные системы:

Windows 7 Корпоративная, Windows 7 Максимальная, Windows 8 Профессиональная, Windows 8 Корпоративная, Windows 8.1 Профессиональная, Windows 8.1 Корпоративная, Windows 10, Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2. Все эти операционные системы поддерживают шифрование диска BitLocker.

### <a name="locations"></a>Расположения
Служба "Импорт и экспорт Azure" поддерживает копирование данных в любые учетные записи хранения общедоступной службы Azure и из них. Жесткие диски можно отправлять в одно из указанных ниже расположений. Если ваша учетная запись хранения находится в общедоступном расположении Azure, которое здесь не указано, при создании задания на портале Azure или с помощью REST API службы "Импорт и экспорт" вам будет предложено альтернативное расположение.

Диски можно отправлять в следующие расположения:

* Восток США
* Запад США
* Восток США 2
* Западный регион США 2
* Центральный регион США
* Северо-центральный регион США
* Южно-центральный регион США
* Западно-центральная часть США
* Северная Европа
* Западная Европа
* Восточная Азия
* Юго-Восточная Азия
* Восточная часть Австралии
* Юго-Восточная часть Австралии
* Западная часть Японии
* Восточная часть Японии
* Центральная Индия
* Южная Индия
* Западная Индия
* Центральная Канада
* Восточная Канада
* Южная часть Бразилии
* Центральная Корея
* Правительство штата Вирджиния
* Правительство штата Айова
* Восточная часть US DoD
* Центральная часть US DoD
* Восток Китая
* Север Китая
* Южная часть Великобритании
* Центральная Германия
* Северо-восточная Германия

### <a name="shipping"></a>Отправка
**Доставка дисков в центр обработки данных:**

При создании задания импорта или экспорта вам будет предоставлен почтовый адрес одного из поддерживаемых расположений для отправки дисков. Адрес доставки зависит от расположения вашей учетной записи хранения, но может от него отличаться.

Для отправки дисков по адресу доставки можно использовать службу FedEx, UPS или DHL.

**Доставка дисков из центра обработки данных**

Создавая задание импорта или экспорта, вы должны указать обратный адрес, который будет использоваться корпорацией Майкрософт для возврата дисков после выполнения этого задания. Чтобы избежать задержек, укажите действительный обратный адрес.

Этот поставщик должен предоставлять возможности отслеживания, чтобы вы могли контролировать ход возвращения товара. Для возврата корпорацией Майкрософт дисков необходимо указать действительный номер учетной записи перевозчика FedEx, UPS или DHL. Номер учетной записи FedEx, UPS или DHL необходим для возврата жестких дисков из расположений в США и Европе, а номер учетной записи DHL — из расположений в Азии и Австралии. Вы можете создать учетную запись перевозчика для [FedEx](http://www.fedex.com/us/oadr/) (США и Европа) или [DHL](http://www.dhl.com/) (Азия и Австралия), если ее у вас еще нет. Если у вас уже есть учетная запись, убедитесь в том, что она действительна.

При отправке пакетов должны соблюдаться условия раздела [Условия обслуживания Мicrosoft Azure](https://azure.microsoft.com/support/legal/services-terms/).

> [!IMPORTANT]
> Обратите внимание на то, что отправляемые физические носители могут пересекать международные границы. Вы несете ответственность за то, что ваши физические носители и данные импортируются и (или0 экспортируются в соответствии с действующим законодательством. Перед отправкой физических носителей проконсультируйтесь и удостоверьтесь, что эти носители и данные могут быть отправлены в определенный центр обработки данных на законных основаниях. Это поможет корпорации Майкрософт своевременно получить посылку. Например, любой пакет, который пересекает международные границы, должен сопровождаться торговым счетом-фактурой (кроме пересечения границ в пределах ЕС). Можно распечатать заполненную копию торгового счета-фактуры с веб-сайта перевозчика. Примеры торговой накладной: [торговая накладная DHL](http://invoice-template.com/wp-content/uploads/dhl-commercial-invoice-template.pdf) и [торговая накладная FedEx](http://images.fedex.com/downloads/shared/shipdocuments/blankforms/commercialinvoice.pdf). Убедитесь в том, что корпорация Майкрософт не указана в качестве экспортера.
> 
> 

## <a name="how-does-the-azure-importexport-service-work"></a>Как работает служба "Импорт и экспорт Azure"?
Данные можно передавать между локальным сайтом и хранилищем Azure с помощью службы "Импорт и экспорт Azure", создавая задания и отправляя жесткие диски в центр обработки данных Azure. Каждый отправляемый жесткий диск сопоставляется с отдельным заданием, а каждое задание — с отдельной учетной записью хранения. Внимательно изучите раздел [предварительных требований](#pre-requisites), чтобы узнать особенности этой службы, такие как поддерживаемые типы данных, типы дисков, расположений и отправка.

В этом разделе в общих чертах описаны действия, связанные с заданиями импорта и экспорта. Ниже, в разделе [Быстрый запуск](#quick-start), представлены пошаговые инструкции по созданию заданий импорта и экспорта.

### <a name="inside-an-import-job"></a>Задание импорта
На высоком уровне задание импорта включает следующие действия:

* Определите данные для импорта, а также количество дисков, которое требуется.
* Определите целевое расположение большого двоичного объекта или файла для ваших данных в хранилище Azure.
* Используйте средство WAImportExport для копирования данных на один или несколько жестких дисков и их шифрования по технологии BitLocker.
* Создайте задание импорта в соответствующей учетной записи хранения на портале Azure или с помощью REST API службы "Импорт и экспорт". При использовании портала Azure отправьте файлы журналов диска.
* Укажите обратный адрес и номер учетной записи транспортного агента для возврата дисков.
* Отправьте жесткие диски по адресу, указанному при создании задания.
* Обновите номер отслеживания доставки в сведениях о задании импорта и отправьте задание импорта.
* Диски принимаются и обрабатываются центром обработки данных Azure.
* Диски возвращаются с использованием учетной записи транспортного агента по обратному адресу, указанному в задании импорта.
  
    ![Рисунок 1. Процесс выполнения задания импорта](./media/storage-import-export-service/importjob.png)

### <a name="inside-an-export-job"></a>Задание экспорта
> [!IMPORTANT]
> В этой службе поддерживается только экспорт больших двоичных объектов Azure и не поддерживается экспорт файлов Azure.
> 
>

На высоком уровне задание экспорта включает следующие действия:

* Определите данные для экспорта, а также количество дисков, которое требуется.
* Укажите пути к BLOB-объектам и контейнерам исходных данных в хранилище BLOB-объектов.
* Создайте задание экспорта в исходной учетной записи хранения на портале Azure или с помощью REST API службы "Импорт и экспорт".
* Укажите пути к BLOB-объектам и контейнерам исходных данных в задании экспорта.
* Укажите обратный адрес и номер учетной записи транспортного агента для возврата дисков.
* Отправьте жесткие диски по адресу, указанному при создании задания.
* Обновите номер отслеживания доставки в сведениях о задании экспорта и отправьте задание экспорта.
* Диски принимаются и обрабатываются центром обработки данных Azure.
* Диски шифруются по технологии BitLocker. Ключи доступны на портале Azure.  
* Диски возвращаются с использованием учетной записи транспортного агента по обратному адресу, указанному в задании импорта.
  
    ![Рисунок 2. Процесс выполнения задания экспорта](./media/storage-import-export-service/exportjob.png)

### <a name="viewing-your-job-and-drive-status"></a>Просмотр состояния задания и диска
Состояние задания импорта или экспорта можно отслеживать на портале Azure. Щелкните вкладку **Импорт и экспорт**. На странице появится список заданий.

![Просмотр состояния задания](./media/storage-import-export-service/jobstate.png)

В зависимости от места обработки диска вы увидите одно из следующих состояний задания.

| Состояние задания | ОПИСАНИЕ |
|:--- |:--- |
| Создание | После создания задания для него задается состояние Creating. Когда задание пребывает в этом состоянии, служба "Импорт и экспорт" предполагает, что диски еще не доставлены в центр обработки данных. Задание может оставаться в состоянии создания до двух недель, после чего оно автоматически удаляется службой. |
| Отправка | После отправки пакета на портале Azure необходимо обновить сведения об отслеживании.  После этого состояние задания изменится на Shipping. Задание может оставаться в состоянии Shipping до двух недель. 
| Received | После доставки всех дисков в центр обработки данных заданию будет присвоено состояние Received. |
| Передача | Как только начнется обработка первого диска, состояние задания изменится на Transferring. Дополнительные сведения см. в разделе "Просмотр состояния задания и диска" ниже. |
| Упаковка | После завершения обработки всех дисков задание перейдет в состояние Packaging и будет находиться в нем до отправки дисков обратно клиенту. |
| Завершено | После отправки всех дисков клиенту состояние задания изменится на Completed, если оно выполнено без ошибок. Задание с этим состоянием автоматически завершается через 90 дней. |
| Закрытые | После отправки всех дисков клиенту заданию присваивается состояние Closed, если во время обработки этого задания возникли ошибки. Задание с этим состоянием автоматически удаляется через 90 дней. |

В таблице ниже описан жизненный цикл отдельного диска по мере выполнения задания импорта или экспорта. Текущее состояние каждого диска в задании теперь отображается на портале Azure.
В следующей таблице описаны все состояния, через которые может пройти каждый диск в ходе выполнения задания.

| Состояние диска | ОПИСАНИЕ |
|:--- |:--- |
| Specified | Если задание импорта создано на портале Azure, диску присваивается начальное состояние Specified. При создании задания экспорта диск не указывается, поэтому начальное состояние диска — Received. |
| Received | Диск переходит в состояние Received, если оператор службы "Импорт и экспорт" обработал диски, полученные от транспортной компании для задания импорта. Заданию экспорта присваивается начальное состояние диска Received. |
| NeverReceived | Диск переходит в состояние NeverReceived, когда прибывает пакет для задания, но этот пакет не содержит диск. Диск также может перейти в это состояние через две недели с момента получения службой сведений о доставке, если пакет еще не прибыл в центр обработки данных. |
| Передача | Когда служба начинает передавать данные с диска в службу хранилища Microsoft Azure, диск переходит в состояние Transferring. |
| Завершено | Диск перейдет в состояние Completed, если служба успешно передаст все данные без ошибок.
| CompletedMoreInfo | Диск перейдет в состояние CompletedMoreInfo, если служба обнаружит проблемы при копировании данных на диск или с него. Добавленные сведения могут содержать сообщения об ошибках, предупреждения или информационные сообщения о перезаписи больших двоичных объектов.
| ShippedBack | После отправки диска из центра обработки данных по обратному адресу он перейдет в состояние ShippedBack. |

На этом снимке экрана с портала Azure отображается состояние диска в примере задания:

![Просмотр состояния диска](./media/storage-import-export-service/drivestate.png)

В следующей таблице описаны состояния сбоя диска и действия для каждого состояния.

| Состояние диска | Событие | Решение и дальнейшие действия |
|:--- |:--- |:--- |
| NeverReceived | Диск, помеченный как NeverReceived (так как он не был получен при отправке задания), прибывает в другой посылке. | Рабочая группа переведет диск в состояние Received. |
| Недоступно | Диск, не входящий ни в одно задание, прибывает в центр обработки данных в рамках другого задания. | Диск будет помечен как лишний и будет возвращен клиенту по завершении задания, связанного с исходным пакетом. |

### <a name="time-to-process-job"></a>Время обработки задания
Время обработки задания импорта или экспорта зависит от ряда факторов, таких как время отправки, нагрузка в центре данных, тип задания и размер копируемых данных, а также количество дисков в задании. В службе "Импорт и экспорт" не предусмотрено соглашение об уровне обслуживания, однако служба стремится выполнить копирование в течение 7–10 дней после получения дисков. В дополнение к состоянию, размещенному на портале Azure, REST API можно использовать для отслеживания прогресса задания. В вызове API операции "Список заданий" есть параметр процентного выполнения, отражающий ход копирования.

### <a name="pricing"></a>Цены
**Стоимости обработки дисков**

За обработку каждого диска в рамках задания импорта или экспорта взимается плата. Дополнительные сведения см. на странице [цен на службу "Импорт и экспорт Azure"](https://azure.microsoft.com/pricing/details/storage-import-export/).

**Стоимость отправки**

При отправке дисков в Azure вы оплачиваете транспортные расходы перевозчика. Когда Майкрософт возвращает вам диск, стоимость обратной пересылки списывается с вашей учетной записи транспортного агента, указанной при создании задания.

**Плата за транзакции**

Вы оплачиваете только стандартную стоимость транзакции с хранилищем при импорте данных в службу хранилища Azure. При экспорте данных из хранилища BLOB-объектов взимается стандартная плата за исходящие данные. Дополнительные сведения о стоимости транзакций см. на странице [Сведения о ценах — передача данных](https://azure.microsoft.com/pricing/details/data-transfers/).



## <a name="how-to-import-data-into-azure-file-storage-using-internal-sata-hdds-and-ssds"></a>Как импортировать данные в хранилище файлов Azure с помощью внутренних жестких дисков SATA и дисков SSD?
Выполните следующие действия, если данные на диске необходимо импортировать в хранилище файлов Azure.
В первую очередь при импорте данных в службе "Импорт и экспорт Azure" необходимо подготовить диски с помощью средства WAImportExport. Для подготовки дисков сделайте следующее:

1. Определите данные, которые нужно импортировать в хранилище файлов Azure. Это могут быть папки или отдельные файлы на локальном сервере или в общей сетевой папке.  
2. Определите необходимое количество дисков в зависимости от общего объема данных. Приобретите необходимое количество 2,5-дюймовых твердотельных накопителей или 2,5-дюймовых (3,5-дюймовых) жестких дисков SATA II или III.
4. Определите каталоги и (или) автономные файлы, которые будут скопированы на каждый жесткий диск.
5. Создайте CSV-файл для набора данных и набора дисков.
    
  Ниже приведен пример CSV-файла с набором данных для импорта данных в виде файлов Azure.
  
    ```
    BasePath,DstItemPathOrPrefix,ItemType,Disposition,MetadataFile,PropertiesFile
    "F:\50M_original\100M_1.csv.txt","fileshare/100M_1.csv.txt",file,rename,"None",None
    "F:\50M_original\","fileshare/",file,rename,"None",None 
    ```
   В этом примере видно, что файл 100M_1.csv.txt будет скопирован в корень контейнера fileshare. Если контейнера fileshare не существует, он будет создан. Все файлы и папки, расположенные в каталоге 50M_original, будут рекурсивно скопированы в контейнер fileshare. Структура папок сохраняется.

    Дополнительные сведения о подготовке CSV-файла набора данных см. в [этом разделе](storage-import-export-tool-preparing-hard-drives-import.md#prepare-the-dataset-csv-file).
    


    **CSV-файл набора дисков**

    Значение флага набора дисков — это CSV-файл, содержащий список дисков, с которыми сопоставлены буквы дисков, в результате чего инструмент может правильно выбрать список дисков для подготовки. 

    Ниже приведен пример CSV-файла набора дисков.
    
    ```
    DriveLetter,FormatOption,SilentOrPromptOnFormat,Encryption,ExistingBitLockerKey
    G,AlreadyFormatted,SilentMode,AlreadyEncrypted,060456-014509-132033-080300-252615-584177-672089-411631 |
    H,Format,SilentMode,Encrypt,
    ```

    В примере выше предполагается, что подключены два диска и созданы два базовых тома NTFS с буквами G:\ и H:\. В этом случае средство отформатирует и зашифрует только диск с томом H:\.

    Дополнительные сведения о подготовке CSV-файла набора дисков см. в [этом разделе](storage-import-export-tool-preparing-hard-drives-import.md#prepare-initialdriveset-or-additionaldriveset-csv-file).

6.  Используйте [средство WAImportExport](http://download.microsoft.com/download/3/6/B/36BFF22A-91C3-4DFC-8717-7567D37D64C5/WAImportExport.zip) для копирования данных на один или несколько жестких дисков.
7.  Чтобы включить шифрование BitLocker на жестком диске, в поле Encryption CSV-файла набора дисков укажите значение Encrypt. Кроме того, вы можете вручную включить шифрование BitLocker на жестком диске, а также указать в CSV-файле набора дисков значение AlreadyEncrypted и ключ во время выполнения средства.

8. Не изменяйте данные на жестких дисках или в файлах журналов после завершения подготовки этих дисков.

> [!IMPORTANT]
> Для каждого подготовленного диска формируется файл журнала. Создавая задание импорта на портале Azure, необходимо отправить все файлы журналов для дисков, которые входят в это задание. Диски без файлов журналов обрабатываться не будут.
> 
>

Ниже представлены команды и примеры подготовки жесткого диска с помощью средства WAImportExport.

Команда PrepImport средства WAImportExport, используемая для первого сеанса копирования каталогов и файлов в рамках нового сеанса копирования, выглядит следующим образом:

```
WAImportExport.exe PrepImport /j:<JournalFile> /id:<SessionId> [/logdir:<LogDirectory>] [/sk:<StorageAccountKey>] [/silentmode] [/InitialDriveSet:<driveset.csv>] DataSet:<dataset.csv>
```

**Пример импорта 1**

```
WAImportExport.exe PrepImport /j:JournalTest.jrn /id:session#1  /sk:************* /InitialDriveSet:driveset-1.csv /DataSet:dataset-1.csv /logdir:F:\logs
```

Чтобы **добавить дополнительные диски**, создайте файл набора дисков и выполните приведенную ниже команду. Для последующих сеансов копирования на диски, указанные в CSV-файле InitialDriveset, создайте еще один CSV-файл набора дисков и укажите его в качестве значения параметра AdditionalDriveSet. Используйте **то же имя файла журнала** и укажите **новый идентификатор сеанса**. Формат CSV-файлов AdditionalDriveset и InitialDriveSet совпадает.

```
WAImportExport.exe PrepImport /j:<JournalFile> /id:<SessionId> /AdditionalDriveSet:<driveset.csv>
```

**Пример импорта 2**
```
WAImportExport.exe PrepImport /j:JournalTest.jrn /id:session#3  /AdditionalDriveSet:driveset-2.csv
```

В ходе выполнения последующих сеансов копирования в тот же набор дисков можно добавить дополнительные данные (например, файлы или каталог). Это можно сделать, вызвав команду PrepImport средства WAImportExport. В этом случае при выполнении последующих сеансов копирования на тот же жесткий диск, определенный в CSV-файле InitialDriveset, необходимо указать **то же самое имя файла журнала** и **новый идентификатор сеанса**. Ключ учетной записи хранения предоставлять не нужно.

```
WAImportExport PrepImport /j:<JournalFile> /id:<SessionId> /j:<JournalFile> /id:<SessionId> [/logdir:<LogDirectory>] DataSet:<dataset.csv>
```

**Пример импорта 3**

```
WAImportExport.exe PrepImport /j:JournalTest.jrn /id:session#2  /DataSet:dataset-2.csv
```

Дополнительные сведения об использовании средства WAImportExport см. в статье [Подготовка жестких дисков к заданию импорта](storage-import-export-tool-preparing-hard-drives-import.md).

Подробные пошаговые инструкции см. в статье [Пример рабочего процесса подготовки жестких дисков для задания импорта](storage-import-export-tool-sample-preparing-hard-drives-import-job-workflow.md).  



## <a name="create-an-export-job"></a>создание задания экспорта;
Создайте задание экспорта для уведомления службы "Импорт и экспорт" о том, что вы отправите один или несколько пустых жестких дисков в центр обработки данных, чтобы данные были экспортированы из вашей учетной записи хранения на диски с последующей отправкой на ваш адрес.

### <a name="prepare-your-drives"></a>Подготовка дисков
Для подготовки дисков к заданиям экспорта рекомендуется выполнить следующие предварительные проверки:

1. Проверьте необходимое количество дисков с помощью команды PreviewExport средства WAImportExport. Дополнительные сведения см. в разделе [Предварительный просмотр использования дисков для задания экспорта](https://msdn.microsoft.com/library/azure/dn722414.aspx). Это позволяет просмотреть использование диска для выбранных больших двоичных объектов в зависимости от объема дисков, которые вы собираетесь использовать.
2. Убедитесь, что вы можете считывать и записывать на жесткий диск, который будет предоставлен для задания экспорта.

### <a name="create-the-export-job"></a>Создание задания экспорта
1. Чтобы создать задание экспорта, на портале Azure выберите "Дополнительные службы -> Хранилище -> Import/export jobs" (Задания импорта и экспорта). Нажмите кнопку **Create Import/export Job** (Создать задание импорта или экспорта).
2. На шаге 1 "Основные сведения" выберите Export from Azure (Экспорт из Azure), введите строку для имени задания, выберите подписку, введите или выберите группу ресурсов. Введите описательное имя для задания импорта. Обратите внимание,что вводимое имя может содержать только строчные буквы, цифры, дефисы и подчеркивания, кроме того, оно должно начинаться с буквы и не содержать пробелов. Выбранное имя будет использоваться для отслеживания выполняемых заданий, а также после их завершения. Предоставьте контактные сведения лица, ответственного за это задание экспорта. 

3. На шаге 2 "Основные сведения о задании" выберите учетную запись хранения, в которую данные будут экспортированы из раздела учетной записи хранения. Расположение места назначения будет автоматически заполнено с учетом выбранной области учетной записи хранения. Укажите, какие данные больших двоичных объектов необходимо экспортировать из своей учетной записи хранения на пустой диск или диски. Можно экспортировать все данные blob-объектов в учетной записи хранения или выбрать blob-объекты, или их наборы.
   
   Чтобы указать blob-объект для экспорта, используйте селектор **Равно** и укажите относительный путь к blob-объекту, начиная с имени контейнера. Используйте *$root* для указания корневого контейнера.
   
   Чтобы указать все blob-объекты, начинающиеся с префикса, используйте селектор **Начинается с** и укажите префикс, которому предшествует косая черта "/". Префикс может являться префиксом имени контейнера, полным именем контейнера или полным именем контейнера с префиксом имени blob-объекта.
   
   В следующей таблице приведены примеры допустимых путей к большим двоичным объектам.
   
   | Выбор | Путь к BLOB-объекту | ОПИСАНИЕ |
   | --- | --- | --- |
   | Начинается с |/ |Экспорт всех blob-объектов в учетной записи хранения |
   | Начинается с |/$root/ |Экспорт всех blob-объектов в корневом контейнере |
   | Начинается с |/book |Экспортирует все blob-объекты в любом контейнере, который начинается с префикса **book** |
   | Начинается с |/music/ |Экспортирует все blob-объекты в контейнере **music** |
   | Начинается с |/music/love |Экспортирует все большие двоичные объекты в контейнере **music**, которые начинаются с префикса **love** |
   | Равно |$root/logo.bmp |Экспортирует blob-объект **logo.bmp** в корневом контейнере |
   | Равно |videos/story.mp4 |Экспортирует большой двоичный объект **story.mp4** в контейнере **videos** |
   
   Чтобы избежать ошибок во время обработки, необходимо указать пути к большим двоичным объектам в допустимом формате, как показано на приведенном ниже снимке экрана.
   
   ![Создание задание экспорта – шаг 3](./media/storage-import-export-service/export-job-03.png)

4. На шаге 3 в разделе "Сведения о возврате" выберите перевозчик из раскрывающегося списка и введите его доступный номер учетной записи, созданной с помощью этого перевозчика. Майкрософт будет использовать эту учетную запись для отправки дисков обратно после завершения задания импорта. Укажите полное и допустимое имя контактного лица, телефон, адрес электронной почты, адрес, город, почтовый индекс, страну (провинцию) и страну (регион).
   
 5. На странице "Сводка" предоставляется адрес доставки центра данных Azure для доставки дисков в Azure DC. Убедитесь, что в метке доставки упомянуто имя задания и полный адрес. 

6. Нажмите кнопку ОК, на странице "Сводка", чтобы завершить создание задания импорта.

7. После отправки дисков вернитесь на страницу **импорта или экспорта** на портале Azure: а) найдите и щелкните задание импорта; б) щелкните **Update job status and tracking info once drives are shipped** (Обновить сведения о состоянии задания и отслеживания после отправления дисков); 
     в) установите флажок Mark as shipped (Пометить как отправленный); г) укажите номер перевозчика и отслеживания.
    
   Если номер отслеживания не обновляется в течение 2 недель с момента создания задания, срок действия задания истекает.
   
8. Ход выполнения задания можно отслеживать на панели мониторинга портала. Описание каждого состояния см. в разделе [Просмотр состояния задания](#viewing-your-job-status).

   > [!NOTE]
   > Если BLOB-объекты для экспорта используются во время копирования на жесткий диск, служба "Импорт и экспорт Azure" сделает снимок большого двоичного объекта и скопируют моментальный снимок.
   > 
   > 
 
9. После получения дисков с экспортированными данными вы можете просмотреть и скопировать ключи BitLocker, сгенерированные службой для вашего диска. Перейдите к заданию экспорта на портале Azure и щелкните вкладку "Импорт и экспорт". Выберите задание экспорта из списка и выберите параметр "Ключи BitLocker". Ключи BitLocker отображаются, как показано ниже:
   
   ![Просмотр ключей BitLocker для задания экспорта](./media/storage-import-export-service/export-job-bitlocker-keys.png)

Просмотрите раздел часто задаваемых вопросов, в котором рассматриваются наиболее распространенные вопросы, возникающие у клиентов при работе с этой службой.

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

**Можно ли скопировать хранилище файлов Azure с помощью службы "Импорт и экспорт Azure"?**

Да, служба "Импорт и экспорт Azure" поддерживает импорт в хранилище файлов Azure. Сейчас экспорт файлов Azure не поддерживается.

**Доступна ли служба "Импорт и экспорт Azure" для подписок CSP?**

Служба "Импорт и экспорт Azure" поддерживает подписки CSP.

**Можно ли пропустить этап подготовки диска для задания импорта или подготовить диск без копирования?**

Каждый диск, который вы собираетесь отправить для импорта данных, необходимо подготовить с помощью средства WAImportExport. Используйте это средство, чтобы копировать данные на диск.

**Нужно ли провести какую-либо подготовку диска при создании задания экспорта?**

Нет, но рекомендуется использовать некоторые предварительные проверки. Проверьте необходимое количество дисков с помощью команды PreviewExport средства WAImportExport. Дополнительные сведения см. в разделе [Предварительный просмотр использования дисков для задания экспорта](https://msdn.microsoft.com/library/azure/dn722414.aspx). Это позволяет просмотреть использование диска для выбранных больших двоичных объектов в зависимости от объема дисков, которые вы собираетесь использовать. Убедитесь также, что вы можете считывать и записывать на жесткий диск, который будет предоставлен для задания экспорта.

**Что произойдет, если я случайно отправлю диски, которые не соответствуют требованиям поддержки?**

Центр обработки данных Azure вернет диски, которые не соответствуют требованиям поддержки. Если только некоторые диски в посылке соответствуют требованиям поддержки, эти диски будут обработаны, а диски, не соответствующие требованиям, будут возвращены вам.

**Можно ли отменить свое задание?**

Можно отменить задание, если его состояние указано как "Создание" или "Отправка".

**Как долго на портале Azure отображаются состояния выполненных заданий?**

Состояние выполненных заданий можно просматривать в течение 90 дней. Через 90 дней завершенные задания будут удалены.

**Что мне нужно делать, чтобы импортировать или экспортировать более 10 дисков?**

В предварительной версии службы "Импорт и экспорт" в рамках одного задания импорта или экспорта может обрабатываться только 10 дисков. Если необходимо поставить более 10 дисков, можно создать несколько заданий. Диски, связанные с одним и тем же заданием, необходимо отправлять одним пакетом.
Корпорация Майкрософт предлагает руководство и справку, если емкость данных охватывает несколько заданий импорта дисков. Дополнительные сведения можно получить по адресу bulkimport@microsoft.com.

**Форматируете ли вы диски перед их возвращением?**

Нет. Все диски шифруются по технологии BitLocker.

**Можно ли приобрести диски для заданий импорта и экспорта у корпорации Майкрософт?**

Нет. Необходимо предоставлять собственные диски для заданий импорта и экспорта.

** Каким образом можно получить доступ к импортируемым службой данным**

Доступ к данным вашей учетной записи хранения Azure можно получить на портале Azure или с помощью автономного инструмента под названием обозреватель хранилищ. https://docs.microsoft.com/azure/vs-azure-tools-storage-manage-with-storage-explorer 

**Как будут выглядеть мои данные в учетной записи хранения после завершения задания импорта? Сохранится ли иерархия моих каталогов?** 

При подготовке жесткого диска к заданию импорта место назначения определяется параметром /DstBlobPathOrPrefix в CSV-файле набора данных. Это целевой контейнер в учетной записи хранения, в который копируются данные с жесткого диска. В целевом контейнере для папок с жесткого диска создаются виртуальные каталоги, а для файлов — большие двоичные объекты. 

**Если на диске есть файлы, уже существующие в учетной записи хранения, будут ли они перезаписаны службой?**

При подготовке диска можно указать, нужно ли перезаписать целевые файлы или игнорировать совпадения. Для этого в CSV-файле набора данных укажите соответствующее значение параметра Disposition (rename, no-overwrite, overwrite). По умолчанию служба переименовывает новые файлы, а не перезаписывает существующие большие двоичные объекты или файлы.

**Совместимо ли средство WAImportExport с 32-разрядной операционной системой Windows?**
Нет. Средство WAImportExport совместимо только с 64-разрядной операционной системой Windows. Полный список поддерживаемых версий ОС см. в разделе [Предварительные требования](#pre-requisites).

**Нужно ли отправлять вместе с жесткими дисками что-то еще?**

Отправляйте только жесткие диски. Не посылайте ничего другого, например, кабели питания или USB-кабели.

**Обязательно ли отправлять диски через FedEx или DHL?**

Вы можете отправлять диски в центр обработки данных через любую транспортную компанию, включая FedEx, DHL и UPS, или почтовое ведомство США. При этом для возврата дисков из центра обработки данных необходимо указать номер учетной записи FedEx в США и Европе или DHL в Азии и Австралии.

**Существуют ли ограничения на международную пересылку дисков?**

Обратите внимание, что отправляемые физические носители могут пересекать международные границы. Вы несете ответственность за то, что ваши физические носители и данные импортируются и (или0 экспортируются в соответствии с действующим законодательством. Перед отправкой физических носителей проконсультируйтесь и удостоверьтесь, что они эти носители и данные могут быть отправлены в определенный центр обработки данных на законных основаниях. Это поможет Майкрософт своевременно получить посылку.

**При создании задания был указан адрес доставки, который отличается от расположения учетной записи хранения. Что делать?**

Некоторые расположения учетных записей хранения сопоставляются с альтернативными расположениями доставки. Ранее доступные места доставки можно было также временно сопоставить с другими расположениями. Перед отправкой дисков обязательно проверяйте адрес доставки, указанный при создании задания.

**При отправке диска транспортный агент запрашивает адрес и номер телефона контактного лица в центре обработки данных. Что нужно указать?**

Номер телефона и адрес контактного лица в центре обработки данных предоставляется в ходе создания задания.

**Можно ли использовать службу "Импорт и экспорт Azure" для копирования почтовых ящиков PST и данных SharePoint в Office 365?**

Дополнительные сведения см. в статье [Общие сведения об импорте PST-файлов и данных SharePoint в Office 365](https://technet.microsoft.com/library/ms.o365.cc.ingestionhelp.aspx).

**Можно ли использовать службу "Импорт и экспорт Azure" для копирования резервных копий в службу архивации Azure в автономном режиме?**

Дополнительные сведения см. в статье [Автономное резервное копирование в службе архивации Azure](../../backup/backup-azure-backup-import-export.md).

**Каково максимальное количество жестких дисков для одной отгрузки?**

Отгрузка может включать любое количество жестких дисков. Если диски принадлежат к нескольким заданиям, мы рекомендуем, чтобы диски были помечены соответствующими именами заданий, или обновить задания с использованием номера для отслеживания, который заканчивается суффиксом -1, -2 и т. д.
  
**Какой максимальный размер блочного BLOB-объекта и страничного BLOB-объекта, поддерживаемый службой импорта и экспорта дисков?**

Максимальный размер блочного BLOB-объекта составляет 4768 ТБ или 5 000 000 МБ.
А максимальный размер страничного BLOB-объекта равен 1 ТБ.

**Поддерживает ли служба импорта и экспорта дисков шифрование AES 256?**

Служба "Импорт и экспорт Azure" по умолчанию шифрует данные с помощью шифрования Bitlocker AES 128, однако уровень шифрования можно повысить до AES 256 путем шифрования данных вручную с помощью Bitlocker, перед тем как скопировать их. 

Ниже приведен пример команды при использовании средства [WAImportExport V1](http://download.microsoft.com/download/0/C/D/0CD6ABA7-024F-4202-91A0-CE2656DCE413/WaImportExportV1.zip)
```
WAImportExport PrepImport /sk:<StorageAccountKey> /csas:<ContainerSas> /t: <TargetDriveLetter> [/format] [/silentmode] [/encrypt] [/bk:<BitLockerKey>] [/logdir:<LogDirectory>] /j:<JournalFile> /id:<SessionId> /srcdir:<SourceDirectory> /dstdir:<DestinationBlobVirtualDirectory> [/Disposition:<Disposition>] [/BlobType:<BlockBlob|PageBlob>] [/PropertyFile:<PropertyFile>] [/MetadataFile:<MetadataFile>] 
```
При использовании [средства WAImportExport](http://download.microsoft.com/download/3/6/B/36BFF22A-91C3-4DFC-8717-7567D37D64C5/WAImportExport.zip) укажите "AlreadyEncrypted" и введите ключ в CSV-файл набора дисков.
```
DriveLetter,FormatOption,SilentOrPromptOnFormat,Encryption,ExistingBitLockerKey
G,AlreadyFormatted,SilentMode,AlreadyEncrypted,060456-014509-132033-080300-252615-584177-672089-411631 |
```
## <a name="next-steps"></a>Дополнительная информация

* [Using the Azure Import/Export Tool](storage-import-export-tool-how-to.md) (Использование средства импорта и экспорта Azure)
* [Приступая к работе со служебной программой командной строки AzCopy](storage-use-azcopy.md)
* [Пример REST API службы импорта и экспорта Azure](https://azure.microsoft.com/documentation/samples/storage-dotnet-import-export-job-management/)

