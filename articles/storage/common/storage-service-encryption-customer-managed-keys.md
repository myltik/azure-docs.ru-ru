---
title: "Шифрование службы хранилища Azure с помощью управляемых клиентом ключей в Azure Key Vault | Документация Майкрософт"
description: "Используйте функцию шифрования службы хранилища Azure для шифрования хранилища BLOB-объектов Azure на стороне службы при сохранении данных и его расшифровки при извлечении данных с помощью управляемых клиентом ключей."
services: storage
documentationcenter: .net
author: lakasa
manager: jahogg
editor: tysonn
ms.assetid: 
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/07/2017
ms.author: lakasa
ms.openlocfilehash: 6d1e6752fb631114f5be06cb27a63e40547bf6ca
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="storage-service-encryption-using-customer-managed-keys-in-azure-key-vault"></a>Шифрование службы хранилища с помощью управляемых клиентом ключей в Azure Key Vault

Microsoft Azure прилагает все усилия, чтобы защитить данные согласно обязательствам по безопасности и соответствию, установленным в вашей организации.  Один из способов защиты неактивных данных — использование функции шифрования службы хранилища (SSE), которая автоматически шифрует данные при записи в хранилище и расшифровывает их при извлечении. Шифрование и расшифровка выполняются автоматически и полностью прозрачно. Для этого используется 256-битный [алгоритм шифрования AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard) — один из наиболее сложных среди доступных блочных шифров.

Можно использовать ключи шифрования с SSE, управляемые корпорацией Майкрософт, или собственные ключи шифрования. В этой статье рассматриваются собственные ключи шифрования. Дополнительные сведения об использовании ключей, управляемых корпорацией Майкрософт, и о SSE в целом см. в статье [Шифрование службы хранилища Azure для неактивных данных (предварительная версия)](../storage-service-encryption.md).

Чтобы обеспечить возможность использования собственных ключей шифрования, функция SSE для хранилища BLOB-объектов интегрирована с Azure Key Vault (AKV). Можно создать собственные ключи шифрования и сохранить их в AKV или использовать интерфейсы API AKV, чтобы генерировать ключи шифрования. AKV позволяет не только управлять ключами и контролировать их, он и выполнять аудит использования ключей. 

Зачем нужно создать собственные ключи? Это обеспечивает большую гибкость, позволяя создавать, сменять, отключать и определять элементы управления доступом, а также дает возможность выполнять аудит ключей шифрования, используемых для защиты данных.

## <a name="sse-with-customer-managed-keys-preview"></a>Предварительная версия SSE для управляемых клиентом ключей

Эта функция в настоящее время находится на стадии предварительной версии. Чтобы использовать ее, нужно создать новую учетную запись хранения. Можно создать новое Key Vault и ключ или использовать существующие. Учетная запись хранения и Key Vault должны быть расположены в одном регионе, но могут находиться в разных подписках.

Чтобы использовать предварительную версию, свяжитесь с нами по адресу [ssediscussions@microsoft.com](mailto:ssediscussions@microsoft.com). Мы предоставим специальную ссылку для использования предварительной версии.

Дополнительные сведения см. в разделе [вопросов и ответов](#frequently-asked-questions-about-storage-service-encryption-for-data-at-rest).

> [!IMPORTANT]
> Прежде чем выполнять инструкции в этой статье, необходимо зарегистрироваться для использования предварительной версии. Без доступа к предварительной версии вы не сможете включить эту функцию на портале.

## <a name="getting-started"></a>Приступая к работе
## <a name="step-1-create-a-new-storage-accountstorage-create-storage-accountmd"></a>Этап 1. [Создание учетной записи хранения](../storage-create-storage-account.md)

## <a name="step-2-enable-encryption"></a>Этап 2. Включение шифрования
Включить SSE для учетной записи хранения можно на [портале Azure](https://portal.azure.com). В колонке "Параметры" для учетной записи хранения найдите раздел "Служба BLOB-объектов", как показано на рисунке ниже, и щелкните "Шифрование".

![Снимок экрана портала с параметром шифрования](./media/storage-service-encryption-customer-managed-keys/ssecmk1.png)
<br/>*Включение SSE для службы BLOB-объектов*

Если вы хотите включить или отключить шифрование службы хранилища для учетной записи хранения с помощью программных средств, вы можете использовать [REST API поставщика ресурсов службы хранилища Azure](https://docs.microsoft.com/en-us/rest/api/storagerp/?redirectedfrom=MSDN), [клиентскую библиотеку поставщика ресурсов хранилища для .NET](https://docs.microsoft.com/en-us/dotnet/api/?redirectedfrom=MSDN), [Azure PowerShell](https://docs.microsoft.com/en-us/powershell/azure/overview?view=azurermps-4.0.0) или [Azure CLI](https://docs.microsoft.com/en-us/azure/storage/storage-azure-cli).

Если на этом экране не отображается флажок "Использовать собственный ключ", значит, вы не получили утверждение для использования предварительной версии. Отправьте письмо на электронный адрес [ssediscussions@microsoft.com](mailto:ssediscussions@microsoft.com) и подайте запрос на утверждение.

![Снимок экрана портала с окном предварительной версии SSE](./media/storage-service-encryption-customer-managed-keys/ssecmk1.png)

По умолчанию SSE использует ключи, управляемые корпорацией Майкрософт. Чтобы использовать собственные ключи, установите флажок. Затем можно либо указать универсальный код ресурса (URI) ключа, либо выбрать ключ и Key Vault в средстве выбора.

## <a name="step-3-select-your-key"></a>Шаг 3. Выбор ключа

![Снимок экрана портала с окном SSE, в котором выбрано использование собственного ключа](./media/storage-service-encryption-customer-managed-keys/ssecmk2.png)

![Снимок экрана портала с окном SSE, в котором выбрано указание универсального кода ресурса (URI) ключа](./media/storage-service-encryption-customer-managed-keys/ssecmk3.png)

Если у учетной записи хранения нет доступа к Key Vault, можно выполнить приведенную ниже команду Azure PowerShell, чтобы предоставить учетным записям хранения доступ к требуемому Key Vault.

![Снимок экрана портала, показывающий отказ в доступе к Key Vault](./media/storage-service-encryption-customer-managed-keys/ssecmk4.png)

Можно также предоставить доступ с помощью портала Azure, перейдя к Azure Key Vault на портале Azure и предоставив доступ учетной записи хранения.

## <a name="step-4-copy-data-to-storage-account"></a>Шаг 4. Копирование данных в учетную запись хранения
Чтобы передать данные в учетную запись хранения для шифрования, ознакомьтесь с шагом 3 статьи [Шифрование службы хранилища Azure для неактивных данных (предварительная версия)](https://docs.microsoft.com/en-us/azure/storage/storage-service-encryption#step-3-copy-data-to-storage-account).

## <a name="step-5-query-the-status-of-the-encrypted-data"></a>Шаг 5. Запрос состояния зашифрованных данных
Чтобы подать запрос на состояние зашифрованных данных, ознакомьтесь с шагом 4 статьи [Шифрование службы хранилища Azure для неактивных данных (предварительная версия)](https://docs.microsoft.com/en-us/azure/storage/storage-service-encryption#step-4-query-the-status-of-the-encrypted-data).

## <a name="frequently-asked-questions-about-storage-service-encryption-for-data-at-rest"></a>Часто задаваемые вопросы о шифровании службы хранилища для неактивных данных
**Вопрос. Я использую хранилище уровня "Премиум". Могу ли я использовать функцию SSE с управляемыми клиентом ключами?**

Ответ. Да, функцию SSE можно использовать с ключами, управляемыми корпорацией Майкрософт, и управляемыми клиентом ключами в хранилищах уровня "Стандартный" и "Премиум". 

**Вопрос. Можно ли создавать учетные записи хранения с включенной функцией SSE, используя управляемые клиентом ключи, с помощью Azure PowerShell и Azure CLI?**

Ответ. Да.

**Вопрос. Насколько дороже обходится служба хранилища Azure с включенной функцией SSE, использующей управляемые клиентом ключи?**

Ответ. Вы платите за использование Azure Key Vault. Дополнительные сведения см. на [странице цен на Key Vault](https://azure.microsoft.com/en-us/pricing/details/key-vault/). За использование SSE дополнительная плата не требуется.

**Вопрос. Можно ли отменить доступ к ключам шифрования?**

Ответ. Да, вы можете отменить доступ в любое время. Отменить доступ к ключам можно несколькими способами. Чтобы получить дополнительные сведения, обратитесь к разделам [Azure​RM.​Key​Vault](https://docs.microsoft.com/en-us/powershell/module/azurerm.keyvault/?view=azurermps-4.0.0) и [Key Vault - az keyvault](https://docs.microsoft.com/en-us/cli/azure/keyvault). Отмена доступа фактически заблокирует доступ ко всем большим двоичным объектам в учетной записи хранения, так как ключ шифрования учетной записи станет недоступен службе хранилища Azure.

**Вопрос. Могу ли я создать учетную запись хранения и ключ в разных регионах?**

Ответ. Нет, учетная запись хранения, Key Vault и ключ должны находиться в одном регионе. 

**Вопрос. Могу ли я включить функцию SSE с управляемыми клиентом ключами при создании учетной записи хранения?**

О. Нет. При включении функции SSE во время создания учетной записи хранения можно использовать только ключи, управляемые корпорацией Майкрософт. Чтобы использовать управляемые клиентом ключи, вам потребуется обновить свойства учетной записи хранения. Вы можете использовать REST или одну из клиентских библиотек службы хранилища, чтобы обновить учетную запись хранения программными средствами. Также можно обновить свойства учетной записи хранения с помощью портала Azure после ее создания.

**Вопрос. Могу ли я отключить шифрование при использовании функции SSE с управляемыми клиентом ключами?**

Ответ. Нет, при использовании функции SSE с управляемыми клиентом ключами отключить шифрование невозможно. Чтобы отключить шифрование, необходимо перейти к использованию ключей, управляемых корпорацией Майкрософт. Это можно сделать на портале Azure или с помощью PowerShell.

**Вопрос. Включается ли SSE по умолчанию при создании учетной записи хранения?**

Ответ. SSE включается по умолчанию. Для включения можно использовать портал Azure. Можно также включить эту функцию программно с помощью REST API поставщика ресурсов хранилища. 

**Вопрос. Не удается включить шифрование для учетной записи хранения.**

Ответ. Это учетная запись Resource Manager? Классические учетные записи хранения не поддерживаются. Кроме того, функцию SE с управляемыми клиентом ключами можно включить только для созданных новых учетных записей хранения Resource Manager.

**Вопрос. Функция SSE с управляемыми клиентом ключами доступна только в определенных регионах?**

Ответ. Функция SSE доступна только в определенных регионах для хранилища BLOB-объектов в рамках этой предварительной версии. Отправьте письмо на адрес [ssediscussions@microsoft.com](mailto:ssediscussions@microsoft.com), чтобы проверить доступность и получить дополнительные сведения о предварительной версии. 

**Вопрос. Куда обратиться, чтобы задать вопрос или оставить отзыв?**

Ответ. По любым вопросам, связанным с шифрованием службы хранилища, обращайтесь по адресу [ssediscussions@microsoft.com](mailto:ssediscussions@microsoft.com). 

## <a name="next-steps"></a>Дальнейшие действия

*   Дополнительные сведения о комплексном наборе функций, помогающем разработчикам создавать безопасные приложения, см. в разделе [Руководство по безопасности службы хранилища Azure](https://docs.microsoft.com/en-us/azure/storage/storage-security-guide).
*   Общие сведения о Azure Key Vault см. в статье [Что такое хранилище ключей Azure?](https://docs.microsoft.com/en-us/azure/key-vault/key-vault-whatis)
*   О том, как приступить к работе с Azure Key Vault, рассказывается в разделе [Приступая к работе с хранилищем ключей Azure](../../key-vault/key-vault-get-started.md).
