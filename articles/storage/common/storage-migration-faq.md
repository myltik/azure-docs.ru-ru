---
title: Часто задаваемые вопросы о миграции службы хранилища Azure | Документация Майкрософт
description: Ответы на наиболее частые вопросы, связанные с миграцией службы хранилища Azure
services: storage
documentationcenter: na
author: genlin
manager: timlt
editor: tysonn
ms.service: storage
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage
ms.date: 05/11/2018
ms.author: genli
ms.openlocfilehash: 12172c53e8e5077f9690a2459bf5ccf3c3a05507
ms.sourcegitcommit: c52123364e2ba086722bc860f2972642115316ef
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2018
ms.locfileid: "34071396"
---
# <a name="frequently-asked-questions-about-azure-storage-migration"></a>Часто задаваемые вопросы о миграции службы хранилища Azure

Эта статья содержит ответы на часто задаваемые вопросы о миграции службы хранилища Azure. 

## <a name="faq"></a>Часто задаваемые вопросы

**Как создать сценарий для копирования файлов из одного контейнера в другой?**

Для копирования файлов между контейнерами можно использовать AzCopy. Как в этом примере:

    AzCopy /Source:https://xxx.blob.core.windows.net/xxx
    /Dest:https://xxx.blob.core.windows.net/xxx /SourceKey:xxx /DestKey:xxx
    /S

AzCopy использует [API копирования больших двоичных объектов](https://docs.microsoft.com/rest/api/storageservices/copy-blob) для копирования каждого файла в контейнере.  
  
Вы можете использовать любую виртуальную машину или локальный компьютер с доступом в Интернет для запуска AzCopy. Можно также использовать планирование пакетной службы Azure, чтобы сделать это автоматически, но это сложнее.  
  
Скрипт автоматизации предназначен для развертывания Azure Resource Manager вместо операций с содержимым хранилища. Дополнительные сведения см. в статье [Развертывание ресурсов с использованием шаблонов Resource Manager и Azure PowerShell](../../azure-resource-manager/resource-group-template-deploy.md).

**Существует ли какая-либо плата за копирование данных между двумя файловыми ресурсами в одной учетной записи хранения в одном регионе?**

Нет. Этот процесс является бесплатным.

**Как создать резервную копию всей учетной записи хранения в другой учетной записи?**

Нет возможности напрямую выполнить резервное копирование всей учетной записи хранения. Однако вы можете вручную переместить контейнер в этой учетной записи в другую учетную запись, используя AzCopy или обозреватель службы хранилища. Далее показано, как использовать AzCopy для перемещения контейнера:  
 

1.  Установите программу командной строки [AzCopy](storage-use-azcopy.md). Она помогает перемещать файл VHD между учетными записями.

2.  После установки AzCopy в Windows с помощью установщика откройте окно командной строки, а затем перейдите в папку установки AzCopy на своем компьютере. По умолчанию AzCopy устанавливается в **%ProgramFiles(x86)%\Microsoft SDKs\Azure\AzCopy** или **%ProgramFiles%\Microsoft SDKs\Azure\AzCopy**.

3.  Затем выполните следующую команду, чтобы переместить контейнер. Замените текст фактическими значениями.   
     
            AzCopy /Source:https://sourceaccount.blob.core.windows.net/mycontainer1
            /Dest:https://destaccount.blob.core.windows.net/mycontainer2
            /SourceKey:key1 /DestKey:key2 /S

    - `/Source`: укажите URI для исходной учетной записи хранения (к контейнеру).  
    - `/Dest`: укажите URI для целевой учетной записи хранения (к контейнеру).  
    - `/SourceKey`: укажите первичный ключ для исходной учетной записи хранения. Этот ключ можно скопировать на портале Azure, выбрав учетную запись хранения.  
    - `/DestKey`: укажите первичный ключ для целевой учетной записи хранения. Этот ключ можно скопировать на портале, выбрав учетную запись хранения.

После запуска этой команды файлы контейнера перемещаются в целевую учетную запись хранения.

> [!NOTE]
> CLI AzCopy не работает вместе с переключателем **Шаблон**, когда вы выполняете копирование из одного большого двоичного объекта Azure в другой.
>
> Вы можете непосредственно скопировать и изменить команду AzCopy и перекрестно проверить, что **шаблон** соответствует источнику. Также убедитесь, что подстановочные знаки **/S** работают. Дополнительные сведения см. в статье [Перенос данных с помощью AzCopy для Windows](storage-use-azcopy.md).

**Как перенести данные из одного контейнера хранилища в другой?**

Выполните следующие действия.

1.  Создайте контейнер (папку) в большом двоичном объекте назначения.

2.  Используйте [Azcopy](https://azure.microsoft.com/blog/azcopy-5-1-release/), чтобы скопировать содержимое из исходного контейнера больших двоичных объектов в другой контейнер больших двоичных объектов.

**Как создать скрипт PowerShell для перемещения данных из общего файлового ресурса Azure в другое хранилище Azure?**

Используйте AzCopy для перемещения данных из одного общего файлового ресурса Azure в другой в хранилище Azure. Дополнительные сведения см. в статьях [Перенос данных с помощью AzCopy для Windows](storage-use-azcopy.md) и [Перенос данных с помощью AzCopy для Linux](storage-use-azcopy-linux.md).

**Как отправить большие CSV-файлы в хранилище Azure?**

Используйте AzCopy для передачи больших CSV-файлов в хранилище Azure. Дополнительные сведения см. в статьях [Перенос данных с помощью AzCopy для Windows](storage-use-azcopy.md) и [Перенос данных с помощью AzCopy для Linux](storage-use-azcopy-linux.md).

**Мне нужно каждый день перемещать журналы с диска D в свою учетную запись Azure. Как можно автоматизировать этот процесс?**

Это можно сделать с помощью команды AzCopy и создания задачи в планировщике. Отправьте файлы в учетную запись Azure с помощью пакетного скрипта AzCopy. Дополнительные сведения см. в статье [Как настроить и выполнить задачи при запуске для облачной службы](../../cloud-services/cloud-services-startup-tasks.md).

**Как переместить мою учетную запись хранения между подписками?**

Чтобы переместить учетную запись хранения между подписками, используйте AzCopy. Дополнительные сведения см. в статьях [Перенос данных с помощью AzCopy для Windows](storage-use-azcopy.md) и [Перенос данных с помощью AzCopy для Linux](storage-use-azcopy-linux.md).

**Как поместить около 10 ТБ данных в хранилище в другом регионе?**

Используйте AzCopy для перемещения данных. Дополнительные сведения см. в статьях [Перенос данных с помощью AzCopy для Windows](storage-use-azcopy.md) и [Перенос данных с помощью AzCopy для Linux](storage-use-azcopy-linux.md).

**Как скопировать данные из локальной среды в хранилище Azure?**

Используйте AzCopy для копирования данных. Дополнительные сведения см. в статьях [Перенос данных с помощью AzCopy для Windows](storage-use-azcopy.md) и [Перенос данных с помощью AzCopy для Linux](storage-use-azcopy-linux.md).

**Как перенести данные из локальной среды в файлы Azure?**

Используйте AzCopy для перемещения данных. Дополнительные сведения см. в статьях [Перенос данных с помощью AzCopy для Windows](storage-use-azcopy.md) и [Перенос данных с помощью AzCopy для Linux](storage-use-azcopy-linux.md).

**Как сопоставить папку контейнера на виртуальной машине?**

Используйте файловый ресурс Azure.

**Как создать резервную копию файлового хранилища Azure?**

Решение для резервного копирования отсутствует. Однако служба файлов Azure также поддерживает асинхронное копирование. Скопировать файлы можно таким образом:

- из одного общего ресурса в другой в пределах учетной записи хранения или в другой учетной записи хранения;

- из общего ресурса в большой двоичный объект в пределах учетной записи хранения или в другой учетной записи хранения.

Дополнительные сведения см. в статье [Перенос данных с помощью AzCopy для Windows](storage-use-azcopy.md).

**Как переместить управляемые диски в другую учетную запись хранения?**

Выполните следующие действия.

1.  Остановите виртуальную машину, к которой подключен управляемый диск.

2.  Скопируйте управляемый диск VHD из одного региона в другой, выполнив следующий сценарий Azure PowerShell:

    ```
    Connect-AzureRmAccount

    Select-AzureRmSubscription -SubscriptionId <ID>

    $sas = Grant-AzureRmDiskAccess -ResourceGroupName <RG name> -DiskName <Disk name> -DurationInSecond 3600 -Access Read

    $destContext = New-AzureStorageContext –StorageAccountName contosostorageav1 -StorageAccountKey <your account key>

    Start-AzureStorageBlobCopy -AbsoluteUri $sas.AccessSAS -DestContainer 'vhds' -DestContext $destContext -DestBlob 'MyDestinationBlobName.vhd'
    ```

3.  Создайте управляемый диск, используя файл VHD в другом регионе, в который вы скопировали VHD. Это можно сделать с помощью следующего скрипта Azure PowerShell.  

    ```
    $resourceGroupName = 'MDDemo'

    $diskName = 'contoso\_os\_disk1'

    $vhdUri = 'https://contoso.storageaccou.com.vhd

    $storageId = '/subscriptions/<ID>/resourceGroups/<RG name>/providers/Microsoft.Storage/storageAccounts/contosostorageaccount1'

    $location = 'westus'

    $storageType = 'StandardLRS'

    $diskConfig = New-AzureRmDiskConfig -AccountType $storageType -Location $location -CreateOption Import -SourceUri $vhdUri -StorageAccountId $storageId -DiskSizeGB 128

    $osDisk = New-AzureRmDisk -DiskName $diskName -Disk $diskConfig -ResourceGroupName $resourceGroupName
    ``` 

Дополнительные сведения о развертывании виртуальной машины из управляемого диска см. на странице [CreateVmFromManagedOsDisk.ps1](https://github.com/Azure-Samples/managed-disks-powershell-getting-started/blob/master/CreateVmFromManagedOsDisk.ps1).

**Как загрузить от 1 до 2 ТБ данных на портале Azure?**

Используйте AzCopy для загрузки данных. Дополнительные сведения см. в статьях [Перенос данных с помощью AzCopy для Windows](storage-use-azcopy.md) и [Перенос данных с помощью AzCopy для Linux](storage-use-azcopy-linux.md).

**Как изменить вторичное местоположение в регионе "Европа" для учетной записи хранения?**

При создании учетной записи хранения вы выбираете первичный регион для учетной записи. Выбор вторичного региона определяется на основе первичного региона, его невозможно изменить. Дополнительные сведения см. в статье [Репликация службы хранилища Azure](storage-redundancy.md).

**Где можно получить дополнительную информацию о шифровании службы хранилища Azure (SSE)?**.  
  
Ознакомьтесь со следующими статьями:

-  [Руководство по безопасности службы хранилища Azure](storage-security-guide.md)

-  [Шифрование службы хранилища Azure для неактивных данных (предварительная версия)](storage-service-encryption.md)

**Как переместить или загрузить данные из учетной записи хранения?**

Используйте AzCopy для загрузки данных. Дополнительные сведения см. в статьях [Перенос данных с помощью AzCopy для Windows](storage-use-azcopy.md) и [Перенос данных с помощью AzCopy для Linux](storage-use-azcopy-linux.md).


**Как выполнить шифрование данных в хранилище файлов?**

После включения шифрования в учетной записи хранения имеющиеся данные не шифруются. Чтобы выполнить шифрование имеющихся данных, необходимо снова передать их в учетную запись хранения.

Используйте AZcopy, чтобы скопировать данные в другую учетную запись хранения, а затем переместите данные обратно. Можно также использовать [шифрование неактивных данных](storage-service-encryption.md).

**Как скачать VHD на локальный компьютер (варианты кроме скачивания на портале)?**

Можно использовать [обозреватель хранилища](https://azure.microsoft.com/features/storage-explorer/) для скачивания VHD.

**Существуют ли какие-либо предварительные требования для изменения репликации учетной записи хранения из геоизбыточного хранилища на локально избыточное хранилище?**

Нет. 

**Как получить доступ к резервному хранилищу службы файлов Azure?**

Для доступа к избыточному хранилищу требуется геоизбыточное хранилище с доступом для чтения. Однако служба файлов Azure поддерживает только локально избыточное хранилище и стандартное геоизбыточное хранилище, которое не дает доступ только для чтения. 

**Как перейти с использования учетной записи хранения класса Premium на стандартную учетную запись хранения?**

Выполните следующие действия.

1.  Создайте стандартную учетную запись хранения. (Или используйте имеющуюся стандартную учетную запись хранения в своей подписке).

2.  Скачайте AzCopy. Выполните следующие команды AzCopy:
      
    Чтобы скопировать все диски в учетную запись хранения:

        AzCopy /Source:https://sourceaccount.blob.core.windows.net/mycontainer1
        /Dest:https://destaccount.blob.core.windows.net/mycontainer2
        /SourceKey:key1 /DestKey:key2 /S 

    Чтобы скопировать только один диск, введите имя диска в поле **Шаблон**:

        AzCopy /Source:https://sourceaccount.blob.core.windows.net/mycontainer1
        /Dest:https://destaccount.blob.core.windows.net/mycontainer2
        /SourceKey:key1 /DestKey:key2 /Pattern:abc.vhd

   
Для завершения операции может потребоваться несколько часов.

Чтобы убедиться, что передача завершена успешно, нужно проверить контейнер учетной записи целевого хранилища на портале Azure. После копирования дисков в стандартную учетную запись хранения можно подключить их к виртуальной машине в качестве имеющегося диска. Дополнительные сведения см. в статье [Как подключить управляемый диск данных к виртуальной машине Windows на портале Azure](../../virtual-machines/windows/attach-managed-disk-portal.md).  
  
**Как преобразовать общий файловый ресурс в хранилище Azure класса Premium?**

Хранилище класса Premium не предоставляется для общего файлового ресурса Azure.

**Как обновить учетную запись хранения уровня "Стандарт" до учетной записи уровня "Премиум"? Как перейти с использования учетной записи хранения класса Premium на стандартную учетную запись?**

Необходимо создать целевую учетную запись хранения, скопировать данные из исходной учетной записи в целевую учетную запись и удалить исходную учетную запись. Для копирования данных можно использовать такой инструмент, как AzCopy.

При наличии виртуальных машин перед переносом данных учетной записи хранения необходимо предпринять несколько дополнительных шагов. Дополнительные сведения см. в статье [Перенос в хранилище Azure класса Premium (использующее неуправляемые диски)](storage-migration-to-premium-storage.md).

**Как перейти от использования классической учетной записи хранения на учетную запись хранения Azure Resource Manager?**

Вы можете использовать командлет **Move-AzureStorageAccount**. Этот командлет имеет несколько этапов (проверка, подготовка, фиксация). Вы можете проверить перемещение прежде чем выполнить его.

При наличии виртуальных машин перед переносом данных учетной записи хранения необходимо предпринять несколько дополнительных шагов. Дополнительные сведения см. в статье [Перенос ресурсов IaaS из классической модели в модель Azure Resource Manager с помощью Azure PowerShell](../..//virtual-machines/windows/migration-classic-resource-manager-ps.md).

**Как скачать данные на компьютер Linux из учетной записи хранения Azure или передать данные с компьютера Linux?**

Можно использовать Azure CLI.

- Скачивание одного большого двоичного объекта:

      azure storage blob download -k "<Account Key>" -a "<Storage Account Name>" --container "<Blob Container Name>" -b "<Remote File Name>" -d "<Local path where the file will be downloaded to>"

- Отправка одного большого двоичного объекта: 

      azure storage blob upload -k "<Account Key>" -a "<Storage Account Name>" --container "<Blob Container Name>" -f "<Local File Name>"

**Как я могу предоставить другим людям доступ к моим ресурсам хранилища?**

Чтобы предоставить другим людям доступ к ресурсам хранилища, сделайте следующее:

-   Используйте токен SAS для предоставления доступа к ресурсу. 

-   Предоставьте пользователю первичный или вторичный ключ для учетной записи хранения. Дополнительные сведения см. в разделе [Управление учетной записью хранения](storage-create-storage-account.md#manage-your-storage-account).

-   Измените политику доступа, чтобы разрешить анонимный доступ. Дополнительные сведения см. в разделе [Предоставление анонимным пользователям разрешений для контейнеров и больших двоичных объектов](../blobs/storage-manage-access-to-resources.md#grant-anonymous-users-permissions-to-containers-and-blobs).

**Куда устанавливается AzCopy?**

-   Если вы получаете доступ к AzCopy из командной строки службы хранилища Microsoft Azure, введите **AzCopy**. Командная строка устанавливается вместе с AzCopy.

-   Если вы установили 32-разрядную версию, она находится здесь: **%ProgramFiles(x86)%\\Microsoft SDKs\\Azure\\AzCopy**.

-   Если вы установили 64-разрядную версию, она находится здесь: **%ProgramFiles(x86)%\\Microsoft SDKs\\Azure\\AzCopy**.

**Как получить доступ к данным, хранящимся в дополнительном регионе, для реплицированной учетной записи хранения (например, хранилище, избыточное в пределах зоны, геоизбыточное хранилище или географически избыточное хранилище с доступом на чтение)?**

-   Если вы используете хранилище, избыточное в пределах зоны или геоизбыточное хранилище, вы не можете получить доступ к данным из вторичной области, если не произойдет отработка отказа. Дополнительные сведения о процессе отработки отказа см. в разделе [Что произойдет в случае отработки отказа хранилища](storage-disaster-recovery-guidance.md#what-to-expect-if-a-storage-failover-occurs).

-   При использовании геоизбыточного хранилища с доступом на чтение данные доступны из дополнительного региона в любое время. Используйте один из следующих методов.  
      
    - **AzCopy**: добавьте **-secondary** к имени учетной записи хранения в URL-адресе для доступа к дополнительной конечной точке. Например:   
     
      https://storageaccountname-secondary.blob.core.windows.net/vhds/BlobName.vhd

    - **Токен SAS**: используйте токен SAS для доступа к данным из конечной точки. Дополнительные сведения см. в статье [Использование подписанных URL-адресов (SAS)](storage-dotnet-shared-access-signature-part-1.md).

**Как использовать пользовательский домен HTTPS с моей учетной записью хранения? Например, как сделать, чтобы https://mystorageaccountname.blob.core.windows.net/images/image.gif отображалось в виде https://www.contoso.com/images/image.gif?**

SSL в настоящее время не поддерживается в учетных записях хранения с личными доменами.
Однако можно использовать пользовательские домены не HTTPS. Дополнительные сведения см. в статье [Настройка пользовательского доменного имени для конечной точки хранилища BLOB-объектов](../blobs/storage-custom-domain-name.md).

**Как использовать FTP для доступа к данным в учетной записи хранения?**

Невозможно напрямую получить доступ к учетной записи хранилища с помощью FTP. Тем не менее можно настроить виртуальную машину Azure и затем установить на ней FTP-сервер. Файлы хранилища на FTP-сервере могут храниться в общем ресурсе службы файлов Azure или на диске данных, доступном для виртуальной машины.

Если вы хотите только скачивать данные без использования Обозревателя службы хранилища или аналогичного приложения, можно использовать токен SAS. Дополнительные сведения см. в статье [Использование подписанных URL-адресов (SAS)](storage-dotnet-shared-access-signature-part-1.md).

**Как перенести большие двоичные объекты из одной учетной записи хранения в другую?**

 Это можно сделать с помощью нашего [скрипта для переноса BLOB-объектов](../scripts/storage-common-transfer-between-storage-accounts.md).

## <a name="need-help-contact-support"></a>Требуется помощь? Обратитесь в службу поддержки.

Если вам все еще нужна помощь, [обратитесь в службу поддержки](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade), которая поможет быстро устранить проблему.
