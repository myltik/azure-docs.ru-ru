---
title: Подготовка жестких дисков к заданию импорта инструмента импорта и экспорта Azure версии 1 | Документация Майкрософт
description: Узнайте, как подготовить жесткие диски с помощью инструмента WAImportExport версии 1 перед созданием задания импорта в службе импорта и экспорта Azure.
author: muralikk
manager: syadav
editor: tysonn
services: storage
documentationcenter: ''
ms.assetid: 3d818245-8b1b-4435-a41f-8e5ec1f194b2
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/15/2017
ms.author: muralikk
ms.openlocfilehash: 361e16262e528c7dea1bab4b9d945a28af8be399
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
ms.locfileid: "23107852"
---
# <a name="preparing-hard-drives-for-an-import-job"></a>Подготовка жестких дисков для задания импорта
Чтобы подготовить один или несколько жестких дисков к заданию импорта, сделайте следующее:

-   укажите данные для импорта в службу BLOB-объектов;

-   укажите целевые виртуальные каталоги и большие двоичные объекты в службе BLOB-объектов;

-   укажите количество необходимых дисков;

-   скопируйте данные на каждый жесткий диск.

 Пример рабочего процесса см. в статье [Пример рабочего процесса по подготовке жестких дисков для задания импорта](storage-import-export-tool-sample-preparing-hard-drives-import-job-workflow-v1.md).

## <a name="identify-the-data-to-be-imported"></a>Указание данных для импорта
 Чтобы создать задание импорта, прежде всего нужно указать, какие каталоги и файлы будут импортированы. Это может быть список каталогов, список уникальных файлов или оба списка. После добавления каталога все файлы и подкаталоги, содержащиеся в нем, также будут добавлены в задание импорта.

> [!NOTE]
>  Укажите только родительский каталог, так как при его добавлении подкаталоги добавляются рекурсивно. Не указывайте подкаталоги дополнительно.
>
>  В настоящее время в инструменте импорта и экспорта Microsoft Azure установлено следующее ограничение: если объем данных каталога превышает объем жесткого диска, нужно разбить каталог на каталоги меньшего размера. Например, если каталог содержит 2,5 ТБ данных, а объем жесткого диска составляет всего 2 ТБ, необходимо разбить этот каталог на каталоги меньшего размера. Это ограничение будет снято в более поздней версии средства.

## <a name="identify-the-destination-locations-in-the-blob-service"></a>Указание целевых расположений в службе BLOB-объектов
 Для каждого импортируемого каталога или файла нужно указать целевой виртуальный каталог или большой двоичный объект в службе BLOB-объектов Azure. Эти целевые объекты будут использоваться в качестве входных данных для инструмента импорта и экспорта Azure. Обратите внимание, что каталоги должны быть разделены знаком косой черты "/".

 В следующей таблице приведены примеры целевых больших двоичных объектов.

|Исходный файл или каталог|Целевой большой двоичный объект или виртуальный каталог|
|------------------------------|-------------------------------------------|
|H:\Video|https://mystorageaccount.blob.core.windows.net/video|
|H:\Photo|https://mystorageaccount.blob.core.windows.net/photo|
|K:\Temp\FavoriteVideo.ISO|https://mystorageaccount.blob.core.windows.net/favorite/FavoriteVideo.ISO|
|\\\myshare\john\music|https://mystorageaccount.blob.core.windows.net/music|

## <a name="determine-how-many-drives-are-needed"></a>Указание необходимого количества дисков
 Затем необходимо указать:

-   количество жестких дисков, необходимых для хранения данных;

-   каталоги и (или) отдельные файлы, которые будут скопированы на каждый жесткий диск.

 Убедитесь, что жестких дисков достаточно для хранения передаваемых данных.

## <a name="copy-data-to-your-hard-drive"></a>Копирование данных на жесткий диск
 В этом разделе описывается, как вызвать инструмент импорта и экспорта Azure, чтобы скопировать данные на один или несколько жестких дисков. Каждый раз при вызове инструмента импорта и экспорта Azure создается *сеанс копирования*. Создайте хотя бы один сеанс копирования для каждого диска, на который будут копироваться данные. В некоторых случаях может понадобиться несколько сеансов, чтобы скопировать все данные на один диск. Ниже приведены некоторые причины, по которым может потребоваться несколько сеансов копирования.

-   Необходимо создать отдельный сеанс копирования для каждого диска, на который будут копироваться данные.

-   За сеанс копирования можно скопировать один каталог или один большой двоичный объект на диск. Чтобы скопировать несколько каталогов, несколько больших двоичных объектов или их сочетание, потребуется создать несколько сеансов копирования.

-   Для больших двоичных объектов, которые будут импортироваться в задании импорта, можно задать свойства и метаданные. Свойства или метаданные, заданные для сеанса копирования, применяются ко всем большим двоичным объектам, указанным в сеансе копирования. Чтобы задать другие свойства или метаданные для некоторых больших двоичных объектов, вам потребуется создать отдельный сеанс копирования. Дополнительные сведения см. в статье [Настройка свойств и метаданных во время импорта](storage-import-export-tool-setting-properties-metadata-import-v1.md).

> [!NOTE]
>  При наличии нескольких компьютеров, отвечающих требованиям, приведенным в статье [Настройка средства импорта и экспорта Azure](storage-import-export-tool-setup-v1.md), можно копировать данные на несколько дисков одновременно, запустив экземпляр этого инструмента на каждом компьютере.

 Для каждого жесткого диска, который подготавливается с помощью инструмента импорта и экспорта Azure, создается один файл журнала. Чтобы создать задание импорта, вам потребуются файлы журналов со всех ваших дисков. Файл журнала также можно использовать для возобновления подготовки диска, если работа средства прервана.

### <a name="azure-importexport-tool-syntax-for-an-import-job"></a>Синтаксис инструмента импорта и экспорта Azure для задания импорта
 Чтобы подготовить диски для задания импорта, вызовите инструмент импорта и экспорта Azure с помощью команды **PrepImport**. Используемые параметры зависят от того, какой это сеанс копирования: первый или последующий.

 Для первого сеанса копирования на диск требуется указать некоторые дополнительные параметры: ключ учетной записи хранения, букву целевого диска, нужно ли отформатировать диск, нужно ли зашифровать диск (если нужно, то указать ключ BitLocker), а также каталог журнала. Ниже приведен синтаксис начального сеанса копирования для каталога или отдельного файла.

 **Первый сеанс копирования для одного каталога**

 `WAImportExport PrepImport /sk:<StorageAccountKey> /csas:<ContainerSas> /t: <TargetDriveLetter> [/format] [/silentmode] [/encrypt] [/bk:<BitLockerKey>] [/logdir:<LogDirectory>] /j:<JournalFile> /id:<SessionId> /srcdir:<SourceDirectory> /dstdir:<DestinationBlobVirtualDirectory> [/Disposition:<Disposition>] [/BlobType:<BlockBlob|PageBlob>] [/PropertyFile:<PropertyFile>] [/MetadataFile:<MetadataFile>]`

 **Первый сеанс копирования для одного файла**

 `WAImportExport PrepImport /sk:<StorageAccountKey> /csas:<ContainerSas> /t: <TargetDriveLetter> [/format] [/silentmode] [/encrypt] [/bk:<BitLockerKey>] [/logdir:<LogDirectory>] /j:<JournalFile> /id:<SessionId> /srcfile:<SourceFile> /dstblob:<DestinationBlobPath> [/Disposition:<Disposition>] [/BlobType:<BlockBlob|PageBlob>] [/PropertyFile:<PropertyFile>] [/MetadataFile:<MetadataFile>]`

 Для последующих сеансов копирования начальные параметры задавать не нужно. Ниже приведен синтаксис для последующего сеанса копирования каталога или отдельного файла.

 **Последующие сеансы копирования для одного каталога**

 `WAImportExport PrepImport /j:<JournalFile> /id:<SessionId> /srcdir:<SourceDirectory> /dstdir:<DestinationBlobVirtualDirectory> [/Disposition:<Disposition>] [/BlobType:<BlockBlob|PageBlob>] [/PropertyFile:<PropertyFile>] [/MetadataFile:<MetadataFile>]`

 **Последующие сеансы копирования для одного файла**

 `WAImportExport PrepImport /j:<JournalFile> /id:<SessionId> /srcfile:<SourceFile> /dstblob:<DestinationBlobPath> [/Disposition:<Disposition>] [/BlobType:<BlockBlob|PageBlob>] [/PropertyFile:<PropertyFile>] [/MetadataFile:<MetadataFile>]`

### <a name="parameters-for-the-first-copy-session-for-a-hard-drive"></a>Параметры для первого сеанса копирования на жесткий диск
 При каждом запуске инструмента импорта и экспорта Azure для копирования файлов на жесткий диск создается сеанс копирования. За сеанс копируется один каталог или файл на жесткий диск. Состояние сеанса копирования записывается в файл журнала. Если сеанс копирования прерывается (например, из-за отключения питания системы), его можно возобновить. Для этого повторно запустите средство и укажите файл журнала в командной строке.

> [!WARNING]
>  При указании параметра **/format** для первого сеанса копирования диск будет отформатирован, и все данные на нем будут очищены. Рекомендуем использовать для сеанса копирования только пустые диски.

 Команде, используемой для первого сеанса копирования на каждый диск, и командам для последующих сеансов копирования требуются разные параметры. В таблице ниже перечислены дополнительные параметры, доступные для первого сеанса копирования.

|Параметр командной строки|ОПИСАНИЕ|
|-----------------------------|-----------------|
|**/sk:**<ключ_учетной_записи_хранения\>|`Optional.` Ключ учетной записи хранения, в которую будут импортированы данные. В команду необходимо включить параметр **/sk:**<ключ_учетной_записи_хранения\> или **/csas:**<SAS_контейнера\>.|
|**/csas:**<ContainerSas\>|`Optional`. SAS контейнера для импорта данных в учетную запись хранения. В команду необходимо включить параметр **/sk:**<ключ_учетной_записи_хранения\> или **/csas:**<SAS_контейнера\>.<br /><br /> Значение этого параметра должно начинаться с имени контейнера со знаком вопроса (?) и маркером SAS. Например: <br /><br /> `mycontainer?sv=2014-02-14&sr=c&si=abcde&sig=LiqEmV%2Fs1LF4loC%2FJs9ZM91%2FkqfqHKhnz0JM6bqIqN0%3D&se=2014-11-20T23%3A54%3A14Z&sp=rwdl`<br /><br /> В URL-адресе или хранимой политике доступа должны быть указаны разрешения на чтение, запись и удаление для заданий импорта и чтение, запись и перечисление для заданий экспорта.<br /><br /> Если этот параметр задан, все большие двоичные объекты для импорта и экспорта должны находиться в контейнере, указанном в подписанном URL-адресе.|
|**/t:**<буква_целевого_диска\>|`Required.` Буква целевого жесткого диска для текущего сеанса копирования без двоеточия в конце.|
|**/format**|`Optional.` Укажите этот параметр, если диск нужно отформатировать. В противном случае не используйте его. Прежде чем средство отформатирует диск, оно выдаст в консоли запрос на подтверждение. Чтобы запрос не выдавался, укажите параметр /silentmode.|
|**/silentmode**|`Optional.` Укажите этот параметр, чтобы отменить запрос на подтверждение форматирования целевого диска.|
|**/encrypt**|`Optional.` Укажите этот параметр, если диск еще не зашифрован с помощью BitLocker и должен быть зашифрован сейчас. Если диск уже зашифрован средством BitLocker, не используйте этот параметр. Вместо него укажите параметр `/bk` и введите имеющийся ключ BitLocker.<br /><br /> Если вы задаете параметр `/format`, также необходимо указать параметр `/encrypt`.|
|**/bk:**<ключ_BitLocker\>|`Optional.` Не используйте этот параметр, если задан параметр `/encrypt`. Пропустить параметр `/encrypt` можно в том случае, если диск уже зашифрован с помощью BitLocker. Используйте этот параметр, чтобы указать ключ BitLocker. Шифрование BitLocker требуется для всех жестких дисков задания импорта.|
|**/logdir:**<LogDirectory\>|`Optional.` Каталог журнала определяет каталог, используемый для хранения файлов подробного журнала и некоторых временных файлов манифеста. Если каталог не указан, вместо него будет использоваться текущий каталог.|

### <a name="parameters-required-for-all-copy-sessions"></a>Параметры, необходимые для всех сеансов копирования
 Файл журнала содержит данные о состояниях всех сеансов копирования на жесткий диск. Он также содержит сведения, необходимые для создания задания импорта. При запуске инструмента импорта и экспорта Azure необходимо всегда указывать файл журнала и идентификатор сеанса копирования.

|||
|-|-|
|Параметр командной строки|ОПИСАНИЕ|
|**/j:**<файл_журнала\>|`Required.` Путь к файлу журнала. У каждого диска должен быть только один файл журнала. Обратите внимание, что файл журнала не может находиться на целевом диске. Расширение файла журнала — `.jrn`.|
|**/id:**<ИД_сеанса\>|`Required.` Идентификатор сеанса определяет сеанс копирования. и используется для обеспечения точного восстановления прерванного сеанса копирования. Файлы, копируемые во время сеанса копирования, хранятся в каталоге с именем, соответствующем идентификатору сеанса на целевом диске.|

### <a name="parameters-for-copying-a-single-directory"></a>Параметры для копирования одного каталога
 При копировании одного каталога применяются следующие обязательные и необязательные параметры.

|Параметр командной строки|ОПИСАНИЕ|
|----------------------------|-----------------|
|**/srcdir:**<исходный_каталог\>|`Required.` Исходный каталог, содержащий файлы для копирования на целевой диск. Путь к каталогу должен быть абсолютным (не относительным).|
|**/dstdir:**<целевой_виртуальный_каталог_больших_двоичных_объектов\>|`Required.` Путь к целевому виртуальному каталогу в учетной записи хранения Microsoft Azure. Виртуальный каталог может уже существовать.<br /><br /> Контейнер или префикс большого двоичного объекта можно указать следующим образом: `music/70s/`. Путь к целевому каталогу должен начинаться с имени контейнера, после которого ставится знак косой черты. При необходимости вы можете добавить виртуальный каталог больших двоичных объектов, который заканчивается знаком косой черты.<br /><br /> Если в качестве целевого контейнера используется корневой контейнер, его (и знак косой черты) необходимо явно указать как `$root/`. Имена больших двоичных объектов в корневом контейнере не могут содержать знак косой черты. По этой причине, если в качестве целевого контейнера используется корневой контейнер, подкаталоги в исходном каталоге не будут скопированы.<br /><br /> Указывая целевые виртуальные каталоги и BLOB-объекты, используйте правильные имена контейнеров. Обратите внимание, что имена каталогов пишутся строчными буквами. Правила именования контейнеров см. в статье [Именование контейнеров, больших двоичных объектов и метаданных и ссылка на них](/rest/api/storageservices/naming-and-referencing-containers--blobs--and-metadata).|
|**/Disposition:**<rename&#124;no-overwrite&#124;overwrite>|`Optional.` Определяет поведение при наличии большого двоичного объекта с указанным адресом. Допустимые значения для этого параметра: `rename`, `no-overwrite` и `overwrite`. Обратите внимание, что в этих значениях учитывается регистр. Если значение не задано, используется значение по умолчанию `rename`.<br /><br /> Значение, заданное для этого параметра, влияет на все файлы в каталоге, который определен параметром `/srcdir`.|
|**/BlobType:**<BlockBlob&#124;PageBlob>|`Optional.` Определяет тип для целевых больших двоичных объектов. Допустимые значения: `BlockBlob` и `PageBlob`. Обратите внимание, что в этих значениях учитывается регистр. Если значение не задано, используется значение по умолчанию `BlockBlob`.<br /><br /> В большинстве случаев рекомендуем использовать значение `BlockBlob`. Если задан тип `PageBlob`, размер каждого файла в каталоге должен быть кратен 512, то есть размеру страницы в страничных BLOB-объектах.|
|**/PropertyFile:**<файл_свойств\>|`Optional.` Путь к файлу свойств для целевых больших двоичных объектов. Дополнительные сведения см. в статье [Формат файла свойств и метаданных службы импорта и экспорта](../storage-import-export-file-format-metadata-and-properties.md).|
|**/MetadataFile:**<файл_метаданных\>|`Optional.` Путь к файлу метаданных для целевых больших двоичных объектов. Дополнительные сведения см. в статье [Формат файла свойств и метаданных службы импорта и экспорта](../storage-import-export-file-format-metadata-and-properties.md).|

### <a name="parameters-for-copying-a-single-file"></a>Параметры для копирования одного файла
 При копировании одного файла применяются следующие обязательные и необязательные параметры.

|Параметр командной строки|ОПИСАНИЕ|
|----------------------------|-----------------|
|**/srcfile:**<исходный_файл\>|`Required.` Полный путь к файлу для копирования. Путь к каталогу должен быть абсолютным (не относительным).|
|**/dstblob:**<путь_к_целевому_большому_двоичному_объекту\>|`Required.` Путь к целевому большому двоичному объекту в учетной записи хранения Microsoft Azure. Большой двоичный объект может уже существовать.<br /><br /> Укажите имя большого двоичного объекта с именем контейнера перед ним. Имя большого двоичного объекта не может начинаться со знака "/" или имени учетной записи хранения. Правила именования больших двоичных объектов см. в статье [Именование контейнеров, больших двоичных объектов и метаданных и ссылка на них](/rest/api/storageservices/naming-and-referencing-containers--blobs--and-metadata).<br /><br /> Если в качестве целевого контейнера используется корневой контейнер, необходимо явно указать `$root` в качестве контейнера, например `$root/sample.txt`. Обратите внимание, что имена больших двоичных объектов в корневом контейнере не могут содержать знак "/".|
|**/Disposition:**<rename&#124;no-overwrite&#124;overwrite>|`Optional.` Определяет поведение при наличии большого двоичного объекта с указанным адресом. Допустимые значения для этого параметра: `rename`, `no-overwrite` и `overwrite`. Обратите внимание, что в этих значениях учитывается регистр. Если значение не задано, используется значение по умолчанию `rename`.|
|**/BlobType:**<BlockBlob&#124;PageBlob>|`Optional.` Определяет тип для целевых больших двоичных объектов. Допустимые значения: `BlockBlob` и `PageBlob`. Обратите внимание, что в этих значениях учитывается регистр. Если значение не задано, используется значение по умолчанию `BlockBlob`.<br /><br /> В большинстве случаев рекомендуем использовать значение `BlockBlob`. Если задан тип `PageBlob`, размер каждого файла в каталоге должен быть кратен 512, то есть размеру страницы в страничных BLOB-объектах.|
|**/PropertyFile:**<файл_свойств\>|`Optional.` Путь к файлу свойств для целевых больших двоичных объектов. Дополнительные сведения см. в статье [Формат файла свойств и метаданных службы импорта и экспорта](../storage-import-export-file-format-metadata-and-properties.md).|
|**/MetadataFile:**<файл_метаданных\>|`Optional.` Путь к файлу метаданных для целевых больших двоичных объектов. Дополнительные сведения см. в статье [Формат файла свойств и метаданных службы импорта и экспорта](../storage-import-export-file-format-metadata-and-properties.md).|

### <a name="resuming-an-interrupted-copy-session"></a>Возобновление прерванного сеанса копирования
 Если сеанс копирования по какой-либо причине был прерван, вы можете возобновить его. Для этого запустите средство, указав только определенный файл журнала.

```
WAImportExport.exe PrepImport /j:<JournalFile> /id:<SessionId> /ResumeSession
```

 Вы можете возобновить только последний завершившийся сбоем сеанс.

> [!IMPORTANT]
>  При возобновлении сеанса копирования не добавляйте дополнительные или не удаляйте исходные файлы данных и каталоги.

### <a name="aborting-an-interrupted-copy-session"></a>Прерывание прерванного сеанса копирования
 Если сеанс копирования был прерван и его невозможно восстановить (например, если исходный каталог стал недоступным), текущий сеанс необходимо прервать. Это позволит выполнить откат этого сеанса копирования и запустить новый.

```
WAImportExport.exe PrepImport /j:<JournalFile> /id:<SessionId> /AbortSession
```

 Вы можете прервать только последний завершившийся сбоем сеанс. Обратите внимание, что первый сеанс копирования для диска прервать невозможно. В этом случае нужно перезапустить сеанс копирования, используя новый файл журнала.

## <a name="next-steps"></a>Дополнительная информация

* [Настройка средства импорта и экспорта Azure](storage-import-export-tool-setup-v1.md)
* [Настройка свойств и метаданных во время импорта](storage-import-export-tool-setting-properties-metadata-import-v1.md)
* [Пример рабочего процесса по подготовке жестких дисков для задания импорта](storage-import-export-tool-sample-preparing-hard-drives-import-job-workflow-v1.md)
* [Краткий справочник по часто используемым командам](storage-import-export-tool-quick-reference-v1.md) 
* [Просмотр состояния задания с помощью файлов журнала копирования](storage-import-export-tool-reviewing-job-status-v1.md)
* [Подготовка задания импорта](storage-import-export-tool-repairing-an-import-job-v1.md)
* [Подготовка задания экспорта](storage-import-export-tool-repairing-an-export-job-v1.md)
* [Устранение неполадок со средством импорта и экспорта Azure](storage-import-export-tool-troubleshooting-v1.md)
