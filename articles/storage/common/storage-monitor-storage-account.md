---
title: Как отслеживать учетную запись хранения Azure | Документация Майкрософт
description: Выполнение мониторинга учетной записи хранения в Azure с помощью портала Azure.
services: storage
documentationcenter: ''
author: tamram
manager: timlt
editor: tysonn
ms.assetid: b83cba7b-4627-4ba7-b5d0-f1039fe30e78
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/14/2017
ms.author: tamram
ms.openlocfilehash: ffc7d46bbfa4db47a47e416c395efdfc451cadc1
ms.sourcegitcommit: 20d103fb8658b29b48115782fe01f76239b240aa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2018
ms.locfileid: "30322919"
---
# <a name="monitor-a-storage-account-in-the-azure-portal"></a>Мониторинг учетной записи хранения на портале Azure

[Аналитика службы хранилища Azure](../storage-analytics.md) предоставляет метрики для всех служб хранилища и журналы для больших двоичных объектов, очередей и таблиц. С помощью [портала Azure](https://portal.azure.com) можно настроить метрики и журналы, записываемые для вашей учетной записи, а также настроить диаграммы, которые обеспечивают визуальное представление данных этих метрик.

> [!NOTE]
> За изучение данных мониторинга на портале Azure взимается плата. Дополнительные сведения см. в разделе [Аналитика и выставление счетов для хранилища](/rest/api/storageservices/Storage-Analytics-and-Billing).
>
> Сейчас служба "Файлы Azure" поддерживает метрики решения "Аналитика службы хранилища", но не поддерживает ведение журналов.
> 
> Дополнительные указания о функциях аналитики хранилища и других инструментах идентификации, диагностики и устранения неполадок, связанных со службой хранилища Azure, см. в статье [Мониторинг, диагностика и устранение неполадок службы хранилища Microsoft Azure](../storage-monitoring-diagnosing-troubleshooting.md).
>

## <a name="configure-monitoring-for-a-storage-account"></a>Настройка мониторинга учетной записи хранения

1. На [портале Azure](https://portal.azure.com) выберите **Учетные записи хранения**, а затем щелкните имя учетной записи хранения, чтобы открыть ее панель мониторинга.
1. В колонке меню в разделе **Мониторинг** щелкните **Диагностика**.

    ![Параметры мониторинга](./media/storage-monitor-storage-account/stg-enable-metrics-00.png)

1. Выберите **тип** данных метрик для каждой **службы**, которую нужно отслеживать, и **политику хранения** для данных. Можно также отключить мониторинг, задав для параметра **Состояние** значение **Откл**.

    ![Параметры мониторинга](./media/storage-monitor-storage-account/stg-enable-metrics-01.png)

   Существуют два типа метрик, которые можно включить для каждой службы. Они включены по умолчанию для новых учетных записей хранения.

   * **Сводная**: позволяет собирать такие метрики, как метрики исходящего и входящего трафика, доступности, задержки и процента успешных операций. Эти метрики вычисляются для служб BLOB-объектов, очередей, таблиц и файлов.
   * **Для каждого API**: в дополнение к сводным метрикам позволяет собирать одинаковый набор метрик для каждой операции с хранилищем в API службы хранилища Azure.

   Чтобы задать политику хранения данных, переместите ползунок **Хранение (дни)** или введите число дней хранения данных в диапазоне от 1 до 365. Значение по умолчанию для новых учетных записей хранения составляет семь дней. Если политику хранения задавать не нужно, введите ноль. Если политика хранения отсутствует, удаление данных мониторинга выполняется вручную.

   > [!WARNING]
   > За удаление данных метрик вручную взимается плата. Устаревшие данные аналитики (срок которых превышает значение, установленное политикой хранения) удаляются системой бесплатно. Рекомендуется устанавливать политику хранения в зависимости от того, как долго нужно хранить данные аналитики хранилища для вашей учетной записи. Дополнительные сведения см. в разделе [Какова стоимость включения метрик хранилища?](../common/storage-enable-and-view-metrics.md#what-charges-do-you-incur-when-you-enable-storage-metrics)
   >

1. Закончив настройку мониторинга, нажмите кнопку **Сохранить**.

На диаграммах в колонке учетной записи хранения отображается набор метрик по умолчанию, как и в отдельных колонках служб (BLOB-объектов, очередей, таблиц и файлов). После включения метрик для службы может пройти до часа, прежде чем их данные отобразятся на диаграммах. Можно щелкнуть **Изменить** на любой диаграмме метрики, чтобы [настроить метрики](#how-to-customize-metrics-charts), отображаемые на диаграмме.

Можно отключить сбор метрик и ведение журнала, задав для параметра **Состояние** значение **Откл**.

> [!NOTE]
> Служба хранилища Azure использует [хранилище таблиц](../common/storage-introduction.md#table-storage) для хранения метрик вашей учетной записи хранения и хранит метрики в таблицах, расположенных в вашей учетной записи. Дополнительные сведения можно найти в разделе [Как хранятся метрики](../common/storage-analytics.md#how-metrics-are-stored).
>

## <a name="customize-metrics-charts"></a>Настройка диаграмм метрик

Чтобы выбрать метрики хранилища для отображения на диаграмме метрик, выполните следующие действия. 

1. Сначала отобразите диаграмму метрики службы хранилища на портале Azure. Диаграммы можно найти в **колонке учетной записи хранения** и в колонке **Метрики** для отдельных служб (BLOB-объектов, очередей, таблиц, файлов).

   В этом примере мы используем приведенную ниже диаграмму, которая отображается в **колонке учетной записи хранения**.

   ![Выбор диаграммы на портале Azure](./media/storage-monitor-storage-account/stg-customize-chart-00.png)

1. Щелкните в любом месте диаграммы, чтобы открыть колонку **Метрика**. Выберите **Изменить диаграмму**, чтобы открыть колонку **Правка диаграммы**.

   ![Кнопка "Изменить диаграмму" в колонке диаграммы](./media/storage-monitor-storage-account/stg-customize-chart-01.png)

1. В колонке **Правка диаграммы** выберите **Диапазон времени** метрик для отображения на диаграмме и **службу** (BLOB-объектов, очередей, таблиц, файлов), метрики которой нужно отобразить. Ниже мы выбрали отображение метрик службы BLOB-объектов за прошлую неделю.

   ![Выбор диапазона времени и службы в колонке "Правка диаграммы"](./media/storage-monitor-storage-account/stg-customize-chart-02.png)

1. Выберите отдельные **метрики**, которые нужно отобразить на диаграмме, затем нажмите кнопку **ОК**. Например, здесь мы решили отобразить метрики *ContainerCount* и *ObjectCount*.

   ![Выбор отдельных метрик в колонке "Правка диаграммы"](./media/storage-monitor-storage-account/stg-customize-chart-03.png)

Параметры диаграммы не влияют на сбор, статистическую обработку или хранение данных мониторинга в учетной записи хранения. Они определяют только отображение данных метрик.

### <a name="metrics-availability-in-charts"></a>Доступность метрики на диаграммах

Список доступных метрик меняется в зависимости от того, какая служба выбрана из раскрывающегося списка и какой тип единиц использует изменяемая диаграмма. Например, процентные метрики, такие как *PercentNetworkError* и *PercentThrottlingError*, можно выбрать только в том случае, если требуется изменить диаграмму, показывающую единицы в процентах.

![Ошибка запроса к процентной диаграмме на портале Azure](./media/storage-monitor-storage-account/stg-customize-chart-04.png)

### <a name="metrics-resolution"></a>Разрешение метрик

Метрики, выбранные в колонке "Диагностика", определяют разрешение метрик, доступных для вашей учетной записи.

* **Сводный** мониторинг позволяет собирать такие метрики, как метрики исходящего и входящего трафика, доступности, задержки и процента успешных операций. Эти метрики вычисляются для служб BLOB-объектов, очередей, таблиц и файлов.
* Мониторинг **каждого API** обеспечивает более точное разрешение, помимо статистических метрик уровня службы предоставляя метрики отдельных операций хранилища.

## <a name="configure-metrics-alerts"></a>Настройка оповещений метрик

Можно создать оповещения, чтобы получать уведомления о достижении пороговых значений для метрик ресурсов хранилища.

1. Чтобы открыть **колонку правил генерации оповещений**, прокрутите **колонку меню** вниз до раздела **Мониторинг** и выберите **Правила генерации оповещений**.
1. Выберите **Добавить оповещение**, чтобы открыть колонку **Добавление правила оповещения**.
1. Выберите **ресурс** (большой двоичный объект, файл, очередь, таблицу) из раскрывающегося списка и введите **имя** и **описание** нового правила генерации оповещений.
1. Выберите **метрику**, для которой нужно добавить оповещение, и укажите **условие** и **пороговое значение** оповещения. Тип единицы порогового значения меняется в зависимости от выбранной метрики. Например, "количество" — тип единицы измерения для *ContainerCount*, тогда как единицей измерения для метрики *PercentNetworkError* является процент.
1. Выберите **период**. Если метрика достигает порогового значения или превышает его в течение периода, активируется оповещение.
1. (Необязательно.) Настройте уведомления с использованием **электронного адреса** и **webhook**. Дополнительные сведения об объектах webhook см. в разделе [Настройка объектов webhook для оповещений на основе метрик Azure](../../monitoring-and-diagnostics/insights-webhooks-alerts.md). Если не настроить уведомления с помощью электронной почты или webhook, то они будут отображаться только на портале Azure.

![Колонка "Добавление правила оповещения" на портале Azure](./media/storage-monitor-storage-account/stg-alert-rules-01.png)

## <a name="add-metrics-charts-to-the-portal-dashboard"></a>Добавление диаграмм метрик на панель мониторинга портала

Диаграммы метрик службы хранилища Azure для любых учетных записей хранения можно добавить на панель мониторинга портала.

1. Откройте панель мониторинга на [портале Azure](https://portal.azure.com) и щелкните **Изменить панель мониторинга**.
1. В колонке **Коллекция плиток** выберите **Найти плитки по** > **Тип**.
1. Выберите **Тип** > **Учетные записи хранения**.
1. В колонке **ресурсы** выберите учетную запись, метрики которой вы хотите добавить на панель мониторинга.
1. Выберите **Категории** > **Мониторинг**.
1. Перетащите на панель мониторинга элемент диаграммы для метрики, которую нужно отобразить. Повторите это для всех метрик, которые требуется отобразить на панели мониторинга. На следующем рисунке в качестве примера выбрана диаграмма "Большие двоичные объекты — всего запросов", но на панель мониторинга можно добавить любую диаграмму.

   ![Коллекция элементов на портале Azure](./media/storage-monitor-storage-account/stg-customize-dashboard-01.png)
1. Завершив добавление диаграммы, выберите **Настройка выполнена** в верхней части панели мониторинга.

После добавления диаграмм на панель мониторинга их можно настроить, как описано в разделе [Настройка диаграмм метрик](#how-to-customize-metrics-charts).

## <a name="configure-logging"></a>Настройка журнала

Можно указать службе хранилища Azure сохранять журналы диагностики для запросов на чтение, запись и удаление, отправляемых к службам BLOB-объектов, таблиц и очередей. Заданная политика хранения данных также применяется к этим журналам.

> [!NOTE]
> Сейчас служба "Файлы Azure" поддерживает метрики решения "Аналитика службы хранилища", но не поддерживает ведение журналов.
>

1. На [портале Azure](https://portal.azure.com) выберите **Учетные записи хранения**, а затем щелкните имя учетной записи хранения, чтобы открыть ее колонку.
1. В колонке меню в разделе **Мониторинг** щелкните **Диагностика**.

    ![Пункт меню "Диагностика" в разделе "Мониторинг" на портале Azure](./media/storage-monitor-storage-account/stg-enable-metrics-00.png)
    
1. Убедитесь, что параметр **Состояние** имеет значение **Вкл.**, и выберите **службы**, для которых нужно включить ведение журнала.

    ![Настройка ведения журнала на портале Azure](./media/storage-monitor-storage-account/stg-enable-logging-01.png)
1. Выберите команду **Сохранить**.

Журналы диагностики сохраняются в контейнере BLOB-объектов с именем $logs в вашей учетной записи хранения. Можно просмотреть данные журнала с помощью обозревателя хранилищ, например [Microsoft Storage Explorer](http://storageexplorer.com), или программно, с помощью клиентской библиотеки службы хранилища или PowerShell.

Дополнительные сведения о доступе к контейнеру $logs см. в разделе [Enabling Storage Logging and Accessing Log Data](/rest/api/storageservices/enabling-storage-logging-and-accessing-log-data) (Включение ведения журнала и доступа к данным журнала хранилища).

## <a name="next-steps"></a>Дополнительная информация

* Дополнительные сведения о [метриках, ведении журнала и выставлении счетов](../storage-analytics.md) для аналитики службы хранилища.
* [Включение метрик службы хранилища Azure и просмотр данных метрик](../storage-enable-and-view-metrics.md) с помощью PowerShell и программно с помощью C#.
