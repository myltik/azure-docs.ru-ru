---
title: Планирование развертывания службы синхронизации файлов Azure (предварительная версия) | Документация Майкрософт
description: Узнайте, что необходимо учесть при планировании развертывания службы "Файлы Azure".
services: storage
documentationcenter: ''
author: wmgries
manager: aungoo
editor: tamram
ms.assetid: 297f3a14-6b3a-48b0-9da4-db5907827fb5
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/04/2017
ms.author: wgries
ms.openlocfilehash: 160f01c3094548277e1f68e0002954ae63c79ce6
ms.sourcegitcommit: c722760331294bc8532f8ddc01ed5aa8b9778dec
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2018
ms.locfileid: "34738341"
---
# <a name="planning-for-an-azure-file-sync-preview-deployment"></a>Планирование развертывания службы синхронизации файлов Azure (предварительная версия)
С помощью службы синхронизации файлов Azure (предварительная версия) вы можете централизованно хранить файловые ресурсы организации в службе файлов Azure, обеспечивая гибкость, производительность и совместимость локального файлового сервера. Это достигается путем преобразования Windows Server в быстрый кэш общего файлового ресурса Azure. Для локального доступа к данным вы можете использовать любой протокол, доступный в Windows Server, в том числе SMB, NFS и FTPS. Кроме того, вы можете создать любое количество кэшей в любом регионе.

В этой статье описываются важные сведения о развертывании службы "Синхронизация файлов Azure". Мы также рекомендуем ознакомиться со статьей [Планирование развертывания службы файлов Azure](storage-files-planning.md). 

## <a name="azure-file-sync-terminology"></a>Терминология службы синхронизации файлов Azure
Прежде чем углубиться в аспекты планирования развертывания службы синхронизации файлов Azure, очень важно понимать терминологию.

### <a name="storage-sync-service"></a>Служба синхронизации хранилища
Служба синхронизации хранилища — это ресурс Azure верхнего уровня для службы синхронизации файлов Azure. Ресурс службы синхронизации хранилища является одноранговым в отношении ресурса учетной записи хранения, поэтому его можно развернуть в группах ресурсов Azure. Необходим отдельный ресурс верхнего уровня в ресурсе учетной записи хранения, так как служба синхронизации хранилища может создавать синхронизированные связи с несколькими учетными записями хранения через несколько групп синхронизации. В подписке может быть развернуто несколько ресурсов служб синхронизации хранилища.

### <a name="sync-group"></a>Группа синхронизации
Группа синхронизации определяет топологию синхронизации для набора файлов. Конечные точки в группе синхронизации синхронизируются. Если, например, есть два отдельных набора файлов, которыми можно управлять с помощью службы "Синхронизация файлов Azure", следует создать две группы синхронизации и добавить различные конечные точки для каждой. Служба синхронизации хранилища может содержать любое количество групп синхронизации.  

### <a name="registered-server"></a>Зарегистрированный сервер
Объект "Зарегистрированный сервер" представляет собой отношение доверия между сервером (или кластером) и службой синхронизации хранилища. В экземпляре службы синхронизации хранилища можно зарегистрировать любое необходимое количество серверов. Тем не менее сервер (или кластер) можно зарегистрировать только в одной службе синхронизации хранилища.

### <a name="azure-file-sync-agent"></a>Агент службы синхронизации файлов Azure
Агент службы синхронизации файлов Azure — это скачиваемый пакет, позволяющий синхронизировать Windows Server с общим файловым ресурсом Azure. Агент службы синхронизации файлов Azure состоит из трех основных компонентов: 
- **FileSyncSvc.exe** — фоновая служба Windows, отвечающая за отслеживание изменений в конечных точках сервера и запуск сеансов синхронизации в Azure.
- **StorageSync.sys** — фильтр файловой системы службы синхронизации файлов Azure, отвечающий за распределение файлов по уровням компонента "Файлы Azure" (когда включено распределение по уровням облака).
- **Командлеты управления PowerShell** для взаимодействия с поставщиком ресурсов Azure Microsoft.StorageSync. Их можно найти в следующих расположениях (по умолчанию):
    - C:\Program Files\Azure\StorageSyncAgent\StorageSync.Management.PowerShell.Cmdlets.dll;
    - C:\Program Files\Azure\StorageSyncAgent\StorageSync.Management.ServerCmdlets.dll.

### <a name="server-endpoint"></a>Конечная точка сервера
Конечная точка сервера представляет собой определенное расположение на зарегистрированном сервере, например папку в томе сервера. В томе может располагаться несколько конечных точек сервера, если их пространства имен не перекрываются (например, `F:\sync1` и `F:\sync2`). Политики распределения по уровням облака можно настроить отдельно для каждой конечной точки сервера. 

Можно создать конечную точку сервера с помощью точки подключения. Обратите внимание на то, что точки подключения в конечной точке сервера пропускаются.  

Можно создать конечную точку сервера на системном томе, но при этом есть два ограничения:
* Невозможно включить распределение по уровням облака.
* Не выполняется быстрое восстановление пространств имен (когда система быстро отключает все пространство имен, а затем начинает отзывать содержимое).


> [!Note]  
> Поддерживаются только тома без возможности удаления.  Диски, сопоставленные с удаленным общим ресурсом, не поддерживаются для пути конечной точки сервера.  Конечная точка сервера может находиться на системном томе Windows, который не поддерживает распределение по уровням облака.

Если вы добавляете в группу синхронизации в качестве конечной точки сервера некоторое расположение, которое содержит набор файлов, эти файлы объединяются с теми файлами, которые уже находятся в других конечных точках этой группы синхронизации.

### <a name="cloud-endpoint"></a>Облачная конечная точка
Облачная конечная точка является общим файловым ресурсом Azure, который входит в группу синхронизации. Все операции синхронизации для общего файлового ресурса Azure и сам файловый ресурс Azure могут относиться только к одной облачной конечной точке. Таким образом, файловый ресурс Azure может быть членом только одной группы синхронизации. Если вы добавляете в группу синхронизации в качестве конечной точки сервера общий файловый ресурс Azure, который содержит набор файлов, эти файлы объединяются с теми файлами, которые уже находятся в других конечных точках этой группы синхронизации.

> [!Important]  
> Служба "Синхронизация файлов Azure" поддерживает внесение изменений непосредственно в файловый ресурс Azure. Однако внесенные изменения сначала должны быть обнаружены заданием обнаружения изменений этой службы. Задание обнаружения изменений инициируется для облачной конечной точки каждые 24 часа. Кроме того, изменения, внесенные в файловый ресурс Azure с помощью протокола REST, не приведут к обновлению времени последнего изменения SMB и не будут распознаны как изменение службой синхронизации. Дополнительные сведения см. в статье [Часто задаваемые вопросы о службе файлов Azure](storage-files-faq.md#afs-change-detection).

### <a name="cloud-tiering"></a>Распределение по уровням облака 
Распределение по уровням облака — это дополнительный компонент службы "Синхронизация файлов Azure", позволяющий распределять по уровням службы файлов Azure редко используемые файлы размером больше 64 КиБ. При распределении файла фильтр файловой системы службы синхронизации файлов Azure (StorageSync.sys) локально заменяет файл указателем или точкой повторного анализа. Точка повторного анализа представляет URL-адрес к файлу в службе "Файлы Azure". Распределенный по уровням файл имеет автономный атрибут, установленный в NTFS, чтобы сторонние приложения могли идентифицировать такие файлы. При открытии файла, распределенного по уровням, служба синхронизации файлов Azure с легкостью отзовет данные файлов из службы "Файлы Azure" без необходимости уведомлять пользователя о том, что файл не хранится локально в системе. Эта возможность известна также как управление иерархическим хранением (HSM).

> [!Important]  
> Распределение по уровням облака не поддерживается для конечных точек сервера на системных томах Windows.

## <a name="azure-file-sync-interoperability"></a>Взаимодействие службы синхронизации файлов Azure 
В этом разделе описывается взаимодействие службы синхронизации файлов Azure с компонентами и ролями Windows Server, а также с решениями сторонних производителей.

### <a name="supported-versions-of-windows-server"></a>Поддерживаемые версии Windows Server
Сейчас служба синхронизации файлов Azure поддерживает такие версии Windows Server:

| Version (версия) | Поддерживаемые номера SKU | Поддерживаемые варианты развертывания |
|---------|----------------|------------------------------|
| Windows Server 2016 | Datacenter и Standard | Полное (сервер с пользовательским интерфейсом) |
| Windows Server 2012 R2 | Datacenter и Standard | Полное (сервер с пользовательским интерфейсом) |

Новые версии Windows Server будут добавляться по мере их выпуска. Более ранние версии Windows могут быть добавлены по запросу пользователей.

> [!Important]  
> Мы рекомендуем постоянно обновлять серверы, используемые со службой синхронизации файлов Azure, с помощью последних обновлений из Центра обновления Windows. 

### <a name="file-system-features"></a>Возможности файловой системы
| Функция | Состояние поддержки | Заметки |
|---------|----------------|-------|
| Списки управления доступом (ACL) | Полностью поддерживается | Списки управления доступом Windows сохраняются службой "Синхронизация файлов Azure" и принудительно используются Windows Server для конечных точек сервера. Списки управления доступом Windows (пока) не поддерживаются в службе "Файлы Azure", если доступ к ней осуществляется напрямую в облаке. |
| Жесткие связи. | Skipped | |
| Символические связи | Skipped | |
| Точки подключения | Частично поддерживаются | Точки подключения могут располагаться в корне конечной точки сервера, но они пропускаются, если содержатся в пространстве имен конечной точки сервера. |
| Соединения | Skipped | Например, папки DfrsrPrivate и DFSRoots распределенной файловой системы. |
| Точки повторного анализа | Skipped | |
| Сжатие NTFS | Полностью поддерживается | |
| Разреженные файлы | Полностью поддерживается | Разреженные файлы синхронизируются (не блокируются) в облако в качестве полного файла. При изменении содержимого файла в облаке (или на другом сервере) он перестанет быть разреженным, когда скачана измененная версия. |
| Альтернативные потоки данных (ADS) | Сохраняются, но не синхронизируются | Например, теги классификации, созданные инфраструктурой классификации файлов, не синхронизируются. Имеющиеся теги классификации для файлов в каждой из конечных точек сервера использоваться не будут. |

> [!Note]  
> Поддерживаются только тома NTFS. ReFS, FAT, FAT32 и другие файловые системы не поддерживаются.

### <a name="files-skipped"></a>Пропущенные файлы
| Файл или папка | Примечание |
|-|-|
| Desktop.ini | Системный файл |
| ethumbs.db$ | Временный файл для эскизов |
| ~$\*.\*; | Временный файл Office |
| \*.tmp; | Временный файл |
| \*.laccdb; | Файл блокировки базы данных Access|
| 635D02A9D91C401B97884B82B3BCDAEA.* | Внутренний файл синхронизации|
| \\System Volume Information | Папка для тома |
| $RECYCLE.BIN| Папка |
| \\SyncShareState | Папка для синхронизации |

### <a name="failover-clustering"></a>Отказоустойчивая кластеризация
Служба синхронизации файлов Azure поддерживает отказоустойчивую кластеризацию Windows Server для варианта развертывания "Файловый сервер общего использования". Отказоустойчивая кластеризация не поддерживается в вариантах "Масштабируемый файловый сервер для данных приложения" (SOFS) или в общих томах кластеров (CSV).

> [!Note]  
> Агент службы синхронизации файлов Azure должен быть установлен на каждом узле отказоустойчивого кластера для правильной работы синхронизации.

### <a name="data-deduplication"></a>Дедупликация данных
Для томов без распределения по уровням облака служба синхронизации файлов Azure поддерживает включение дедупликации данных Windows Server. Сейчас взаимодействие между службой синхронизации файлов Azure с распределением по уровням облака и дедупликацией данных не поддерживается.

### <a name="distributed-file-system-dfs"></a>Распределенная файловая система (DFS)
Служба "Синхронизация файлов Azure" с [версии 1.2 агента синхронизации файлов Azure ](https://go.microsoft.com/fwlink/?linkid=864522) поддерживает взаимодействие с пространствами имен DFS (DFS-N) и репликацией DFS (DFS-R).

**Пространства имен DFS (DFS-N).** Служба "Синхронизация файлов Azure" полностью поддерживается для серверов DFS-N. Вы можете установить агент службы "Синхронизация файлов Azure" на один или несколько членов DFS-N, чтобы синхронизировать данные между конечными точками сервера и облачными конечными точками. Дополнительные сведения см. в статье [Обзор пространств имен DFS](https://docs.microsoft.com/windows-server/storage/dfs-namespaces/dfs-overview).
 
**Репликация DFS (DFS-R).** Так как DFS-R и служба "Синхронизация файлов Azure" выполняют аналогичные функции (репликацию), в большинстве случаев мы рекомендуем полностью заменить DFS-R синхронизацией файлов Azure. Но есть несколько сценариев, в которых DFS-R и службу "Синхронизация файлов Azure" есть смысл использовать вместе.

- Если выполняется миграция с развернутой службы DFS-R в развернутую службу "Синхронизация файлов Azure". Дополнительные сведения см. в статье [Развертывание службы синхронизации файлов Azure (предварительная версия)](storage-sync-files-deployment-guide.md#migrate-a-dfs-replication-dfs-r-deployment-to-azure-file-sync).
- Если нет возможности подключить к Интернету напрямую каждый локальный сервер, на котором нужны копии файлов данных.
- Если серверы подразделений консолидируют данные на одном сервере-концентраторе, для которого вы намерены использовать службу "Синхронизация файлов Azure".

Если служба "Синхронизация файлов Azure" и DFS-R работают параллельно, следует учесть следующее.

1. В службе "Синхронизация файлов Azure" нужно отключить распределение по уровням облака для томов, на которых есть реплицируемые DFS-R папки.
2. Не следует настраивать конечные точки сервера для папок репликации DFS-R с доступом только для чтения.

Дополнительные сведения см. в статье [Обзор пространств имен DFS и репликации DFS](https://technet.microsoft.com/library/jj127250).

### <a name="antivirus-solutions"></a>Антивирусные решения
Антивирусные программы работают путем сканирования файлов на наличие известного вредоносного кода, поэтому они могут вызвать отзыв файлов, распределенных по уровням. Так как для многоуровневых файлов задан автономный атрибут, мы рекомендуем обратиться к поставщику программного обеспечения за информацией о том, как настроить решение, чтобы пропускать чтение автономных файлов. 

В следующих решениях поддерживается пропуск автономных файлов:

- [Symantec Endpoint Protection](https://support.symantec.com/en_US/article.tech173752.html);
- [McAfee EndPoint Security](https://kc.mcafee.com/resources/sites/MCAFEE/content/live/PRODUCT_DOCUMENTATION/26000/PD26799/en_US/ens_1050_help_0-00_en-us.pdf) (дополнительные сведения см. в разделе о проверке только необходимых ресурсов на стр. 90 в PDF-файле);
- [Kaspersky Anti-Virus](https://support.kaspersky.com/4684);
- [Sophos Endpoint Protection](https://community.sophos.com/kb/en-us/40102);
- [TrendMicro OfficeScan](https://success.trendmicro.com/solution/1114377-preventing-performance-or-backup-and-restore-issues-when-using-commvault-software-with-osce-11-0#collapseTwo). 

### <a name="backup-solutions"></a>Решения для архивации
Как и антивирусные решения, решения для архивации могут привести к отзыву многоуровневых файлов. Для архивации файловых ресурсов Azure мы рекомендуем использовать облачное решение для архивации вместо локального.

### <a name="encryption-solutions"></a>Решения для шифрования
Поддержка для решений шифрования зависит от их реализации. Служба синхронизации файлов Azure точно работает со следующими компонентами и функциями:

- шифрование BitLocker;
- Azure Information Protection, Azure Rights Management Services (Azure RMS) и службы Active Directory RMS.

Служба синхронизации файлов Azure точно не работает со следующими компонентами:

- зашифрованная с помощью NTFS файловая система (EFS).

Как правило, служба синхронизации файлов Azure поддерживает взаимодействие с решениями шифрования, реализованными ниже файловой системы, например BitLocker, и с решениями, которые реализованы в файловом формате, например BitLocker. Для решений, реализованных выше файловой системы (например, NTFS EFS), специальное взаимодействие не разработано.

### <a name="other-hierarchical-storage-management-hsm-solutions"></a>Другие решения по управлению иерархическим хранением (HSM)
Другие решения HSM не нужно использовать со службой синхронизации файлов Azure.

## <a name="region-availability"></a>Регионы доступности
Предварительная версия службы синхронизации файлов Azure доступна только в таких регионах:

| Регион | Расположение центра обработки данных |
|--------|---------------------|
| Восточная часть Австралии | Новый Южный Уэльс |
| Центральная Канада | Торонто |
| Восточная Канада | Город Квебек |
| Центральный регион США | Айова |
| Восточная Азия | Гонконг, САР |
| Восток США | Виргиния |
| Восток США 2 | Виргиния |
| Северная Европа | Ирландия |
| Юго-Восточная Азия | Сингапур |
| Южная часть Великобритании | Лондон |
| Западная Европа | Нидерланды |
| Запад США | Калифорния |

В предварительной версии поддерживается только синхронизация с файловым ресурсом Azure в том же регионе, что и служба синхронизации хранилища.

## <a name="azure-file-sync-agent-update-policy"></a>Политика обновления агента службы синхронизации файлов Azure
[!INCLUDE [storage-sync-files-agent-update-policy](../../../includes/storage-sync-files-agent-update-policy.md)]

## <a name="next-steps"></a>Дополнительная информация
* [Параметры брандмауэра и прокси-сервера Синхронизации файлов Azure](storage-sync-files-firewall-and-proxy.md)
* [Планирование развертывания службы файлов Azure](storage-files-planning.md)
* [Как развернуть службу файлов Azure](storage-files-deployment-guide.md)
* [Как развернуть службу синхронизации файлов Azure (предварительная версия)](storage-sync-files-deployment-guide.md)
