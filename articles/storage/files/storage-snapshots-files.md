---
title: Обзор моментальных снимков общих ресурсов для службы файлов Azure | Документация Майкрософт
description: Моментальный снимок общих ресурсов — это версия общих файловых ресурсов Azure только для чтения на определенный момент времени, позволяющая создать резервную копию общих ресурсов.
services: storage
documentationcenter: .net
author: RenaShahMSFT
manager: aungoo
editor: tamram
ms.assetid: edabe3ee-688b-41e0-b34f-613ac9c3fdfd
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/17/2018
ms.author: renash
ms.openlocfilehash: cfb1e6810285886da13aa0bf69faee9c65e2b222
ms.sourcegitcommit: c722760331294bc8532f8ddc01ed5aa8b9778dec
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2018
ms.locfileid: "34738233"
---
# <a name="overview-of-share-snapshots-for-azure-files"></a>Общие сведения о моментальных снимках общих ресурсов для службы файлов Azure 
Служба "Файлы Azure" предоставляет возможность создать моментальные снимки общих ресурсов для файловых ресурсов. В моментальные снимки общих ресурсов записывается состояние общего ресурса на определенный момент времени. В этой статье описаны возможности, предоставляемые моментальными снимками общих ресурсов, а также то, как можно воспользоваться их преимуществами в своих вариантах.

## <a name="when-to-use-share-snapshots"></a>Когда следует использовать моментальные снимки общих ресурсов

### <a name="protection-against-application-error-and-data-corruption"></a>Защита от ошибок приложения и повреждения данных
Приложения, использующие файловые ресурсы, выполняют операции, такие как запись, чтение, хранение, передача и обработка. Если приложение неправильно настроено или возникнет непреднамеренная ошибка, вы можете случайно перезаписать или повредить несколько блоков. Во избежание таких сценариев можно сделать моментальный снимок файловых ресурсов перед развертыванием нового кода приложения. Если ошибка появляется при новом развертывании, можно вернуться к предыдущей версии данных этого файлового ресурса. 

### <a name="protection-against-accidental-deletions-or-unintended-changes"></a>Защита от случайного удаления или нежелательных изменений
Предположим, что вы работаете над текстовым файлом, находящимся в файловом ресурсе. Закрыв текстовый файл, вы теряете возможность откатить изменения. В таких случаях необходимо восстановить предыдущую версию файла. Вы можете воспользоваться моментальными снимками файловых ресурсов, чтобы восстановить предыдущие версии файла, если он случайно переименован или удален.

### <a name="general-backup-purposes"></a>Общие цели архивации
После создания файловых ресурсов можно периодически создавать их моментальные снимки для архивации данных. Создаваемый периодически моментальный снимок файловых ресурсов позволяет поддерживать предыдущие версии данных, которые могут использоваться для аудита или аварийного восстановления.

## <a name="capabilities"></a>Возможности
Моментальный снимок файловых ресурсов — это копия данных на момент времени, предназначенная только для чтения. С помощью REST API можно создавать и удалять моментальные снимки, а также управлять ими. Такие же возможности также доступны в клиентской библиотеке, Azure CLI и на портале Azure. 

Просматривать моментальные снимки файловых ресурсов можно с помощью REST API и SMB. Вы можете извлечь список версий каталога или файла, а также подключить определенную версию напрямую в качестве диска. 

После создания моментального снимка общего ресурса его можно читать, копировать или удалять, но нельзя изменять. Весь моментальный снимок общих ресурсов нельзя скопировать на другую учетную запись хранения, это необходимо сделать с помощью AzCopy или других механизмов копирования.

Возможность совместного доступа к моментальным снимкам предоставляется на уровне файловых ресурсов. Извлечение предоставляется на уровне отдельных файлов, чтобы обеспечить их восстановление. Полный файловый ресурс можно восстановить с помощью SMB, REST API, портала, клиентской библиотеки или инструментария PowerShell и интерфейса командной строки.

Моментальный снимок файловых ресурсов идентичен базовому файловому ресурсу. Единственным отличием является то, что к универсальному коду файлового ресурса (URI) добавляется значение **DateTime**, чтобы указывать время создания моментального снимка. Например, если URI общего ресурса — http://storagesample.core.file.windows.net/myshare, то URI моментального снимка этого ресурса будет иметь такой вид:
```
http://storagesample.core.file.windows.net/myshare?snapshot=2011-03-09T01:42:34.9360000Z
```

Моментальные снимки файлового ресурса хранятся до тех пор, пока не будут явно удалены. При удалении исходного файлового ресурса моментальные снимки файлового ресурса будут также удалены. Чтобы было удобнее контролировать моментальные снимки файлового ресурса, их можно пронумеровать. 

При создании моментального снимка файлового ресурса файлы в системных свойствах файлового ресурса копируются в моментальный снимок файлового ресурса с такими же значениями. Метаданные базовых файлов и файловых ресурсов также копируются в моментальный снимок файлового ресурса, если при его создании не были указаны отдельные метаданные для снимка.

Невозможно удалить файловый ресурс с его моментальными снимками, не удалив сначала все моментальные снимки.

## <a name="space-usage"></a>Использование пространства 
По своей природе моментальные снимки общих ресурсов являются добавочными. Сохраняются только данные, измененные с момента создания последнего моментального снимка. Это позволяет свести к минимуму время, необходимое для создания моментального снимка файлового ресурса, и экономить на затратах на хранение. Все операции записи в объект или свойство, или операции обновления метаданных считаются измененным содержимым и хранятся в моментальном снимке файлового ресурса. 

Чтобы сэкономить место, можно удалить моментальный снимок файлового ресурса за период, когда количество изменений было наибольшим.

Несмотря на то, что папки моментальных снимков сохраняются пошагово, нужно хранить только самые последние моментальные снимки файлового ресурса для восстановления файлового ресурса. При удалении моментального снимка файлового ресурса удаляются только данные, уникальные для этого моментального снимка файлового ресурса. Активные моментальные снимки содержат все сведения, необходимые для просмотра и восстановления данных (с момента создания моментального снимка файлового ресурса) в исходное или другое расположение. Восстановление может быть выполнено на уровне элементов.

Моментальные снимки не учитываются в ограничении файловых ресурсов на 5 ТБ. Ограничений по объему, занятому моментальными снимками файлового ресурса, нет. Ограничения учетной записи хранения по-прежнему применяются.

## <a name="limits"></a>Ограничения
Максимальное количество моментальных снимков доступных сейчас в службе файлов Azure — 200. После 200 моментальных снимков общих ресурсов вам необходимо удалить старые моментальные снимки, чтобы создать новые. 

Ограничений на одновременные вызовы для создания моментального снимка общих ресурсов нет. Ограничений на объем, который может использовать моментальный снимок определенного файлового ресурса, нет. 

## <a name="copying-data-back-to-a-share-from-share-snapshot"></a>Копирование данных из моментального снимка обратно в файловый ресурс
Операции копирования файлов и моментальных снимков подчиняются следующим правилам:

Можно скопировать отдельные файлы в моментальный снимок файлового ресурса с переходом к основному файловому ресурсу или в другое расположение. Восстановить весь файл или его более раннюю версию можно, скопировав файлы из моментального снимка файлового ресурса. Невозможно повысить уровень моментального снимка файлового ресурса до базового файлового ресурса. 

Он остается неизменным после копирования, однако базовый файловый ресурс перезаписывается копией данных, доступных в моментальном снимке. Все восстановленные файлы считаются измененным содержимым.

Файл в моментальном снимке файлового ресурса можно скопировать в назначение с другим именем. Полученный конечный файл является записываемым файлом, а не моментальным снимком файлового ресурса.

Если конечный файл восстанавливается из его копии, это не влияет на связанные с ним моментальные снимки.

## <a name="general-best-practices"></a>Общие рекомендации 
При запуске инфраструктуры на Azure автоматизируйте архивацию для восстановления данных, когда это возможно. Автоматические действия более надежны, чем ручные процессы и помогают улучшить защиту данных и возможности восстановления. Для автоматизации можно использовать REST API, пакет SDK для клиента или сценарии.

Перед развертыванием планировщика моментальных снимков файлового ресурса тщательно продумайте частоту создания и период хранения моментальных снимков, чтобы избежать ненужных расходов.

Моментальные снимки файлового ресурса обеспечивают защиту только на уровне файлов. Они не защищают от неосторожных удалений файлов в файловом ресурсе или учетных записях хранения. Чтобы защитить учетную запись хранения от случайных удалений, можно заблокировать учетную запись хранения или группу ресурсов.

## <a name="next-steps"></a>Дополнительная информация
- Работа с моментальными снимками общих ресурсов с помощью:
    - [Портал](storage-how-to-use-files-portal.md#create-and-modify-share-snapshots)
    - [PowerShell](storage-how-to-use-files-powershell.md#create-and-modify-share-snapshots)
    - [ИНТЕРФЕЙС КОМАНДНОЙ СТРОКИ](storage-how-to-use-files-cli.md#create-and-modify-share-snapshots)
- [Часто задаваемые вопросы о службе "Файлы Azure"](storage-files-faq.md#share-snapshots)