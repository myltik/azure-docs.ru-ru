---
title: Создание и настройка планов восстановления для отработки отказа и восстановления в Azure Site Recovery | Документация Майкрософт
description: Подробнее о создании и настройке планов восстановления в Azure Site Recovery. В этой статье описывается отработка отказа и восстановление виртуальных машин и физических серверов.
services: site-recovery
documentationcenter: ''
author: rayne-wiselman
manager: carmonm
ms.service: site-recovery
ms.topic: article
ms.date: 03/21/2018
ms.author: raynew
ms.openlocfilehash: e02672ea76eada2d660b20f91c4417019d4efc97
ms.sourcegitcommit: 48ab1b6526ce290316b9da4d18de00c77526a541
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2018
ms.locfileid: "30189840"
---
# <a name="create-and-customize-recovery-plans"></a>Создание и настройка планов восстановления

В этой статье описывается создание и настройка плана восстановления в [Azure Site Recovery](site-recovery-overview.md). Прежде чем начать работу, [ознакомьтесь подробными сведениями](recovery-plan-overview.md) о планах восстановления.

## <a name="create-a-recovery-plan"></a>Создайте план восстановления

1. В хранилище служб восстановления выберите **Планы восстановления (Site Recovery)** > **+ План восстановления**.
2. В разделе **Создать план восстановления** укажите имя для нового плана.
3. Выберите исходное и целевое расположение в зависимости от компьютеров в плане, а затем выберите модель развертывания **Resource Manager**. На компьютерах в исходном расположении должны быть настроены отработка отказа и восстановление. 

   **Тип отработки отказа** | **Источник** | **Цель** 
   --- | --- | ---
   Из Azure в Azure | Регион Azure |Регион Azure
   Из VMware в Azure | Сервер конфигурации | Таблицы Azure
   Физические компьютеры в Azure | Сервер конфигурации | Таблицы Azure   
   Из Hyper-V под управлением VMM в Azure  | Отображаемое имя диспетчера виртуальных машин | Таблицы Azure
   Из Hyper-V без VMM в Azure | Имя сайта Hyper-V | Таблицы Azure
   Из VMM в VMM |Понятное имя VMM | Отображаемое имя диспетчера виртуальных машин 

   > [!NOTE]
   > В план восстановления можно включить компьютеры с одинаковыми исходным и целевым расположением. В одном плане нельзя сочетать виртуальные машины VMware и Hyper-V под управлением VMM. В один план можно включить виртуальные машины VMware и физические серверы, если в качестве исходного расположения выбран сервер конфигурации.

2. В окне **Select items virtual machines** (Выбор виртуальных машин) укажите виртуальные машины (или группу репликации), которые нужно добавить в этот план. Нажмите кнопку **ОК**.
    - Компьютеры добавляются в группу плана по умолчанию (группа 1). После отработки отказа все компьютеры в этой группе запускаются одновременно.
    - Вы сможете выбрать компьютеры только в тех расположениях, которые указаны в качестве исходных и целевых. 
1. Щелкните **ОК**, чтобы создать план.

## <a name="add-a-group-to-a-plan"></a>Добавление группы в план

Вы можете создать дополнительные группы и добавить компьютеры в разные группы, чтобы реализовать разные действия для отдельных групп. Например, для каждой группы можно указать время запуска компьютеров после отработки отказа или настроить особые действия.

1. В разделе **Планы восстановления** щелкните нужный план правой кнопкой мыши и выберите **Настройка**. По умолчанию при создании плана все помещенные в него компьютеры входят в группу 1.
2. Щелкните **+ Группа**. По умолчанию группы нумеруются в том порядке, в котором они были добавлены. Вы можете использовать не более семи групп.
3. Выберите компьютер, который хотите переместить в новую группу, щелкните **Изменить группу** и выберите новую группу. Также можно щелкнуть правой кнопкой мыши имя группы, выбрать пункт **Защищенный элемент** и добавить компьютеры в группу. Каждый компьютер и (или) группа репликации может принадлежать только к одной группе в плане восстановления.


## <a name="add-a-script-or-manual-action"></a>Добавление скрипта или выполняемого вручную действия

Вы можете настроить план восстановления, добавив в него скрипт или выполняемое вручную действие. Обратите внимание на следующее.

- При репликации в Azure вы можете интегрировать в план восстановления модули Runbook службы автоматизации Azure. [Узнайте больше](site-recovery-runbook-automation.md).
- Если для репликации выбраны виртуальные машины Hyper-V под управлением System Center VMM, можно создать скрипт на локальном сервере VMM и включить его в план восстановления.
- Каждый новый скрипт добавляет к группе новый набор действий. Например, для группы с именем Group 1 создается набор предварительных действий с именем *Group 1: pre-steps*. Все предварительные действия перечислены в этом наборе. Чтобы добавить сценарий, на основном сайте должен быть развернут сервер VMM.
- Если добавлено выполняемое вручную действие, выполнение плана восстановления будет приостанавливаться в той точке, куда вы добавили это действие. При этом появляется диалоговое окно с предложением подтвердить, что это действие выполнено вручную.
- Чтобы создать скрипт на сервере VMM, выполните инструкции из [этой статьи](hyper-v-vmm-recovery-script.md).
- Скрипты могут применяться при отработке отказа на дополнительный сайт, а также при восстановлении размещения с дополнительного сайта на основной. В зависимости от сценария репликации поддерживаются разные варианты:
    
    **Сценарий** | **Тип отработки отказа** | **Восстановление размещения**
    --- | --- | --- 
    Из Azure в Azure  | Модуль Runbook | Модуль Runbook
    VMware — Azure | Модуль Runbook | Нет данных 
    С виртуальных машин Hyper-V (с VMM) в Azure | Модуль Runbook | Скрипт
    С сайта Hyper-V в Azure | Модуль Runbook | Нет данных
    Из VMM на дополнительный сервер VMM | Скрипт | Скрипт

1. В плане восстановления щелкните шаг, к которому нужно добавить действие, и выберите для него время выполнения. a) Если действие должно происходить перед запуском компьютеров группы после отработки отказа, выберите вариант **Добавить предварительное действие**.
    б) Если действие должно происходить после запуска компьютеров группы, для которых выполнена отработка отказа, выберите вариант **Добавить завершающее действие**. Вы можете изменить положение действия с помощью кнопок управления **Move Up** (Переместить выше) и **Move Down** (Переместить ниже).
2. В диалоговом окне **Добавление действия** выберите **Скрипт** или **Выполняемое вручную действие**.
3. Если вы хотите добавить выполняемое вручную действие, сделайте следующее. a) Введите имя для действия и инструкции по его выполнению. Эти инструкции будут предоставлены пользователю, который запустит отработку отказа.
    б) Укажите, следует ли добавить выполняемое вручную действие для всех типов отработки отказа (тестовая, обычная и плановая (если применимо)). Нажмите кнопку **ОК**.
4. Если вы хотите добавить скрипт, сделайте следующее. a) При добавлении сценария VMM выберите **Сценарий отработки отказа в VMM** и в поле **Путь к сценарию** введите относительный путь к общей папке. Например, если общая папка расположена по адресу \\<VMMServerName>\MSSCVMMLibrary\RPScripts, укажите путь \RPScripts\RPScript.PS1.
    б) При добавлении модуля Runbook службы автоматизации Azure укажите **Учетную запись службы автоматизации Azure**, в которой расположен модуль Runbook, и выберите соответствующий **сценарий модуля Runbook для Azure**.
5. Выполните тестовую отработку отказа для плана восстановления, чтобы проверить, правильно ли выполняется скрипт.

## <a name="watch-a-video"></a>Просмотр видео

Просмотрите видеоролик, демонстрирующий создание плана восстановления.


> [!VIDEO https://www.youtube.com/embed/1KUVdtvGqw8]

## <a name="next-steps"></a>Дополнительная информация

[Дополнительные сведения](site-recovery-failover.md) о выполнении отработки отказа.  

    
