---
title: "Защита многоуровневого развертывания приложения SAP NetWeaver с помощью Azure Site Recovery | Документация Майкрософт"
description: "В этой статье описывается, как защитить развернутые приложения SAP NetWeaver с помощью Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: mayanknayar
manager: rochakm
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/07/2017
ms.author: manayar
ms.openlocfilehash: 951980eeba61e53c983d5b23c301c81eee9528bd
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="protect-a-multi-tier-sap-netweaver-application-deployment-using-azure-site-recovery"></a>Защита многоуровневого развертывания приложения SAP NetWeaver с помощью Azure Site Recovery

Для большинства больших и средних развертываний SAP используется какая-либо разновидность решения аварийного восстановления.  По мере переноса все большего числа ключевых бизнес-процессов в такие приложения, как SAP, повысилась важность надежных и тестируемых решений аварийного восстановления.  Решение Azure Site Recovery было проверено и интегрировано с приложениями SAP. То, что оно предлагает, превышает возможности большинства локальных решений аварийного восстановления. При этом его совокупная стоимость владения (TCO) меньше, чем у конкурирующих решений.
Служба Azure Site Recovery предоставляет следующие возможности:
* защита рабочих приложений SAP NetWeaver и других приложений, запущенных в локальной среде, с помощью репликации компонентов в Azure;
* защита рабочих приложений SAP NetWeaver и других приложений, запущенных в Azure, с помощью репликации компонентов в другой центр обработки данных Azure;
* упрощение миграции в облако благодаря использованию Site Recovery для переноса развертывания SAP в Azure;
* упрощение обновления, тестирования и создания прототипов проектов SAP путем создания рабочего клона по запросу для тестирования приложений SAP.

В этой статье описывается, как защитить развернутые приложения SAP NetWeaver с помощью [Azure Site Recovery](site-recovery-overview.md). В этой статье приведены рекомендации по защите трехуровневого развертывания SAP NetWeaver в Azure посредством репликации в другой центр обработки данных Azure с помощью Azure Site Recovery. В ней описываются поддерживаемые сценарии и конфигурации, а также поясняется, как выполнять отработку отказа — тестовую (отработку аварийного восстановления) и фактическую.


## <a name="prerequisites"></a>Предварительные требования
Прежде чем продолжить, ознакомьтесь со следующими статьями:

1. [Репликация виртуальных машин VMware в Azure с помощью Site Recovery](azure-to-azure-walkthrough-enable-replication.md)
2. [Проектирование сети для аварийного восстановления](site-recovery-azure-to-azure-networking-guidance.md)
3. [Тестовая отработка отказа в Azure в Site Recovery](azure-to-azure-walkthrough-test-failover.md)
4. [Отработка отказа в Site Recovery](site-recovery-failover.md)
5. [Защита Active Directory и DNS с Azure Site Recovery](site-recovery-active-directory.md)
6. [Защита SQL Server с помощью аварийного восстановления SQL Server и Azure Site Recovery](site-recovery-sql.md)

## <a name="supported-scenarios"></a>Поддерживаемые сценарии использования.
С помощью Azure Site Recovery можно реализовать решение аварийного восстановления для приведенных ниже сценариев.
* Системы SAP, работающие в одном центре обработки данных Azure, реплицируются в другой центр обработки данных Azure (аварийное восстановления из Azure в Azure). Подобная архитектура описывается [здесь](https://aka.ms/asr-a2a-architecture).
* Системы SAP, работающие на локальных серверах VMware (или физических серверах), реплицируются на сайт аварийного восстановления в центре обработки данных Azure (аварийное восстановление из VMware в Azure), для чего требуются некоторые дополнительные компоненты. Подобная архитектура описывается [здесь](https://aka.ms/asr-v2a-architecture).
* Системы SAP, работающие в локальной среде Hyper-V, реплицируются на сайт аварийного восстановления в центре обработки данных Azure (аварийное восстановление из Hyper-V в Azure), для чего требуются некоторые дополнительные компоненты. Подобная архитектура описывается [здесь](https://aka.ms/asr-h2a-architecture).

В этом документе описывается первый случай, аварийное восстановление из Azure в Azure, для демонстрации возможностей аварийного восстановления Azure Site Recovery в среде SAP. Так как репликация Azure Site Recovery не зависит от приложения, описываемый процесс подойдет и для других сценариев.

### <a name="required-foundation-services"></a>Требуемые основные службы
Описываемый в этой документации сценарий был развернут с помощью следующих основных служб.
* ExpressRoute или виртуальная частная сеть (VPN) типа "сеть — сеть".
* По крайней мере один контроллер домена Active Directory и DNS-сервер, работающий в Azure.

Рекомендуется установить приведенную выше инфраструктуру перед развертыванием Azure Site Recovery.


## <a name="typical-sap-application-deployment"></a>Типичное развертывание приложения SAP
Крупные клиенты, использующие SAP, обычно развертывают от 6 до 20 отдельных приложений SAP.  Большинство этих приложений основано на ядрах SAP NetWeaver ABAP или Java.  Для поддержки этих основных приложений NetWeaver используется множество специальных изолированных обработчиков (не SAP NetWeaver) и, как правило, некоторые сторонние приложения (не SAP).  

Крайне важно инвентаризировать все приложения SAP, выполняемые в среде, и определить режим развертывания (2- или 3-уровневый), версии, исправления, размеры, скорость изменения данных и требования к сохраняемости дисков.

![Модель развертывания](./media/site-recovery-sap/sap-typical-deployment.png)

Уровень сохраняемости базы данных SAP следует защитить с помощью собственных инструментов СУБД, например SQL Server AlwaysOn, Oracle DataGuard или HANA System Replication. Уровень клиента также не защищен Azure Site Recovery, но важно принять во внимание характеристики, которые влияют на этот уровень, например задержку распространения DNS, безопасность и удаленный доступ к центру обработки данных аварийного восстановления.

Azure Site Recovery является рекомендуемым решением для прикладного уровня, включая (A)SCS. Другие приложения, например сторонние приложения (не SAP и не NetWeaver SAP), являются частью общей среды развертывания SAP и также должны быть защищены с помощью Azure Site Recovery.

## <a name="replicate-virtual-machines"></a>Репликация виртуальных машин
Используйте [это руководство](azure-to-azure-walkthrough-enable-replication.md), чтобы реплицировать все виртуальные машины приложений SAP в центр обработки данных аварийного восстановления Azure.

Если вы используете статический IP-адрес, то можете указать нужный IP-адрес для виртуальной машины в разделе "Network interface cards" (Сетевые адаптеры) на странице параметров "Вычисления и сеть".

![Целевой IP-адрес](./media/site-recovery-sap/sap-static-ip.png)


## <a name="creating-a-recovery-plan"></a>Создание плана восстановления
План восстановления в многоуровневом приложении позволяет выполнять виртуализацию отработки отказов различных уровней, а значит — поддерживает целостность на уровне приложения. При создании плана восстановления для многоуровневого веб-приложения следует выполнить действия, приведенные [здесь](site-recovery-create-recovery-plans.md).

### <a name="adding-scripts-to-the-recovery-plan"></a>Добавление скриптов в план восстановления
Вам может потребоваться выполнить некоторые операции после отработки отказа виртуальных машин Azure или тестовой отработки отказа, чтобы обеспечить правильную работу приложений. Вы можете автоматизировать выполнение таких операций после отработки отказа, как обновление записи DNS, изменение привязок и подключений, добавив соответствующие сценарии в план восстановления, как описано в [этой статье](site-recovery-create-recovery-plans.md#add-scripts).

### <a name="dns-update"></a>Обновление DNS
Если в DNS настроено динамическое обновление, то виртуальные машины обычно обновляют IP-адрес сразу после запуска. Если вы хотите добавить явное действие для обновления DNS (обновление IP-адреса виртуальных машин), тогда добавьте этот [скрипт для обновления IP-адреса в DNS](https://aka.ms/asr-dns-update) как завершающее действие в группах плана восстановления.  

## <a name="example-azure-to-azure-deployment"></a>Пример развертывания из Azure в Azure
На схеме ниже показан сценарий аварийного восстановления Azure Site Recovery из Azure в Azure.
* Основной центр обработки данных находится в Сингапуре (регион Azure "Юго-Восточная Азия"), а центр обработки данных аварийного восстановления — в Гонконге (регион Azure "Восточная Азия").  В этом сценарии высокий уровень доступности локальной среды обеспечивается двумя виртуальными машинами SQL Server AlwaysOn в Сингапуре, работающими в синхронном режиме.
* Для обеспечения высокого уровня доступности компонентов, обуславливающих единые точки отказа SAP, можно использовать ASCS файлового ресурса. Для ASCS файлового ресурса не требуется ни общий диск кластера, ни такие приложения, как SIOS.
* Защита посредством аварийного восстановления для уровня СУБД обеспечивается с помощью асинхронной репликации.
* В этом сценарии демонстрируется "симметричное аварийное восстановление". Так называется решение аварийного восстановления, которое является точной репликой рабочей среды, поэтому решение аварийного восстановления SQL Server обеспечивает высокий уровень доступности локальных ресурсов. Использование симметричного аварийного восстановления не является обязательным для уровня базы данных, и многие клиенты используют гибкость облачных развертываний для быстрого создания высокодоступного локального узла после события аварийного восстановления.
* На схеме показан уровень ASCS и сервера приложений SAP NetWeaver, реплицируемый с помощью Azure Site Recovery.

![Сценарий репликации](./media/site-recovery-sap/sap-replication-scenario.png)

## <a name="doing-a-test-failover"></a>Тестовая отработка отказа
Чтобы выполнить тестовую отработку отказа, используйте [это руководство](azure-to-azure-walkthrough-test-failover.md).

1.  Перейдите на портал Azure и выберите хранилище служб восстановления.
2.  Щелкните план восстановления, созданный для приложений SAP.
3.  Щелкните "Тестовая отработка отказа".
4.  Выберите точку восстановления и виртуальную сеть Azure, чтобы запустить тестовую отработку отказа.
5.  Как только будет запущена вторичная среда, вы сможете выполнить проверку.
6.  После завершения проверок щелкните "Очистить тестовую отработку отказа", чтобы очистить среду отработки отказа.

## <a name="doing-a-failover"></a>Отработка отказа
При выполнении отработки отказа используйте [это руководство](site-recovery-failover.md).

1.  Перейдите на портал Azure и выберите хранилище служб восстановления.
2.  Щелкните план восстановления, созданный для приложений SAP.
3.  Щелкните "Отработка отказа".
4.  Выберите точку восстановления, чтобы запустить отработку отказа.

## <a name="next-steps"></a>Дальнейшие действия
Узнайте больше о создании решения аварийного восстановления для развертываний SAP NetWeaver с помощью Azure Site Recovery, прочитав [этот технический документ](http://aka.ms/asr-sap). В этом техническом документе рассматриваются рекомендации для разных архитектур SAP, приводятся поддерживаемые приложения и типы виртуальных машин для SAP в Azure, а также описываются возможные планы тестирования для решения аварийного восстановления.

Узнайте больше о [репликации других рабочих нагрузок](site-recovery-workload.md) с помощью Site Recovery.
