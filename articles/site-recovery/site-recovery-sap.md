---
title: Защита многоуровневого развертывания приложения SAP NetWeaver с помощью Azure Site Recovery | Документация Майкрософт
description: В этой статье описывается, как защитить развернутые приложения SAP NetWeaver с помощью Azure Site Recovery.
services: site-recovery
documentationcenter: ''
author: mayanknayar
manager: rochakm
editor: ''
ms.assetid: ''
ms.service: site-recovery
ms.workload: backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/11/2018
ms.author: manayar
ms.openlocfilehash: e2107177663163259d1f731717c4910bc986fc1f
ms.sourcegitcommit: c52123364e2ba086722bc860f2972642115316ef
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2018
---
# <a name="protect-a-multi-tier-sap-netweaver-application-deployment-by-using-site-recovery"></a>Защита многоуровневого развертывания приложения SAP NetWeaver с помощью Site Recovery

Для большинства развертываний большого и среднего размера SAP используется какая-либо разновидность решения аварийного восстановления. По мере переноса все большего числа ключевых бизнес-процессов в такие приложения, как SAP, повысилась важность надежных и тестируемых решений аварийного восстановления. Azure Site Recovery был протестирован и интегрирован с приложениями SAP. Служба Site Recovery превышает возможности большинства локальных решений аварийного восстановления. При этом ее совокупная стоимость владения (TCO) меньше, чем у конкурирующих решений.

Служба Site Recovery предоставляет следующие возможности:
* **защита рабочих приложений SAP NetWeaver и других приложений, запущенных в локальной среде**, с помощью репликации компонентов в Azure;
* **защита рабочих приложений SAP NetWeaver и других приложений, запущенных в Azure**, с помощью репликации компонентов в другой центр обработки данных Azure;
* **упрощение миграции в облако** благодаря использованию Site Recovery для переноса развертывания SAP в Azure;
* **упрощение обновления, тестирования и создания прототипов проектов SAP** путем создания рабочего клона по запросу для тестирования приложений SAP.

В этой статье описывается, как защитить развернутые приложения SAP NetWeaver с помощью [Azure Site Recovery](site-recovery-overview.md). В статье описаны рекомендации по защите трехуровневого развертывания SAP NetWeaver в Azure путем репликации в другой центр обработки данных Azure с помощью Site Recovery. Здесь описываются поддерживаемые сценарии, конфигурации и способы выполнения тестовой отработки отказа (тестового аварийного восстановления), а также фактическая отработка отказа.

## <a name="prerequisites"></a>предварительным требованиям
Прежде чем начать, необходимо знать, как выполнять следующие задачи:

* [Репликация виртуальной машины в Azure](azure-to-azure-walkthrough-enable-replication.md).
* [Проектирование сети для аварийного восстановления](site-recovery-azure-to-azure-networking-guidance.md).
* [Выполнение тестовой отработки отказа в Azure](azure-to-azure-walkthrough-test-failover.md).
* [Выполнение отработки отказа в Azure](site-recovery-failover.md).
* [Репликация контроллера домена](site-recovery-active-directory.md).
* [Репликация SQL Server](site-recovery-sql.md)

## <a name="supported-scenarios"></a>Поддерживаемые сценарии использования.
С помощью Site Recovery можно реализовать решение аварийного восстановления для приведенных ниже сценариев:
* Системы SAP, работающие в одном центре обработки данных Azure, реплицируются в другой центр обработки данных Azure (аварийное восстановление из Azure в Azure). Дополнительные сведения см. в статье [Azure to Azure replication architecture](https://aka.ms/asr-a2a-architecture) (Архитектура репликации из Azure в Azure).
* Системы SAP, выполняемые на локальных физических серверах или серверах VMware, которые реплицируются на сайт аварийного восстановления в центр обработки данных Azure (аварийное восстановление из VMware в Azure). Данному сценарию требуются некоторые дополнительные компоненты. Дополнительные сведения см. в статье [Архитектура репликации из VMware в Azure](https://aka.ms/asr-v2a-architecture).
* Системы SAP, выполняемые в локальных Hyper-V, которые реплицируются на сайт аварийного восстановления в центр обработки данных Azure (аварийное восстановление из VMware в Azure). Данному сценарию требуются некоторые дополнительные компоненты. Дополнительные сведения см. в статье [Архитектура репликации из Hyper-V в Azure](https://aka.ms/asr-h2a-architecture).

В этой статье используется сценарий аварийного восстановления из Azure в Azure, чтобы показать возможности аварийного восстановления SAP Site Recovery. Так как репликация Site Recovery не относится к приложению, описанный процесс применим к другим сценариям.

### <a name="required-foundation-services"></a>Требуемые основные службы
В сценарии, описанном в этой статье, развертываются следующие основные службы:
* Azure ExpressRoute или VPN-шлюз Azure;
* по крайней мере один контроллер домена Active Directory и DNS-сервер, работающий в Azure.

Рекомендуем развернуть эту инфраструктуру перед развертыванием Site Recovery.

## <a name="typical-sap-application-deployment"></a>Типичное развертывание приложения SAP
Крупные клиенты, использующие SAP, обычно развертывают от 6 до 20 отдельных приложений SAP. Большинство этих приложений основано на ядрах SAP NetWeaver ABAP или Java. Для поддержки этих основных приложений NetWeaver используется множество специальных изолированных обработчиков (не SAP NetWeaver) и, как правило, некоторые сторонние приложения (не SAP).  

Крайне важно инвентаризировать все приложения SAP, выполняемые в среде, а также определить режим развертывания (2- или 3-уровневый), версии, исправления, размеры, скорость изменения данных и требования к сохраняемости дисков.

![Схема обычного шаблона развертывания SAP](./media/site-recovery-sap/sap-typical-deployment.png)

Уровень сохраняемости базы данных SAP следует защитить с помощью собственных инструментов СУБД, например SQL Server AlwaysOn, Oracle DataGuard или репликации системы SAP HANA. Как и уровень базы данных SAP, уровень клиента не защищен Site Recovery. Важно учитывать факторы, влияющие на этот уровень (задержки распространения DNS, безопасность и удаленный доступ к центрам обработки данных аварийного восстановления).

Azure Site Recovery является рекомендуемым решением для прикладного уровня, включая SAP SCS и ASCS. Другие приложения, например сторонние приложения (не SAP и не NetWeaver SAP), являются частью общей среды развертывания SAP. Они должны быть защищены с помощью Site Recovery.

## <a name="replicate-virtual-machines"></a>Репликация виртуальных машин
Чтобы начать, репликацию всех виртуальных машин приложений SAP в центре обработки данных аварийного восстановления Azure, следуйте указаниям в статье о [репликации виртуальных машин в Azure](azure-to-azure-walkthrough-enable-replication.md).

Если используется статический IP-адрес, вы можете указать нужный IP-адрес для виртуальной машины. Чтобы задать IP-адрес, откройте раздел **Compute and Network settings** (Параметры вычисления и сети) > **Network interface card** (Сетевой адаптер).

![Снимок экрана, показывающий, как установить частный IP-адрес в области карты сетевого интерфейса Site Recovery](./media/site-recovery-sap/sap-static-ip.png)

## <a name="create-a-recovery-plan"></a>Создайте план восстановления
План восстановления позволяет воссоздать последовательность различных уровней в многоуровневом приложении во время отработки отказа. Благодаря этому обеспечивается целостность на уровне приложения. При создании плана восстановления для многоуровневого веб-приложения выполните действия, описанные в [этой статье](site-recovery-create-recovery-plans.md).

### <a name="add-scripts-to-the-recovery-plan"></a>Добавление сценариев в план восстановления
Чтобы настроить правильную работу приложений, вам может потребоваться выполнить некоторые операции после отработки отказа виртуальных машин Azure или во время тестовой отработки отказа. Вы можете настроить автоматическое выполнение некоторых операций после отработки отказа. Например, можно обновить записи DNS, изменить привязку сайта и подключение, добавив соответствующие сценарии в план восстановления.

### <a name="dns-update"></a>Обновление DNS
Если в DNS настроено динамическое обновление, виртуальные машины обычно обновляют IP-адрес сразу после запуска. Если вы хотите добавить явное действие для обновления DNS (обновление IP-адреса виртуальных машин), добавьте [сценарий для обновления IP-адреса в DNS](https://aka.ms/asr-dns-update) как завершающее действие после отработки отказа в группах плана восстановления.  

## <a name="example-azure-to-azure-deployment"></a>Пример развертывания из Azure в Azure
На следующей схеме показан сценарий аварийного восстановления из Azure в Azure службы Site Recovery:

![Схема сценария репликации из Azure в Azure](./media/site-recovery-sap/sap-replication-scenario.png)

* Основной центр обработки данных расположен в Сингапуре (регион Azure "Юго-Восточная Азия"). Центр обработки данных аварийного восстановления — в Гонконге (регион Azure "Восточная Азия"). В этом сценарии высокий уровень доступности локальной среды обеспечивается двумя виртуальными машинами SQL Server AlwaysOn в Сингапуре, работающими в синхронном режиме.
* Общая папка SAP ASCS предоставляет высокий уровень доступности для единых точек отказа SAP. Общей папке ASCS не требуется общий диск кластера. Такие приложения, как SIOS, не являются обязательными.
* Защита через аварийное восстановление для уровня СУБД обеспечивается с помощью асинхронной репликации.
* Этот сценарий показывает симметричное аварийное восстановление. Этот термин описывает решение аварийного восстановления, являющегося точной копией рабочей среды. Решение аварийного восстановление SQL Server имеет локальную высокую доступность. Симметричное аварийное восстановление не является обязательным для слоя базы данных. Многие клиенты пользуются гибкостью возможностей развертывания облака для быстрого создания локального узла высокой доступности после события аварийного восстановления.
* На схеме показан уровень ASCS и сервера приложений SAP NetWeaver, реплицируемый с помощью Site Recovery.

## <a name="run-a-test-failover"></a>Запуск тестовой отработки отказа

1.  На портале Azure выберите хранилище служб восстановления.
2.  Выберите план восстановления, созданный для приложений SAP.
3.  Выберите **Тестовая отработка отказа**.
4.  Чтобы запустить тестовую отработку отказа, выберите точку восстановления и виртуальную сеть Azure.
5.  После запуска вторичной среды можно выполнить проверку.
6.  После завершения проверки выберите **Очистить тестовую отработку отказа**, чтобы очистить среду отработки отказа.

Дополнительные сведения см. в статье [Тестовая отработка отказа в Azure с помощью Site Recovery](site-recovery-test-failover-to-azure.md).

## <a name="run-a-failover"></a>Запуск отработки отказа

1.  На портале Azure выберите хранилище служб восстановления.
2.  Выберите план восстановления, созданный для приложений SAP.
3.  Выберите **Отработка отказа**.
4.  Чтобы запустить отработку отказа, выберите точку восстановления.

Дополнительные сведения см. в статье [Отработка отказа в Site Recovery](site-recovery-failover.md).

## <a name="next-steps"></a>Дополнительная информация
* Дополнительные сведения о создании решения аварийного восстановления для развертываний SAP NetWeaver с помощью Site Recovery см. в скачиваемом техническом документе [SAP NetWeaver: Building a Disaster Recovery Solution with Azure Site Recovery](http://aka.ms/asr-sap) (SAP NetWeaver. Создание решения аварийного восстановления с помощью Azure Site Recovery). В этом техническом документе рассматриваются рекомендации для разных архитектур SAP, приводятся поддерживаемые приложения и типы виртуальных машин для SAP в Azure, а также описываются планы тестирования для решения аварийного восстановления.
* Узнайте больше о [репликации других рабочих нагрузок](site-recovery-workload.md) с помощью Site Recovery.
