---
title: 'Устранение сбоя агента Azure Site Recovery: состояние гостевого агента "Недоступно" | Документы Майкрософт'
description: Симптомы, причины и способы устранения проблем в работе Azure Site Recovery, связанных с агентом или расширением.
services: site-recovery
author: asgang
manager: rochakm
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.date: 05/02/2018
ms.author: asgang
ms.openlocfilehash: 9bfe181b2271f4e8af6f43e1728167712dade8ee
ms.sourcegitcommit: e221d1a2e0fb245610a6dd886e7e74c362f06467
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2018
ms.locfileid: "33777605"
---
# <a name="troubleshoot-azure-site-recovery-extension-failures-issues-with-the-agent-or-extension"></a>Устранение неполадок в работе расширения Azure Site Recovery. Проблемы с агентом или расширением

В этой статье описано, как устранять ошибки Azure Site Recovery, связанные с расширением и агентом виртуальной машины.


## <a name="azure-site-recovery-extension-time-out"></a>Время ожидания для расширения Azure Site Recovery  

Сообщение об ошибке: "Task execution has timed out while tracking for extension operation to be started" (Истекло время ожидания выполнения задачи при отслеживании запуска операции расширения)<br>
Код ошибки: "151076"

 Azure Site Recovery устанавливает расширение на виртуальной машине в рамках задания включения защиты. Любое из указанных ниже условий может помешать активации защиты и привести к сбою задания. Выполните следующие шаги по устранению неполадок, а затем повторите операцию:

**Причина 1. [Агент установлен на виртуальной машине, но не отвечает (для виртуальных машин Windows)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)**  .  
**Причина 2. [Устарел агент, установленный на виртуальной машине (для виртуальных машин Linux)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)**.  
**Причина 3. [Не удалось обновить или загрузить расширение Site Recovery](#the-site-recovery-extension-fails-to-update-or-load)**.  

Сообщение об ошибке: "Previous site recovery extension operation is taking more time than expected" (Предыдущая операция расширения Site Recovery занимает больше времени, чем ожидалось)<br>
Код ошибки: "150066"<br>

**Причина 1. [Агент установлен на виртуальной машине, но не отвечает (для виртуальных машин Windows)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)**  .  
**Причина 2. [Устарел агент, установленный на виртуальной машине (для виртуальных машин Linux)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)**.  
**Причина 3. [Неправильное состояние расширения Site Recovery](#the-site-recovery-extension-fails-to-update-or-load)**.  

## <a name="protection-fails-because-the-vm-agent-is-unresponsive"></a>Защита завершается ошибкой, так как агент виртуальной машины не отвечает

Сообщение об ошибке: "Task execution has timed out while tracking for extension operation to be started" (Истекло время ожидания выполнения задачи при отслеживании запуска операции расширения)<br>
Код ошибки: "151099"<br>

Эта ошибка может возникать, если гостевой агент Azure на виртуальной машине не находится в состоянии готовности.
Состояние гостевого агента Azure можно проверить на [портале Azure](https://portal.azure.com/). Перейдите к виртуальной машине, которую хотите защитить, и проверьте состояние в разделе "Виртуальная машина" > "Параметры" > "Свойства" > "Состояние агента". В большинстве случаев агент переходит в состояние готовности после перезагрузки виртуальной машины. Однако если перезагрузка не подходит или не позволяет устранить проблему, выполните указанные ниже действия.

**Причина 1. [Агент установлен на виртуальной машине, но не отвечает (для виртуальных машин Windows)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)**  .  
**Причина 2. [Устарел агент, установленный на виртуальной машине (для виртуальных машин Linux)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)**.  


Сообщение об ошибке: "Task execution has timed out while tracking for extension operation to be started" (Истекло время ожидания выполнения задачи при отслеживании запуска операции расширения)<br>
Код ошибки: "151095"<br>

Эта ситуация возникает, когда на компьютере Linux используется старая версия агента. Выполните указанный ниже шаг по устранению неполадок.<br>
  **Причина 1. [Устарел агент, установленный на виртуальной машине (для виртуальных машин Linux)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)**.  
## <a name="causes-and-solutions"></a>Причины и решения

### <a name="the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a>Агент установлен на виртуальной машине, но не отвечает (для виртуальных машин Windows)

#### <a name="solution"></a>Решение
Возможно, агент виртуальной машины может быть поврежден или служба остановлена. Повторная установка агента виртуальной машины поможет получить последнюю версию и возобновить обмен данными со службой.

1. Определите, запущена ли служба гостевого агента Microsoft Azure в службах виртуальной машины (services.msc). Попробуйте перезапустить службу гостевого агента Microsoft Azure.    
2. Если она не отображается в списке служб, на панели управления выберите **Программы и компоненты**, чтобы определить, установлена ли служба гостевого агента Microsoft Azure.
4. Если гостевой агент Microsoft Azure отображается в разделе **Программы и компоненты**, удалите его.
5. Скачайте и установите [последнюю версию файла MSI агента](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409). Чтобы выполнить установку, необходимо иметь права администратора.
6. Убедитесь, что службы гостевого агента Microsoft Azure отображаются в списке служб.
7. Перезапустите задание защиты.

Кроме того, убедитесь, что [Microsoft .NET 4.5 установлен](https://docs.microsoft.com/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed) на виртуальной машине. Компонент .NET 4.5 необходим для взаимодействия агента виртуальной машины со службой.

### <a name="the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a>Устарел агент, установленный на виртуальной машине (для виртуальных машин Linux)

#### <a name="solution"></a>Решение
Большая часть неполадок, связанных с агентом или расширением на виртуальных машинах Linux, вызваны проблемами с устаревшим агентом виртуальной машины. Чтобы устранить эту проблему, следуйте приведенным ниже общим рекомендациям.

1. Выполните указания по [обновлению агента виртуальной машины Linux ](../virtual-machines/linux/update-agent.md).

 > [!NOTE]
 > Мы *настоятельно рекомендуем* обновлять агент только посредством репозитория дистрибутивов. Мы не рекомендуем скачивать код агента непосредственно с портала GitHub и обновлять его. Если последняя версия агента для вашего дистрибутива недоступна, обратитесь в службу поддержки дистрибутива, чтобы получить инструкции по установке последней версии агента. Чтобы проверить наличие последней версии агента, перейдите на страницу [агента Linux для Microsoft Azure](https://github.com/Azure/WALinuxAgent/releases) в репозитории GitHub.

2. Убедитесь, что на виртуальной машине запущен агент Azure, выполнив команду `ps -e`.

 Если нужный процесс не запущен, выполните следующие команды для его перезапуска:

 * Для Ubuntu: `service walinuxagent start`.
 * Для других дистрибутивов: `service waagent start`.

3. [Настройте автоматический перезапуск агента](https://github.com/Azure/WALinuxAgent/wiki/Known-Issues#mitigate_agent_crash).
4. Включите защиту для виртуальной машины.



### <a name="the-site-recovery-extension-fails-to-update-or-load"></a>Не удалось обновить или загрузить расширение Site Recovery
Если состояние расширения имеет значение "Empty', "NotReady" или "Transitioning".

#### <a name="solution"></a>Решение

Удалите расширение и перезапустите операцию.

Чтобы удалить расширение, сделайте следующее:

1. На [портале Azure](https://portal.azure.com/) перейдите к виртуальной машине, с архивацией которой возникли проблемы.
2. Выберите элемент **Параметры**.
3. Выберите **Расширения**.
4. Выберите **Расширение Site Recovery**.
5. Выберите **Удалить**.

Если расширение VMSnapshot для виртуальной машины Linux не отображается на портале Azure, [обновите агент Azure для Linux](../virtual-machines/linux/update-agent.md), а затем запустите защиту. 

После этого расширение будет повторно установлено при активации защиты.


