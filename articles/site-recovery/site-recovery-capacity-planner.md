---
title: "Оценка нагрузки репликации в Azure | Документация Майкрософт"
description: "Используйте данную статью, чтобы оценить производительность репликации с помощью Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: 0a1cd8eb-a8f7-4228-ab84-9449e0b2887b
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 02/06/2017
ms.author: nisoneji
translationtype: Human Translation
ms.sourcegitcommit: 3b606aa6dc3b84ed80cd3cc5452bbe1da6c79a8b
ms.openlocfilehash: 7ec48138cf18cf50dc34f28e177c8d774034090b


---
# <a name="plan-capacity-for-protecting-virtual-machines-and-physical-servers-in-azure-site-recovery"></a>Планирование производительности для защиты виртуальных машин и физических серверов в Azure Site Recovery

Планировщик ресурсов Azure Site Recovery позволяет определить требования к производительности для репликации виртуальных машин Hyper-V, виртуальных машин VMware и физических серверов под управлением Windows и Linux с помощью Azure Site Recovery.

С помощью планировщика ресурсов Site Recovery можно проанализировать исходную среду и рабочие нагрузки и оценить требования к пропускной способности, а также определить объем ресурсов сервера, которые следует выделить в исходном расположении, и ресурсов (виртуальных машин, хранилищ и т. д.), требуемых для целевого расположения.

Его можно использовать в нескольких режимах:

* **Быстрое планирование.** Запустите средство в этом режиме, чтобы получить проекции сети и сервера на основе среднего числа виртуальных машин, дисков, объема хранилища и частоты изменений.
* **Детальное планирование.** Запустите средство в этом режиме, чтобы задать сведения о каждой рабочей нагрузке на уровне виртуальной машины. Проанализируйте совместимость виртуальной машины и получите проекции сети и сервера.

## <a name="before-you-start"></a>Перед началом работы


1. Соберите сведения о среде, включая информацию о виртуальных машинах, количестве дисков на виртуальную машину и объеме хранилища на диск.
2. Определите частоту ежедневных изменений (обновлений) реплицированных данных. Для этого:

   * При репликации виртуальных машин Hyper-V следует скачать [средство планирования загрузки Hyper-V](https://www.microsoft.com/download/details.aspx?id=39057), чтобы получить сведения о частоте изменений. См. [дополнительные сведения](site-recovery-capacity-planning-for-hyper-v-replication.md) об этом средстве. Мы советует использовать это средство в течение недели, чтобы получить средние значения.
   * При репликации виртуальных машин VMware воспользуйтесь [устройством планирования загрузки vSphere](https://labs.vmware.com/flings/vsphere-replication-capacity-planning-appliance) , чтобы выяснить частоту изменений.
   * При репликации физических серверов необходимо оценить частоту изменений вручную.

## <a name="run-the-quick-planner"></a>Запуск средства быстрого планирования
1. Скачайте и откройте [планировщик ресурсов Azure Site Recovery](http://aka.ms/asr-capacity-planner-excel) . Для этого потребуется запустить макрос, поэтому при появлении запроса выберите включение редактирования и содержимого.
2. В списке **Select a planner type** (Выбрать тип планировщика) выберите пункт **Quick Planner** (Средство быстрого планирования).

   ![Приступая к работе](./media/site-recovery-capacity-planner/getting-started.png)
3. На листе **Планировщик ресурсов** введите необходимую информацию. Необходимо заполнить все поля, помеченные красными кружками на снимке экрана ниже.

   * В списке **Select your scenario** (Выберите сценарий) выберите пункт **Из Hyper-V в Azure** или **Из VMware или физического сервера в Azure**.
   * В поле **Average daily data change rate (%)** (Средняя частота ежедневного изменения данных (%)) введите сведения, собранные с помощью [средства планирования загрузки Hyper-V](site-recovery-capacity-planning-for-hyper-v-replication.md) или [устройства планирования загрузки vSphere](https://labs.vmware.com/flings/vsphere-replication-capacity-planning-appliance).  
   * **Сжатие** применяется только к сжатию при репликации виртуальных машин VMware или физических серверов в Azure. Расчетное сжатие составляет 30 % и более, но при необходимости значение параметра можно изменить. Для сжатия при репликации виртуальных машин Hyper-V в Azure можно использовать устройства сторонних производителей, например Riverbed.
   * В поле **Retention Inputs** (Хранение входных данных) укажите срок хранения реплик. При репликации VMware или физических серверов следует указать значение в днях. При репликации Hyper-V укажите время в часах.
   * В полях **Number of hours in which initial replication for the batch of virtual machines should complete** (Период (в часах), в течение которого должна быть выполнена начальная репликация для пакета виртуальных машин) и **Number of virtual machines per initial replication batch** (Число виртуальных машин на пакет начальной репликации) указываются параметры, используемые для вычисления требований к начальной репликации.  При развертывании службы Site Recovery необходимо выполнить отправку всего начального набора данных.

   ![Входные данные](./media/site-recovery-capacity-planner/inputs.png)
4. После указывания значений для исходной среды отобразятся такие выходные данные:

   * **Общая пропускная способность, необходимая для разностной репликации** (Мбит/с). Пропускная способность сети для разностной репликации рассчитывается с учетом средней частоты ежедневного изменения данных.
   * **Общая пропускная способность, необходимая для начальной репликации** (Мбит/с). Пропускная способность сети для начальной репликации рассчитывается с учетом указанных значений начальной репликации.
   * **Требуемый объем хранилища (в ГБ)** — требуемый общий объем службы хранилища Azure.
   * **Общее число операций ввода-вывода в стандартных учетных записях хранения** рассчитывается на основе единицы операций ввода-вывода размером 8 КБ на общее число стандартных учетных записей хранения.  Для средства быстрого планирования этот показатель вычисляется на основе сведений об общем количестве дисков исходных виртуальных машин и частоте ежедневных изменений данных. Для средства детального планирования этот показатель вычисляется на основе сведений об общем числе виртуальных машин, сопоставленных со стандартными виртуальными машинами Azure, и частоте изменений данных на этих виртуальных машинах.
   * **Число стандартных учетных записей хранения** представляет собой общее количество стандартных учетных записей хранения, необходимых для защиты виртуальных машин. Стандартная учетная запись хранения обеспечивает выполнение до 20 000 операций ввода-вывода в секунду на всех виртуальных машинах в стандартном хранилище и до 500 операций ввода-вывода в секунду на диск.
   * **Требуемое число дисков с большими двоичными объектами** — количество дисков, которые будут созданы в службе хранилища Azure.
   * **Число учетных записей хранилища класса Premium** представляет собой общее количество учетных записей хранилища класса Premium, необходимых для защиты виртуальных машин. Для исходной виртуальной машины с большим числом операций ввода-вывода в секунду (более 20 000) требуется учетная запись хранилища класса Premium. Учетная запись хранилища класса Premium обеспечивает выполнение до 80 000 операций ввода-вывода в секунду.
   * **Общее число операций ввода-вывода в хранилище класса Premium** рассчитывается на основе единицы операций ввода-вывода размером 256 КБ на общее число учетных записей хранилища класса Premium.  Для средства быстрого планирования этот показатель вычисляется на основе сведений об общем количестве дисков исходных виртуальных машин и частоте ежедневных изменений данных. Для средства детального планирования этот показатель вычисляется на основе сведений об общем числе виртуальных машин, сопоставленных с виртуальными машинами Azure класса Premium (серии DS и GS), и частоте изменений данных на этих виртуальных машинах.
   * **Number of configuration servers required** (Требуемое число серверов конфигурации) показывает, сколько серверов конфигурации необходимо для развертывания.
   * **Number of additional process servers required** (Требуемое число дополнительных серверов обработки) показывает, необходимы ли дополнительные серверы обработки кроме сервера, запущенного на сервере конфигурации по умолчанию.
   * **100 % дополнительного хранилища в исходной среде** показывает, требуется ли дополнительное хранилище в исходной среде.

   ![Выходные данные](./media/site-recovery-capacity-planner/output.png)

## <a name="run-the-detailed-planner"></a>Запуск средства детального планирования

1. Скачайте и откройте [планировщик ресурсов Azure Site Recovery](http://aka.ms/asr-capacity-planner-excel) . Для этого потребуется запустить макрос, поэтому при появлении запроса выберите включение редактирования и содержимого.
2. В списке **Select a planner type** (Выбрать тип планировщика) выберите пункт **Detailed Planner** (Средство детального планирования).

   ![Приступая к работе](./media/site-recovery-capacity-planner/getting-started-2.png)
3. На листе **Workload Qualification** (Оценка рабочей нагрузки) введите необходимую информацию. Необходимо заполнить все помеченные поля.

   * В поле **Процессорные ядра** укажите общее число ядер исходного сервера.
   * В поле **Memory allocation in MB** (Выделение памяти в МБ) укажите объем ОЗУ исходного сервера.
   * В поле **Number of NICs** (Число сетевых карт) укажите количество сетевых карт исходного сервера.
   * В поле **Total storage (in GB)** (Общий объем хранилища (в ГБ)) укажите общий размер хранилища виртуальной машины. Например, если на исходном сервере есть 3 диска, каждый по 500 ГБ, общий размер хранилища составляет 1500 ГБ.
   * В поле **Number of disks attached** (Число подключенных дисков) укажите общее число дисков исходного сервера.
   * В поле **Disk capacity utilization** (Уровень использования емкости диска) укажите среднее значение использования.
   * В поле **Daily change rate (%)** (Частота ежедневных изменений (%)) укажите частоту ежедневных изменений данных исходного сервера.
   * В поле **Mapping Azure size** (Сопоставление размера Azure) введите размер виртуальной машины Azure, которую необходимо сопоставить. Если вы не хотите делать это вручную, нажмите кнопку **Compute IaaS VMs** (Вычислить виртуальные машины IaaS). Если ввести значение вручную, а затем нажать кнопку Compute IaaS VMs (Вычислить виртуальные машины IaaS), введенный вручную параметр можно будет перезаписать, так как процесс вычисления определяет оптимальное соответствие для размера виртуальной машины Azure автоматически.

   ![Оценка рабочей нагрузки](./media/site-recovery-capacity-planner/workload-qualification.png)
4. При нажатии кнопки **Вычислить виртуальные машины IaaS** выполняются следующие операции.

   * Проверяет обязательные входные данные.
   * Рассчитывает количество операций ввода-вывода в секунду и предлагает оптимальную виртуальную машину Azure для каждой виртуальной машины, соответствующей требованиям к репликации в Azure. При невозможности определения соответствующего размера виртуальной машины Azure происходит ошибка. Например, если подключено 65 дисков, произойдет ошибка, так как в Azure можно использовать максимум 64 виртуальные машины.
   * Определение учетной записи хранения, которую можно использовать для виртуальной машины Azure.
   * Вычисление общего числа стандартных учетных записей и учетных записей хранилища класса Premium, необходимых для рабочей нагрузки. Прокрутите вниз, чтобы просмотреть тип хранилища Azure и учетную запись хранения, которые можно использовать для исходного сервера.
   * Заполнение и сортировка остальной части таблицы с учетом требуемого типа хранилища (стандартное или класса Premium), назначенного виртуальной машине, и количества подключенных дисков. Для всех виртуальных машин, отвечающих требованиям Azure, в столбце **Is VM qualified?** (Проверена ли виртуальная машина?) отображается значение **Да**. Если нельзя создать резервную копию виртуальной машины в Azure, появляется ошибка.

Столбцы AA–AE представляют собой выходные данные и содержат сведения о каждой виртуальной машине.

![Оценка рабочей нагрузки](./media/site-recovery-capacity-planner/workload-qualification-2.png)

### <a name="example"></a>Пример
Например, для шести виртуальных машин, значения которых приведены в таблице, средство вычисляет и назначает самую подходящую виртуальную машину Azure и определяет самые оптимальные требования к службе хранилища Azure.

![Оценка рабочей нагрузки](./media/site-recovery-capacity-planner/workload-qualification-3.png)

* В выходных данных к этому примеру обратите внимание на следующее:

  * Первый столбец — столбец проверки для виртуальных машин, дисков и обновлений.
  * Для пяти виртуальных машин требуется две стандартные учетные записи хранения и одна учетная запись хранилища класса Premium.
  * VM3 не соответствует требованиям к защите, так как к этой виртуальной машине подключены один или несколько дисков более 1 ТБ.
  * VM1 и VM2 могут использовать первую стандартную учетную запись хранения.
  * VM4 может использовать вторую стандартную учетную запись хранения.
  * Для VM5 и VM6 необходима учетная запись хранилища класса Premium и каждая из них может использовать одну учетную запись.

    > [!NOTE]
    > Количество операций ввода-вывода в секунду для хранилищ класса Standard и Premium рассчитывается не на уровне дисков, а на уровне виртуальных машин. Стандартная виртуальная машина может обрабатывать до 500 операций ввода-вывода на диск. Если число операций ввода-вывода на диск больше 500, необходимо хранилище класса Premium. При этом если операций ввода-вывода на диск больше 500, но общее число операций ввода-вывода для всех дисков виртуальной машины соответствует ограничениям для стандартной виртуальной машины Azure (размер виртуальной машины, число дисков, число адаптеров, процессор, память), то вместо серии DS или GS планировщик выберет стандартную виртуальную машину. Необходимо вручную обновить ячейку сопоставления размера Azure, указав соответствующую виртуальную машину серии DS или GS.


1. Указав все сведения, нажмите кнопку **Submit data to the planner tool** (Отправить данные в средство планирования), чтобы открыть **планировщик ресурсов**. Выделяются рабочие нагрузки, соответствующие или не соответствующие требованиям для защиты.

### <a name="submit-data-in-the-capacity-planner"></a>Отправьте данные в планировщик ресурсов
1. Открываемый лист **планировщика ресурсов** заполняется данными в зависимости от заданных вами параметров. В ячейке **Infra inputs source** (Исходная среда входных данных инфраструктуры) появится слово "Рабочая нагрузка", чтобы показать, что источником входных данных является лист **Workload Qualification** (Оценка рабочей нагрузки).
2. Чтобы внести изменения, измените данные на листе **Workload Qualification** (Оценка рабочей нагрузки) и нажмите кнопку **Submit data to the planner tool** (Отправить данные в средство планирования) еще раз.  

   ![Планировщик ресурсов](./media/site-recovery-capacity-planner/capacity-planner.png)



<!--HONumber=Jan17_HO5-->


