---
title: Перенос виртуальных машин Azure между регионами Azure с помощью Azure Site Recovery | Документация Майкрософт
description: Используйте службу Azure Site Recovery для переноса виртуальных машин IaaS Azure из одного региона Azure в другой.
services: site-recovery
author: rayne-wiselman
ms.service: site-recovery
ms.topic: tutorial
ms.date: 05/16/2018
ms.author: raynew
ms.custom: MVC
ms.openlocfilehash: 0460d595bc70ec09d492221485749ece32ec07df
ms.sourcegitcommit: eb75f177fc59d90b1b667afcfe64ac51936e2638
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/16/2018
ms.locfileid: "34209714"
---
# <a name="migrate-azure-vms-to-another-region"></a>Перенос виртуальных машин Azure в другой регион

Службу [Azure Site Recovery](site-recovery-overview.md) можно использовать не только для управления и координации аварийного восстановления локальных компьютеров и виртуальных машин Azure в целях обеспечения непрерывности бизнеса и аварийного восстановления (BCDR), но и для управления миграцией виртуальных машин Azure в дополнительный регион. Чтобы перенести виртуальные машины Azure, следует включить для них репликацию и отработать их отказ из основного региона в требуемый дополнительный.

В этом руководстве показано, как выполнить перенос виртуальных машин Azure в другой регион. Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * Создание хранилища служб восстановления
> * Включение репликации для виртуальных машин.
> * Выполнение отработки отказа для переноса виртуальной машины

В этом руководстве предполагается, что у вас уже есть подписка Azure. Если ее еще нет, создайте [бесплатную учетную запись](https://azure.microsoft.com/pricing/free-trial/), прежде чем начинать работу.

>[!NOTE]
>
> Репликация Site Recovery для виртуальных машин Azure сейчас доступна в режиме предварительной версии.



## <a name="prerequisites"></a>предварительным требованиям

- Убедитесь, что в регионе Azure, из которого необходимо выполнить миграцию, есть виртуальные машины Azure.
- Вам должны быть понятны [архитектура и компоненты сценария](azure-to-azure-architecture.md).
- Просмотрите [ограничения и требования для поддержки](azure-to-azure-support-matrix.md).



## <a name="before-you-start"></a>Перед началом работы

Перед настройкой репликации выполните описанные ниже действия.


### <a name="verify-target-resources"></a>Проверка целевых ресурсов

1. Убедитесь, что подписка Azure позволяет создавать виртуальные машины в целевом регионе, используемом для аварийного восстановления. Свяжитесь со службой поддержки, чтобы включить необходимые квоты.

2. Убедитесь, что подписка располагает достаточными ресурсами для поддержки виртуальных машин таких же размеров, которые установлены для исходных виртуальных машин. Служба Site Recovery выбирает для целевой виртуальной машины такой же размер или похожий.


### <a name="verify-account-permissions"></a>Проверка разрешений учетной записи

Если вы создали бесплатную учетную запись Azure, тогда вы являетесь администратором подписки. Если вы не администратор подписки, свяжитесь с администратором, чтобы получить необходимые разрешения. Чтобы включить репликацию для новой виртуальной машины, необходимо иметь следующие разрешения.

1. Разрешения на создание виртуальной машины в ресурсах Azure. Встроенная роль "Участник виртуальных машин" обладает такими разрешениями:
    - разрешение на создание виртуальной машины в выбранной группе ресурсов;
    - разрешение на создание виртуальной машины в выбранной виртуальной сети;
    - разрешение на запись в выбранной учетной записи хранения.

2. Кроме того, требуется разрешение на управление операциями Azure Site Recovery. Роль "Участник Site Recovery" имеет все разрешения, необходимые для управления операциями Azure Site Recovery в хранилище служб восстановления.


### <a name="verify-vm-outbound-access"></a>Проверка исходящего доступа виртуальной машины

1. Убедитесь, что для переносимых виртуальных машин не используется прокси-сервер аутентификации для управления подключением к сети. 
2. В этом руководстве мы предполагаем, что виртуальные машины, которые требуется перенести, имеют доступ к Интернету и не используют прокси-сервер брандмауэра для контроля исходящего доступа. Если он используется, проверьте требования [здесь](azure-to-azure-tutorial-enable-replication.md#configure-outbound-network-connectivity).

### <a name="verify-vm-certificates"></a>Проверка сертификатов виртуальных машин

Убедитесь, что на виртуальных машинах Azure, которые следует перенести, установлены все новейшие корневые сертификаты. Если новейших корневых сертификатов нет, виртуальную машину нельзя зарегистрировать в Site Recovery из-за ограничений безопасности.

- При использовании виртуальных машин Windows установите на виртуальной машине все последние обновления Windows, чтобы гарантировать присутствие всех доверенных корневых сертификатов. При работе в отключенной среде следуйте стандартным процедурам обновления Windows и сертификатам в вашей организации.
- На виртуальных машинах Linux выполните инструкции распространителя Linux, чтобы установить на виртуальные машины все свежие доверенные корневые сертификаты и список отзыва сертификатов.



## <a name="create-a-vault"></a>Создание хранилища

Создайте хранилище в любом регионе, за исключением исходного.

1. Войдите на [портал Azure](https://portal.azure.com) > **Службы восстановления**.
2. Последовательно выберите **Создать ресурс** > **Мониторинг и управление** > **Backup and Site Recovery**.
3. В поле **Имя** укажите понятное имя **ContosoVMVault**. Если у вас есть несколько подписок, выберите нужную.
4. Создайте группу ресурсов **ContosoRG**.
5. Укажите регион Azure. Сведения о поддерживаемых регионах см. в разделе "Географическая доступность" на странице [цен на службу Azure Site Recovery](https://azure.microsoft.com/pricing/details/site-recovery/).
6. Для быстрого доступа к хранилищу из панели мониторинга щелкните **Закрепить на панели мониторинга**, а затем — **Создать**.

   ![Новое хранилище](./media/tutorial-migrate-azure-to-azure/azure-to-azure-vault.png)

Новое хранилище появится в колонке **Панель мониторинга** в разделе **Все ресурсы** и на основной странице **Хранилища служб восстановления**.






## <a name="select-the-source"></a>Выбор источника

1. В хранилище служб восстановления щелкните **ConsotoVMVault** > **+Реплицировать**.
2. В поле **Источник** выберите **Azure**.
3. В поле **Исходное расположение** выберите исходный регион Azure, в котором сейчас запущены виртуальные машины.
4. Выберите модель развертывания Resource Manager. Затем выберите настройку **Исходная группа ресурсов**.
5. Нажмите кнопку **ОК**, чтобы сохранить настройки.


## <a name="enable-replication-for-azure-vms"></a>Включение репликации для виртуальных машин Azure

Site Recovery получает список виртуальных машин, связанных с подпиской и группой ресурсов.


1. На портале Azure выберите **Виртуальные машины**.
2. Выберите виртуальную машину, которую требуется перенести. Нажмите кнопку **ОК**.
3. В разделе **Параметры** щелкните **Аварийное восстановление**.
4. В разделе **Настройка аварийного восстановления** > **Целевой регион** выберите целевой регион, в который будет выполняться репликация.
5. Для работы с этим руководством примите остальные значения по умолчанию.
6. Щелкните **Включить репликацию**. Будет запущено задание для включения репликации виртуальной машины.

    ![включение репликации](media/tutorial-migrate-azure-to-azure/settings.png)

 

## <a name="run-a-failover"></a>Запуск отработки отказа

1. В разделе **Параметры** > **Реплицированные элементы** выберите компьютер и щелкните **Отработка отказа**.
2. В области **Отработка отказа**выберите **Последнее**. Параметр ключа шифрования не учитывается в этом сценарии.
3. Выберите **Завершение работы виртуальной машины перед началом отработки отказа**. Site Recovery попытается выключить исходную виртуальную машину перед запуском отработки отказа. Отработка отказа продолжится, даже если их не удастся отключить. На странице **Задания** можно следить за ходом выполнения отработки отказа.
4. Убедитесь, что виртуальная машина Azure отображается в Azure должным образом.
5. В разделе **Реплицированные элементы** нажмите правой кнопкой мыши пункт "Виртуальная машина" и выберите **Зафиксировать**. Процесс миграции завершен.
6. По окончании фиксации щелкните **Disable Replication** (Отключить репликацию).  При этом для виртуальной машины прекращается выполнение репликации.



## <a name="next-steps"></a>Дополнительная информация

В этом руководстве вы перенесли виртуальную машину Azure в другой регион Azure. Теперь можно настроить аварийное восстановление для перенесенной виртуальной машины.

> [!div class="nextstepaction"]
> [Настройка аварийного восстановления после миграции](azure-to-azure-quickstart.md)

