---
title: Устранение неполадок с репликацией виртуальной машины VMware и физического сервера в Azure с помощью Azure Site Recovery | Документация Майкрософт
description: В этой статье описано, как устранять распространенные неполадки с репликацией физических серверов и виртуальных машин VMware в Azure с помощью Azure Site Recovery.
services: site-recovery
author: asgang
manager: rochakm
ms.service: site-recovery
ms.topic: article
ms.date: 03/05/2018
ms.author: asgang
ms.openlocfilehash: 9291840428c9a8d7ba5d65bc94ce5964728316f3
ms.sourcegitcommit: 168426c3545eae6287febecc8804b1035171c048
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2018
---
# <a name="troubleshoot-replication-issues-for-vmware-vms-and-physical-servers"></a>Устранение неполадок с репликацией виртуальных машин VMware и физических серверов

Применяя защиту виртуальных машин VMware или физических серверов с помощью Azure Site Recovery, вы можете получить определенные сообщения об ошибках. В этой статье описаны распространенные неполадки, которые могут возникнуть при репликации физических серверов и виртуальных машин VMware в Azure с помощью [Azure Site Recovery](site-recovery-overview.md).

## <a name="initial-replication-issues"></a>Проблемы с начальной репликацией.

В большинстве случаев, проблемы с начальной репликацией, с которой сталкивается служба поддержки, вызваны ошибками подключения между исходным сервером и сервером обработки или сервером обработки и Azure. В большинстве случаев вы можете устранить эти проблемы, выполнив приведенные ниже действия.

### <a name="verify-the-source-machine"></a>Проверка исходного компьютера
* В командной строке компьютера исходного сервера используйте Telnet, чтобы проверить связь сервера обработки с HTTPS-портом (по умолчанию 9443), как показано ниже, чтобы узнать, существуют ли проблемы с сетевым подключением или с блокировкой порта брандмауэра.

    `telnet <PS IP address> <port>`
> [!NOTE]
    > Используйте Telnet, а не команду PING для проверки соединения.  Если Telnet не установлен, выполните шаги, указанные [здесь](https://technet.microsoft.com/library/cc771275(v=WS.10).aspx).

Если не удается подключиться, разрешите входящий порт 9443 на сервере обработки и проверьте, не исчезла ли проблема. В некоторых случаях, когда сервер обработки находился за промежуточной подсетью, именно это вызывало такую проблему.

* Проверьте состояние службы `InMage Scout VX Agent – Sentinel/OutpostStart`, если она не выполняется, и проверьте, не исчезла ли проблема.   

## <a name="verify-the-process-server"></a>Проверка сервера обработки

* **Проверьте, отправляет ли принудительно сервер обработки данные в Azure.**

Откройте диспетчер задач на компьютере сервера обработки (нажмите клавиши CTRL+SHIFT+ESC). Перейдите на вкладку "Производительность" и щелкните ссылку "Открыть монитор ресурсов". Из диспетчера ресурсов перейдите на вкладку "Сеть". Проверьте, отправляет ли файл cbengine.exe на вкладке "Процессы с сетевой активностью" большие объемы данных (в МБ).

![Включение репликации](./media/vmware-azure-troubleshoot-replication/cbengine.png)

Если нет, сделайте следующее.

* **Проверьте, может ли сервер обработки подключится к большому двоичному объекту Azure.** Щелкните cbengine.exe, проверьте его и просмотрите область "Подключения TCP", чтобы определить, есть ли подключение с сервера обработки к URL-адресу большого двоичного объекта хранилища Azure.

![Включение репликации](./media/vmware-azure-troubleshoot-replication/rmonitor.png)

Если нет, тогда выберите "Панель управления > Службы" и проверьте, работают ли следующие службы:

     * cxprocessserver
     * InMage Scout VX Agent – Sentinel/Outpost
     * Microsoft Azure Recovery Services Agent
     * Microsoft Azure Site Recovery Service
     * tmansvc
     *
Запустите все службы, которые не выполняются, и проверьте, не исчезла ли проблема.

* **Проверьте возможность подключения сервера обработки по общедоступному IP-адресу Azure с помощью порта 443**

Откройте последний журнал CBEngineCurr.errlog в расположении `%programfiles%\Microsoft Azure Recovery Services Agent\Temp` и найдите строки: "443" и "connection attempt failed".

![Включение репликации](./media/vmware-azure-troubleshoot-replication/logdetails1.png)

Если возникли проблемы, тогда из командной строки сервера обработки используйте Telnet, чтобы проверить связь своего общедоступного IP-адреса Azure (замаскирован на изображении выше), найденного в CBEngineCurr.currLog, с помощью порта 443.

      telnet <your Azure Public IP address as seen in CBEngineCurr.errlog>  443
Если вы не можете подключиться, тогда проверьте, произошли ли проблемы доступа из-за брандмауэра или прокси-сервера, как описано в следующем шаге.


* **Проверьте, не блокирует ли доступ брандмауэр на основе IP-адресов на сервере обработки.** При использовании правил брандмауэра на основе IP-адресов на сервере скачайте список диапазонов IP-адресов центра обработки данных Microsoft Azure [здесь](https://www.microsoft.com/download/details.aspx?id=41653) и добавьте их в свою конфигурацию брандмауэра, чтобы убедиться, что они разрешают подключение к Azure (и HTTPS-порт 443).  Необходимо разрешить доступ для диапазонов IP-адресов региона Azure, в котором располагается ваша подписка, и региона "Западная часть США" (используется для контроля доступа и управления удостоверениями).

* **Проверьте, блокирует ли доступ брандмауэр на основе URL-адресов на сервере обработки.** При использовании брандмауэра на основе URL-адресов на сервере убедитесь, что в конфигурацию брандмауэра добавлены следующие URL-адреса.

  `*.accesscontrol.windows.net:`: используется для контроля доступа и управления удостоверениями;

  `*.backup.windowsazure.com:`: используется для передачи данных репликации и оркестрации;

  `*.blob.core.windows.net:`: используется для доступа к учетной записи хранения, в которой хранятся реплицируемые данные;

  `*.hypervrecoverymanager.windowsazure.com:`: используется для операций управления репликацией и оркестрации;

  `time.nist.gov` и `time.windows.com`: используются для проверки синхронизации времени системы с глобальным временем.

URL-адреса для **облака Azure для государственных организаций**:

`* .ugv.hypervrecoverymanager.windowsazure.us`

`* .ugv.backup.windowsazure.us`

`* .ugi.hypervrecoverymanager.windowsazure.us`

`* .ugi.backup.windowsazure.us`

* **Проверьте, не блокируют ли доступ параметры прокси-сервера на сервере обработки.**  При использовании прокси-сервера убедитесь, что его имя преобразуется DNS-сервером.
Чтобы проверить параметры, указанные во время настройки сервера конфигурации, перейдите в раздел реестра

    `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Azure Site Recovery\ProxySettings`

Теперь убедитесь, что те же параметры используются агентом Azure Site Recovery для отправки данных.
Поиск Microsoft Azure Backup

Откройте службу и щелкните "Действие > Изменить свойства". На вкладке настройки прокси-сервера вы увидите адрес прокси-сервера, который должен соответствовать указанному в параметрах реестра. Если нет, измените его на тот же адрес.


* **Проверьте, не ограничено ли регулирование пропускной способности на сервере обработки**. Увеличьте пропускную способность и проверьте, не исчезла ли проблема.

## <a name="next-steps"></a>Дополнительная информация
Если вам нужна дополнительная помощь, отправьте свой запрос на [форум Azure Site Recovery](https://social.msdn.microsoft.com/Forums/azure/home?forum=hypervrecovmgr). У нас есть активное сообщество и один из наших инженеров сможет помочь вам.
