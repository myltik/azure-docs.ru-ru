---
title: "Планировщик развертывания Azure Site Recovery для развертывания виртуальных машин Hyper-V в Azure | Документация Майкрософт"
description: "В этой статье описан режим запуска для Планировщика развертывания Azure Site Recovery при перемещении виртуальных машин Hyper-V в Azure."
services: site-recovery
author: nsoneji
manager: garavd
ms.service: site-recovery
ms.topic: article
ms.date: 02/14/2018
ms.author: nisoneji
ms.openlocfilehash: ae539f136578c6461ef7f680d553fbd76b10ae98
ms.sourcegitcommit: d1f35f71e6b1cbeee79b06bfc3a7d0914ac57275
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/22/2018
---
# <a name="run-azure-site-recovery-deployment-planner-for-hyper-v-to-azure"></a>Запуск планировщика развертывания Azure Site Recovery при развертывании виртуальных машин Hyper-V в Azure

## <a name="modes-of-running-the-deployment-planner"></a>Режимы запуска для планировщика развертывания
Программу командной строки (ASRDeploymentPlanner.exe) можно запустить в любом из следующих четырех режимов: 
-   [Получение списка виртуальных машин](#get-vm-list-for-profiling-hyper-v-vms).
-   [Профиль](#profile-hyper-v-vms)
-   [Создание отчета](#generate-report).
-   [Получение данных пропускной способности](#get-throughput).

Сначала запустите планировщик, чтобы получить список виртуальных машин из одного или нескольких узлов Hyper-V. Затем запустите программу в режиме профилирования, чтобы получить сведения об активности обработки данных и числе операций ввода-вывода в секунду на виртуальной машине. Затем запустите его в режиме создания отчетов, чтобы оценить требования к пропускной способности сети и хранилищу.

## <a name="get-the-vm-list-for-profiling-hyper-v-vms"></a>Получение списка виртуальных машин Hyper-V для профилирования
Сначала вы должны создать список виртуальных машин, профилирование которых нужно выполнить. Используйте режим планировщика развертывания GetVMList, чтобы создать список виртуальных машин, которые содержатся в нескольких узлах Hyper-V, при помощи одной команды. Получив полный список, вы можете удалить из выходного файла виртуальные машины, которые не нужно профилировать. Затем используйте выходной файл для всех остальных операций: профилирования, создания отчетов и получения данных пропускной способности.

Вы можете создать список виртуальных машин для кластера или автономного узла Hyper-V, либо же для них обоих.

### <a name="command-line-parameters"></a>Параметры командной строки
В следующей таблице приведен список обязательных и необязательных параметров для запуска планировщика в режиме GetVMList. 
```
ASRDeploymentPlanner.exe -Operation GetVMList /?
```
| Имя параметра | ОПИСАНИЕ |
|---|---|
| -Operation | GetVMList |
| -User | Имя пользователя для подключения к узлу или кластеру Hyper-V. Пользователь должен иметь права администратора.|
|-ServerListFile | Файл со списком серверов, которые содержат виртуальные машины для профилирования. Путь к файлу может быть абсолютным или относительным. В каждой строке этого файла нужно указать один из следующих вариантов данных:<ul><li>имя или IP-адрес узла Hyper-V;</li><li>имя или IP-адрес кластера Hyper-V.</li></ul><br>**Пример.** Файл ServerList.txt содержит следующие серверы:<ul><li>Host_1;</li><li>10.8.59.27;</li><li>Cluster_1;</li><li>Host_2.</li>|
| -Directory|(Необязательно.) UNC-путь или путь к локальному каталогу для хранения данных, созданных при выполнении операции. Если имя не указано, в качестве каталога по умолчанию используется каталог ProfiledData, расположенный по текущему пути.|
|-OutputFile| (Необязательно.) Файл со списком виртуальных машин, полученный с серверов Hyper-V. Если имя не указано, сведения сохраняются в VMList.txt.  Используйте этот файл, чтобы запустить профилирование, как только будут удалены виртуальные машины, которые не нужно профилировать.|
|-Password|(Необязательно.) Пароль для подключения к узлу Hyper-V. Если не указать его в качестве параметра, запрос на ввод пароля отобразится после выполнения команды.|

### <a name="getvmlist-discovery"></a>Обнаружение GetVMList
**Кластер Hyper-V.** Если в файле со списком серверов указано имя кластера Hyper-V, программа находит все узлы кластера Hyper-V и получает список виртуальных машин на этих узлах.

**Узел Hyper-V.** Если указано имя узла Hyper-V, сначала программа проверяет, входит ли он в кластер. Если это так, извлекается список узлов в кластере. Затем для каждого узла Hyper-V извлекается список виртуальных машин. 

Кроме того, вы можете вручную выбрать нужные имена или IP-адреса виртуальных машин, для которых следует выполнить профилирование.

Откройте выходной файл в Блокноте. Скопируйте имена виртуальных машин, профилирование которых необходимо выполнить, в другой файл (например, в файл ProfileVMList.txt) по одному на строку. Этот файл используется как входные данные для параметра программы -VMListFile для всех других операций: профилирования, создания отчетов и получения данных пропускной способности.

### <a name="examples"></a>Примеры

#### <a name="store-the-list-of-vms-in-a-file"></a>Сохранение списка виртуальных машин в файле
```
ASRDeploymentPlanner.exe -Operation GetVMlist -ServerListFile “E:\Hyper-V_ProfiledData\ServerList.txt" -User Hyper-VUser1 -OutputFile "E:\Hyper-V_ProfiledData\VMListFile.txt"
```

#### <a name="store-the-list-of-vms-at-the-default-location--directory-path"></a>Сохранение списка виртуальных машин в расположении по умолчанию (по пути, указанному для -Directory)
```
ASRDeploymentPlanner.exe -Operation GetVMList -Directory "E:\Hyper-V_ProfiledData" -ServerListFile "E:\Hyper-V_ProfiledData\ServerList.txt" -User Hyper-VUser1
```

## <a name="profile-hyper-v-vms"></a>Профилирование виртуальных машин Hyper-V
В режиме профилирования планировщик развертывания подключается к каждому узлу Hyper-V, чтобы собрать данные о производительности виртуальной машины. 

Профилирование не влияет на производительность рабочих процессов виртуальных машин, так как программа напрямую не подключается к виртуальной машине. Все сведения о производительности собираются с узла Hyper-V.

Чтобы обеспечить точность профилирования, в программе каждые 15 секунд подается запрос на узел Hyper-V. Показатели счетчика производительности сохраняются каждую минуту.

Программа легко обрабатывает перенос виртуальных машин между узлами в кластере и перенос хранилища в пределах узла.

### <a name="getting-the-vm-list-to-profile"></a>Получение списка виртуальных машин для профилирования
Создайте список виртуальных машин для профилирования при помощи операции [GetVMList](#get-vm-list-for-profiling-hyper-v-vms).

После создания списка виртуальных машин можно запустить программу в режиме профилирования. 

### <a name="command-line-parameters"></a>Параметры командной строки
Приведенная ниже таблица содержит список обязательных и необязательных параметров для запуска планировщика в режиме профилирования. Средство, как правило, используется для сценариев перемещения из VMware и Hyper-V в Azure. Эти параметры далее относятся к Hyper-V. 
```
ASRDeploymentPlanner.exe -Operation StartProfiling /?
```
| Имя параметра | ОПИСАНИЕ |
|---|---|
| -Operation | StartProfiling |
| -User | Имя пользователя для подключения к узлу или кластеру Hyper-V. Пользователь должен иметь права администратора.|
| -VMListFile | Файл со списком виртуальных машин для профилирования. Путь к файлу может быть абсолютным или относительным. Для Hyper-V это выходной файл операции GetVMList. При подготовке вручную файл должен содержать одно имя или IP-адрес сервера и имя виртуальной машины, разделенные символом "\" в каждой строке. Имя виртуальной машины, указанное в файле, должно совпадать с именем виртуальной машины в узле Hyper-V.<br><br>**Пример.** Файл VMList.txt содержит следующие виртуальные машины:<ul><li>Host_1\VM_A;</li><li>10.8.59.27\VM_B;</li><li>Host_2\VM_C.</li><ul>|
|-NoOfMinutesToProfile|Число минут, в течение которых будет выполняться профилирование. Минимальное значение — 30 минут.|
|-NoOfHoursToProfile|Число часов, в течение которых будет выполняться профилирование.|
|-NoOfDaysToProfile |Число дней, в течение которых будет выполняться профилирование. Мы рекомендуем выполнять профилирование более 7 дней. Это позволит качественнее определить шаблон рабочей нагрузки и предоставить более точные рекомендации.|
|-Virtualization|Тип виртуализации (VMware или Hyper-V).|
|-Directory|(Необязательно.) UNC-путь или путь к локальному каталогу для хранения данных профилирования. Если имя не указано, в качестве каталога по умолчанию используется каталог ProfiledData, расположенный по текущему пути.|
|-Password|(Необязательно.) Пароль для подключения к узлу Hyper-V. Если не указать его в качестве параметра, запрос на ввод пароля отобразится после выполнения команды.|
|-StorageAccountName|(Необязательно.) Имя учетной записи хранения, используемой для определения объема пропускной способности, доступной для репликации данных из локальной среды в Azure. Программа отправляет тестовые данные в эту учетную запись хранения, чтобы рассчитать пропускную способность. Учетная запись хранения должна быть общего назначения версии 1 или 2.|
|-StorageAccountKey|(Необязательно.) Ключ, используемый для доступа к учетной записи хранения. Перейдите на портал Azure и выберите **Учетные записи хранения** > *имя_учетной_записи_хранения* > **Параметры** > **Ключи доступа** > **Key1** (или первичный ключ доступа для классической учетной записи хранения).|
|-Environment|(Необязательно.) Целевая среда для учетной записи хранения Azure. Она может иметь одно из трех значений: AzureCloud, AzureUSGovernment или AzureChinaCloud. Значение по умолчанию — AzureCloud. Используйте этот параметр, если ваш целевой регион — Azure для государственных организаций США или Azure для Китая.|

Рекомендуем выполнять профилирование виртуальных машин более 7 дней. Если в течение месяца шаблон обработки изменяется, рекомендуем выполнять профилирование в течение недели, когда будет зафиксирован максимальный показатель. Чтобы получить точные данные, рекомендуем профилировать машины в течение 31 дня. 

В течение этого периода программа ASRDeploymentPlanner.exe продолжает работать. Время профилирования необходимо указать в днях. Чтобы быстро протестировать программу или подтвердить концепцию, можно выполнять профилирование в течение нескольких часов или минут. Минимальное разрешенное время профилирования составляет 30 минут. 

В процессе профилирования при необходимости можно передать имя и ключ учетной записи хранения, чтобы определить пропускную способность, которой может достигнуть Azure Site Recovery во время репликации данных с сервера Hyper-V в Azure. Если их не передать, планировщик не будет рассчитывать достигаемую пропускную способность.

Вы можете запустить несколько экземпляров этой программы для наборов виртуальных машин. Убедитесь, что в этих наборах профилирования имена виртуальных машин не повторяются. Например, вы выполнили профилирование 10 виртуальных машин (VM1–VM10) и спустя несколько дней хотите повторить этот процесс для еще пяти (VM11–VM15). Для профилирования второго набора виртуальных машин (VM11–VM15) эту программу можно запустить в другой консоли командной строки. 

Проверьте, не входят ли во второй набор виртуальные машины из первого экземпляра профилирования или не используется ли для второго запуска другой выходной каталог. Если два экземпляра планировщика выполняют профилирование тех же самых виртуальных машин и используется тот же выходной каталог, созданный отчет будет неправильным. 

По умолчанию средство настроено для профилирования и создания отчетов максимум для 1000 виртуальных машин. Это ограничение можно изменить, переопределив значение ключа MaxVMsSupported в файле ASRDeploymentPlanner.exe.config.
```
<!-- Maximum number of VMs supported-->
<add key="MaxVmsSupported" value="1000"/>
```
Используя параметры по умолчанию, для профилирования, например, 1500 виртуальных машин создайте два файла VMList.txt. В одном из них будет 1000 виртуальных машин, а в другом — 500. Запустите два экземпляра Планировщика развертывания Azure Site Recovery: один со списком VMList1.txt и второй со списком VMList2.txt. Профилируемые данные обеих виртуальных машин VMList можно хранить в одной папке. 

В зависимости от конфигурации оборудования (особенно в зависимости от размера ОЗУ сервера, на котором запускается средство для создания отчетов) операция может завершиться ошибкой из-за нехватки памяти. При наличии хорошего оборудования можно увеличить значение параметра MaxVMsSupported.  

Конфигурации виртуальных машин записываются один раз при запуске профилирования и сохраняются в файле VMDetailList.xml. Эти сведения используются во время создания отчета. Изменения в конфигурации виртуальной машины (например, увеличение числа ядер, дисков, сетевых карт и т. д.), внесенные после запуска профилирования до завершения этого процесса, не записываются. Если конфигурация виртуальной машины изменилась во время профилирования, воспользуйтесь рекомендациями по получению последних сведений о виртуальной машине, используемых при создании отчета:

* Создайте резервную копию файла VMdetailList.xml и удалите его из текущего расположения.
* Передайте аргументы -User и -Password во время создания отчета.

Команда профилирования создает в каталоге профилирования несколько файлов. Не удаляйте их, так как это повлияет на создание отчетов.

### <a name="examples"></a>Примеры

#### <a name="profile-vms-for-30-days-and-find-the-throughput-from-on-premises-to-azure"></a>Профилирование виртуальных машин, выполняемое в течение 30 дней, и определение пропускной способности, достигаемой при репликации данных из локальной среды в Azure
```
ASRDeploymentPlanner.exe -Operation StartProfiling -virtualization Hyper-V -Directory “E:\Hyper-V_ProfiledData” -VMListFile “E:\Hyper-V_ProfiledData\ProfileVMList1.txt”  -NoOfDaysToProfile 30 -User Contoso\HyperVUser1 -StorageAccountName  asrspfarm1 -StorageAccountKey Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==
```

#### <a name="profile-vms-for-15-days"></a>Профилирование виртуальных машин в течение 15 дней
```
ASRDeploymentPlanner.exe -Operation StartProfiling -Virtualization Hyper-V -Directory “E:\Hyper-V_ProfiledData” -VMListFile “E:\vCenter1_ProfiledData\ProfileVMList1.txt”  -NoOfDaysToProfile  15  -User contoso\HypreVUser1
```

#### <a name="profile-vms-for-60-minutes-for-a-quick-test-of-the-tool"></a>Профилирование виртуальных машин в течение 60 минут для быстрой проверки программы
```
ASRDeploymentPlanner.exe -Operation StartProfiling -Virtualization Hyper-V -Directory “E:\Hyper-V_ProfiledData” -VMListFile “E:\Hyper-V_ProfiledData\ProfileVMList1.txt”  -NoOfMinutesToProfile 60 -User Contoso\HyperVUser1
```

#### <a name="profile-vms-for-2-hours-for-a-proof-of-concept"></a>Профилирование виртуальных машин в течение двух часов для подтверждения концепции
```
ASRDeploymentPlanner.exe -Operation StartProfiling -Virtualization Hyper-V -Directory “E:\Hyper-V_ProfiledData” -VMListFile “E:\Hyper-V_ProfiledData\ProfileVMList1.txt”  -NoOfHoursToProfile 2 -User Contoso\HyperVUser1
```

### <a name="considerations-for-profiling"></a>Рекомендации для профилирования

Если сервер, на котором выполняется программа, перезагрузился или на нем произошел сбой, а также если вы вышли из нее, нажав клавиши CTRL+C, данные профилирования сохраняются. Однако вы можете потерять данные за последние 15 минут. В этом случае после перезагрузки сервера повторно запустите планировщик в режиме профилирования.

Получив имя и ключ учетной записи хранения, программа измеряет пропускную способность на последнем этапе профилирования. Если она прерывает работу до завершения профилирования, пропускная способность не измеряется. Чтобы определить пропускную способность перед созданием отчета, вы можете выполнить операцию GetThroughput в консоли командной строки. Иначе сведения о достигаемой пропускной способности не будут включены в отчет.

Azure Site Recovery не поддерживает виртуальные машины с дисками iSCSI и сквозными дисками. В программе не выполняется обнаружение и профилирование дисков iSCSI и сквозных дисков, подключенных к виртуальным машинам.

## <a name="generate-a-report"></a>Создание отчета
Планировщик создает отчет в формате XLSM (файл Microsoft Excel с поддержкой макросов). В нем содержатся все рекомендации по развертыванию. Этот отчет называется DeploymentPlannerReport_*уникальный_числовой_идентификатор*.xlsm и помещается в указанный каталог.

После завершения профилирования планировщик можно запустить в режиме создания отчетов. 

### <a name="command-line-parameters"></a>Параметры командной строки
В таблице ниже приведен список обязательных и необязательных параметров для запуска программы в режиме создания отчетов. Средство, как правило, используется при перемещении из VMware и Hyper-V в Azure. Указанные далее параметры относятся к Hyper-V.
```
ASRDeploymentPlanner.exe -Operation GenerateReport /?
```
| Имя параметра | ОПИСАНИЕ |
|---|---|
| -Operation | Создание отчета. |
|-VMListFile | Файл со списком профилированных виртуальных машин, для которых будет создан отчет. Путь к файлу может быть абсолютным или относительным. Для Hyper-V это выходной файл операции GetVMList. При подготовке вручную файл должен содержать одно имя или IP-адрес сервера и имя виртуальной машины, разделенные символом "\" в каждой строке. Имя виртуальной машины, указанное в файле, должно совпадать с именем виртуальной машины в узле Hyper-V.<br><br>**Пример.** Файл VMList.txt содержит следующие виртуальные машины:<ul><li>Host_1\VM_A;</li><li>10.8.59.27\VM_B;</li><li>Host_2\VM_C.</li><ul>|
|-Virtualization|Тип виртуализации (VMware или Hyper-V).|
|-Directory|(Необязательно.) UNC-путь или путь к локальному каталогу, в котором хранятся данные профилирования (файлы, созданные в процессе профилирования). Эти данные используются для создания отчета. Если имя не указано, в качестве каталога по умолчанию используется каталог ProfiledData, расположенный по текущему пути.|
| -User | (Необязательно.) Имя пользователя для подключения к узлу или кластеру Hyper-V. Пользователь должен иметь права администратора. Данные пользователя и пароль используются для получения последних сведений о конфигурации виртуальных машин (например, о количестве дисков, ядер, сетевых карт и т. д.), используемых в отчете. Если не указать это значение, используются сведения о конфигурации, полученные во время профилирования.|
|-Password|(Необязательно.) Пароль для подключения к узлу Hyper-V. Если не указать его в качестве параметра, запрос на ввод пароля отобразится после выполнения команды.|
| -DesiredRPO | (Необязательно.) Требуемая целевая точка восстановления в минутах. Значение по умолчанию — 15 минут.|
| -Bandwidth | (Необязательно.) Пропускная способность в мегабитах в секунду. Этот параметр используется для вычисления значения целевой точки восстановления, которого можно достигнуть для указанной пропускной способности. |
| -StartDate | (Необязательно.) Дата и время начала в формате ММ-ДД-ГГГГ:ЧЧ:ММ (24-часовой цикл). Параметр StartDate необходимо указать с параметром EndDate. Если указать параметр StartDate, отчет будет создан на основе данных, собранных в период между датой начала и окончания. |
| -EndDate | (Необязательно.) Дата и время окончания в формате ММ-ДД-ГГГГ:ЧЧ:ММ (24-часовой цикл). Параметр EndDate необходимо указать с параметром StartDate. Если указать параметр EndDate, отчет будет создан на основе данных, собранных в период между датой начала и окончания. |
| -GrowthFactor | (Необязательно.) Коэффициент роста в процентах. Значение по умолчанию — 30 процентов. |
| -UseManagedDisks | (Необязательно.) UseManagedDisks — "Да" или "Нет". Значение по умолчанию — "Да". Число виртуальных машин, которые можно разместить в одной учетной записи хранения, вычисляется с учетом того, где выполняется отработка отказа или тестовая отработка отказа виртуальных машин — на управляемом или на неуправляемом диске. |
|-SubscriptionId |(Необязательно.) Идентификатор GUID подписки. Используйте этот параметр, чтобы создать отчет об оценке затрат с последними ценами на основе вашей подписки, предложения, связанного с подпиской, а также для целевого региона Azure в указанной валюте.|
|-TargetRegion|(Необязательно.) Целевой регион Azure для репликации. Используйте этот параметр, чтобы создать отчет для целевого региона Azure, так как цены в Azure устанавливаются отдельно для каждого региона. Значение по умолчанию — WestUS2 или последний указанный целевой регион. Ознакомьтесь со списком [поддерживаемых целевых регионов](hyper-v-deployment-planner-cost-estimation.md#supported-target-regions).|
|-OfferId|(Необязательно.) Предложение, связанное с подпиской. Значение по умолчанию — MS-AZR-0003P (оплата по мере использования).|
|-Currency|(Необязательно.) Валюта, в которой отображается стоимость в созданном отчете. Значение по умолчанию — доллар США ($) или последняя указанная валюта. Ознакомьтесь со списком [поддерживаемых валют](hyper-v-deployment-planner-cost-estimation.md#supported-currencies).|

По умолчанию средство настроено для профилирования и создания отчетов максимум для 1000 виртуальных машин. Это ограничение можно изменить, переопределив значение ключа MaxVMsSupported в файле ASRDeploymentPlanner.exe.config.
```
<!-- Maximum number of VMs supported-->
<add key="MaxVmsSupported" value="1000"/>
```

### <a name="examples"></a>Примеры
#### <a name="generate-a-report-with-default-values-when-the-profiled-data-is-on-the-local-drive"></a>Создание отчета со значениями по умолчанию, когда данные профилирования находятся на локальном диске
```
ASRDeploymentPlanner.exe -Operation GenerateReport -virtualization Hyper-V -Directory “E:\Hyper-V_ProfiledData” -VMListFile “E:\Hyper-V_ProfiledData\ProfileVMList1.txt”
```

#### <a name="generate-a-report-when-the-profiled-data-is-on-a-remote-server"></a>Создание отчета, когда данные профилирования находятся на удаленном сервере
У вас должен быть доступ на чтение и запись к удаленному каталогу.
```
ASRDeploymentPlanner.exe -Operation GenerateReport -Virtualization Hyper-V -Directory “\\PS1-W2K12R2\Hyper-V_ProfiledData” -VMListFile “\\PS1-W2K12R2\vCenter1_ProfiledData\ProfileVMList1.txt”
```

#### <a name="generate-a-report-with-a-specific-bandwidth-that-you-will-provision-for-the-replication"></a>Создание отчета с указанием пропускной способности для репликации
```
ASRDeploymentPlanner.exe -Operation GenerateReport -Virtualization Hyper-V -Directory “E:\Hyper-V_ProfiledData” -VMListFile “E:\Hyper-V_ProfiledData\ProfileVMList1.txt” -Bandwidth 100
```

#### <a name="generate-a-report-with-a-5-percent-growth-factor-instead-of-the-default-30-percent"></a>Создание отчета с коэффициентом роста 5 %, а не 30 % (значение по умолчанию) 
```
ASRDeploymentPlanner.exe -Operation GenerateReport -Virtualization Hyper-V -Directory “E:\Hyper-V_ProfiledData” -VMListFile “E:\Hyper-V_ProfiledData\ProfileVMList1.txt” -GrowthFactor 5
```

#### <a name="generate-a-report-with-a-subset-of-profiled-data"></a>Создание отчета с подмножеством данных профилирования
Например, у вас есть данные профилирования за 30 дней, но вы хотите создать отчет только за 20 дней.
```
ASRDeploymentPlanner.exe -Operation GenerateReport -virtualization Hyper-V -Directory “E:\Hyper-V_ProfiledData” -VMListFile “E:\Hyper-V_ProfiledData\ProfileVMList1.txt” -StartDate  01-10-2017:12:30 -EndDate 01-19-2017:12:30
```

#### <a name="generate-a-report-for-a-5-minute-rpo"></a>Создание отчета для 5-минутной целевой точки восстановления
```
ASRDeploymentPlanner.exe -Operation GenerateReport -Virtualization Hyper-V -Directory “E:\Hyper-V_ProfiledData” -VMListFile “E:\Hyper-V_ProfiledData\ProfileVMList1.txt”  -DesiredRPO 5
```

#### <a name="generate-a-report-for-the-south-india-azure-region-with-indian-rupee-and-a-specific-offer-id"></a>Создание отчета для региона Azure "Южная Индия" со значением валюты "индийская рупия" и указанием идентификатора предложения
```
ASRDeploymentPlanner.exe -Operation GenerateReport -Virtualization Hyper-V -Directory “E:\Hyper-V_ProfiledData” -VMListFile “E:\Hyper-V_ProfiledData\ProfileVMList1.txt”  -SubscriptionID 4d19f16b-3e00-4b89-a2ba-8645edf42fe5 -OfferID MS-AZR-0148P -TargetRegion southindia -Currency INR
```


### <a name="percentile-value-used-for-the-calculation"></a>Значение процентиля, используемое для вычисления
При создании отчета в программе по умолчанию используется 95-й процентиль для операций чтения и записи, операций записи и активности обработки данных. Эти значения собираются во время профилирования всех виртуальных машин. Это гарантирует, что для определения требований к пропускной способности учетной записи хранения и целевой службы не будут использоваться пиковые значения 100-го процентиля, которые могут возникать на виртуальной машине из-за временных событий. Например, из-за выполнения задания архивации раз в день, периодического индексирования базы данных, создания аналитического отчета или какого-либо другого кратковременного события, происходящего в определенный момент времени.

При использовании значений 95-го процентиля вы получите точные сведения об особенностях рабочей нагрузки, что, в свою очередь, позволяет обеспечить наилучшую производительность при выполнении этих рабочих нагрузок в Azure. Мы не рекомендуем изменять это значение, но если вы решили сделать это, например изменить его на 90-й процентиль, обновите файл конфигурации ASRDeploymentPlanner.exe.config, который находится в каталоге по умолчанию. Затем сохраните этот файл, чтобы создать отчет на основе имеющихся данных профилирования.
```
<add key="WriteIOPSPercentile" value="95" />      
<add key="ReadWriteIOPSPercentile" value="95" />      
<add key="DataChurnPercentile" value="95" />
```

### <a name="considerations-for-growth-factor"></a>Рекомендации по коэффициенту роста
Крайне важно учитывать расширение характеристик рабочей нагрузки при увеличении шаблона использования с течением времени. После установки защиты виртуальной машины изменяются характеристики рабочей нагрузки. Сейчас невозможно переключиться на другую учетную запись хранения Azure, не отключая защиту.

Например, сейчас виртуальная машина находится в учетной записи репликации хранилища класса Standard. За следующие три месяца произошли следующие изменения:

1. Увеличилось количество пользователей приложения, запущенного на этой виртуальной машине.
2. Объем данных на ней увеличился, и из-за этого вам потребуется перейти на хранилище класса Premium. Это позволит Azure Site Recovery обрабатывать еще больший объем данных во время репликации.
3. Для этого вам потребуется отключить защиту, а затем повторно включить ее в учетной записи хранения уровня Premium.

Поэтому мы настоятельно рекомендуем спланировать рост во время планирования развертывания. По умолчанию коэффициент роста составляет 30 %. Вы знаете шаблон использования собственных приложений и можете оценить рост их использования. Измените этот коэффициент соответствующим образом при создании отчета. Кроме того, вы можете создать несколько отчетов с разными коэффициентами роста на основе тех же данных профилирования и оценить, какие рекомендации по пропускной способности источника данных и целевого хранилища более всего соответствуют вашим требованиям. 

Созданный отчет Microsoft Excel содержит следующие сведения:

* [сводка по локальной инфраструктуре](hyper-v-deployment-planner-analyze-report.md#on-premises-summary);
* [рекомендации](hyper-v-deployment-planner-analyze-report.md#recommendations);
* [размещение хранилища виртуальной машины](hyper-v-deployment-planner-analyze-report.md#vm-storage-placement-recommendation);
* [Совместимые виртуальные машины](hyper-v-deployment-planner-analyze-report.md#compatible-vms)
* [Несовместимые виртуальные машины](hyper-v-deployment-planner-analyze-report.md#incompatible-vms)
* [требования к локальному хранилищу](hyper-v-deployment-planner-analyze-report.md#on-premises-storage-requirement);
* [пакетная обработка IR](hyper-v-deployment-planner-analyze-report.md#initial-replication-batching);
* [оценка затрат](hyper-v-deployment-planner-cost-estimation.md).

![Отчет планировщика развертывания](media/hyper-v-deployment-planner-run/deployment-planner-report-h2a.png)


## <a name="get-throughput"></a>Оценка пропускной способности.
Чтобы оценить пропускную способность, которую Azure Site Recovery может достигнуть при репликации данных из локальной среды в Azure, запустите программу в режиме GetThroughput. Планировщик вычисляет пропускную способность на сервере, где он запущен. В идеале это сервер Hyper-V, на котором необходимо защитить виртуальные машины. 

### <a name="command-line-parameters"></a>Параметры командной строки 
Откройте консоль командной строки и перейдите к папке планировщика развертывания Azure Site Recovery. Запустите ASRDeploymentPlanner.exe с указанными ниже параметрами.
```
ASRDeploymentPlanner.exe -Operation GetThroughput /?
```
 Имя параметра | ОПИСАНИЕ |
|---|---|
| -Operation | Оценка пропускной способности. |
|-Virtualization|Тип виртуализации (VMware или Hyper-V).|
|-Directory|(Необязательно.) UNC-путь или путь к локальному каталогу, в котором хранятся данные профилирования (файлы, созданные в процессе профилирования). Эти данные используются для создания отчета. Если имя не указано, в качестве каталога по умолчанию используется каталог ProfiledData, расположенный по текущему пути.|
| -StorageAccountName | Имя учетной записи хранения, используемой для определения пропускной способности, необходимой для репликации данных из локальной среды в Azure. Программа отправляет тестовые данные в эту учетную запись хранения, чтобы рассчитать используемую пропускную способность. Учетная запись хранения должна быть общего назначения версии 1 или 2.|
| -StorageAccountKey | Ключ, используемый для доступа к учетной записи хранения. Перейдите на портал Azure и выберите **Учетные записи хранения** > *имя_учетной_записи_хранения* > **Параметры** > **Ключи доступа** > **Key1**.|
| -VMListFile | Файл со списком виртуальных машин, профилирование которых необходимо выполнить, для расчета используемой пропускной способности. Путь к файлу может быть абсолютным или относительным. Для Hyper-V это выходной файл операции GetVMList. При подготовке вручную файл должен содержать одно имя или IP-адрес сервера и имя виртуальной машины, разделенные символом "\" в каждой строке. Имя виртуальной машины, указанное в файле, должно совпадать с именем виртуальной машины в узле Hyper-V.<br><br>**Пример.** Файл VMList.txt содержит следующие виртуальные машины:<ul><li>Host_1\VM_A;</li><li>10.8.59.27\VM_B;</li><li>Host_2\VM_C.</li><ul>|
|-Environment|(Необязательно.) Целевая среда для учетной записи хранения Azure. Она может иметь одно из трех значений: AzureCloud, AzureUSGovernment или AzureChinaCloud. Значение по умолчанию — AzureCloud. Используйте этот параметр, если ваш целевой регион Azure — Azure для государственных организаций США или Azure для Китая.|

### <a name="example"></a>Пример
```
ASRDeploymentPlanner.exe -Operation GetThroughput -Virtualization Hyper-V -Directory E:\Hyp-erV_ProfiledData -VMListFile E:\Hyper-V_ProfiledData\ProfileVMList1.txt  -StorageAccountName  asrspfarm1 -StorageAccountKey by8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==
```

### <a name="throughput-considerations"></a>Рекомендации по пропускной способности

Планировщик создает в указанном каталоге несколько файлов asrvhdfile*цифра*.vhd емкостью 64 МБ (*цифра* — число файлов). а затем передает их в учетную запись хранения для определения пропускной способности. После измерения пропускной способности он удаляет эти файлы из учетной записи хранения и с локального сервера. Если программа по каким-либо причинам прерывает работу, не завершив оценку пропускной способности, она не удаляет файлы. Их необходимо удалить вручную.

Пропускная способность измеряется в определенный момент времени. Это максимальная пропускная способность, которой может достигнуть Azure Site Recovery во время репликации (при условии, что все остальные факторы не изменяются). Например, если любое приложение начинает использовать больший объем пропускной способности сети, тогда фактическая пропускная способность меняется во время репликации. Если выполнить команду GetThroughput на защищенных виртуальных машинах с активной обработкой данных, результаты измерения пропускной способности будут отличаться. 

Мы рекомендуем запустить программу несколько раз во время профилирования, чтобы оценить, какой пропускной способности можно достигнуть в разные моменты времени. В отчете планировщик отображает последнюю измеренную пропускную способность.

> [!NOTE]
> Запустите программу на сервере с такими же характеристиками хранилища и ЦП, что и на сервере Hyper-V.

При выполнении репликации установите рекомендуемый объем пропускной способности, необходимый для соблюдения требований к RPO в 100 % случаев. Если после установки достаточной пропускной способности результаты в отчете не улучшились, сделайте следующее:

1. Проверьте наличие требований к качеству обслуживания сети, которые ограничивают пропускную способность Azure Site Recovery.
2. Проверьте, находится ли хранилище Azure Site Recovery в ближайшем поддерживаемом физическом регионе Microsoft Azure, чтобы минимизировать сетевые задержки.
3. Проверьте характеристики локального хранилища, чтобы определить, можно ли улучшить оборудование (например, замените жесткие диски на твердотельные).

    
## <a name="next-steps"></a>Дополнительная информация
* [Анализ созданного отчета](hyper-v-deployment-planner-analyze-report.md)
