---
title: Отработка отказа и восстановление размещения виртуальных машин Azure, реплицированных в дополнительный регион Azure, с помощью Azure Site Recovery
description: Сведения об отработке отказа и восстановлении размещения при репликации виртуальных машин Azure в дополнительный регион Azure с помощью Azure Site Recovery
services: site-recovery
author: rayne-wiselman
manager: carmonm
ms.service: site-recovery
ms.topic: tutorial
ms.date: 05/15/2018
ms.author: raynew
ms.custom: mvc
ms.openlocfilehash: 4a27142f9110fd26daa8ea0ebd151a67769e6568
ms.sourcegitcommit: eb75f177fc59d90b1b667afcfe64ac51936e2638
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/16/2018
ms.locfileid: "34209279"
---
# <a name="fail-over-and-fail-back-azure-vms-between-azure-regions"></a>Отработка отказа и восстановление размещения виртуальных машин Azure между регионами Azure

Служба [Azure Site Recovery](site-recovery-overview.md) помогает реализовать стратегию аварийного восстановления за счет управления процессами репликации, отработки отказа и восстановления локальных компьютеров и виртуальных машин Azure.

Этот учебник содержит сведения об отработке отказа отдельной виртуальной машины Azure в дополнительный регион Azure. Восстановление размещения в основном регионе после отработки отказа происходит в тех ситуациях, где это возможно. Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * Отработка отказа виртуальной машины Azure
> * Повторная защита дополнительной виртуальной машины Azure, чтобы обеспечить ее репликацию в основной регион
> * Восстановление размещения дополнительной виртуальной машины
> * Повторная защита основной виртуальной машины для использования дополнительного региона

Репликация из Azure в Azure сейчас доступна в режиме предварительной версии.

## <a name="prerequisites"></a>предварительным требованиям

- Обязательно выполните [отработку аварийного восстановления](azure-to-azure-tutorial-dr-drill.md), чтобы убедиться в надлежащей работе всех компонентов.
- Перед запуском тестовой отработки отказа проверьте свойства виртуальной машины. Виртуальная машина должна соответствовать [требованиям Azure](azure-to-azure-support-matrix.md#support-for-replicated-machine-os-versions).

## <a name="run-a-failover-to-the-secondary-region"></a>Запуск отработки отказа в дополнительный регион

1. В разделе **Реплицированные элементы** выберите виртуальную машину, для которой требуется отработка отказа, а затем выберите **Отработка отказа**

   ![Отработка отказа](./media/azure-to-azure-tutorial-failover-failback/failover.png)

2. В разделе **Отработка отказа** выберите **точку восстановления**, в которую будет выполнена отработка отказа. Можно выбрать один из следующих вариантов:

   * **Последние** (по умолчанию): выполняет обработку всех данных в службе Site Recovery и обеспечивает наименьшую целевую точку восстановления (RPO).
   * **Последняя обработанная**: отменяет изменения для виртуальной машины до последней точки восстановления из числа обработанных службой Site Recovery.
   * **Настраиваемая**: выполняет отработку отказа до определенной точки восстановления. Этот параметр удобен для выполнения тестовой отработки отказа.

3. Выберите **Завершение работы виртуальной машины перед началом отработки отказа**, чтобы служба Site Recovery попыталась выключить исходные виртуальные машины, прежде чем запускать отработку отказа. Отработка отказа продолжится, даже если их не удастся отключить.

4. На странице **Задания** можно следить за ходом выполнения отработки отказа.

5. После отработки отказа войдите на виртуальную машину, чтобы проверить ее работу. Если вы хотите использовать для виртуальной машины другую точку восстановления, выберите команду **Изменить точку восстановления**.

6. Когда вы убедитесь, что после отработки отказа виртуальная машина работает правильно, **зафиксируйте** отработку отказа.
   При фиксации удаляются все доступные в службе точки восстановления. Параметр **Изменить точку восстановления** больше не доступен.

## <a name="reprotect-the-secondary-vm"></a>Повторная защита дополнительной виртуальной машины

После отработки отказа виртуальной машины нужно снова защитить ее, чтобы она реплицировалась в основной регион.

1. Убедитесь, что виртуальная машина находится в состоянии **Отработка отказа зафиксирована**, основной регион доступен и вы можете создавать и использовать новые ресурсы в нем.
2. В разделе **Хранилище** > **Реплицированные элементы** щелкните виртуальную машину, для которой проводилась отработка отказа, щелкните правой кнопкой мыши и выберите **Защитить повторно**.

   ![Щелкните правой кнопкой мыши для повторной защиты](./media/azure-to-azure-tutorial-failover-failback/reprotect.png)

2. Обратите внимание, что направление защиты — из дополнительного региона в основной — уже выбрано.
3. Просмотрите информацию о **группе ресурсов, сети, хранилище и группах доступности**. Все ресурсы, помеченные как новые, создаются во время повторного включения защиты.
4. Нажмите кнопку **ОК**, чтобы запустить задание повторной защиты. Оно заполняет целевой сайт актуальными данными, а затем реплицирует отличия в основной регион. Теперь виртуальная машина находится в защищенном состоянии.

## <a name="fail-back-to-the-primary-region"></a>Восстановление размещения в основном регионе

После повторной защиты виртуальной машины вы можете по мере необходимости восстановить размещение в основном регионе. Для этого следуйте инструкциям по [отработке отказа](#run-a-failover).
