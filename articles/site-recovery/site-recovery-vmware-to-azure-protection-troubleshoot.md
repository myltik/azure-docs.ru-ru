---
title: Устранение ошибок защиты на виртуальных машинах VMware или физических компьютерах в Azure | Документация Майкрософт
description: В этой статье описаны распространенные ошибки репликации компьютера VMware и способы их устранения
services: site-recovery
documentationcenter: ''
author: asgang
manager: rochakm
editor: ''
ms.assetid: ''
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 02/22/2018
ms.author: asgang
ms.openlocfilehash: 9e0c602646009b20c8d4f8a29d55b7f44a089131
ms.sourcegitcommit: 0b02e180f02ca3acbfb2f91ca3e36989df0f2d9c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/07/2018
ms.locfileid: "29767659"
---
# <a name="troubleshoot-on-premises-vmwarephysical-server-replication-issues"></a>Устранение неполадок репликации виртуальной машины VMware или физического сервера в локальной среде
Вы можете получить определенные сообщения об ошибках при защите виртуальных машин VMware или физических серверов с помощью Azure Site Recovery. В этой статье описаны некоторые наиболее распространенные сообщения об ошибках, а также действия по их устранению.


## <a name="initial-replication-is-stuck-at-0"></a>Начальная репликация зависла на 0 %
Большинство ошибок начальной репликации, с которой сталкивается служба поддержки, происходят из-за проблем с подключением между исходным сервером для передачи данных, между сервером и процессом или при передаче данных с сервера обработки в Azure.
В большинстве случаев вы можете устранить эти проблемы, выполнив приведенные ниже действия.

###<a name="check-the-following-on-source-machine"></a>Проверка на исходном компьютере
* В командной строке компьютера исходного сервера используйте Telnet, чтобы проверить связь сервера обработки с HTTPS-портом (по умолчанию 9443), как показано ниже, чтобы узнать, существуют ли проблемы с сетевым подключением или с блокировкой порта брандмауэра.

    `telnet <PS IP address> <port>`
> [!NOTE]
    > Используйте Telnet, а не команду PING для проверки соединения.  Если Telnet не установлен, выполните шаги, указанные [здесь](https://technet.microsoft.com/library/cc771275(v=WS.10).aspx).

Если не удается подключиться, разрешите входящий порт 9443 на сервере обработки и проверьте, не исчезла ли проблема. В некоторых случаях, когда сервер обработки находился за промежуточной подсетью, именно это вызывало такую проблему.

* Проверьте состояние службы `InMage Scout VX Agent – Sentinel/OutpostStart`, если она не выполняется, и проверьте, не исчезла ли проблема.   

###<a name="check-the-following-on-process-server"></a>Проверка сервера обработки

* **Проверьте, отправляет ли принудительно сервер обработки данные в Azure.**

Откройте диспетчер задач на компьютере сервера обработки (нажмите клавиши CTRL+SHIFT+ESC). Перейдите на вкладку "Производительность" и щелкните ссылку "Открыть монитор ресурсов". Из диспетчера ресурсов перейдите на вкладку "Сеть". Проверьте, отправляет ли файл cbengine.exe на вкладке "Процессы с сетевой активностью" большие объемы данных (в МБ).

![Включение репликации](./media/site-recovery-protection-common-errors/cbengine.png)

Если нет, сделайте следующее.

* **Проверьте, может ли сервер обработки подключится к большому двоичному объекту Azure.** Щелкните cbengine.exe, проверьте его и просмотрите область "Подключения TCP", чтобы определить, есть ли подключение с сервера обработки к URL-адресу большого двоичного объекта хранилища Azure.

![Включение репликации](./media/site-recovery-protection-common-errors/rmonitor.png)

Если нет, тогда выберите "Панель управления > Службы" и проверьте, работают ли следующие службы:

     * cxprocessserver
     * InMage Scout VX Agent – Sentinel/Outpost
     * Microsoft Azure Recovery Services Agent
     * Microsoft Azure Site Recovery Service
     * tmansvc
     *
Запустите все службы, которые не выполняются, и проверьте, не исчезла ли проблема.

* **Проверьте возможность подключения сервера обработки по общедоступному IP-адресу Azure с помощью порта 443**

Откройте последний журнал CBEngineCurr.errlog в расположении `%programfiles%\Microsoft Azure Recovery Services Agent\Temp` и найдите строки: "443" и "connection attempt failed".

![Включение репликации](./media/site-recovery-protection-common-errors/logdetails1.png)

Если возникли проблемы, тогда из командной строки сервера обработки используйте Telnet, чтобы проверить связь своего общедоступного IP-адреса Azure (замаскирован на изображении выше), найденного в CBEngineCurr.currLog, с помощью порта 443.

      telnet <your Azure Public IP address as seen in CBEngineCurr.errlog>  443
Если вы не можете подключиться, тогда проверьте, произошли ли проблемы доступа из-за брандмауэра или прокси-сервера, как описано в следующем шаге.


* **Проверьте, не блокирует ли доступ брандмауэр на основе IP-адресов на сервере обработки.** При использовании правил брандмауэра на основе IP-адресов на сервере скачайте список диапазонов IP-адресов центра обработки данных Microsoft Azure [здесь](https://www.microsoft.com/download/details.aspx?id=41653) и добавьте их в свою конфигурацию брандмауэра, чтобы убедиться, что они разрешают подключение к Azure (и HTTPS-порт 443).  Необходимо разрешить доступ для диапазонов IP-адресов региона Azure, в котором располагается ваша подписка, и региона "Западная часть США" (используется для контроля доступа и управления удостоверениями).

* **Проверьте, блокирует ли доступ брандмауэр на основе URL-адресов на сервере обработки.** При использовании брандмауэра на основе URL-адресов на сервере убедитесь, что в конфигурацию брандмауэра добавлены следующие URL-адреса.

  `*.accesscontrol.windows.net:`: используется для контроля доступа и управления удостоверениями;

  `*.backup.windowsazure.com:`: используется для передачи данных репликации и оркестрации;

  `*.blob.core.windows.net:`: используется для доступа к учетной записи хранения, в которой хранятся реплицируемые данные;

  `*.hypervrecoverymanager.windowsazure.com:`: используется для операций управления репликацией и оркестрации;

  `time.nist.gov` и `time.windows.com`: используются для проверки синхронизации времени системы с глобальным временем.

URL-адреса для **облака Azure для государственных организаций**:

`* .ugv.hypervrecoverymanager.windowsazure.us`

`* .ugv.backup.windowsazure.us`

`* .ugi.hypervrecoverymanager.windowsazure.us`

`* .ugi.backup.windowsazure.us`

* **Проверьте, не блокируют ли доступ параметры прокси-сервера на сервере обработки.**  При использовании прокси-сервера убедитесь, что его имя преобразуется DNS-сервером.
Чтобы проверить параметры, указанные во время настройки сервера конфигурации, перейдите в раздел реестра

    `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Azure Site Recovery\ProxySettings`

Теперь убедитесь, что те же параметры используются агентом Azure Site Recovery для отправки данных.
Поиск Microsoft Azure Backup

![Включение репликации](./media/site-recovery-protection-common-errors/mab.png)

Откройте службу и щелкните "Действие > Изменить свойства". На вкладке настройки прокси-сервера вы увидите адрес прокси-сервера, который должен соответствовать указанному в параметрах реестра. Если нет, измените его на тот же адрес.

![Включение репликации](./media/site-recovery-protection-common-errors/mabproxy.png)

* **Проверьте, не ограничено ли регулирование пропускной способности на сервере обработки**. Увеличьте пропускную способность и проверьте, не исчезла ли проблема.

##<a name="next-steps"></a>Дополнительная информация
Если вам нужна дополнительная помощь, отправьте свой запрос на [форум Azure Site Recovery](https://social.msdn.microsoft.com/Forums/azure/home?forum=hypervrecovmgr). У нас есть активное сообщество и один из наших инженеров сможет помочь вам.
