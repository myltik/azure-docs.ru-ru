---
title: Управление базой данных после ее переноса в базу данных SQL Azure | Документация Майкрософт
description: Сведения о том, как управлять базой данных после ее переноса в базу данных SQL Azure.
services: sql-database
author: joesackmsft
manager: craigg
ms.service: sql-database
ms.custom: migrate
ms.topic: conceptual
ms.date: 03/16/2018
ms.author: josack
ms.suite: sql
ms.prod_service: sql-database
ms.component: migration
ms.openlocfilehash: e0c849efa402bdfcf3ed6091cccf47ca722f23d7
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34650117"
---
# <a name="new-dba-in-the-cloud--managing-your-database-in-azure-sql-database"></a>Новый администратор базы данных в облаке — управление базой данных в службе "База данных SQL Azure"

На начальном этапе переход от традиционной самостоятельно управляемой, полностью контролируемой среды к среде PaaS может показаться невозможным. Как разработчик или администратор базы данных вы должны знать все основные возможности платформы, что, в свою очередь, позволит обеспечить постоянную доступность, производительность, безопасность и отказоустойчивость приложения. В этой статье в краткой форме представлены все соответствующие сведения. Здесь приведены некоторые полезные рекомендации по управлению приложением, обеспечению эффективного его выполнения и достижению оптимальных результатов в облаке с помощью основных возможностей службы "База данных SQL". Целевая аудитория: 
- пользователи, планирующие перенос приложений в базу данных SQL Azure (модернизация приложений);
- пользователи, выполняющие перенос приложений (текущий сценарий переноса);
- пользователи, недавно перенесшие приложения в базу данных SQL Azure (новый администратор базы данных в облаке).

В этой статье рассматриваются некоторые из основных характеристик базы данных SQL Azure как готовой к использованию платформы. К ним относятся: 
- непрерывность бизнес-процессов и аварийное восстановление (BCDR);
- безопасность и соответствие требованиям;
- интеллектуальный мониторинг и обслуживание базы данных;
- Перемещение данных


## <a name="business-continuity-and-disaster-recovery-bcdr"></a>Непрерывность бизнес-процессов и аварийное восстановление (BCDR)
Возможности обеспечения непрерывности бизнес-процессов и аварийного восстановления позволяют в обычном порядке продолжать работу в случае сбоя. Сбой может произойти на уровне базы данных (например, кто-то по ошибке удаляет ключевую таблицу) или центра обработки данных (из-за региональной катастрофы, например цунами). 

### <a name="how-do-i-create-and-manage-backups-on-sql-database"></a>Как создавать резервные копии в базе данных SQL и управлять ими?
Создавать резервные копии в базе данных SQL Azure не нужно. Служба "База данных SQL" делает это автоматически, поэтому больше не нужно волноваться о планировании резервного копирования, создании резервных копий и управлении ими. Эта платформа создает полную резервную копию каждую неделю, разностную резервную копию каждые несколько часов и резервную копию журналов каждые 5 минут. Это позволяет гарантировать эффективность аварийного восстановления и минимальную потерю данных. Первая полная резервная копия создается сразу же после создания базы данных. Эти резервные копии доступны в течение определенного периода (срок хранения) и отличаются в зависимости от выбранного уровня производительности.  Благодаря возможности [восстановления на определенный момент времени](sql-database-recovery-using-backups.md#point-in-time-restore) служба "База данных SQL" позволяет восстанавливать данные на любой момент времени в пределах этого срока хранения.

|Уровень производительности|Срок хранения в днях|
|---|:---:|
|базовая;|7|
|Стандартная|35|
|Премиум|35|
|||

Кроме того, функция [долгосрочного хранения](sql-database-long-term-retention.md) позволяет хранить файлы резервных копий в течение более длительного периода (до 10 лет) и восстанавливать данные из этих резервных копий в любой момент в течение этого времени. Кроме того, резервные копии баз данных хранятся в геореплицированном хранилище, что позволяет обеспечить устойчивость к региональным катастрофам. Эти резервные копии можно восстановить в любом регионе Azure в любой момент времени в пределах срока хранения. Дополнительные сведения см. в статье [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](sql-database-business-continuity.md).

### <a name="how-do-i-ensure-business-continuity-in-the-event-of-a-datacenter-level-disaster-or-regional-catastrophe"></a>Как обеспечить непрерывность бизнес-процессов в случае аварии на уровне центра обработки данных или региональной катастрофы?
Резервные копии базы данных хранятся в геореплицированной подсистеме хранения. За счет этого в случае региональной катастрофы вы можете восстановить резервную копию в другой регион Azure. Это называется геовосстановлением. Целевая точка восстановления (RPO) в этом случае обычно составляет менее часа, а оценка времени восстановления (ERT) занимает от нескольких минут до нескольких часов.

В критически важных базах данных SQL Azure применяется активная георепликация. Этот процесс создает геореплицированную дополнительную копию исходной базы данных в другом регионе. Рассмотрим пример. Вы хотите обеспечить устойчивость базы данных, изначально размещенной в регионе Azure "Западная часть США", к региональным катастрофам. Вы создадите активную геореплику базы данных в западной части США, допустим, в регионе "Восточная часть США". В случае бедствия в западной части США вы можете выполнить отработку в регион "Восточная часть США". Кроме того, если настроить группу автоматической отработки отказа, в случае сбоя эта база данных автоматически выполняет отработку отказа в дополнительный регион "Восточная часть США". RPO в этом примере составляет менее 5 секунд, а ERT — менее 30 секунд.

Если группа автоматической отработки отказа не настроена, ваше приложение должно активно отслеживать возникновение сбоя и инициировать переход на другой ресурс. В дополнительных регионах Azure можно создать до 4 активных геореплик. Это еще лучше. Кроме того, к этим георепликам можно предоставлять доступ только для чтения. Это довольно удобный способ сократить задержку в сценариях с использованием географически распределенного приложения. 

### <a name="how-does-my-disaster-recovery-plan-change-from-on-premises-to-sql-database"></a>Чем план аварийного восстановления отличается для локальной базы данных и базы данных SQL?
При использовании традиционного локального сервера SQL Server требовалось активно управлять доступностью с использованием таких возможностей, как отказоустойчивая кластеризация, зеркальное отображение базы данных, репликация транзакций, доставка журналов и других. Кроме того, чтобы обеспечить непрерывность бизнес процессов, требовалось также реализовать резервное копирование и управлять этим процессом. При использовании службы "База данных SQL" платформа автоматически выполняет эти процессы, благодаря чему вы можете сосредоточиться на разработке и оптимизации приложений базы данных, не волнуясь об управлении сбоями. Вы можете настраивать планы резервного копирования и аварийного восстановления с помощью нескольких щелчков мыши на портале Azure (или нескольких команд в API-интерфейсах PowerShell). 

Дополнительные сведения об аварийном восстановлении баз данных SQL Azure см. в [этой статье](https://azure.microsoft.com/blog/azure-sql-databases-disaster-recovery-101/).

## <a name="security-and-compliance"></a>Безопасность и соответствие требованиям
Группа разработки службы "База данных SQL" очень ответственно относится к безопасности и конфиденциальности. Безопасность в этой службе обеспечивается на уровне базы данных и платформы. Проще всего это понять, разделив всю систему обеспечения безопасности на несколько уровней. Вы можете управлять каждым уровнем, что обеспечивает оптимальную безопасность приложения. К этим уровням относятся:
- идентификация и проверка подлинности ([проверка подлинности Windows или SQL и Azure Active Directory [AAD]](sql-database-control-access.md));
- мониторинг действий ([аудит](sql-database-auditing.md) и [обнаружение угроз](sql-database-threat-detection.md));
- защита фактических данных ([прозрачное шифрование данных [TDE]](/sql/relational-databases/security/encryption/transparent-data-encryption-azure-sql) и применение технологии [Always Encrypted [AE]](/sql/relational-databases/security/encryption/always-encrypted-database-engine)); 
- управление доступом к конфиденциальным и привилегированным данным ([безопасность на уровне строк](/sql/relational-databases/security/row-level-security) и [динамическое маскирование данных](/sql/relational-databases/security/dynamic-data-masking)).

[Центр безопасности Azure](https://azure.microsoft.com/services/security-center/) предоставляет возможности централизованного управления безопасностью рабочих нагрузок в Azure, в локальной среде и в других облаках. Вы можете проверить, настроена ли на всех ресурсах надлежащая защита базы данных SQL, такая как [аудит](sql-database-auditing.md) и [прозрачное шифрование данных](/sql/relational-databases/security/encryption/transparent-data-encryption-azure-sql), и создать политики на основе собственных требований.

### <a name="what-user-authentication-methods-are-offered-in-sql-database"></a>Какие методы проверки подлинности доступны в службе "База данных SQL"?
В службе "База данных SQL" доступны [два метода проверки подлинности](sql-database-control-access.md#authentication): 
- [проверка подлинности Azure Active Directory](sql-database-aad-authentication.md);
- проверка подлинности SQL. 

Традиционная проверка подлинности Windows не поддерживается. Azure Active Directory (AD) — это централизованная служба управления удостоверениями и доступом. Благодаря ей вы можете очень легко предоставлять возможности единого входа (SSO) всем сотрудникам организации. Это значит, что одни учетные данные используются во всех службах Azure, что упрощает проверку подлинности. Azure Active Directory поддерживает [многофакторную проверку подлинности](sql-database-ssms-mfa-authentication.md). Кроме того, эту службу можно [легко](../active-directory/connect/active-directory-aadconnect-get-started-express.md) интегрировать с Windows Server Active Directory. Принципы работы проверки подлинности SQL не изменились. Вы просто вводите имя пользователя и пароль, а затем выполняете проверку подлинности пользователей в любой базе данных на определенном логическом сервере. Это также позволяет базе данных SQL и хранилищу данных SQL предлагать многофакторную проверку подлинности и гостевые учетные записи пользователей в домене Azure AD. При наличии Active Directory в локальной среде вы можете создать федерацию каталога с Azure Active Directory, чтобы расширить свой каталог до Azure.

|**Если вы...**|**База данных SQL или хранилище данных SQL**|
|---|---|
|Предпочитаете не использовать Azure Active Directory (AD) в Azure|Используйте [проверку подлинности SQL](sql-database-security-overview.md).|
|Использовали AD на локальном сервере SQL Server|[Создайте федерацию AD с Azure AD](../active-directory/connect/active-directory-aadconnect.md) и используйте проверку подлинности Azure AD. В таком случае можно использовать единый вход.|
|Требуется принудительная многофакторная проверка подлинности|Требуйте выполнения многофакторной проверки подлинности в качестве политики с помощью [условного доступа Майкрософт](sql-database-conditional-access.md) и используйте [универсальную проверку подлинности Azure AD с поддержкой многофакторной проверки подлинности](sql-database-ssms-mfa-authentication.md).|
|Имеете гостевые учетные данные из учетных записей Майкрософт (live.com, outlook.com) или других доменов (gmail.com)|Используйте [универсальную проверку подлинности Azure AD](sql-database-ssms-mfa-authentication.md) в хранилище базы данных и в базе данных SQL, которая использует [службу совместной работы Azure AD B2B](../active-directory/active-directory-b2b-what-is-azure-ad-b2b.md).|
|Входите в систему Windows с помощью учетных данных Azure Active Directory из федеративного домена|Используйте [встроенную проверку подлинности Azure AD](sql-database-aad-authentication-configure.md).|
|Входите в систему Windows с помощью учетных данных из домена, который не включен в федерацию с Azure|Используйте [встроенную проверку подлинности Azure AD](sql-database-aad-authentication-configure.md).|
|Имеете службы среднего уровня, которые нужно подключить к базе данных SQL или хранилищу данных SQL|Используйте [встроенную проверку подлинности Azure AD](sql-database-aad-authentication-configure.md).|
|||

### <a name="how-do-i-limit-or-control-connectivity-access-to-my-database"></a>Как ограничить доступ к базе данных или управление им?
Управлять доступом к приложению в организации можно несколькими способами. 
- Правила брандмауэра
- Конечные точки службы виртуальной сети
- Зарезервированные IP-адреса

#### <a name="firewall"></a>Брандмауэр
Брандмауэр блокирует доступ к серверу из внешней сущности. Доступ к логическому серверу предоставляется только определенным сущностям. По умолчанию все подключения к логическому серверу и базам данных на нем запрещены, за исключением подключений из других служб Azure. Создав правило брандмауэра, вы можете открыть доступ к серверу только утвержденным сущностям (например, компьютеру разработчика). В этом случае IP-адрес этого компьютера необходимо разрешить через брандмауэр. Кроме того, доступ к логическому серверу можно разрешить диапазону IP-адресов. Например, на странице "Параметры брандмауэра" можно указать диапазон IP-адресов всех компьютеров разработчиков в организации. 

Правила брандмауэра можно создавать на уровне сервера и базы данных. Правила брандмауэра уровня сервера можно создать на портале или с помощью SQL Server Management Studio (SSMS). Дополнительные сведения о настройке правила брандмауэра уровня сервера и базы данных см. в [этом разделе](sql-database-security-tutorial.md#create-a-server-level-firewall-rule-in-the-azure-portal).

#### <a name="service-endpoints"></a>Конечные точки службы
По умолчанию в базе данных SQL настроен параметр Allow all Azure services (Разрешить все службы Azure). Это означает, что все виртуальные машины в Azure могут подключаться к базе данных. Но эти службы все равно должны пройти проверку подлинности. Чтобы настроить доступ к базе данных через все IP-адреса Azure, параметр Allow all Azure services (Разрешить все службы Azure) нужно отключить. Кроме того, можно настроить [конечные точки службы виртуальной сети](sql-database-vnet-service-endpoint-rule-overview.md).

Конечные точки службы позволяют предоставлять важные ресурсы Azure только в собственной частной виртуальной сети Azure. Это позволяет существенно ограничить общий доступ к ресурсам. Трафик между виртуальной сетью и Azure остается в магистральной сети Azure. Без конечной точки службы выполняется маршрутизация пакетов с принудительным туннелированием. Виртуальная сеть принудительно передает интернет-трафик в организацию, а трафик службы Azure проходит через тот же маршрут. Конечные точки службы позволяют оптимизировать это поведение с момента прохождения пакетов из виртуальной сети к службе в магистральной сети Azure.

![Конечные точки службы виртуальной сети](./media/sql-database-manage-after-migration/vnet-service-endpoints.png) 

#### <a name="reserved-ips"></a>Зарезервированные IP-адреса
Как альтернативный вариант, вы можете подготовить [зарезервированные IP-адреса](../virtual-network/virtual-networks-reserved-public-ip.md) виртуальных машин и добавить их в список разрешений в параметрах брандмауэра сервера. Назначая зарезервированные IP-адреса, вы избавляетесь от необходимости обновления правил брандмауэра при изменении IP-адресов.

### <a name="what-port-do-i-connect-to-sql-database-on"></a>Через какой порт устанавливается подключение к службе "База данных SQL"?

База данных SQL обменивается данными через порт 1433. Чтобы подключиться из корпоративной сети, в параметрах брандмауэра организации необходимо добавить правило для исходящего трафика. Советуем не предоставлять доступ к порту 1433 за пределами границ Azure. Вы можете запустить SSMS в Azure с помощью [удаленного приложения Azure RemoteApp](https://www.microsoft.com/cloud-platform/azure-remoteapp-client-apps). В этом случае исходящие подключения к порту 1433 открывать не требуется. IP-адрес статический, поэтому базу данных можно открыть только для RemoteApp. Удаленное приложение поддерживает многофакторную проверку подлинности.

### <a name="how-can-i-monitor-and-regulate-activity-on-my-server-and-database-in-sql-database"></a>Как отслеживать и контролировать действия на сервере и в базе данных в службе "База данных SQL"?
#### <a name="sql-database-auditing"></a>Аудит базы данных SQL
В службе "База данных SQL" можно включить аудит событий базы данных. [Эта функция](sql-database-auditing.md) позволяет отслеживать записи базы данных и записывать их в файл журнала аудита в учетной записи хранения Azure. В процессе аудита вы получаете аналитические сведения о возможных нарушениях безопасности и политик, которые могут помочь в обеспечении соответствия нормативным требованиям. Это позволяет определить и настроить конкретные категории событий, которые нужно отслеживать, а затем в предварительно настроенных отчетах и на панели мониторинга просматривать события, произошедшие в базе данных. Эти политики аудита можно применить на уровне базы данных или сервера. Сведения о том, как включить аудит сервера или базы данных, см. в [этом разделе](sql-database-security-tutorial.md#enable-sql-database-auditing-if-necessary).

#### <a name="threat-detection"></a>Обнаружение угроз
Функция [обнаружения угроз](sql-database-threat-detection.md) позволяет легко устранять нарушения безопасности и политик, обнаруженные в процессе аудита. Для устранения потенциальных угроз или нарушений не нужны экспертные навыки в сфере безопасности. Эта функция также предоставляет дополнительные встроенные возможности, такие как обнаружение атак путем внедрения кода SQL. Внедрение кода SQL — это попытка изменить или компрометировать данные. Это довольно распространенный способ атаки на приложения базы данных в целом. Функция обнаружения угроз в базе данных SQL выполняет множество наборов алгоритмов, которые обнаруживают потенциальные уязвимости и атаки путем внедрения кода SQL, а также аномальные шаблоны доступа к базе данных (например, доступ из необычного расположения или незнакомым субъектом). Сотрудники службы безопасности или другие назначенные администраторы получают уведомление по электронной почте, если в базе данных обнаружена угроза. Каждое уведомление содержит сведения о подозрительном действии и рекомендации по дальнейшему исследованию и снижению угрозы. Дополнительные сведения о включении обнаружения угроз базы данных SQL см. в [этом разделе](sql-database-security-tutorial.md#enable-sql-database-threat-detection). 
### <a name="how-do-i-protect-my-data-in-general-on-sql-database"></a>Как защитить данные в службе "База данных SQL"?
Шифрование обеспечивает надежный механизм защиты конфиденциальных данных от несанкционированного доступа. Злоумышленники не смогут воспользоваться зашифрованными данными без ключа расшифровки. Это добавляет дополнительный уровень защиты поверх встроенных в службе "База данных SQL" уровней. Существует два способа защиты данных в службе "База данных SQL": 
- защита неактивных данных в файлах журналов и данных; 
- защита активных данных. 

По умолчанию неактивные данные в службе "База данных SQL" хранятся в файлах данных и журналов в подсистеме хранения. Эти данные постоянно шифруются с помощью функции [прозрачного шифрования](/sql/relational-databases/security/encryption/transparent-data-encryption-azure-sql). Резервные копии также шифруются. Благодаря прозрачному шифрованию на стороне приложения, которое обращается к данным, не нужно вносить никаких изменений. Шифрование и расшифровка происходит прозрачно (отсюда и название). Защита активных и неактивных конфиденциальных данных в службе "База данных SQL" осуществляется с помощью функции [Always Encrypted](/sql/relational-databases/security/encryption/always-encrypted-database-engine). Always Encrypted — это форма шифрования на стороне клиента, которая шифрует конфиденциальные столбцы в базе данных (поэтому они находятся в зашифрованном виде для администраторов баз данных и неавторизованных пользователей). Сначала сервер получает зашифрованные данные. Ключ постоянного шифрования также хранится на стороне клиента, поэтому только авторизованные клиенты могут расшифровывать конфиденциальные столбцы. Администраторы сервера и данных не могут видеть конфиденциальные данные, так как ключи шифрования хранятся в клиенте. Функция Always Encrypted выполняет сквозное шифрование конфиденциальных столбцов в таблице, что позволяет обеспечить защиту от несанкционированного доступа (от неавторизованных клиентов до физических дисков). Эта функция также поддерживает сопоставления равенства, поэтому администраторы баз данных могут продолжать запрашивать зашифрованные столбцы как часть своих команд SQL. Она может использоваться с различными вариантами хранения ключей, например с [Azure Key Vault](sql-database-always-encrypted-azure-key-vault.md), хранилищем сертификатов Windows и локальными аппаратными модулями безопасности.

|**Характеристики**|**Always Encrypted**|**Transparent Data Encryption (Прозрачное шифрование данных)**|
|---|---|---|
|**Диапазон шифрования**|Законченное решение|Неактивные данные|
|**Сервер базы данных может обращаться к конфиденциальным данным**|Нет |Да, так как шифруются неактивные данные|
|**Разрешенные операции T-SQL**|Сравнение на равенство|Доступна вся контактная зона T-SQL|
|**Степень изменения приложения для использования этой функции**|Небольшие|Минимальные|
|**Гранулярность шифрования**|На уровне столбцов|На уровне базы данных|
||||

### <a name="how-can-i-limit-access-to-sensitive-data-in-my-database"></a>Как ограничить доступ к конфиденциальным данным в базе данных?
Каждое приложение содержит конфиденциальные данные в базе данных, которые необходимо защитить. Эти данные должны видеть только определенные сотрудники организации. Рассмотрим пример с данными о зарплате сотрудников. Руководителю компании требуется доступ к данным о зарплате непосредственных подчиненных, но отдельным сотрудникам эти сведения видеть не нужно. Рассмотрим еще один пример. На стадии разработки или тестирования разработчики данных взаимодействуют с конфиденциальными данными, например с номерами социального страхования (SSN). В других случаях эта информация им не требуется. В таких случаях конфиденциальные данные либо нужно скрыть или вовсе не предоставлять к ним доступ. Чтобы предотвратить несанкционированный доступ к конфиденциальным данным, в службе "База данных SQL" предусмотрено два подхода:

[Динамическое маскирование данных](sql-database-dynamic-data-masking-get-started.md) — это функция маскирования данных, которая позволяет ограничить доступ к конфиденциальным данным, маскируя их от непривилегированных пользователей на уровне приложения. Вы определяете правило маскирования, которое может создавать шаблон маскирования (например, показывать только последние четыре цифры номера социального страхования и отмечать остальное как X) и определять, каких пользователей можно исключить из правила. Маскирование выполняется в режиме реального времени. Разные категории данных поддерживают различные возможности маскирования. Функция динамического маскирования данных позволяет автоматически обнаруживать конфиденциальные данные в базе данных и применять к ним маскирование.

Функция [Безопасность на уровне строк](/sql/relational-databases/security/row-level-security) дает возможность управлять доступом на уровне строк. Это означает, что определенные строки в таблице базы данных скрыты в зависимости от характеристик пользователя, выполняющего запрос (например, членство в группе или контекст выполнения). Ограничение доступа выполняется на уровне базы данных вместо уровня приложения, чтобы упростить логику приложения. Сначала нужно создать предикат фильтра, исключающий строки, к которым не предоставляется доступ, а затем политику безопасности, определяющую, кому нужно предоставлять к ним доступ. Теперь когда пользователь выполняет запрос, он либо сможет просматривать эти строки с ограниченным доступом, либо нет. Это зависит от его привилегий.

### <a name="how-do-i-manage-encryption-keys-in-the-cloud"></a>Как управлять ключами шифрования в облаке?

Существуют возможности управления ключами и для Always Encrypted (шифрование на стороне клиента), и для прозрачного шифрования данных (шифрование при хранении). Советуем регулярно изменять ключи шифрования. Частота смены должна соответствовать внутренним правилам организации и нормативным требованиям.

**Прозрачное шифрование данных**. В TDE существует иерархия с двумя ключами. Данные в каждой пользовательской базе данных шифруются с помощью симметричного ключа шифрования AES-256 (DEK), уникального для базы данных, который, в свою очередь, зашифрован с помощью главного асимметричного ключа RSA 2048, уникального для сервера. Управление главным ключом осуществляется:
- автоматически платформой (службой "База данных SQL");
- с помощью [Azure Key Vault](sql-database-always-encrypted-azure-key-vault.md) в качестве хранилища ключей.

По умолчанию для удобства главным ключом для прозрачного шифрования данных управляет служба базы данных SQL. Если организация хочет управлять главным ключом, в качестве хранилища ключей можно использовать Azure Key Vault](sql-database-always-encrypted-azure-key-vault.md). С помощью Azure Key Vault ваша организация берет на себя управление подготовкой, сменой ключей и разрешениями. [Смена или изменение типа главного ключа прозрачного шифрования данных](/sql/relational-databases/security/encryption/transparent-data-encryption-byok-azure-sql-key-rotation) выполняется быстро, так как повторно шифруется только ключ шифрования. В организациях, разделяющих роли безопасности и управления данными, администратор безопасности может предоставить материал главного ключа TDE в Azure Key Vault и предоставить идентификатор ключа Azure Key Vault администратору базы данных для использования в режиме шифрования неактивных данных на сервере. Key Vault разработано таким образом, чтобы сотрудники Майкрософт не могли видеть или извлекать ключи шифрования. Кроме того, вы можете обеспечить централизованное управление ключами организации. 

**Always Encrypted.** Существует также иерархия [с двумя ключами](/sql/relational-databases/security/encryption/overview-of-key-management-for-always-encrypted), при которой столбец с конфиденциальными данными шифруется с помощью ключа шифрования столбцов AES 256 (CEK), который, в свою очередь, зашифрован с помощью главного ключа столбца (CMK). Клиентские драйверы, предоставленные для Always Encrypted, не имеют ограничений на длину CMK. Зашифрованное значение CEK сохраняется в базе данных, а CMK хранится в хранилище доверенных ключей, таком как хранилище сертификатов Windows, Azure Key Vault или аппаратный модуль безопасности. 
- [CEK и CMK](/sql/relational-databases/security/encryption/rotate-always-encrypted-keys-using-powershell) можно менять. 
- Замена CEK выполняется на уровне данных. В ​​зависимости от размера таблиц, содержащих зашифрованные столбцы, этот процесс может занимать много времени. Поэтому советуем спланировать его соответствующим образом. 
- С другой стороны, замена CMK не влияет на производительность базы данных и может выполняться с помощью отдельных ролей.
На схеме ниже показаны варианты хранилища ключей для главных ключей столбца при использовании Always Encrypted.

![Поставщики хранилища CMK для Always Encrypted](./media/sql-database-manage-after-migration/always-encrypted.png)

### <a name="how-can-i-optimize-and-secure-the-traffic-between-my-organization-and-sql-database"></a>Как оптимизировать и защитить трафик между организацией и службой "База данных SQL"?
Обычно сетевой трафик между организацией и службой "База данных SQL" перенаправляется через публичную сеть. Тем не менее если вы решили оптимизировать этот путь и сделать его более безопасным, рассмотрите ExpressRoute. Эта служба фактически позволяет расширить корпоративную сеть на платформе Azure через частное подключение. Таким образом трафик не проходит через общедоступный Интернет. Это обеспечивает более высокий уровень безопасности и надежности, а также оптимизирует маршрутизацию, что, в свою очередь, позволяет снизить задержки сети и повысить быстродействие по сравнению с типичными подключениями через общедоступный Интернет. Если вы планируете передавать значительный блок данных между организацией и Azure, ExpressRoute позволяет значительно сократить затраты. Доступно три разных модели подключения между организацией и Azure: 
- [совместное размещение в Cloud Exchange](../expressroute/expressroute-connectivity-models.md#CloudExchange);
- [подключение "любой к любому"](../expressroute/expressroute-connectivity-models.md#IPVPN);
- [подключения "точка — точка"](../expressroute/expressroute-connectivity-models.md#Ethernet).

ExpressRoute также позволяют вдвое повысить приобретенную пропускную способность без дополнительной оплаты. Можно также настроить межрегиональное подключение с помощью Express Route. Список поставщиков услуг подключения ExpressRoute см. в статье [Партнеры и одноранговые расположения ExpressRoute](../expressroute/expressroute-locations.md). В следующих статьях предоставлено более подробное описание ExpressRoute:
- [Обзор ExpressRoute](../expressroute/expressroute-introduction.md)
- [Предварительные требования](../expressroute/expressroute-prerequisites.md)
- [Рабочие процессы](../expressroute/expressroute-workflows.md)

### <a name="is-sql-database-compliant-with-any-regulatory-requirements-and-how-does-that-help-with-my-own-organizations-compliance"></a>Совместима ли база данных SQL с какими-либо нормативными требованиями и как это помогает соблюдению требований моей собственной организации?
Служба "База данных SQL" совместима с рядом нормативных требований. Чтобы просмотреть последний набор выполненных требований, посетите [центр управления безопасностью Майкрософт](https://www.microsoft.com/trustcenter/compliance/complianceofferings). Перейдя к важным для организации требованиям, вы увидите, указана ли служба "База данных SQL" в списке совместимых служб Azure. Важно отметить, что хотя служба "База данных SQL" может быть сертифицирована как совместимая служба, это не гарантирует автоматическое соответствие нормативным требованиям организации.

## <a name="intelligent-database-monitoring-and-maintenance-after-migration"></a>Интеллектуальный мониторинг и обслуживание базы данных после переноса

После переноса базы данных в службу "База данных SQL" необходимо организовать мониторинг (использование ресурсов или проверки DBCC) и регулярное обслуживание (например, перестроение или реорганизация индексов, статистики и т. д.). База данных SQL — это интеллектуальная служба. Она позволяет выполнять мониторинг и обслуживание базы данных на основе исторических тенденций, записанных метрик и статистических данных. За счет этого приложение постоянно работает наилучшим образом. В некоторых случаях эта служба может автоматически выполнять задачи обслуживания в зависимости от настроек конфигурации. Служба "База данных SQL" отслеживает такие три аспекты базы данных:
- мониторинг производительности и оптимизация;
- оптимизация безопасности;
- оптимизация затрат.

**Мониторинг производительности и оптимизация.** На основе анализа производительности процессов вы получаете специализированные рекомендации по оптимизации рабочей нагрузки базы данных, благодаря чему приложения выполняются на оптимальном уровне. Вы также можете автоматически применять эти рекомендации и не беспокоиться о выполнении задач обслуживания. Помощник по построению индексов позволяет автоматически внедрять рекомендации по индексам на основе рабочей нагрузки. Это называется автоматической настройкой. Рекомендации основаны на изменениях рабочей нагрузки приложения, что позволяет сделать их максимально персонализированными. Эти рекомендации можно также просматривать вручную, а затем по своему усмотрению применять.  

**Оптимизация безопасности.** Служба "База данных SQL" предоставляет действенные рекомендации по защите данных, а функция обнаружения угроз позволяет определять и исследовать подозрительные активности, которые могут навредить базе данных. [Оценка уязвимостей SQL](sql-vulnerability-assessment.md) — это служба сканирования и отчетов базы данных, которая позволяет отслеживать состояние безопасности большого количества баз данных, а также определять риски безопасности и отклонения от заданных базовых показателей безопасности. После каждого сканирования предоставляется индивидуальный список практических действий и скрипты исправлений, а также отчет об оценке, который можно использовать для обеспечения соответствия.

Центр безопасности Azure предоставляет общие рекомендации по обеспечению безопасности, которые можно применить одним щелчком. 

**Оптимизация затрат.** Платформа SQL Azure анализирует журнал использования в нескольких базах данных на сервере, оценивает результаты и на их основе предоставляет рекомендации по оптимизации затрат. Этот анализ обычно занимает две недели, но по завершении вы получаете действенные рекомендации. Пул эластичных баз данных — это одна из таких рекомендаций. Рекомендация отображается на портале в виде заголовка:

![Рекомендации для пула эластичных баз данных](./media/sql-database-manage-after-migration/elastic-pool-recommendations.png) 

Этот анализ также можно просмотреть в разделе "Рекомендации помощника".

![Рекомендации для пула эластичных баз данных в разделе "Рекомендации помощника"](./media/sql-database-manage-after-migration/advisor-section.png)

### <a name="how-do-i-monitor-the-performance-and-resource-utilization-in-sql-database"></a>Как отслеживать производительность и использование ресурсов в базе данных SQL?

Функция Intelligent Insights в службе "База данных SQL" позволяет отслеживать производительность и принимать необходимые меры. Вы можете отслеживать производительность и использование ресурсов в службе "База данных SQL" следующими методами:
- **Портал Azure**. На портале можно отслеживать использование отдельной базы данных. Для этого нужно выбрать базу данных и щелкнуть диаграмму в области "Обзор". Вы можете настроить отображение на диаграмме нескольких показателей, включая процент использования CPU, процент DTU, процент данных операций ввода-вывода, процент сеансов и процент размера базы данных.

   ![Диаграмма мониторинга](./media/sql-database-manage-after-migration/monitoring-chart.png)

   ![Диаграмма мониторинга 2](./media/sql-database-manage-after-migration/chart.png)

Из этой диаграммы можно также настроить оповещения по ресурсам. Эти оповещения позволяют реагировать на состояние ресурсов следующим образом: отправка сообщения электронной почты, запись в конечную точку HTTPS/HTTP или выполнение действия. Дополнительные сведения см. в статье [Мониторинг производительности базы данных в базе данных SQL Azure](sql-database-single-database-monitor.md).

- **Динамические административные представления**. Вы можете запросить динамическое административное представление [sys.dm_db_resource_stats](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-resource-stats-azure-sql-database) для возврата истории о статистике потребления ресурсов за последний час и представления системного каталога [sys.resource_stats](/sql/relational-databases/system-catalog-views/sys-resource-stats-azure-sql-database) для возврата истории за последние 14 дней.
- **Анализ производительности запросов**. [Этот инструмент](sql-database-query-performance.md) позволяет просмотреть историю наиболее ресурсоемких и длительных запросов для конкретной базы данных. Вы можете быстро определять наиболее ресурсоемкие, длительные и часто выполняющиеся запросы, а также отслеживать запросы и обнаруживать регрессии. Для этой функции требуется включить [хранилище запросов](/sql/relational-databases/performance/monitoring-performance-by-using-the-query-store) в базе данных.

   ![анализ производительности запросов](./media/sql-database-manage-after-migration/query-performance-insight.png)

- **Аналитика SQL Azure (предварительная версия) в службе Log Analytics**. [Azure Log Analytics](../log-analytics/log-analytics-azure-sql.md) позволяет собирать и визуализировать ключевые метрики производительности SQL Azure, поддерживает до 150 000 баз данных SQL и 5000 эластичных пулов SQL в каждой рабочей области. Ее можно использовать для отслеживания и получения уведомлений. Вы можете отслеживать метрики базы данных SQL и эластичных пулов в нескольких подписках Azure и эластичных пулах и использовать их при выявлении проблем на каждом уровне стека приложений.

### <a name="i-am-noticing-performance-issues-how-does-my-sql-database-troubleshooting-methodology-differ-from-sql-server"></a>Как отличаются методы устранения проблем с производительностью службы "База данных SQL" от SQL Server?
Основная часть методов устранения неполадок, а в частности диагностика проблем с производительностью базы данных и запросов, не изменилась. В облаке используется то же ядро SQL Server. Тем не менее платформа (база данных SQL Azure) предоставляет встроенные возможности аналитики, которые еще больше упрощают диагностику и устранение проблем с производительностью. Эта платформа также выполняет некоторые корректирующие действия от вашего имени и в некоторых случаях заблаговременно автоматически исправляет проблемы. 

Применение интеллектуальных функций, таких как [анализ производительности процессов](sql-database-query-performance.md) и [Помощник по базам данных](sql-database-advisor.md) в процессе устранения неполадок, связанных с производительностью, предоставляет значительные преимущества. Именно в этом заключается разница в методологиях. Больше не нужно вручную искать важные сведения, которые могут помочь устранить текущую проблему. Платформа выполняет самые сложные задачи автоматически. В качестве примера можно привести анализ производительности процессов. Эта функция позволяет просматривать подробные сведения вплоть до уровня запросов, а также просматривать исторические тенденции и определять точное время снижения производительности запроса. Помощник по базам данных предоставляет рекомендации, которые могут помочь повысить общую производительность, например рекомендации по созданию отсутствующих индексов, их удалению, параметризации запросов и т. д. 

При устранении проблем с производительностью важно определить, что именно их вызывает: само приложение или его база данных. Часто проблема находится на уровне приложения. Ее может вызывать архитектура или шаблон доступа к данным. Рассмотрим пример с приложением обмена сообщениями, чувствительным к сетевой задержке. В этом случае между приложением и сервером проходит множество коротких запросов, которые перегружают сеть и снижают производительность самого приложения. Задержка при прохождении этих циклов быстро растет. Повысить производительность можно с помощью [пакетных запросов](sql-database-performance-guidance.md#batch-queries). В этом случае запросы обрабатываются пакетами, что позволяет сократить задержку кругового пути и значительно повысить производительность приложения. 

Кроме того, при снижении общего уровня производительности базы данных отслеживайте динамические административные представления [sys.dm_db_resource_stats](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-resource-stats-azure-sql-database) и [sys.resource_stats](/sql/relational-databases/system-catalog-views/sys-resource-stats-azure-sql-database), чтобы понимать уровень использования ЦП, операций ввода-вывода и потребления памяти. На снижение производительности может влиять нехватка ресурсов в базе данных. Возможно, потребуется изменить уровень производительности и (или) уровень обслуживания в соответствии с различными требованиями к расширению и сжатию рабочих нагрузок. 

Полный набор рекомендаций по решению проблем с производительностью см. в разделе [Настройка базы данных](sql-database-performance-guidance.md#tune-your-database).

### <a name="how-do-i-ensure-i-am-using-the-appropriate-service-tier-and-performance-level"></a>Как убедиться, что используется соответствующий уровень служб и производительности?
База данных SQL поддерживает разные уровни служб: "Базовый", "Стандартный" и "Премиум". Каждый уровень обеспечивает прогнозируемую производительность. В зависимости от рабочей нагрузки возможны вспышки активности, при которых ресурсов, выделенных на текущем уровне производительности, может оказаться просто недостаточно. В таких случаях полезно сначала оценить, поможет ли в этом настройка, например добавление или изменение индексов. Если ресурсов по-прежнему недостаточно, советуем перейти на более высокий уровень производительности или уровень обслуживания. 

|**Уровень обслуживания**|**Распространенные варианты использования**|
|---|---|
|**базовая;**|Приложения с несколькими пользователями и база данных с низкими требованиями к параллелизму, масштабированию и производительности. |
|**Стандартный**|Приложения с высокими требованиями к параллелизму, масштабированию и производительности, а также с небольшими или средними требованиями к операциям ввода-вывода. |
|**Премиальный**|Приложения с большим количеством одновременно работающих пользователей, высоким уровнем потребления ресурсов ЦП и памяти, а также с высокими требованиями к операциям ввода-вывода. Чувствительные к задержкам приложения с высокими требованиями к параллелизму и пропускной способности, которые могут работать на уровне "Премиум". |
|||

Чтобы проверить, правильный ли вы используете уровень производительности, выполните мониторинг потребления ресурсов базы данных и запросов одним из способов, описанных в разделе "Как отслеживать производительность и использование ресурсов в базе данных SQL". Если запросы и (или) базы данных потребляют слишком много ресурсов ЦП или памяти, советуем перейти на более высокий уровень производительности. Аналогичным образом, если даже в течение максимальной нагрузки ресурсов потребляется не так много, перейдите на более низкий уровень производительности. 

При использовании шаблона приложения SaaS или в сценарии консолидации базы данных советуем использовать пул эластичных баз данных. Это позволит сократить расходы. Эластичный пул — это отличный способ достижения консолидации базы данных и оптимизации затрат. Дополнительные сведения об управлении несколькими базами данных в эластичном пуле с помощью портала Azure см. в [этом разделе](sql-database-elastic-pool.md#manage-elastic-pools-and-databases-using-the-azure-portal). 

### <a name="how-often-do-i-need-to-run-database-integrity-checks-for-my-database"></a>Как часто нужно проверять целостность базы данных?
Служба "База данных SQL" использует некоторые интеллектуальные методы, которые позволяют обрабатывать определенные классы повреждений данных автоматически и без потери. Эти методы встроены в службу и используются при необходимости. Резервные копии базы данных в службе регулярно проверяются за счет восстановления и выполнения DBCC CHECKDB. Если возникают проблемы, служба "База данных SQL" заранее устраняет их. Функция [автоматического восстановления страниц](/sql/sql-server/failover-clusters/automatic-page-repair-availability-groups-database-mirroring) позволяет исправлять поврежденные страницы или страницы с проблемами целостности данных. Страницы базы данных постоянно проверяются с помощью параметра CHECKSUM, который анализирует их целостность. Служба "База данных SQL" заранее отслеживает и проверяет целостность данных в базе данных и при возникновении проблем устраняет их (это действие имеет наивысший приоритет). Кроме того, вы можете самостоятельно выполнять эти проверки.  Дополнительные сведения см. в записи блога [Data Integrity in Azure SQL Database](https://azure.microsoft.com/blog/data-integrity-in-azure-sql-database/) (Целостность данных в службе "База данных SQL Azure").

## <a name="data-movement-after-migration"></a>Перемещение данных после переноса

### <a name="how-do-i-export-and-import-data-as-bacpac-files-from-sql-database"></a>Как импортировать данные в виде файлов BACPAC из базы данных SQL и экспортировать в нее?

- **Экспорт.** Вы можете экспортировать базу данных SQL Azure в виде файла BACPAC на портале Azure.

   ![Экспорт базы данных](./media/sql-database-export/database-export.png)

- **Импорт.** Данные также можно импортировать в базу данных в виде файла BACPAC на портале Azure.

   ![Импорт базы данных](./media/sql-database-import/import.png)

### <a name="how-do-i-synchronize-data-between-sql-database-and-sql-server"></a>Как синхронизировать данные между службой "База данных SQL" и SQL Server?
Это можно сделать несколькими способами: 
- **[Синхронизация данных.](sql-database-sync-data.md)** Эта функция позволяет синхронизировать данные в двух направлениях между несколькими локальными базами данных SQL Server и службой "База данных SQL". Чтобы синхронизировать данные с локальными базами данных SQL Server, необходимо установить и настроить агент синхронизации на локальном компьютере и открыть исходящий TCP-порт 1433.
- **[Репликация транзакций.](https://azure.microsoft.com/blog/transactional-replication-to-azure-sql-database-is-now-generally-available/)** Функция репликации транзакций позволяет синхронизировать данные из локальной базы данных в службу "База данных SQL Azure". В этом случае локальная база данных выступает издателем, а служба "База данных SQL Azure" — подписчиком. Сейчас поддерживается только эта конфигурация. Дополнительные сведения о том, как перенести данные из локальной базы данных в SQL Azure с минимальным времен простоя см. в разделе [Метод 2. Использование репликации транзакций](sql-database-cloud-migrate.md#method-2-use-transactional-replication).

## <a name="next-steps"></a>Дополнительная информация
Узнайте больше о службе [База данных SQL](sql-database-technical-overview.md).

