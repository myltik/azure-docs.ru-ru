---
title: "Рекомендации по производительности базы данных SQL Azure | Документация Майкрософт"
description: "База данных SQL Azure предоставляет рекомендации для баз данных SQL, которые могут повысить текущую производительность запросов."
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: monicar
ms.assetid: 1db441ff-58f5-45da-8d38-b54dc2aa6145
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: On Demand
ms.date: 09/20/2017
ms.author: sstein
ms.openlocfilehash: 84706837aeb416d13dab617f51a33d62a934c016
ms.sourcegitcommit: 4ac89872f4c86c612a71eb7ec30b755e7df89722
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/07/2017
---
# <a name="performance-recommendations"></a>Рекомендации по производительности

База данных SQL Azure изучает работу приложения, адаптируется к нему и предоставляет настраиваемые рекомендации, что позволяет добиться максимальной производительности баз данных SQL. Производительность постоянно оценивается путем анализа журнала использования базы данных SQL. Предоставляемые рекомендации основаны на уникальном шаблоне рабочей нагрузки базы данных и помогают повысить ее производительность.

> [!TIP]
> [Автоматическая настройка](sql-database-automatic-tuning.md) — рекомендуемый способ настройки производительности. [Intelligent Insights](sql-database-intelligent-insights.md) — рекомендуемое средство мониторинга производительности. 
>

## <a name="create-index-recommendations"></a>Рекомендации по созданию индексов
База данных SQL Azure непрерывно отслеживает выполняемые запросы и определяет индексы, которые могут повысить производительность. После того, как система удостоверится в отсутствии определенного индекса, создается новая рекомендация **Создание индекса**. База данных SQL Azure определяет это, оценивая рост производительности, который со временем обеспечит индекс. В зависимости от предполагаемого роста производительности рекомендации классифицируются как "Высокий", "Средний" и "Низкий". 

Индексы, созданные с помощью рекомендаций, всегда помечаются флагом auto_created. Узнать, какие индексы имеют флаг auto_created, можно, просмотрев представление sys.indexes. Автоматически созданные индексы не блокируют команды ALTER и RENAME. Если вы попытаетесь удалить столбец, по которому был автоматически создан индекс, команда будет выполнена, а автоматически созданный индекс будет также удален этой командой. Обычные индексы блокируют команду ALTER или RENAME, выполняемую для индексированных столбцов.

После применения рекомендации по созданию индекса база данных SQL Azure будет сравнить производительность запросов с базовой производительностью. Если новый индекс повышает производительности, то рекомендация будет помечена как успешная и будет доступен отчет о ее результатах. В случае, если индекс не дает никаких преимуществ, его создание будет автоматически отменено. Таким образом база данных SQL Azure гарантирует, что рекомендации будут только повышать производительность базы данных.

У любой рекомендации **Создание индекса** есть политика отхода, которая не позволит применить рекомендацию, если использование DTU базы данных или пула превышало 80 % в течение последних 20 минут или использование хранилища превышает 90 %. В этом случае рекомендация будет отложена.

## <a name="drop-index-recommendations"></a>Рекомендации по удалению индексов
Помимо обнаружения недостающего индекса база данных SQL Azure постоянно анализирует производительность существующих индексов. Если индекс не используется, база данных SQL Azure порекомендует удалить его. Удаление индекса рекомендуется в двух случаях:
* индекс является дубликатом другого индекса (созданного на основе того же столбца, схемы секций и фильтров);
* индекс не используется в течение длительного времени (93 дня).

Рекомендации по удалению индексов также проходят проверку после применения. Если производительность повысилась, вам будет доступен отчет о результатах. Если будет обнаружено снижение производительности, применение рекомендации будет отменено.


## <a name="parameterize-queries-recommendations"></a>Рекомендации по параметризации запросов
Рекомендации по **параметризации запросов** появляются при наличии одного или нескольких запросов, которые постоянно перекомпилируются, но в результате для них создается одинаковый план выполнения запроса. Это условие дает возможность применить принудительную параметризацию, которая позволит кэшировать планы запросов и повторно использовать их в будущем, повышая производительность и снижая использование ресурсов. 

Каждый запрос, отправленный в SQL Server, сначала должен быть скомпилирован для формирования плана выполнения. Каждый создаваемый план добавляется в кэш планов и может быть использован повторно при последующем выполнении этого запроса, устраняя необходимость в дополнительной компиляции. 

Приложения, отправляющие запросы, которые содержат непараметризованные значения, могут привести к снижению производительности, так как для каждого такого запроса с различными значениями параметров план выполнения компилируется заново. Во многих случаях для одинаковых запросов с отличными значениями параметров создаются одинаковые планы выполнения, но эти планы по-прежнему добавляются в кэш планов по отдельности. Планы выполнения повторных операций компиляции используют ресурсы базы данных, увеличивают длительность запроса и переполняют кэш планов, что приводит к исключению планов из него. Такое поведение SQL Server можно изменить, задав параметр принудительной параметризации для базы данных. 

Чтобы было проще оценить влияние этой рекомендации, вам будет предоставлено сравнение фактического и предполагаемого потребления ресурсов ЦП (после применения рекомендации). Помимо экономии ресурсов ЦП, снизится длительность обработки запроса за счет времени, затрачиваемого на компиляцию. Кроме того, уменьшится дополнительная нагрузка на кэш планов, что позволит хранить в кэше большинство планов и повторно их использовать. Вы можете быстро и легко применить эту рекомендацию, щелкнув команду **Применить**. 

Через несколько минут после применения этой рекомендации для вашей базы будет принудительно включена параметризация и запущен мониторинг, который длится примерно 24 часа. По истечении этого периода вы сможете просмотреть отчет о проверке, содержащий информацию об использовании ресурсов ЦП для базы данных за 24 часа до и через 24 часа после применения рекомендации. Помощник по базам данных SQL имеет механизм безопасности, который автоматически отменит примененную рекомендацию в случае, если будет обнаружено снижение производительности.

## <a name="fix-schema-issues-recommendations-preview"></a>Устранение проблемы схемы рекомендации (Предварительная версия)

> [!IMPORTANT]
> Корпорация Майкрософт занимается неподдерживаемые рекомендации «Исправить проблему схемы». Необходимо начать работу с [интеллектуальной аналитики](sql-database-intelligent-insights.md) для автоматического отслеживания проблемы с производительностью базы данных, включая проблемы схемы, покрываемых ранее рекомендации «Исправить проблему схемы».
> 

Рекомендации по **устранению ошибок схемы** появляются, когда служба базы данных SQL обнаруживает аномальное количество относящихся к схеме ошибок SQL, которые возникают в вашей базе данных SQL Azure. Эта рекомендация обычно появляется, когда в базе данных возникает несколько связанных со схемой ошибок (недопустимое имя столбца, недопустимое имя объекта и т. д.) в течение часа.

"Ошибки схемы" относятся к классу синтаксических ошибок в SQL Server, которые происходят, когда определение запроса SQL и определение схемы базы данных не согласованы. Например, один из столбцов, ожидаемых запросом, может отсутствовать в целевой таблице или наоборот. 

Рекомендация по устранению ошибок схемы появляется, когда служба базы данных SQL обнаруживает аномальное количество относящихся к схеме ошибок SQL, которые возникают в базе данных SQL Azure. В следующей таблице показаны ошибки, которые относятся к схеме.

| Код ошибки SQL | Сообщение |
| --- | --- |
| 201 |Процедура или функция "*" ожидает параметр "*", который не был указан. |
| 207 |Недопустимое имя столбца "*". |
| 208 |Недопустимое имя объекта "*". |
| 213 |Имя столбца или число предоставленных значений не соответствует определению таблицы. |
| 2812 |Не удалось найти хранимую процедуру "*". |
| 8144 |Для процедуры или функции * указано слишком много аргументов. |

## <a name="next-steps"></a>Дальнейшие действия
Отслеживайте рекомендации и продолжайте применять их для повышения производительности. Рабочие нагрузки базы данных являются динамическими и меняются непрерывно. Помощник по работе с базами данных SQL продолжает отслеживать работу и давать рекомендации, которые могут повысить производительность базы данных. 

* В разделе [Автоматическая настройка](sql-database-automatic-tuning.md) описывается автоматическая настройка индексов базы данных и планов выполнения запросов.
* В разделе [Использование журнала диагностики производительности Intelligent Insights для базы данных SQL Azure](sql-database-intelligent-insights.md) описывается мониторинг производительности базы данных с помощью автоматической диагностики и анализа первопричин проблем с производительностью.
* В разделе [Использование помощника по базам данных SQL на портале Azure](sql-database-advisor-portal.md) приведены пошаговые инструкции по использованию рекомендаций по производительности на портале Azure.
* См. статью [Анализ производительности запросов базы данных Azure SQL](sql-database-query-performance.md), чтобы узнать о том, как просмотреть влияние на производительность основных запросов.


