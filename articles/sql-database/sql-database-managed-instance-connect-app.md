---
title: Подключение приложений к Управляемому экземпляру Базы данных SQL Azure | Документация Майкрософт
description: В этой статье описывается, как подключить приложение к Управляемому экземпляру Базы данных SQL.
ms.service: sql-database
author: srdjan-bozovic
manager: craigg
ms.custom: managed instance
ms.topic: article
ms.date: 04/10/2018
ms.author: srbozovi
ms.reviewer: bonova, carlrab
ms.openlocfilehash: 1eecd28d5e7043acae5cfd52edf93e8d301bd31e
ms.sourcegitcommit: 9cdd83256b82e664bd36991d78f87ea1e56827cd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
---
# <a name="connect-your-application-to-azure-sql-database-managed-instance"></a>Подключение приложения к Управляемому экземпляру Базы данных SQL

Сейчас вам доступно много вариантов для размещения приложений. 
 
Например, вы можете разместить приложение в облаке, используя Службу приложений Azure или любую службу виртуальных сетей Azure, например среду службы приложений Azure, виртуальные машины или масштабируемый набор виртуальных машин. Также можно применить гибридную схему работы с облаком, оставляя приложения в локальной среде. 
 
Независимо от выбранной схемы, вы можете подключить приложение к Управляемому экземпляру (предварительная версия).  

![Высокая доступность](./media/sql-database-managed-instance/application-deployment-topologies.png)  

## <a name="connect-an-application-inside-the-same-vnet"></a>Подключение приложений внутри одной виртуальной сети 

Это самый простой сценарий. Виртуальные машины внутри виртуальной сети могут свободно подключаться друг к другу напрямую, даже если находятся в разных подсетях. Это означает, что для подключения приложений, размещенных в среде приложений Azure или на виртуальной машине, достаточно лишь настроить строку подключения.  
 
Если в этой ситуации возникнут проблемы с подключением, проверьте, настроена ли группа безопасности сети для подсети вашего приложения. В этом сценарии необходимо открыть исходящее подключение на порт SQL 1433, а также для диапазона портов 11 000–12 000, используемых для перенаправления. 

## <a name="connect-an-application-inside-a-different-vnet"></a>Подключение приложений из другой виртуальной сети 

Этот сценарий немного сложнее, поскольку Управляемый экземпляр получает частный IP-адрес, принадлежащий его виртуальной сети. Поэтому приложению для подключения нужно получить доступ к виртуальной сети, в которой развернут Управляемый экземпляр. Сначала необходимо создать подключение между приложением и виртуальной сетью Управляемого экземпляра. Для этого сценария не обязательно размещать виртуальные сети в одной подписке. 
 
Существует два варианта подключения виртуальных сетей. 
- [Пиринговая связь между виртуальными сетями Azure](../virtual-network/virtual-network-peering-overview.md). 
- VPN-шлюз между виртуальными сетями ([портал Azure](../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md), [PowerShell](../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md), [Azure CLI](../vpn-gateway/vpn-gateway-howto-vnet-vnet-cli.md)). 
 
Лучше использовать пиринговую связь, поскольку она использует магистральную сеть корпорации Майкрософт и не добавляет существенных задержек по сравнению с подключением виртуальных машин в одной виртуальной сети. Пиринговую связь между виртуальными сетями можно применять только в пределах одного региона, но в некоторых регионах в режиме предварительной версии уже доступна пиринговая связь между регионами.  
 
> [!IMPORTANT]
> Пиринговая связь между виртуальными сетями в разных регионах не всегда обеспечит такой же уровень доступности и надежности, как в общедоступной версии. Пиринговая связь между виртуальными сетями может иметь определенные ограничения или быть недоступной в некоторых регионах Azure. Актуальные сведения о доступности и состоянии этого компонента см. на странице обновлений для  [виртуальной сети Azure](https://azure.microsoft.com/updates/?product=virtual-network). 

## <a name="connect-an-on-premises-application"></a>Подключение локального приложения 

Доступ к управляемому экземпляру возможен только по частному IP-адресу. Чтобы обратиться к нему из локальной среды, необходимо установить подключение типа "сеть — сеть" между приложением и виртуальной сетью управляемого экземпляра. 
 
Есть два способа подключить локальную сеть к виртуальной сети Azure. 
- VPN-подключение типа "сеть — сеть" ([Портал Azure](../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal.md), [PowerShell](../vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md), [Azure CLI](../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-cli.md)). 
- Подключение [ExpressRoute](../expressroute/expressroute-introduction.md).  
 
Если подключение к Azure из локальной среды установлено успешно, но вам не удается подключиться к Управляемому экземпляру, проверьте правила брандмауэра: исходящее подключение на порт SQL 1433, а также к диапазону портов 11 000–12 000 для перенаправления. 

## <a name="connect-an-azure-app-service-hosted-application"></a>Подключение приложения, размещенного в службе приложений Azure 

Доступ к Управляемому экземпляру возможен только по частному IP-адресу, а значит для доступа к нему из локальной среды необходимо установить подключение типа "сеть — сеть" между приложением и виртуальной сетью управляемого экземпляра. См. статью [Интеграция приложения с виртуальной сетью Azure](../app-service/web-sites-integrate-with-vnet.md).  
 
Сведения об устранении неполадок вы найдете [здесь](../app-service/web-sites-integrate-with-vnet.md#troubleshooting). Если соединение не удается установить, изучите статью о [синхронизации сетевой конфигурации](sql-database-managed-instance-sync-network-configuration.md). 
 
В сценарии подключения службы приложений Azure к Управляемому экземпляру следует отдельно рассмотреть интеграцию службы приложений Azure с сетью, имеющую пиринговую связь с виртуальной сетью Управляемого экземпляра. В этом случае следует дополнительно настроить следующее. 

- Виртуальная сеть Управляемого экземпляра НЕ ДОЛЖНА иметь шлюз.  
- Для виртуальной сети Управляемого экземпляра нужно настроить удаленные шлюзы. 
- Пиринговые виртуальные сети должны разрешать транзит шлюзов. 
 
Этот вариант сценария показан на схеме ниже.

![Пиринговая связь с интеграцией приложения](./media/sql-database-managed-instance/integrated-app-peering.png)
 
## <a name="connect-an-application-on-the-developers-box"></a>Подключение приложения через окно разработчика 

Доступ к Управляемому экземпляру возможен только по частному IP-адресу, а значит для доступа к нему из окна разработчика необходимо установить подключение между окном разработчика и виртуальной сетью Управляемого экземпляра.  
 
Настройка подключения типа "точка — сеть" к виртуальной сети с аутентификацией по собственным сертификатам Azure подробно описана в статьях для каждого средства: [портал Azure](../vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal.md), [PowerShell](../vpn-gateway/vpn-gateway-howto-point-to-site-rm-ps.md), [Azure CLI](../vpn-gateway/vpn-gateway-howto-point-to-site-classic-azure-portal.md).  

## <a name="next-steps"></a>Дополнительная информация

- Сведения об Управляемом экземпляре см. в [обзоре Управляемого экземпляра](sql-database-managed-instance.md).
- См. инструкцию по [созданию Управляемого экземпляра](sql-database-managed-instance-create-tutorial-portal.md).
