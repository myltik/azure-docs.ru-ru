---
title: Мониторинг использования базы данных с помощью Intelligent Insights. База данных SQL Azure | Документация Майкрософт
description: База данных SQL Azure Intelligent Insights использует встроенный аналитический механизм базы данных постоянного отслеживания использования базы данных с помощью искусственного интеллекта и обнаружения аварийных событий, снижающих производительность.
services: sql-database
author: danimir
manager: craigg
ms.reviewer: carlrab
ms.service: sql-database
ms.custom: monitor & tune
ms.topic: conceptual
ms.date: 04/01/2018
ms.author: v-daljep
ms.openlocfilehash: a911ed9777e1a63e1fc1776fb6a8c1ab98bc6820
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34647509"
---
# <a name="intelligent-insights"></a>Intelligent Insights

Intelligent Insights базы данных SQL Azure позволяет узнать, что происходит с производительностью базы данных.

Intelligent Insights использует встроенный аналитический механизм базы данных постоянного отслеживания использования базы данных с помощью искусственного интеллекта и обнаружения аварийных событий, снижающих производительность. После обнаружения выполняется подробный анализ и интеллектуальная оценка проблемы, после чего полученные результаты записываются в журнал диагностики. Эта оценка состоит из анализа первопричин проблемы с производительностью базы данных и возможных рекомендаций по повышению производительности. 

## <a name="what-can-intelligent-insights-do-for-you"></a>Что Intelligent Insights может сделать для вас?

Intelligent Insights — уникальная функция встроенного аналитического механизма Azure, который предлагает следующие возможности:

- Упреждающий мониторинг
- специализированная аналитика производительности;
- заблаговременное выявление снижения производительности базы данных;
- анализ первопричин обнаруженных проблем;
- рекомендации по повышению производительности;
- возможность развертывания сотен тысяч баз данных;
- положительное влияние на ресурсы DevOps и совокупную стоимость владения.

## <a name="how-does-intelligent-insights-work"></a>Как работает Intelligent Insights?

Intelligent Insights анализирует производительность базы данных SQL и сравнивает ее рабочую нагрузку за последний час с базовыми показателями рабочей нагрузки за последние семь дней. Рабочая нагрузка базы данных состоит из запросов, которые считаются наиболее важными для производительности базы данных, такие как наиболее повторяющиеся запросы и запросы наибольшего размера. Так как каждая база данных является уникальной ввиду своей структуры, данных, использования и назначения, все создаваемые базовые показатели рабочей нагрузки являются уникальными для каждого отдельного экземпляра. Независимо от базовых показателей рабочей нагрузки Intelligent Insights также отслеживает абсолютные рабочие пороговые значения и обнаруживает проблемы, связанные с повышенным временем ожидания, критическими исключениями и параметризацией запросов, которые могут негативно повлиять на производительность.

После обнаружения проблемы снижения производительности в нескольких наблюдаемых метриках с помощью искусственного интеллекта выполняется анализ. Его результаты записываются в журнал диагностики. Они содержат ценную аналитику по операциям с базой данных. Intelligent Insights позволяет легко отслеживать проблемы с производительностью базы данных с момента их выявления и до устранения. Каждая обнаруженная проблема отслеживается по всему жизненному циклу — от изначального обнаружения проблемы и проверки улучшения производительности до ее решения. Обновление журнала диагностики выполняется каждые 15 минут. 

![Рабочий процесс анализа производительности базы данных](./media/sql-database-intelligent-insights/intelligent-insights-concept.png)

Метрики, используемые для измерения и обнаружения проблем с производительностью базы данных, основаны на длительности запроса, запросов с истекшим временем ожидания, повышенном времени ожидания и запросах с ошибками. Дополнительные сведения о метриках см. в разделе [Метрики обнаружения](sql-database-intelligent-insights.md#detection-metrics) этого документа.

Выявленные проблемы снижения производительности базы данных SQL записываются в журнал диагностики. Эти аналитические записи состоят из следующих свойств:

| Свойство             | Сведения              |
| :------------------- | ------------------- |
| сведения о базе данных; | Метаданные базы данных, для которой была обнаружена аналитика. Например, URI ресурса. |
| Наблюдаемый диапазон времени | Время начала и окончания периода обнаруженной аналитики. |
| Затронутые метрики | Метрики, вызвавшие создание аналитики: <ul><li>Увеличение длительности запросов [с].</li><li>Повышенное время ожидания [с].</li><li>Запросы, время ожидания которых истекло [процент].</li><li>Запросы, завершившиеся сбоем [процент].</li></ul>|
| Значение последствий | Значение измеренной метрики. |
| Затронутые запросы и коды ошибок | Хэш запроса или код ошибки. Их можно легко сопоставить с затронутыми запросами. Предоставляются метрики увеличения продолжительности запросов, времени ожидания, счетчиков времени ожидания или кодов ошибок. |
| Обнаружения | Проблема обнаруживается в базе данных во время события. Существуют 15 шаблонов обнаружения. Дополнительные сведения см. в статье [Устранение проблем с производительностью базы данных SQL Azure с помощью Intelligent Insights](sql-database-intelligent-insights-troubleshoot-performance.md). |
| Анализ первопричин | Анализ первопричин обнаруженной проблемы в понятном для понимания формате. Некоторые аналитические данные могут содержать рекомендации по улучшению производительности, если это возможно. |
|||

Проблемы с производительностью, записываемые в журнал диагностики, описываются одним из трех состояний: "Active" (Активная), "Verifying" (Проверка) и "Completed" (Завершено). После обнаружения проблемы с производительностью, пока встроенный аналитический механизм базы данных SQL считает, что она не устранена, проблема помечена как "Active" (Активная). После предполагаемого устранения проблемы будет выполнена проверка и состояние проблемы изменится на "Verifying" (Проверка). После того как встроенный аналитический механизм базы данных SQL посчитает, что проблема действительно устранена, ее состояние изменится на "Complete" (Завершено).

## <a name="use-intelligent-insights"></a>Использование Intelligent Insights

Intelligent Insights представляет собой интеллектуальный журнал диагностики производительности. Его можно интегрировать и использовать с другими продуктами и специальными приложениями, например Azure Log Analytics, концентраторами событий Azure, службой хранилища Azure или сторонними продуктами. 

Как правило, Intelligent Insights и Log Analytics используются для просмотра информации через веб-браузер. Возможно, это самый простой способ приступить к работе с данным продуктом. Intelligent Insights с концентраторами событий Azure обычно используется для настройки пользовательского мониторинга и оповещений. Intelligent Insights со службой хранилища Azure обычно используется для разработки пользовательских приложений, предназначенных, например, для создания пользовательских отчетов или, быть может, для архивации и извлечения данных.

Чтобы интегрировать Intelligent Insights с другими продуктами (Azure Log Analytics, концентраторами событий Azure, службой хранилища Azure или сторонними продуктами) для передачи в них данных, нужно сначала включить ведение журнала Intelligent Insights (SQLInsights log), а затем настроить потоковую передачу данных журнала Intelligent Insights в один из этих продуктов. Дополнительные сведения о том, как включить ведение журнала Intelligent Insights и настроить потоковую передачу данных журнала в использующий их продукт, см. в разделе [Метрики и журналы диагностики базы данных SQL Azure](sql-database-metrics-diag-logging.md). 

Практические сведения об использовании Intelligent Insights с Azure Log Analytics и типичные сценарии подобного применения приведены в видео:


> [!VIDEO https://channel9.msdn.com/Shows/Azure-Friday/Get-Intelligent-Insights-for-Improving-Azure-SQL-Database-Performance/player]
>

Intelligent Insights является непревзойденным решением для обнаружения и устранения проблем производительности базы данных SQL. Чтобы устранить проблемы производительности базы данных SQL с помощью Intelligent Insights, ознакомьтесь с разделом [Устранение проблем с производительностью базы данных SQL Azure с помощью Intelligent Insights](sql-database-intelligent-insights-troubleshoot-performance.md).

## <a name="set-up-intelligent-insights-with-log-analytics"></a>Интеграция Intelligent Insights с Log Analytics 

Решение Log Analytics предоставляет возможности создания отчетов и оповещений на основе данных журнала диагностики Intelligent Insights.

Чтобы использовать Intelligent Insights с Log Analytics, настройте потоковую передачу данных журнала Intelligent Insights в Log Analytics, как описано в разделе [Метрики и журналы диагностики базы данных SQL Azure](sql-database-metrics-diag-logging.md). 

Ниже приведен пример отчета Intelligent Insights в службе "Аналитика SQL Azure":

![Отчет Intelligent Insights](./media/sql-database-intelligent-insights/intelligent-insights-azure-sql-analytics.png)

После того как для журнала диагностики Intelligent Insights настроена потоковая передача в службу "Аналитика SQL", можно выполнять [мониторинг базы данных SQL с помощью этой службы](../log-analytics/log-analytics-azure-sql.md).

## <a name="set-up-intelligent-insights-with-event-hubs"></a>Настройка Intelligent Insights с концентраторами событий

Чтобы использовать Intelligent Insights с концентраторами событий, настройте потоковую передачу данных журнала Intelligent Insights в концентраторы событий, как описано в разделе [Потоковая передача журналов диагностики Azure в пространство имен концентраторов событий](../monitoring-and-diagnostics/monitoring-stream-diagnostic-logs-to-event-hubs.md).

Сведения об использовании концентраторов событий для настраиваемого мониторинга и оповещений см. в разделе [Метрики и журналы диагностики базы данных SQL Azure](sql-database-metrics-diag-logging.md#what-to-do-with-metrics-and-diagnostics-logs-in-event-hubs). 

## <a name="set-up-intelligent-insights-with-storage"></a>Настройка Intelligent Insights с хранилищем

Чтобы использовать Intelligent Insights со службой хранилища, настройте потоковую передачу данных журнала Intelligent Insights в службу хранилища, как описано в разделе [Потоковая передача в хранилище](sql-database-metrics-diag-logging.md#stream-into-storage).

## <a name="custom-integrations-of-intelligent-insights-log"></a>Настраиваемая интеграция журнала Intelligent Insights

Чтобы использовать Intelligent Insights с инструментами сторонних производителей или для разработки настраиваемых оповещений и мониторинга, ознакомьтесь с разделом [Использование журнала диагностики производительности Intelligent Insights для базы данных SQL Azure](sql-database-intelligent-insights-use-diagnostics-log.md).

## <a name="detection-metrics"></a>Метрики обнаружения

Метрики, используемые в моделях обнаружения, создаваемых Intelligent Insights, отслеживают:

- длительность запросов;
- запросы, время ожидания которых истекло;
- повышенное время ожидания;
- запросы, завершившиеся сбоем.

Метрики длительности запросов и времени ожидания запросов используются в качестве основных моделей для обнаружения проблем, связанных с производительностью рабочей нагрузки базы данных. Причина этого состоит в том, что они непосредственно измеряют рабочую нагрузку. Для обнаружения всех возможных вариантов снижения производительности рабочей нагрузки в качестве дополнительных моделей используются метрики повышенного времени ожидания и запросов, завершенных сбоем. Это позволяет выявлять проблемы, влияющие на производительность рабочей нагрузки.

Система автоматически учитывает изменения рабочей нагрузки и числа запросов к базе данных, чтобы динамически определять нормальные и ненормальные пороговые значения производительности базы данных.

Все метрики учитываются вместе в различных сочетаниях благодаря научной модели данных, позволяющей классифицировать каждую обнаруженную проблему с производительностью. Intelligent Insight предоставляет следующие сведения:

* сведения об обнаруженной проблеме с производительностью; 
* анализ первопричин обнаруженных проблем; 
* рекомендации по улучшению производительности отслеживаемой базы данных SQL, если это возможно.

## <a name="query-duration"></a>Query duration (Длительность запросов)

Модель снижения производительности из-за повышения длительности запросов анализирует отдельные запросы и выявляет увеличение времени, необходимого для компиляции и выполнения запроса, по сравнению с базовыми показателями производительности.

Если встроенный аналитический механизм базы данных SQL обнаруживает существенное увеличение времени, затрачиваемого на компиляцию или выполнение запросов, что негативно влияет на производительность рабочей нагрузки, такие запросы помечаются как снижающие производительность из-за увеличения длительности. 

Журнал диагностики Intelligent Insights содержит хэш запроса, снижающего производительность, который указывает, связано ли это снижение с увеличением времени компиляции или выполнения запроса. Он также содержит увеличенную длительность запроса.

## <a name="timeout-requests"></a>Запросы, время ожидания которых истекло

Модель снижения производительности из-за истечения времени ожидания запросов анализирует отдельные запросы и выявляет увеличение числа случаев истечения времени ожидания на уровне выполнения запроса, а также общее число случаев истечения времени ожидания запросов на уровне базы данных по сравнению с периодом базовых показателей производительности.

Некоторые из запросов могут истекать даже до того, как достигнут этапа исполнения. Встроенный аналитический механизм базы данных SQL также измеряет и анализирует (сравнивая прерванные рабочие роли и отправленные запросы) все запросы, которые достигли базы данных, вне зависимости от того, достигли ли они этапа выполнения. 

Как только число выполненных запросов, время ожидания которых истекло, или число прерванных рабочих ролей запросов превысит системное пороговое значение, журнал диагностики заполнится ценной аналитикой.

Созданная аналитика содержит число запросов, время ожидания которых истекло. Снижение производительности связано с увеличением числа запросов, время ожидания которых истекло на этапе выполнения, или с увеличением числа запросов, время ожидания которых истекло на общем уровне базы данных. Если увеличение числа запросов, время ожидания которых истекло, является существенным для производительности базы данных, то эти запросы помечаются как снижающие производительность из-за истечения времени ожидания. 

## <a name="excessive-wait-times"></a>Повышенное время ожидания

Модель повышенного времени ожидания отслеживает отдельные запросы к базе данных. Она выявляет необычно высокие значения статистики по времени ожидания запросов, превышающие абсолютные пороговые значения, управляемые системой. Ниже приведены метрики запросов с повышенным временем ожидания, отслеживаемые с помощью нового компонента SQL Server, Query Store Wait Stats, отображающего статистику времени ожидания из хранилища запросов (sys.query_store_wait_stats):

- достижение лимитов ресурсов;
- достижение лимитов ресурсов эластичного пула;
- чрезмерное количество рабочих потоков или потоков сеансов;
- чрезмерная блокировка базы данных;
- нехватка памяти;
- прочая статистика времени ожидания.

Достижение лимитов ресурсов или лимитов ресурсов эластичных пулов означает, что потребление доступных ресурсов подписки или эластичного пула превысило абсолютный порог. Это является признаком снижения производительности рабочей нагрузки. Чрезмерное количество рабочих потоков или потоков сеансов указывает, что число инициализированных рабочих потоков или сеансов достигло абсолютного порога. Это является признаком снижения производительности рабочей нагрузки.

Чрезмерная блокировка базы данных указывает, что счетчик блокировок в базе данных достиг абсолютного порога. Эта статистика указывает на снижение производительности рабочей нагрузки. Нехватка памяти — это условие, при котором количество потоков, запрашивающих временно предоставляемый буфер памяти, достигло абсолютного порога. Эта статистика указывает на снижение производительности рабочей нагрузки.

Прочая статистика времени ожидания указывает, что различные метрики, измеряемые с помощью компонента Query Store Wait Stats, превысили абсолютное пороговое значение. Это является признаком снижения производительности рабочей нагрузки.

После обнаружения повышенного времени ожидания, в зависимости от доступных данных, в журнал диагностики Intelligent Insights записываются хэши запросов, снижающих производительность, и запросов, производительность которых понизилась. В него также добавляются сведения о метриках, выявивших запросы с повышенным временем ожидания выполнения и измеривших это время.

## <a name="errored-requests"></a>Запросы с ошибками

Модель снижения производительности из-за запросов с ошибками отслеживает отдельные запросы и выявляет увеличение количества запросов с ошибками по сравнению с периодом базовых показателей. Эта модель также отслеживает критические исключения, которые достигли абсолютных пороговых значений, которыми управляет встроенный аналитический механизм базы данных SQL. Система автоматически учитывает количество запросов к базе данных и изменения рабочей нагрузки за отслеживаемый период.

Когда измеряемое увеличение запросов с ошибками относительно общего количества выполняемых запросов становится значительным и влияет на производительность рабочей нагрузки, затронутые запросы помечаются как снижающие производительность из-за запросов с ошибками.

Журнал Intelligent Insights выводит количество запросов с ошибками. Указывает, связано ли снижение производительности с увеличением запросов с ошибками или достижением порога отслеживаемого критического исключения. Он также содержит измеренное время снижения производительности. 

Если какое-либо из отслеживаемых критических исключений превышает абсолютное пороговое значение, управляемое системой, создается ценная аналитика, содержащая сведения о критическом исключении.

## <a name="next-steps"></a>Дополнительная информация
* Узнайте, как [устранять проблемы с производительностью базы данных SQL с помощью Intelligent Insights](sql-database-intelligent-insights-troubleshoot-performance.md).
* Используйте [журнал диагностики производительности Intelligent Insights для базы данных SQL](sql-database-intelligent-insights-use-diagnostics-log.md).
* Узнайте, как [отслеживать базу данных SQL с помощью SQL Analytics](../log-analytics/log-analytics-azure-sql.md).
* Узнайте, как [собирать и использовать данные журнала из ресурсов Azure](../monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs.md).


