---
title: Отчеты по масштабируемым облачным базам данных (горизонтальное секционирование) | Документация Майкрософт
description: Используйте межбазовые запросы к базе данных для отчетов по нескольким базам данных.
services: sql-database
manager: craigg
author: MladjoA
ms.service: sql-database
ms.custom: scale out apps
ms.topic: conceptual
ms.date: 04/01/2018
ms.author: mlandzic
ms.openlocfilehash: e2393980d966d5a476a2fedf0e70b0614e803e06
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34646445"
---
# <a name="report-across-scaled-out-cloud-databases-preview"></a>Отчеты по масштабируемым облачным базам данных (предварительная версия)
С помощью [эластичных запросов](sql-database-elastic-query-overview.md)можно создавать отчеты из нескольких баз данных SQL Azure из одной точки подключения. Базы данных должны быть горизонтально секционированными (сегментированными).

Если база данных уже существует, см. статью [Перенос существующих баз данных для масштабирования](sql-database-elastic-convert-to-use-elastic-tools.md).

Чтобы узнать, какие объекты SQL требуются для выполнения запросов, см. статью [Отчеты по масштабируемым облачным базам данных (предварительная версия)](sql-database-elastic-query-horizontal-partitioning.md).

## <a name="prerequisites"></a>предварительным требованиям
Загрузите и запустите пример [Приступая к работе с инструментами эластичной базы данных](sql-database-elastic-scale-get-started.md).

## <a name="create-a-shard-map-manager-using-the-sample-app"></a>Создание диспетчера сопоставления сегментов с помощью примера приложения 
Здесь мы создадим диспетчер сопоставления сегментов вместе с несколькими сегментами, а затем выполним вставку данных в сегменты. Если вы уже знакомы с настройкой сегментов с помощью сегментированных данных, описанные ниже действия можно пропустить и перейти к следующему разделу.

1. Постройте и запустите пример приложения **Приступая к работе с инструментами эластичной базы данных** . Следуйте инструкциям до шага 7 в разделе [Загрузка и запуск примера приложения](sql-database-elastic-scale-get-started.md#download-and-run-the-sample-app). В конце шага 7 появится следующее окно командной строки:

    ![окно командной строки.][1]
2. В окне команд введите "1" и нажмите клавишу **ВВОД**. Это позволит создать диспетчер сопоставления сегментов и добавить два сегмента на сервер. Затем введите "3" и нажмите клавишу **ВВОД**. Повторите это действие четыре раза. Это позволит вставить строки демонстрационных данных в свои сегменты.
3. На [портале Azure](https://portal.azure.com) на сервере должны появиться три новые базы данных.

   ![Подтверждение Visual Studio][2]

   На этом этапе межбазовые запросы поддерживаются с помощью клиентских библиотек эластичной базы данных. Например, используйте параметр 4 в окне команд. Результатами многосегментного запроса всегда являются объединением типа **UNION ALL** результатов из всех сегментов.

   В следующем разделе мы создадим пример конечной точки базы данных, которая поддерживает расширенные запросы данных по сегментам.

## <a name="create-an-elastic-query-database"></a>Создание запросов к эластичной базе данных
1. Откройте [портал Azure](https://portal.azure.com) и войдите в систему.
2. Создайте новую базу данных Azure SQL на том же сервере, где находятся ваши сегменты. Назначьте базе данных имя ElasticDBQuery.

    ![Портал Azure и ценовая категория][3]

    > [!NOTE]
    > Можно использовать существующую базу данных. Но в данном случае база данных не должна быть одним из сегментов, в которых вы хотите выполнять свои запросы. Эта база данных будет использоваться для создания объектов метаданных для запроса к эластичной базе данных.
    >

## <a name="create-database-objects"></a>Создание объектов базы данных
### <a name="database-scoped-master-key-and-credentials"></a>Главный ключ и учетные данные для конкретной базы данных
Они используются для подключения к диспетчеру сопоставления сегментов и сегментам:

1. Откройте SQL Server Management Studio или SQL Server Data Tools в Visual Studio.
2. Подключитесь к базе данных ElasticDBQuery и выполните следующие команды T-SQL:

        CREATE MASTER KEY ENCRYPTION BY PASSWORD = '<password>';

        CREATE DATABASE SCOPED CREDENTIAL ElasticDBQueryCred
        WITH IDENTITY = '<username>',
        SECRET = '<password>';

    Имя пользователя и пароль должны быть теми же, которые использовались на шаге 6 раздела [Загрузка и запуск примера приложения](sql-database-elastic-scale-get-started.md#download-and-run-the-sample-app) в статье [Приступая к работе с инструментами эластичной базы данных](sql-database-elastic-scale-get-started.md).

### <a name="external-data-sources"></a>Внешние источники данных
Для создания внешнего источника данных выполните следующую команду в базе данных ElasticDBQuery.

    CREATE EXTERNAL DATA SOURCE MyElasticDBQueryDataSrc WITH
      (TYPE = SHARD_MAP_MANAGER,
      LOCATION = '<server_name>.database.windows.net',
      DATABASE_NAME = 'ElasticScaleStarterKit_ShardMapManagerDb',
      CREDENTIAL = ElasticDBQueryCred,
       SHARD_MAP_NAME = 'CustomerIDShardMap'
    ) ;

 CustomerIDShardMap — это имя карты сегментов, если вы создали карту сегментов и диспетчер сопоставления сегментов с помощью примера инструментов эластичной базы данных. Тем не менее, если вы использовали свои пользовательские настройки для этого примера, то это должно быть имя карты сегментов, которое было выбрано в приложении.

### <a name="external-tables"></a>Внешние таблицы
Создайте внешнюю таблицу, которая соответствует таблице Customers на сегментах, путем выполнения следующей команды в базе данных ElasticDBQuer:

    CREATE EXTERNAL TABLE [dbo].[Customers]
    ( [CustomerId] [int] NOT NULL,
      [Name] [nvarchar](256) NOT NULL,
      [RegionId] [int] NOT NULL)
    WITH
    ( DATA_SOURCE = MyElasticDBQueryDataSrc,
      DISTRIBUTION = SHARDED([CustomerId])
    ) ;

## <a name="execute-a-sample-elastic-database-t-sql-query"></a>Выполнение запроса T-SQL к примеру эластичной базы данных
После определения источника внешних данных и внешних таблиц теперь можно использовать полный T-SQL для внешних таблиц.

Выполните следующий запрос в базе данных ElasticDBQuery:

    select count(CustomerId) from [dbo].[Customers]

Следует отметить, что запрос объединяет результаты из всех сегментов и дает следующий результат:

![Сведения о выходных данных][4]

## <a name="import-elastic-database-query-results-to-excel"></a>Импорт в Excel результатов запроса к эластичной базе данных
 Результаты запроса можно импортировать в файл Excel.

1. Запустите Excel 2013.
2. Перейдите на ленту **Данные** .
3. Щелкните **Из других источников**, а затем — **Из SQL Server**.

   ![Импорт в Excel из других источников][5]
4. В **мастере подключения к данным** введите имя сервера и учетные данные для входа. Нажмите кнопку **Далее**.
5. В диалоговом окне **Выберите базу данных, содержащую нужные сведения** выберите базу данных **ElasticDBQuery**.
6. Выберите таблицу **Клиенты** в представлении списка и нажмите кнопку **Далее**. Нажмите кнопку **Готово**.
7. В форме **Импорт данных** в разделе **Выберите, как следует просматривать эти данные в книге** выберите **Таблица** и нажмите кнопку **ОК**.

Все строки из таблицы **Клиенты**, хранящиеся в различных сегментах, попадают на лист Excel.

Теперь можно использовать мощные функции Excel по визуализации данных. Для подключения к эластичной базе данных своих инструментов бизнес-аналитики и интеграции данных можно использовать строку подключения с именем сервера, именем базы данных и учетными данными. Убедитесь, что в качестве источника данных для вашего инструмента поддерживается SQL Server. На запрос к эластичной базе данных и внешние таблицы можно ссылаться таким же образом, как и на любую другую базу данных SQL Server и таблицы SQL Server, которые вы хотите подключить с помощью своего инструмента.

### <a name="cost"></a>Стоимость
За использование функции запросов к эластичной базе данных дополнительная плата отсутствует.

Сведения о ценах см. на [странице с ценами на базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/).

## <a name="next-steps"></a>Дополнительная информация

* Общие сведения об эластичных запросах см. в разделе [Обзор эластичных запросов к базе данных SQL Azure (предварительная версия)](sql-database-elastic-query-overview.md).
* Руководств по вертикальному секционированию см. в статье [Приступая к работе с межбазовыми запросами (вертикальное секционирование) (предварительная версия)](sql-database-elastic-query-getting-started-vertical.md).
* Описание синтаксиса и примеры запросов вертикально секционированных данных см. в разделе [Запрос к нескольким облачным базам данных с разными схемами (предварительная версия)](sql-database-elastic-query-vertical-partitioning.md).
* Описание синтаксиса и примеры запросов горизонтально секционированных данных см. в разделе [Отчеты по масштабируемым облачным базам данных (предварительная версия)](sql-database-elastic-query-horizontal-partitioning.md).
* В описании [sp\_execute \_remote](https://msdn.microsoft.com/library/mt703714) приведена хранимая процедура, которая выполняет инструкцию Transact-SQL для отдельной удаленной базы данных SQL Azure или набора баз данных, выступающих в качестве сегментов в схеме горизонтального секционирования.


<!--Image references-->
[1]: ./media/sql-database-elastic-query-getting-started/cmd-prompt.png
[2]: ./media/sql-database-elastic-query-getting-started/portal.png
[3]: ./media/sql-database-elastic-query-getting-started/tiers.png
[4]: ./media/sql-database-elastic-query-getting-started/details.png
[5]: ./media/sql-database-elastic-query-getting-started/exel-sources.png
<!--anchors-->
