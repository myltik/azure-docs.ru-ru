---
title: Перенос базы данных SQL Server в службу "База данных SQL Azure" с использованием DMA | Документация Майкрософт
description: Сведения о переносе базы данных SQL Server в службу "База данных SQL Azure" с использованием DMA.
services: sql-database
author: CarlRabeler
manager: craigg
ms.service: sql-database
ms.custom: mvc,migrate
ms.topic: tutorial
ms.date: 04/10/2018
ms.author: carlrab
ms.openlocfilehash: e714667183704670807fd2f62767b75f62978a38
ms.sourcegitcommit: d98d99567d0383bb8d7cbe2d767ec15ebf2daeb2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/10/2018
---
# <a name="migrate-your-sql-server-database-to-azure-sql-database-using-dma"></a>Перенос базы данных SQL Server в службу "База данных SQL Azure" с использованием DMA

Переместить базу данных SQL Server в одну базу данных службы "База данных SQL Azure" так же просто, как создать пустую базу данных SQL в Azure и импортировать базы данных в Azure с помощью средства [Помощник по миграции данных](https://www.microsoft.com/download/details.aspx?id=53595). Дополнительные сведения о возможностях миграции см. в статье о [переносе базы данных в службу "База данных SQL Azure"](sql-database-cloud-migrate.md).

> [!IMPORTANT]
> Чтобы выполнить миграцию в Управляемый экземпляр Базы данных SQL, см. статью о [миграции из SQL Server в Управляемый экземпляр](sql-database-managed-instance-migrate.md).

Из этого руководства вы узнаете, как выполнять такие задачи.

> [!div class="checklist"]
> * Создание пустой базы данных SQL Azure на портале Azure (с помощью нового или имеющегося сервера базы данных SQL Azure).
> * Создание брандмауэра на уровне сервера на портале Azure (если не создан ранее).
> * Импорт базы данных SQL в пустую базу данных SQL Azure с помощью [Data Migration Assistant](https://www.microsoft.com/download/details.aspx?id=53595) (DMA). 
> * Изменение свойств базы данных с помощью [SQL Server Management Studio](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms) (SSMS).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/), прежде чем начинать работу.

## <a name="prerequisites"></a>предварительным требованиям

Для работы с этим руководством выполните следующие предварительные требования:

- Установите последнюю версию [SQL Server Management Studio](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms) (SSMS).  
- Установите последнюю версию [Data Migration Assistant](https://www.microsoft.com/download/details.aspx?id=53595) (DMA).
- Вы должны определить базу данных, которую необходимо переместить, и иметь к ней доступ. В этом руководстве используется [база данных SQL Server 2008 R2 AdventureWorks OLTP](https://msftdbprodsamples.codeplex.com/releases/view/59211) в экземпляре SQL Server 2008 R2 или более поздней версии, но можно использовать любую базу данных по своему усмотрению. Чтобы устранить проблемы совместимости, используйте средства [SQL Server Data Tools](https://docs.microsoft.com/sql/ssdt/download-sql-server-data-tools-ssdt)

## <a name="log-in-to-the-azure-portal"></a>Войдите на портал Azure.

Войдите на [портал Azure](https://portal.azure.com/).

## <a name="create-a-blank-sql-database"></a>Создание пустой базы данных SQL

База данных Azure SQL создается с определенным набором [вычислительных ресурсов и ресурсов хранения](sql-database-service-tiers-dtu.md). База данных создается в пределах [группы ресурсов Azure](../azure-resource-manager/resource-group-overview.md) и [логического сервера базы данных SQL Azure](sql-database-features.md). 

Чтобы создать пустую базу данных SQL, выполните приведенные ниже действия. 

1. Щелкните **Создать ресурс** в верхнем левом углу окна портала Azure.

2. Выберите **Базы данных** на странице **Создание** и щелкните **Создать** в разделе **База данных SQL** на странице **Создание**.

   ![Создание пустой базы данных](./media/sql-database-design-first-database/create-empty-database.png)

3. Заполните форму базы данных SQL, указав следующую информацию, как показано на предыдущем рисунке.   

   | Параметр       | Рекомендуемое значение | ОПИСАНИЕ | 
   | ------------ | ------------------ | ------------------------------------------------- | 
   | **Database name** (Имя базы данных) | mySampleDatabase | Допустимые имена баз данных см. в статье об [идентификаторах базы данных](https://docs.microsoft.com/sql/relational-databases/databases/database-identifiers). | 
   | **Подписка** | Ваша подписка  | Дополнительные сведения о подписках см. [здесь](https://account.windowsazure.com/Subscriptions). |
   | **Группа ресурсов** | myResourceGroup | Допустимые имена групп ресурсов см. в статье о [правилах и ограничениях именования](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions). |
   | **Выбрать источник** | Пустая база данных | Указывает, что должна быть создана пустая база данных. |

4. Щелкните **Сервер**, чтобы создать и настроить новый сервер для новой базы данных. Заполните форму для **создания сервера**, указав следующую информацию. 

   | Параметр       | Рекомендуемое значение | ОПИСАНИЕ | 
   | ------------ | ------------------ | ------------------------------------------------- | 
   | **Server name** (Имя сервера) | Любое глобально уникальное имя | Допустимые имена серверов см. в статье о [правилах и ограничениях именования](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions). | 
   | **Имя для входа администратора сервера** | Любое допустимое имя | Допустимые имена входа см. в статье об [идентификаторах базы данных](https://docs.microsoft.com/sql/relational-databases/databases/database-identifiers).|
   | **Пароль** | Любой допустимый пароль | Длина пароля должна составлять минимум 8 символов. Пароль должен содержать символы трех категорий из перечисленных: прописные буквы, строчные буквы, цифры и специальные символы. |
   | **Местоположение.** | Любое допустимое расположение | Дополнительные сведения о регионах Azure см. [здесь](https://azure.microsoft.com/regions/). |

   ![Создание базы данных — сервер](./media/sql-database-design-first-database/create-database-server.png)

5. Нажмите кнопку **Выбрать**.

6. Щелкните **Ценовая категория**, чтобы указать уровень службы, число DTU и объем хранилища. Изучите доступные ресурсы для каждого уровня служб (число DTU и объем хранилища). 

7. Для работы с этим руководством выберите уровень служб **Стандартный**, а затем с помощью ползунка выберите **100 DTU (S3)** и **400** ГБ хранилища.

   ![Создание базы данных — s1](./media/sql-database-design-first-database/create-empty-database-pricing-tier.png)

8. Примите условия использования предварительной версии, чтобы использовать **дополнительное хранилище**. 

   > [!IMPORTANT]
   > - Размеры хранилища, превышающие включенный объем, доступны в предварительной версии. За их использование взимается дополнительная плата. Подробнее об этом можно узнать в статье [Стоимость использования Базы данных SQL](https://azure.microsoft.com/pricing/details/sql-database/). 
   >
   > - На уровне "Премиум" хранилище объемом свыше 1 ТБ сейчас доступно в следующих регионах: Виргиния (для обслуживания государственных организаций США), восточная Канада, восточная часть США 2, восточная Япония, Западная Европа, западная часть Соединенного Королевства, западная часть США, западная Япония, Республика Корея (центральный регион), Северная Европа, северо-центральный регион США, центральная Германия, центральная Канада, центральная Франция, центральная часть США, Юго-Восточная Азия, юго-центральный регион США, южная Бразилия и южная часть Соединенного Королевства. См. [текущие ограничения для баз данных P11–P15](sql-database-dtu-resource-limits.md#single-database-limitations-of-p11-and-p15-when-the-maximum-size-greater-than-1-tb).  
   > 

9. Выбрав уровень сервера, число DTU и объем хранилища, нажмите кнопку **Применить**.  

10. Укажите **параметры сортировки** для пустой базы данных. В этом руководстве используйте значение по умолчанию. Дополнительные сведения о параметрах сортировки см. в [этой статье](https://docs.microsoft.com/sql/t-sql/statements/collations).

11. Заполнив форму базы данных SQL, нажмите кнопку **Создать**, чтобы подготовить базу данных. Подготовка занимает несколько минут. 

12. На панели инструментов щелкните **Уведомления**, чтобы отслеживать процесс развертывания.
    
     ![уведомление](./media/sql-database-get-started-portal/notification.png)

## <a name="create-a-server-level-firewall-rule"></a>создадим правило брандмауэра на уровне сервера;

Служба базы данных SQL создает брандмауэр уровня сервера, который не позволяет внешним приложениям и средствам подключаться к серверу или любой базе данных на сервере, если не создано правило брандмауэра, открывающее брандмауэр для определенных IP-адресов. Выполните следующие действия, чтобы создать [правило брандмауэра уровня сервера базы данных SQL](sql-database-firewall-configure.md) для IP-адреса вашего клиента и разрешить внешнее подключение через брандмауэр базы данных SQL только с вашего IP-адреса. 

> [!NOTE]
> База данных SQL обменивается данными через порт 1433. Если вы пытаетесь подключиться из корпоративной сети, исходящий трафик через порт 1433 может быть запрещен сетевым брандмауэром. В таком случае вы не сможете подключиться к серверу базы данных SQL Azure, пока ваш ИТ-отдел не откроет порт 1433.
>

1. По завершении развертывания щелкните раздел **Базы данных SQL** в меню слева и выберите **mySampleDatabase** на странице **баз данных SQL**. После этого откроется страница обзора базы данных, где будет указано полное имя сервера (например, **mynewserver-20170824.database.windows.net**) и предоставлены параметры для дальнейшей настройки. 

2. Скопируйте полное имя сервера. Оно понадобится вам при работе с последующими руководствами для подключения к серверу и связанным базам данных. 

   ![Имя сервера](./media/sql-database-get-started-portal/server-name.png) 

3. Щелкните **Настройка брандмауэра для сервера** на панели инструментов. Откроется страница **параметров брандмауэра** для сервера базы данных SQL. 

   ![правило брандмауэра для сервера](./media/sql-database-get-started-portal/server-firewall-rule.png) 

4. На панели инструментов щелкните **Добавить IP-адрес клиента**, чтобы добавить текущий IP-адрес в новое правило брандмауэра. С использованием правила брандмауэра можно открыть порт 1433 для одного IP-адреса или диапазона IP-адресов.

5. Выберите команду **Сохранить**. Для текущего IP-адреса будет создано правило брандмауэра уровня сервера, с помощью которого можно открыть порт 1433 логического сервера.

6. Нажмите кнопку **ОК**, а затем закройте страницу **Параметры брандмауэра**.

Теперь можно подключиться с этого IP-адреса к серверу базы данных SQL и его базам данных с помощью SQL Server Management Studio, Data Migration Assistant или другого средства по своему усмотрению, используя учетную запись администратора сервера, созданную при выполнении предыдущей процедуры.

> [!IMPORTANT]
> По умолчанию доступ через брандмауэр базы данных SQL включен для всех служб Azure. На этой странице щелкните **Откл.**, чтобы отключить доступ для всех служб Azure.

## <a name="sql-server-connection-information"></a>Сведения о подключении SQL Server

Получите полное имя сервера для сервера базы данных SQL Azure на портале Azure. Полное имя сервера используется для подключения к серверу SQL Azure с помощью клиентских средств, в том числе Data Migration Assistance и SQL Server Management Studio.

1. Войдите на [портал Azure](https://portal.azure.com/).
2. В меню слева выберите **Базы данных SQL** и на странице **Базы данных SQL** щелкните имя своей базы данных. 
3. На странице портала Azure вашей базы данных в области **Основные компоненты** найдите и скопируйте **имя сервера**.

   ![Сведения о подключении](./media/sql-database-get-started-portal/server-name.png)

## <a name="migrate-your-database"></a>Миграция базы данных

Чтобы оценить готовность своей базы данных к переносу в базу данных SQL Azure с помощью **[Data Migration Assistant](https://www.microsoft.com/download/details.aspx?id=53595)**, выполните приведенные ниже действия и завершите перенос.

1. Откройте **Data Migration Assistant**. DMA можно запустить на любом компьютере с подключением к экземпляру SQL Server, содержащему базу данных, которую планируется перенести, и подключением к Интернету. Вам не нужно устанавливать его на компьютер, где содержится экземпляр SQL Server, который переносится. Правило брандмауэра, созданное в предыдущей процедуре, должно быть предназначено для компьютера, на котором выполняется Data Migration Assistant.

     ![Открытие Data Migration Assistant](./media/sql-database-migrate-your-sql-server-database/data-migration-assistant-open.png)

2. Чтобы создать проект **Оценка**, в меню слева щелкните **+ Создать**. Введите требуемые значения и нажмите кнопку **Создать**:

   | Параметр      | Рекомендуемое значение | ОПИСАНИЕ | 
   | ------------ | ------------------ | ------------------------------------------------- | 
   | Тип проекта | Миграция | Выберите либо оценку готовности своей базы данных для переноса, либо оценку готовности и перенос в рамках одного рабочего процесса |
   |Имя проекта|Migration tutorial (Руководство по переносу)| Описательное имя |
   |Migration tutorial (Тип исходного сервера)| SQL Server; | Это единственный поддерживаемый в настоящее время источник |
   |Target server type (Тип целевого сервера)| Базы данных SQL Azure| Можно выбрать: базу данных SQL Azure, SQL Server, SQL Server на виртуальных машинах Azure |
   |Migration Scope (Область переноса)| Схема и данные| Можно выбрать: схему и данные, только схему, только данные |
   
   ![Создание проекта в Data Migration Assistant](./media/sql-database-migrate-your-sql-server-database/data-migration-assistant-new-project.png)

3.  На странице **Выбрать источник** введите необходимые значения и нажмите кнопку **Подключиться**:

    | Параметр      | Рекомендуемое значение | ОПИСАНИЕ | 
    | ------------ | ------------------ | ------------------------------------------------- | 
    | имя сервера; | Имя или IP-адрес сервера | Имя или IP-адрес сервера |
    | Authentication type (Тип проверки подлинности) | Предпочитаемый тип проверки подлинности| Варианты: проверка подлинности Windows, проверка подлинности SQL Server, встроенная проверка подлинности Active Directory, проверка пароля Active Directory |
    | Имя пользователя | Имя для входа | Имя для входа должно иметь разрешения **CONTROL SERVER** |
    | Пароль| Ваш пароль | Ваш пароль |
    | Свойства подключения| Выберите **Шифровать соединение** и **Доверять сертификату сервера** в соответствии с требованиями вашей среды. | Выберите соответствующие свойства для подключения к серверу |

    ![новый перенос данных, выбор источника](./media/sql-database-migrate-your-sql-server-database/data-migration-assistant-source.png)

5. Выберите одну базу данных из исходного сервера для переноса в базу данных SQL Azure, а затем нажмите кнопку **Далее**. В этом руководстве используется только одна база данных.

6. На странице **Выбор цели** введите необходимые значения и нажмите кнопку **Подключиться**:

    | Параметр      | Рекомендуемое значение | ОПИСАНИЕ | 
    | ------------ | ------------------ | ------------------------------------------------- | 
    | имя сервера; | Полное имя сервера базы данных Azure | Полное имя сервера базы данных Azure из предыдущей процедуры |
    | Authentication type (Тип проверки подлинности) | проверка подлинности SQL Server | В этом руководстве описана только проверка подлинности SQL Server, но база данных SQL Azure также поддерживает встроенную аутентификацию Active Directory и проверку пароля Active Directory |
    | Имя пользователя | Имя для входа | Имя для входа должно иметь разрешения **CONTROL DATABASE** для базы данных-источника |
    | Пароль| Ваш пароль | Ваш пароль |
    | Свойства подключения| Выберите **Шифровать соединение** и **Доверять сертификату сервера** в соответствии с требованиями вашей среды. | Выберите соответствующие свойства для подключения к серверу |

    ![новый перенос данных, выбор целевого объекта](./media/sql-database-migrate-your-sql-server-database/data-migration-assistant-target.png)

7. Выберите базу данных на целевом сервере, созданном в предыдущей процедуре, и нажмите кнопку **Далее**, чтобы запустить процесс внутренней оценки схемы базы данных-источника. В этом руководстве используется только одна база данных. Обратите внимание, что уровень совместимости для этой базы данных имеет значение 140, которое является уровнем совместимости по умолчанию для всех новых баз данных в базе данных SQL Azure.

   > [!IMPORTANT] 
   > После переноса базы данных в базу данных Azure SQL можете управлять базой данных на определенном уровне совместимости в целях обратной совместимости. Дополнительные сведения о последствиях и параметрах работы базы данных с определенным уровнем совместимости см. в разделе [ALTER DATABASE (Transact-SQL) Compatibility Level](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql-compatibility-level) (Уровень совместимости ALTER DATABASE (Transact-SQL)). Кроме того, в статье [ALTER DATABASE SCOPED CONFIGURATION (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/statements/alter-database-scoped-configuration-transact-sql) вы можете получить сведения о дополнительных настройках уровня базы данных, связанных с уровнем совместимости.
   >

8. На странице **Выбор объектов** после завершения процесса внутренней оценки схемы базы данных-источника проверьте объекты, выбранные для переноса, а также объекты, содержащие проблемы. Например, проверьте объект **dbo.uspSearchCandidateResumes** на наличие изменений поведения **SERVERPROPERTY('LCID')** и объект **HumanResourcesJobCandidate** на наличие изменений полнотекстового поиска. 

   > [!IMPORTANT] 
   > В зависимости от структуры базы данных и приложения при переносе исходной базы данных может потребоваться изменить либо базу данных, либо приложение, либо и то и другое после переноса (и в некоторых случаях до переноса). Дополнительные сведения о различиях Transact-SQL, которые могут повлиять на миграцию, см. в статье [Отличия Transact-SQL базы данных SQL Azure](sql-database-transact-sql-information.md).

     ![оценка готовности к переносу данных и выбор объектов](./media/sql-database-migrate-your-sql-server-database/data-migration-assistant-assessment-results.png)

9. Щелкните **Создать скрипт SQL**, чтобы создать скрипт объектов схемы в базе данных-источнике. 
10. Проверьте созданный скрипт и щелкните **Next issue** (Следующая проблема), чтобы просмотреть идентифицированные проблемы и рекомендации. Например, для полнотекстового поиска после обновления рекомендуется тестировать приложение, используя возможности полнотекстового поиска. При необходимости можно сохранить или скопировать скрипт.

     ![новый перенос данных, сформированный скрипт](./media/sql-database-migrate-your-sql-server-database/data-migration-assistant-generated-script.png)

11. Нажмите кнопку **Deploy schema** (Развернуть схему) и наблюдайте за процессом переноса схемы.

     ![новый перенос данных, перенос схемы](./media/sql-database-migrate-your-sql-server-database/data-migration-assistant-schema-migration.png)

12. После завершения переноса схемы проверьте результаты на наличие ошибок. Если их нет, нажмите кнопку **Migrate data** (Перенести данные).
13. На странице **Выбор таблиц** проверьте таблицы, выбранные для переноса, а затем щелкните **Start data migration** (Запустить перенос данных).

     ![новый перенос данных, перенос данных](./media/sql-database-migrate-your-sql-server-database/data-migration-assistant-data-migration.png)

14. Наблюдайте за ходом процесса миграции.

     ![новый перенос данных, процесс переноса данных](./media/sql-database-migrate-your-sql-server-database/data-migration-assistant-data-migration-process.png)

## <a name="connect-to-the-database-with-ssms"></a>Подключение к базе данных с помощью SQL Server Management Studio.

Используйте [SQL Server Management Studio](https://docs.microsoft.com/sql/ssms/sql-server-management-studio-ssms) для подключения к серверу базы данных SQL Azure.

1. Откройте среду SQL Server Management Studio.

2. В диалоговом окне **Подключение к серверу** введите следующие значения.

   | Параметр       | Рекомендуемое значение | ОПИСАНИЕ | 
   | ------------ | ------------------ | ------------------------------------------------- | 
   | Тип сервера | Ядро СУБД | Это обязательное значение |
   | имя сервера; | Полное имя сервера | Имя должно быть в таком формате: **mynewserver20170824.database.windows.net**. |
   | Authentication | проверка подлинности SQL Server | В рамках работы с этим руководством мы настроили только один тип проверки подлинности — проверку подлинности SQL. |
   | Вход | Учетная запись администратора сервера | Это учетная запись, указанная при создании сервера. |
   | Пароль | Пароль учетной записи администратора сервера | Это пароль, указанный при создании сервера. |

   ![Подключение к серверу](./media/sql-database-connect-query-ssms/connect.png)

3. Щелкните **Параметры** в диалоговом окне **Подключение к серверу**. В разделе **Подключение к базе данных** введите **mySampleDatabase**, чтобы подключиться к этой базе данных.

   ![Подключение к базе данных на сервере](./media/sql-database-connect-query-ssms/options-connect-to-db.png)  

4. Щелкните **Подключить**. Откроется окно обозревателя объектов в SSMS. 

5. В обозревателе объектов разверните **базы данных**, затем выберите **mySampleDatabase**, чтобы просмотреть объекты в образце базы данных.

   ![Объекты базы данных](./media/sql-database-connect-query-ssms/connected.png)  

## <a name="change-database-properties"></a>Изменение свойств базы данных

С помощью SQL Server Management Studio можно изменить уровень служб, производительности и совместимости. Мы рекомендуем выполнять импорт в базу данных с высоким уровнем производительности для обеспечения оптимальной производительности. По завершении импорта вы можете уменьшить масштаб для сокращения расходов, пока вы не будете готовы активно использовать импортированную базу данных. При изменении уровня совместимости может повыситься производительность и станут доступны последние возможности службы базы данных SQL Azure. При перемещении старой базы данных сохраняется минимальный поддерживаемый уровень совместимости, совместимый с импортируемой базой данных. Дополнительные сведения см. в статье [Повышение производительности запросов с использованием уровня совместимости 130 в базе данных SQL Azure](sql-database-compatibility-level-query-performance-130.md).

1. В обозревателе объектов щелкните правой кнопкой мыши **mySampleDatabase** и выберите пункт **Новый запрос**. После этого откроется окно запроса, подключенное к базе данных.

2. Чтобы задать уровень служб **Стандартный** и уровень производительности **S1**.

    ```sql
    ALTER DATABASE mySampleDatabase 
    MODIFY 
        (
        EDITION = 'Standard'
        , MAXSIZE = 250 GB
        , SERVICE_OBJECTIVE = 'S1'
    );
    ```

## <a name="next-steps"></a>Дополнительная информация 
Из этого руководства вы узнали, как выполнять следующие операции:

> * Создание пустой базы данных SQL Azure на портале Azure. 
> * Создание брандмауэра на уровне сервера с помощью портала Azure. 
> * Импорт базы данных SQL в пустую базу данных SQL Azure с помощью [Data Migration Assistant](https://www.microsoft.com/download/details.aspx?id=53595) (DMA). 
> * Изменение свойств базы данных с помощью [SQL Server Management Studio](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms) (SSMS).

Перейдите к следующему руководству, чтобы узнать, как обеспечить защиту базы данных.

> [!div class="nextstepaction"]
> [Защита базы данных SQL Azure](sql-database-security-tutorial.md)


