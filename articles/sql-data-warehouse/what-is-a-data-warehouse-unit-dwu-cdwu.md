---
title: "Что такое единицы использования хранилища данных (DWU, cDWU) в хранилище данных SQL Azure? | Документация Майкрософт"
description: "Возможности масштабирования производительности в хранилище данных SQL Azure. Вы можете увеличивать масштаб, изменяя объем единиц DWU или cDWU, а также приостанавливать и возобновлять работу вычислительных ресурсов для сокращения затрат."
services: sql-data-warehouse
documentationcenter: NA
author: barbkess
manager: jhubbard
editor: 
ms.assetid: e13a82b0-abfe-429f-ac3c-f2b6789a70c6
ms.service: sql-data-warehouse
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-services
ms.custom: manage
ms.date: 11/10/2017
ms.author: jrj;barbkess
ms.openlocfilehash: 02998c48dcab5d3ed191b168665c9e47bbfbd232
ms.sourcegitcommit: 659cc0ace5d3b996e7e8608cfa4991dcac3ea129
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/13/2017
---
# <a name="data-warehouse-units-dwus-and-compute-data-warehouse-units-cdwus"></a>Единицы использования хранилища данных (DWU) и вычислительные единицы использования хранилища данных (cDWU)
В этой статье описываются единицы использования хранилища данных (DWU) и вычислительные единицы использования хранилища данных (cDWU) для хранилища данных SQL Azure. Вы также узнаете, как выбрать и изменить оптимальное количество единиц использования хранилища данных. 

## <a name="what-are-data-warehouse-units"></a>Что такое единицы использования хранилища данных?
Ресурсы ЦП хранилища данных SQL, памяти и операции ввода-вывода объединяются в единицы вычисления, которые называются единицами использования хранилища данных (DWU). Единица DWU представляет собой абстрактный, нормализованный объем вычислительных ресурсов и производительности. Изменяя уровень службы, вы можете изменить число единиц DWU, выделенных для системы, что в свою очередь влияет на производительность и стоимость использования системы. 

Стоимость производительности зависит от желаемого уровня производительности. Чтобы получить высокую производительность, вы можете увеличить количество единиц использования хранилища данных или уменьшить это количество, что скажется на уровне производительности и стоимости, соответственно. Использование хранилища и операции вычисления оплачиваются отдельно, независимо от изменений количества единиц использования хранилища данных.

Производительность единиц DWU основана на следующих метриках рабочей нагрузки хранилища данных:

- Насколько быстро стандартным запросом хранения данных сканируется большое количество строк и выполняется их сложная статистическая обработка? Это требует интенсивного использования операций ввода-вывода и ресурсов ЦП.
- Насколько быстро хранилище данных может принять данные из BLOB-объектов хранилища Azure или Azure Data Lake? Это сетевая операция, которая требует интенсивного использования ресурсов ЦП. 
- Насколько быстро с помощью команды T-SQL [CREATE TABLE AS SELECT](https://docs.microsoft.com/sql/t-sql/statements/create-table-as-select-azure-sql-data-warehouse) можно скопировать таблицу? Эта операция предусматривает чтение данных из хранилища, их распространение в различные узлы устройства и повторную запись в хранилище. Эта операция выполняется ЦП и требует интенсивного использования операций ввода-вывода и сетевых ресурсов.

При увеличении единиц DWU происходит следующее:
- линейное изменение производительности системы для операций сканирования, агрегирования и инструкций CTAS;
- увеличение количества модулей чтения и записи при загрузке с помощью PolyBase;
- увеличение максимального количества параллельных запросов и слотов выдачи.

## <a name="performance-tiers-and-data-warehouse-units"></a>Уровни производительности и единицы использования хранилища данных

Для каждого уровня производительности используются единицы измерения DWU с незначительными различиями. В счете эта разница представлена как единица масштабирования, преобразованная непосредственно в сумму к оплате.

- Уровень производительности, оптимизированный для эластичности, измеряется в единицах использования хранилища данных (DWU).
- Уровень производительности, оптимизированный для вычислений, измеряется в вычислительных единицах использования хранилища данных (cDWU). 

Эти единицы поддерживают масштабирование вверх или вниз вычислительных ресурсов, а также приостановку вычислений, когда не нужно использовать хранилище данных. Все эти операции можно использовать по запросу. Чтобы улучшить уровень производительности, оптимизированный для вычислений, на вычислительных узлах также используется локальный кэш на основе диска. При масштабировании или остановке системы кэш становится недействительным. Это значит, что для достижения оптимальной производительности требуется период подготовки кэша.  

По мере увеличения единиц использования хранилища данных вы линейно увеличивайте количество вычислительных ресурсов. Уровень производительности, оптимизированный для вычислений, обеспечивает лучшую производительность запроса и самую высокую масштабируемость, но включает высокую начальную стоимость. Этот уровень разработан для организаций, которым требуется постоянная высокая производительность. Кэш максимально используется системами на основе этого уровня. 

### <a name="capacity-limits"></a>Ограничения емкости
Для каждого сервера SQL (например, myserver.database.windows.net) предусмотрена квота [DTU (единицы передачи данных)](../sql-database/sql-database-what-is-a-dtu.md), которая позволяет применить только определенное число единиц использования хранилища данных. Дополнительные сведения см. в статье об [ограничениях емкости для управления рабочей нагрузкой](sql-data-warehouse-service-capacity-limits.md#workload-management).


## <a name="how-many-data-warehouse-units-do-i-need"></a>Сколько мне необходимо единиц использования хранилища данных?
Оптимальное количество единиц использования хранилища данных существенно зависит от рабочей нагрузки и объема данных, загруженных в систему.

Шаги для поиска оптимального количества единиц DWU рабочей нагрузки:

1. Во время разработки выберите небольшое количество единиц DWU для уровня производительности, оптимизированного для эластичности.  Выбор этого уровня производительности объясняется тем, что на этом этапе в приоритете функциональная проверка. Для начала можно выбрать DW200. 
2. Отслеживайте производительность приложения по мере загрузки тестовых данных в систему, сравнивая ее с количеством выбранных DWU.
3. Определите любые дополнительные требования для периодов пиковой активности. Если рабочая нагрузка показывает значительные пики и спады в активности, и частое масштабирование оправдано, вы можете выбрать уровень производительности, оптимизированный для эластичности.
4. Если вам нужно более 1000 DWU, выберите уровень производительности, оптимизированный для вычислений, так как он обеспечивает наилучшую производительность.

Хранилище данных SQL — это система масштабирования, с помощью которой можно подготовить большие объемы вычислительных ресурсов и большое количество запросов данных. Чтобы ознакомиться с реальными возможностями масштабирования, особенно при использовании большого количества DWU, мы рекомендуем во время масштабирования выполнить масштабирование набора данных, чтобы проверить, достаточно ли используется данных для ЦП. Для проверки масштабирования мы рекомендуем использовать как минимум 1 TБ.

> [!NOTE]
>
> Высокий уровень параллелизма только увеличивает производительность обработки запросов, если нагрузку можно разделить между вычислительными узлами. Если обнаружится, что масштабирование не влияет на производительность, вам может потребоваться настроить конструктор таблиц или запросы. Руководство по настройке запросов см. в статье [Мониторинг запросов пользователей в хранилище данных SQL Azure](sql-data-warehouse-overview-manage-user-queries.md). 

## <a name="permissions"></a>Разрешения

Чтобы изменить единицы использования хранилища данных, требуются разрешения, описанные в статье об [инструкции ALTER DATABASE][ALTER DATABASE]. 

## <a name="view-current-dwu-settings"></a>для просмотра текущих параметров DWU;

Чтобы просмотреть текущие параметры DWU, сделайте следующее:

1. Откройте обозреватель объектов SQL Server в Visual Studio.
2. Подключитесь к базе данных master, связанной с логическим сервером базы данных SQL.
3. Выберите в sys.database_service_objectives динамическое административное представление. Вот пример:  

```sql
SELECT  db.name [Database]
,       ds.edition [Edition]
,       ds.service_objective [Service Objective]
FROM    sys.database_service_objectives   AS ds
JOIN    sys.databases                     AS db ON ds.database_id = db.database_id
;
```

## <a name="change-data-warehouse-units"></a>Изменение единиц использования хранилища данных

### <a name="azure-portal"></a>Портал Azure
Чтобы изменить единицы DWU или cDWU, сделайте следующее:

1. Откройте [портал Azure](https://portal.azure.com), затем откройте нужную базу данных и щелкните **Масштаб**.

2. В колонке **Масштаб** передвиньте ползунок влево или вправо, чтобы изменить число единиц DWU.

3. Выберите команду **Сохранить**. Появится сообщение с подтверждением. Щелкните **Да** для подтверждения или **Нет** для отмены.

### <a name="powershell"></a>PowerShell
Чтобы изменить число единиц DWU или cDWU, используйте командлет PowerShell [Set-AzureRmSqlDatabase][Set-AzureRmSqlDatabase]. В приведенном ниже примере для базы данных MySQLDW, размещенной на сервере MyServer, устанавливается цель уровня обслуживания DW1000.

```Powershell
Set-AzureRmSqlDatabase -DatabaseName "MySQLDW" -ServerName "MyServer" -RequestedServiceObjectiveName "DW1000"
```

### <a name="t-sql"></a>T-SQL
С помощью команды T-SQL можно просмотреть текущие параметры DWU или cDWU, изменить их и сравнить разницу. 

Чтобы изменить параметры DWU или cDWU, сделайте следующее:

1. Подключитесь к базе данных master, связанной с логическим сервером базы данных SQL.
2. Используйте оператор TSQL [ALTER DATABASE][ALTER DATABASE]. В приведенном ниже примере для базы данных MySQLDW устанавливается цель уровня обслуживания DW1000. 

```Sql
ALTER DATABASE MySQLDW
MODIFY (SERVICE_OBJECTIVE = 'DW1000')
;
```

### <a name="rest-apis"></a>Интерфейсы API REST

Чтобы изменить число единиц DWU, используйте REST API [создания или обновления базы данных][Create or Update Database]. В приведенном ниже примере для базы данных MySQLDW, размещенной на сервере MyServer, устанавливается цель уровня обслуживания DW1000. Сервер находится в группе ресурсов Azure с именем ResourceGroup1.

```
PUT https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/{resource-group-name}/providers/Microsoft.Sql/servers/{server-name}/databases/{database-name}?api-version=2014-04-01-preview HTTP/1.1
Content-Type: application/json; charset=UTF-8

{
    "properties": {
        "requestedServiceObjectiveName": DW1000
    }
}
```


## <a name="check-status-of-dwu-changes"></a>Проверка состояния изменений единиц DWU

Изменение количества единиц DWU может занять несколько минут. При выполнении автоматического масштабирования можно реализовать логику, позволяющую приступать к выполнению другого действия только после завершения определенных операций. 

Проверка состояния базы данных с использованием различных конечных точек позволяет правильно реализовать автоматизацию этих операций. На портале отображается уведомление о завершении операции и текущее состояние баз данных, однако здесь нельзя проверять состояние программным способом. 

Вы не можете проверить состояние базы данных для операций масштабирования с помощью портала Azure.

Чтобы проверить состояние изменений DWU, сделайте следующее:

1. Подключитесь к базе данных master, связанной с логическим сервером базы данных SQL.
2. Отправьте запрос ниже, чтобы проверить состояние базы данных.


```sql
SELECT    *
FROM      sys.databases
;
```

3. Отправьте запрос ниже, чтобы проверить состояние операции.

```sql
SELECT    *
FROM      sys.dm_operation_status
WHERE     resource_type_desc = 'Database'
AND       major_resource_id = 'MySQLDW'
;
```

Это динамическое административное представление возвращает сведения о различных операциях управления хранилищем данных SQL, таких как операция и ее состояние, которое будет иметь значение IN_PROGRESS или COMPLETED.

## <a name="the-scaling-workflow"></a>Масштабирование рабочего процесса

При активации масштабирования для обеспечения согласованного состояния система сначала прерывает все открытые сеансы и выполняется откат всех открытых транзакций. Операции масштабирования можно выполнить только после завершения отката транзакций.  

- Чтобы увеличить масштаб, система подготавливает дополнительные вычислительные ресурсы, а затем повторно подключается к уровню хранения данных. 
- Чтобы уменьшить масштаб, неиспользуемые узлы в хранилище отключаются, и выполняется повторное подключение к оставшимся узлам.

## <a name="next-steps"></a>Дополнительная информация
Приведенные ниже статьи помогут вам разобраться с некоторыми дополнительными ключевыми понятиями, связанными с производительностью:

* [Управление параллелизмом и рабочей нагрузкой в хранилище данных SQL][Workload and concurrency management]
* [Общие сведения о таблицах в хранилище данных SQL][Table design overview]
* [Распределение таблиц в хранилище данных SQL][Table distribution]
* [Indexing tables in SQL Data Warehouse (Индексирование таблиц в хранилище данных SQL)][Table indexing]
* [Секционирование таблиц в хранилище данных SQL][Table partitioning]
* [Управление статистикой таблиц в хранилище данных SQL][Table statistics]
* [Рекомендации по использованию хранилища данных SQL Azure][Best practices]

<!--Image reference-->

<!--Article references-->

[capacity limits]: ./sql-data-warehouse-service-capacity-limits.md


[Check database state with T-SQL]: ./sql-data-warehouse-manage-compute-tsql.md#check-database-state-and-operation-progress
[Check database state with PowerShell]: ./sql-data-warehouse-manage-compute-powershell.md#check-database-state
[Check database state with REST APIs]: ./sql-data-warehouse-manage-compute-rest-api.md#check-database-state

[Workload and concurrency management]: ./sql-data-warehouse-develop-concurrency.md
[Table design overview]: ./sql-data-warehouse-tables-overview.md
[Table distribution]: ./sql-data-warehouse-tables-distribute.md
[Table indexing]: ./sql-data-warehouse-tables-index.md
[Table partitioning]: ./sql-data-warehouse-tables-partition.md
[Table statistics]: ./sql-data-warehouse-tables-statistics.md
[Best practices]: ./sql-data-warehouse-best-practices.md
[development overview]: ./sql-data-warehouse-overview-develop.md

[SQL DB Contributor]: ../active-directory/role-based-access-built-in-roles.md#sql-db-contributor

<!--MSDN references-->
[ALTER DATABASE]: https://msdn.microsoft.com/library/mt204042.aspx

<!--Other Web references-->
[Azure portal]: http://portal.azure.com/
