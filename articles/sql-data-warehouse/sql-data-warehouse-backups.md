---
title: 'Резервные копии в хранилище данных SQL Azure: моментальные снимки, геоизбыточные резервные копии | Документация Майкрософт'
description: Ознакомьтесь с дополнительными сведениями о встроенной архивации хранилища данных SQL, которая позволяет восстановить хранилище данных SQL Azure до точки восстановления или в другом географическом регионе.
services: sql-data-warehouse
documentationcenter: ''
author: barbkess
manager: jhubbard
editor: ''
ms.assetid: b5aff094-05b2-4578-acf3-ec456656febd
ms.service: sql-data-warehouse
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.custom: backup-restore
ms.date: 10/23/2017
ms.author: jrj;barbkess
ms.openlocfilehash: 159a1d34caba829750da33dbc4ad403fb21cd147
ms.sourcegitcommit: 48ab1b6526ce290316b9da4d18de00c77526a541
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2018
ms.locfileid: "30198422"
---
# <a name="backup-and-restore-in-sql-data-warehouse"></a>Резервное копирование и восстановление в хранилище данных SQL
В этой статье рассматриваются особенности резервных копий хранилища данных SQL. Используйте резервные копии хранилища данных для восстановления моментального снимка базы данных в основном регионе или выполните восстановление геоархива в регион, связанный с георегионом. 

## <a name="what-is-a-data-warehouse-backup"></a>Что такое резервная копия хранилища?
Резервная копия хранилища данных — это копия базы данных, которую можно использовать для восстановления хранилища данных.  Так как хранилище данных SQL является распределенной системой, резервная копия хранилища данных состоит из множества файлов, которые размещаются в службе хранилища Azure. Резервная копия хранилища данных включает локальные моментальные снимки базы данных и геоархивы всех баз данных и файлов, связанных с хранилищем данных. 

## <a name="local-snapshot-backups"></a>Резервные копии локальных моментальных снимков
С помощью хранилища данных SQL в течение дня создаются моментальные снимки хранилища данных. Эти моментальные снимки доступны в течение семи дней. Хранилище данных SQL поддерживает восьмичасовую целевую точку восстановления (RPO). Вы можете восстановить хранилище данных в основном регионе до любого из моментальных снимков, доступных за последние семь дней.

Чтобы узнать, когда был создан последний моментальный снимок, выполните этот запрос к хранилищу данных SQL, подключенному к сети. 

```sql
select   top 1 *
from     sys.pdw_loader_backup_runs 
order by run_id desc
;
```

## <a name="geo-backups"></a>Геоархивы
Хранилище данных SQL выполняет геоархивацию один раз в день в [сопряженный центр обработки данных](../best-practices-availability-paired-regions.md). Целевая точка восстановления для геовосстановления составляет 24 часа. Вы можете восстановить геоархив на сервере в регионе, связанном с георегионом. Геоархивация гарантирует, что вы сможете восстановить хранилище данных даже при отсутствии доступа к моментальным снимкам, размещенным в основном регионе.

Выполнение геоархивации задано по умолчанию. Если хранилище данных оптимизировано для эластичности, при необходимости вы можете [отказаться от геоархивации](/powershell/module/azurerm.sql/set-azurermsqldatabasegeobackuppolicy). Если же уровень производительности оптимизирован для вычислений, вы не можете отказаться от геоархивации.

## <a name="backup-costs"></a>Оплата резервного копирования
Можно заметить, что в счете на оплату Azure содержится строка для хранилища Azure класса Premium и геоизбыточного хранилища. Плата за использование хранилища класса Premium представляет собой общую стоимость хранения данных в основном регионе, в котором также хранятся моментальные снимки.  Плата за использование геоизбыточного хранилища охватывает стоимость хранения геоархивов.  

Общая стоимость основного хранилища данных и моментальных снимков больших двоичных объектов Azure за последние семь дней округляется до ближайшего терабайта. Например, если объем хранилища данных составляет 1,5 ТБ, а под моментальные снимки задействовано 100 ГБ, плата взимается за 2 ТБ данных по тарифам хранилища Azure класса Premium. 

> [!NOTE]
> Все моментальные снимки изначально пустые, их размер увеличивается по мере внесения изменений в основное хранилище данных. Размер всех моментальных снимков увеличивается по мере внесения изменений в хранилище данных. Таким образом, стоимость хранения моментальных снимков увеличивается пропорционально внесенным изменениям.
> 
> 

При использовании геоизбыточного хранилища плата за хранилище взимается отдельно. Геоизбыточное хранилище оплачивается по стандартному тарифу для географически избыточного хранилища с доступом на чтение (RA-GRS).

Ознакомиться с ценами на хранилище данных SQL можно [здесь](https://azure.microsoft.com/pricing/details/sql-data-warehouse/).

## <a name="snapshot-retention-when-a-data-warehouse-is-paused"></a>Срок хранения моментальных снимков, если приостановлена работа хранилища данных
Хранилище данных SQL не создает и не удаляет моментальные снимки по истечении периода хранения, пока работа хранилища данных приостановлена. Срок жизни моментальных снимков не изменяется, пока работа хранилища данных приостановлена. Срок хранения моментальных снимков соответствует количеству дней, в течение которых хранилище данных находится в оперативном режиме, а не количеству календарных дней.

Например, если моментальный снимок был сделан 1 октября в 16:00, а работа хранилища данных приостановлена 3 октября в 16:00, длительность хранения этого моментального снимка составляет не более двух дней. Когда хранилище данных снова перейдет в оперативный режим, длительность хранения моментального снимка на этот момент будет составлять два дня. Если хранилище данных возобновит работу 5 октября в 16:00, двухдневный моментальный снимок будет храниться еще пять дней.

Когда хранилище данных снова перейдет в оперативный режим, хранилище данных SQL возобновит создание новых моментальных снимков и удаление снимков со сроком хранения более семи дней.

## <a name="can-i-restore-a-dropped-data-warehouse"></a>Можно ли восстановить удаленное хранилище данных?
При удалении хранилища данных с помощью хранилища данных SQL создается конечный моментальный снимок, который хранится в течение семи дней. Вы можете восстановить хранилище данных до последней точки восстановления, созданной при удалении. 

> [!IMPORTANT]
> Когда вы удаляете экземпляр логического сервера SQL Server, все относящиеся к этому экземпляру базы данных также удаляются без возможности восстановления. Удаленный сервер восстановить невозможно.
> 

## <a name="next-steps"></a>Дополнительная информация
Подробные сведения о восстановлении хранилища данных SQL см. в статье [Восстановление хранилища данных SQL Azure (обзор)](sql-data-warehouse-restore-database-overview.md).

Сведения об обеспечении непрерывности бизнес-процессов см. в [этом обзоре](../sql-database/sql-database-business-continuity.md).
