---
title: Доступ к данным в хранилище данных SQL Azure из базы данных SQL Azure с помощью эластичных запросов | Документация Майкрософт
description: Ознакомьтесь с рекомендациями для получения доступа к данным в хранилище данных SQL Azure из базы данных SQL Azure с помощью эластичных запросов.
services: sql-data-warehouse
author: hirokib
manager: craigg-msft
ms.service: sql-data-warehouse
ms.topic: conceptual
ms.component: implement
ms.date: 04/11/2018
ms.author: elbutter
ms.reviewer: igorstan
ms.openlocfilehash: ceda0399ae98e2a36fd41b954a741e0379c77fe7
ms.sourcegitcommit: fa493b66552af11260db48d89e3ddfcdcb5e3152
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2018
ms.locfileid: "31797164"
---
# <a name="best-practices-for-using-elastic-query-in-azure-sql-database-to-access-data-in-azure-sql-data-warehouse"></a>Рекомендации по использованию эластических запросов в базе данных SQL Azure для получения доступа к данным в хранилище данных SQL Azure
Ознакомьтесь с рекомендациями для получения доступа к данным в хранилище данных SQL Azure из базы данных SQL Azure с помощью эластичных запросов. 

## <a name="what-is-an-elastic-query"></a>Обзор эластичных запросов
Эластичный запрос позволяет создать запрос в базе данных SQL Azure, который отправляется удаленно в хранилище данных SQL Azure, с помощью T-SQL и внешних таблиц. Использование этой функции обеспечивает уменьшение расходов и более совершенную архитектуру в зависимости от сценария.

Эта функция включает два основных варианта:

1. Изоляция домена.
2. Удаленное выполнение запросов.

### <a name="domain-isolation"></a>Изоляция домена

Изоляция домена относится к классическому сценарию киоска данных. В некоторых сценариях может потребоваться предоставить логический домен данных подчиненным пользователям, изолированным от остальной части хранилища данных, по ряду причин, включая следующие, но не ограничиваясь ими.

1. Изоляция ресурсов. База данных SQL оптимизирована для обслуживания большой базы параллельных пользователей, обслуживающей рабочие нагрузки, которые слегка отличаются от больших аналитических запросов, для которых зарезервировано хранилище данных. Изоляция обеспечивает обработку нужных рабочих нагрузок с помощью правильных инструментов.
2. Обеспечение защиты путем изоляции предусматривает выборочное отделение авторизованного подмножества данных через определенные схемы.
3. При изолировании в песочнице вы получаете образец набора данных, в котором можно экспериментировать и изучать производственные запросы и т. д.

Эластичный запрос упрощает выбор подмножества данных хранилища данных SQL и их перемещение в экземпляр базы данных SQL. Кроме того, эта изоляция не исключает возможности включения удаленного выполнения запросов, что позволяет использовать более интересные сценарии с кэшем.

### <a name="remote-query-execution"></a>Удаленное выполнение запросов

Эластичный запрос позволяет реализовать удаленное выполнение запроса в экземпляре хранилища данных SQL. Вы можете использовать преимущества как базы данных SQL, так и хранилища данных SQL, разделив "горячие" и "холодные" данные между двумя базами данных. Пользователи могут хранить более свежие данные в базе данных SQL, с помощью которой можно формировать отчеты и обслуживать большое количество обычных бизнес-пользователей. Однако, когда требуется больше данных или вычислений, пользователь может разгрузить часть запроса в экземпляр хранилища данных SQL, где крупномасштабные вычисления могут обрабатываться намного быстрее и эффективнее.

## <a name="elastic-query-process"></a>Обработка эластичных запросов
Эластичные запросы можно использовать для предоставления доступа к данным, расположенным в хранилище данных SQL, для экземпляров базы данных SQL. Эластичный запрос позволяет запросам из базы данных SQL ссылаться на таблицы в удаленном экземпляре хранилища данных SQL. 

Сначала нужно создать определение внешнего источника данных, относящееся к экземпляру хранилища данных SQL, который использует имеющиеся учетные данные пользователя в хранилище данных SQL. Удаленный экземпляр хранилища данных SQL не требует никаких изменений. 

> [!IMPORTANT] 
> 
> Требуется наличие разрешения ALTER ANY EXTERNAL DATA SOURCE. Это разрешение включено в разрешение ALTER DATABASE. Для обращения к удаленным источникам данных необходимы разрешения ALTER ANY EXTERNAL DATA SOURCE.

Затем создайте определение удаленной внешней таблицы в экземпляре базы данных SQL, который указывает на удаленную таблицу в хранилище данных SQL. При применении запроса, использующего внешнюю таблицу, часть запроса, относящаяся к внешней таблице, отправляется в экземпляр хранилища данных SQL для обработки. После завершения запроса результирующий набор отправляется обратно в вызывающий экземпляр базы данных SQL. Краткое руководство по настройке эластичного запроса между базой данных SQL и хранилищем данных SQL см. в статье [Configure Elastic Query with SQL Data Warehouse][Configure Elastic Query with SQL Data Warehouse] (Настройка эластичного запроса с хранилищем данных SQL).

Дополнительные сведения об эластичных запросах с базой данных SQL см. в статье [Обзор эластичных запросов к базе данных SQL Azure (предварительная версия)][Azure SQL Database elastic query overview].

## <a name="best-practices"></a>Рекомендации
С помощью этих рекомендаций можно использовать эластичный запрос более эффективно.

### <a name="general"></a>Общие сведения

- При использовании удаленного выполнения запроса убедитесь, что выбраны только нужные столбцы и применяются правильные фильтры. Ошибки не только увеличивают объем необходимых вычислений, но также увеличивают и объем результатов и, следовательно, объем данных, которые необходимо перемещать между двумя экземплярами.
- Обеспечивайте наличие данных для аналитических целей как в хранилище данных SQL, так и в базе данных SQL в кластерном columnstore для повышения производительности аналитических вычислений.
- Убедитесь, что исходные таблицы секционированы для запросов и перемещения данных.
- Убедитесь, что экземпляры базы данных SQL, используемые в качестве кеша, разбиты на разделы. Таким образом вы обеспечите детализированные обновления и упростите управление. 
- В идеале используйте базы данных PremiumRS, так как они предоставляют аналитические преимущества кластеризованного индексирования columnstore, сфокусированы на рабочих нагрузках с интенсивными операциями ввода-вывода и более экономичны по сравнению с базами данных уровня "Премиум".
- Используйте нагрузку или эффективные столбцы идентификации даты для выполнения вставки в экземпляры базы данных SQL и обеспечения целостности между кэшем и источником после загрузки. 
- Создайте отдельные имя пользователя и пользователя в экземпляре хранилища данных SQL для своих учетных данных удаленного доступа к базе данных SQL, определенных во внешнем источнике данных. 

### <a name="elastic-querying"></a>Эластичное выполнение запросов

- Во многих случаях может возникнуть потребность в управлении типом растянутой таблицы, часть которой находится в базе данных SQL в виде кэшированных данных (что обеспечивает более высокую производительность), а остальная часть данных хранится в хранилище данных SQL. В базе данных SQL необходимо иметь два объекта: внешнюю таблицу, которая ссылается на базовую таблицу в хранилище данных SQL, и кэшированную часть таблицы. Рекомендуем создать представление поверх кэшированной части таблицы и внешней таблицы, которая объединяет обе их и применяет фильтры, которые разделяют данные, материализованные в базе данных и хранилище данных SQL через внешние таблицы.

  Представьте, что надо сохранить данные за последний год в экземпляре базы данных SQL. Таблица **ext.Orders** ссылается на таблицы заказов хранилища данных. Таблица **dbo.Orders** содержит данные за последние годы в экземпляре базы данных SQL. Вместо того чтобы просить пользователей выбрать таблицу для запроса, создайте общее представление обеих таблиц в точке раздела за последний год.

  ```sql
  CREATE VIEW dbo.Orders_Elastic AS
  SELECT 
    [col_a]     
  , [col_b]         
  , ...
  , [col_n]
  FROM
    [dbo].[Orders]
  WHERE 
    YEAR([o_orderdate]) >= '<Most Recent Year>'
  UNION
  SELECT 
    [col_a]     
  , [col_b]         
  , ...
  , [col_n]         
  FROM
    [ext].[Orders]
  WHERE
    YEAR([o_orderdate]) < '<Most Recent Year>'
  ```

  Представление, созданное таким образом, позволяет компилятору запросов определить, нужно ли использовать экземпляр хранилища данных для ответа на ваш запрос пользователя. 

  С каждым эластичным запросом к экземпляру хранилища данных связано ограничение на отправку, компиляцию, запуск и перемещение данных. Помните, что каждый эластичный запрос занимает слоты выдачи и использует ресурсы.  


- Если планируется использовать еще больше результатов из экземпляра хранилища данных, то попробуйте сохранить их во временной таблице в базе данных SQL для поддержки нужного уровня производительности и эффективного использования ресурсов.

### <a name="moving-data"></a>Перемещение данных 

- По возможности упростите управление данными с помощью инкрементируемых исходных таблиц, чтобы упростить поддержку обновлений между хранилищем данных и экземплярами базы данных.
- Переместите данные на уровне разделов с освобождением и заполните семантику, чтобы минимизировать затраты на запрос на уровне хранилища данных и количество перемещаемых данных для обновления экземпляра базы данных. 

### <a name="when-to-choose-azure-analysis-services-vs-sql-database"></a>Azure Analysis Services и база данных SQL

Используйте Azure Analysis Services в следующих ситуациях:

- Вы планируете использовать кэш с инструментом бизнес-аналитики, который передает большое количество небольших запросов.
- Требуется ответ на запрос с задержкой в долю секунды.
- Вы имеете опыт разработки моделей для служб Analysis Services или управления ими. 

Используйте базу данных SQL Azure в следующих ситуациях:

- Требуется запросить данные кэша с помощью SQL.
- Требуется удаленное выполнение некоторых запросов.
- Требуется большой кеш.

## <a name="faq"></a>Часто задаваемые вопросы

Вопрос. Можно ли использовать базы данных в пуле эластичных баз данных с эластичным запросом?

Ответ. Да. Базы данных SQL в эластичном пуле могут использовать эластичный запрос. 

Вопрос. Существует ли ограничение на количество баз данных, которые можно использовать в эластичном запросе?

Ответ. Жесткого ограничения на количество баз данных, которые можно использовать в эластичном запросе, нет. Однако к каждому эластичному запросу (запросы в хранилище данных SQL) применяется обычное ограничение параллелизма.

Вопрос. Существует ли ограничение на единицы передачи данных, которые можно использовать в эластичном запросе.

Ответ. Ограничения на единицы передачи данных не накладываются отдельно на эластичный запрос. Логические серверы имеют ограничения на единицы передачи данных во избежание случайного превышения затрат клиентов. Если вы включаете несколько баз данных для эластичного запроса вместе с экземпляром хранилища данных SQL, вы можете неожиданно достичь ограничения. В этом случае отправьте запрос на увеличение лимита единиц передачи данных на своем логическом сервере. Вы можете увеличить квоту, [отправив запрос в службу поддержки](https://docs.microsoft.com/azure/sql-data-warehouse/sql-data-warehouse-get-started-create-support-ticket) и указав *Квота* в качестве типа запроса.

Вопрос. Могу ли я использовать безопасность на уровне строк или динамическое маскирование данных в эластичных запросах?

Ответ. Клиенты, которые хотят использовать более сложные функции безопасности с помощью базы данных SQL, могут сделать это. Для этого им нужно сперва переместить и сохранить данные в базе данных SQL. Сейчас невозможно применить безопасность на уровне строк или динамическое маскирование данных при запросе данных через внешние таблицы. 

Вопрос.Можно ли записывать данные из экземпляра базы данных SQL в экземпляр хранилища данных?

Ответ. Сейчас такая возможность не поддерживается. Если вы хотели бы, чтобы эта возможность была реализована в будущем, перейдите на нашу [страницу отзывов][Feedback page], чтобы создать эту функцию или проголосовать за нее. 

Вопрос. Можно ли использовать пространственные типы, такие как геометрия и география?

Ответ. Пространственные типы можно хранить в хранилище данных SQL как значения varbinary(max). При обращении к этим столбцам с помощью эластичного запроса их можно преобразовать в соответствующие типы во время выполнения.

![пространственные типы](./media/sql-data-warehouse-elastic-query-with-sql-database/geometry-types.png)

<!--Article references-->

[SQL Data Warehouse development overview]: sql-data-warehouse-overview-develop.md
[Configure Elastic Query with SQL Data Warehouse]: tutorial-elastic-query-with-sql-datababase-and-sql-data-warehouse.md
[Feedback Page]: https://feedback.azure.com/forums/307516-sql-data-warehouse
[Azure SQL Database elastic query overview]: ../sql-database/sql-database-elastic-query-overview.md


