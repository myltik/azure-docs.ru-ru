---
title: Фильтрация подключений по протоколу IP в Центре Интернета вещей Azure | Документация Майкрософт
description: Сведения об использовании фильтрации IP-адресов для блокирования подключений к Центру Интернета вещей Azure с определенных IP-адресов. Вы можете блокировать подключения с отдельных IP-адресов или их диапазонов.
author: BeatriceOltean
manager: ''
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 05/23/2017
ms.author: boltean
ms.openlocfilehash: fa44fd21eadb910ce90523b46332505c7303751e
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34635973"
---
# <a name="use-ip-filters"></a>Использование фильтрации IP-адресов

Безопасность является важным аспектом любого решения Интернета вещей на базе Центра Интернета вещей Azure. Иногда при настройке системы безопасности необходимо явно указать IP-адреса, с которых могут подключаться устройства. Функция _фильтрации IP-адресов_ позволяет настроить правила для отклонения или приема трафика с определенных IPv4-адресов.

## <a name="when-to-use"></a>Сценарии использования

Есть два конкретных варианта применения этой функции, когда рекомендуется заблокировать конечные точки Центра Интернета вещей для определенных IP-адресов:

- Центр Интернета вещей должен принимать трафик только из определенного диапазона IP-адресов и отклонять весь остальной трафик. Допустим, что Центр Интернета вещей используется в сочетании с [Azure Express Route] для создания частных подключений между Центром Интернета вещей и локальной инфраструктурой.
- В этом случае требуется отклонять трафик с IP-адресов, которые были определены администратором Центра Интернета вещей как подозрительные.

## <a name="how-filter-rules-are-applied"></a>Применение правил фильтрации

Правила фильтрации IP-адресов применяются на уровне службы Центра Интернета вещей. Поэтому они действуют для всех подключений с устройств и внутренних приложений, использующих любые поддерживаемые протоколы.

При попытке подключения с IP-адреса, который соответствует правилу отклонения IP-адресов в Центре Интернета вещей, пользователь получает сообщение об ошибке с кодом состояния 401 (Не авторизовано) и описанием. В ответном сообщении не указывается правило фильтрации IP-адресов.

## <a name="default-setting"></a>Значение по умолчанию

По умолчанию раздел **Фильтрация IP-адресов** на портале для Центра Интернета вещей пуст. Этот означает, что по умолчанию ваш центр принимает подключения с любых IP-адресов. То есть, такое значение параметра по умолчанию равноценно правилу, которое принимает диапазон IP-адресов 0.0.0.0/0.

![Параметры фильтрации IP-адресов по умолчанию для Центра Интернета вещей][img-ip-filter-default]

## <a name="add-or-edit-an-ip-filter-rule"></a>Добавление или изменение правила фильтрации IP-адресов

При добавлении правила фильтрации IP-адресов требуется ввести следующие значения:

- **Название правила фильтрации IP-адресов** должно быть уникальной строкой с буквами и цифрами длиной до 128 знаков, регистр не учитывается. Допускаются только 7-разрядные буквы и цифры ASCII, а также `{'-', ':', '/', '\', '.', '+', '%', '_', '#', '*', '?', '!', '(', ')', ',', '=', '@', ';', '''}`.
- В качестве **действия** для правила фильтрации IP-адресов выберите **Отклонить** или **Принять**.
- Укажите один IPv4-адрес или блок IP-адресов в нотации CIDR. Например, в нотации CIDR 192.168.100.0/22 обозначает диапазон из 1024 IPv4-адресов от 192.168.100.0 до 192.168.103.255.

![Добавление правила фильтрации IP-адресов в Центр Интернета вещей][img-ip-filter-add-rule]

После сохранения правила отображается предупреждение о том, что выполняется обновление.

![Уведомление о сохранении правила фильтрации IP-адресов][img-ip-filter-save-new-rule]

Параметр **Добавить** становится неактивным, когда достигается максимальное число правил фильтрации IP-адресов (10).

Чтобы изменить существующее правило, дважды щелкните строку с этим правилом.

> [!NOTE]
> Отклонение IP-адресов может препятствовать взаимодействию других служб Azure (таких как Azure Stream Analytics, Виртуальные машины Azure или обозреватель устройств на портале) с Центром Интернета вещей.

> [!WARNING]
> Если для чтения сообщений из Центра Интернета вещей с включенной IP-фильтрацией вы используете Azure Stream Analytics (ASA), укажите в строке подключения ASA совместимые с концентратором событий имя и конечную точку.

## <a name="delete-an-ip-filter-rule"></a>Удаление правила фильтрации IP-адресов

Чтобы удалить правило фильтрации IP-адресов, выберите одно или несколько правил из списка и нажмите кнопку **Удалить**.

![Удаление правила фильтрации IP-адресов в Центре Интернета вещей][img-ip-filter-delete-rule]

## <a name="ip-filter-rule-evaluation"></a>Оценка правила фильтрации IP-адресов

Правила фильтрации IP-адресов применяются по порядку, поэтому первое правило, которое соответствует IP-адресу, определяет действие (принять или отклонить).

Например, если вы хотите, чтобы адреса в диапазоне 192.168.100.0/22 принимались, а все остальные отклонялись, то первым правилом в списке должно быть именно правило о приеме трафика из диапазона адресов 192.168.100.0/22. Следующим должно быть правило об отклонении всех адресов; для этого используется диапазон 0.0.0.0/0.

Последовательность правил фильтрации IP-адресов в списке можно изменить. Для этого щелкните три вертикальные точки в начале строки и воспользуйтесь функцией перетаскивания.

Чтобы сохранить новую последовательность, нажмите кнопку **Сохранить**.

![Изменение порядка правил фильтрации IP-адресов в Центре Интернета вещей][img-ip-filter-rule-order]

## <a name="next-steps"></a>Дополнительная информация

Для дальнейшего изучения возможностей Центра Интернета вещей см. следующие статьи:

- [Мониторинг операций][lnk-monitor]
- [Метрики Центра Интернета вещей][lnk-metrics]

<!-- Images -->
[img-ip-filter-default]: ./media/iot-hub-ip-filtering/ip-filter-default.png
[img-ip-filter-add-rule]: ./media/iot-hub-ip-filtering/ip-filter-add-rule.png
[img-ip-filter-save-new-rule]: ./media/iot-hub-ip-filtering/ip-filter-save-new-rule.png
[img-ip-filter-delete-rule]: ./media/iot-hub-ip-filtering/ip-filter-delete-rule.png
[img-ip-filter-rule-order]: ./media/iot-hub-ip-filtering/ip-filter-rule-order.png


<!-- Links -->

[IoT Hub developer guide]: iot-hub-devguide.md
[Azure Express Route]:  https://azure.microsoft.com/documentation/articles/expressroute-faqs/#supported-services

[lnk-monitor]: iot-hub-operations-monitoring.md
[lnk-metrics]: iot-hub-metrics.md
