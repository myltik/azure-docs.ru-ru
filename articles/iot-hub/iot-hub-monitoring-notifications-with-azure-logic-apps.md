---
title: Удаленный мониторинг и отправка уведомлений в Центре Интернета вещей с помощью Azure Logic Apps | Документация Майкрософт
description: Azure Logic Apps можно использовать для мониторинга температуры в Центре Интернета вещей и автоматической отправки уведомлений на электронную почту в случае обнаружения аномалий.
author: rangv
manager: ''
keywords: мониторинг Центра Интернета вещей, уведомления Центра Интернета вещей, мониторинг температуры в Центре Интернета вещей
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.tgt_pltfrm: arduino
ms.date: 04/11/2018
ms.author: rangv
ms.openlocfilehash: e59577e99114f1b2061a2f9075976da3f0b1811f
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34634460"
---
# <a name="iot-remote-monitoring-and-notifications-with-azure-logic-apps-connecting-your-iot-hub-and-mailbox"></a>Удаленный мониторинг и отправка уведомлений в Центре Интернета вещей с помощью службы Azure Logic Apps, обеспечивающей подключение между Центром Интернета вещей и почтовым ящиком

![Комплексная схема](media/iot-hub-get-started-e2e-diagram/7.png)

[!INCLUDE [iot-hub-get-started-note](../../includes/iot-hub-get-started-note.md)]

Azure Logic Apps позволяет автоматизировать процессы в виде последовательности действий. Приложение логики поддерживает подключение к различным службам по различным протоколам. Сначала в нем срабатывает триггер, например "При добавлении учетной записи", а затем выполняется набор действий, например "отправка push-уведомления". Благодаря этой функции Logic Apps, помимо прочего, идеально подходит для мониторинга Центра Интернета вещей, например оповещения об аномалиях.

## <a name="what-you-learn"></a>Что вы узнаете

Вы научитесь создавать приложение логики, обеспечивающее подключение между Центром Интернета вещей и почтовым ящиком для мониторинга температуры и отправки уведомлений. Когда температура превышает 30 °C, клиентское приложение добавляет отметку `temperatureAlert = "true"` в сообщение, которое оно отправляет в Центр Интернета вещей. Сообщение активирует отправку приложением логики уведомления по электронной почте.

## <a name="what-you-do"></a>Что нужно сделать

* Создадим пространство имен служебной шины и добавим в него очередь.
* Добавим конечную точку и правило маршрутизации в Центр Интернета вещей.
* Создадим, настроим и протестируем приложение логики.

## <a name="what-you-need"></a>Необходимые элементы

* Изучите руководство [Настройка вашего устройства](iot-hub-raspberry-pi-kit-node-get-started.md), где описаны следующие требования.
  * Активная подписка Azure.
  * Центр Интернета вещей Azure в подписке;
  * клиентское приложение, которое отправляет сообщения в Центр Интернета вещей Azure.

## <a name="create-service-bus-namespace-and-add-a-queue-to-it"></a>Создание пространства имен служебной шины и добавление в него очереди

### <a name="create-a-service-bus-namespace"></a>Создание пространства имен служебной шины

1. На [портале Azure](https://portal.azure.com/) выберите **Создать ресурс** > **Интеграция Enterprise** > **Служебная шина**.
1. Введите следующие сведения:

   **Имя**. Имя служебной шины.

   **Ценовая категория**. Щелкните **Базовая** > **Выбрать**. Базового уровня для данного учебника достаточно.

   **Группа ресурсов**. Выберите ту же группу ресурсов, которую использует Центр Интернета вещей.

   **Расположение**. Выберите то же расположение, которое используется для Центра Интернета вещей.
1. Нажмите кнопку **Создать**.

   ![Создание пространства имен служебной шины с помощью портала Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/1_create-service-bus-namespace-azure-portal.png)

### <a name="add-a-service-bus-queue"></a>Добавление очереди служебной шины

1. Откройте пространство имен служебной шины и щелкните **+ Очередь**.
1. Введите имя очереди и щелкните **Создать**.
1. Откройте очередь служебной шины и щелкните **Политики общего доступа** > **+ Добавить**.
1. Введите имя политики, установите флажок **Управление**, а затем нажмите кнопку **Создать**.

   ![Добавление очереди служебной шины на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/2_add-service-bus-queue-azure-portal.png)

## <a name="add-an-endpoint-and-a-routing-rule-to-your-iot-hub"></a>Добавление конечной точки и правила маршрутизации в Центр Интернета вещей

### <a name="add-an-endpoint"></a>Добавление конечной точки

1. Откройте Центр Интернета вещей и щелкните "Конечные точки > + Добавить".
1. Введите следующие сведения:

   **Имя**. Имя конечной точки.

   **Тип конечной точки**. Выберите **Очередь служебной шины**.

   **Пространство имен служебной шины**. Выберите созданное пространство имен.

   **Очередь служебной шины**. Выберите созданную очередь.
1. Последовательно выберите **ОК**.

   ![Добавление конечной точки в Центр Интернета вещей на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/3_add-iot-hub-endpoint-azure-portal.png)

### <a name="add-a-routing-rule"></a>Добавление правила маршрутизации

1. В Центре Интернета вещей щелкните **Маршруты** > **+ Добавить**.
1. Введите следующие сведения:

   **Имя**. Имя правила маршрутизации.

   **Источник данных**. Выберите **DeviceMessages**.

   **Конечная точка**. Выберите созданную конечную точку.

   **Строка запроса**. Введите `temperatureAlert = "true"`.
1. Выберите команду **Сохранить**.

   ![Добавление правила маршрутизации на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/4_add-routing-rule-azure-portal.png)

## <a name="create-and-configure-a-logic-app"></a>Создание и настройка приложения логики

### <a name="create-a-logic-app"></a>Создайте приложение логики

1. На [портале Azure](https://portal.azure.com/) выберите **Создать ресурс** > **Интеграция Enterprise** > **Logic App**.
1. Введите следующие сведения:

   **Имя**. Имя приложения логики.

   **Группа ресурсов**. Выберите ту же группу ресурсов, которую использует Центр Интернета вещей.

   **Расположение**. Выберите то же расположение, которое используется для Центра Интернета вещей.
1. Нажмите кнопку **Создать**.

### <a name="configure-the-logic-app"></a>Настройка приложения логики

1. Откройте приложение логики в конструкторе Logic Apps.
1. Щелкните в нем **Пустое приложение логики**.

   ![Начало работы с пустым приложением логики на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/5_start-with-blank-logic-app-azure-portal.png)

1. Щелкните **Служебная шина**.

   ![Выбор служебной шины для начала создания приложения логики на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/6_select-service-bus-when-creating-blank-logic-app-azure-portal.png)

1. Щелкните **Служебная шина — Когда одно или несколько сообщений поступает в очередь (автозавершение)**.
1. Создайте подключение к служебной шине.
   1. Введите имя подключения.
   1. Выберите пространство имен и политику служебной шины, а затем щелкните **Создать**.

      ![Создание подключения к служебной шине для приложения логики на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/7_create-service-bus-connection-in-logic-app-azure-portal.png)

   1. После создания подключения к служебной шине щелкните **Продолжить**.
   1. Выберите созданную очередь и введите значение `175` для параметра **Максимальное число сообщений**.

      ![Установка максимального числа сообщений для подключения к служебной шине в приложении логики](media/iot-hub-monitoring-notifications-with-azure-logic-apps/8_specify-maximum-message-count-for-service-bus-connection-logic-app-azure-portal.png)
   1. Щелкните "Сохранить" , чтобы сохранить изменения.

1. Создайте подключение к службе SMTP.
   1. Выберите **Новый шаг** > **Добавить действие**.
   1. Введите `SMTP`, щелкните службу **SMTP** в результатах поиска, а затем выберите **SMTP — отправка электронной почты**.

      ![Создание подключения к службе SMTP в приложении логики на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/9_create-smtp-connection-logic-app-azure-portal.png)

   1. Введите сведения о службе SMTP почтового ящика и нажмите кнопку **Создать**.

      ![Ввод сведений о подключении к службе SMTP в приложении логики на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/10_enter-smtp-connection-info-logic-app-azure-portal.png)

      Получение сведений об SMTP для [Hotmail/Outlook.com](https://support.office.com/en-us/article/Add-your-Outlook-com-account-to-another-mail-app-73f3b178-0009-41ae-aab1-87b80fa94970), [Gmail](https://support.google.com/a/answer/176600?hl=en) и [Yahoo Mail](https://help.yahoo.com/kb/SLN4075.html).
   1. Введите адрес электронной почты в полях **От** и **Кому** и укажите `High temperature detected` в **теме** и **тексте сообщения**.
   1. Выберите команду **Сохранить**.

При сохранении приложения логика находится в рабочем состоянии.

## <a name="test-the-logic-app"></a>Тестирование приложения логики

1. Запустите клиентское приложение, развертываемое на устройстве, как описано в статье [Подключение Adafruit Feather HUZZAH ESP8266 к Центру Интернета вещей Azure в облаке](iot-hub-arduino-huzzah-esp8266-get-started.md).
1. Увеличьте температуру среды вокруг устройства SensorTag до отметки свыше 30 °C, например зажгите рядом с ним свечу.
1. Вы должны получить уведомление по электронной почте, отправленное приложением логики.

   > [!NOTE]
   > Возможно, поставщику услуг электронной почты потребуется проверить подлинность отправителя и убедиться, что именно вы отправили это сообщение.

## <a name="next-steps"></a>Дополнительная информация

Вы успешно создали приложение логики, обеспечивающее подключение между Центром Интернета вещей и почтовым ящиком для мониторинга температуры и отправки уведомлений.

[!INCLUDE [iot-hub-get-started-next-steps](../../includes/iot-hub-get-started-next-steps.md)]
