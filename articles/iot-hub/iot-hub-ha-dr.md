---
title: Высокий уровень доступности и аварийное восстановление Центра Интернета вещей Azure | Документация Майкрософт
description: В статье описывается ряд возможностей Azure и Центра Интернета вещей для создания высокодоступных решений Интернета вещей Azure с функциями аварийного восстановления.
author: fsautomata
manager: ''
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 10/13/2017
ms.author: elioda
ms.openlocfilehash: 428209defa554599c01789e6f2a8b62f155b0f2f
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34633712"
---
# <a name="iot-hub-high-availability-and-disaster-recovery"></a>Высокая доступность и аварийное восстановление Центра Интернета вещей
Будучи службой Azure, Центр Интернета вещей отличается высоким уровнем доступности, который достигается за счет использования избыточности в одном регионе Azure. При этом к решению не выдвигаются никакие дополнительные требования. Платформа Microsoft Azure также включает в себя ряд возможностей для создания решений с функциями аварийного восстановления или межрегиональной доступностью. Чтобы обеспечить глобальную высокую доступность между регионами для устройств или пользователей, используйте эти функции аварийного восстановления Azure. В [техническом руководстве по обеспечению устойчивости в Azure](../resiliency/resiliency-technical-guidance.md) описаны встроенные функции Azure, которые позволяют обеспечить непрерывность бизнес-процессов и возможности аварийного восстановления. В статье [Аварийное восстановление и высокая доступность для приложений на платформе Azure][Disaster recovery and high availability for Azure applications] содержатся требования к архитектуре, которая позволяет обеспечить высокий уровень доступности приложений Azure и реализовать для них возможности аварийного восстановления.

## <a name="azure-iot-hub-dr"></a>Аварийное восстановление Центра Интернета вещей Azure
В дополнение к обеспечению высокой доступности внутри регионов Центр Интернета вещей реализует механизмы отказоустойчивости для аварийного восстановления, которые не требуют вмешательства пользователя. Аварийное восстановление Центра Интернета вещей является самоинициируемым. Целевое время восстановления (RTO) составляет от 2 до 26 часов. Доступны следующие целевые точки восстановления (RPO):

| Функции | RPO |
| --- | --- |
| Доступность службы для операций с реестром и операций взаимодействия |Возможна потеря записи CName |
| Данные удостоверений в реестре удостоверений |Потеря 0–5 мин данных |
| Отправка сообщений с устройства в облако |Теряются все непрочитанные сообщения |
| Отправка сообщений о мониторинге операций |Теряются все непрочитанные сообщения |
| Получение сообщений из облака на устройство |Потеря 0–5 мин данных |
| Очередь отзывов из облака на устройство |Теряются все непрочитанные сообщения |
| Данные двойника устройства |Потеря 0–5 мин данных |
| Родительское устройство и его задания |Потеря 0–5 мин данных |

## <a name="regional-failover-with-iot-hub"></a>Отработка отказа между регионами с помощью Центра Интернета вещей
Полное освещение топологий развертывания в решениях Интернета вещей выходит за рамки этой статьи. Чтобы раскрыть тему высокого уровня доступности и аварийного восстановления, в статье рассматривается модель развертывания с *отработкой отказа между регионами*.

В модели региональной отработки отказа серверная часть решения запускается в первую очередь в центре обработки данных в одном расположении. Дополнительные Центр Интернета вещей и серверная часть развертываются в другом расположении центра обработки данных. Если в Центре Интернета вещей в основном ЦОД произойдет сбой или сетевое подключение устройства к основному ЦОД по какой-то причине будет нарушено, устройства будут использовать дополнительную конечную точку службы. Доступность решения можно повысить, реализовав модель отработки отказа между регионами, а не в пределах одного региона. 

Если говорить в общем, то чтобы реализовать модель с отработкой отказа между регионами, необходимо следующее:

* **Дополнительный Центр Интернета вещей и логика маршрутизации устройств.** В случае нарушения работы службы в основном регионе устройства должны подключаться к дополнительному региону. Учитывая, что состояние большинства задействованных служб отслеживается, чаще всего процесс отработки отказа между регионами активируют администраторы решений. Лучший способ сообщить устройствам новую конечную точку и сохранить контроль над процессом — заставить устройства регулярно получать из *дежурной* службы текущую активную конечную точку. Дежурной службой может быть простое реплицируемое веб-приложение, доступность которого обеспечивается посредством перенаправления DNS-трафика (например, с помощью [диспетчера трафика Azure][Azure Traffic Manager]).
* **Репликация реестра удостоверений.** Дополнительный Центр Интернета вещей будет работоспособен только в том случае, если в нем будут все удостоверения устройств и эти удостоверения смогут подключаться к решению. Решение должно хранить геореплицированные резервные копии удостоверений устройств и передавать их в дополнительный центр IoT до перевода устройств на другую конечную точку. В этом случае вам пригодится функция Центра Интернета вещей для экспорта удостоверений устройств. Дополнительные сведения см. в [разделе, посвященном реестру удостоверений, руководства разработчика для Центра Интернета вещей][IoT Hub developer guide - identity registry].
* **Логика объединения.** Когда основной регион снова станет доступным, все состояния и данные, которые были созданы в дополнительном регионе, необходимо перенести обратно в основной. Эти состояния и данные главным образом относятся к удостоверениям устройств и метаданным приложений, которые необходимо добавить в основной Центр Интернета вещей и другие хранилища приложений в основном регионе. Чтобы упростить эту процедуру, следует использовать идемпотентные операции. Они сводят к минимуму количество побочных эффектов от итогового согласованного распределения событий и от дублирования данных или беспорядочной доставки событий. Кроме того, логику приложения необходимо спроектировать таким образом, чтобы потенциальные несоответствия или незначительно устаревшие состояния считались допустимыми. Эта ситуация связана как с целевыми точками восстановления (RPO), так и с тем, что восстановление системы требует времени.

## <a name="next-steps"></a>Дополнительная информация
Дополнительные сведения о Центре Интернета вещей в Azure см. по следующим ссылкам:

* [Приступая к работе с Центром Интернета вещей Azure][lnk-get-started]
* [Что такое Центр Интернета вещей Azure?][What is Azure IoT Hub?]

[Disaster recovery and high availability for Azure applications]: ../resiliency/resiliency-disaster-recovery-high-availability-azure-applications.md
[Azure Business Continuity Technical Guidance]: https://azure.microsoft.com/documentation/articles/resiliency-technical-guidance/
[Azure Traffic Manager]: https://azure.microsoft.com/documentation/services/traffic-manager/
[IoT Hub developer guide - identity registry]: iot-hub-devguide-identity-registry.md

[lnk-get-started]: iot-hub-csharp-csharp-getstarted.md
[What is Azure IoT Hub?]: iot-hub-what-is-iot-hub.md
