---
title: Принципы отправки сообщений Центра Интернета вещей Azure с устройства в облако | Документы Майкрософт
description: Руководство разработчика — обмен сообщениями между устройством и облаком с помощью Центра Интернета вещей. Содержит сведения об отправке данных телеметрии и других данных и использовании маршрутизации для доставки сообщений.
author: dominicbetts
manager: timlt
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 01/29/2018
ms.author: dobett
ms.openlocfilehash: 6096d726d7a00a4ddf8047edeebb74ab3f151e51
ms.sourcegitcommit: 6cf20e87414dedd0d4f0ae644696151e728633b6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/06/2018
ms.locfileid: "34808263"
---
# <a name="send-device-to-cloud-messages-to-iot-hub"></a>Отправка сообщений, пересылаемых с устройства в облако, в Центр Интернета вещей

Для отправки данных телеметрии временных рядов и оповещений с устройств в серверной части решения отправляйте сообщения "с устройства в облако" с вашего устройства в Центр Интернета вещей. Обсуждение других вариантов передачи данных с устройства в облако, поддерживаемых Центром Интернета вещей, см. в [руководстве по обмену данными между устройством и облаком][lnk-d2c-guidance].

Отправка сообщений с устройства в облако осуществляется через обращенную к устройству конечную точку (**/devices/{deviceId}/messages/events**). Затем правила маршрутизации направляют сообщения в одну из конечных точек, доступных для службы, в Центре Интернета вещей. Для определения маршрута правила маршрутизации используют заголовок и текст сообщений, отправляемых с устройства в облако. По умолчанию сообщения направляются во встроенную конечную точку, доступную для службы (**/messages/events**), которая совместима с [концентраторами событий][lnk-event-hubs]. Таким образом, чтобы получать сообщения, отправляемые из устройства в облако, в серверной части решения, можно использовать стандартную [интеграцию концентраторов событий и пакетов SDK][lnk-compatible-endpoint].

Для реализация отправки сообщений с устройства в облако Центр Интернета вещей использует модель потоковой передачи сообщений. Сообщения Центра Интернета вещей, отправляемые с устройства в облако, больше похожи на *события* [концентраторов событий][lnk-event-hubs], чем на *сообщения* [служебной шины][lnk-servicebus], где большое количество событий проходит через службу и может считываться несколькими модулями чтения.

Отправка сообщений с устройства в облако с помощью Центра Интернета вещей имеет следующие характеристики:

* Сообщения, отправляемые с устройства в облако, устойчивы и хранятся в конечной точке по умолчанию **messages/events** Центра Интернета вещей до семи дней.
* Размер сообщений, поступающих с устройства в облако, не может превышать 256 КБ, и их можно объединять в пакеты, чтобы оптимизировать отправку. Размер пакетов не может превышать 256 КБ.
* Как объяснено в разделе [Управление доступом к Центру Интернета вещей][lnk-devguide-security], Центр Интернета вещей обеспечивает аутентификацию и контроль доступа для каждого устройства.
* В Центре Интернета вещей можно создать до 10 пользовательских конечных точек. Сообщения доставляются в конечные точки, исходя из маршрутов, настроенных в Центре Интернета вещей. Дополнительные сведения см. в статье, посвященной [правилам маршрутизации](iot-hub-devguide-query-language.md#device-to-cloud-message-routes-query-expressions).
* Центр Интернета вещей обеспечивает работу большого числа одновременно подключенных устройств (см. раздел [Квоты и регулирование][lnk-quotas]).
* Центр Интернета вещей не позволяет выполнять произвольное секционирование. Сообщения, отправляемые с устройства в облако, секционируются по исходному идентификатору **deviceId**.

Дополнительные сведения о различиях между Центром Интернета вещей и концентраторами событий см. в разделе [Сравнение Центра Интернета вещей Azure и концентраторов событий Azure][lnk-comparison].

## <a name="send-non-telemetry-traffic"></a>Отправка данных, не относящихся к телеметрии

Часто устройства отправляют не только телеметрию, но и сообщения и запросы, требующие отдельного выполнения и обработки в серверной части решения. Например, устройство отправляет критические оповещения, которые должны активировать определенное действие в серверной части. Вы можете записать [правило маршрутизации][lnk-devguide-custom] для отправки таких сообщений в конечную точку, назначенную для их обработки, в зависимости от заголовка сообщения или значения в его тексте.

Дополнительные сведения о том, как лучше всего обработать такие сообщения, см. в статье [Учебник: как обрабатывать сообщения, отправляемые с устройства Центра Интернета вещей в облако, с помощью .Net][lnk-d2c-tutorial].

## <a name="route-device-to-cloud-messages"></a>Маршрутизация сообщений, отправленных с устройства в облако

Существует два варианта маршрутизации сообщений, отправляемых с устройства в облако, во внутренних приложениях.

* Использование встроенной и [совместимой с концентраторами событий конечной точки][lnk-compatible-endpoint], с помощью которой внутренние приложения считывают сообщения, отправляемые в Центр с устройства. Дополнительные сведения о встроенных конечных точках, совместимых с концентраторами событий, см. в разделе [Чтение сообщений, пересылаемых с устройства в облако, из встроенной конечной точки][lnk-devguide-builtin].
* Правила маршрутизации можно использовать для отправки сообщений в пользовательские конечные точки в собственном центре Интернета вещей. Пользовательские конечные точки позволяют внутренним приложениям считывать сообщения, отправляемые с устройства в облако, с помощью концентраторов событий, очередей или разделов служебной шины. Дополнительные сведения о маршрутизации и пользовательских конечных точках см. в разделе [Использование пользовательских конечных точек и правил маршрутизации для сообщений, отправляемых с устройства в облако][lnk-devguide-custom].

## <a name="anti-spoofing-properties"></a>Свойства для защиты от спуфинга

Чтобы избежать спуфинга устройств при работе с сообщениями, отправляемыми с устройства в облако, Центр Интернета вещей отмечает все сообщения такими свойствами:

* **ConnectionDeviceId;**
* **ConnectionDeviceGenerationId;**
* **ConnectionAuthMethod.**

Первые два свойства содержат параметры **deviceId** и **generationId** исходного устройства (согласно разделу [Device identity properties][lnk-device-properties] (Свойства удостоверений устройств)).

Свойство **ConnectionAuthMethod** содержит сериализованный объект JSON, имеющий такие свойства:

```json
{
  "scope": "{ hub | device }",
  "type": "{ symkey | sas | x509 }",
  "issuer": "iothub"
}
```

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о пакетах SDK, которые можно использовать для отправки сообщений с устройства в облако, см. в статье, посвященной [пакетам SDK для Azure IoT][lnk-sdks].

Руководства [по началу работы][lnk-get-started] демонстрируют отправку сообщений "с устройства в облако" с моделируемых и физических устройств. Дополнительные сведения см. в руководстве [по обработке сообщений Центра Интернета вещей, отправляемых с устройства в облако, с помощью маршрутов][lnk-d2c-tutorial].

[lnk-devguide-builtin]: iot-hub-devguide-messages-read-builtin.md
[lnk-devguide-custom]: iot-hub-devguide-messages-read-custom.md
[lnk-comparison]: iot-hub-compare-event-hubs.md
[lnk-d2c-guidance]: iot-hub-devguide-d2c-guidance.md
[lnk-get-started]: iot-hub-get-started.md

[lnk-event-hubs]: http://azure.microsoft.com/documentation/services/event-hubs/
[lnk-servicebus]: http://azure.microsoft.com/documentation/services/service-bus/
[lnk-quotas]: iot-hub-devguide-quotas-throttling.md
[lnk-sdks]: iot-hub-devguide-sdks.md
[lnk-compatible-endpoint]: iot-hub-devguide-messages-read-builtin.md
[lnk-device-properties]: iot-hub-devguide-identity-registry.md#device-identity-properties
[lnk-devguide-security]: iot-hub-devguide-security.md
[lnk-d2c-tutorial]: tutorial-routing.md
