---
title: Краткое руководство по отправке телеметрии в Центр Интернета вещей (Python) | Документация Майкрософт
description: В этом кратком руководстве выполняется пример приложения Python по отправке имитированной телеметрии в Центр Интернета вещей и применению служебной программы для чтения телеметрии из Центра Интернета вещей.
services: iot-hub
author: dominicbetts
manager: timlt
editor: ''
ms.service: iot-hub
ms.devlang: python
ms.topic: quickstart
ms.custom: mvc
ms.tgt_pltfrm: na
ms.workload: ns
ms.date: 04/30/2018
ms.author: dobett
ms.openlocfilehash: 35e6f027551c343a56f606313b6592e74bf6caf7
ms.sourcegitcommit: e221d1a2e0fb245610a6dd886e7e74c362f06467
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2018
---
# <a name="quickstart-send-telemetry-from-a-device-to-an-iot-hub-and-read-the-telemetry-from-the-hub-with-a-back-end-application-python"></a>Краткое руководство. Отправка данных телеметрии с устройства в Центр Интернета вещей и чтение данных телеметрии из центра с помощью внутреннего приложения (Python)

[!INCLUDE [iot-hub-quickstarts-1-selector](../../includes/iot-hub-quickstarts-1-selector.md)]

Центр Интернета вещей — это служба Azure, которая позволяет получать большие объемы телеметрии с ваших устройств Центра Интернета вещей в облаке на хранение или обработку. В рамках этого краткого руководства вы отправите данные телеметрии из приложения имитированного устройства через Центр Интернета вещей во внутреннее приложение для обработки.

В этом кратком руководстве используется предварительно написанное приложение Python для отправки телеметрии и служебная программа CLI для чтения телеметрии из центра. Прежде чем запускать эти приложения, создайте Центр Интернета вещей и зарегистрируйте устройство в центре.

[!INCLUDE [cloud-shell-try-it.md](../../includes/cloud-shell-try-it.md)]

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>предварительным требованиям

Примеры приложений, запускаемые в рамках этого краткого руководства, написаны на языке Python. На компьютере разработки должна быть установлена среда Python 2.7.x или 3.5.x.

Python, предназначенный для нескольких платформ, можно скачать на сайте [Python.org](https://www.python.org/downloads/).

Текущую версию Python на компьютере, на котором ведется разработка, можно проверить, выполнив одну из следующих команд:

```python
python --version
```

```python
python3 --version
```

Скачайте пример проекта Python по адресу https://github.com/Azure-Samples/azure-iot-samples-python/archive/master.zip и извлеките ZIP-архив.

Чтобы установить служебную программу CLI, которая считывает данные телеметрии из Центра Интернета вещей, необходимо сначала установить Node.js 4.x.x или более поздней версии на компьютере для разработки. Node.js, предназначенный для нескольких платформ, можно скачать здесь: [nodejs.org](https://nodejs.org).

Текущую версию Node.js на компьютере, на котором ведется разработка, можно проверить, используя следующую команду:

```cmd/sh
node --version
```

Чтобы установить служебную программу CLI `iothub-explorer`, выполните следующую команду:

```cmd/sh
npm install -g iothub-explorer
```

## <a name="create-an-iot-hub"></a>Создание Центра Интернета вещей

[!INCLUDE [iot-hub-quickstarts-create-hub](../../includes/iot-hub-quickstarts-create-hub.md)]

## <a name="register-a-device"></a>Регистрация устройства

Устройство должно быть зарегистрировано в Центре Интернета вещей, прежде чем оно сможет подключиться. В этом кратком руководстве для регистрации имитируемого устройства используется Azure CLI.

1. Добавьте расширение CLI Центра Интернета вещей и создайте удостоверение устройства. Замените переменную `{YourIoTHubName}` именем своего Центра Интернета вещей:

    ```azurecli-interactive
    az extension add --name azure-cli-iot-ext
    az iot hub device-identity create --hub-name {YourIoTHubName}--device-id MyPythonDevice
    ```

1. Выполните следующую команду, чтобы получить _строку подключения устройства_ для зарегистрированного устройства:

    ```azurecli-interactive
    az iot hub device-identity show-connection-string --hub-name {YourIoTHubName} --device-id MyPythonDevice --output table
    ```

    Запишите строку подключения устройства, которая выглядит как `Hostname=...=`. Это значение понадобится позже в рамках этого краткого руководства.

1. Чтобы разрешить служебному приложению CLI `iothub-explorer` подключаться к Центру Интернета вещей и получать сообщения, вам необходима _строка подключения к службе_. Следующая команда извлекает строку подключения службы для Центра Интернета вещей:

    ```azurecli-interactive
    az iot hub show-connection-string --hub-name {YourIoTHubName} --output table
    ```

    Запишите строку подключения службы, которая выглядит как `Hostname=...=`. Это значение понадобится позже в рамках этого краткого руководства. Строка подключения к службе отличается от строки подключения к устройству.

## <a name="send-simulated-telemetry"></a>Отправка имитированной телеметрии

Приложение имитированного устройства подключается к конечной точке конкретного устройства Центра Интернета вещей и отправляет имитированную телеметрию температуры и влажности.

1. В окне терминала перейдите в корневую папку примера проекта Python. Затем перейдите к папке **Quickstarts\simulated-device**.

1. Откройте файл **SimulatedDevice.py** в любом текстовом редакторе.

    Замените значение переменной `CONNECTION_STRING` записанной ранее строкой подключения к устройству. Сохраните изменения в файле **SimulatedDevice.py**.

1. Установите необходимые библиотеки для приложения имитированного устройства, выполнив в окне терминала следующие команды:

    ```cmd/sh
    pip install azure-iothub-device-client
    ```

1. Запустите приложение имитированного устройства, выполнив в окне терминала следующие команды:

    ```cmd/sh
    python SimulatedDevice.py
    ```

    На следующем снимке экрана показан пример выходных данных, когда приложение имитированного устройства отправляет данные телеметрии в Центр Интернета вещей:

    ![Запуск виртуального устройства](media/quickstart-send-telemetry-python/SimulatedDevice.png)

## <a name="read-the-telemetry-from-your-hub"></a>Чтение данных телеметрии из концентратора

Служебная программа CLI `iothub-explorer` подключается к конечной точке **событий** на стороне сервера в Центре Интернета вещей. Служебная программа получает сообщения с устройства в облако, отправленные с имитированного устройства. Внутреннее приложение Центра Интернета вещей обычно запускается в облаке, чтобы получать сообщения с устройства в облако и обрабатывать их.

В другом окне терминала выполните следующие команды, заменив `{your hub service connection string}` строкой подключения к службе, записанной ранее:

```cmd/sh
iothub-explorer monitor-events MyPythonDevice --login {your hub service connection string}
```

На следующем снимке экрана показан пример выходных данных, когда служебная программа получает данные телеметрии, отправленные в цент имитированным устройством:

![Запуск внутреннего приложения](media/quickstart-send-telemetry-python/ReadDeviceToCloud.png)

## <a name="clean-up-resources"></a>Очистка ресурсов

Не удаляйте группу ресурсов и Центр Интернета вещей, так как они понадобятся вам при работе со следующим руководством.

Если вам больше не требуется Центр Интернета вещей, удалите его и группу ресурсов на портале. Для этого выберите группу ресурсов **qs-iot-hub-rg**, содержащую Центр Интернета вещей, и щелкните **Удалить**.

## <a name="next-steps"></a>Дополнительная информация

В этом кратком руководстве вы настроили Центр Интернета вещей, зарегистрировали устройство, отправили имитированные данные телеметрии в центр с помощью приложения Python, а также считали данные телеметрии из центра, используя простое внутреннее приложение.

Чтобы узнать, как управлять имитированным устройством из внутреннего приложения, перейдите к следующему краткому руководству.

> [!div class="nextstepaction"]
> [Краткое руководство по управлению подключенным к Центру Интернета вещей устройством (Python)](quickstart-control-device-python.md)