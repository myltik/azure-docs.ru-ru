---
title: Устранение неполадок Azure Stream Analytics с использованием журналов диагностики
description: В этой статье объясняется, как анализировать журналы диагностики в Azure Stream Analytics.
services: stream-analytics
author: jseb225
ms.author: jeanb
manager: kfile
ms.reviewer: jasonh
ms.service: stream-analytics
ms.topic: conceptual
ms.date: 04/20/2017
ms.openlocfilehash: 9001a2962806ee3e691fa448dde162d12c6ecdd2
ms.sourcegitcommit: 5b2ac9e6d8539c11ab0891b686b8afa12441a8f3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
ms.locfileid: "30905868"
---
# <a name="troubleshoot-azure-stream-analytics-by-using-diagnostics-logs"></a>Устранение неполадок Azure Stream Analytics с помощью журналов диагностики

В некоторых случаях обработка задания Azure Stream Analytics неожиданно прекращается. Очень важно иметь возможность устранения подобных проблем. Такие неполадки могут случиться из-за непредвиденного результата запроса, подключения к устройствам или неожиданного сбоя службы. Журналы диагностики в Stream Analytics могут помочь определить причину проблемы и ускорить восстановление.

## <a name="log-types"></a>Типы журналов

Stream Analytics предоставляет журналы двух типов: 
* [Журналы действий](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-activity-logs) (всегда включены), содержащие ценные сведения об операциях, выполняемых в заданиях.
* [Журналы диагностики](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs) (можно настроить) с подробными сведениями обо всех событиях в задании. Журналы диагностики начинают регистрировать данные при создании задания и прекращают при его удалении. Они фиксируют события при обновлении и выполнении задания.

> [!NOTE]
> Для анализа несоответствующих данных можно использовать службу хранилища Azure, концентраторы событий Azure и Azure Log Analytics. Плата за использование служб взимается с учетом модели ценообразования.
>

## <a name="turn-on-diagnostics-logs"></a>Включение журналов диагностики

По умолчанию журналы диагностики **отключены**. Чтобы включить журналы диагностики, сделайте следующее:

1.  Войдите на портал Azure и перейдите в колонку "Задание потоковой передачи". В разделе **Мониторинг**выберите **Журналы диагностики**.

    ![Перемещение к колонке журналов диагностики](./media/stream-analytics-job-diagnostic-logs/image1.png)  

2.  Выберите **Включить диагностику**.

    ![Включение журналов диагностики](./media/stream-analytics-job-diagnostic-logs/image2.png)

3.  На странице **Параметры диагностики** для параметра **Состояние** выберите значение **Вкл**.

    ![Изменение состояния для журналов диагностики](./media/stream-analytics-job-diagnostic-logs/image3.png)

4.  Настройте требуемый целевой объект (учетную запись хранения, концентратор событий, Log Analytics) архивирования. Затем выберите категории журналов, которые необходимо собирать ("Выполнение" или "Разработка"). 

5.  Сохраните новую конфигурацию системы диагностики.

Конфигурация вступает в силу через 10 минут. После этого журналы начнут появляться в настроенной цели архивации (на странице **Журналы диагностики**):

![Перемещение к колонке журналов диагностики — цели архивирования](./media/stream-analytics-job-diagnostic-logs/image4.png)

Дополнительные сведения о настройке диагностики см. в статье [Сбор и использование диагностических данных из ресурсов Azure](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs).

## <a name="diagnostics-log-categories"></a>Категории журналов диагностики

Сейчас мы записываем две категории журналов диагностики:

* **Разработка**: позволяет записывать события в журналы, связанные с операциями разработки заданий: создание, добавление и удаление входных и выходных данных, добавление и обновление запроса, запуск и остановка задания.
* **Выполнение**: позволяет записывать в журнал все события, происходящие во время выполнения задания:
    * Ошибки подключения.
    * Ошибки обработки данных:
        * события, которые не соответствуют определению запроса (несовпадение типов полей и значений, отсутствие полей и т. п.);
        * ошибки оценки выражений.
    * Другие события и ошибки.

## <a name="diagnostics-logs-schema"></a>Схема журналов диагностики

Все журналы хранятся в формате JSON. Каждая запись содержит следующие общие строковые поля.

ИМЯ | ОПИСАНИЕ
------- | -------
Twitter в режиме реального | Метка времени журнала (в формате UTC).
ResourceId | Идентификатор ресурса (прописными буквами), с которым была выполнена операция. Содержит идентификатор подписки, группу ресурсов и имя задания. Например, **/SUBSCRIPTIONS/6503D296-DAC1-4449-9B03-609A1F4A1C87/RESOURCEGROUPS/MY-RESOURCE-GROUP/PROVIDERS/MICROSOFT.STREAMANALYTICS/STREAMINGJOBS/MYSTREAMINGJOB**.
category | Категория журнала, **Выполнение** или **Разработка**.
operationName | Имя операции, добавленной в журнал. Например, **Send Events: SQL Output write failure to mysqloutput** (События отправки: ошибка записи выходных данных SQL в mysqloutput).
status | Состояние операции. Например, **Сбой** или **Успешно выполнено**.
level | Уровень ведения журнала. Например, **Ошибка**, **Предупреждение** или **Информация**.
properties | Сведения о записи журнала, сериализованные в строку JSON. Дополнительные сведения приведены в следующем разделе.

### <a name="execution-log-properties-schema"></a>Схема свойств журнала выполнения

Журналы выполнения содержат сведения о событиях, произошедших при выполнении задания Stream Analytics. Схема свойств зависит от типа события. Сейчас имеются следующие виды журналов выполнения:

### <a name="data-errors"></a>Ошибки данных

Любая ошибка, возникающая при обработке данных в задании, находится в этой категории журналов. Чаще всего эти журналы создаются во время операций чтения, сериализации и записи. Эти журналы не содержат ошибок подключения, которые обрабатываются как универсальные события.

ИМЯ | ОПИСАНИЕ
------- | -------
Источник | Имя входных или выходных данных задания, в которых произошла ошибка.
Сообщение | Сообщение, связанное с ошибкой.
type | Тип ошибки. Например **DataConversionError**, **CsvParserError** или **ServiceBusPropertyColumnMissingError**.
Данные | Содержит данные, полезные для точного поиска источника ошибки. Значение может быть усечено в зависимости от размера.

В зависимости от значения **operationName** ошибки данных имеют следующую схему:
* **Сериализация событий.** Эта ошибка происходят во время операций чтения события, если входные данные не соответствуют схеме запроса по одной из следующих причин:
    * *Несоответствие типов во время десериализации или сериализации события*: определяет поле, вызывающее ошибку.
    * *Не удается прочитать события, недопустимая сериализация*: содержит сведения о месте во входных данных, где произошла ошибка (имя входного большого двоичного объекта, смещение и примеры данных).
* **Отправка событий.** Этот тип ошибки происходит при выполнении операций записи. Они определяют событие потоковой передачи, вызвавшее ошибку.

### <a name="generic-events"></a>Универсальные события

Остальные типы ошибок считаются универсальными событиями.

ИМЯ | ОПИСАНИЕ
-------- | --------
Ошибка | (Необязательно.) Сведения об ошибке. Как правило, это сведения об исключении (если они доступны).
Сообщение| Сообщение журнала.
type | Тип сообщения. Сопоставляется с внутренней классификацией ошибок. Например **JobValidationError** или **BlobOutputAdapterInitializationFailure**.
Идентификатор корреляции | Идентификатор [GUID](https://en.wikipedia.org/wiki/Universally_unique_identifier), однозначно определяющий выполнение задания. Все записи журнала, зафиксированные с начала до завершения задания, имеют одинаковое значение **идентификатора корреляции**.

## <a name="next-steps"></a>Дополнительная информация

* [Что такое Stream Analytics?](stream-analytics-introduction.md)
* [Приступая к работе с Azure Stream Analytics: выявление мошенничества в режиме реального времени](stream-analytics-real-time-fraud-detection.md)
* [Масштабирование заданий Azure Stream Analytics для повышения пропускной способности базы данных](stream-analytics-scale-jobs.md)
* [Stream Analytics Query Language Reference](https://msdn.microsoft.com/library/azure/dn834998.aspx) (Справочник по языку запросов Stream Analytics)
* [Stream Analytics management REST API reference](https://msdn.microsoft.com/library/azure/dn835031.aspx) (Справочник по API-интерфейсу REST для управления Stream Analytics)
