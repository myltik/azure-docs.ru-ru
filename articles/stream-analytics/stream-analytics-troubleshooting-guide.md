---
title: Руководство по устранению неполадок для Azure Stream Analytics
description: В этой статье описаны методы устранения неполадок в заданиях Azure Stream Analytics, с подключениями, входными данными, выходными данными, запросами и данными.
services: stream-analytics
author: jseb225
ms.author: jeanb
manager: kfile
ms.reviewer: jasonh
ms.service: stream-analytics
ms.topic: conceptual
ms.date: 04/20/2017
ms.openlocfilehash: 44777946fdc829da222ffdd67dfecfa3bf240be7
ms.sourcegitcommit: 5b2ac9e6d8539c11ab0891b686b8afa12441a8f3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
# <a name="troubleshooting-guide-for-azure-stream-analytics"></a>Руководство по устранению неполадок для Azure Stream Analytics

На первый взгляд устранение неполадок в Azure Stream Analytics может показаться сложным. Поработав со множеством пользователей, мы создали это руководство, которое поможет упростить процесс и исключить метод проб и ошибок при работе с входными и выходными данными, запросами и функциями.

## <a name="troubleshoot-your-stream-analytics-job"></a>Устранение неполадок в задании Stream Analytics

Чтобы достичь оптимальных результатов при устранении неполадок в задании Stream Analytics, следуйте приведенным ниже рекомендациям:

1.  Проверьте подключение:
    - Проверьте подключение к портам ввода и вывода с помощью кнопки **Проверить подключение** для всех входных и выходных данных.

2.  Проверьте входные данные:
    - Чтобы убедиться, что входные данные передаются в концентратор событий, с помощью [обозревателя служебной шины](https://code.msdn.microsoft.com/windowsapps/Service-Bus-Explorer-f2abca5a) подключитесь к концентратору событий Azure (если концентратор событий используется как точка ввода).  
    - Нажмите кнопку [**Образцы данных**](stream-analytics-sample-data-input.md) для входных данных и скачайте пример входных данных.
    - Проверьте демонстрационные данные, чтобы определить форму данных: схему и [типы данных](https://msdn.microsoft.com/library/azure/dn835065.aspx).

3.  Проверьте запрос:
    - На вкладке **Запрос** нажмите кнопку **Тест**, чтобы протестировать запрос и использовать скачанные демонстрационные данные для [проверки запроса](stream-analytics-test-query.md). Проанализируйте все ошибки и попытайтесь исправить их.
    - Если используются [**метки времени**](https://msdn.microsoft.com/library/azure/mt573293.aspx), убедитесь, что они зарегистрированы для событий после [начала выполнения задания](stream-analytics-out-of-order-and-late-events.md).

4.  Выполните отладку запроса:
    - Создайте запрос заново. Начните с простых операторов выбора, постепенно переходя к более сложным действиям с использованием статистических выражений. Используйте предложение [WITH](https://msdn.microsoft.com/library/azure/dn835049.aspx) для пошагового создания логики запросов.
    - Используйте [SELECT INTO](stream-analytics-select-into.md) для отладки шагов запроса.

5.  Исключите типичные проблемы, например:
    - Предложение [ **WHERE**](https://msdn.microsoft.com/library/azure/dn835048.aspx) в запросе фильтрует все события, предотвращая создание выходных данных.
    - При использовании оконных функций подождите до завершения окна для вывода выходных данных из запроса.
    - Метка времени для событий предшествует времени запуска задания, поэтому события сбрасываются.

6.  Используйте упорядочивание событий:
    - Если все предыдущие действия возымели нужный эффект, перейдите к колонке **Параметры** и выберите [**Упорядочение событий**](stream-analytics-out-of-order-and-late-events.md). Убедитесь, что эта политика настроена для требуемых элементов сценария. Эта политика *НЕ* применяется при проверке запроса по нажатию кнопки **Тест**. В результате тестирования в браузере и при выполнении задания в рабочей среде отличаются одним компонентом.

7.  Выполните отладку с использованием метрик:
    - Если выходные данные не появляются по истечении этого времени (как указано в запросе), сделайте следующее:
        - Проверьте [**метрики мониторинга**](stream-analytics-monitoring.md) на вкладке **Монитор**. Так как значения агрегированы, метрики задерживаются на несколько минут.
            - Если значение параметра "Входные события" больше 0, задание может читать данные. Если значение параметра "Входные события" меньше 0, сделайте следующее:
                - Чтобы узнать, используются ли в источнике данных допустимые данные, проверьте [обозреватель служебной шины](https://code.msdn.microsoft.com/windowsapps/Service-Bus-Explorer-f2abca5a). Эта проверка применяется, если задание использует концентратор событий в качестве точки ввода.
                - Проверьте формат сериализации и шифрования данных.
                - Если задание использует концентратор событий, проверьте, задано ли для текста сообщения значение *null*.
            - Если обнаружены ошибки преобразования данных и показатель растет, должны выполняться следующие условия:
                - Заданию не удастся выполнить десериализацию событий.
                - Схема событий может не соответствовать определенной или ожидаемой схеме событий в запросе.
                - В событии могут обнаружиться неожиданные типы данных в некоторых полях.
            - Если обнаружены ошибки среды выполнения, это означает, что задание может получать данные, но выдает ошибки при обработке запроса.
                - Чтобы найти ошибки, перейдите к [журналам аудита](../azure-resource-manager/resource-group-audit.md) и выполните фильтрацию по состоянию *Сбой*.
            - Если значение InputEvents больше 0, а OutputEvents равно 0, это означает, что выполняется одно из следующих условий:
                - В результате обработки исходящие события не получены.
                - События или его поля могут быть повреждены, и выходные события после обработки запроса не получены.
                - Заданию не удалось передать данные в [приемник выходных данных](stream-analytics-select-into.md) из-за проблем с подключением или аутентификацией.
        - В указанных случаях дополнительные сведения об этих ошибках можно получить в сообщениях журнала операций (включая сведения о самом событии), за исключением случаев, когда логика запроса отфильтровала все события. Если обработка нескольких событий создает ошибки, Stream Analytics регистрирует в журналах операций первые три сообщения об ошибке того же типа в течение 10 минут. Затем дополнительные сообщения об идентичных ошибках скрываются, и появляется сообщение о том, что ошибки возникают слишком быстро, поэтому сообщения о них скрываются.

8. Выполните отладку с помощью журналов аудита и диагностики:
    - Используйте [журналы аудита](../azure-resource-manager/resource-group-audit.md) и фильтр для диагностики и устранения ошибок.
    - Используйте [журналы диагностики заданий](stream-analytics-job-diagnostic-logs.md) для диагностики и устранения ошибок.

9. Изучите выходные данные:
    - Если задание находится в состоянии *Выполняется*, в зависимости от значения времени, указанного в запросе, можно увидеть выходные данные в источнике данных-приемнике.
    - Если выходные данные, направляемые в конкретный приемник выходных данных, не отображаются, перенаправьте их в другой, менее сложный приемник (например, в большие двоичные объекты Azure). Затем с помощью обозревателя хранилищ проверьте, отображаются ли данные. Кроме того, проверьте, препятствуют ли ограничения регулирования для выходных данных их получению.

10. Используйте анализ потока данных с помощью метрик схемы заданий:
    - Для анализа потока данных и выявления проблем используйте [схему заданий с метриками](stream-analytics-job-diagram-with-metrics.md).

11. Отправьте запрос в службу поддержки:
    - И, наконец, если ничего не поможет, отправьте запрос в службу поддержки корпорации Майкрософт, указав идентификатор подписки, содержащей ваше задание.

## <a name="get-help"></a>Получение справки

За дополнительной помощью обращайтесь на наш [форум Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/azure/home?forum=AzureStreamAnalytics).

## <a name="next-steps"></a>Дальнейшие действия

* [Введение в Azure Stream Analytics](stream-analytics-introduction.md)
* [Приступая к работе с Azure Stream Analytics](stream-analytics-real-time-fraud-detection.md)
* [Масштабирование заданий в службе Azure Stream Analytics](stream-analytics-scale-jobs.md)
* [Справочник по языку запросов Azure Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [Справочник по API-интерфейсу REST управления Stream Analytics](https://msdn.microsoft.com/library/azure/dn835031.aspx)
