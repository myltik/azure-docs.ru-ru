---
title: Создание среды разработки Node.js на основе Kubernetes в облаке с помощью VS Code | Документация Майкрософт
titleSuffix: Azure Dev Spaces
services: azure-dev-spaces
ms.service: azure-dev-spaces
ms.component: azds-kubernetes
author: ghogen
ms.author: ghogen
ms.date: 05/11/2018
ms.topic: tutorial
description: Быстрая разработка в Kubernetes с использованием контейнеров и микрослужб в Azure
keywords: Docker, Kubernetes, Azure, AKS, Azure Kubernetes Service, containers
manager: douge
ms.openlocfilehash: deb651170b0fd58f8c89b591f3e42b5b629f4095
ms.sourcegitcommit: b6319f1a87d9316122f96769aab0d92b46a6879a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2018
ms.locfileid: "34361478"
---
# <a name="get-started-on-azure-dev-spaces-with-nodejs"></a>Начало работы в Azure Dev Spaces с Node.js

[!INCLUDE[](includes/learning-objectives.md)]

[!INCLUDE[](includes/see-troubleshooting.md)]

Теперь вы готовы создать среду разработки на основе Kubernetes в Azure.

[!INCLUDE[](includes/portal-aks-cluster.md)]

## <a name="install-the-azure-cli"></a>Установка Azure CLI
Для Azure Dev Spaces требуется минимальная настройка локального компьютера. Большая часть конфигурации среды разработки хранится в облаке и доступна для других пользователей. Начните со скачивания и запуска [Azure CLI](/cli/azure/install-azure-cli?view=azure-cli-latest).

> [!IMPORTANT]
> Если у вас уже установлен интерфейс Azure CLI, убедитесь, что вы используете версию 2.0.32 или выше.

[!INCLUDE[](includes/sign-into-azure.md)]

[!INCLUDE[](includes/use-dev-spaces.md)]

[!INCLUDE[](includes/install-vscode-extension.md)]

Ожидае создания кластера, можно начать писать код.

## <a name="create-a-nodejs-container-in-kubernetes"></a>Создание контейнера Node.js в Kubernetes

В этом разделе вы создадите веб-приложение Node.js и запустите его в контейнере в Kubernetes.

### <a name="create-a-nodejs-web-app"></a>Создание веб-приложения Node.js
Скачайте код из GitHub, перейдя по ссылке https://github.com/Azure/dev-spaces, и выберите **Clone or Download** (Клонировать или скачать), чтобы скачать репозиторий GitHub в локальную среду. Код для этого руководства находится в папке `samples/nodejs/getting-started/webfrontend`.

[!INCLUDE[](includes/azds-prep.md)]

[!INCLUDE[](includes/build-run-k8s-cli.md)]

### <a name="update-a-content-file"></a>Обновление файла содержимого
Azure Dev Spaces — это не просто среда выполнения кода в Kubernetes. Она позволяет быстро и итеративно видеть, как изменения вашего кода вступают в силу в среде Kubernetes в облаке.

1. Найдите файл `./public/index.html` и внесите изменения в HTML. Например, можно изменить цвет фона страницы на оттенок синего цвета:

    ```html
    <body style="background-color: #95B9C7; margin-left:10px; margin-right:10px;">
    ```

2. Сохраните файл. Через несколько мгновений в окне терминала вы увидите сообщение о том, что файл в запущенном контейнере обновлен.
1. Вернитесь в браузер и обновите страницу. Вы увидите обновление цвета.

Что произошло? Изменение файлов содержимого, таких как HTML и CSS, не требует перезапуска процесса Node.js, поэтому активная команда `azds up` автоматически синхронизирует любые измененные файлы содержимого непосредственно в запущенный контейнер в Azure, тем самым обеспечивая быстрый способ проверки изменений содержимого.

### <a name="test-from-a-mobile-device"></a>Тестирование с мобильного устройства
Если вы откроете веб-приложение на мобильном устройстве, вы заметите, что пользовательский интерфейс не отображается должным образом на устройстве небольшого размера.

Чтобы устранить эту проблему, нужно добавить метатег `viewport`:
1. Откройте файл `./public/index.html`.
1. Добавьте метатег `viewport` в имеющийся элемент `head`:

    ```html
    <head>
        <!-- Add this line -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    ```

1. Сохраните файл.
1. Обновите браузер своего устройства. Теперь веб-приложение будет отображаться должным образом. 

Это пример того, как некоторые проблемы невозможно выявить, пока вы не протестируете приложение на устройствах, для которых оно предназначено. В Azure Dev Spaces вы можете быстро выполнять итерации кода и проверять любые изменения на целевых устройствах.

### <a name="update-a-code-file"></a>Обновление файла кода
Для обновления файлов кода на стороне сервера требуется немного больше работы, потому что приложение Node.js необходимо перезапустить.

1. В окне терминала нажмите клавишу `Ctrl+C` (чтобы остановить `azds up`).
1. Откройте файл кода с именем `server.js` и измените приветственное сообщение службы: 

    ```javascript
    res.send('Hello from webfrontend running in Azure!');
    ```

3. Сохраните файл.
1. Запустите `azds up` в окне терминала. 

Это перестроит образ контейнера и перераспределит диаграмму Helm. Перезагрузите страницу браузера, чтобы увидеть, как изменения вашего кода вступают в силу.

Но есть еще один *более быстрый метод* разработки кода, который вы рассмотрите в следующем разделе. 

## <a name="debug-a-container-in-kubernetes"></a>Отладка контейнера в Kubernetes

[!INCLUDE[](includes/debug-intro.md)]

[!INCLUDE[](includes/init-debug-assets-vscode.md)]

### <a name="select-the-azds-debug-configuration"></a>Выбор конфигурации отладки AZDS
1. Чтобы открыть представление отладки, щелкните значок "Отладка" на **панели действия** сбоку VS Code.
1. Выберите **Launch Program (AZDS)** (Запустить программу (AZDS)) как активную конфигурацию отладки.

![](media/get-started-node/debug-configuration-nodejs.png)

> [!Note]
> Если вы не видите никаких команд Azure Dev Spaces на палитре команд, убедитесь, что вы [установили расширение VS Code для Azure Dev Spaces](get-started-nodejs.md#get-kubernetes-debugging-for-vs-code).

### <a name="debug-the-container-in-kubernetes"></a>Отладка контейнера в Kubernetes
Нажмите клавишу **F5**, чтобы отладить ваш код в Kubernetes.

Подобно команде `up`, код синхронизируется со средой разработки при запуске отладки, и выполняется сборка и развертывание контейнера в Kubernetes. На этот раз отладчик подключен к удаленному контейнеру.

[!INCLUDE[](includes/tip-vscode-status-bar-url.md)]

Установите точку останова в файле кода на стороне сервера, например в `app.get('/api'...` внутри `server.js`. Обновите страницу браузера или нажмите кнопку Say It Again (Повторить это), и вы достигнете точки останова и сможете осуществить пошаговое выполнение кода.

У вас есть полный доступ к отладочной информации, как если бы код выполнялся локально, например к стеку вызовов, локальным переменным, информации об исключениях и т. д.

### <a name="edit-code-and-refresh-the-debug-session"></a>Изменение кода и обновление сеанса отладки
Измените код при активном отладчике. Например, еще раз измените приветствие:

```javascript
app.get('/api', function (req, res) {
    res.send('**** Hello from webfrontend running in Azure! ****');
});
```

Сохраните файл и в области **действий отладки** нажмите кнопку **Обновить**. 

![](media/get-started-node/debug-action-refresh-nodejs.png)

Вместо повторной сборки и развертывания нового образа контейнера при каждой правке кода, что часто занимает немало времени, Azure Dev Spaces перезапустит процесс Node.js между сеансами отладки, чтобы ускорить цикл правки и отладки.

Обновите веб-приложение в браузере или нажмите кнопку *Say It Again* (Повторить это). Вы должны увидеть настраиваемое сообщение в пользовательском интерфейсе.

### <a name="use-nodemon-to-develop-even-faster"></a>Использование NodeMon для ускоренной разработки
*Nodemon* — это популярное средство, которое разработчики Node.js используют для быстрой разработки. Вместо того чтобы вручную перезапускать процесс Node при каждой правке кода на стороне сервера, разработчики часто настраивают в проекте Node средство *nodemon*, которое отслеживает изменения файла и автоматически перезапускает процесс сервера. В таком режиме работы разработчик просто обновляет браузер после внесения изменений в код.

В Azure Dev Spaces вы можете использовать много тех же рабочих процессов разработки, которые вы используете при локальной разработке. Чтобы проиллюстрировать этот принцип, в примере проекта `webfrontend` используется *nodemon* (он настроен как зависимость разработки в `package.json`).

Попробуйте сделать следующее.
1. Остановите отладчик VS Code.
1. Щелкните значок "Отладка" в **строке действий** в боковой части VS Code. 
1. Выберите **Attach (AZDS)** (Присоединить (AZDS)) как активную конфигурацию отладки.
1. Нажмите клавишу F5.

В этой конфигурации контейнер настроен запускать *nodemon*. При внесении изменений в код сервера *nodemon* автоматически перезапускает процесс Node, как при локальной разработке. 
1. Снова измените приветственное сообщение в `server.js` и сохраните файл.
1. Обновите браузер или нажмите кнопку *​​Say It Again* (Повторить это), чтобы увидеть свои изменения.

**Теперь у вас есть метод быстрой итерации кода и отладки непосредственно в Kubernetes**. Далее вы узнаете, как создать и вызвать второй контейнер.

## <a name="call-a-service-running-in-a-separate-container"></a>Вызов службы, запущенной в отдельном контейнере

В этом разделе вы создадите вторую службу, `mywebapi`, к которой будет обращаться `webfrontend`. Каждая служба будет выполняться в отдельных контейнерах. Затем вы выполните отладку в обоих контейнерах.

![](media/common/multi-container.png)

### <a name="open-sample-code-for-mywebapi"></a>Открытие примера кода для *mywebapi*.
У вас уже должен быть пример кода для `mywebapi` в рамках этого руководства. Он находится в папке `samples` (в противном случае перейдите по адресу https://github.com/Azure/dev-spaces и выберите **Clone or Download** (Клонировать или загрузить), чтобы загрузить репозиторий GitHub). Код для этого раздела находится в папке `samples/nodejs/getting-started/mywebapi`.

### <a name="run-mywebapi"></a>Запуск *mywebapi*
1. Откройте папку `mywebapi` в *отдельном окне VS Code*.
1. Нажмите клавишу F5 и подождите, пока выполнится сборка и развертывание службы. Когда все будет готово, откроется панель отладки VS Code.
1. Запишите URL-адрес конечной точки. Он будет иметь приблизительно такой вид: http://localhost:\<portnumber\>. **Подсказка. В строке состояния VS Code отобразится URL-адрес, который можно щелкнуть.** Может показаться, что контейнер выполняется локально, но фактически он выполняется в вашей среде разработки в Azure. В адресе указано localhost, потому что для `mywebapi` не определены общедоступные конечные точки и доступ осуществляется только в пределах экземпляра Kubernetes. Для вашего удобства и упрощения взаимодействия с закрытой службой на локальном компьютере служба Azure Dev Spaces создает временный туннель SSH для контейнера, запущенного в Azure.
1. Когда `mywebapi` будет готово, откройте в браузере адрес localhost. Вы увидите ответ от службы `mywebapi` ("Hello from mywebapi").


### <a name="make-a-request-from-webfrontend-to-mywebapi"></a>Запрос из *webfrontend* к *mywebapi*
Давайте теперь напишем код в `webfrontend`, который отправляет запрос к `mywebapi`.
1. Перейдите в окно VS Code для `webfrontend`.
1. Добавьте следующие строки кода в верхней части `server.js`:
    ```javascript
    var request = require('request');
    var propagateHeaders = require('./propagateHeaders');
    ```

3. *Замените* код для обработчика GET `/api`. При обработке запроса он, в свою очередь, обращается к `mywebapi`, а затем возвращает результаты из обеих служб.

    ```javascript
    app.get('/api', function (req, res) {
        request({
            uri: 'http://mywebapi',
            headers: propagateHeaders.from(req) // propagate headers to outgoing requests
        }, function (error, response, body) {
            res.send('Hello from webfrontend and ' + body);
        });
    });
    ```

Обратите внимание на то, как используется обнаружение службы DNS Kubernetes для обращения к службе в качестве `http://mywebapi`. **Код в вашей среде разработки выполняется так же, как он будет выполняться в рабочей среде**.

В приведенном выше примере кода используется вспомогательный модуль с именем `propagateHeaders`. Этот вспомогательный модуль был добавлен в папку кода во время выполнения `azds prep`. Функция `propagateHeaders.from()` распространяет определенные заголовки из имеющегося объекта http.IncomingMessage в объект headers для исходящего запроса. Позже вы увидите, как это помогает повысить производительность при коллективной разработке.

### <a name="debug-across-multiple-services"></a>Отладка в нескольких службах
1. На этом этапе служба `mywebapi` по-прежнему должна выполняться с подключенным отладчиком. Если это не так, нажмите клавишу F5 в проекте `mywebapi`.
1. Установите точку останова в обработчике GET `/` по умолчанию.
1. В проекте `webfrontend` установите точку останова до отправки запроса GET к `http://mywebapi`.
1. Нажмите клавишу F5 в проекте `webfrontend`.
1. Откройте веб-приложение и выполните пошаговое прохождение кода в обеих службах. В веб-приложении должно отобразиться объединенное сообщение от двух служб: "Hello from webfrontend and Hello from mywebapi".

Все готово! Теперь у вас есть многоконтейнерное приложение, где каждый контейнер можно разрабатывать и развертывать отдельно.

## <a name="learn-about-team-development"></a>Сведения о коллективной разработке

[!INCLUDE[](includes/team-development-1.md)]

Давайте посмотрим на это в действии.
1. Перейдите в окно VS Code для `mywebapi` и измените код в обработчике GET `/` по умолчанию, например:

    ```javascript
    app.get('/', function (req, res) {
        res.send('mywebapi now says something new');
    });
    ```

[!INCLUDE[](includes/team-development-2.md)]

[!INCLUDE[](includes/well-done.md)]

[!INCLUDE[](includes/clean-up.md)]




