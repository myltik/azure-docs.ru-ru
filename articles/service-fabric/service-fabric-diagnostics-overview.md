---
title: Обзор мониторинга и диагностики Azure Service Fabric | Документы Майкрософт
description: Сведения о функциях мониторинга и диагностики для кластеров, приложений и служб Azure Service Fabric.
services: service-fabric
documentationcenter: .net
author: srrengar
manager: timlt
editor: ''
ms.assetid: ''
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: conceptual
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/25/2018
ms.author: srrengar
ms.openlocfilehash: f7fe07500f877cf34626e53361c9c68dd459a5e4
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34643181"
---
# <a name="monitoring-and-diagnostics-for-azure-service-fabric"></a>Мониторинг и диагностика для Azure Service Fabric

В статье представлен обзор мониторинга и диагностики в Azure. Мониторинг и диагностика критически важны для разработки, тестирования и развертывания рабочих нагрузок в любой облачной среде. Мониторинг позволяет отслеживать показатели использования приложения, потребления ресурсов и общую работоспособность кластера. Эти сведения можно использовать при диагностике и устранении неполадок, а также для предотвращения их возникновения впоследствии. 

## <a name="application-monitoring"></a>Мониторинг приложений
В процессе мониторинга приложений фиксируются особенности использования возможностей и компонентов приложения. Он позволяет перехватить проблемы, влияющие на пользователей. Мониторинг приложений может оказаться полезным в следующих случаях.
* При определении рабочей нагрузки на приложение и параметров пользовательского трафика, когда проверяется необходимость проведения масштабирования службы для удовлетворения потребностей пользователей или устранения потенциальных узких мест в работе приложения.
* При выявлении проблем взаимодействия служб и удаленного взаимодействия в кластере.
* При изучении действий пользователей с приложением. Сбор телеметрической информации о работе приложения может помочь в дальнейшей разработке компонентов и оптимизации диагностики проблем в работе приложения.
* При наблюдении за событиями, происходящими внутри запущенных контейнеров.

Service Fabric поддерживает множество инструментов для работы с вашим кодом, в частности средства трассировки и сбора данных телеметрии. Мы рекомендуем использовать Application Insights (AI). Интеграция AI с Service Fabric включает средства для Visual Studio и портала Azure, а также некоторые метрики Service Fabric, обеспечивая комплексную фиксацию в журнале всех необходимых данных. Хотя многие журналы создаются автоматически, а данные собираются при использовании AI, мы советуем создавать в своих приложениях дополнительные специализированные журналы для получения более объемной диагностической информации. Дополнительные сведения о том, как начать работу с Application Insights и Service Fabric, см. в статье [Анализ и визуализация событий с помощью Application Insights](service-fabric-diagnostics-event-analysis-appinsights.md).

## <a name="platform-cluster-monitoring"></a>Мониторинг платформы (кластера)
Мониторинг кластера Service Fabric критически важен для обеспечения надлежащей работы платформы и запущенных на ней рабочих нагрузок. Одна из целей создания Service Fabric — это обеспечение работы приложения в случае сбоев оборудования. Это достигается благодаря способности системных служб платформы обнаруживать проблемы с инфраструктурой и быстро выполнять отработку отказа рабочих нагрузок на другие узлы в кластере. Но в этом случае, что делать, если в самих системных службах есть проблемы? Или если при попытке перемещения рабочей нагрузки нарушаются правила размещения служб? Мониторинг кластера дает возможность получать сведения о действиях, происходящих в кластере, которые помогают диагностировать проблемы и эффективно их устранять. Некоторые ключевые аспекты, на которые следует обратить внимание:
* Работает ли Service Fabric как ожидается с точки зрения размещения приложений и балансировки нагрузки в кластере? 
* Все ли пользователи кластера работают согласно установленных правил и все ли работает как ожидалось? Это особенно важно при масштабировании кластера.
* Правильно ли Service Fabric обрабатывает данные и связь между службами в кластере?

Service Fabric предоставляет широкий набор готовых событий. Доступ к [событиям Service Fabric](service-fabric-diagnostics-events.md) можно получить через API EventStore или операционный канал (канал событий, предоставляемый платформой). 
* EventStore. EventStore (доступно в Windows версии 6.2 и более поздней, для Linux разработка продолжается на момент последнего обновления этой статьи) предоставляет эти события через набор API (доступные через конечные точки REST или клиентскую библиотеку). Дополнительные сведения об EventStore см. в статье [Обзор службы EventStore](service-fabric-diagnostics-eventstore.md).
* Канал событий Service Fabric. В Windows доступ к событиям Service Fabric можно получить от одного поставщика трассировки событий Windows с набором соответствующих фильтров `logLevelKeywordFilters`, использующихся для переключения между каналами "Рабочая среда" и "Данные и обмен сообщениями". Так отделяются исходящие события Service Fabric для фильтрации нужным образом. В Linux все события Service Fabric проходят через LTTng и помещаются в одну таблицу службы хранения, в которой они могут быть отфильтрованы нужным образом. Эти каналы содержат проверенные структурированные события, которые помогают лучше понять состояние вашего кластера. Диагностика включается по умолчанию в момент создания кластера, и при этом создается таблица службы хранилища Azure, в которую отправляются события, поступающие из всех каналов для последующего запроса. 

Мы рекомендуем использовать EventStore для быстрого анализа, а также чтобы получить представление о том, как работает кластер, и выполняются ли операции нужным образом. Для сбора журналов и событий, создаваемых кластером, обычно рекомендуют использовать [расширение системы диагностики Azure](service-fabric-diagnostics-event-aggregation-wad.md). Оно хорошо интегрируется с решением для OMS Log Analytics Service Fabric, "Аналитика Service Fabric", в котором есть настраиваемая панель мониторинга для мониторинга кластеров Service Fabric. Кроме того, это решение позволяет опрашивать систему о событиях, происходящих в кластере, и настраивать оповещения. Дополнительные сведения см. в статье об [анализе событий в OMS](service-fabric-diagnostics-event-analysis-oms.md). 

 Дополнительные сведения о мониторинге кластеров см. в статье [Создание событий и журналов на уровне платформы](service-fabric-diagnostics-event-generation-infra.md).

## <a name="performance-monitoring"></a>Мониторинг производительности
Мониторинг базовой инфраструктуры является ключевым в понимании состояния кластера и использовании ресурсов. Измерение производительности системы зависит от нескольких факторов, каждый из которых обычно определяется с помощью ключевых показателей эффективности. Соответствующие ключевые показатели эффективности Service Fabric можно сопоставить с метриками, которые могут собираться из узлов кластера в качестве счетчиков производительности.
Ключевые индикаторы производительности позволяют:
* получить общие сведения об использовании ресурсов и нагрузке с целью масштабирования кластера или оптимизации процессов службы;
* прогнозировать проблемы с инфраструктурой: возникновению многих проблем предшествуют внезапные изменения (снижения) производительности, поэтому для прогнозирования и диагностики таких проблем можно использовать ключевые показатели эффективности, такие как сетевые операции ввода-вывода и использование ЦП.

Список счетчиков производительности, которые необходимо собрать на уровне инфраструктуры, можно найти в статье [Метрики производительности](service-fabric-diagnostics-event-generation-perf.md). 

Service Fabric предоставляет набор счетчиков производительности для моделей программирования Reliable Services и Reliable Actors. Если используется какая-либо из этих моделей, эти счетчики производительности могут предоставлять ключевые показатели эффективности, которые позволяют гарантировать, что субъекты развертываются и свертываются правильно или что запросы к надежным службам обрабатываются достаточно быстро. Дополнительные сведения см. в разделе [Счетчики производительности](service-fabric-reliable-serviceremoting-diagnostics.md#performance-counters) статьи "Диагностика и мониторинг производительности в модели Reliable Service Remoting" и разделе [Счетчики производительности](service-fabric-reliable-actors-diagnostics.md#performance-counters) статьи "Диагностика и мониторинг производительности в Reliable Actors". В дополнение к этому служба Application Insights также имеет набор метрик производительности, которые она будет собирать, если она настроена для приложения.

Используйте [агент OMS](service-fabric-diagnostics-oms-agent.md) для сбора данных со счетчиков производительности и просмотра ключевых показателей эффективности в Log Analytics OMS.

![Схема обзора диагностики](media/service-fabric-diagnostics-overview/diagnostics-overview.png)

## <a name="health-monitoring"></a>Мониторинг работоспособности
Платформа Service Fabric включает модель работоспособности, которая обеспечивает расширяемую отчетность о состоянии работоспособности сущностей в кластере. Каждый узел, приложение, служба, секция, реплика или экземпляр имеют постоянно обновляемое состояние работоспособности, которое может иметь значение "ОК", "Предупреждение" или "Ошибка". Состояние работоспособности меняется в отчетах о работоспособности, которые создаются для каждой сущности в зависимости от проблем в кластере. Состояние работоспособности сущностей можно проверить в любое время в Service Fabric Explorer (SFX), как показано ниже, или запросить через API работоспособности платформы. Кроме того, можно настроить отчеты о работоспособности и изменить состояние работоспособности сущности, добавляя собственные отчеты о работоспособности или используя API работоспособности. Дополнительные сведения о модели работоспособности см. в статье [Общие сведения о наблюдении за работоспособностью системы в Service Fabric](service-fabric-health-introduction.md).

![Панель мониторинга работоспособности SFX](media/service-fabric-diagnostics-overview/sfx-healthstatus.png)

Помимо отображения последних отчетов о состоянии работоспособности в SFX, каждый отчет также доступен как событие. Данные о событиях, связанных с работоспособностью, можно собирать через рабочий канал (см. раздел [Настройка сбора журналов](service-fabric-diagnostics-event-aggregation-wad.md#log-collection-configurations)) и хранить в Log Analytics для создания оповещений и отправки запросов в будущем. Это поможет обнаружить проблемы, которые могут повлиять на доступность приложения, поэтому мы рекомендуем настроить оповещения для соответствующих сценариев сбоев (пользовательские оповещения в Log Analytics).

## <a name="other-logging-solutions"></a>Другие решения для ведения журнала

Несмотря на то что оба рекомендуемые решения, [OMS](service-fabric-diagnostics-event-analysis-oms.md) и [Application Insights](service-fabric-diagnostics-event-analysis-appinsights.md), обладают встроенными средствами интеграции с Service Fabric, фиксация многих событий производится поставщиками решений для трассировки событий Windows, и при этом их функциональность можно расширять с помощью других решений для фиксации событий в журналах. Стоит также рассмотреть [эластичный пул](https://www.elastic.co/products) (особенно если кластер будет выполняться в автономной среде), [Splunk](https://www.splunk.com/), [Dynatrace](https://www.dynatrace.com/) или любую другую платформу по вашему выбору. 

Основные моменты, на которые следует обратить внимание: удобство пользовательского интерфейса и составления запросов, возможность визуализации данных и создания удобных панелей мониторинга, а также наличие дополнительных средств для повышения эффективности мониторинга, таких как автоматическая генерация оповещений.

## <a name="next-steps"></a>Дополнительная информация

* Сведения по инструментальному контролю приложений см. в статье [Ведение журналов на уровне приложений и служб](service-fabric-diagnostics-event-generation-app.md).
* Дополнительные сведения о мониторинге платформы и событиях, предоставляемых Service Fabric, см. в статье [Мониторинг кластера и платформы](service-fabric-diagnostics-event-generation-infra.md).
* Выполните процедуру настройки AI для приложения, следуя указаниям в разделе [Руководство. Мониторинг и диагностика приложения ASP.NET Core в Service Fabric](service-fabric-tutorial-monitoring-aspnet.md).
* Дополнительные сведения о настройке OMS Log Analytics для мониторинга контейнеров см. в статье [Руководство. Мониторинг контейнера Windows в Service Fabric с помощью OMS](service-fabric-tutorial-monitoring-wincontainers.md).
* Ознакомьтесь с общими рекомендациями по мониторингу ресурсов Azure в статье [Мониторинг и диагностика](https://docs.microsoft.com/azure/architecture/best-practices/monitoring). 
