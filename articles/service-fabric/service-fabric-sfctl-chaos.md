---
title: 'Интерфейс командной строки Azure Service Fabric : sfctl choas | Документация Майкрософт'
description: Описание команд sfctl chaos интерфейса командной строки Azure Service Fabric.
services: service-fabric
documentationcenter: na
author: rwike77
manager: timlt
editor: ''
ms.assetid: ''
ms.service: service-fabric
ms.devlang: cli
ms.topic: reference
ms.tgt_pltfrm: na
ms.workload: multiple
ms.date: 02/22/2018
ms.author: ryanwi
ms.openlocfilehash: 34e4d47b1de509c2053996d9d1078733d7055447
ms.sourcegitcommit: 59914a06e1f337399e4db3c6f3bc15c573079832
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/20/2018
---
# <a name="sfctl-chaos"></a>sfctl chaos
Запуск и остановка службы хаотического тестирования, а также вывод отчета о ее работе.

## <a name="commands"></a>Команды

|Get-Help|ОПИСАНИЕ|
| --- | --- |
|    report| Возвращает следующий сегмент отчета Chaos, основанного на переданном маркере продолжения или прошедшем диапазоне времени.|
|    start | Запускает службу Chaos в кластере.|
|    stop  | Останавливает службу Chaos в кластере, если она уже запущена. В противном случае он не выполняет никаких действий.|


## <a name="sfctl-chaos-report"></a>sfctl chaos report
Возвращает следующий сегмент отчета Chaos, основанного на переданном маркере продолжения или прошедшем диапазоне времени.

Можно указать ContinuationToken для получения следующего сегмента отчета Chaos или указать диапазон времени с помощью параметров StartTimeUtc и EndTimeUtc, но нельзя указать ContinuationToken и диапазон времени одновременно. При наличии более 100 событий Chaos отчет Chaos возвращается по сегментам, каждый из которых содержит не более 100 событий. 

### <a name="arguments"></a>Аргументы

|Аргумент|ОПИСАНИЕ|
| --- | --- |
| --continuation-token| Параметр маркера продолжения используется для получения следующего набора результатов. Маркер продолжения с непустым значением добавляется в ответ API, когда результаты из системы не помещаются в одном ответе. Когда это значение передается в следующем вызове API, API возвращает следующий набор результатов. Если следующий набор результатов отсутствует, маркер продолжения не содержит значения. Значение этого параметра не должно быть указано в формате URL-адреса.|
| --end-time-utc   | Время файла Windows, представляющее время окончания периода, за который создается отчет Chaos. Дополнительные сведения см. в описании [метода DateTime.ToFileTimeUtc](https://msdn.microsoft.com/library/system.datetime.tofiletimeutc(v=vs.110).aspx).|
| --start-time-utc | Время файла Windows, представляющее время начала периода, за который создается отчет Chaos. Дополнительные сведения см. в описании [метода DateTime.ToFileTimeUtc](https://msdn.microsoft.com/library/system.datetime.tofiletimeutc(v=vs.110).aspx).|
| --timeout -t     | Время ожидания сервера в секундах.  Значение по умолчанию: 60.|

### <a name="global-arguments"></a>Глобальные аргументы

|Аргумент|ОПИСАНИЕ|
| --- | --- |
| --debug          | Увеличение уровня детализации ведения журнала для отображения всех журналов отладки.|
| --help -h        | Отображение этого справочного сообщения и выход.|
| --output -o      | Формат выходных данных.  Допустимые значения: json, jsonc, table, tsv.  Значение по умолчанию: json.|
| --query          | Строка запроса JMESPath. Дополнительные сведения и примеры см. на сайте http://jmespath.org/.|
| --verbose        | Повышение уровня детализации ведения журнала. Используйте параметр --debug, чтобы получить полные журналы отладки.|

## <a name="sfctl-chaos-start"></a>sfctl chaos start
Запускает службу Chaos в кластере.

Если служба Chaos еще не запущена в кластере, sfctl chaos start запускает ее с переданными параметрами. Если во время вызова служба Chaos уже выполняется, вызов завершается ошибкой с кодом FABRIC_E_CHAOS_ALREADY_RUNNING.

### <a name="arguments"></a>Аргументы

|Аргумент|ОПИСАНИЕ|
| --- | --- |
| --app-type-health-policy-map  | Список в формате JSON, содержащий максимальный процент неработоспособных приложений для конкретных типов приложений. Каждая запись содержит ключ, представляющий имя типа приложения, и значение — целое число, представляющее процент MaxPercentUnhealthyApplications, используемый для оценки приложений для указанного типа приложения. Определяет сопоставление, содержащее максимальный процент неработоспособных приложений для конкретных типов приложений. Каждая запись содержит ключ, представляющий имя типа приложения, и значение — целое число, представляющее процент MaxPercentUnhealthyApplications, используемый для оценки приложений для указанного типа приложения. Сопоставление политики работоспособности для типа приложения используется во время оценки работоспособности кластера для описания особых типов приложений. Типы приложений, включенные в сопоставление, анализируются с учетом процента, заданного в схеме, а не глобального показателя MaxPercentUnhealthyApplications, определенного в политике работоспособности кластера. Приложения типов, указанных в сопоставлении, не учитываются в рамках глобального пула приложений. Например, если некоторые приложения принадлежат к типу "критический", администратор кластера может добавить в сопоставление запись для этого типа и присвоить ему значение 0 % (т. е. не допускать каких-либо ошибок). Все остальные приложения можно проанализировать при показателе MaxPercentUnhealthyApplications 20 %, чтобы допускать некоторые ошибки на тысячи экземпляров приложения. Сопоставление политики работоспособности для типа приложения используется только в том случае, если манифест кластера включает оценку работоспособности типа приложения с использованием записи конфигурации для HealthManager/EnableApplicationTypeHealthEvaluation.|
|--chaos-target-filter         | Словарь в формате JSON, содержащий два ключа строкового типа: NodeTypeInclusionList и ApplicationInclusionList. Значением обоих этих ключей является список строк. chaos_target_filter определяет все фильтры для целевых сбоев в службе Chaos, например, сбой только определенных типов узлов или сбой только определенных приложений. Если фильтр chaos_target_filter не используется, Chaos создает ошибки во всех сущностях кластера. Если фильтр chaos_target_filter используется, Chaos создает ошибки только в тех сущностях, которые соответствуют параметрам chaos_target_filter. NodeTypeInclusionList и ApplicationInclusionList допускают только семантику объединения. Вы не сможете использовать пересечение условий NodeTypeInclusionList и ApplicationInclusionList. Например, нельзя создать правило "создавать ошибки в этом приложении, только если оно размещено в узле этого типа". Если правило NodeTypeInclusionList или ApplicationInclusionList включают определенную сущность, ее нельзя исключить с помощью ChaosTargetFilter. В приложении X могут создаваться ошибки Chaos, даже если оно не входит в список ApplicationInclusionList, если в определенный момент это приложение будет выполняться в узле типа Y, включенного в список NodeTypeInclusionList. Если NodeTypeInclusionList и ApplicationInclusionList одновременно не указаны, создается исключение ArgumentException. Для узлов этого типа применяются все типы ошибок (перезапуск узла, перезапуск пакета кода, удаление реплики, перезапуск реплики, перемещение первичной и вторичной реплик). Если определенный тип узла (скажем, тип узла X) не включен в список NodeTypeInclusionList, в узле типа X никогда не создаются ошибки уровня узла (например, перезапуск узла), но могут создаваться ошибки уровня пакета кода или реплики, если в узле типа X в определенный момент будет выполняться приложение из списка ApplicationInclusionList. В этот список можно включить не более 100 имен типов узлов. Чтобы увеличить это число, измените параметр конфигурации MaxNumberOfNodeTypesInChaosEntityFilter. Все реплики, относящиеся к службам этих приложений, становятся доступными для ошибок реплики Chaos (перезапуск реплики, удаление реплики, перемещения первичной или вторичной реплики). Chaos может перезапустить пакет кода, только если в нем размещены реплики указанных приложений. Если приложение не включено в этот список, для него иногда могут создаваться ошибки Chaos, если в определенный момент это приложение будет выполняться в узле определенного типа, включенного в список NodeTypeInclusionList. Но если, например, приложение X привязано к типу узла Y посредством ограничений размещения и при этом приложение X отсутствует в списке ApplicationInclusionList и тип узла Y отсутствует в списке NodeTypeInclusionList, то для такого приложения X никогда не будут применяться ошибки. В этот список можно включить не более 1000 имен приложений. Чтобы увеличить это число, измените параметр конфигурации MaxNumberOfApplicationsInChaosEntityFilter.|
|--context                     | Сопоставление пар "ключ — значение" типа (string, string) в формате JSON. Для записи сведений о запуске Chaos можно использовать карту. Максимальное число таких пар — 100. Каждая строка (ключ или значение) может содержать не более 4095 символов. Это сопоставление настраивает стартер запуска Chaos, чтобы при необходимости сохранять контекст конкретного выполнения.|
| --disable-move-replica-faults | Отключает отображение сообщения об ошибке при перемещении первичной реплики и вторичной реплики.|
| --max-cluster-stabilization| Максимальное время ожидания перехода всех сущностей кластера в устойчивое работоспособное состояние.  Значение по умолчанию: 60. Выполнение в Chaos проходит в режиме итераций. В начале каждой итерации выполняется проверка работоспособности сущностей кластера. Если сущность кластера не стабильна и не работоспособна в течение периода, заданного в MaxClusterStabilizationTimeoutInSeconds, Chaos генерирует событие сбоя проверки.|
| --max-concurrent-faults    | Максимальное количество одновременных ошибок, вызываемых при итерации.           Значение по умолчанию: 1. Выполнение в Chaos проходит в режиме итераций. Две последующие итерации отделены этапом проверки. Чем выше уровень параллелизма, тем более интенсивное внедрение ошибок, включая ряд более сложных состояний для выявления ошибок. Рекомендуется начать со значения 2 или 3 и соблюдать осторожность при его увеличении.|
| --max-percent-unhealthy-apps  | Во время оценки работоспособности кластера при выполнении службы Chaos: максимально допустимый процент неработоспособных приложений, по достижении которого сообщается об ошибке. Максимально допустимый процент неработоспособных приложений, по достижении которого отображается сообщение об ошибке. Например, чтобы разрешить 10 % неработоспособных приложений, это значение должно быть равно 10. Это значение указывает максимально допустимый процент неработоспособных приложений, превышение которого вызывает состояние "Error" при оценке кластера. Если процент учитывается, но имеется по крайней мере одно неработоспособное приложение, то состояние работоспособности оценивается как "Warning". Это значение вычисляется путем деления числа неработоспособных приложений на общее число экземпляров приложения в кластере, за исключением приложений, типы которых указаны в ApplicationTypeHealthPolicyMap. Расчет округляется: на небольшом количестве приложений допускается один сбой. Значение в процентах по умолчанию равняется нулю.|
| --max-percent-unhealthy-nodes | Во время оценки работоспособности кластера при выполнении службы Chaos: максимально допустимый процент неработоспособных узлов, по достижении которого сообщается об ошибке. Максимально допустимый процент неработоспособных узлов, по достижении которого отображается сообщение об ошибке. Например, чтобы разрешить 10 % неработоспособных узлов, это значение должно быть равно 10. Это значение указывает максимально допустимый процент неработоспособных узлов, превышение которого вызывает состояние "Error" при оценке кластера. Если процент учитывается, но имеется по крайней мере один неработоспособный узел, то состояние работоспособности оценивается как "Warning". Это процентное значение вычисляется путем деления числа неработоспособных узлов за общее число узлов в кластере. Расчет округляется: на небольшом количестве узлов допускается один сбой. Значение в процентах по умолчанию равняется нулю. В крупных кластерах всегда есть отключенные узлы или узлы в состоянии восстановления. Следует учитывать это при настройке параметра.|
| --time-to-run              | Общее время выполнения службы Chaos (в секундах) до того, как она будет автоматически остановлена. Максимально допустимое значение: 4 294 967 295 (System.UInt32.MaxValue).  Значение по умолчанию: 4 294 967 295.|
| --timeout -t               | Время ожидания сервера в секундах.  Значение по умолчанию: 60.|
| --wait-time-between-faults | Время ожидания (в секундах) между последовательными сбоями в пределах одной итерации.  Значение по умолчанию: 20. Чем больше значение, тем меньше перекрытие между сбоями и проще последовательность переходов состояний, которым подвергается кластер. Рекомендуется начать со значения 1–5 и соблюдать осторожность при его увеличении.|
| --wait-time-between-iterations| Интервал времени (в секундах) между двумя последовательными итерациями службы Chaos. Чем больше значение этого параметра, тем ниже скорость внедрения ошибок. Значение по умолчанию: 30.|
| --warning-as-error         | Во время оценки работоспособности кластера при выполнении службы Chaos: учет предупреждений с такой же степенью серьезности, что и у ошибок.|

### <a name="global-arguments"></a>Глобальные аргументы

|Аргумент|ОПИСАНИЕ|
| --- | --- |
| --debug                    | Увеличение уровня детализации ведения журнала для отображения всех журналов отладки.|
| --help -h                  | Отображение этого справочного сообщения и выход.|
| --output -o                | Формат выходных данных.  Допустимые значения: json, jsonc, table, tsv.           Значение по умолчанию: json.|
| --query                    | Строка запроса JMESPath. Дополнительные сведения и примеры см. на сайте http://jmespath.org/.|
| --verbose                  | Повышение уровня детализации ведения журнала. Используйте параметр --debug, чтобы получить полные журналы отладки.|

## <a name="sfctl-chaos-stop"></a>sfctl chaos stop
Останавливает службу Chaos в кластере, если она уже запущена. В противном случае он не выполняет никаких действий.

Служба Chaos перестает планировать дальнейшие ошибки, но это не влияет на активные ошибки.

### <a name="arguments"></a>Аргументы

|Аргумент|ОПИСАНИЕ|
| --- | --- |
| --timeout -t| Время ожидания сервера в секундах.  Значение по умолчанию: 60.|

### <a name="global-arguments"></a>Глобальные аргументы

|Аргумент|ОПИСАНИЕ|
| --- | --- |
| --debug  | Увеличение уровня детализации ведения журнала для отображения всех журналов отладки.|
| --help -h| Отображение этого справочного сообщения и выход.|
| --output -o | Формат выходных данных.  Допустимые значения: json, jsonc, table, tsv.  Значение по умолчанию: json.|
| --query  | Строка запроса JMESPath. Дополнительные сведения и примеры см. на сайте http://jmespath.org/.|
| --verbose| Повышение уровня детализации ведения журнала. Используйте параметр --debug, чтобы получить полные журналы отладки.|

## <a name="next-steps"></a>Дополнительная информация
- [Настройте](service-fabric-cli.md) интерфейс командной строки Service Fabric.
- Узнайте, как использовать интерфейс командной строки Service Fabric, с помощью [примеров сценариев](/azure/service-fabric/scripts/sfctl-upgrade-application).