---
title: Безопасность приложений Azure Service Fabric | Документация Майкрософт
description: Общие сведения о безопасном выполнении приложений для микрослужб в Service Fabric. Узнайте, как выполнять службы и сценарий запуска с различными учетными записями безопасности, аутентифицировать и авторизовать пользователей, управлять секретами приложений, защищать подключения служб, использовать шлюз API и обеспечивать безопасных неактивных данных приложений.
services: service-fabric
documentationcenter: .net
author: rwike77
manager: timlt
editor: ''
ms.assetid: 4242a1eb-a237-459b-afbf-1e06cfa72732
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: conceptual
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 03/16/2018
ms.author: ryanwi
ms.openlocfilehash: fa6d46186ad833b68e60c24f742d210b7845759a
ms.sourcegitcommit: eb75f177fc59d90b1b667afcfe64ac51936e2638
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/16/2018
ms.locfileid: "34207916"
---
# <a name="service-fabric-application-and-service-security"></a>Безопасность приложений и служб Service Fabric
Архитектура микрослужб может обеспечить [множество преимуществ](service-fabric-overview-microservices.md). Тем не менее управление безопасностью микрослужб является непростой задачей и отличается от управления безопасностью традиционных неделимых приложений. 

Неделимое приложение, как правило, выполняется на одном или нескольких серверах в сети, и для него проще определить открытые порты, интерфейсы API и IP-адрес. Обычно имеется один периметр или граница и одна база данных, которую требуется защитить. В случае компрометации такой системы из-за бреши в системе безопасности или атаки вполне вероятно, что все данные в системе будут доступны злоумышленнику. При использовании микрослужб система усложняется.  Службы децентрализованы и распределены между несколькими узлами. Они также могут перемещаться с одного узла на другой.  При правильной системе безопасности ограничиваются как возможности злоумышленника для получения привилегий, так и объем данных, доступных для отдельной атаки, нарушающей безопасность одной службы.  Обмен данными не является внутренним, но осуществляется по сети, и между службами существует много открытых портов и операций взаимодействия. Знать, как именно и когда взаимодействуют службы, крайне важно для безопасности приложений.

Эта статья не является руководством по безопасности микрослужбами, в Интернете представлено достаточно таких материалов. В ней описываются различные аспекты безопасности, реализуемые в Service Fabric.

## <a name="authentication-and-authorization"></a>Аутентификация и авторизация
Часто возникает необходимость ограничить доступ к ресурсам и интерфейсам API службы, предоставив его определенным доверенным пользователям или клиентам. Аутентификация — это процесс надежной проверки подлинности пользователя.  Авторизация — это процесс, который позволяет предоставить интерфейсы API или службы некоторым из аутентифицированных пользователей.

### <a name="authentication"></a>Authentication
Первым шагом для принятия решений о доверии уровня API является выбор аутентификации. Аутентификация — это процесс надежной проверки подлинности пользователя.  В сценариях с микрослужбами управление аутентификацией обычно осуществляется централизованно. При использовании шлюза API можно [разгрузить аутентификацию](/azure/architecture/patterns/gateway-offloading) на шлюз. При использовании этого подхода убедитесь, что к отдельным службам невозможно обратиться напрямую (минуя шлюз API), если только не реализована дополнительная защита для аутентификации сообщений — поступили они от шлюза или нет.

Если доступ к службам можно получить напрямую, то для аутентификации пользователей можно использовать такую службу аутентификации, как Azure Active Directory или выделенная микрослужба аутентификации, которая выступает в роли службы токенов безопасности (STS). Решения о доверии передаются между службами с помощью маркеров безопасности или файлов cookie. 

Для ASP.NET Core основным механизмом [аутентификации пользователей](/dotnet/standard/microservices-architecture/secure-net-microservices-web-applications/) является система членства в ASP.NET Core Identity. В ASP.NET Core Identity в хранилище данных, настроенном разработчиком, хранятся сведения о пользователях (включая данные для входа, роли и утверждений). ASP.NET Core Identity поддерживает двухфакторную проверку подлинности.  Поставщики внешней аутентификации также поддерживаются, поэтому пользователи могут выполнять вход с помощью имеющихся процессов аутентификации от таких поставщиков, как корпорация Майкрософт, Google, Facebook или Twitter. 

### <a name="authorization"></a>Авторизация
После аутентификации службы должны предоставить пользователю доступ или определить, какие операции пользователь может выполнять. Этот процесс позволяет службе предоставить интерфейсы API некоторым из пользователей, прошедших аутентификацию, но не всем. Авторизация является самостоятельной и не зависит от аутентификации, которая позволяет установить подлинность пользователя. При использовании аутентификации возможно создание одного или нескольких удостоверений для текущего пользователя.

[Авторизация ASP.NET Core](/dotnet/standard/microservices-architecture/secure-net-microservices-web-applications/authorization-net-microservices-web-applications) может выполняться на основе ролей пользователей или пользовательской политики, которая может включать в себя проверку утверждений или другие эвристические методы.

## <a name="restrict-and-secure-access-using-an-api-gateway"></a>Ограничение и защита доступа с помощью шлюза API
Обычно, облачным приложениям требуется интерфейсный шлюз, который предоставляет единую точку передачи входящего трафика пользователей, устройств или других приложений. [Шлюз API](/azure/architecture/microservices/gateway) располагается между клиентами и службами и является точкой входа для всех служб, предоставляемых вашим приложением. Он выполняет роль обратного прокси-сервера, который перенаправляет запросы от клиентов к службам. Он также может выполнять такие специализированные задачи, как аутентификация и авторизация, завершение SSL-запросов и ограничение частоты. Если этот шлюз не будет развернут, клиенты должны будут отправлять запросы непосредственно к внешним службам.

В Service Fabric в качестве шлюза может выступать любая служба без отслеживания состояния, например [приложение ASP.NET Core](service-fabric-reliable-services-communication-aspnetcore.md), или другая служба, предназначенная для обработки входящего трафика, например [Træfik](https://docs.traefik.io/), [концентраторы событий](https://docs.microsoft.com/azure/event-hubs/), [Центр Интернета вещей](https://docs.microsoft.com/azure/iot-hub/) или [служба управления API Azure](https://docs.microsoft.com/azure/api-management).

Служба управления API непосредственно интегрируется с Service Fabric. Это позволяет публиковать интерфейсы API с широким набором правил маршрутизации к внутренним службам Service Fabric.  Можно защитить доступ к внутренним службам, предотвращать DOS-атаки с помощью регулирования или проверять ключи API, токены JWT, сертификаты и другие учетные данные. Чтобы узнать больше, прочитайте раздел [Общие сведения о Service Fabric со службой управления API Azure](service-fabric-api-management-overview.md).

## <a name="manage-application-secrets"></a>Управление секретами приложений
Секретом может считаться любая конфиденциальная информации, например строка подключения к хранилищу, пароль или другое значение, которое не должно обрабатываться в виде обычного текста. В этой статье для управления ключами и секретами используется Azure Key Vault. Однако *использование* секретов в приложении осуществляется без привязки к определенной облачной платформе, чтобы приложения могли быть развернуты в кластере, размещенном в любом месте.

Для управления параметрами конфигурации службы рекомендуется использовать [пакеты конфигурации службы][config-package]. Пакеты конфигурации имеют числовые версии, которые можно обновлять, используя управляемые последовательные обновления с проверкой работоспособности и автоматическим откатом обновления. Это предпочтительно для глобальной конфигурации, так как уменьшает вероятность глобального простоя службы. Зашифрованные секреты не являются исключением. Служба Service Fabric снабжена встроенными компонентами для шифрования и расшифровки значений в файле Settings.xml пакета конфигурации. При этом используется сертификат шифрования.

На этой схеме показаны основные этапы процесса управления секретами в приложении Service Fabric:

![обзор управления секретами][overview]

Этот поток состоит из четырех основных шагов.

1. Получение сертификата шифрования данных.
2. Установка сертификата в кластере.
3. Шифрование значений секретов при развертывании приложения с помощью сертификата и их включение в файл конфигурации Settings.xml службы.
4. Чтение зашифрованных значений из файла Settings.xml. Для расшифровки используется тот же сертификат шифрования. 

В качестве безопасного расположения для хранения сертификатов здесь используется [хранилище ключей Azure][key-vault-get-started]. С его помощью сертификаты также устанавливаются в кластеры Service Fabric в Azure. Если вы не выполняете развертывание в Azure, то использование хранилища ключей для управления секретами в приложениях Service Fabric не требуется.

Пример доступен в разделе [Управление секретами в приложениях Service Fabric](service-fabric-application-secret-management.md).

## <a name="secure-the-hosting-environment"></a>Защита среды размещения
Платформа Azure Service Fabric помогает защищать приложения, работающие в кластере под разными учетными записями. Кроме того, платформа помогает защищать ресурсы, используемые приложениями при развертывании с помощью учетных записей, например файлы, каталоги и сертификаты. Это позволяет изолировать друг от друга выполняемые приложения, даже если они запущены в общей среде.

В манифесте приложения объявляются субъекты безопасности (пользователи и группы), которым требуется выполнять службы, и защищенные ресурсы.  Эти субъекты безопасности указываются в политиках, например в политиках запуска от имени, привязки конечных точек, безопасности, совместного доступа к пакетам или политиках безопасности доступа.  Эти политики применяются к ресурсам службы в разделе **ServiceManifestImport** манифеста приложения.

При объявлении субъектов можно также определить и создать группы пользователей, а затем добавить в них пользователей для совместного управления. Это полезно, если для разных точек входа службы есть несколько пользователей и у них должны быть определенные общие права, доступные на уровне группы.

По умолчанию приложения Service Fabric выполняются под учетной записью, используемой процессом Fabric.exe. Платформа также позволяет запускать приложения под учетной записью локального пользователя или локальной системы, указанной в манифесте приложения. Дополнительные сведения см. в разделе [Запуск службы с использованием учетной записи локального пользователя или локальной системы](service-fabric-application-runas-security.md).  Можно также [выполнить сценарий запуска службы с использованием локальной или системной учетной записи](service-fabric-run-script-at-service-startup.md).

При запуске Service Fabric в изолированном кластере Windows службу можно запустить с помощью [учетных записей домена Active Directory](service-fabric-run-service-as-ad-user-or-group.md) или [групповых управляемых учетных записей службы](service-fabric-run-service-as-gmsa.md).

## <a name="secure-containers"></a>Безопасные контейнеры
Service Fabric предоставляет для служб в контейнере механизм, который обеспечивает доступ к сертификату, установленному на узлах кластера Windows или Linux (версии 5.7 или выше). Этот PFX-файл сертификата можно использовать для аутентификации приложения или службы, а также для безопасного обмена данными с другими службами. Дополнительные сведения см. в разделе [Безопасность контейнера](service-fabric-securing-containers.md).

Кроме того, Service Fabric поддерживает групповые управляемые учетные записи службы (gMSA) для контейнеров Windows. Дополнительные сведения см. в разделе [Set up gMSA for Windows containers running on Service Fabric](service-fabric-setup-gmsa-for-windows-containers.md) (Настройка групповой управляемой учетной записи службы для контейнеров Windows).

## <a name="secure-service-communication"></a>Защита взаимодействия со службой
Служба Service Fabric, запущенная в кластере Service Fabric, обычно распределена между несколькими виртуальными машинами. Service Fabric предоставляет несколько вариантов защиты взаимодействия со службой.

Можно включить конечные точки HTTPS в веб-службах [ASP.NET Core или Java](service-fabric-service-manifest-resources.md#example-specifying-an-https-endpoint-for-your-service).

Можно установить безопасное подключение между обратным прокси-сервером и службами, которое будет использоваться в качестве защищенного сквозного канала. Подключение к защищенным службам поддерживается, только если обратный прокси-сервер настроен для прослушивания по протоколу HTTPS. Сведения о настройке обратного прокси-сервера см. в статье [Обратный прокси-сервер в Azure Service Fabric](service-fabric-reverseproxy.md).  В разделе [Подключение к защищенной службе с помощью обратного прокси-сервера](service-fabric-reverseproxy-configure-secure-communication.md) описывается установление безопасного подключения между обратным прокси-сервером и службами.

Платформа приложений Reliable Services предоставляет несколько готовых стеков взаимодействия и средств, которыми можно воспользоваться для повышения безопасности. Узнайте, как повысить безопасность при использовании удаленного взаимодействия со службой (используя язык [C#](service-fabric-reliable-services-secure-communication.md) или [Java](service-fabric-reliable-services-secure-communication-java.md)) либо при использовании [WCF](service-fabric-reliable-services-secure-communication-wcf.md).

## <a name="encrypt-application-data-at-rest"></a>Шифрование неактивных данных приложения
Каждому [типу узла](service-fabric-cluster-nodetypes.md) в кластере Service Fabric в Azure соответствует [масштабируемый набор виртуальных машин](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md). С помощью шаблона Azure Resource Manager можно подключать диски данных к масштабируемым наборам, которые входят в кластер Service Fabric.  Если ваши службы сохраняют данные на подключенный диск данных, вы можете [зашифровать этот диск данных](../virtual-machine-scale-sets/virtual-machine-scale-sets-encrypt-disks-ps.md), чтобы защитить данные приложения.

<!--TO DO: Enable BitLocker on Windows standalone clusters?
TO DO: Encrypt disks on Linux clusters?-->


<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->
## <a name="next-steps"></a>Дополнительная информация
* [Выполнение сценария настройки при запуске службы](service-fabric-run-script-at-service-startup.md)
* [Указание ресурсов в манифесте службы](service-fabric-service-manifest-resources.md)
* [Развертывание приложения](service-fabric-deploy-remove-applications.md)
* [Дополнительные сведения о безопасности кластеров](service-fabric-cluster-security.md)

<!-- Links -->
[key-vault-get-started]:../key-vault/key-vault-get-started.md
[config-package]: service-fabric-application-and-service-manifests.md
[service-fabric-cluster-creation-via-arm]: service-fabric-cluster-creation-via-arm.md

<!-- Images -->
[overview]:./media/service-fabric-application-and-service-security/overview.png