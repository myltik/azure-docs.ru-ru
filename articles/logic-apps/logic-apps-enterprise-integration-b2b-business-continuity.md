---
title: Аварийное восстановление учетной записи интеграции B2B в Azure Logic Apps | Документация Майкрософт
description: Аварийное восстановление B2B в Logic Apps
services: logic-apps
documentationcenter: .net,nodejs,java
author: padmavc
manager: jeconnoc
editor: ''
ms.assetid: cf44af18-1fe5-41d5-9e06-cc57a968207c
ms.service: logic-apps
ms.workload: integration
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/10/2017
ms.author: LADocs; padmavc
ms.openlocfilehash: 65c7262916219a74dcd6bdab487306b5bd5f709f
ms.sourcegitcommit: 6f6d073930203ec977f5c283358a19a2f39872af
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "35299102"
---
# <a name="logic-apps-b2b-cross-region-disaster-recovery"></a>Межрегиональное аварийное восстановление Logic Apps B2B

Рабочие нагрузки B2B включают денежные транзакции, например заказы и счета. Для компаний в случае аварии чрезвычайно важно быстро восстановить систему для соответствия Соглашениям об уровне обслуживания корпоративного уровня по договоренности с партнерами. В этой статье описывается создание плана обеспечения непрерывности бизнес-процессов для рабочих нагрузок B2B. 

* Готовность к аварийному восстановлению 
* Отработка отказа в дополнительный регион во время аварии 
* Восстановление размещения в основной регион после аварийного восстановления

## <a name="disaster-recovery-readiness"></a>Готовность к аварийному восстановлению  

1. Выберите дополнительный регион и создайте в нем [учетную запись интеграции](../logic-apps/logic-apps-enterprise-integration-create-integration-account.md).

2. Добавьте партнеров, схемы и соглашения для необходимых потоков сообщений, в которых состояние выполнения нужно реплицировать в учетную запись интеграции дополнительного региона.

   > [!TIP]
   > Соглашения об именовании артефактов учетной записи интеграции в регионах должны быть согласованы. 

3. Чтобы получить состояние выполнения из основного региона, создайте приложение логики в дополнительном регионе. 

   Приложение логики должно включать *триггер* и *действие*. 
   Триггер необходимо подключить к учетной записи интеграции основного региона, а действие — к учетной записи интеграции дополнительного региона. 
   В зависимости от интервала времени триггер выполняет опрос таблицы состояния выполнения для основного региона и извлекает новые записи при их наличии, а действие обновляет сведения о записях в учетной записи интеграции дополнительного региона. 
   Это позволяет передать добавочное состояние среды выполнения из основного региона в дополнительный.

4. Непрерывность бизнес-процессов в учетной записи интеграции Logic Apps поддерживает протоколы на базе B2B — X12, AS2 и EDIFACT. Чтобы получить дополнительные сведения, используйте соответствующие ссылки.

5. Мы рекомендуем также развернуть все ресурсы основного региона 

   (например, базы данных SQL Azure и Azure Cosmos DB, служебную шину и концентраторы уведомлений Azure, используемые для обмена сообщениями, управление API Azure и компонент Azure Logic Apps в службе приложений Azure) в дополнительном регионе.   

6. Установите подключение между основным и дополнительным регионом. Чтобы получить состояние выполнения из основного региона, создайте приложение логики в дополнительном регионе. 

   Приложение логики должно включать триггер и действие. 
   Триггер необходимо подключить к учетной записи интеграции для основного региона, 
   а действие — к учетной записи интеграции для дополнительного региона. 
   В зависимости от интервала времени триггер выполняет опрос таблицы состояния выполнения для основного региона и извлекает новые записи при их наличии, 
   а действие обновляет сведения о записях в учетной записи интеграции дополнительного региона. 
   Этот процесс позволяет передать добавочное состояние среды выполнения из основного региона в дополнительный.

Непрерывность бизнес-процессов в учетной записи интеграции Logic Apps поддерживает протоколы на базе B2B — X12, AS2 и EDIFACT. Подробные инструкции по использованию протоколов X12 и AS2 см. в [этом](../logic-apps/logic-apps-enterprise-integration-b2b-business-continuity.md#x12) и в [этом](../logic-apps/logic-apps-enterprise-integration-b2b-business-continuity.md#as2) разделе данной статьи.

## <a name="fail-over-to-a-secondary-region-during-a-disaster-event"></a>Отработка отказа в дополнительный регион во время аварии

Во время аварийного события, когда основной регион является недоступным для обеспечения непрерывности бизнес-процессов, перенаправьте трафик к дополнительному региону. Дополнительный регион помогает компании быстро восстановить работу в соответствии с показателями RPO и RTO, согласованными с партнерами. При использовании этого региона очень просто выполнить отработку отказа из одного региона в другой. 

При копировании контрольных номеров из основного региона в дополнительный вы столкнетесь с ожидаемой задержкой. Чтобы избежать отправки повторно созданных контрольных номеров партнерам во время аварийного события, мы рекомендуем увеличивать эти номера в соглашениях для дополнительного региона с помощью [командлетов PowerShell](https://blogs.msdn.microsoft.com/david_burgs_blog/2017/03/09/fresh-of-the-press-new-azure-powershell-cmdlets-for-upcoming-x12-connector-disaster-recovery).

## <a name="fall-back-to-a-primary-region-post-disaster-event"></a>Восстановление размещения в основной регион после аварийного восстановления

Чтобы восстановить размещение в основной регион (если он доступен), сделайте следующее:

1. Не принимайте сообщения от партнеров в дополнительном регионе.  

2. Увеличьте создаваемые контрольные номера для всех соглашений основного региона с помощью [командлетов PowerShell](https://blogs.msdn.microsoft.com/david_burgs_blog/2017/03/09/fresh-of-the-press-new-azure-powershell-cmdlets-for-upcoming-x12-connector-disaster-recovery).  

3. Перенаправьте трафик из дополнительного региона в основной.

4. Проверьте, включено ли приложение логики, созданное в дополнительном регионе, чтобы передать состояние выполнения из основного региона.

## <a name="x12"></a>X12 

Для непрерывности бизнес-процессов для документов EDI X12 используются контрольные номера:

> [!TIP]
> Чтобы создать приложения логики, вы также можете использовать [шаблон быстрого запуска X12](https://azure.microsoft.com/documentation/templates/201-logic-app-x12-disaster-recovery-replication/). Для использования этого шаблона необходимо создать учетные записи интеграции для основного и дополнительного регионов. С помощью шаблона вы создадите два приложения логики: одно для полученного контрольного номера, а второе — для созданного. Соответствующие триггеры и действия создаются в Logic Apps. Триггер подключается к учетной записи интеграции для основного региона, а действие — к учетной записи интеграции для дополнительного региона.

**Предварительные требования**

Чтобы включить аварийное восстановление для входящих сообщений, выберите параметры проверки дублирования в разделе с настройками получения соглашения X12.

![Выбор параметров проверки дублирования](./media/logic-apps-enterprise-integration-b2b-business-continuity/dupcheck.png)  

1. Создайте [приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md) в дополнительном регионе.    

2. Выполните поиск **X12** и выберите **X12 — при изменении контрольного номера**.   

   ![Поиск по запросу "X12"](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn1.png)

   При выборе триггера вам будет предложено установить соединение с учетной записью интеграции. 
   Триггер необходимо подключить к учетной записи интеграции для основного региона.

3. Присвойте имя для подключения, выберите из списка свою *учетную запись интеграции для основного региона*, а затем выберите **Создать**.   

   ![Имя учетной записи интеграции для основного региона](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn2.png)

4. Параметр **Дата и время начала синхронизации контрольного номера** является необязательным. Вы можете задать **частоту** с интервалом в **днях**, **часах**, **минутах** или **секундах**.   

   ![Дата, время и частота](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn3.png)

5. Выберите **New step** (Новый шаг) > **Добавить действие**.

   ![Выбор действий "Новый шаг" и "Добавить действие"](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn4.png)

6. Выполните поиск **X12** и выберите **X12 — добавление или изменение контрольных номеров**.   

   ![Добавление или обновление контрольных номеров](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn5.png)

7. Для подключения действия к учетной записи интеграции для дополнительного региона выберите **Change connection** (Изменить подключение) > **Добавить новое подключение**, чтобы получить список доступных учетных записей интеграции. Введите имя для подключения, выберите из списка свою *учетную запись интеграции для дополнительного региона*, а затем выберите **Создать**. 

   ![Имя учетной записи интеграции для дополнительного региона](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn6.png)

8. Переключитесь на необработанные входные данные, щелкнув значок в правом верхнем углу.

   ![Переключение на необработанные входные данные](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12rawinputs.png)

9. Выберите "Текст" с помощью средства выбора динамического содержимого и сохраните приложение логики.

   ![Поля динамического содержимого](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn7.png)

   В зависимости от интервала времени триггер выполняет опрос таблицы полученных контрольных номеров для основного региона и извлекает новые записи при их наличии, 
   а действие обновляет сведения о записях в учетной записи интеграции дополнительного региона. 
   Если эти сведения не обновляются, состояние триггера отображается как **Пропущено**.   

   ![Таблица контрольных номеров](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12recevicedcn8.png)

В зависимости от интервала времени дополнительное состояние о среде выполнения реплицируется из основного региона в дополнительный. Во время аварийного события, когда основной регион является недоступным, перенаправьте трафик к дополнительному региону для обеспечения непрерывности бизнес-процессов. 

## <a name="edifact"></a>EDIFACT 

Чтобы обеспечить непрерывность бизнес-процессов для документов EDIFACT EDI, используются контрольные номера.

**Предварительные требования**

Чтобы включить аварийное восстановление для входящих сообщений, выберите параметры проверки дублирования в разделе с настройками получения соглашения EDIFACT.

![Выбор параметров проверки дублирования](./media/logic-apps-enterprise-integration-b2b-business-continuity/edifactdupcheck.png)  

1. Создайте [приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md) в дополнительном регионе.    

2. Выполните поиск **EDIFACT** и выберите **EDIFACT — при изменении контрольного номера**.

   ![Поиск по запросу "EDIFACT"](./media/logic-apps-enterprise-integration-b2b-business-continuity/edifactcn1.png)

   При выборе триггера вам будет предложено установить соединение с учетной записью интеграции. 
   Триггер необходимо подключить к учетной записи интеграции для основного региона. 

3. Присвойте имя для подключения, выберите из списка свою *учетную запись интеграции для основного региона*, а затем выберите **Создать**.    

   ![Имя учетной записи интеграции для основного региона](./media/logic-apps-enterprise-integration-b2b-business-continuity/X12CN2.png)

4. Параметр **Дата и время начала синхронизации контрольного номера** является необязательным. Вы можете задать **частоту** с интервалом в **днях**, **часах**, **минутах** или **секундах**.    

   ![Дата, время и частота](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn3.png)

6. Выберите **New step** (Новый шаг) > **Добавить действие**.    

   ![Выбор действий "Новый шаг" и "Добавить действие"](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn4.png)

7. Выполните поиск **EDIFACT** и выберите **EDIFACT — добавление и изменение контрольных номеров**.   

   ![Добавление или обновление контрольных номеров](./media/logic-apps-enterprise-integration-b2b-business-continuity/EdifactChooseAction.png)

8. Для подключения действия к учетной записи интеграции для дополнительного региона выберите **Change connection** (Изменить подключение) > **Добавить новое подключение**, чтобы получить список доступных учетных записей интеграции. Введите имя для подключения, выберите из списка свою *учетную запись интеграции для дополнительного региона*, а затем выберите **Создать**.

   ![Имя учетной записи интеграции для дополнительного региона](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn6.png)

9. Переключитесь на необработанные входные данные, щелкнув значок в правом верхнем углу.

   ![Переключение на необработанные входные данные](./media/logic-apps-enterprise-integration-b2b-business-continuity/Edifactrawinputs.png)

10. Выберите "Текст" с помощью средства выбора динамического содержимого и сохраните приложение логики.   

   ![Поля динамического содержимого](./media/logic-apps-enterprise-integration-b2b-business-continuity/X12CN7.png)

   В зависимости от интервала времени триггер выполняет опрос таблицы полученных контрольных номеров для основного региона и извлекает новые записи при их наличии,
   а действие обновляет сведения о записях в учетной записи интеграции дополнительного региона. 
   Если эти сведения не обновляются, состояние триггера отображается как **Пропущено**.

   ![Таблица контрольных номеров](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12recevicedcn8.png)

В зависимости от интервала времени дополнительное состояние о среде выполнения реплицируется из основного региона в дополнительный. Во время аварийного события, когда основной регион является недоступным, перенаправьте трафик к дополнительному региону для обеспечения непрерывности бизнес-процессов. 

## <a name="as2"></a>AS2 

Для непрерывности бизнес-процессов для документов, использующих протокол AS2, используется идентификатор сообщения и значение MIC.

> [!TIP]
> Чтобы создать приложения логики, вы также можете использовать [шаблон быстрого запуска AS2](https://github.com/Azure/azure-quickstart-templates/pull/3302). Для использования этого шаблона необходимо создать учетные записи интеграции для основного и дополнительного регионов. Шаблон позволяет создать приложение логики с триггером и действием. Приложение логики создает подключение от триггера к учетной записи интеграции для основного региона и подключение от действия к учетной записи интеграции для дополнительного региона.

1. Создайте [приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md) в дополнительном регионе.  

2. Выполните поиск **AS2** и выберите **AS2 — When a MIC value is created** (AS2 — При создании значения MIC).   

   ![Поиск по запросу "AS2"](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid1.png)

   При выборе триггера вам будет предложено установить соединение с учетной записью интеграции. 
   Триггер необходимо подключить к учетной записи интеграции для основного региона. 
   
3. Присвойте имя для подключения, выберите из списка свою *учетную запись интеграции для основного региона*, а затем выберите **Создать**.

   ![Имя учетной записи интеграции для основного региона](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid2.png)

4. Параметр **DateTime to start MIC value sync** (Дата и время для запуска синхронизации значения MIC) является необязательным. Вы можете задать **частоту** с интервалом в **днях**, **часах**, **минутах** или **секундах**.   

   ![Дата, время и частота](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid3.png)

5. Выберите **New step** (Новый шаг) > **Добавить действие**.  

   ![Выбор действий "Новый шаг" и "Добавить действие"](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid4.png)

6. Выполните поиск **AS2** и выберите **AS2 - Add or update MIC contents** (AS2 — Добавление или обновление содержимого MIC).  

   ![Добавление или обновление MIC](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid5.png)

7. Для подключения действия к учетной записи интеграции для дополнительного региона выберите **Change connection** (Изменить подключение) > **Добавить новое подключение**, чтобы получить список доступных учетных записей интеграции. Введите имя для подключения, выберите из списка свою *учетную запись интеграции для дополнительного региона*, а затем выберите **Создать**.

   ![Имя учетной записи интеграции для дополнительного региона](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid6.png)

8. Переключитесь на необработанные входные данные, щелкнув значок в правом верхнем углу.

   ![Переключение на необработанные входные данные](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2rawinputs.png)

9. Выберите "Текст" с помощью средства выбора динамического содержимого и сохраните приложение логики.   

   ![Динамическое содержимое](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid7.png)

   В зависимости от интервала времени триггер выполняет опрос таблицы для основного региона и извлекает новые записи, а действие обновляет сведения о записях в учетной записи интеграции дополнительного региона. 
   Если эти сведения не обновляются, состояние триггера отображается как **Пропущено**.  

   ![Таблица для основного региона](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid8.png)

В зависимости от интервала времени дополнительное состояние о среде выполнения реплицируется из основного региона в дополнительный. Во время аварийного события, когда основной регион является недоступным, перенаправьте трафик к дополнительному региону для обеспечения непрерывности бизнес-процессов. 

## <a name="next-steps"></a>Дополнительная информация

[Мониторинг сообщений B2B](logic-apps-monitor-b2b-message.md)

