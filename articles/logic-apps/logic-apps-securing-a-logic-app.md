---
title: Безопасный доступ в Azure Logic Apps | Документация Майкрософт
description: Узнайте, как повысить уровень безопасности для защиты доступа к триггерам, входным и выходным данным, параметрам действий и службам, используемым с рабочими процессами в Azure Logic Apps.
services: logic-apps
documentationcenter: .net,nodejs,java
author: jeffhollan
manager: jeconnoc
editor: ''
ms.assetid: 9fab1050-cfbc-4a8b-b1b3-5531bee92856
ms.service: logic-apps
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: integration
ms.date: 11/22/2016
ms.author: LADocs; jehollan
ms.openlocfilehash: 2052e58dab7241836409fb013778f9702004021c
ms.sourcegitcommit: 6f6d073930203ec977f5c283358a19a2f39872af
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "35299915"
---
# <a name="secure-access-to-your-logic-apps"></a>Безопасный доступ к приложениям логики

Существует множество средств для защиты приложения логики.

* Защита доступа к активации приложения логики (триггер HTTP-запросов).
* Защита доступа к управлению приложением логики, а также изменению или считыванию его.
* Защита доступа к содержимому входных и выходных данных для выполнения.
* Обеспечение безопасности параметров или входных данных в рамках действий в рабочем процессе.
* Защита доступа к службам, которые получают запросы от рабочего процесса.

## <a name="secure-access-to-trigger"></a>Защита доступа к активации

При работе с приложением логики, которое запускает HTTP-запрос ([запрос](../connectors/connectors-native-reqres.md) или [webhook](../connectors/connectors-native-webhook.md)), можно ограничить доступ таким образом, чтобы его могли запускать только авторизованные клиенты. Все запросы к приложению логики зашифрованы и защищены с помощью SSL.

### <a name="shared-access-signature"></a>Подписанный URL-адрес

Как часть URL-адреса каждой конечной точки запроса для приложения логики используется [подписанный URL-адрес](../storage/common/storage-dotnet-shared-access-signature-part-1.md) (SAS). Каждый URL-адрес содержит параметр запроса `sp`, `sv` и `sig`. Разрешения указываются с помощью параметра `sp` и соответствуют разрешенным методам HTTP. `sv` — это версия, используемая для создания, а `sig` используется для проверки подлинности доступа к активации. Подпись создается с использованием алгоритма SHA256 с секретным ключом для всех URL-путей и свойств. Секретный ключ хранится как часть приложения логики в зашифрованном виде, никогда не раскрывается и не публикуется. Приложение логики авторизует только те триггеры, которые содержат действительную подпись, созданную с помощью секретного ключа.

#### <a name="regenerate-access-keys"></a>Повторное создание ключей доступа

Вы можете в любое время повторно создать ключ безопасности с помощью REST API или портала Azure. Все текущие URL-адреса, созданные ранее с помощью старого ключа, станут недействительны, и их нельзя будет использовать для запуска приложения логики.

1. На портале Azure откройте приложение логики, для которого необходимо повторно создать ключ.
1. В разделе **Параметры** щелкните пункт меню **Ключи доступа**.
1. Выберите ключ, который необходимо создать повторно, и завершите процесс.

URL-адреса, полученные после повторного создания, будут подписаны с помощью нового ключа доступа.

#### <a name="creating-callback-urls-with-an-expiration-date"></a>Создание URL-адреса обратного вызова с истекшим сроком действия

Если URL-адрес используется совместно с другими участниками, можно создать URL-адреса с конкретными ключами и датами окончания срока действия. Это позволит легко изменять ключи и обеспечит ограничение на допуск к приложению в течение определенного интервала времени. Вы можете задать дату окончания срока действия для URL-адреса с помощью [REST API для Logic Apps](https://docs.microsoft.com/rest/api/logic/workflowtriggers):

``` http
POST 
/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{workflowName}/triggers/{triggerName}/listCallbackUrl?api-version=2016-06-01
```

Добавьте свойство `NotAfter` в текст как строку даты JSON, возвращающую URL-адрес обратного вызова, который будет действителен только до даты и времени, заданных в параметре `NotAfter`.

#### <a name="creating-urls-with-primary-or-secondary-secret-key"></a>Создание URL-адресов с использованием первичного или вторичного секретного ключа

При создании или перечислении URL-адресов обратного вызова для триггеров на основе запросов можно указать ключ, который нужно использовать для подписи URL-адреса.  Вы можете создать URL-адрес, подписанный с использованием конкретного ключа, с помощью [REST API для Logic Apps](https://docs.microsoft.com/rest/api/logic/workflowtriggers) следующим образом:

``` http
POST 
/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{workflowName}/triggers/{triggerName}/listCallbackUrl?api-version=2016-06-01
```

Добавьте свойство `KeyType` в текст со значением `Primary` или `Secondary`.  В результате будет возвращен URL-адрес, подписанный с помощью указанного ключа безопасности.

### <a name="restrict-incoming-ip-addresses"></a>Ограничение входящих IP-адресов

В дополнение к подписанному URL-адресу можно разрешить вызов приложения логики только конкретным клиентам.  Например, если вы управляете своей конечной точкой с помощью управления API Azure, можно настроить приложение логики принимать только те запросы, которые поступают с IP-адреса экземпляра управления API.

Этот параметр можно настроить в настройках приложения логики, выполнив следующие действия:

1. На портале Azure откройте приложение логики, для которого необходимо добавить ограничения IP-адресов.
1. В меню **Параметры** выберите пункт **Параметры рабочего процесса**.
1. Укажите список диапазонов IP-адресов, которые будет принимать триггер.

Допустимый диапазон IP-адресов имеет формат `192.168.1.1/255`. Если нужно запускать приложение логики только в виде вложенного приложения, установите параметр **Only other logic apps** (Только другие приложения логики). В ресурс будет записан пустой массив, а это означает, что будут запускаться только вызовы из самой службы (родительского приложения логики).

> [!NOTE]
> Приложение логики с триггером запросов может по-прежнему выполняться с помощью REST API или управления API `/triggers/{triggerName}/run` независимо от IP-адреса. Для этого потребуется аутентификация с помощью Azure REST API, а все события отобразятся в журнале аудита Azure. Настройте политики контроля доступа соответствующим образом.

#### <a name="setting-ip-ranges-on-the-resource-definition"></a>Задание диапазонов IP-адресов в определении ресурсов

При использовании [шаблона развертывания](logic-apps-create-deploy-template.md) для автоматизации развертывания можно настроить параметры диапазона IP-адресов в шаблоне ресурсов.  

``` json
{
    "properties": {
        "definition": {
        },
        "parameters": {},
        "accessControl": {
            "triggers": {
                "allowedCallerIpAddresses": [
                    {
                        "addressRange": "192.168.12.0/23"
                    },
                    {
                        "addressRange": "2001:0db8::/64"
                    }
                ]
            }
        }
    },
    "type": "Microsoft.Logic/workflows"
}

```

### <a name="adding-azure-active-directory-oauth-or-other-security"></a>Добавление Azure Active Directory, OAuth или других механизмов безопасности

Если нужно добавить дополнительные протоколы авторизации для приложения логики, используйте [управление API Azure](https://azure.microsoft.com/services/api-management/). Это обеспечит обширные возможности мониторинга, дополнительные средства безопасности, политики и документацию для любой конечной точки, а также возможность предоставлять приложение логики в качестве API. Служба управления API Azure может предоставлять общедоступную или частную конечную точку для приложения логики, которая может использовать Azure Active Directory, сертификат, OAuth или другие методы безопасности. После получения запроса служба управления API Azure пересылает запрос в приложение логики (выполняя все необходимые преобразования или ограничения на лету). Чтобы разрешить приложению запускаться только с помощью управления API, можно использовать параметры диапазона входящих IP-адресов для приложения логики.

## <a name="secure-access-to-manage-or-edit-logic-apps"></a>Безопасный доступ для изменения приложений логики или управления ими

Можно ограничить доступ к операциям управления в приложении логики таким образом, чтобы только определенные пользователи или группы могли выполнять операции с ресурсом. Приложения логики используют функцию [управления доступом на основе ролей (RBAC)](../role-based-access-control/role-assignments-portal.md) Azure, и их можно настроить с помощью тех же средств.  Существует несколько встроенных ролей, которые также можно назначить членам подписки:

* **Создатель приложений логики** — просмотр, редактирование и обновление приложения логики.  Эта роль не позволяет удалить ресурс или выполнять операции администрирования.
* **Оператор приложений логики** — просмотр приложения логики и журнала выполнения, а также включение или отключение приложения.  Эта роль не позволяет изменять или обновлять определение.

Кроме того, можно использовать [блокировку ресурсов Azure](../azure-resource-manager/resource-group-lock-resources.md), чтобы предотвратить изменение или удаление приложений логики. Это позволяет предотвратить непреднамеренное изменение или удаление рабочих ресурсов.

## <a name="secure-access-to-contents-of-the-run-history"></a>Защита доступа к содержимому журнала выполнения

Вы можете ограничить доступ к содержимому входных и выходных данных из предыдущих выполнений, разрешив его только для определенных диапазонов IP-адресов.  

Все данные в рамках выполнения рабочего процесса шифруются при передаче и хранении. После вызова журнала выполнения служба проверяет подлинность запроса и предоставляет ссылки на входные и выходные данные запроса и ответа. Ссылка может быть защищена таким образом, что возвращать содержимое будут только запросы на просмотр содержимого из указанного диапазона IP-адресов. Эту возможность можно использовать в качестве дополнительного метода контроля доступа. Можно также указать IP-адрес в виде `0.0.0.0`, тогда никто не сможет получить доступ к входным и выходным данным. Только пользователь с правами администратора может снять это ограничение и предоставить возможность JIT-доступа к содержимому рабочего процесса.

Этот параметр можно настроить в параметрах ресурсов на портале Azure, выполнив следующие действия:

1. На портале Azure откройте приложение логики, для которого необходимо добавить ограничения IP-адресов.
2. В разделе **Параметры** щелкните пункт меню **Access control configuration** (Конфигурация контроля доступа).
3. Укажите список диапазонов IP-адресов для доступа к содержимому.

#### <a name="setting-ip-ranges-on-the-resource-definition"></a>Задание диапазонов IP-адресов в определении ресурсов

При использовании [шаблона развертывания](logic-apps-create-deploy-template.md) для автоматизации развертывания можно настроить параметры диапазона IP-адресов в шаблоне ресурсов.  

``` json
{
    "properties": {
        "definition": {
        },
        "parameters": {},
        "accessControl": {
            "contents": {
                "allowedCallerIpAddresses": [
                    {
                        "addressRange": "192.168.12.0/23"
                    },
                    {
                        "addressRange": "2001:0db8::/64"
                    }
                ]
            }
        }
    },
    "type": "Microsoft.Logic/workflows"
}
```

## <a name="secure-parameters-and-inputs-within-a-workflow"></a>Параметры безопасности и входные данные в рабочем процессе

При развертывании в разных средах для определения рабочего процесса может потребоваться задать некоторые параметры. Это могут быть параметры безопасности, которые не должны отображаться при редактировании рабочего процесса, например идентификатор или секрет клиента для [аутентификации Azure Active Directory](../connectors/connectors-native-http.md#authentication) действия HTTP.

### <a name="using-parameters-and-secure-parameters"></a>Использование параметров и параметров безопасности

[Язык определения рабочего процесса](http://aka.ms/logicappsdocs) предоставляет операцию `@parameters()` для доступа к значению параметра ресурса во время выполнения. Вы можете также [указать параметры в шаблоне развертывания ресурсов](../azure-resource-manager/resource-group-authoring-templates.md#parameters). Если указать тип параметра `securestring`, он не будет возвращен с остальной частью определения ресурсов и не будет доступен при просмотре ресурса после развертывания.

> [!NOTE]
> Если параметр используется в заголовках или тексте запроса, он может отображаться при доступе к журналу выполнения или исходящему HTTP-запросу. Настройте политики доступа к содержимому соответствующим образом.
> Заголовки авторизации никогда не отображаются во входных и выходных данных. При использовании секрета в этих данных его нельзя будет извлечь.

#### <a name="resource-deployment-template-with-secrets"></a>Шаблон развертывания ресурсов с использованием секретов

Ниже приведен пример развертывания, который во время выполнения ссылается на безопасный параметр `secret`. В отдельном файле параметров можно указать значения среды для `secret` или использовать [хранилище ключей Azure Resource Manager](../azure-resource-manager/resource-manager-keyvault-parameter.md) для получения секретов во время развертывания.

``` json
{
   "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {
      "secretDeploymentParam": {
         "type": "securestring"
      }
   },
   "variables": {},
   "resources": [ {
      "name": "secret-deploy",
      "type": "Microsoft.Logic/workflows",
      "location": "westus",
      "tags": {
         "displayName": "LogicApp"
      },
      "apiVersion": "2016-06-01",
      "properties": {
         "definition": {
            "$schema": "https://schema.management.azure.com/schemas/2016-06-01/Microsoft.Logic.json",
            "actions": {
               "Call_External_API": {
                  "type": "Http",
                  "inputs": {
                     "headers": {
                        "Authorization": "@parameters('secret')"
                     },
                     "body": "This is the request"
                  },
                  "runAfter": {}
               }
            },
            "parameters": {
               "secret": {
                  "type": "SecureString"
               }
            },
            "triggers": {
               "manual": {
                  "type": "Request",
                  "kind": "Http",
                  "inputs": {
                     "schema": {}
                  }
               }
            },
            "contentVersion": "1.0.0.0",
            "outputs": {}
         },
         "parameters": {
            "secret": {
               "value": "[parameters('secretDeploymentParam')]"
            }
         }
      }
   } ],
   "outputs": {}
}
```

## <a name="secure-access-to-services-receiving-requests-from-a-workflow"></a>Защита доступа к службам, которые получают запросы от рабочего процесса

Существует множество способов защиты конечных точек, доступ к которым требуется приложению логики.

### <a name="using-authentication-on-outbound-requests"></a>Использование проверки подлинности при исходящих запросах

При работе с HTTP, HTTP + Swagger (открытый API) или с действием webhook можно добавить проверку подлинности отправляемого запроса. Это может быть обычная аутентификация, аутентификация на основе сертификата или аутентификация Azure Active Directory. Дополнительные сведения о настройке проверки подлинности см. [в этой статье](../connectors/connectors-native-http.md#authentication).

### <a name="restricting-access-to-logic-app-ip-addresses"></a>Разрешение доступа для определенных IP-адресов приложения логики

Все вызовы из приложений логики поступают из определенного набора IP-адресов для каждого региона. Можно добавить дополнительные фильтры, чтобы принимать запросы только из указанных IP-адресов. Список этих IP-адресов можно найти в статье [Ограничения и настройка приложений логики](logic-apps-limits-and-config.md#configuration).

### <a name="on-premises-connectivity"></a>Локальные возможности подключения

Приложения логики обеспечивают интеграцию с рядом служб для обеспечения безопасных и надежных локальных подключений.

#### <a name="on-premises-data-gateway"></a>Локальный шлюз данных

Многие управляемые соединители для приложений логики предоставляют безопасное подключение к локальным системам, включая файловую систему, SQL, SharePoint, DB2 и другие. Шлюз ретранслирует данные из локальных источников по шифрованным каналам через служебную шину Azure. Весь трафик поступает как безопасный исходящий трафик от агента шлюза. Дополнительные сведения см. в разделе [Как работает шлюз](logic-apps-gateway-install.md#gateway-cloud-service).

#### <a name="azure-api-management"></a>Cлужба управления Azure API 

[Служба управления API Azure](https://azure.microsoft.com/services/api-management/) имеет возможности локального подключения, включая VPN типа "сеть — сеть" и интеграцию ExpressRoute, для защищенного прокси-сервера и подключения к локальным системам. В конструкторе приложений логики можно быстро выбрать API, предоставляемый службой управления API в рамках рабочего процесса, который обеспечивает быстрый доступ к локальным системам.

## <a name="next-steps"></a>Дополнительная информация
[Создание шаблона развертывания приложения логики](logic-apps-create-deploy-template.md)  
[Обработка исключений](logic-apps-exception-handling.md)  
[См. статью Мониторинг приложений логики.](logic-apps-monitor-your-logic-apps.md)  
[Диагностика сбоев приложений логики](logic-apps-diagnosing-failures.md)  
