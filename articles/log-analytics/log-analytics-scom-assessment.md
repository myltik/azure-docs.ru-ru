---
title: "Оптимизация среды System Center Operations Manager с помощью Azure Log Analytics | Документация Майкрософт"
description: "Решение для оценки System Center Operations Manager можно использовать для оценки риска и работоспособности серверных сред на регулярной основе."
services: log-analytics
documentationcenter: 
author: bandersmsft
manager: carmonm
editor: tysonn
ms.assetid: 49aad8b1-3e05-4588-956c-6fdd7715cda1
ms.service: log-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/07/2017
ms.author: banders
ms.custom: H1Hack27Feb2017
ms.translationtype: Human Translation
ms.sourcegitcommit: 74f34bdbf5707510c682814716aa0b95c19a5503
ms.openlocfilehash: 6754505e7f58a8e7305987db9204271ca9b93870
ms.contentlocale: ru-ru
ms.lasthandoff: 06/09/2017


---

# <a name="optimize-your-environment-with-the-system-center-operations-manager-assessment-preview-solution"></a>Оптимизация среды с помощью решения для оценки System Center Operations Manager (предварительная версия)

![Символ System Center Operations Manager Assessment](./media/log-analytics-scom-assessment/scom-assessment-symbol.png)

Решение для оценки System Center Operations Manager можно использовать для оценки риска и работоспособности серверных сред SCOM на регулярной основе. Эта статья поможет вам установить, настроить и использовать данное решение таким образом, чтобы в случае проблем вы могли принять корректирующие меры.

Это решение предоставляет приоритетный список рекомендаций, относящихся к развернутой серверной инфраструктуре. Рекомендации сгруппированы в четырех приоритетных областях, помогающих быстро оценить риски и принять корректирующие меры.

В основу предлагаемых рекомендаций положены знания и опыт, приобретенные специалистами Майкрософт в результате многочисленных посещений клиентов. Каждая рекомендация является определенным руководством, поясняющим важность проблемы и приводящим действия по реализации предложенных изменений.

Можно выбрать приоритетные области, наиболее важные для организации, и отслеживать выполнение задач по формированию работоспособной и свободной от рисков среды.

После добавления решения и завершения оценки сводная информация по приоритетным областям отображается на панели мониторинга **Оценка System Center Operations Manager** для инфраструктуры. В следующих разделах описано, как использовать информацию на панели мониторинга **Оценка System Center Operations Manager** , где можно увидеть и выполнить действия, рекомендованные для вашей инфраструктуры SCOM.

![Заголовок решения System Center Operations Manager](./media/log-analytics-scom-assessment/scom-tile.png)

![Панель мониторинга "Оценка System Center Operations Manager"](./media/log-analytics-scom-assessment/scom-dashboard01.png)

## <a name="installing-and-configuring-the-solution"></a>Установка и настройка решения

Решение работает с Microsoft System Operations Manager 2012 R2 и Microsoft System Operations Manager 2012 с пакетом обновления 1 (SP1).

Для установки и настройки решений используйте указанные ниже данные.

 - Чтобы использовать решение оценки в OMS, его необходимо установить. Установите решение из [Azure Мarketplace](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.SCOMAssessmentOMS?tab=Overview) или в соответствии с инструкциями по [добавлению решений Log Analytics из коллекции решений](log-analytics-add-solutions.md).

 - После добавления решения в рабочую область элемент "Оценка System Center Operations Manager" на панели мониторинга отобразит сообщение о том, что требуется дополнительная настройка. Щелкните этот элемент и выполните инструкции по настройке, указанные на странице.

 ![Элемент "Оценка System Center Operations Manager" на панели мониторинга](./media/log-analytics-scom-assessment/scom-configrequired-tile.png)

 Настроить System Center Operations Manager можно с помощью сценария, выполнив действия, описанные на странице настройки решения в OMS.

 Вместо этого, чтобы настроить оценку с помощью консоли SCOM, выполните следующие действия в указанном порядке.
1. [Установите учетную запись запуска от имени для оценки System Center Operations Manager Assessment](#operations-manager-run-as-accounts-for-oms).  
2. [Настройте правило оценки System Center Operations Manager](#configure-the-assessment-rule).

## <a name="system-center-operations-manager-assessment-data-collection-details"></a>Сведения о сборе данных оценки System Center Operations Manager

Решение для оценки System Center Operations Manager собирает данные WMI, реестра, журнала событий и данные Operations Manager посредством Windows PowerShell, SQL-запросов или сборщика сведений о файлах с использованием включенного вами сервера.

В следующей таблице приведены методы сбора данных для оценки System Center Operations Manager и периодичность сбора данных агентом.

| платформа | Direct Agent | Агент SCOM | Хранилище Azure | Нужен ли SCOM? | Отправка данных агента SCOM через группу управления | частота сбора |
| --- | --- | --- | --- | --- | --- | --- |
| Windows |  ![Нет](./media/log-analytics-scom-assessment/oms-bullet-red.png) | ![Нет](./media/log-analytics-scom-assessment/oms-bullet-red.png)  | ![Нет](./media/log-analytics-scom-assessment/oms-bullet-red.png)  |  ![Да](./media/log-analytics-scom-assessment/oms-bullet-green.png) | ![Нет](./media/log-analytics-scom-assessment/oms-bullet-red.png)  | 7 дней |

## <a name="operations-manager-run-as-accounts-for-oms"></a>Учетные записи запуска от имени в Operations Manager для службы OMS

С целью предоставления ценных услуг служба OMS основывается на пакетах управления для рабочих нагрузок. Каждой рабочей нагрузке требуются права, относящиеся к конкретным рабочим нагрузкам, для запуска пакетов управления в другом контексте безопасности, например в учетной записи домена. Чтобы предоставить учетные данные, настройте учетную запись запуска от имени Operations Manager.

Для настройки учетной записи запуска от имени Operations Manager для оценки System Center Operations Manager используйте указанные ниже сведения.

### <a name="set-the-run-as-account"></a>Учетная запись запуска от имени

1. В консоли Operations Manager щелкните вкладку **Администрирование**.
2. В разделе **Run As Configuration** (Конфигурация запуска от имени) щелкните **Учетные записи**.
3. Создайте учетную запись запуска от имени Windows с помощью мастера. Использовать следует идентифицированную учетную запись, для которой выполнены все перечисленные ниже предварительные условия.

    >[!NOTE]
    Учетная запись запуска от имени должна соответствовать следующим требованиям.
    - Это должна быть учетная запись домена, входящая в группу локальных администраторов на всех серверах в среде (все роли Operations Manager: сервер управления, база данных Operations Manager, хранилище данных, создание отчетов, веб-консоль, шлюз).
    - Это должна быть роль администратора Operations Manager для оцениваемой группы.
    - Выполните [этот сценарий](#sql-script-to-grant-granular-permissions-to-the-run-as-account), чтобы предоставить детализированные разрешения учетной записи запуска экземпляра SQL, используемого Operations Manager.
      Примечание. Если эта учетная запись уже имеет права системного администратора, пропустите выполнения сценария.

4. В разделе **Безопасность распространения** выберите **Более безопасно**.
5. Укажите сервер управления, на который распространяется учетная запись.
3. Вернитесь в раздел "Run As Configuration" (Конфигурация запуска от имени) и щелкните **Профили**.
4. Найдите *профиль оценки SCOM*.
5. Он должен называться *Microsoft System Center Advisor SCOM Assessment Run As Profile*.
6. Щелкните его правой кнопкой мыши и обновите свойства профиля. Добавьте в него учетную запись запуска от имени, созданную на шаге 3.

### <a name="sql-script-to-grant-granular-permissions-to-the-run-as-account"></a>Сценарий SQL для предоставления детализированных разрешений учетной записи запуска от имени

Выполните следующий сценарий SQL, чтобы предоставить необходимые разрешения для учетной записи запуска от имени экземпляра SQL, используемого Operations Manager.

```
-- Replace <UserName> with the actual user name being used as Run As Account.
USE master

-- Create login for the user, comment this line if login is already created.
CREATE LOGIN [UserName] FROM WINDOWS


--GRANT permissions to user.
GRANT VIEW SERVER STATE TO [UserName]
GRANT VIEW ANY DEFINITION TO [UserName]
GRANT VIEW ANY DATABASE TO [UserName]

-- Add database user for all the databases on SQL Server Instance, this is required for connecting to individual databases.
-- NOTE: This command must be run anytime new databases are added to SQL Server instances.
EXEC sp_msforeachdb N'USE [?]; CREATE USER [UserName] FOR LOGIN [UserName];'

Use msdb
GRANT SELECT To [UserName]
Go

--Give SELECT permission on all Operations Manager related Databases

--Replace the Operations Manager database name with the one in your environment
Use [OperationsManager];
GRANT SELECT To [UserName]
GO

--Replace the Operations Manager DatawareHouse database name with the one in your environment
Use [OperationsManagerDW];
GRANT SELECT To [UserName]
GO

--Replace the Operations Manager Audit Collection database name with the one in your environment
Use [OperationsManagerAC];
GRANT SELECT To [UserName]
GO

--Give db_owner on [OperationsManager] DB
--Replace the Operations Manager database name with the one in your environment
USE [OperationsManager]
GO
ALTER ROLE [db_owner] ADD MEMBER [UserName]

```


### <a name="configure-the-assessment-rule"></a>Настройка правила оценки

Пакет управления решения для оценки Center Operations Manager включает в себя правило *Microsoft System Center Advisor SCOM Assessment Run Assessment Rule*. Это правило отвечает за выполнение оценки. Чтобы включить правило и настроить частоту, используйте приведенные ниже процедуры.

По умолчанию правило "Microsoft System Center Advisor SCOM Assessment Run Assessment Rule" отключено. Чтобы выполнить оценку, необходимо включить это правило на сервере управления. Выполните следующие действия.

#### <a name="enable-the-rule-for-a-specific-management-server"></a>Включение правила для определенного сервера управления

1. В рабочей области **Разработка** консоли Operations Manager в области **Правила** найдите правило *Microsoft System Center Advisor SCOM Assessment Run Assessment Rule*.
2. В результатах поиска выберите тот, который содержит текст *Тип: сервер управления*.
3. Щелкните правой кнопкой мыши правило, а затем выберите **Переопределения** > **Для конкретного объекта данного класса: сервер управления**.
4.  Из списка выберите сервер управления, на котором должно выполняться правило.
5.  Обязательно измените значение переопределения для параметра **Включено** на **True**.  
    ![Параметр переопределения](./media/log-analytics-scom-assessment/rule.png)

Оставаясь в этом окне, настройте частоту выполнения, следуя приведенной ниже процедуре.

#### <a name="configure-the-run-frequency"></a>Настройка частоты выполнения

Оценка настроена для выполнения каждые 10 080 минут (или семь дней). Это интервал по умолчанию. Это значение можно переопределить, при этом минимальное значение составляет 1440 минут (или один день). Данное значение представляет минимальный интервал времени между последовательно выполняемыми оценками. Ниже приведены указания по переопределению данного интервала.

1. В рабочей области **Разработка** консоли Operations Manager в области **Правила** найдите правило *Microsoft System Center Advisor SCOM Assessment Run Assessment Rule*.
2. В результатах поиска выберите тот, который содержит текст *Тип: сервер управления*.
3. Щелкните правой кнопкой мыши правило, а затем выберите **Override the Rule** (Переопределить правило)  >  **Для всех объектов данного класса: сервер управления**.
4. Изменение значение параметра **Интервал**, указав нужное вам значение интервала. В следующем примере задано значение 1440 минут (один день).  
    ![Параметр интервала](./media/log-analytics-scom-assessment/interval.png)  
    Если задать значение меньше 1440 минут, то правило будет выполняться с интервалом в один день. В этом примере правило не учитывает значение интервала и выполняется с частотой один день.


## <a name="understanding-how-recommendations-are-prioritized"></a>Основные сведения о приоритизации рекомендаций

Каждая рекомендация получает взвешенное значение, определяющее относительную важность рекомендаций. Отображаются только 10 наиболее важных рекомендаций.

### <a name="how-weights-are-calculated"></a>Процесс вычисления взвешенного значения

Взвешенные значения являются статистическими значениями, основанными на трех ключевых факторах.

- *Вероятность* возникновения проблемы. Более высокие значения вероятности приравниваются к более высокой общей оценке для рекомендации.
- *Влияние* на работу организации, если она является причиной проблемы. Более высокая степень влияния приравнивается к более высокой общей оценке для рекомендации.
- *Усилия* , необходимые для реализации рекомендации. Более высокое значение усилий приравнивается к меньшей общей оценке рекомендации.

Взвешенное значение для каждой рекомендации выражается в процентах от общей оценки, доступной для каждой приоритетной области. Например, если рекомендация из приоритетной области "Доступность и непрерывность бизнес-процессов" имеет показатель 5 %, то реализация этой рекомендации увеличит общий показатель доступности и непрерывности бизнес-процессов на 5 %.

### <a name="focus-areas"></a>Приоритетные области

**Доступность и непрерывность бизнес-процессов**. Эта область содержит рекомендации в отношении доступности служб, устойчивости инфраструктуры и защиты бизнеса.

**Производительность и масштабируемость**. В этой области содержатся рекомендации, которые помогут ИТ-инфраструктуре вашей организации расти, обеспечат соответствие ИТ-среды текущим требованиям к производительности и позволят ей адаптироваться к новым требованиям к инфраструктуре.

**Обновление, перенос и развертывание**. Эта область содержит рекомендации, которые помогут вам обновить, перенести и развернуть SQL Server в существующую инфраструктуру.

**Операции и мониторинг**. В этой области содержатся рекомендации, которые позволят оптимизировать ИТ-операции, реализовать программу профилактического обслуживания и повысить эффективность бизнеса.

### <a name="should-you-aim-to-score-100-in-every-focus-area"></a>Следует ли стремиться к показателю 100 % в каждой приоритетной области?

Не обязательно. В основу предлагаемых рекомендаций положены знания и опыт, приобретенные специалистами Майкрософт в результате многочисленных посещений клиентов. Однако не существует двух одинаковых серверных инфраструктур, и конкретные рекомендации могут быть применимы к вам в большей или меньшей степени. Например, некоторые рекомендации по обеспечению безопасности могут быть менее значимыми, если виртуальные машины в организации не подключены к Интернету. Некоторые рекомендации о доступности могут иметь менее важное значение для служб, которые обеспечивают сбор низкоприоритетных данных. Проблемы, которые важны для зрелой организации, могут быть не так важны для начинающей компании. Можно определить приоритетные области и затем отследить изменение оценок с течением времени.

В каждой рекомендации указано, почему она важна. Эту рекомендацию следует использовать, чтобы определить целесообразность реализации рекомендации с учетом характера ИТ-служб и бизнес-потребностей организации.

## <a name="use-assessment-focus-area-recommendations"></a>Использование рекомендаций по оцениваемой приоритетной области

Чтобы использовать решение оценки в OMS, его необходимо установить. Дополнительные сведения об установке решений см. в статье [Добавление решений Log Analytics из коллекции решений](log-analytics-add-solutions.md). После установки пакета аналитики можно просматривать сводку рекомендаций с помощью элемента оценки System Center Operations Manager на странице "Обзор" в OMS.

Вы можете посматривать сводку оценок соответствия для инфраструктуры, а затем глубже изучить рекомендации.

### <a name="to-view-recommendations-for-a-focus-area-and-take-corrective-action"></a>Просмотр рекомендаций для приоритетной области и выполнение действий по исправлению

1. На странице **Обзор** щелкните элемент **Оценка System Center Operations Manager**.
2. На странице **Оценка System Center Operations Manager** просмотрите сводные данные в одной из колонок приоритетной области, а затем щелкните одну колонку, чтобы просмотреть рекомендации для соответствующей области.
3. На всех страницах интересующей области можно просматривать приоритетные рекомендации для вашей среды. Щелкните рекомендацию в разделе **Затронутые объекты** , чтобы просмотреть сведения о причинах возникновения этой рекомендации.  
    ![Приоритетная область](./media/log-analytics-scom-assessment/focus-area.png)
4. В разделе **Предложенные действия**представлены действия по исправлению, которые вы можете предпринять. Когда проблема с этим элементом будет устранена, последующие оценки будут указывать, что рекомендованные действия были выполнены, и тогда оценка соответствия возрастет. Исправленные элементы отображаются как **Прошедшие проверку объекты**.

## <a name="ignore-recommendations"></a>Игнорирование рекомендаций

Если вы хотите проигнорировать какие-либо рекомендации, создайте текстовый файл, который OMS будет использовать для того, чтобы убрать рекомендации из результатов оценки.

### <a name="to-identify-recommendations-that-you-want-to-ignore"></a>Указание рекомендаций, которые нужно игнорировать

1. Войдите в рабочую область и откройте поиск по журналам. Выполните следующий запрос, чтобы получить список рекомендаций, не выполненных на компьютерах в вашей среде.

    ```
    Type=SCOMAssessmentRecommendationRecommendationResult=Failed | select  Computer, RecommendationId, Recommendation | sort  Computer
    ```

    Вот снимок экрана с запросом на поиск в журналах.  
    ![Поиск в журналах](./media/log-analytics-scom-assessment/scom-log-search.png)

2. Выберите рекомендации, которые нужно проигнорировать. Эти значения будут использоваться для параметра RecommendationId в следующей процедуре.

### <a name="to-create-and-use-an-ignorerecommendationstxt-text-file"></a>Создание и использование текстового файла IgnoreRecommendations.txt

1. Создайте файл с именем IgnoreRecommendations.txt.
2. Вставьте или введите значение RecommendationId для каждой рекомендации, которую служба OMS должна игнорировать, в отдельной строке, а затем сохраните и закройте файл.
3. Поместите файл в следующую папку на каждом компьютере, где OMS должен проигнорировать рекомендации.
4. На сервере управления Operations Manager: *системный диск*:\Program Files\Microsoft System Center 2012 R2\Operations Manager\Server.

### <a name="to-verify-that-recommendations-are-ignored"></a>Контроль игнорирования рекомендаций

1. После выполнения следующей плановой оценки (по умолчанию выполняется раз в семь дней) указанные рекомендации помечаются как игнорируемые и больше не отображаются на панели мониторинга оценки.
2. Для получения списка всех игнорируемых рекомендаций можно использовать следующие запросы поиска по журналам.

    ```
    Type=SCOMAssessmentRecommendationRecommendationResult=Ignored | select  Computer, RecommendationId, Recommendation | sort  Computer
    ```

3. Если вы решите позже просмотреть игнорируемые рекомендации, удалите все файлы IgnoreRecommendations.txt или RecommendationIDs можно удалить из них.

## <a name="system-center-operations-manager-assessment-solution-faq"></a>Часто задаваемые вопросы по решению для оценки System Center Operations Manager

*Я добавил решения для оценки в свою рабочую область OMS. Однако рекомендации не отображаются. Почему так происходит?* Добавив решение, используйте следующие шаги и просмотрите рекомендации на панели мониторинга OMS.  

- [Установите учетную запись запуска от имени для оценки System Center Operations Manager Assessment](#operations-manager-run-as-accounts-for-oms).  
- [Настройте правило оценки System Center Operations Manager](#configure-the-assessment-rule).


*Есть ли способ настроить частоту оценки?* Да. Ознакомьтесь с разделом [Настройка частоты выполнения](#configure-the-run-frequency).

*Если после добавления решения для оценки System Center Operations Manager обнаружен другой сервер, будет ли он оцениваться?* Да, после обнаружения он будет оцениваться в дальнейшем. По умолчанию это будет происходить каждые семь дней.

*Как называется процесс, который собирает данные?* AdvisorAssessment.exe

*Где запускается процесс AdvisorAssessment.exe?* AdvisorAssessment.exe выполняется в службе работоспособности сервера управления, на котором включено правило оценки. С помощью этого процесса осуществляется обнаружение всей среды посредством удаленного сбора данных.

*Сколько времени требуется для сбора данных?* Время сбора данных на сервере составляет примерно 1 час. В средах, содержащих много экземпляров или баз данных Operations Manager, это может занять больше времени.

*Что делать, если мною установлен интервал оценки менее 1440 минут?* Оценка предварительно настроена для выполнение не реже, чем раз в день. Если переопределить значение интервала и указать значение меньше 1440 минут, то оценка будет выполняться с интервалом в 1440 минут.

*Как узнать о невыполненных предварительных условиях?* Если вы не видите результатов выполнения оценки, скорее всего, причина в том, что некоторые ее предварительные требования не соблюдены. Можно выполнить запросы `Type=Operation Solution=SCOMAssessment` и `Type=SCOMAssessmentRecommendation FocusArea=Prerequisites` в службе поиска в журналах, чтобы увидеть невыполненные предварительные требования.

*Среди невыполненных предварительных требований отображается сообщение `Failed to connect to the SQL Instance (….).`. В чем заключается проблема?* AdvisorAssessment.exe (процесс, собирающий данные) выполняется в службе работоспособности сервера управления. В ходе оценки этот процесс пытается подключиться к экземпляру SQL Server, на котором размещена база данных Operations Manager. Эта ошибка может возникать, когда правила брандмауэра блокируют подключение к экземпляру SQL Server.

*Какие типы данных собираются?* Собираются данные следующих типов: данные WMI, данные реестра, данные журнала событий, данные Operations Manager посредством Windows PowerShell, SQL-запросов и сборщика сведений о файлах.

*Почему необходимо настроить учетную запись «Запуск от имени»?* Для сервера Operations Manager выполняются различные SQL-запросы. Чтобы они выполнялись, необходимо использовать учетную запись запуска от имени с необходимыми разрешениями. Кроме того, чтобы выполнять запросы к WMI, требуются учетные данные локального администратора.

*Почему отображаются только первые 10 рекомендаций?* Вместо отображения полного списка задач мы рекомендуем сконцентрироваться на приоритетных рекомендациях. После этого станут доступны дополнительные рекомендации. Если вы хотите просмотреть весь список, используйте функцию поиска по журналам.

*Можно ли игнорировать рекомендации?* Да, ознакомьтесь с разделом [Игнорирование рекомендаций](#Ignore-recommendations).


## <a name="next-steps"></a>Дальнейшие действия

- Используйте [поиск в журналах](log-analytics-log-searches.md), чтобы просмотреть подробные данные оценки System Center Operations Manager и соответствующие рекомендации.

