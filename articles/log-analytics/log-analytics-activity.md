---
title: Сбор и анализ журналов действий Azure в Log Analytics | Документация Майкрософт
description: Решение "Журналы действий Azure" можно использовать для анализа таких журналов во всех подписках Azure и поиска в них необходимых данных.
services: log-analytics
documentationcenter: ''
author: MGoedtel
manager: carmonm
editor: ''
ms.assetid: dbac4c73-0058-4191-a906-e59aca8e2ee0
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/26/2018
ms.author: magoedte
ms.openlocfilehash: b6e823d9338d76a350569091d6794e3ac4a2eae9
ms.sourcegitcommit: 34e0b4a7427f9d2a74164a18c3063c8be967b194
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2018
ms.locfileid: "30283390"
---
# <a name="collect-and-analyze-azure-activity-logs-in-log-analytics"></a>Сбор и анализ журналов действий Azure в Log Analytics

![Символ журналов действий Azure](./media/log-analytics-activity/activity-log-analytics.png)

Решение "Аналитика журнала действий" помогает анализировать [журналы действий Azure](../monitoring-and-diagnostics/monitoring-overview-activity-logs.md) во всех подписках Azure и искать в них необходимые данные. Журнал действий Azure — это журнал с информацией об операциях, которые выполнялись с ресурсами в подписке. Журнал действий раньше назывался *журналом аудита* или *операционным журналом*, так как он содержит связанные с подписками события.

С помощью журнала действий можно ответить на вопросы *что?*, *кто?* и *когда?* о любой операции записи (PUT, POST, DELETE) с ресурсами в вашей подписке. Вы также можете отслеживать состояние операции и другие ее свойства. Журнал действий не содержит операции чтения (GET) или операции с ресурсами, которые используют классическую модель развертывания.

При подключении журналов действий Azure к Log Analytics вы можете:

- анализировать журналы действий с помощью предварительно определенных представлений;
- анализировать журналы действий из нескольких подписок Azure и искать в них необходимые данные;
- хранить журналы действий более 90 дней<sup>1</sup>;
- сопоставлять журналы действий с данными других платформ и приложений Azure;
- просматривать сведения о рабочих операциях в сгруппированном по состоянию виде;
- просматривать тенденции, связанные с операциями, которые выполняются в каждой из служб Azure;
- сообщать об изменениях авторизации для всех ресурсов Azure;
- выявлять сбои или проблемы, связанные с работоспособностью службы и влияющие на ресурсы;
- использовать поиск по журналам для сопоставления действий пользователей, операций автоматического масштабирования, изменений авторизации и данных о работоспособности службы с аналогичными данными из других журналов или среды.

<sup>1</sup>По умолчанию журналы действий Azure хранятся в службе Log Analytics в течение 90 дней, даже если она используется на бесплатном уровне или заданный в рабочей области срок хранения данных меньше 90 дней. Если длительность хранения, заданная для рабочей области, превышает 90 дней, журналы действий хранятся в течение этого установленного срока.

В Log Analytics журналы действий собираются и хранятся в течение 90 дней бесплатно. Если их нужно сохранять более 90 дней, за хранение данных дольше 90 дней взимается плата.

В случае использования бесплатной ценовой категории журналы действий не учитываются при определении ежедневного потребления данных.

## <a name="connected-sources"></a>Подключенные источники

В отличие от большинства других решений для анализа журналов, данные для журналов действий не собираются агентами. Все данные, используемые решением, поступают непосредственно из Azure.

| Подключенный источник | Поддерживаются | ОПИСАНИЕ |
| --- | --- | --- |
| [Агенты Windows](log-analytics-windows-agent.md) | Нет  | Решение не собирает сведения из агентов Windows. |
| [Агенты Linux](log-analytics-linux-agents.md) | Нет  | Решение не собирает сведения из агентов Linux. |
| [Группы управления SCOM](log-analytics-om-agents.md) | Нет  | Решение не собирает сведения из агентов в подключенной группе управления SCOM. |
| [Учетная запись хранения Azure](log-analytics-azure-storage.md) | Нет  | Решение не собирает сведения из службы хранилища Azure. |

## <a name="prerequisites"></a>предварительным требованиям

- Для доступа к сведениям журнала действий Azure необходимо наличие подписки Azure.

## <a name="configuration"></a>Параметр Configuration

Выполните следующие действия, чтобы настроить решение для анализа журналов действий в своих рабочих областях.

1. Включите решение для анализа журналов действий из [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.AzureActivityOMS?tab=Overview) или выполните инструкции из статьи [Добавление решений для управления Azure Log Analytics в рабочую область](log-analytics-add-solutions.md).
2. Настройте журналы действий так, чтобы они поступали в вашу рабочую область Log Analytics.
    1. На портале Azure выберите рабочую область и нажмите **Журнал действий Azure**.
    2. Щелкните имя каждой подписки.  
        ![Добавление подписки](./media/log-analytics-activity/add-subscription.png)
    3. В колонке *SubscriptionName* щелкните **Подключить**.  
        ![Подключение подписки](./media/log-analytics-activity/subscription-connect.png)

При добавлении решения с помощью портала OMS отображается следующая плитка. Войдите на портал Azure, чтобы подключить подписку Azure к рабочей области.  
![Выполнение оценки](./media/log-analytics-activity/tile-performing-assessment.png)

## <a name="using-the-solution"></a>Использование решения

При добавлении решения для анализа журналов действий в рабочую область на панель мониторинга "Обзор" добавляется плитка **Журналы действий Azure**. На этой плитке отображается число записей действий Azure для подписки Azure, которая доступна для решения.

![Плитка "Журналы действий Azure"](./media/log-analytics-activity/azure-activity-logs-tile.png)

### <a name="view-azure-activity-logs"></a>Просмотр журналов действий Azure

Щелкните плитку **Журналы действий Azure**, чтобы открыть панель мониторинга **Журналы действий Azure**. Панель мониторинга содержит колонки, перечисленные в приведенной ниже таблице. В каждой колонке содержится максимум 10 элементов, соответствующих таким указанным критериям, как область действия и диапазон времени. Вы можете выполнить поиск по журналам, в результате которого возвращаются все записи, если щелкнуть заголовок колонки или **Показать все** в ее нижней части.

Данные журнала действий отображаются только *после* настройки направления журналов действий в решение, поэтому, пока это не будет сделано, их просмотреть невозможно.

| Колонка | ОПИСАНИЕ |
| --- | --- |
| Записи журнала действий Azure | Здесь отображается линейчатая диаграмма итогов для записей журнала действий Azure в выбранном диапазоне дат, а также список 10 основных инициаторов действий. Щелкните линейчатую диаграмму, чтобы выполнить поиск <code>AzureActivity</code>. Щелкните инициатор действий, чтобы выполнить поиск по журналам, возвращающий все записи журнала действий для этого инициатора. |
| Журналы действий по состоянию | Здесь отображается кольцевая диаграмма состояний журналов действий Azure в выбранном диапазоне дат. Также отображается список из десяти основных записей о состоянии. Щелкните диаграмму, чтобы выполнить поиск <code>AzureActivity &#124; summarize AggregatedValue = count() by ActivityStatus</code>. Щелкните состояние, чтобы выполнить поиск по журналам, возвращающий все записи журнала действий для этой записи о состоянии. |
| Журналы действий по ресурсу | Здесь отображается общее число ресурсов с журналами действий и список из десяти основных ресурсов с указанием числа записей для каждого из них. Щелкните область итогов, чтобы запустить поиск <code>AzureActivity &#124; summarize AggregatedValue = count() by Resource</code> по журналам, который возвратит все доступные для решения ресурсы Azure. Щелкните ресурс, чтобы выполнить поиск по журналам, возвращающий для этого ресурса все записи действий. |
| Журналы действий по поставщику ресурсов | Здесь отображается общее число поставщиков ресурсов, которые создают журналы действий, и список основных десяти из них. Щелкните область итогов, чтобы запустить поиск <code>AzureActivity &#124; summarize AggregatedValue = count() by ResourceProvider</code> по журналам, который возвратит все поставщики ресурсов Azure. Щелкните поставщик ресурсов, чтобы выполнить поиск по журналам, возвращающий все записи действий для этого поставщика. |

![Панель мониторинга "Журналы действий Azure"](./media/log-analytics-activity/activity-log-dash.png)

## <a name="next-steps"></a>Дополнительная информация

- Создание [оповещения](log-analytics-alerts-creating.md) о выполнении определенного действия.
- Использование [поиска по журналам](log-analytics-log-searches.md) для просмотра подробных сведений из журналов действий.
