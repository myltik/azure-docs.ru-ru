---
title: Сбор данных о виртуальных машинах Azure | Документация Майкрософт
description: Узнайте, как включить расширение виртуальной машины агента OMS и сбор данных из виртуальных машин Azure в Log Analytics.
services: log-analytics
documentationcenter: log-analytics
author: MGoedtel
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: quickstart
ms.date: 04/03/2018
ms.author: magoedte
ms.custom: mvc
ms.openlocfilehash: 30221074dd2a25fdd0771e3fae607d4c0135266c
ms.sourcegitcommit: 266fe4c2216c0420e415d733cd3abbf94994533d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34637217"
---
# <a name="collect-data-about-azure-virtual-machines"></a>Сбор данных о виртуальных машинах Azure
[Azure Log Analytics](log-analytics-overview.md) может собирать данные напрямую c виртуальных машин Azure и других ресурсов в среде в один репозиторий для подробного анализа и корреляции.  В этом кратком руководстве показано, как настроить и собирать данные c виртуальных машин под управлением Linux или Windows с помощью нескольких простых действий.  
 
В этом кратком руководстве предполагается, что у вас уже есть виртуальная машина Azure. Если нет, можно создать [виртуальную машину Windows](../virtual-machines/windows/quick-create-portal.md) или [виртуальную машину Linux](../virtual-machines/linux/quick-create-cli.md) с помощью соответствующих кратких руководств.

## <a name="log-in-to-azure-portal"></a>Вход на портал Azure
Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com). 

## <a name="create-a-workspace"></a>Создание рабочей области
1. На портале Azure щелкните **Все службы**. В списке ресурсов введите **Log Analytics**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Выберите **Log Analytics**.<br> ![портал Azure](media/log-analytics-quick-collect-azurevm/azure-portal-01.png)<br>  
2. Щелкните **Создать** и задайте следующие параметры:

  * Введите имя для новой **рабочей области OMS**, например *DefaultLAWorkspace*. 
  * Выберите в раскрывающемся списке **подписку**, с которой нужно связать рабочую область, если выбранная по умолчанию не подходит.
  * В разделе **Группа ресурсов** выберите имеющуюся группу ресурсов, в которой содержится одна или несколько виртуальных машин Azure.  
  * Выберите **Расположение**, в котором развернуты виртуальные машины.  Дополнительные сведения о доступности службы Log Analytics в регионах см. в [этой статье](https://azure.microsoft.com/regions/services/).
  * При создании рабочей области в новой подписке, созданной после 2 апреля 2018 г., будет автоматически использоваться тарифный план *За ГБ*, и выбор ценовой категории будет недоступен.  При создании рабочей области в существующей подписке, созданной до 2 апреля, или в подписке, которая была привязана к существующей регистрации EA, выберите нужную ценовую категорию.  Дополнительные сведения о конкретной ценовой категории см. в статье [Цены на Log Analytics](https://azure.microsoft.com/pricing/details/log-analytics/).
  
        ![Create Log Analytics resource blade](media/log-analytics-quick-collect-azurevm/create-loganalytics-workspace-02.png)<br>  

3. После ввода необходимых сведений в области **Рабочая область OMS** щелкните **Создать**.  

Пока проверяются данные, ход создания рабочей области можно проверить в разделе **Уведомления** в меню. 

## <a name="enable-the-log-analytics-vm-extension"></a>Включение расширения виртуальной машины Log Analytics
На виртуальные машины Windows и Linux, развернутые в Azure, устанавливается агент Log Analytics с расширением виртуальной машины Log Analytics.  Использование расширения упрощает процесс установки и автоматически настраивает агент на отправку данных в указанную вами рабочую область службы Log Analytics. Кроме того, агент обновляется автоматически, обеспечивая наличие новейших компонентов и исправлений.

>[!NOTE]
>Агент OMS для Linux невозможно настроить для отправки отчетов в несколько рабочих областей Log Analytics. 

1. На портале Azure щелкните **Все службы** в нижнем левом углу. В списке ресурсов введите **Log Analytics**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Выберите **Log Analytics**.
2. В списке рабочих областей Log Analytics выберите рабочую область *DefaultLAWorkspace*, созданную ранее.
3. В меню слева в разделе Workspace Data Sources (Источники данных рабочей области) щелкните **Виртуальные машины**.  
4. В списке **виртуальных машин** выберите ту, на которую необходимо установить агент. Обратите внимание, что в **состоянии подключения OMS** выбранной виртуальной машины указано значение **Не подключено**.
5. В колонке сведений о выбранной виртуальной машине выберите **Подключить**. Агент будет автоматически установлен и настроен для рабочей области Log Analytics. Этот процесс занимает несколько минут. В течение этого времени отображается **состояние** **Подключение**.
6. После установки и подключения агента **состояние подключения OMS** обновится и примет значение **Эта рабочая область**.

## <a name="collect-event-and-performance-data"></a>Сбор данных событий и производительности
Log Analytics может собирать события из журналов событий Windows или системного журнала Linux и счетчиков производительности, указанных для долгосрочного анализа и формирования отчетов, а также предпринимать действия при обнаружении определенного условия.  Сначала выполните такие действия для настройки сбора событий из системного журнала Windows и Linux, а также нескольких стандартных счетчиков производительности.  

### <a name="data-collection-from-windows-vm"></a>Сбор данных из виртуальной машины Windows
1. Выберите **Дополнительные параметры**.<br> ![Дополнительные параметры Log Analytics](media/log-analytics-quick-collect-azurevm/log-analytics-advanced-settings-01.png)<br> 
3. Выберите **Данные**, а затем — **Журналы событий Windows**.  
4. Чтобы добавить журнал событий, введите его имя.  Введите **Система** и щелкните знак "плюс" **+**.  
5. Проверьте степени серьезности **Ошибка** и **Предупреждение** в таблице.   
6. В верхней части страницы щелкните **Сохранить**, чтобы сохранить конфигурацию.
7. Выберите **Windows Performance Data** (Данные производительности Windows), чтобы включить сбор данных счетчиков производительности на компьютере Windows. 
8. При первой настройке счетчиков производительности Windows для новой рабочей области Log Analytics вы можете быстро создать несколько распространенных счетчиков. Рядом с каждым счетчиком в списке есть флажок.<br> ![Выбраны счетчики производительности Windows умолчанию](media/log-analytics-quick-collect-azurevm/windows-perfcounters-default.png).<br> Щелкните **Add the selected performance counters** (Добавить выбранные счетчики производительности).  Они добавляются и устанавливаются с десятисекундным интервалом сбора.  
9. В верхней части страницы щелкните **Сохранить**, чтобы сохранить конфигурацию.

### <a name="data-collection-from-linux-vm"></a>Сбор данных из виртуальной машины Linux

1. Выберите **Системный журнал**.  
2. Чтобы добавить журнал событий, введите его имя.  Введите **Системный журнал** и щелкните знак "плюс" **+**.  
3. В таблице снимите флажок для степеней серьезности **Информация**, **Уведомление** и **Отладить**. 
4. В верхней части страницы щелкните **Сохранить**, чтобы сохранить конфигурацию.
5. Выберите **Linux Performance Data** (Данные производительности Linux), чтобы включить сбор данных счетчиков производительности на компьютере Linux. 
6. При первой настройке счетчиков производительности Linux для новой рабочей области Log Analytics вы можете быстро создать несколько распространенных счетчиков. Рядом с каждым счетчиком в списке есть флажок.<br> ![Выбраны счетчики производительности Windows умолчанию](media/log-analytics-quick-collect-azurevm/linux-perfcounters-default.png).<br> Щелкните **Add the selected performance counters** (Добавить выбранные счетчики производительности).  Они добавляются и устанавливаются с десятисекундным интервалом сбора.  
7. В верхней части страницы щелкните **Сохранить**, чтобы сохранить конфигурацию.

## <a name="view-data-collected"></a>Просмотр собранных данных
Теперь, когда сбор данных включен, можно запустить простой пример поиска по журналам, чтобы просмотреть некоторые данные из целевых виртуальных машин.  

1. На портале Azure перейдите к Log Analytics и выберите рабочую область, созданную ранее.
2. Щелкните плитку **Log Search** (Поиск по журналам) и в соответствующей области в поле запроса введите `Perf`, а затем нажмите клавишу ВВОД и нажмите кнопку "Поиск" справа от поля запроса.<br> ![Пример запроса поиска по журналам Log Analytics](./media/log-analytics-quick-collect-azurevm/log-analytics-portal-perf-query.png)<br> 

Например, запрос на следующем изображении вернул 78 000 записей производительности.  Ваши результаты будут значительно меньше.<br> ![Результат поиска по журналам Log Analytics](media/log-analytics-quick-collect-azurevm/log-analytics-search-perf.png)

## <a name="clean-up-resources"></a>Очистка ресурсов
Удалите рабочую область Log Analytics, если она больше не нужна. Для этого выберите рабочую область Log Analytics, созданную ранее, и на странице ресурсов щелкните **Удалить**.<br> ![Удаление ресурса Log Analytics](media/log-analytics-quick-collect-azurevm/log-analytics-portal-delete-resource.png)

## <a name="next-steps"></a>Дополнительная информация
Теперь, когда вы собираете данные о работе и производительности со своих виртуальных машин Windows или Linux, можно легко начать изучение и анализ собранных данных, а также работать с ними *бесплатно*.  

Чтобы узнать, как просматривать и анализировать данные, перейдите к следующему руководству.   

> [!div class="nextstepaction"]
> [Просмотр и анализ данных, собранных с помощью поиска по журналам Log Analytics](log-analytics-tutorial-viewdata.md)
