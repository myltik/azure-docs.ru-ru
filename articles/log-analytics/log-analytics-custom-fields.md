---
title: Настраиваемые поля в службе Azure Log Analytics | Документация Майкрософт
description: Функция "Настраиваемые поля" в службе Log Analytics позволяет создавать поля с поддержкой поиска на основе записей Log Analytics, которые добавляются к свойствам собранной записи.  В этой статье описывается процедура создания настраиваемого поля и представлено пошаговое руководство с примером события.
services: log-analytics
documentationcenter: ''
author: bwren
manager: jwhit
editor: tysonn
ms.assetid: 31572b51-6b57-4945-8208-ecfc3b5304fc
ms.service: log-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/23/2018
ms.author: bwren
ms.openlocfilehash: f0f3311f35f954f81560cad21e7f0e3bc850a094
ms.sourcegitcommit: 28178ca0364e498318e2630f51ba6158e4a09a89
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
ms.locfileid: "28030714"
---
# <a name="custom-fields-in-log-analytics"></a>Настраиваемые поля в службе Log Analytics
Функция **Настраиваемые поля**, предоставляемая службой Log Analytics, позволяет расширить существующие записи в Log Analytics путем добавления собственных полей с поддержкой поиска.  Настраиваемые поля автоматически заполняются на основе данных, извлеченных из других свойств в той же записи.

![Обзор настраиваемых полей](media/log-analytics-custom-fields/overview.png)

Так, в примере записи ниже полезные данные содержатся в описании события.  Если извлечь эти данные в отдельные свойства, они станут доступными для сортировки и фильтрации.

![Кнопка поиска по журналу](media/log-analytics-custom-fields/sample-extract.png)

> [!NOTE]
> В предварительной версии этой функции поддерживаются только 100 настраиваемых полей на рабочую область.  С выходом общедоступной версии это число увеличится.
> 
> 

## <a name="creating-a-custom-field"></a>Создание настраиваемого поля
При создании настраиваемого поля в Log Analytics нужно обозначить данные, которые будут использоваться для его заполнения.  Для быстрого выявления этих данных в службе используется метод под названием FlashExtract, разработанный в Microsoft Research.  Вместо запрашивания явных инструкций Log Analytics определяет данные, которые нужно извлечь, на основе предоставленных примеров.

В следующих разделах описаны шаги по созданию настраиваемого поля.  В конце этой статьи приведено пошаговое руководство по извлечению данных.

> [!NOTE]
> Настраиваемое поле заполняется, когда в Log Analytics добавляются записи, соответствующие заданным условиям, поэтому это поле отображается только в тех записях, которые были собраны после его создания.  Настраиваемое поле не будет добавлено в записи, которые при его создании уже находились в хранилище данных.
> 

### <a name="step-1--identify-records-that-will-have-the-custom-field"></a>Шаг 1. Определение записей, которые будут содержать настраиваемое поле
Прежде всего нужно определить записи, которые будут содержать настраиваемое поле.  Используйте [стандартный поиск по журналу](log-analytics-log-searches.md) , чтобы выбрать запись, которая будет выступать в качестве модели для обучения Log Analytics.  После выбора параметра извлечения данных в настраиваемое поле откроется **мастер извлечения полей** , где нужно проверить и уточнить условия.

1. Выберите функцию **поиска по журналу** и введите [запрос на получение записей](log-analytics-log-searches.md) , которые будет содержать настраиваемое поле.
2. Выберите запись, которую Log Analytics будет использовать в качестве модели для извлечения данных, нужных для заполнения поля.  Обозначьте данные, которые нужно извлечь из этой записи. Log Analytics будет использовать эту информацию, чтобы определить логику заполнения настраиваемого поля для всех подобных записей.
3. Нажмите кнопку слева возле любого текстового свойства записи и выберите команду **Extract fields from**(Извлечь поля из).
4. После этого **откроется мастер извлечения полей**, и выбранная запись будет отображаться в столбце **Основной пример**.  Настраиваемое поле будет определено для записей, значения в свойствах которых соответствуют выбранным.  
5. Если полученный результат вам не подходит, уточните условия, выбрав дополнительные поля.  Чтобы изменить значения полей для условий, отмените выбор записи и выберите другую запись, соответствующую необходимым условиям.

### <a name="step-2---perform-initial-extract"></a>Шаг 2. Выполнение начального извлечения
После определения записей, которые будут иметь настраиваемое поле, необходимо указать данные, которые требуется извлечь.  На основе этих данных Log Analytics определит аналогичные шаблоны в схожих записях.  После этого вы сможете проверить результаты и указать дополнительные сведения, которые Log Analytics будет использовать при анализе.

1. Выделите текст в примере записи, для которой требуется заполнить настраиваемое поле.  Затем появится диалоговое окно, в котором нужно указать имя для поля и запустить выполнение начального извлечения.  К имени поля будет автоматически добавлено **\__CF**.
2. Нажмите кнопку **Извлечь** , чтобы запустить анализ собранных записей.  
3. В разделах **Сводка** и **Результаты поиска** отобразятся результаты извлечения. Таким образом вы сможете проверить правильность извлечения.  В разделе **Сводка** содержатся условия, используемые для поиска записей, и количество всех определенных значений данных.  В разделе **Результаты поиска** приведен подробный список записей, соответствующих условиям.

### <a name="step-3--verify-accuracy-of-the-extract-and-create-custom-field"></a>Шаг 3. Проверка правильности извлечения и создание настраиваемого поля
После выполнения начального извлечения в Log Analytics отобразятся результаты на основе предварительно собранных данных.  Если эти результаты правильные, можно сразу перейти к созданию настраиваемого поля.  В противном случае нужно уточнить результаты, чтобы улучшить логику Log Analytics.

1. Если какие-либо значения, определенные в ходе начального извлечения, неверны, щелкните значок **Изменить** рядом с неправильной записью и выберите команду **Изменить этот выделенный элемент**.
2. Эта запись скопируется в раздел **Дополнительные примеры** под столбцом **Основной пример**.  Здесь можно выделить необходимую часть данных, чтобы указать Log Analytics на правильный выбор.
3. Нажмите кнопку **Извлечь** , чтобы использовать эту информацию для оценки всех существующих записей.  Для других записей могут быть изменены результаты на основе этих новых сведений.
4. Вносите исправления до тех пор, пока во всех записях в извлечении не будут правильно определены данные для заполнения нового настраиваемого поля.
5. Добившись удовлетворительных результатов, нажмите кнопку **Save Extract** (Сохранить извлечение).  Теперь настраиваемое поле определено, но оно еще не добавлено к записям.
6. Подождите, пока не будут собраны новые записи, соответствующие указанным условиям, и выполните поиск по журналу снова. После этого новые записи будут содержать настраиваемое поле.
7. Используйте настраиваемое поле, как и другие свойства записи.  Его можно применять для объединения и группирования данных, а также для создания новых сведений для анализа.

## <a name="viewing-custom-fields"></a>Просмотр настраиваемых полей
Список всех настраиваемых полей в группе управления можно просмотреть из меню **Дополнительные параметры** рабочей области Log Analytics на портале Azure.  Выберите вкладку **Данные**, а затем — раздел **Настраиваемые поля**, чтобы просмотреть список всех настраиваемых полей в рабочей области.  

![Настраиваемые поля](media/log-analytics-custom-fields/list.png)

## <a name="removing-a-custom-field"></a>Удаление настраиваемого поля
Настраиваемое поле можно удалить двумя способами.  Первый способ — использовать параметр **Удалить** для каждого поля при просмотре полного списка (процедура его открытия описана выше).  Второй способ — извлечь запись , нажать кнопку слева от поля  и в открывшемся меню выбрать пункт удаления настраиваемого поля.

## <a name="sample-walkthrough"></a>Пошаговое руководство
В этом разделе описывается полная процедура создания настраиваемого поля.  В этом примере извлекается имя службы в событиях Windows, которые указывают на изменение состояния службы.  При этом используются события, созданные диспетчером служб в системном журнале на компьютерах Windows.  Если вы хотите выполнить этот пример, необходимо, чтобы на компьютере был включен [сбор информационных событий в системном журнале](log-analytics-data-sources-windows-events.md).

Мы введем запрос, как на снимке экрана ниже, для возврата всех событий, созданных диспетчером служб, с идентификатором 7036, т. е. событий запуска или остановки службы.

![Запрос](media/log-analytics-custom-fields/query.png)

Затем мы выберем любую запись с идентификатором события 7036.

![Исходная запись](media/log-analytics-custom-fields/source-record.png)

Нам необходимо нажать кнопку рядом со свойством **RenderedDescription** , в котором отображается имя службы.

![Извлечение полей](media/log-analytics-custom-fields/extract-fields.png)

После этого откроется **мастер извлечения полей**, и в столбце **Основной пример** будут выбраны поля **EventLog** и **EventID**.  Это означает, что настраиваемое поле будет определено для событий системного журнала с идентификатором 7036.  Этих полей достаточно. Нам больше не нужно ничего выбирать.

![Main Example](media/log-analytics-custom-fields/main-example.png)

Мы выделим имя службы в свойстве **RenderedDescription** и назначим службе имя **Service**.  Настраиваемое поле будет называться **Service_CF**.

![Заголовок поля](media/log-analytics-custom-fields/field-title.png)

После извлечения мы увидим, что имя службы определено правильно только для некоторых записей.   В разделе **Результаты поиска** видно, что **адаптер производительности WMI** выделен не полностью.  В свою очередь, в разделе **Сводка** четыре записи со службой **DPRMA** включают лишнее слово и определены две записи, в которых упоминается **установщик модулей**, а не **установщик модулей Windows**.  

![Результаты поиска](media/log-analytics-custom-fields/search-results-01.png)

Начнем с записи об **адаптере производительности WMI** .  Щелкнем рядом с ней значок изменения, а затем — **Modify this highlight**(Изменить это выделение).  

![Изменение выделения](media/log-analytics-custom-fields/modify-highlight.png)

Выделим полное название адаптера, включая **WMI**, и выполним извлечение повторно.  

![Дополнительный пример](media/log-analytics-custom-fields/additional-example-01.png)

Как видно, записи с **адаптером производительности WMI** исправлены. Кроме того, служба Log Analytics использовала эту информацию для определения записей с **установщиком модулей Windows**.  Все эти исправления видны в разделе **Сводка**. Однако служба **DPMRA** по-прежнему указана неправильно.

![Результаты поиска](media/log-analytics-custom-fields/search-results-02.png)

Перейдем к записи со службой DPMRA и выполним ту же процедуру, чтобы исправить ее.

![Дополнительный пример](media/log-analytics-custom-fields/additional-example-02.png)

 После извлечения видно, что теперь все результаты правильные.

![Результаты поиска](media/log-analytics-custom-fields/search-results-03.png)

Поле **Service_CF** создано, но еще не добавлено ни к одной записи.

![Начальное количество](media/log-analytics-custom-fields/initial-count.png)

По истечении некоторого времени будут собраны новые события, и поле **Service_CF** начнет добавляться к записям, соответствующим нашим условиям.

![Окончательные результаты](media/log-analytics-custom-fields/final-results.png)

Теперь мы можем использовать настраиваемое поле, как и другие свойства записи.  Для иллюстрации этого мы создадим запрос, который группирует записи по новому полю **Service_CF**. Таким образом мы сможем проверить, какие службы наиболее активные.

![Группировка по запросу](media/log-analytics-custom-fields/query-group.png)

## <a name="next-steps"></a>Дополнительная информация
* Узнайте больше о [запросах поиска по журналу](log-analytics-log-searches.md) для создания запросов с использованием настраиваемых полей в качестве условия.
* Отслеживайте [пользовательские файлы журналов](log-analytics-data-sources-custom-logs.md), которые можно анализировать с помощью настраиваемых полей.

