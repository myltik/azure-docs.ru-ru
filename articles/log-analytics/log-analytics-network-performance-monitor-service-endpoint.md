---
title: Монитор производительности сети в Azure Log Analytics | Документация Майкрософт
description: Возможность диспетчера конечных точек службы в Мониторе производительности сети позволяет отслеживать сетевые подключения к любой конечной точке с открытым TCP-портом.
services: log-analytics
documentationcenter: ''
author: abshamsft
manager: carmonm
editor: ''
ms.assetid: 5b9c9c83-3435-488c-b4f6-7653003ae18a
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/20/2018
ms.author: abshamsft
ms.openlocfilehash: b21d711e59ddc762eaf72f49e501d9f324d75105
ms.sourcegitcommit: d74657d1926467210454f58970c45b2fd3ca088d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
ms.locfileid: "30240540"
---
# <a name="service-endpoint-monitor"></a>Мониторинг конечных точек службы

С помощью монитора конечных точек службы в [Мониторе производительности сети](log-analytics-network-performance-monitor.md) можно отслеживать сетевые подключения к любой конечной точке с открытым TCP-портом. К таким конечным точкам относятся веб-сайты, приложения SaaS, приложения PaaS и базы данных SQL. 

С помощью монитора конечных точек службы можно выполнять следующие функции. 

- Мониторинг сетевых подключений к приложениям и сетевым службам из нескольких филиалов или расположений. К приложениям и сетевым службам относятся Office 365, Dynamics CRM, внутренние бизнес-приложения и базы данных SQL.
- Встроенные тесты для отслеживания сетевых подключений к конечным точкам Office 365 и Dynamics 365. 
- Определение времени отклика, задержки сети, потери пакетов, возникших при подключении к конечной точке.
- Определение причины ухудшения производительности приложения (сеть или проблема в конечной точке поставщика приложения).
- Определение активных точек в сети, которые могут быть причиной ухудшения производительности приложения, путем просмотра задержек, вызываемых каждым прыжком на карте топологии.


![Мониторинг конечных точек службы](media/log-analytics-network-performance-monitor/service-endpoint-intro.png)


## <a name="configuration"></a>Параметр Configuration 
Чтобы открыть конфигурацию Монитора производительности сети, откройте решение [Монитор производительности сети](log-analytics-network-performance-monitor.md) и нажмите кнопку **Настройка**.

![Настройка Монитора производительности сети](media/log-analytics-network-performance-monitor/npm-configure-button.png)


### <a name="configure-operations-management-suite-agents-for-monitoring"></a>Настройка агентов Operations Management Suite для мониторинга
Включите следующие правила брандмауэра на узлах, используемых для мониторинга, чтобы решение могло определить топологию подключения от узлов к конечной точке службы: 

```
netsh advfirewall firewall add rule name="NPMDICMPV4Echo" protocol="icmpv4:8,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV6Echo" protocol="icmpv6:128,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV4DestinationUnreachable" protocol="icmpv4:3,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV6DestinationUnreachable" protocol="icmpv6:1,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV4TimeExceeded" protocol="icmpv4:11,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV6TimeExceeded" protocol="icmpv6:3,any" dir=in action 
```

### <a name="create-service-endpoint-monitor-tests"></a>Создание тестов мониторинга конечной точки службы 

Начните создавать тесты для отслеживания сетевых подключений к конечным точкам службы.

1. Щелкните вкладку **Монитор конечных точек службы**.
2. Нажмите кнопку **Добавить тест** и введите имя и описание теста. 
3. Выберите тип теста.<br>

    * Выберите **Веб**, чтобы отслеживать подключение к службе, которая отвечает на запросы HTTP(S), например outlook.office365.com или bing.com.<br>
    * Выберите **Сеть**, чтобы отслеживать подключение к службе, которая отвечает на запрос TCP, но не отвечает на запросы HTTP(S), например SQL Server, FTP-сервер или SSH-порт. 
4. Если вы не хотите выполнять такие измерения сети, как задержки сети, потери пакетов, а также обнаружение топологии, снимите флажок **Проведите измерения сети**. Оставьте этот флажок установленным, чтобы получить максимальные преимущества от возможности. 
5. В поле **Цель** введите URL-адрес, полное доменное имя или IP-адрес, сетевое подключение к которому необходимо отслеживать.
6. В поле **Номер порта** введите номер порта целевой службы. 
7. В поле **Периодичность проведения тестирования** введите значение частоты выполнения тестов. 
8. Выберите узлы, из которых требуется отслеживать сетевые подключения к службе. 

    >[!NOTE]
    > Для узлов под управлением сервера Windows эта возможность подразумевает выполнение измерений производительности сети с помощью запросов по протоколу TCP. Для узлов под управлением клиента Windows эта возможность подразумевает выполнение измерений производительности сети с помощью запросов по протоколу ICMP. В некоторых случаях целевое приложение блокирует входящие запросы на основе ICMP, когда узлы основаны на клиенте Windows. Решение не может выполнить измерение сети. В таких случаях рекомендуется использовать узлы под управлением Windows Server. 

9. Если не нужно создавать события работоспособности для выбранных элементов, снимите флажок **Enable Health Monitoring in the targets covered by this test** (Включить мониторинг работоспособности в целевых объектах, на которые распространяется этот тест). 
10. Выберите условия мониторинга. Вы можете задать настраиваемые пороговые значения для создания событий работоспособности. Каждый раз, когда значение условия превышает выбранное пороговое значение для выбранной пары сетей или подсетей, создается событие работоспособности. 
11. Чтобы сохранить конфигурацию, нажмите кнопку **Сохранить**. 

    ![Конфигурации тестов монитора конечных точек службы](media/log-analytics-network-performance-monitor/service-endpoint-configuration.png)



## <a name="walkthrough"></a>Пошаговое руководство 

Перейдите к представлению панели мониторинга Монитора производительности сети. На странице **Монитор конечных точек службы** вы найдете сводные данные работоспособности различных созданных вами тестов. 

![Страница "Монитор конечных точек службы"](media/log-analytics-network-performance-monitor/service-endpoint-blade.png)

На странице **Тесты** щелкните элемент, чтобы просмотреть дополнительные сведения о тестах. В таблице слева можно просмотреть сведения о состоянии работоспособности на определенный момент времени и значения времени отклика службы, задержки сети и потери пакетов для всех тестов. Чтобы просмотреть моментальный снимок о состоянии сети на другой момент времени в прошлом, выберите элемент управления "Network State Recorder" (Запись состояния сети). Выберите в таблице тест, который необходимо изучить. В области справа на диаграммах можно просмотреть исторические тенденции изменения значений потери, задержки и времени отклика. Щелкните ссылку **Сведения о тесте**, чтобы просмотреть сведения о производительности на каждом узле.

![Тесты монитора конечных точек службы](media/log-analytics-network-performance-monitor/service-endpoint-tests.png)

В представлении **Тестирование узлов** можно отслеживать сетевые подключения из каждого узла. Выберите узел, работа которого замедлилась. Это узел, на котором приложение работает медленно.

Определите причину ухудшения производительности приложения (из-за сети или из-за каких-либо проблем в конечной точке поставщика приложения), наблюдая за корреляцией между временем отклика приложения и задержкой сети. 

* **Проблема в приложении.** Если происходит резкое увеличение времени отклика, но задержка сети остается постоянной, то можно предположить, что сеть работает нормально и проблема возникла в конечной точке приложения. 

    ![Проблема приложения, обнаруженная монитором конечных точек службы](media/log-analytics-network-performance-monitor/service-endpoint-application-issue.png)

* **Неполадки в сети.** Если резкое увеличение времени отклика сопровождается соответствующим увеличением задержки сети, то можно предположить, что увеличение времени отклика происходит из-за увеличения задержки сети. 

    ![Неполадки сети, обнаруженные монитором конечных точек службы](media/log-analytics-network-performance-monitor/service-endpoint-network-issue.png)

Определив, что проблема кроется в сети, щелкните ссылку на представление **Топология**, чтобы определить проблемный прыжок на карте топологии. Пример показан на следующем рисунке. Общая задержка между узлом и конечной точкой приложения составляет 105 мс, а снижение на 96 мс произошло из-за прыжка, помеченного красным цветом. После определения проблемного прыжка можно выполнить корректирующее действие. 

![Тесты монитора конечных точек службы](media/log-analytics-network-performance-monitor/service-endpoint-topology.png)

## <a name="diagnostics"></a>Диагностика 

Если вы заметили неисправность, сделайте следующее.

* Если для времени отклика службы, потери пакетов в сети и задержки отображается значение "Недоступно", это может быть вызвано одной или несколькими из следующих причин.

    - Приложение не работает.
    - Узел, используемый для проверки сетевого подключения к службе, не работает.
    - Неверный целевой объект, введенный в конфигурации теста.
    - У узла нет сетевых подключений.

* Если для времени отклика службы отображается допустимое значение, а для потери пакетов в сети и задержки отображается значение "Недоступно", это может быть вызвано одной или несколькими из следующих причин.

    - Если узел, используемый для проверки сетевых подключений к службе, является клиентским компьютером Windows, целевая служба блокирует запросы ICMP или сетевой брандмауэр блокирует запросы ICMP, исходящие из узла.
    - В конфигурации теста не установлен флажок **Проведите измерения сети**. 

* Если для времени отклика службы указано значение "Недоступно", а для потери пакетов в сети и задержки указаны допустимые значения, возможно, целевая служба не является веб-приложением. Измените конфигурацию теста и выберите для типа теста значение **Сеть** вместо **Веб**. 

* Если приложение работает медленно, определите причину ухудшения производительности приложения (сеть или проблема в конечной точке поставщика приложения).


## <a name="next-steps"></a>Дополнительная информация
[Выполните поиск по журналам](log-analytics-log-searches.md), чтобы просмотреть подробные записи данных о производительности сети.
