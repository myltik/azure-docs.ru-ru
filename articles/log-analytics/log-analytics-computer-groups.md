---
title: "Использование групп компьютеров при поиске по журналам Log Analytics | Документация Майкрософт"
description: "В Log Analytics вы можете ограничить поиск по журналам определенной группой компьютеров.  В этой статье описывается, как можно создавать группы компьютеров и использовать их при поиске по журналам."
services: log-analytics
documentationcenter: 
author: bwren
manager: jwhit
editor: 
ms.assetid: a28b9e8a-6761-4ead-aa61-c8451ca90125
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/15/2017
ms.author: bwren
ms.translationtype: HT
ms.sourcegitcommit: 137671152878e6e1ee5ba398dd5267feefc435b7
ms.openlocfilehash: a2ddc932343d54963a378ee27dc962a790326b2a
ms.contentlocale: ru-ru
ms.lasthandoff: 07/28/2017

---
# <a name="computer-groups-in-log-analytics-log-searches"></a>Использование групп компьютеров при поиске по журналам Log Analytics

>[!NOTE]
> В этой статье описано, как использовать группы компьютеров с текущим языком запросов Log Analytics.    Если ваша рабочая область переведена на [новый язык запросов Log Analytics](log-analytics-log-search-upgrade.md), группы компьютеров будут работать по-другому.  В статье описываются различия в синтаксисе и поведение нового языка запросов.  


В Log Analytics вы можете ограничить [поиск по журналам определенной группой компьютеров](log-analytics-log-searches.md).  Каждая группа заполняется компьютерами с помощью определяемого запроса или при импорте групп из разных источников.  Если группу включить в область поиска по журналам, результаты будут ограничены записями, соответствующими компьютерам в этой группе.

## <a name="creating-a-computer-group"></a>Создание группы компьютеров
В Log Analytics группу компьютеров можно создать с помощью любого из способов, перечисленных в следующей таблице.  Подробные сведения о способе представлены в разделах ниже. 

| Метод | Описание |
|:--- |:--- |
| Поиск по журналам |Создание операции поиска по журналам, которая возвращает список компьютеров, и сохранение результатов в виде группы компьютеров. |
| API поиска по журналам |Использование API поиска по журналам для создания группы компьютеров на основе результатов поиска по журналам программным образом. |
| Active Directory |Автоматическая проверка членства в группе на компьютерах агента, которые являются членами домена Active Directory, и создание группы в Log Analytics для каждой группы безопасности. |
| WSUS |Автоматическая проверка целевых групп на клиентах или серверах WSUS и создание для каждой из них группы в Log Analytics. |

### <a name="log-search"></a>Поиск по журналам
Группы компьютеров, созданные с помощью операции поиска по журналам, содержат все компьютеры, возвращенные определенным поисковым запросом.  Так как этот запрос выполняется при каждом использовании группы компьютеров, отражаются все изменения, внесенные с момента создания группы.

Ниже описывается, как создать группу компьютеров с помощью операции поиска по журналам.

1. [Создайте операцию поиска по журналам](log-analytics-log-searches.md), которая возвращает список компьютеров.  Поиск должен возвращать группу компьютеров с использованием в запросе таких параметров, как **Distinct Computer** или **measure count() by Computer**.  
2. Нажмите кнопку **Сохранить** в верхней части экрана.
3. Для параметра **Сохранить этот запрос как группу компьютеров:** выберите значение **Да**.
4. Укажите **имя** и **категорию** группы.  Если операция поиска с тем же именем и категорией уже существует, будет предложено перезаписать ее.  У вас может быть несколько операций поиска с одинаковым именем в разных категориях. 

Ниже приведены примеры операций поиска, которые можно сохранить в виде группы компьютеров.

    Computer="Computer1" OR Computer="Computer2" | distinct Computer 
    Computer=*srv* | measure count() by Computer

>[!NOTE]
> Если ваша рабочая область переведена на [новый язык запросов Log Analytics](log-analytics-log-search-upgrade.md), в процедуре создания новой группы компьютеров выполняются следующие изменения.
>  
> - Запрос на создание группы компьютеров должен содержать параметр `distinct Computer`.  Ниже приведен пример запроса на создание группы компьютеров.<br>`Heartbeat | where Computer contains "srv" | distinct Computer `
> - При создании новой группы компьютеров необходимо кроме имени указать псевдоним.  Псевдоним применяется при использовании группы компьютеров в запросе, как описано ниже.  

### <a name="log-search-api"></a>API поиска по журналам
Группы компьютеров, созданные с помощью API поиска по журналам и операции поиска по журналам, аналогичны.

Дополнительные сведения о создании группы компьютеров с помощью этого варианта см. в статье [API REST поиска по журналам Log Analytics](log-analytics-log-search-api.md#computer-groups).

### <a name="active-directory"></a>Active Directory
При настройке Log Analytics для импорта членства в группах Active Directory выполняется анализ членства в группах всех присоединенных к домену компьютеров с агентом OMS.  Группа компьютеров создается в Log Analytics для каждой группы безопасности в Active Directory. При этом каждый компьютер включается в группы компьютеров, соответствующие группам безопасности, членами которых они являются.  Это членство обновляется каждые 4 часа.  

Log Analytics для импорта групп безопасности Active Directory можно настроить в меню **Группы компьютеров** в разделе **Параметры**.  Последовательно выберите **Автоматизация** и **Импорт членств в группах Active Directory с компьютеров**.  Дополнительная настройка не требуется.

![Группы компьютеров в Active Directory](media/log-analytics-computer-groups/configure-activedirectory.png)

При импорте групп в меню отображаются число компьютеров с обнаруженным членством в группах и число импортированных групп.  Можно щелкнуть любую из этих ссылок для возврата записей **ComputerGroup** с этой информацией.

### <a name="windows-server-update-service"></a>Служба обновления Windows Server
При настройке Log Analytics для импорта членства в группах WSUS выполняется анализ членства в целевых группах всех компьютеров с агентом OMS.  При выборе на стороне клиента членство в группе всех компьютеров, подключенных к OMS и входящих в любую целевую группу WSUS, импортируется в Log Analytics. При выборе на стороне сервера агент OMS должен быть установлен на сервере WSUS, чтобы обеспечить возможность импорта в OMS необходимо импортировать.  Это членство обновляется каждые 4 часа. 

Log Analytics для импорта групп безопасности Active Directory можно настроить в меню **Группы компьютеров** в разделе **Параметры**.  Последовательно выберите **Active Directory** и **Импорт членств в группах Active Directory с компьютеров**.  Дополнительная настройка не требуется.

![Группы компьютеров в Active Directory](media/log-analytics-computer-groups/configure-wsus.png)

При импорте групп в меню отображаются число компьютеров с обнаруженным членством в группах и число импортированных групп.  Можно щелкнуть любую из этих ссылок для возврата записей **ComputerGroup** с этой информацией.

## <a name="managing-computer-groups"></a>Управление группами компьютеров
В Log Analytics группы компьютеров, созданные с помощью операции или API поиска по журналам, можно просматривать в меню **Группы компьютеров** в разделе **Параметры**.  Щелкните значок **x** в столбце **Удаление**, чтобы удалить группу компьютеров.  Щелкните значок **просмотра участников** группы, чтобы выполнить поиск по журналам группы, который возвращает ее участников. 

![Сохраненные группы компьютеров](media/log-analytics-computer-groups/configure-saved.png)

Чтобы изменить группу, перезапишите ее. Для этого создайте новую группу с теми же **категорией** и **именем**.

## <a name="using-a-computer-group-in-a-log-search"></a>Использование группы компьютеров при поиске по журналам
Чтобы создать ссылку на группу компьютеров при поиске по журналам, используйте следующий синтаксис.  Выбор **категории** — необязательное действие, необходимое только для групп компьютеров с одинаковым именем в разных категориях. 

    $ComputerGroups[Category: Name]

При поиске первыми разрешаются члены групп компьютеров, включенных в поиск.  Если группа создана с использованием операции поиска по журналам, сначала выполняется поиск, возвращающий членов группы, и только потом — поиск по журналам верхнего уровня.

При поиске по журналам группы компьютеров обычно используются с предложением **IN**, как показано в следующем примере:

    Type=UpdateSummary Computer IN $ComputerGroups[My Computer Group]

>[!NOTE]
> Если ваша рабочая область переведена на [новый язык запросов Log Analytics](log-analytics-log-search-upgrade.md), группа компьютеров используется в запросе с интерпретацией ее псевдонима в качестве функции, как в следующем примере:
> 
>  `UpdateSummary | where Computer in (mycomputergroup)`

## <a name="computer-group-records"></a>Записи группы компьютеров
Запись создается в репозитории OMS для каждого членства в группе компьютеров, создаваемого в Active Directory или WSUS.  Записи о производительности имеют тип **ComputerGroup**. Их свойства описаны в таблице ниже.  Для групп компьютеров, созданных с помощью операции поиска по журналам, записи не создаются.

| Свойство | Описание |
|:--- |:--- |
| Тип |*ComputerGroup* |
| SourceSystem |*SourceSystem* |
| Компьютер |Имя компьютера-члена. |
| Группа |Имя группы. |
| GroupFullName |Полный путь к группе, включая источник и имя источника. |
| GroupSource |Источник, из которого получена группа. <br><br>ActiveDirectory<br>WSUS<br>WSUSClientTargeting |
| GroupSourceName |Имя источника, из которого получена группа.  Для Active Directory это имя домена. |
| ManagementGroupName |Имя группы управления для агентов SCOM.  Для других агентов это AOI-\<идентификатор_рабочей_области\>. |
| TimeGenerated |Дата и время создания или изменения группы компьютеров. |

## <a name="next-steps"></a>Дальнейшие действия
* Узнайте больше об [операциях поиска по журналу](log-analytics-log-searches.md) , которые можно применять для анализа данных, собираемых из источников данных и решений.  


