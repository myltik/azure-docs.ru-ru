---
title: Поиск по журналам в Azure Log Analytics | Документация Майкрософт
description: Чтобы получить данные из Log Analytics, требуется поиск по журналам.  В этой статье описывается использование новых поисков по журналам в Log Analytics и приведены основные сведения, которые необходимо знать перед их созданием.
services: log-analytics
documentationcenter: ''
author: bwren
manager: carmonm
editor: ''
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/29/2017
ms.author: bwren
ms.openlocfilehash: 5f040d1480433ccf4c0b2b22c0cf1e25a7151d74
ms.sourcegitcommit: 8aab1aab0135fad24987a311b42a1c25a839e9f3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2018
ms.locfileid: "29952948"
---
# <a name="understanding-log-searches-in-log-analytics"></a>Основные сведения о поисках по журналам в Log Analytics

Чтобы получить данные из Log Analytics, требуется поиск по журналам.  Независимо от того, анализируете ли вы данные на портале, настраиваете ли правило генерации оповещений для уведомления о конкретном состоянии или получаете ли данные с помощью API Log Analytics, вы будете использовать поиск по журналам, чтобы указать нужные данные.  В этой статье описывается использование поисков по журналам в Log Analytics и предоставляются основные сведения, которые необходимо знать перед их созданием. Дополнительные сведения о создании и редактировании поисков по журналам, а также материалы о языке запросов см. в разделе [Дальнейшие действия](#next-steps).

## <a name="where-log-searches-are-used"></a>Где используются поиски по журналам

Ниже приведены различные способы использования поисков по журналам в Log Analytics:

- **Порталы.** Вы можете выполнять интерактивный анализ данных в репозитории с помощью портала Azure или [портала расширенной аналитики](https://go.microsoft.com/fwlink/?linkid=856587).  Так вы можете изменить запрос и анализировать результаты в различных форматах и визуализациях.  Большинство создаваемых запросов сначала выполняются на одном из порталов. Убедившись, что они работают ожидаемым образом, вы можете копировать их в нужное расположение.
- **Правила генерации оповещений.** [Правила генерации оповещений](log-analytics-alerts.md) заранее выявляют проблемы с данными в рабочей области.  Каждое правило генерации оповещений основано на поиске по журналам, который автоматически выполняется через определенные интервалы.  Результаты проверяются, чтобы определить, следует ли создавать оповещение.
- **Представления.**  Вы можете создавать визуализации данных, которые добавлены на панели мониторинга пользователя, с помощью [конструктора представлений](log-analytics-view-designer.md).  Поиски по журналам предоставляют данные, используемые [плитками](log-analytics-view-designer-tiles.md) и [элементами визуализации](log-analytics-view-designer-parts.md), в каждом представлении.  Для дальнейшего анализа данных можно выполнить детализацию из элементов визуализации на странице поиска по журналам.
- **Экспорт.**  Когда вы экспортируете данные из рабочей области Log Analytics в Excel или [Power BI](log-analytics-powerbi.md), вы создаете поиск по журналам для определения экспортируемых данных.
- **PowerShell.** Вы можете запустить скрипт PowerShell из командной строки или модуль Runbook службы автоматизации Azure, использующий командлет [Get-AzureRmOperationalInsightsSearchResults](https://docs.microsoft.com/powershell/module/azurerm.operationalinsights/get-azurermoperationalinsightssearchresults?view=azurermps-4.0.0), для получения данных из Log Analytics.  Для этого командлета требуется запрос, чтобы определить извлекаемые данные.
- **API Log Analytics.**  [API поиска по журналам службы Log Analytics](log-analytics-log-search-api.md) позволяет любому клиенту REST API извлекать данные из рабочей области.  Запрос API включает запрос, который выполняется в Log Analytics, чтобы определить извлекаемые данные.

![Поиск по журналам](media/log-analytics-log-search-new/log-search-overview.png)

## <a name="how-log-analytics-data-is-organized"></a>Упорядочивание данных в Log Analytics
При создании запроса сначала нужно определить, какие таблицы содержат нужные данные. Каждый [источник данных](log-analytics-data-sources.md) и [решение](../operations-management-suite/operations-management-suite-solutions.md) хранит данные в выделенных таблицах в рабочей области Log Analytics.  Документация для каждого источника данных и решения включает имя создаваемого типа данных и описание каждого из его свойств.  Многие запросы потребуют только данные из одной таблицы, но другие могут использовать множество параметров для включения данных из нескольких таблиц.

![Таблицы](media/log-analytics-log-search-new/queries-tables.png)


## <a name="writing-a-query"></a>Написание запроса
Основой поисков по журналам в Log Analytics является [обширный язык запросов](https://docs.loganalytics.io/), позволяющий извлекать и анализировать данные из репозитория различными способами.  Этот же язык запросов используется для [Application Insights](../application-insights/app-insights-analytics.md).  Сведения о написании запроса крайне важны для создания поисков по журналам в Log Analytics.  Обычно начинают с основных запросов, а затем переходят к использованию более усовершенствованных функций, так как требования становятся более сложными.

Базовая структура запроса — это исходная таблица и ряд операторов, разделенных символом вертикальной черты `|`.  Вы можете объединить в цепочку несколько операторов для уточнения данных и выполнения расширенных функций.

Например, предположим, необходимо найти первые десять компьютеров с наибольшим количеством событий ошибок за последний день.

    Event
    | where (EventLevelName == "Error")
    | where (TimeGenerated > ago(1days))
    | summarize ErrorCount = count() by Computer
    | top 10 by ErrorCount desc

Или нужно найти компьютеры, которые не были активными в течение последнего дня.

    Heartbeat
    | where TimeGenerated > ago(7d)
    | summarize max(TimeGenerated) by Computer
    | where max_TimeGenerated < ago(1d)  

Как насчет графика, отражающего использование процессора на каждом компьютере за прошлую неделю?

    Perf
    | where ObjectName == "Processor" and CounterName == "% Processor Time"
    | where TimeGenerated  between (startofweek(ago(7d)) .. endofweek(ago(7d)) )
    | summarize avg(CounterValue) by Computer, bin(TimeGenerated, 5min)
    | render timechart    

Из этих примеров можно увидеть, что независимо от типа данных, с которыми вы работаете, структура запроса является аналогичной.  Ее можно разбить на отдельные действия, где полученные данные из одной команды отправляются через конвейер в следующую команду.

Кроме того, вы можете запрашивать данные из рабочих областей Log Analytics в рамках своей подписки.

    union Update, workspace("contoso-workspace").Update
    | where TimeGenerated >= ago(1h)
    | summarize dcount(Computer) by Classification 


Полную документацию по языку запросов Azure Log Analytics, включающую руководства и справочник по языку, см. [здесь](https://docs.loganalytics.io/).

## <a name="next-steps"></a>Дополнительная информация

- Узнайте о [порталах, которые можно использовать для создания и изменения поисков по журналам](log-analytics-log-search-portals.md).
- Изучите [руководство по написанию запросов](log-analytics-tutorial-viewdata.md) на новом языке.
