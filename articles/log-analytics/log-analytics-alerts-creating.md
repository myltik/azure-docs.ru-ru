---
title: Создание оповещений в OMS Log Analytics | Документация Майкрософт
description: Оповещения в Log Analytics идентифицируют важную информацию в репозитории OMS и могут заранее уведомлять вас о возникших проблемах или выполнять действия в попытке устранить их.  Эта статья описывает создание правила генерации оповещений и сведения о различных действиях, которые оно может выполнить.
services: log-analytics
documentationcenter: ''
author: bwren
manager: jwhit
editor: tysonn
ms.assetid: 6cfd2a46-b6a2-4f79-a67b-08ce488f9a91
ms.service: log-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/13/2018
ms.author: bwren
ms.openlocfilehash: b692822660ab12f89b274cea75727fb808d673f8
ms.sourcegitcommit: 1362e3d6961bdeaebed7fb342c7b0b34f6f6417a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2018
ms.locfileid: "31519585"
---
# <a name="working-with-alert-rules-in-log-analytics"></a>Работа с правилами генерации оповещений в Log Analytics

> [!NOTE]
> В этой статье описываются классические оповещения Log Analytics, управление которыми осуществляется на портале OMS.  Оповещения в Log Analytics [применимы и в Azure](../monitoring-and-diagnostics/monitoring-alerts-extend.md).  После этого вы создадите и измените правила генерации оповещений на портале Azure и ознакомитесь с процедурами, описанными в этой статье.


Оповещения создаются с помощью правил оповещения, которые автоматически выполняют поиск по журналам через регулярные интервалы.  Они создают запись оповещения, если результаты соответствуют определенным условиям.  После этого правило может автоматически запустить одно или несколько действий, чтобы заблаговременно уведомить вас об оповещении либо вызвать другой процесс.   

В этой статье описываются процессы создания и изменения правил генерации оповещений с помощью портала OMS.  Дополнительные сведения о различных параметрах и инструкции по реализации необходимой логики см. в статье [Реагирование на проблемы в Log Analytics с использованием оповещений](log-analytics-alerts.md).


## <a name="create-an-alert-rule"></a>Создание правила оповещения

Чтобы создать правило генерации оповещений на портале OMS, начните с поиска записей, которые должны вызывать оповещение, в журналах.  После этого станет доступна кнопка **Оповещение** , позволяющая создать и настроить правило генерации оповещений.

>[!NOTE]
> В рабочей области Log Analytics сейчас можно создать до 250 правил генерации оповещений. 

1. На странице обзора OMS щелкните **Log Search**(Поиск журналов).
2. Создайте новый запрос поиска журналов или выберите сохраненный поиск. 
3. Щелкните **Оповещение** в верхней части страницы, чтобы открыть экран **Добавить правило оповещения**.
4. Настройте правило генерации оповещений, используя сведения из раздела [Сведения о правилах генерации оповещений](#details-of-alert-rules) этой статьи.
6. Щелкните **Сохранить** для завершения работы с правилом генерации оповещений.  Оно запускается немедленно.


## <a name="edit-an-alert-rule"></a>Изменение правила генерации оповещений
Список всех правил генерации оповещений можно получить в меню **Оповещения** раздела **Параметры** Log Analytics.  

![Управление оповещениями](./media/log-analytics-alerts/configure.png)

1. В консоли OMS выберите плитку **Параметры** .
2. Выберите **Оповещения**.

В этом представлении можно выполнить несколько действий.

* Отключите правило, выбрав параметр **Отключить** рядом с ним.
* Измените правило генерации оповещений, щелкнув значок карандаша рядом с ним.
* Удалите правило генерации оповещений, щелкнув значок **X** рядом с ним. 

## <a name="details-of-alert-rules"></a>Сведения о правилах генерации оповещений
Когда вы создаете или изменяете правило генерации оповещений на портале OMS, вы работаете на странице **добавления правила генерации оповещений** или **изменения правила генерации оповещений**.  В следующих таблицах описываются поля на этой странице.

![Правило генерации оповещений](media/log-analytics-alerts/add-alert-rule.png)

### <a name="alert-information"></a>Alert information (Сведения об оповещении)
Это основные параметры для правила генерации оповещений и оповещений, которые оно создает.

| Свойство | ОПИСАНИЕ |
|:--- |:---|
| ИМЯ | Уникальное имя для идентификации правила генерации оповещений. Это имя включается во все оповещения, созданные этим правилом.  |
| ОПИСАНИЕ | Необязательное описание правила оповещения. |
| Уровень серьезности |Уровень серьезности оповещений, созданных этим правилом. |

### <a name="search-query-and-time-window"></a>Поисковый запрос и временное окно
Поисковый запрос и временное окно, которые возвращают записи. Эти записи оцениваются, чтобы определить, необходимо ли создавать оповещения.

| Свойство | ОПИСАНИЕ |
|:--- |:---|
| Поисковый запрос | Это запрос, который будет выполнен.  Чтобы определить, создается ли оповещение, будут использоваться записи, возвращаемые этим запросом.<br><br>Щелкните **Use current search query** (Использовать текущий запрос), чтобы выбрать текущий запрос, или выберите сохраненный поисковый запрос из списка.  Синтаксис запроса приведен в текстовое поле, где его можно изменить. |
| Time window (Временное окно) |Указывает диапазон времени для запроса.  Запрос возвращает только те записи, которые были созданы в течение этого периода, предшествующего настоящему времени.  Это значение может составлять от 5 минут до 24 часов.  Оно должно быть больше или равно частоте оповещений.  <br><br> Например, если временное окно равно 60 минутам, а запрос выполняется в 13:15, возвращаются только записи, созданные между 12:15 и 13:15. |

При указании временного окна для правила генерации оповещений отображается число существующих записей, соответствующих критериям поиска, для этого временного окна.  Это помогает определить частоту, позволяющую получить ожидаемое число результатов.

### <a name="schedule"></a>Расписание
Определяет, как часто следует выполнять поисковый запрос.

| Свойство | ОПИСАНИЕ |
|:--- |:---|
| Alert frequency (Частота оповещений) | Указывает, как часто должен выполняться запрос. Это значение может составлять от 5 минут до 24 часов. Оно должно быть меньше или равно временному окну.  Если значение больше, чем временное окно, появляется риск пропуска записей.<br><br>Например, рассмотрим временное окно в 30 минут и частоту в 60 минут.  Если запрос выполняется в 13:00, он возвращает записи между 12:30 и 13:00.  В следующий раз этот запрос будет выполнен в 14:00, а записи возвратятся между 13:30 и 14:00.  Записи, созданные между 13:00 и 13:30, не будут учитываться. |


### <a name="generate-alert-based-on"></a>Создать оповещение на основе
Задает условия, выполнение которых будет оцениваться по результатам запроса поиска, чтобы определить, если следует создавать оповещение.  Эти сведения будут отличаться в зависимости от типа выбранного правила генерации оповещений.  Сведения о разных типах правил генерации оповещений можно получить в разделе [Реагирование на проблемы в Log Analytics с использованием оповещений](log-analytics-alerts.md).

| Свойство | ОПИСАНИЕ |
|:--- |:---|
| Отменить вывод оповещений | При включении подавления для правила генерации оповещений действия для этого правила отключаются на заданный промежуток времени после создания оповещения. Правило по прежнему выполняется и создает записи оповещений при соблюдении критериев. Это дает вам время устранить проблему без запуска повторяющихся действий. |

#### <a name="number-of-results-alert-rules"></a>Number of results alert rules (Количество результатов для правила генерации оповещений)

| Свойство | ОПИСАНИЕ |
|:--- |:---|
| Количество результатов |Оповещение создается, если количество записей, возвращаемых запросом, **больше** или **меньше** указанного вами значения.  |

#### <a name="metric-measurement-alert-rules"></a>Metric measurement alert rules (Измерение метрики для правила генерации оповещений)

| Свойство | ОПИСАНИЕ |
|:--- |:---|
| Статистическое значение | Пороговое значение, при превышении которого каждым из статистических значений в результатах считается, что произошло нарушение. |
| Активировать оповещение на основе | Число нарушений, для которого создается оповещение.  Можно указать значение свойства **Всего брешей**, чтобы учитывать любое сочетание нарушений в наборе результатов, или значение свойства **Последовательные бреши**, чтобы учитывать только нарушения, следующие подряд. |

### <a name="actions"></a>Действия
Правила генерации оповещений всегда создают [запись оповещения](#alert-records) при достижении порогового значения.  Вы также можете определить одно или несколько ответных действий, которые будут выполняться при достижении этого значения, например отправка сообщения электронной почты или запуск runbook.



#### <a name="email-actions"></a>Действия электронной почты
Действия электронной почты отправляют сообщение электронной почты с описанием оповещения одному или несколькими получателям.

| Свойство | ОПИСАНИЕ |
|:--- |:---|
| Уведомление по электронной почте |Укажите **Да** , если хотите отправить сообщение электронной почты при активации оповещения. |
| Субъект |Тема сообщения электронной почты.  Основной текст сообщения нельзя изменить. |
| Recipients |Адреса всех получателей электронной почты.  При указании нескольких адресов разделяйте их точкой с запятой (;). |

#### <a name="webhook-actions"></a>Действия webhook
Действия webhook позволяют вызывать внешний процесс с помощью одного запроса HTTP POST.

| Свойство | ОПИСАНИЕ |
|:--- |:---|
| webhook |Укажите **Да** , если хотите вызвать webhook при активации оповещения. |
| URL-адрес Webhook |URL-адрес действия webhook. |
| Include custom JSON payload (Включить пользовательские полезные данные JSON) |Выберите этот параметр, если хотите заменить полезные данные по умолчанию пользовательскими. |
| Enter your custom JSON payload (Введите пользовательские полезные данные JSON) |Пользовательские полезные данные для действия webhook.  Подробности приведены в предыдущем разделе. |

#### <a name="runbook-actions"></a>Действия Runbook
Действия Runbook запускают модуль Runbook в службе автоматизации Azure. 

>[!NOTE]
> Чтобы включить это действие, установите решение службы автоматизации в рабочей области. 


| Свойство | ОПИСАНИЕ |
|:--- |:---|
| Модуль Runbook | Укажите **Да** , если хотите запустить модуль Runbook службы автоматизации Azure при активации оповещения.  |
| Учетная запись службы автоматизации | Указывает учетную запись службы автоматизации, из которой выбираются модули runbook.  Это учетная запись действия, связанная с рабочей областью. |
| Выберите Runbook | Выберите модуль runbook, который нужно запускать при создании оповещения. |
| Запуск на | Выберите **Azure**, чтобы запустить runbook в облаке.  Выберите **Гибридная рабочая роль**, чтобы запустить модуль runbook в агенте с установленной [гибридной рабочей ролью Runbook](../automation/automation-hybrid-runbook-worker.md ).  |




## <a name="next-steps"></a>Дополнительная информация
* Установите [решение для управления оповещениями](log-analytics-solution-alert-management.md) , чтобы анализировать предупреждения, созданные Log Analytics, вместе с оповещениями, данные о которых собраны из System Center Operations Manager (SCOM).
* Вы можете ознакомиться с дополнительными сведениями о [поисках журналов](log-analytics-log-searches.md) , которые могут создавать оповещения.
* Вы можете выполнить пошаговое руководство по [настройке webook](log-analytics-alerts-webhooks.md) с использованием правила генерации оповещений.  
* Вы можете научиться писать [модули Runbook в службе автоматизации Azure](https://azure.microsoft.com/documentation/services/automation) для устранения проблем, обозначенных в оповещениях.

