---
title: Инфраструктура отчетов о потреблении для поставщиков облачных служб в Azure Stack | Документация Майкрософт
description: Azure Stack включает всю необходимую инфраструктуру для отслеживания потребления и передачи этой информации в Azure.
services: azure-stack
documentationcenter: ''
author: mattbriggs
manager: femila
editor: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/08/2018
ms.author: mabrigg
ms.reviewer: alfredo
ms.openlocfilehash: 7fe2a6444e605f388df68803b89643420b19fb54
ms.sourcegitcommit: 3017211a7d51efd6cd87e8210ee13d57585c7e3b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/06/2018
ms.locfileid: "34823492"
---
## <a name="usage-reporting-infrastructure-for-cloud-service-providers"></a>Инфраструктура отчетов о потреблении для поставщиков облачных служб

Azure Stack включает всю необходимую инфраструктуру для отслеживания потребления и передачи этой информации в Azure. В Azure эти данные обрабатываются службой Azure Commerce, которая на их основании выставляет счета соответствующим подпискам Azure, так же как и за потребление глобального облака Azure.

Некоторые концепции одинаково применяются для глобальной платформы Azure и Azure Stack. Azure Stack использует локальные подписки, роль которых аналогична подпискам Azure. Локальные подписки действуют только в локальной среде. Локальные подписки сопоставляются с подписками Azure только при передаче данных о потреблении в Azure.

Azure Stack применяет для потребления локальные единицы измерения. Эти локальные данные сопоставляются с единицами измерения Azure Commerce. Но идентификаторы единиц измерения будут разными. Локально применяется больше единиц измерения, чем корпорация Майкрософт использует для выставления счетов.

Существуют некоторые различия в том, как оцениваются службы в Azure Stack и Azure. Например, оплата виртуальных машин в Azure Stack основана только на количестве виртуальных ядер в час, и для всех серий виртуальных машин применяется одинаковая ставка. Для глобальной платформы Azure используется другой механизм оценки, в котором разные цены соответствуют разному оборудованию. В Azure Stack клиент сам предоставляет свое оборудование, а значит нет никаких оснований дифференцировать цены для разных классов виртуальных машин.

Информацию о единицах измерения и ценах, используемых в Azure Commerce для Azure Stack, как и для служб Azure, вы можете получить в Центре партнеров:

1. В Центре партнеров откройте **меню панели мониторинга** > **Цены и предложения**.
2. В разделе **Usage-based services** (Службы на основе использования) выберите **Текущая**.
3. Откройте электронную таблицу **Azure in Global CSP price list** (Прайс-лист Azure в глобальных CSP).
4. Установите фильтр по значению **Region = Azure Stack**.

## <a name="usage-and-billing-error-codes"></a>Коды ошибок, относящихся к потреблению и выставлению счетов

При добавлении клиентов в регистрацию могут появляться следующие сообщения об ошибках.

| Ошибка                           | Сведения                                                                                                                                                                                                                                                                                                                           | Комментарии                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|---------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| RegistrationNotFound            | Не найдена указанная регистрация. Убедитесь, что правильно указаны следующие данные.<br>1. Идентификатор подписки (указанное значение: _идентификатор подписки_).<br>2. Группа ресурсов (указанное значение: _группа ресурсов_).<br>3. Имя регистрации (указанное значение: _имя регистрации_).                             | Такая ошибка обычно возникает, если неверно указаны сведения об исходной регистрации. Если потребуется проверить имена группы ресурсов и регистрации, вы можете найти их на портале Azure, открыв список ресурсов. Если вы найдете здесь несколько ресурсов регистрации, проверьте свойство CloudDeploymentID в окне свойств и выберите ту регистрацию, у которой значение CloudDeploymentID совпадает с идентификатором облака. Чтобы найти CloudDeploymentID, выполните эту команду PowerShell в Azure Stack:<br>`$azureStackStampInfo = Invoke-Command -Session $session -ScriptBlock { Get-AzureStackStampInformation }` |
| BadCustomerSubscriptionId       | Указанные _идентификатор подписки клиента_ и идентификатор подписки _имя регистрации_ не принадлежат одному поставщику служб Microsoft Cloud. Проверьте, правильно ли указан идентификатор подписки клиента. Если проблема не исчезнет, обратитесь в службу поддержки. | Такая ошибка возникает, когда подписка клиента является подпиской CSP, но сопоставленный с ней партнер CSP отличается от того, к которому относится подписка исходной регистрации. Эта проверка позволяет избежать такой ситуации, в которой счета за Azure Stack будут выставляться партнеру CSP, который не имеет к ней отношения.                                                                                                                                                                                                                                                                          |
| InvalidCustomerSubscriptionId   | Указанный _идентификатор подписки клиента_ недопустим. Убедитесь, что указана допустимая подписка Azure.                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| CustomerSubscriptionNotFound    | _Идентификатор подписки клиента_ не найден в "имя регистрации". Убедитесь, что используется действительная подписка Azure и нужный идентификатор подписки добавлен к регистрации с помощью операции PUT.                                                   | Такая ошибка возникает, если при попытке проверить наличие клиента в подписке обнаружится, что подписка клиента не связана с этой регистрацией. Клиент не добавлен в регистрацию или идентификатор подписки указан неправильно.                                                                                                                                                                                                                                                                                                                                |
| UnauthorizedCspRegistration     | Указанная регистрация _имя регистрации_ не позволяет использовать мультитенантность. Отправьте сообщение электронной почты на адрес azstCSP@microsoft.com и укажите в нем имя регистрации, группу ресурсов и идентификатор подписки, которые использовались для этой регистрации.                                                                                    | Чтобы добавлять в регистрацию клиентов, корпорация Майкрософт должна разрешить для нее мультитенантность. Подробнее этот вопрос рассматривается в разделе регистрации клиентов в этом документе.                                                                                                                                                                                                                                                                                                                                                                                                             |
| CustomerSubscriptionsNotAllowed | Операции подписки клиента не поддерживаются для отключенных клиентов. Чтобы использовать эту функцию, повторно зарегистрируйтесь, выбрав модель оплаты по мере использования.                                                                                                                                                                    | Регистрация, к которой вы добавляете клиентов, использует модель оплаты за емкость, то есть при ее создании был использован параметр BillingModel Capacity. Добавлять клиентов можно только к регистрациям с оплатой по мере использования. Повторите регистрацию заново, используя параметр BillingModel PayAsYouUse.                                                                                                                                                                                                                                                                                          |
| InvalidCSPSubscription          | Указанный _идентификатор подписки клиента_ не является допустимой подпиской CSP. Убедитесь, что указана допустимая подписка Azure.                                                                                                                                                        | Чаще всего это связано с синтаксической ошибкой в имени подписки клиента.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| MetadataResolverBadGatewayError | Один из вышестоящих серверов вернул непредвиденную ошибку. Повторите попытку позже. Если проблема не исчезнет, обратитесь в службу поддержки.                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

## <a name="terms-used-for-billing-and-usage"></a>Термины, относящиеся к выставлению счетов и потреблению

Для процессов потребления и выставления счетов в Azure Stack применяются следующие термины и концепции.

| Термин | Определение |
| --- | --- |
| Прямой партнер CSP | Прямой партнер CSP (поставщик облачных решений) оплачивает использование Azure и Azure Stack напрямую корпорации Майкрософт, а затем выставляет счета своим клиентам. |
| Непрямой партнер CSP | Торговые посредники сотрудничают с распространителями. Торговые посредники находят и привлекают пользователей. Непрямые поставщики поддерживают финансовое взаимодействие с корпорацией Майкрософт, управляют выставлением счетов клиентам и предоставляет дополнительные услуги, например техническую поддержку. |
| Клиент | Клиентами считаются предприятия и государственные учреждения, владеющие приложениями и другими рабочими нагрузками, которые выполняются в Azure Stack. |

## <a name="next-steps"></a>Дополнительная информация

 - Информацию о программе для поставщиков облачных решений вы найдете [здесь](https://partnercenter.microsoft.com/en-us/partner/programs).
 - Дополнительные сведения см. в статье об [использовании ресурсов и выставлении счетов в Azure Stack](azure-stack-billing-and-chargeback.md).
