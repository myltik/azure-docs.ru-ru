---
title: Телеметрия Azure Stack | Документация Майкрософт
description: В этой статье описывается настройка параметров телеметрии Azure Stack с помощью PowerShell.
services: azure-stack
documentationcenter: ''
author: jeffgilb
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/17/2018
ms.author: jeffgilb
ms.reviewer: misainat
ms.openlocfilehash: bfd16901c5ce036719a1ed19e9a5b5c6ef52be93
ms.sourcegitcommit: 96089449d17548263691d40e4f1e8f9557561197
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/17/2018
ms.locfileid: "34257430"
---
# <a name="azure-stack-telemetry"></a>Телеметрия Azure Stack

Системные данные Azure Stack или телеметрия автоматически отправляются в Майкрософт с помощью функциональных возможностей подключенных пользователей. Данные, собранные из телеметрии Azure Stack, используются командами Майкрософт в основном для улучшения взаимодействия с пользователем и для анализа безопасности, работоспособности, качества и производительности.

Как оператор Azure Stack, телеметрия может предоставить ценную информацию о корпоративном развертывании и помогает формировать будущие версии Azure Stack.

> [!NOTE]
> Azure Stack также можно настроить для переадресации информации об использовании в Azure для выставления счетов. Это необходимо для клиентов Azure Stack с несколькими узлами, которые выбирают оплату по мере использования. Отчеты об использовании управляются независимо от телеметрии и не требуются для пользователей с несколькими узлами, которые выбирают модель на основе емкости, или для пользователей Пакета средств разработки Azure Stack. В таких сценариях отчеты об использовании можно отключить [с помощью скрипта регистрации](https://docs.microsoft.com/azure/azure-stack/azure-stack-usage-reporting).

Телеметрия Azure Stack создана на основе компонента "Функциональные возможности для подключенных пользователей и телеметрия" Windows Server 2016, который использует технологию ведения журнала [трассировки событий Windows](https://msdn.microsoft.com/library/dn904632(v=vs.85).aspx) для сбора и хранения событий и данных телеметрии. Компоненты Azure Stack используют одну и ту же технологию ведения журнала для публикации событий и данных, собранных с помощью общедоступных журналов событий операционной системы и API трассировки. Примеры компонентов Azure Stack включают в себя поставщик сетевых ресурсов, поставщик ресурсов хранилища, поставщик ресурсов мониторинга и поставщик ресурсов обновления. Компонент "Функциональные возможности для подключенных пользователей и телеметрия" шифрует данные с помощью SSL и использует закрепление сертификата для передачи данных телеметрии через HTTPS в службу управления данными Майкрософт.

> [!NOTE]
> Чтобы обеспечить поддержку потока данных телеметрии, в сети необходимо открыть порт 443 (HTTPS). Компонент "Функциональные возможности для подключенных пользователей и телеметрия" подключается к службе управления данными Майкрософт по адресу https://v10.vortex-win.data.microsoft.com. Компонент "Функциональные возможности для подключенных пользователей и телеметрия" также подключается к https://settings-win.data.microsoft.com, чтобы скачать информацию о конфигурации.

## <a name="privacy-considerations"></a>Рекомендации по конфиденциальности
Служба трассировки событий Windows направляет данные телеметрии в защищенное облачное хранилище. Доступ к данным телеметрии предоставляется по принципу наименьшего приоритета. Только сотрудникам Майкрософт с соответствующими бизнес-задачами разрешен доступ к данным телеметрии. Корпорация Майкрософт не предоставляет личные данные клиентов третьим лицам, кроме как по усмотрению клиента или в ограниченных случаях, описанных в [заявлении о конфиденциальности в Azure Stack](https://privacy.microsoft.com/PrivacyStatement). Мы предоставляем общий доступ к бизнес-отчетам с OEM и партнерами, которые включают агрегированную, анонимизированную информацию о телеметрии. Решения о предоставлении общего доступа к данным принимаются внутренней группой корпорации Майкрософт, включая решения о конфиденциальности и правах, а также заинтересованными лицами управления данными.

Корпорация Майкрософт верит в принцип минимизации информации и придерживается его. Мы стремимся собрать только необходимую информацию и сохраняем ее пока она нужна для предоставления службы или для анализа. Большинство сведений о том, как работает система Azure Stack и службы Azure, удаляется в течение 6 месяцев. Сводные или объединенные данные хранятся в течение более длительного периода.

Мы понимаем, что конфиденциальность и безопасность информации наших клиентов очень важна. Мы использовали продуманный и комплексный подход к конфиденциальности и защите данных клиентов с помощью Azure Stack. У ИТ-администраторов есть средства для настройки компонентов и параметров конфиденциальности в любое время. Наша приверженность прозрачности и доверию очевидна:
- мы не скрываем от клиентов типы данных, которые мы собираем;
- мы предоставили возможность управления корпоративным клиентам, чтобы они могли настроить собственные параметры конфиденциальности;
- конфиденциальность и безопасность клиента — наш приоритет;
- мы не скрываем, как используются данные телеметрии;
- мы используем данные телеметрии для улучшения удобства работы клиентов.

Корпорация Майкрософт не планирует собирать конфиденциальную информацию, такую ​​как номера кредитных карт, имена пользователей и пароли, адреса электронной почты или другую аналогичную конфиденциальную информацию. Если мы обнаружим, что случайно получили конфиденциальную информацию, мы удалим ее.

## <a name="examples-of-how-microsoft-uses-the-telemetry-data"></a>Примеры использования телеметрии в корпорации Майкрософт
Телеметрия играет важную роль, помогая быстро выявлять и устранять критические проблемы надежности в развертываниях и конфигурациях клиентов. Анализ собираемых данных телеметрии помогает быстро выявлять проблемы со службами или конфигурациями оборудования. Возможность корпорации Майкрософт получать эти данные от клиентов и повышать качество обслуживания в экосистеме помогает повысить качество работы интегрированных решений Azure Stack.

Телеметрия также помогает Майкрософт лучше понять, как клиенты развертывают компоненты, а также используют возможности и службы для достижения своих бизнес-целей. Получение аналитики на основе этих данных помогает определить приоритетные инвестиции в разработку в областях, которые могут напрямую повлиять на условия работы клиентов и рабочие нагрузки.

Некоторые примеры включают использование клиентами контейнеров, хранилищ и сетевых конфигураций, связанных с ролями Azure Stack. Мы также используем аналитику для оптимизации и внедрения средств анализа в некоторых из наших решений для управления и мониторинга. Это помогает клиентам диагностировать проблемы с качеством и экономить деньги, реже обращаясь в службу поддержки Майкрософт.

## <a name="manage-telemetry-collection"></a>Управление коллекцией телеметрии
Мы не рекомендуем отключать телеметрию в организации, так как она предоставляет данные, которые можно применить для улучшения функциональности и стабильности продукта. Однако мы понимаем, что в некоторых сценариях это может быть необходимо.

В таких сценариях можно настроить уровень телеметрии, отправляемой в корпорацию Майкрософт, с помощью предварительного развертывания параметров реестра или использования конечных точек телеметрии после развертывания.

### <a name="set-telemetry-level-in-the-windows-registry"></a>Настройка уровня телеметрии в реестре Windows
Редактор реестра Windows используется, чтобы вручную установить уровень телеметрии на физическом компьютере узла перед развертыванием Azure Stack. Если политика управления уже существует (например, групповая политика), она перезаписывает этот параметр реестра.

Прежде чем развертывать Azure Stack в узле комплекта разработки, выполните загрузку в файл Cloudbuilder.vhdx и запустите следующий скрипт в окне PowerShell с повышенными привилегиями:

```powershell
### Get current AllowTelmetry value on DVM Host
(Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection" `
-Name AllowTelemetry).AllowTelemetry
### Set & Get updated AllowTelemetry value for ASDK-Host
Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection" `
-Name "AllowTelemetry" -Value '0' # Set this value to 0,1,2,or3.  
(Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection" `
-Name AllowTelemetry).AllowTelemetry
```

Уровни телеметрии являются накопительными и подразделяются на четыре категории (0–3):

**0 (безопасность)**. Только данные безопасности. Информация, необходимая для обеспечения безопасности операционной системы, включая данные о параметрах компонента "Функциональные возможности для подключенных пользователей и телеметрия" и Защитника Windows. На этом уровне не выделяется конкретная телеметрия Azure Stack.

**1 (базовый)**. Данные безопасности, базовые данные работоспособности и качества. Базовая информация об устройстве, включая данные, связанные с качеством; совместимость приложений; данные об использовании приложения и данные с уровня безопасности. Настройка базового уровня телеметрии позволяет использовать телеметрию Azure Stack. Данные, собранные на этом уровне, включают:

- **Базовую информацию об устройстве**, которая помогает обеспечить представление о типах и конфигурациях собственных и виртуализированных экземпляров Windows Server 2016 в экосистеме, включая:
 - атрибуты компьютера, такие как OEM и модель;
 - атрибуты сети, такие как число и скорость сетевых адаптеров;
 - атрибуты процессора и памяти, такие как число ядер и объем памяти;
 - атрибуты хранилища, такие как число дисков, тип и размер.
- **Функциональные возможности телеметрии**, в том числе процент отправленных событий, удаленных событий и последнее время отправки.
- **Сведения, связанные с качеством**, позволяют разрабатывать базовые представления о работе Azure Stack. Пример — количество критических оповещений в конкретной конфигурации оборудования.
- \*\*Данные о совместимости, которые дают представление о том, какие поставщики ресурсов установлены в системе и на виртуальной машине, и идентифицируют потенциальные проблемы совместимости.

**2 (расширенный)**. Дополнительные сведения, в том числе: как используется операционная система и другие службы Azure Stack, как они работают, данные о повышенной надежности и данные из базового уровня и из уровня безопасности.

**3 (полный)**. Все данные, необходимые для определения и устранения проблем, а также данные с уровней **Безопасность**, **Базовый** и **Расширенный**.

> [!NOTE]
> Значение уровня телеметрии по умолчанию — 2 (расширенный).

При отключении телеметрии Windows и Azure Stack отключается и телеметрия SQL. Дополнительные сведения о последствиях настроек телеметрии Windows Server см. в [техническом документе о телеметрии Windows](https://aka.ms/winservtelemetry).

> [!IMPORTANT]
> Эти уровни телеметрии применяются только к компонентам Microsoft Azure Stack. Стороннее программное обеспечение компонентов и служб, которое выполняется в узле отслеживания жизненного цикла оборудования от партнеров Azure Stack, производящих оборудование, может взаимодействовать с облачными службами за пределами этих уровней телеметрии. Ваш поставщик аппаратных решений Azure Stack поможет вам разобраться в политике телеметрии, а также в том, как можно принять ее или отказаться от нее.

### <a name="enable-or-disable-telemetry-after-deployment"></a>Включение и отключение телеметрии после развертывания

Чтобы включить или отключить телеметрию после развертывания, необходим доступ к привилегированной конечной точке (PEP), которая предоставляется на виртуальных машинах ERCS.
1.  Чтобы включить, выполните функцию `Set-Telemetry -Enable`.
2.  Чтобы отключить, выполните функцию `Set-Telemetry -Disable`.

Сведения о PARAMETER:
> .PARAMETER Enable — включение передачи данных телеметрии.

> .PARAMETER Disable — отключение передачи данных телеметрии.  

**Скрипт, позволяющий включить телеметрию:**
```powershell
$ip = "<IP ADDRESS OF THE PEP VM>" # You can also use the machine name instead of IP here.
$pwd= ConvertTo-SecureString "<CLOUD ADMIN PASSWORD>" -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential ("<DOMAIN NAME>\CloudAdmin", $pwd)
$psSession = New-PSSession -ComputerName $ip -ConfigurationName PrivilegedEndpoint -Credential $cred
Invoke-Command -Session $psSession {Set-Telemetry -Enable}
if($psSession)
{
    Remove-PSSession $psSession
}
```

**Скрипт, позволяющий отключить телеметрию:**
```powershell
$ip = "<IP ADDRESS OF THE PEP VM>" # You can also use the machine name instead of IP here.
$pwd= ConvertTo-SecureString "<CLOUD ADMIN PASSWORD>" -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential ("<DOMAIN NAME>\CloudAdmin", $pwd)
$psSession = New-PSSession -ComputerName $ip -ConfigurationName PrivilegedEndpoint -Credential $cred
Invoke-Command -Session $psSession {Set-Telemetry -Disable}
if($psSession)
{
    Remove-PSSession $psSession
}
```

## <a name="next-steps"></a>Дополнительная информация
[Добавление элемента Marketplace](asdk-marketplace-item.md)
