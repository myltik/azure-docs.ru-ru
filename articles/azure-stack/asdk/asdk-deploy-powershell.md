---
title: Развертывание Azure Stack (PowerShell) | Документация Майкрософт
description: В рамках этого руководства вы установите ASDK из командной строки.
services: azure-stack
documentationcenter: ''
author: jeffgilb
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: tutorial
ms.custom: mvc
ms.date: 03/16/2018
ms.author: jeffgilb
ms.reviewer: misainat
ms.openlocfilehash: 48ccccaba6b7f5780f1d42dfbe5d9747c5e30292
ms.sourcegitcommit: a36a1ae91968de3fd68ff2f0c1697effbb210ba8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/17/2018
---
# <a name="tutorial-deploy-the-asdk-from-the-command-line"></a>Руководство по установке ASDK из командной строки
В рамках этого руководства вы развернете Пакет средств разработки Azure Stack (ASDK) из командной строки в нерабочей среде. 

ASDK — это среда тестирования и разработки, которую можно развернуть для оценки и демонстрации функций и служб Azure Stack. Для ее установки и запуска необходимо подготовить аппаратную часть среды и выполнить ряд скриптов (это займет несколько часов). После этого вы сможете войти на портал администратора и портал пользователя, чтобы приступить к работе с Azure Stack.

Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * Скачивание пакета развертывания и извлечение его содержимого.
> * Подготовка компьютера, на котором будет размещен пакет средств разработки. 
> * Настройка после развертывания.
> * Регистрация в Azure.

## <a name="prerequisites"></a>предварительным требованиям 
Подготовьте компьютер, на котором будет размещен пакет средств разработки. Составьте план относительно структуры оборудования, программного обеспечения и сети. Компьютер, на котором размещается пакет средств разработки (узел пакета средств разработки), должен соответствовать требованиям к оборудованию, программному обеспечению и сети. Определитесь с выбором между использованием Azure Active Directory (Azure AD) или служб федерации Active Directory (AD FS). Прежде чем начинать развертывание, убедитесь в том, что выполнены предварительные требования, чтобы процесс установки прошел без проблем. 

Перед развертыванием ASDK необходимо убедиться в том, что аппаратная часть главного компьютера, на котором устанавливаются средства разработки, операционная система, учетная запись и конфигурация сети, соответствуют минимальным требованиям, предусмотренным для установки ASDK.

**[Ознакомьтесь с рекомендациями по планированию развертывания ASDK](asdk-deploy-considerations.md)**

> [!TIP]
> Чтобы убедиться, что оборудование соответствует всем требованиям, после установки операционной системы можно использовать [Средство проверки на соответствие требованиям к развертыванию Azure Stack](https://gallery.technet.microsoft.com/Deployment-Checker-for-50e0f51b).

## <a name="download-and-extract-the-deployment-package"></a>Скачивание пакета развертывания и извлечение его содержимого
Когда вы удостоверитесь, что компьютер, на котором будет размещен пакет средств разработки, соответствует базовым требованиям для установки ASDK, скачайте и пакет ASDK и извлеките его содержимое. Пакет развертывания содержит файл Cloudbuilder.vhdx, который является виртуальным жестким диском с загружаемой операционной системой и файлами установки Azure Stack.

Пакет развертывания можно скачать на компьютер, где размещается пакет средств разработки, или на другой компьютер. Извлекаемые файлы развертывания занимают 60 ГБ дискового пространства, поэтому использование другого компьютера помогает снизить требования к оборудованию для узла пакета средств разработки.

**[Скачивание Пакета средств разработки Azure Stack (ASDK) и извлечение его содержимого](asdk-download.md)**

## <a name="prepare-the-development-kit-host-computer"></a>Подготовка компьютера, на котором будет размещен пакет средств разработки
Перед установкой ASDK на главный компьютер необходимо подготовить среду и настроить загрузку системы с виртуального жесткого диска. После этого главный компьютер с установленными средствами разработки загрузится с Cloudbuilder.vhdx (виртуальный жесткий диск, содержащий загружаемую операционную систему и файлы установки Azure Stack).

Настройте главный компьютер с ASDK для загрузки с CloudBuilder.vhdx с помощью PowerShell. Эти команды настроят главный компьютер с ASDK для загрузки со скачанного и извлеченного виртуального жесткого диска Azure Stack (CloudBuilder.vhdx). После выполнения этих действий перезапустите главный компьютер ASDK.

Настройка главного компьютера с ASDK для загрузки с CloudBuilder.vhdx:

  1. Запустите командную строку от имени администратора.
  2. Запустите `bcdedit /copy {current} /d "Azure Stack"`
  3. Скопируйте (CTRL+C) возвращенное значение CLSID, включая требуемые символы {}. Это значение называется {CLSID} и его нужно вставить (с помощью клавиш CTRL+V или щелчком правой кнопкой мыши) на оставшихся шагах.
  4. Запустите `bcdedit /set {CLSID} device vhd=[C:]\CloudBuilder.vhdx` 
  5. Запустите `bcdedit /set {CLSID} osdevice vhd=[C:]\CloudBuilder.vhdx` 
  6. Запустите `bcdedit /set {CLSID} detecthal on` 
  7. Запустите `bcdedit /default {CLSID}`
  8. Чтобы проверить параметры загрузки, запустите `bcdedit`. 
  9. Переместите файл CloudBuilder.vhdx в корень диска C:\ (C:\CloudBuilder.vhdx) и перезапустите главный компьютер пакета разработки. При перезапуске главного компьютера с ASDK он должен загрузиться с жесткого диска виртуальной машины CloudBuilder.vhdx, чтобы начать развертывание ASDK. 

> [!IMPORTANT]
> Прежде чем перезапускать главный компьютер с установленными средствами разработки, убедитесь в наличии прямого физического или KVM-доступа к нему. При первом запуске виртуальной машины она предлагает завершить установку Windows Server. Укажите те же учетные данные администратора, что использовались для входа на компьютер с установленными средствами разработки. 

### <a name="prepare-the-development-kit-host-using-powershell"></a>Подготовка узла комплекта разработки с помощью PowerShell 
После успешной загрузки главного компьютера с установленными средствами разработки из образа CloudBuilder.vhdx вход в него осуществляется с использованием тех же учетных данных локального администратора, которые использовались для входа на главный компьютер с установленными средствами разработки (вводятся для завершения работы с программой установки Windows Server при загрузке главного компьютера с виртуального жесткого диска). 

> [!NOTE]
> Кроме того, при необходимости можно также настроить [параметры телеметрии Azure Stack](asdk-telemetry.md#set-telemetry-level-in-the-windows-registry) *до* установки ASDK.

Откройте консоль PowerShell с повышенными привилегиями и выполните команды этого раздела для установки ASDK на главном компьютере с установленными средствами разработки.

> [!IMPORTANT] 
> Установка ASDK поддерживает только один сетевой адаптер (NIC) для работы в сети. При наличии нескольких сетевых интерфейсов перед выполнением сценария развертывания включите только один из них, а все остальные отключите.

Вы можете развернуть Azure Stack с помощью Azure AD или AD FS Windows Server в качестве поставщика удостоверений. Azure Stack, поставщики ресурсов и другие приложения одинаково работают с обеими службами.

> [!TIP]
> Если вы не указали никаких параметров настройки (см. ниже раздел о дополнительных параметрах и примерах InstallAzureStackPOC.ps1), появится запрос на ввод необходимых параметров.

### <a name="deploy-azure-stack-using-azure-ad"></a>Развертывание Azure Stack с помощью Azure AD 
Чтобы развернуть Azure Stack **с использованием Azure AD в качестве поставщика удостоверений** , компьютер должен быть подключен к Интернету напрямую или через прозрачный прокси-сервер. 

Выполните следующие команды PowerShell для развертывания пакета средств разработки с помощью Azure AD:

  ```powershell
  cd C:\CloudDeployment\Setup     
  $adminpass = Get-Credential Administrator     
  .\InstallAzureStackPOC.ps1 -AdminPassword $adminpass.Password
  ```

Через несколько минут после установки ASDK вам потребуется ввести учетные данные Azure AD. Укажите учетные данные глобального администратора Azure AD для клиента Azure AD. 

### <a name="deploy-azure-stack-using-ad-fs"></a>Развертывание Azure Stack с помощью AD FS 
Чтобы развернуть пакет разработки **с использованием AD FS в качестве поставщика удостоверений**, выполните следующие команды PowerShell (вам просто нужно добавить параметр -UseADFS): 

  ```powershell
  cd C:\CloudDeployment\Setup     
  $adminpass = Get-Credential Administrator 
  .\InstallAzureStackPOC.ps1 -AdminPassword $adminpass.Password -UseADFS
  ```

При развертывании служб федерации Active Directory служба каталогов по умолчанию используется в качестве поставщика удостоверений. Учетная запись по умолчанию для входа — azurestackadmin@azurestack.local, а в качестве пароля будет использоваться пароль, указанный как часть команд настройки PowerShell.

Процесс развертывания может занять несколько часов, в течение которых система автоматически перезагрузится один раз. После завершения развертывания в окне консоли PowerShell отобразится следующее сообщение:**COMPLETE: Action ‘Deployment’** (Завершено: действие "Развертывание"). Если развертывание завершилось сбоем, выполните сценарий снова, используя параметр -rerun. Вы также можете [повторно развернуть ASDK](asdk-redeploy.md) с нуля.

> [!IMPORTANT]
> Если вы хотите отслеживать ход развертывания после перезагрузки компьютера ASDK, войдите в систему как AzureStack\AzureStackAdmin. Если вы входите в систему как локальный администратор после перезапуска главного компьютера (и присоединения к домену azurestack.local), вы не увидите ход выполнения развертывания. В этом случае повторное развертывание выполнять не нужно. Чтобы проверить выполнение процесса, просто войдите в систему как azurestack.


#### <a name="azure-ad-deployment-script-examples"></a>Примеры сценария развертывания AAD
Полное развертывание AAD можно прописать в сценарии. Несколько примеров с комментариями, содержащими некоторые необязательные параметры.

Если удостоверение AAD связано только с **одним** каталогом AAD:
```powershell
cd C:\CloudDeployment\Setup 
$adminpass = Get-Credential Administrator 
$aadcred = Get-Credential "<Azure AD global administrator account name>" 
.\InstallAzureStackPOC.ps1 -AdminPassword $adminpass.Password -InfraAzureDirectoryTenantAdminCredential $aadcred -TimeServer 52.168.138.145 #Example time server IP address.
```

Если удостоверение AAD связано только с **несколькими** каталогами AAD:
```powershell
cd C:\CloudDeployment\Setup 
$adminpass = Get-Credential Administrator 
$aadcred = Get-Credential "<Azure AD global administrator account name>" #Example: user@AADDirName.onmicrosoft.com 
.\InstallAzureStackPOC.ps1 -AdminPassword $adminpass.Password -InfraAzureDirectoryTenantAdminCredential $aadcred -InfraAzureDirectoryTenantName "<Azure AD directory in the form of domainname.onmicrosoft.com or an Azure AD verified custom domain name>" -TimeServer 52.168.138.145 #Example time server IP address.
```

Если в вашей среде отключен протокол DHCP, в один из предоставленных примеров использования необходимо включить приведенные ниже дополнительные параметры. 

```powershell
.\InstallAzureStackPOC.ps1 -AdminPassword $adminpass.Password -InfraAzureDirectoryTenantAdminCredential $aadcred -NatIPv4Subnet 10.10.10.0/24 -NatIPv4Address 10.10.10.3 -NatIPv4DefaultGateway 10.10.10.1 -TimeServer 10.222.112.26
```

### <a name="asdk-installazurestackpocps1-optional-parameters"></a>Необязательные параметры ASDK InstallAzureStackPOC.ps1
|Параметр|Обязательный/необязательный|ОПИСАНИЕ|
|-----|-----|-----|
|AdminPassword|Обязательно|Задает учетную запись локального администратора и другие учетные записи пользователей на всех виртуальных машинах, созданных в процессе развертывания пакета разработки. Этот пароль должен совпадать с текущим паролем локального администратора на узле.|
|InfraAzureDirectoryTenantName|Обязательно|Задает каталог клиента. Используйте этот параметр, чтобы указать конкретный каталог, где у учетной записи AAD есть разрешения на управление несколькими каталогами. Полное имя клиента каталога AAD имеет формат .onmicrosoft.com или имя проверенного личного домена Azure AD.|
|TimeServer|Обязательно|Используйте этот параметр, чтобы указать определенный сервер времени. Этот параметр может быть предоставлен в качестве допустимого IP-адреса сервера времени. Имена серверов не поддерживаются.|
|InfraAzureDirectoryTenantAdminCredential|Необязательно|Задает имя пользователя и пароль Azure Active Directory. В качестве этих учетных данных Azure следует использовать идентификатор организации.|
|InfraAzureEnvironment|Необязательно|Выберите среду Azure, в которой вы хотите зарегистрировать это развертывание Azure Stack. Допустимые значения: Общедоступная служба Azure, Azure — Китай, Azure — US Government.|
|DNSForwarder|Необязательно|DNS-сервер, созданный в ходе развертывания Azure Stack. Чтобы разрешить компьютерам в решении разрешать имена, расположенные за пределами метки, укажите имеющийся DNS-сервер инфраструктуры. DNS-сервер, расположенный в этой метке, перенаправляет неизвестные запросы на сопоставление имен на этот DNS-сервер.|
|NatIPv4Address|Требуется для поддержки преобразования сетевых адресов (NAT) DHCP|Задает статический IP-адрес для MAS-BGPNAT01. Используйте этот параметр только в том случае, если DHCP не удается назначить допустимый IP-адрес для доступа в Интернет.|
|NatIPv4Subnet|Требуется для поддержки преобразования сетевых адресов (NAT) DHCP|Префикс IP-подсети, используемый для обеспечения поддержки DHCP через преобразование сетевых адресов. Используйте этот параметр только в том случае, если DHCP не удается назначить допустимый IP-адрес для доступа в Интернет.|
|PublicVlanId|Необязательно|Задает идентификатор виртуальной локальной сети. Используйте этот параметр, только если на узле и MAS-BGPNAT01 необходимо настроить идентификатор виртуальной сети для доступа к физической сети (и Интернету). Например, .\InstallAzureStackPOC.ps1 -Verbose -PublicVLan 305|
|Rerun|Необязательно|Этот флажок используется для повторного выполнения развертывания. Используются все предыдущие входные данные. Повторный ввод ранее предоставленных данных не поддерживается, так как для развертывания создаются и используются несколько уникальных значений.|


## <a name="perform-post-deployment-configurations"></a>Настройка после развертывания
После установки ASDK нужно выполнить несколько рекомендуемых проверок и внести некоторые изменения в настройки. Чтобы проверить правильность установки, используйте командлет test-AzureStack и установите средства PowerShell и GitHub для Azure Stack. 

Чтобы срок действия пароля на вход в главный компьютер со средствами разработки не завершился до окончания периода ознакомления, сбросьте политику истечения срока действия пароля.

> [!NOTE]
> Кроме того, *после* установки ASDK при необходимости можно настроить [параметры телеметрии Azure Stack](asdk-telemetry.md#enable-or-disable-telemetry-after-deployment).

**[Задачи, выполняемые после развертывания ASDK](asdk-post-deploy.md)**

## <a name="register-with-azure"></a>Регистрация в Azure
Azure Stack необходимо зарегистрировать в Azure, чтобы можно было [скачивать элементы Azure Marketplace](asdk-marketplace-item.md) в Azure Stack.

**[Регистрация Azure Stack в Azure](asdk-register.md)**

## <a name="next-steps"></a>Дополнительная информация
Поздравляем! После выполнения этих действий вы получите среду пакета средств разработки и портал для[администратора](https://adminportal.local.azurestack.external) и [пользователя](https://portal.local.azurestack.external). 

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * Скачивание пакета развертывания и извлечение его содержимого.
> * Подготовка компьютера, на котором будет размещен пакет средств разработки. 
> * Настройка после развертывания.
> * Регистрация в Azure.

Переход к следующему руководству по добавлению элемента Azure Stack Marketplace.

> [!div class="nextstepaction"]
> [Добавление элемента Marketplace Azure Stack](asdk-marketplace-item.md)

