---
title: Планирование емкости для ролей сервера службы приложений Azure в Azure Stack | Документация Майкрософт
description: Планирование емкости для ролей сервера службы приложений Azure в Azure Stack
services: azure-stack
documentationcenter: ''
author: brenduns
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: app-service
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/29/2018
ms.author: brenduns
ms.reviewer: anwestg
ms.openlocfilehash: 8926955d5e0260b5971e07b6988bb21df9980847
ms.sourcegitcommit: d87b039e13a5f8df1ee9d82a727e6bc04715c341
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/21/2018
ms.locfileid: "29388589"
---
# <a name="capacity-planning-for-azure-app-service-server-roles-in-azure-stack"></a>Планирование емкости для ролей сервера службы приложений Azure в Azure Stack
*Область применения: интегрированные системы Azure Stack и Пакет средств разработки Azure Stack*

Чтобы подготовить готовое для рабочей среды развертывание службы приложений Azure в Azure Stack, необходимо запланировать емкость, которую система будет поддерживать.  Эта статья содержит рекомендации по минимальному числу экземпляров и номеров SKU для вычислений, которое следует использовать для любого рабочего развертывания.

Запланировать стратегию емкости службы приложений можно с помощью следующих правил. В будущих версиях Azure Stack будут предложены варианты высокого уровня доступности для службы приложений.

| Роль сервера службы приложений | Минимальное рекомендуемое число экземпляров | Рекомендуемый номер SKU для вычислений|
| --- | --- | --- |
| Controller | 2 | A1 |
| Внешний интерфейс | 2 | A1 |
| управления | 2 | A3 |
| ИЗДАТЕЛЬ | 2 | A1 |
| Рабочие роли — общие | 2 | A1 |
| Рабочие роли — выделенные | 2 на уровень | A1 |

## <a name="controller-role"></a>Роль контроллера

**Рекомендуемое минимальное число**: два экземпляра A1 Standard

Контроллер службы приложений Azure, как правило, характеризуется низким потреблением ресурсов ЦП, памяти и сетевых ресурсов. Но для обеспечения высокой доступности необходимо иметь два контроллера. Два контроллера — это также максимально разрешенное количество. Второй контроллер веб-сайтов можно создать непосредственно из установщика во время развертывания.

## <a name="front-end-role"></a>Роль внешнего интерфейса

**Рекомендуемое минимальное число**: два экземпляра A1 Standard

Внешний интерфейс направляет запросы к рабочим ролям в зависимости от их доступности. Для обеспечения высокой доступности следует иметь несколько внешних интерфейсов и можно иметь более двух. При планировании емкости допустим, что каждое ядро может обрабатывать приблизительно 100 запросов в секунду.

## <a name="management-role"></a>Роль управления

**Рекомендуемое минимальное число**: два экземпляра A3

Роль управления службы приложений Azure отвечает за конечные точки API и Azure Resource Manager для службы приложений и расширения портала (порталы администратора, клиента и Функций), а также службу данных. Для роли сервера управления, как правило, требуется всего около 4 ГБ ОЗУ в рабочей среде. Тем не менее могут возникать высокие уровни использования ЦП при одновременном выполнении многих задач управления (например, создание веб-сайта). Для обеспечения высокой доступности этой роли необходимо назначить несколько серверов, а на каждом сервере должно быть как минимум два ядра.

## <a name="publisher-role"></a>Роль издателя

**Рекомендуемое минимальное число**: два экземпляра A1

Если многие пользователи проводят публикацию одновременно, в роли издателя может возникать интенсивное использование ЦП. Для обеспечения высокой доступности должны быть доступны несколько ролей издателя.  Издатель обрабатывает только трафик FTP и FTPS.

## <a name="web-worker-role"></a>Рабочая роль

**Рекомендуемое минимальное число**: два экземпляра A1

Для обеспечения высокой доступности необходимо иметь по крайней мере четыре рабочие роли: две для общего режима веб-сайта и две для каждого уровня выделенной рабочей роли, которую вы собираетесь предлагать. Общий и выделенный режимы вычислений предоставляют клиентам различные уровни обслуживания. При наличии большого количества клиентов могут понадобиться дополнительные рабочие роли:
 - используя уровни рабочих ролей выделенного режима вычислений (которые являются ресурсоемкими);
 - работая в общем режиме вычислений.

После того как пользователь создаст план службы приложений для номера SKU выделенного режима вычислений, число рабочих ролей, указанное в этом плане службы приложений, больше не будет доступно для пользователей.

Чтобы предоставить пользователям Функции Azure в модели плана потребления, необходимо развернуть общие рабочие роли.

При выборе количества общих рабочих ролей учтите следующие рекомендации:

- **Память.** Это наиболее важный ресурс для рабочей роли. Недостаток памяти влияет на производительность веб-сайта, когда объем виртуальной памяти переносится с диска. Для каждого сервера требуется примерно 1,2 ГБ ОЗУ для операционной системы. Объем ОЗУ, превышающий это пороговое значение, можно использовать для запуска веб-сайтов.
- **Процент активных веб-сайтов.** Как правило, около 5 процентов приложений в службе приложений Azure в развертывании Azure Stack являются активными. Но процент приложений, которые активны в любой момент, может быть выше или ниже. При частоте активных приложений в 5 процентов максимальное число приложений, которое можно разместить в развертывании службы приложений Azure в Azure Stack, не должно превышать:
    - число активных веб-сайтов, умноженное на 20 (5 x 20 = 100).
- **Средний объем памяти.** Средний объем памяти для приложений, наблюдаемых в рабочих средах, равен примерно 70 МБ. Таким образом объем памяти, выделенный для всех компьютеров или виртуальных машин с рабочими ролями, можно рассчитать следующим образом:

    *Количество подготовленных приложений * 70 МБ * 5 % (количество рабочих ролей * 1044 МБ)*

   Например, при наличии 5000 приложений в среде, в которой выполняется 10 рабочих ролей, размер ОЗУ каждой виртуальной машины рабочей роли должен быть 7060 МБ:

   5000 * 70 * 0,05 — (10 * 1044) = 7060 (= примерно 7 ГБ)

   Сведения о добавлении дополнительных экземпляров рабочих ролей см. в статье [App Service on Azure Stack: Add more infrastructure or worker roles](azure-stack-app-service-add-worker-roles.md) (Служба приложений в Azure Stack. Добавление дополнительной инфраструктуры и рабочих ролей).

## <a name="file-server-role"></a>Роль файлового сервера

Для роли файлового сервера вы можете использовать автономный файловый сервер для разработки и тестирования. Например, при развертывании Службы приложения Azure с помощью Пакета средств разработки Azure Stack можно использовать этот шаблон: https://aka.ms/appsvconmasdkfstemplate. В рабочей среде следует использовать предварительно настроенный файловый сервер Windows или предварительно настроенный файловый сервер не под управлением Windows.

В рабочих средах роль файлового сервера проводит большое количество дисковых операций ввода-вывода. Так как в ней размещается все содержимое и файлы приложений для веб-сайтов пользователей, для этой роли необходимо предварительно настроить один из следующих компонентов:
- файловый сервер Windows;
- кластер файлового сервера;
- файловый сервер не под управлением Windows;
- кластер файлового сервера;
- устройство NAS (запоминающее устройство, подключаемое к сети) (дополнительные сведения см. в [этой статье](azure-stack-app-service-before-you-get-started.md#prepare-the-file-server)).

## <a name="next-steps"></a>Дополнительная информация

[Подготовка к работе со службой приложений в Azure Stack](azure-stack-app-service-before-you-get-started.md)
