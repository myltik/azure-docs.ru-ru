---
title: Требования к сертификатам инфраструктуры открытых ключей Azure Stack для интегрированных систем Azure Stack | Документация Майкрософт
description: В этой статье описываются требования к развертыванию сертификатов PKI Azure Stack для интегрированных систем Azure Stack.
services: azure-stack
documentationcenter: ''
author: jeffgilb
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/29/2018
ms.author: jeffgilb
ms.reviewer: ppacent
ms.openlocfilehash: 583f827fe77ef7721b3098dee01c418c9e5cccd8
ms.sourcegitcommit: 20d103fb8658b29b48115782fe01f76239b240aa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2018
---
# <a name="azure-stack-public-key-infrastructure-certificate-requirements"></a>Требования к сертификатам инфраструктуры открытых ключей Azure Stack

В Azure Stack есть открытая сеть инфраструктуры, которая использует общедоступные IP-адреса. Эти IP-адреса назначаются небольшому набору служб Azure Stack и по возможности виртуальным машинам клиента. Во время развертывания Azure Stack требуются сертификаты PKI с соответствующими DNS-именами для открытых конечных точек инфраструктуры Azure Stack. Эта статья описывает следующее:

- Сертификаты, необходимые для развертывания Azure Stack.
- Процесс получения сертификатов, соответствующих этим спецификациям.
- Процесс подготовки, проверки и использования этих сертификатов во время развертывания.

> [!NOTE]
> Во время развертывания необходимо скопировать сертификаты в папку развертывания, соответствующую поставщику удостоверений, в котором выполняется развертывание (Azure AD или AD FS). Если вы используете один сертификат для всех конечных точек, необходимо скопировать этот файл сертификата в каждую папку развертывания, как описано в приведенных ниже таблицах. Структура папок предварительно создана на виртуальной машине развертывания: C:\CloudDeployment\Setup\Certificates. 

## <a name="certificate-requirements"></a>Требования к сертификатам
Ниже приводятся требования к сертификатам, которые необходимы для развертывания Azure Stack. 
- Сертификаты должны быть выданы внутренним или общедоступным центром сертификации. При использовании общедоступного центра сертификации он должен быть включен в базовый образ операционной системы как часть программы "Доверенный корневой центр сертификации Майкрософт". Полный список можно найти здесь: https://gallery.technet.microsoft.com/Trusted-Root-Certificate-123665ca. 
- Инфраструктура Azure Stack должна иметь сетевой доступ к центру сертификации, в котором подписываются сертификаты.
- При смене сертификатов их должен выдавать либо тот же внутренний центр сертификации, который используется для подписывания сертификатов, предъявляемых при развертывании, либо любой общедоступный центра сертификации из указанного выше списка.
- Использование самозаверяющих сертификатов не поддерживается.
- Сертификат может быть групповым сертификатом, охватывающим все пространства имен в поле "Альтернативное имя субъекта" (SAN). Также можно применять отдельные сертификаты, используя шаблоны для конечных точек (например, службы **ACS** и Key Vault), где они необходимы. 
- Для подписи сертификата нельзя использовать алгоритм SHA1, так как требуется более строгий алгоритм. 
- Сертификат должен быть PFX-файлом, так как и открытый, и закрытый ключи являются обязательными для установки Azure Stack. 
- PFX-файлы сертификатов должны иметь значение Digital Signature и KeyEncipherment в поле Key Usage.
- PFX-файлы сертификатов должны иметь значения "Проверка подлинности сервера (1.3.6.1.5.5.7.3.1)" и "Проверка подлинности клиента (1.3.6.1.5.5.7.3.2)" в поле "Улучшенное использование ключа".
- Значение в поле сертификата "Issued to:" должно отличаться от значения в поле "Issued by:".
- Пароли для всех PFX-файлов сертификатов должны быть одинаковыми во время развертывания.
- Убедитесь, что имена субъектов и альтернативные имена субъектов сертификатов соответствует спецификациям, описанным в этой статье, чтобы избежать сбоев при развертывании.

> [!NOTE]
> Самозаверяющие сертификаты не поддерживаются.

> [!NOTE]
> Поддерживается наличие промежуточных центров сертификации в цепочках доверия сертификата. 

## <a name="mandatory-certificates"></a>Обязательные сертификаты
Таблица в этом разделе описывает сертификаты PKI общедоступных конечных точек Azure Stack, необходимых для развертываний Azure Stack (Azure AD и AD FS). Требования к сертификатам группируются по области, используемым пространствам имен и сертификатам, необходимых для каждого пространства имен. В таблице также описаны папки, в которые поставщик решений копирует разные сертификаты для каждой общедоступной конечной точки. 

Требуются сертификаты с соответствующими DNS-именами для открытой конечной точки инфраструктуры Azure Stack. DNS-имя для каждой конечной точки выражается в таком формате: *&lt;префикс>.&lt;регион>.&lt;полное доменное имя>*. 

Значения [регион] и [внешнее полное доменное имя] в вашем развертывании должны совпадать с регионом и внешними доменными именами, выбранными для вашей системы Azure Stack. Например, если имя региона *Redmond*, а имя внешнего домена — *contoso.com*, DNS-имена будет иметь формат *&lt;префикс>.redmond.contoso.com*. Значения *&lt;префикс>* предварительно определяет корпорация Майкрософт для описания конечной точки, защищенной с помощью сертификата. Кроме того значения *&lt;префикс >* внешних конечных точек инфраструктуры зависят от инфраструктуры Azure Stack, которая использует конкретную конечную точку. 

> [!note]  
> Сертификаты можно указать как один шаблон сертификата, охватывающий все пространства имен в полях субъекта и альтернативного имени субъекта (SAN), скопированный во все каталоги, или как отдельные сертификаты для каждой конечной точки, скопированные в соответствующий каталог. Обратите внимание, что в обоих вариантах необходимо использовать шаблоны сертификатов для конечных точек, таких как **ACS** и хранилище ключей, где они необходимы. 

| Папка развертывания | Требуемый субъект сертификата и альтернативное имя субъекта | Область (для каждого региона) | Пространство имен поддомена |
|-------------------------------|------------------------------------------------------------------|----------------------------------|-----------------------------|
| Общедоступный портал | portal.&lt;регион>.&lt;полное доменное имя> | Порталы | &lt;регион>.&lt;полное доменное имя> |
| Портал администрирования | adminportal.&lt;регион>.&lt;полное доменное имя> | Порталы | &lt;регион>.&lt;полное доменное имя> |
| Общедоступный Azure Resource Manager | management.&lt;регион>.&lt;полное доменное имя> | Диспетчер ресурсов Azure | &lt;регион>.&lt;полное доменное имя> |
| Администратор Azure Resource Manager | adminmanagement.&lt;регион>.&lt;полное доменное имя> | Диспетчер ресурсов Azure | &lt;регион>.&lt;полное доменное имя> |
| ACSBlob | *blob.&lt;регион>.&lt;полное доменное имя><br>Групповой SSL-сертификат | Хранилище BLOB-объектов | blob.&lt;регион>.&lt;полное доменное имя> |
| ACSTable | *table.&lt;регион>.&lt;полное доменное имя><br>Групповой SSL-сертификат | Хранилище таблиц | table.&lt;регион>.&lt;полное доменное имя> |
| ACSQueue | *queue.&lt;регион>.&lt;полное доменное имя><br>Групповой SSL-сертификат | Хранилище очередей | queue.&lt;регион>.&lt;полное доменное имя> |
| Хранилище ключей | *vault.&lt;регион>.&lt;полное доменное имя><br>Групповой SSL-сертификат | хранилище ключей; | vault.&lt;регион>.&lt;полное доменное имя> |
| Внутреннее хранилище Key Vault | *adminvault.&lt;регион>.&lt;полное доменное имя><br>Групповой SSL-сертификат |  Внутреннее хранилище Key Vault |  adminvault.&lt;регион>.&lt;полное доменное имя> |

### <a name="for-azure-stack-environment-on-pre-1803-versions"></a>Для среды Azure Stack версий ниже 1803

|Папка развертывания|Требуемый субъект сертификата и альтернативное имя субъекта|Область (для каждого региона)|Пространство имен поддомена|
|-----|-----|-----|-----|
|Общедоступный портал|portal.*&lt;регион>.&lt;полное доменное имя>*|Порталы|*&lt;регион>.&lt;полное доменное имя>*|
|Портал администрирования|adminportal.*&lt;регион>.&lt;полное доменное имя>*|Порталы|*&lt;регион>.&lt;полное доменное имя>*|
|Общедоступный Azure Resource Manager|management.*&lt;регион>.&lt;полное доменное имя>*|Диспетчер ресурсов Azure|*&lt;регион>.&lt;полное доменное имя>*|
|Администратор Azure Resource Manager|adminmanagement.*&lt;регион>.&lt;полное доменное имя>*|Диспетчер ресурсов Azure|*&lt;регион>.&lt;полное доменное имя>*|
|ACS<sup>1</sup>|Один групповой сертификат для нескольких поддоменов с альтернативными именами субъекта:<br>&#42;.blob.*&lt;регион>.&lt;полное доменное имя>*<br>&#42;.queue.*&lt;регион>.&lt;полное доменное имя>*<br>&#42;.table.*&lt;регион>.&lt;полное доменное имя>*|Хранилище|blob.*&lt;регион>.&lt;полное доменное имя>*<br>table.*&lt;регион>.&lt;полное доменное имя>*<br>queue.*&lt;регион>.&lt;полное доменное имя>*|
|Хранилище ключей|&#42;.vault.*&lt;регион>.&lt;полное доменное имя>*<br>Групповой SSL-сертификат|хранилище ключей;|vault.*&lt;регион>.&lt;полное доменное имя>*|
|Внутреннее хранилище Key Vault|&#42;.adminvault.*&lt;регион>.&lt;полное доменное имя>*<br>Групповой SSL-сертификат|Внутреннее хранилище Key Vault|adminvault.*&lt;регион>.&lt;полное доменное имя>*|
|
<sup>1</sup> Сертификат ACS требует три шаблона SAN-сертификата на один сертификат. Не все общедоступные центры сертификации поддерживают применение нескольких шаблонов SAN-сертификатов на один сертификат. 

При развертывании Azure Stack в режиме Azure Active Directory необходимо запросить только сертификаты, перечисленные в предыдущей таблице. При развертывании Azure Stack в режиме AD FS также необходимо запросить сертификаты, описанные в следующей таблице:

|Папка развертывания|Требуемый субъект сертификата и альтернативное имя субъекта|Область (для каждого региона)|Пространство имен поддомена|
|-----|-----|-----|-----|
|ADFS|adfs.*&lt;регион>.&lt;полное доменное имя>*<br>(SSL-сертификат)|ADFS|*&lt;регион>.&lt;полное доменное имя>*|
|График|graph.*&lt;регион>.&lt;полное доменное имя>*<br>(SSL-сертификат)|График|*&lt;регион>.&lt;полное доменное имя>*|
|

> [!IMPORTANT]
> Все сертификаты, перечисленные в этом разделе, должны иметь один и тот же пароль. 

## <a name="optional-paas-certificates"></a>Необязательные сертификаты PaaS
Если вы планируете развертывать дополнительные службы PaaS Azure Stack (SQL, MySQL и служба приложений), после развертывания и настройки Azure Stack необходимо запросить дополнительные сертификаты для охвата конечных точек служб PaaS. 

> [!IMPORTANT]
> Сертификаты, используемые для поставщиков ресурсов службы приложений, SQL и MySQL, должны иметь один корневой центр, так как они используются для глобальных конечных точек Azure Stack. 

В следующей таблице описаны конечные точки и сертификаты, необходимые для адаптеров SQL и MySQL, а также для службы приложений. Вам не нужно копировать эти сертификаты в папку развертывания Azure Stack. Вместо этого следует предоставить эти сертификаты при установке дополнительных поставщиков ресурсов. 

|Область (для каждого региона)|Сертификат|Требуемый субъект сертификата и альтернативное имя субъекта|Пространство имен поддомена|
|-----|-----|-----|-----|
|SQL, MySQL|SQL и MySQL|&#42;.dbadapter.*&lt;регион>.&lt;полное доменное имя>*<br>Групповой SSL-сертификат|dbadapter.*&lt;регион>.&lt;полное_доменное_имя>*|
|Служба приложений|SSL-сертификат по умолчанию для веб-трафика|&#42;.appservice.*&lt;регион>.&lt;полное доменное имя>*<br>&#42;.scm.appservice.*&lt;регион>.&lt;полное доменное имя>*<br>&#42;.sso.appservice.*&lt;регион>.&lt;полное доменное имя>*<br>(Групповой SSL-сертификат для нескольких доменов<sup>1</sup>)|appservice.*&lt;регион>.&lt;полное доменное имя>*<br>scm.appservice.*&lt;регион>.&lt;полное доменное имя>*|
|Служба приложений|API|api.appservice.*&lt;регион>.&lt;полное доменное имя>*<br>(SSL-сертификат<sup>2</sup>)|appservice.*&lt;регион>.&lt;полное доменное имя>*<br>scm.appservice.*&lt;регион>.&lt;полное доменное имя>*|
|Служба приложений|FTP|ftp.appservice.*&lt;регион>.&lt;полное_доменное_имя>*<br>(SSL-сертификат<sup>2</sup>)|appservice.*&lt;регион>.&lt;полное доменное имя>*<br>scm.appservice.*&lt;регион>.&lt;полное доменное имя>*|
|Служба приложений|Единый вход|sso.appservice.*&lt;регион>.&lt;полное доменное имя>*<br>(SSL-сертификат<sup>2</sup>)|appservice.*&lt;регион>.&lt;полное доменное имя>*<br>scm.appservice.*&lt;регион>.&lt;полное доменное имя>*|

<sup>1</sup> Требует один сертификат с несколькими шаблонами SAN-сертификата. Не все общедоступные центры сертификации поддерживают применение нескольких шаблонов SAN-сертификата на один сертификат. 

<sup>2</sup> A &#42;групповой сертификат .appservice.*&lt;регион>.&lt;полное доменное имя>* нельзя использовать вместо этих трех сертификатов: api.appservice.*&lt;регион>.&lt;полное доменное имя>*, ftp.appservice.*&lt;регион>.&lt;полное доменное имя>* и sso.appservice.*&lt;регион>.&lt;полное доменное имя>*. Служба приложений явно требует использовать отдельные сертификаты для этих конечных точек. 

## <a name="learn-more"></a>Подробнее
Узнайте, как [создать сертификаты PKI для развертывания Azure Stack](azure-stack-get-pki-certs.md). 

## <a name="next-steps"></a>Дополнительная информация
[Интеграция удостоверений](azure-stack-integrate-identity.md)

