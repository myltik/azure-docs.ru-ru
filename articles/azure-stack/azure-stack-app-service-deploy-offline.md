---
title: "Развертывание службы приложений в автономной среде Azure Stack | Документация Майкрософт"
description: "Подробные инструкции по развертыванию службы приложений в автономной среде Azure Stack, защищенной с помощью службы федерации Active Directory (AD FS)."
services: azure-stack
documentationcenter: 
author: apwestgarth
manager: stefsch
editor: 
ms.assetid: 
ms.service: azure-stack
ms.workload: app-service
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/17/2017
ms.author: anwestg
ms.openlocfilehash: 8ee171708364c3e29476302bef04a715df650b9b
ms.sourcegitcommit: bd0d3ae20773fc87b19dd7f9542f3960211495f9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="add-an-app-service-resource-provider-to-a-disconnected-azure-stack-environment-secured-by-ad-fs"></a>Добавление поставщика ресурсов службы приложений в автономную среду Azure Stack, защищенную с помощью службы федерации Active Directory (AD FS)

Выполнив инструкции в этой статье, вы установите [поставщик ресурсов службы приложений](azure-stack-app-service-overview.md) в среду Azure Stack со следующими характеристиками:
- без подключения к Интернету;
- под защитой службы федерации Active Directory (AD FS).

Чтобы добавить поставщик ресурсов службы приложений в автономное развертывание Azure Stack, необходимо выполнить три задачи верхнего уровня.

1. Подготовьте все [предварительные условия](azure-stack-app-service-before-you-get-started.md) (например, приобретите сертификаты, получение которых может занять несколько дней).
2. [Скачайте файлы установки и вспомогательные файлы и извлеките их ](azure-stack-app-service-before-you-get-started.md) на компьютере, подключенном к Интернету.
3. Создайте автономный пакет установки.
4. Запустите файл установщика appservice.exe.

## <a name="create-an-offline-installation-package"></a>Создание автономного пакета установки

Чтобы развернуть службу приложений в автономной среде, необходимо сначала создать автономный пакет установки на компьютере, подключенном к Интернету.

1. Запустите установщик AppService.exe на компьютере, подключенном к Интернету.

2. Выберите **Дополнительно** > **Создать автономный пакет установки**.

    ![Установщик службы приложений](media/azure-stack-app-service-deploy-offline/image01.png)   

3. Установщик службы приложений создаст автономный пакет установки и отобразит путь к нему. Здесь можно щелкнуть **Открыть папку**, чтобы открыть этот путь в проводнике.

    ![Установщик службы приложений](media/azure-stack-app-service-deploy-offline/image02.png)   

4. Скопируйте установщик (файл AppService.exe) и автономный пакет установки на компьютер, где работает Azure Stack.

## <a name="complete-the-offline-installation-of-app-service-on-azure-stack"></a>Завершение автономной установки службы приложений в Azure Stack

1. На компьютере с Azure Stack без подключения к Интернету запустите файл appservice.exe от имени администратора azurestack\clouadmin.

2. Выберите **Дополнительно** > **Завершение автономной установки**.

    ![Установщик службы приложений](media/azure-stack-app-service-deploy-offline/image03.png)   

3. Перейдите к папке с ранее созданным автономным пакетом установки и нажмите кнопку **Далее**.

    ![Установщик службы приложений](media/azure-stack-app-service-deploy-offline/image04.png)   

4. Просмотрите и примите условия лицензионного соглашения об использовании программного обеспечения Майкрософт, а затем нажмите кнопку **Далее**.

5. Просмотрите и примите условия лицензии сторонних поставщиков и нажмите кнопку **Далее**.

6. Убедитесь, что сведения о конфигурации облачной службы приложений верны. Если во время развертывания комплекта разработки Azure Stack использовались значения по умолчанию, здесь также можно принять значения по умолчанию. Но если вы указали другие значения при развертывании Azure Stack, в этом окне необходимо изменить значения соответствующим образом. Например, если используется суффикс домена mycloud.com, для конечной точки нужно указать значение management.mycloud.com. Проверьте сведения и нажмите кнопку **Далее**.

    ![Установщик службы приложений](media/azure-stack-app-service-deploy/image02.png)

7. На следующей странице:
    1. Нажмите кнопку **Подключить** рядом с полем **Azure Stack Subscriptions** (Подписки Azure Stack).
        - Если вы используете Azure Active Directory (Azure AD), введите учетную запись администратора Azure AD и пароль, выбранный при развертывании Azure Stack. Щелкните **Войти**.
        - Если вы используете службы федерации Active Directory (AD FS), предоставьте соответствующую учетную запись администратора. Например, cloudadmin@azurestack.local. Введите пароль и нажмите кнопку **Войти**.
    2. В поле **Azure Stack Subscriptions** (Подписки Azure Stack) выберите подписку.
    3. В поле **Azure Stack Locations** (Расположения Azure Stack) выберите расположение, соответствующее региону, в который выполняется развертывание. Например, **локальный** регион при развертывании в пакете SDK для Azure Stack.
    4. Введите **имя группы ресурсов** для развертывания службы приложений. По умолчанию присваивается имя **APPSERVICE\<MOBILE\>**.
    5. Введите **имя учетной записи хранения**, которую служба приложений должна создать в процессе установки. По умолчанию присваивается имя **appsvclocalstor**.
    6. Щелкните **Далее**.

    ![Установщик службы приложений](media/azure-stack-app-service-deploy/image03.png)

8. Введите данные для общего файлового ресурса и нажмите кнопку **Далее**. Адрес общей папки должен содержать полное доменное имя файлового сервера, например \\\appservicefileserver.local.cloudapp.azurestack.external\websites, или IP-адрес, например \\\10.0.0.1\websites.

    ![Установщик службы приложений](media/azure-stack-app-service-deploy/image04.png)

9. На следующей странице:
    1. В поле **Identity Application ID** (Идентификатор приложения идентификации) введите GUID приложения, используемого для идентификации.
    2. В поле **Identity Application certificate file** (Файл сертификата приложения идентификации) введите расположение файла сертификата или перейдите к нему.
    3. В поле **Identity Application certificate password** (Пароль сертификата приложения идентификации) введите пароль для сертификата. Это пароль, который вы сохранили при выполнении скрипта для создания сертификатов.
    4. В поле **Azure Resource Manager root certificate file** (Файл корневого сертификата Azure Resource Manager) введите расположение файла сертификата или перейдите к нему.
    5. Щелкните **Далее**.

    ![Установщик службы приложений](media/azure-stack-app-service-deploy/image05.png)

10. В каждом из трех полей для файлов сертификатов щелкните **Обзор**, перейдите к нужному файлу сертификата и введите пароль. Это те сертификаты, которые вы создали на шаге [создания требуемых сертификатов](azure-stack-app-service-deploy.md). Когда вы введете всю информацию, нажмите кнопку **Далее**.

    | Box | Пример имени файла сертификата |
    | --- | --- |
    | **Файл SSL-сертификата по умолчанию для службы приложений** | \_.appservice.local.AzureStack.external.pfx |
    | **Файл SSL-сертификата API для службы приложений** | api.appservice.local.AzureStack.external.pfx |
    | **Файл SSL-сертификата издателя для службы приложений** | ftp.appservice.local.AzureStack.external.pfx |

    Если при создании сертификатов использовался другой суффикс домена, имена файлов сертификатов не будут содержать *local.AzureStack.external*. Вместо этого используйте данные для личного домена.

    ![Установщик службы приложений](media/azure-stack-app-service-deploy/image06.png)    

11. Введите сведения об SQL Server для экземпляра сервера, используемого для размещения баз данных поставщика ресурсов службы приложений, и нажмите кнопку **Далее**. Установщик проверит свойства подключения SQL.

    ![Установщик службы приложений](media/azure-stack-app-service-deploy/image07.png)    

12. Просмотрите параметры номера SKU и экземпляра роли. По умолчанию указываются минимальное количество экземпляров и минимальный номер SKU для каждой роли в развертывании ASDK. Ниже приведена сводка требований к ядрам и памяти, чтобы помочь вам спланировать развертывание. Выбрав необходимые значения, нажмите кнопку **Далее**.

     > [!NOTE]
     > При использовании рабочих развертываний следуйте инструкциям из руководства по [планированию емкости для ролей сервера службы приложений Azure в Azure Stack](azure-stack-app-service-capacity-planning.md).
     > 
     >

    | Роль | Минимальное количество экземпляров | Минимальный номер SKU | Примечания |
    | --- | --- | --- | --- |
    | Controller | 1 | Standard_A1 (1 ядро, 1792 МБ) | Управляет состоянием работоспособности облачной службы приложений и поддерживает его. |
    | управления | 1 | Standard_A2 (2 ядра, 3584 МБ) | Управляет конечными точками API и Azure Resource Manager для службы приложений и расширениями портала (порталы администратора, клиента и Функций), а также службой данных. Чтобы поддерживать отработку отказа, увеличьте число экземпляров до 2. |
    | Издатель | 1 | Standard_A1 (1 ядро, 1792 МБ) | Публикует содержимое через FTP и веб-развертывание. |
    | FrontEnd | 1 | Standard_A1 (1 ядро, 1792 МБ) | Направляет запросы в приложения службы приложений. |
    | Общая рабочая роль | 1 | Standard_A1 (1 ядро, 1792 МБ) | Размещает веб-приложения или приложения API и приложения Функций Azure. Могут потребоваться дополнительные экземпляры. Оператор может по своему усмотрению сформировать предложение и выбрать любой уровень SKU. Уровни должны иметь как минимум одно ядро. |

    ![Установщик службы приложений](media/azure-stack-app-service-deploy/image08.png)    

    > [!NOTE]
    > **Windows Server 2016 Core не является поддерживаемым образом платформы для использования со службой приложений Azure в Azure Stack**.

13. В поле **Select Platform Image** (Выбор образа платформы) выберите для развертывания образ виртуальной машины Windows Server 2016 из доступных в поставщике вычислительных ресурсов для облачной службы приложений. Щелкните **Далее**.

14. На следующей странице:
     1. Введите имя администратора и пароль для виртуальной машины рабочей роли.
     2. Введите имя администратора и пароль для виртуальной машины других ролей.
     3. Щелкните **Далее**.

    ![Установщик службы приложений](media/azure-stack-app-service-deploy/image09.png)    

15. На странице "Сводка" выполните следующие действия.
    1. Проверьте выбранные параметры. Чтобы внести изменения, используйте кнопки **Назад** для перехода на предыдущие страницы.
    2. Если настройки указаны правильно, установите флажок.
    3. Чтобы начать развертывание, нажмите кнопку **Далее**.

    ![Установщик службы приложений](media/azure-stack-app-service-deploy/image10.png)    

16. На следующей странице:
    1. Отслеживайте ход выполнения установки. Развертывание службы приложений в Azure Stack занимает около 60 минут, если сохранены значения по умолчанию.
    2. После успешного завершения установки щелкните **Выход**.

    ![Установщик службы приложений](media/azure-stack-app-service-deploy/image11.png)    


## <a name="validate-the-app-service-on-azure-stack-installation"></a>Проверка установки службы приложений в Azure Stack

1. На портале администрирования Azure Stack выберите **Администрирование > Служба приложений**.

2. В общих сведениях в разделе **Состояние** должно отображаться **Все роли готовы**.

    ![Управление службой приложений](media/azure-stack-app-service-deploy/image12.png)    


## <a name="test-drive-app-service-on-azure-stack"></a>Тестовая эксплуатация службы приложений в Azure Stack

После развертывания и регистрации поставщика ресурсов службы приложений проверьте его, чтобы убедиться в том, что пользователи могут развертывать веб-приложения и приложения API.

> [!NOTE]
> Необходимо создать предложение с пространством имен Microsoft.Web. Затем вам потребуется подписка клиента, основанная на этом предложении. Дополнительные сведения см. в статьях [Создание предложения в Azure Stack](azure-stack-create-offer.md) и [Создание плана в Azure Stack](azure-stack-create-plan.md).
>
Для создания приложений, использующих службу приложений в Azure Stack, *нужна* подписка клиента. Операции, которые администратор службы может выполнить на портале администратора, связаны с администрированием поставщика ресурсов службы приложений. Сюда относятся добавление емкости, настройка источников развертывания и добавление уровней рабочей роли и номеров SKU.
>
Начиная с третьей технической предварительной версии, для создания веб-приложения, приложения API и приложения Функций Azure необходимо использовать портал клиента и иметь подписку клиента.

1. На портале клиента Azure Stack щелкните **Создать** > **Интернет и мобильные устройства** > **Веб-приложение**.

2. В колонке **Веб-приложение** введите имя в поле **Веб-приложение**.

3. В разделе **Группа ресурсов** щелкните **Создать**. Введите имя в поле **Группа ресурсов**.

4. Щелкните **Расположение или план службы приложений** > **Создать**.

5. В колонке **План службы приложений** введите имя в поле **План службы приложений**.

6. Щелкните **Ценовая категория** > **Free-Shared** (Бесплатный — общий) или **Shared-Shared** (Общий — общий) > **Выбрать** > **ОК** > **Создать**.

7. Через минуту на панели инструментов появится плитка нового веб-приложения. Щелкните эту плитку.

8. В колонке **Веб-приложение** щелкните **Обзор**, чтобы просмотреть веб-сайт по умолчанию для этого приложения.

## <a name="deploy-a-wordpress-dnn-or-django-website-optional"></a>Развертывание веб-сайта WordPress, DNN или Django (необязательно)

1. На портале клиента Azure Stack щелкните **+**, перейдите к Azure Marketplace, разверните веб-сайт Django и дождитесь успешного завершения этой операции. Веб-платформа Django использует базу данных на основе файловой системы. Дополнительные поставщики ресурсов, такие как SQL или MySQL, не требуются.

2. Если вы уже развернули поставщик ресурсов MySQL, можно развернуть из Marketplace веб-сайт WordPress. Когда появится запрос на ввод параметров базы данных, введите имя пользователя в формате *User1@Server1*, указав имя пользователя и имя сервера по своему усмотрению.

3. Если вы уже развернули поставщик ресурсов SQL Server, можно развернуть из Marketplace веб-сайт DNN. Когда появится запрос на ввод параметров базы данных, выберите базу данных на компьютере, где работает подключенный к поставщику ресурсов SQL Server.

## <a name="next-steps"></a>Дальнейшие действия

Можно также попробовать другие [службы PaaS (платформа как услуга)](azure-stack-tools-paas-services.md).

- [Use SQL databases on Microsoft Azure Stack](azure-stack-sql-resource-provider-deploy.md) (Использование баз данных SQL в Microsoft Azure Stack)
- [Use MySQL databases on Microsoft Azure Stack](azure-stack-mysql-resource-provider-deploy.md) (Использование баз данных MySQL в Microsoft Azure Stack)

<!--Links-->
[Azure_Stack_App_Service_preview_installer]: http://go.microsoft.com/fwlink/?LinkID=717531
[App_Service_Deployment]: http://go.microsoft.com/fwlink/?LinkId=723982
[AppServiceHelperScripts]: http://go.microsoft.com/fwlink/?LinkId=733525
