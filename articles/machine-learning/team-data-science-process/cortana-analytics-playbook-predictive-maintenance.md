---
title: Сборник схем искусственного интеллекта Azure для решений прогнозного обслуживания | Документация Майкрософт
description: Подробное описание технологии обработки и анализа данных, лежащей в основе решений прогнозного обслуживания в нескольких различных отраслях.
services: cortana-analytics
documentationcenter: ''
author: fboylu
manager: jhubbard
editor: cgronlun
ms.assetid: 2e8b66db-91eb-432b-b305-6abccca25620
ms.service: cortana-analytics
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/01/2018
ms.author: fboylu
ms.openlocfilehash: ad06617fb8c14928dca7d9ce18ad86190e8255fe
ms.sourcegitcommit: c47ef7899572bf6441627f76eb4c4ac15e487aec
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
---
# <a name="azure-ai-playbook-for-predictive-maintenance-solutions"></a>Сборник схем искусственного интеллекта Azure для решений прогнозного обслуживания 
## <a name="executive-summary"></a>Аннотация
Прогнозируемое обслуживание — одно из наиболее востребованных сценариев использования прогнозной аналитики, которое предоставляет ряд бесспорных преимуществ, в том числе существенную экономию затрат. Этот сборник тренировочных заданий предназначен для предоставления справки по решениям прогнозируемого обслуживания с акцентом на основных вариантах использования.
Здесь представлены наиболее распространенные бизнес-сценарии прогнозируемого обслуживания, критерии определения того, можно ли устранить бизнес-проблему с помощью таких решений, данные, необходимые для решения этих бизнес-проблем, приемы прогнозного моделирования для создания решений с использованием таких данных и рекомендации с примерами архитектур решений.
Кроме этого, здесь описаны особенности разработанных прогнозных моделей, например проектирование признаков, разработка моделей и оценка производительности. В сущности, в этом сборнике тренировочных заданий собраны бизнес- и аналитические рекомендации, необходимые для успешной разработки и развертывания решений прогнозируемого обслуживания. Эти рекомендации позволяют создать исходное решение с помощью набора аналитических инструментов Cortana Intelligence Suite и Машинного обучения Azure, которое послужит в качестве отправной точки для долгосрочной стратегии прогнозируемого обслуживания. Документацию по Cortana Intelligence Suite и Машинному обучению Azure см. на страницах о [Cortana Analytics](http://www.microsoft.com/server-cloud/cortana-analytics-suite/overview.aspx) и [Машинном обучении Azure](https://azure.microsoft.com/services/machine-learning/).

> [!TIP]
> Техническое руководство по реализации этого шаблона решения см. в [техническом руководстве по шаблону решения Cortana Intelligence для прогнозируемого обслуживания](cortana-analytics-technical-guide-predictive-maintenance.md).
> Чтобы скачать схему, на которой предоставлен обзор архитектуры этого шаблона, перейдите к разделу [Архитектура шаблона решений Cortana Intelligence для прогнозируемого обслуживания в аэрокосмических и других компаниях](cortana-analytics-architecture-predictive-maintenance.md).
> 
> 

## <a name="playbook-overview-and-target-audience"></a>Обзор сборника тренировочных заданий и его целевая аудитория
Этот сборник тренировочных заданий составлен как для технических, так и для специалистов другого рода, обладающих различным опытом и заинтересованных в различных областях прогнозируемого обслуживания. Здесь представлены обобщенные аспекты различных типов решений прогнозируемого обслуживания, а также сведения об их реализации. Содержимое адаптировано для читателей, которые просто хотят ознакомиться с общей информацией о решениях и типами приложений, а также для тех, кто хочет применить эти решения и, следовательно, заинтересованы в технических подробностях.

Большая часть содержимого в этом сборнике тренировочных заданий не подразумевает наличия знаний и опыта в области обработки и анализа данных. Тем не менее для удачного применения рекомендаций по реализации в некоторых частях сборника потребуется знание основных понятий обработки и анализа данных. Чтобы наиболее эффективно использовать материалы из этих разделов, необходимо владеть навыками обработки и анализа данных на начальном уровне.

В первой части сборника тренировочных заданий представлены общие сведения о решениях прогнозируемого обслуживания, информация о том, как определить требования к решению прогнозируемого обслуживания, набор общих вариантов использования с подробными сведениями о бизнес-проблеме, данные, применяемые в этих вариантах использования, и бизнес-преимущества, связанные с реализацией этих решений прогнозируемого обслуживания. Чтобы ознакомиться с этими разделами, не требуются какие-либо технические знания в области прогнозной аналитики.

Во второй части сборника тренировочных заданий представлены приемы прогнозного моделирования для приложений прогнозируемого обслуживания, а также способы применения этих моделей на практике на примерах вариантов использования, описанных в первой части этого сборника. Для демонстрации описываются этапы предварительной обработки данных, в том числе рекомендации по созданию меток данных и проектированию признаков, выбору моделей, обучению, тестированию и оценке производительности. Эти разделы предназначены для технических специалистов.

## <a name="predictive-maintenance-in-iot"></a>Прогнозируемое обслуживание и IoT
Незапланированный простой оборудования может оказывать чрезвычайно пагубное влияние на предприятия. Важно поддерживать рабочее состояние оборудования, используемого в области, чтобы обеспечить максимально эффективное использование ресурсов и добиться максимальной производительности, сводя к минимуму время затратного незапланированного простоя. При современных бизнес-операциях непозволительно просто ожидать сбоя. Пытаясь поддерживать конкурентоспособность, компании ищут новые способы повышения эффективности использования активов, используя данные, собранные с различных каналов. Один из важных способов анализа такой информации — использование методов прогнозной аналитики, в которых для прогнозирования будущих результатов используются исторические закономерности. Одно из наиболее популярных решений в этой области называется прогнозируемым обслуживанием, которое в целом можно определить как, помимо прочего, прогнозирование возможных сбоев активов в ближайшем будущем, позволяющее выполнять мониторинг этих активов с целью упреждающего определения сбоев и принятия соответствующих мер. Эти решения обнаруживают закономерности сбоев, благодаря которым можно найти активы с наибольшей угрозой сбоя. Такое раннее определение проблем позволяет развернуть ограниченные ресурсы обслуживания с наименьшими затратами, а также повысить качество и эффективность выполнения процессов логистической цепочки.

С возникновением приложений «Интернета вещей» (IoT) прогнозируемое обслуживание начало привлекать повышенное внимание в отрасли по мере того, как технологии сбора и обработки данных стали достаточно усовершенствованными для создания, передачи, хранения и анализа данных всех видов в пакетах или в режиме реального времени. Такие технологии обеспечивают простоту разработки и развертывания комплексных решений благодаря решениям расширенной аналитики. Решения прогнозируемого обслуживания, в свою очередь, безусловно предоставляют больше преимуществ.

Спектр бизнес-проблем в области прогнозируемого обслуживания охватывает разные аспекты — от высоких эксплуатационных рисков из-за непредвиденных сбоев до ограниченной информации об основной причине проблем в сложных бизнес-средах. Большую часть этих проблем можно разделить на категории, исходя из ответов на следующие бизнес-вопросы:

* Какая вероятность сбоя оборудования в ближайшем будущем?
* Какой оставшийся период эксплуатации оборудования?
* Каковы причины сбоев и какие меры по обслуживанию следует принять для устранения этих проблем?

Используя прогнозируемое обслуживание, чтобы ответить на эти вопросы, предприятия могут:

* Уменьшить эксплуатационный риск и увеличить доходность активов, выявляя сбои до их возникновения.
* Уменьшить объем ненужных операций обслуживания на основе времени и контролировать затраты на обслуживание.
* Улучшить общее представление о торговой марке, избавиться от плохой репутации и связанным с ней падением продаж из-за ухода клиентов.
* Снизить затраты на инвентаризацию, уменьшая уровни запасов благодаря прогнозированию точки повторного заказа.
* Выявлять закономерности, связанные с различными проблемами обслуживания.

Решения прогнозируемого обслуживания могут предоставлять предприятиям информацию о ключевых показателях эффективности, например оценки работоспособности, позволяющие отслеживать состояние активов в режиме реального времени, оценку оставшегося времени существования активов, рекомендации по упреждающим мерам обслуживания и данные о предполагаемых датах заказов запчастей.

## <a name="qualification-criteria-for-predictive-maintenance"></a>Квалификационные критерии для прогнозируемого обслуживания
Важно подчеркнуть, что прогнозируемое обслуживание применимо не во всех вариантах использования и оно не позволяет эффективно решить все бизнес-проблемы. К важным квалификационным критериям относятся такие критерии, как возможность прогнозирования для проблемы, наличие точной последовательности действий, позволяющих избежать сбоев при их упреждающем обнаружении, и, что самое важное, доступность данных достаточно высокого качества, которые можно применить в варианте использования. В этом разделе рассматриваются требования к данным для создания успешного решения прогнозируемого обслуживания.

При создании моделей прогнозирования мы используем исторические данные для обучения модели, которая затем может распознать скрытые закономерности и выявить их в данных в будущем. Эти модели обучаются с использованием примеров, описываемых их возможностями и целью прогноза. Обученная модель должна создавать прогнозы для целевого показателя на основе признаков новых примеров. Очень важно, чтобы модель определяла связь между признаками и целевым показателем прогноза. Чтобы обучить эффективную модель машинного обучения, необходимы данные для обучения, которые включают признаки, позволяющие создать эффективный прогноз по целевому показателю. Это означает, что для получения точных прогнозов данные должны быть связаны с целью прогноза.

Например, если нужно спрогнозировать возникновение неполадок в колесах поезда, данные для обучения должны содержать признаки, касающиеся колес (например, данные телеметрии, отражающие состояние работоспособности колес, расстояние, загрузку вагона и т. д.). Тем не менее если нужно спрогнозировать возникновение неполадок в двигателе поезда, понадобится другой набор данных для обучения, который содержит признаки, касающиеся двигателя. Прежде чем создавать прогнозные модели, бизнес-эксперт должен усвоить требование к релевантности данных и предоставить знания в области, необходимые для выбора необходимых подмножеств данных для анализа.

При определении того, можно ли применить решение прогнозируемого обслуживания для устранения бизнес-проблемы, нужно полагаться на три важных источника данных.

1. Журнал сбоев. Как правило, в приложениях прогнозируемого обслуживания сбои происходят очень редко. Однако при создании прогнозных моделей, которые прогнозируют сбои, в процессе обучения алгоритму требуется изучить шаблон работы в обычном режиме, а также шаблон работы при сбое. Следовательно, очень важно, чтобы данные для обучения содержали достаточное количество примеров из обеих категорий для изучения этих двух различных шаблонов. Поэтому требуется, чтобы данные содержали достаточное количество событий сбоев. События сбоев можно найти в записях об обслуживании и журналах замены компонентов. Аномалии в данных для обучения можно также использовать как сбои, определяемые специалистами в области.
2. Журнал обслуживания или восстановления. Подробный журнал обслуживания актива, содержащий сведения о замененных компонентах, принятых мерах по упреждающему обслуживанию и т. д., представляет собой ценный источник данных для решений прогнозируемого обслуживания. Очень важно регистрировать эти события, так как они влияют на закономерности ухудшения работоспособности. Кроме того, отсутствие этих данных приводит к неверным результатам.
3. Состояние устройства. Чтобы спрогнозировать количество дней (часов, миль, операций и т. д.) работы устройства до сбоя, предполагается, что во время работы состояние его работоспособности со временем ухудшится. Таким образом, ожидается, что данные содержат изменяющиеся со временем признаки, которые отражают эту временную закономерность, и любые аномалии, которые ведут к ухудшению работоспособности. В приложениях IoT данные телеметрии с разных датчиков хорошо это иллюстрируют. Чтобы создать прогноз сбоя устройства в определенный промежуток времени, в идеале нужно, чтобы в данных наблюдалась тенденция ухудшения работоспособности за этот промежуток времени до фактического события сбоя.

Кроме того, требуются данные, которые непосредственно связаны с определенными рабочими состояниями целевого актива прогноза. Определение целевого показателя зависит от бизнес-потребностей и доступности данных. Например, прогноз неполадок колес поезда позволяет предсказать, возникнет ли неполадка с колесами или неполадка всего поезда. В первом случае прогноз направлен на конкретный компонент, а во втором — на неполадку всего поезда. Второй случай более общий, и для него требуется намного больше разрозненных элементов данных, чем для первого, что усложняет создание модели. И наоборот, невозможно определить возникновение неполадок колес на основе общих данных о состоянии поезда, так как они не содержат сведения на уровне компонента. В целом, разумнее предсказать конкретные события сбоев, а не более общие.

Как правило, в связи с данными журнала сбоев возникает один распространенный вопрос: сколько событий сбоев требуется для обучения модели и какое их количество считается достаточным? Невозможно точно ответить на этот вопрос, так как во многих сценариях прогнозной аналитики приемлемость обычно зависит от качества данных. Если набор данных не включает признаки, связанные с прогнозом сбоя, даже при наличии множества событий сбоев невозможно создать хорошую модель. Тем не менее, как правило, чем больше событий сбоев, тем эффективнее модель, а приблизительная оценка необходимого количества примеров сбоев зависит от конкретной ситуации и представляет собой зависимую от данных меру. Эта проблема рассматривается в разделе про обработку несбалансированных наборов данных, в котором предложены методы, позволяющие устранить проблему отсутствия достаточного количества сбоев.

## <a name="sample-use-cases"></a>Примеры вариантов использования
В этом разделе приведен ряд вариантов использования прогнозируемого обслуживания в некоторых отраслях, например изучение воздушно-космического пространства, техническое оборудование и транспорт. В каждом подразделе подробно рассмотрены варианты использования, собранные из этих областей, а также приведены бизнес-проблемы, данные, использующиеся для решения бизнес-проблем, и преимущества, предоставляемые решением прогнозируемого обслуживания.

### <a name="aerospace"></a>Изучение воздушно-космического пространства
#### <a name="use-case-1-flight-delay-and-cancellations"></a>Вариант использования 1. Задержка и отмена рейсов
##### <a name="business-problem-and-data-sources"></a>*Бизнес-проблемы и источники данных*
Одна из основных бизнес-проблем авиакомпаний — значительные затраты, связанные с задержкой авиарейсов из-за технических неполадок. Если технические неполадки исправить невозможно, авиарейсы могут даже отменить. Это влечет за собой большие затраты, так как задержки создают проблемы при планировании и выполнении операций, ухудшают репутацию, приводят к неудовлетворенности клиентов и многим другим проблемам. Авиакомпании особенно заинтересованы в упреждающем прогнозировании подобных сбоев, позволяющем сократить количество задержек и отмен рейсов. В этих случаях цель решения прогнозируемого обслуживания — прогнозирование вероятности задержки или отмены авиарейса на основе информации из соответствующих источников данных, таких как журнал обслуживания и сведения о маршруте полета. В этом варианте использования применяются два основных источника данных — маршрут полета и постраничный журнал. Маршрут полета содержит данные о маршруте полета, например дата и время отправления и прибытия, аэропорт отправления и прибытия и т. д. Постраничный журнал содержит ряд кодов ошибок и обслуживания, регистрируемых обслуживающим персоналом.

##### <a name="business-value-of-the-predictive-model"></a>*Ценность прогнозной модели для бизнеса*
Для прогнозирования типа технической неполадки, которая приведет к задержке или отмене рейса в течение 24 часов, создана прогнозная модель на основе доступных исторических данных с использованием алгоритма многоклассовой классификации. Этот прогноз позволяет принять необходимые меры при обслуживании самолета для снижения риска и предотвращения возможных задержек или отмен. С помощью веб-службы машинного обучения Azure прогнозные модели можно эффективно и легко интегрировать с существующими рабочими платформами авиакомпаний. 

#### <a name="use-case-2-aircraft-component-failure"></a>Вариант использования 2. Сбой элемента конструкции самолета
##### <a name="business-problem-and-data-sources"></a>*Бизнес-проблемы и источники данных*
Двигатель самолета — очень важный и дорогостоящий элемент оборудования. В отрасли авиаперевозок замена компонентов двигателя — самая распространенная задача обслуживания. Решения обслуживания для авиакомпаний требуют тщательного управления доступностью, доставкой и планированием запасов компонентов. Сбор аналитических данных о надежности компонента позволяет значительно сократить издержки инвестирования. Главный источник данных для этого варианта использования — данные телеметрии, собранные из нескольких датчиков в самолете. Эти данные предоставляют информацию о состоянии самолета. Кроме того, были использованы записи об обслуживании, позволяющие определить время возникновения неполадок компонента и его замены.

##### <a name="business-value-of-the-predictive-model"></a>Ценность прогнозной модели для бизнеса
Модель многоклассовой классификации создана для прогнозирования вероятности возникновения сбоя из-за определенного компонента в течение следующего месяца. Применив эти решения, авиакомпании могут снизить затраты на восстановление компонентов, повысить доступность запасов компонентов, снизить объем запасов соответствующего актива и улучшить планирование обслуживания.

### <a name="utilities"></a>Техническое оборудование
#### <a name="use-case-1-atm-cash-dispense-failure"></a>Вариант использования 1. Сбой в устройстве для выдачи наличных банкомата
##### <a name="business-problem-and-data-sources"></a>*Бизнес-проблемы и источники данных*
Руководители предприятий фондоемких отраслей промышленности часто заявляют, что основным эксплуатационным риском является неожиданный сбой активов. Например, самая распространенная и часто встречающаяся проблема в банковской сфере — сбой оборудования, например банкоматов. Из-за такой проблемы операторы устройств склоняются к выбору решений прогнозируемого обслуживания. В этом варианте использования проблема прогнозирования заключается в вычислении вероятности прерывания операции выдачи наличных из банкомата из-за сбоя в устройстве выдачи наличных, например через застревание бумаги или неполадку компонента. В этом случае применяются такие основные источники данных, как показания датчиков, предоставляющие информацию об измерениях при выдаче купюр, и записи об обслуживании, собираемые с течением времени. Данные датчиков включали показания датчиков на каждую выполненную операцию и выданную купюру. Показания датчиков предоставляли информацию об измерениях, например расстояние между купюрами, толщина, интервал выдачи купюр и т. д. Данные обслуживания включали в себя коды ошибок и сведения о восстановлении. Они использовались для определения случаев сбоев.

##### <a name="business-value-of-the-predictive-model"></a>*Ценность прогнозной модели для бизнеса*
Созданы две прогнозные модели для прогнозирования сбоев при операциях выдачи наличных и сбоев при выдаче отдельных купюр во время выполнения операции. Упреждающее прогнозирование сбоев операций позволяет выполнять обслуживание банкоматов заранее для предотвращения возникновения сбоев. Кроме того, если в случае прогнозирования сбоя при выдаче купюр операция может завершится сбоем из-за сбоя при выдаче купюр, рекомендуется остановить выполнение операции и предупредить клиента об этом, а не ожидать прибытия службы технической поддержки после возникновения сбоя, что может вызвать неудовлетворенность клиентов.

#### <a name="use-case-2-wind-turbine-failures"></a>Вариант использования 2. Сбои ветроэлектрической установки
##### <a name="business-problem-and-data-sources"></a>*Бизнес-проблемы и источники данных*
С повышением экологической грамотности ветроэлектрические установки стали одним из основных источников выработки энергии. Как правило, они стоят очень дорого. Один из ключевых компонентов ветроэлектрической установки — обратимый генератор с множеством датчиков, позволяющих отслеживать состояние и условия ветроэлектрической установки. Показания датчиков содержат важную информацию, которую можно использовать для создания прогнозной модели, позволяющей прогнозировать критически важные ключевые показатели эффективности, например среднее время до сбоя компонентов ветроэлектрической установки. Данные для этого варианта использования собраны с нескольких ветроэлектрических установок, расположенных на трех фермах. Около сотни датчиков каждой ветроэлектрической установки регистрировали показания каждые 10 секунд в течение года. Эти показания включают в себя измерения, например температуры, частоты оборотов генератора, мощности ветроэлектрической установки и обмотки генератора.

##### <a name="business-value-of-the-predictive-model"></a>*Ценность прогнозной модели для бизнеса*
Созданы прогнозные модели для оценки оставшегося периода эксплуатации генераторов и датчиков температуры. Прогнозирование вероятности сбоя позволяет специалисту технической поддержки не только выполнять режимы обслуживания по времени, но и уделить внимание сомнительным ветроэлектрическим установкам, которые, скорее всего, выйдут из строя.
Кроме того, прогнозные модели предоставляют информацию об уровне влияния различных факторов на вероятность сбоя, которая позволяет предприятию получить представление об основной причине проблемы.

#### <a name="use-case-3-circuit-breaker-failures"></a>Вариант использования 3. Сбои размыкателя цепи
##### <a name="business-problem-and-data-sources"></a>*Бизнес-проблемы и источники данных*
Операции, связанные с электричеством и газом, включая выработку, распространение и продажу электроэнергии, требуют значительного объема обслуживания для обеспечения постоянной работоспособности электросети и бытового энергоснабжения. Сбой таких операций недопустим, так как он влияет почти на все структурные единицы в области возникновения. Размыкатель цепи критически важен для выполнения таких операций. Это устройство обесточивает систему при возникновении проблем и коротких замыканий для предотвращения каких-либо повреждений в электросети. Бизнес-проблема в этом варианте использования — прогнозирование сбоев размыкателя цепи на основе информации журналов обслуживания, журналов команд и технических спецификаций.

В этом варианте использования применяются три основных источника данных — журналы обслуживания, включающие меры по исправлению, упреждающие меры и систематические меры, рабочие данные, включающие информацию об автоматических и ручных командах, отправленных размыкателю цепи, например операции открытия и закрытия, и данные технической спецификации о свойствах каждого размыкателя цепи, например год выпуска, расположение, модель и т. д.

##### <a name="business-value-of-the-predictive-model"></a>*Ценность прогнозной модели для бизнеса*
Решения прогнозируемого обслуживания позволяют снизить расходы на ремонт и увеличить жизненный цикл оборудования, например размыкателей цепи. Эти модели также позволяют повысить эффективность работы электросети, так как они отправляют упреждающие предупреждения, которые позволяют снизить количество непредвиденных сбоев, что, в свою очередь, ведет к уменьшению прерываний при предоставлении услуги.

#### <a name="use-case-4-elevator-door-failures"></a>Вариант использования 4. Сбои в работе дверей лифта
##### <a name="business-problem-and-data-sources"></a>*Бизнес-проблемы и источники данных*
Лифты большинства крупных компании по производству лифтов установлены по всему миру в огромном количестве. Чтобы получить конкурентное преимущество, эти компании уделяют основное внимание надежности, которая является важнейшим критерием для их клиентов. Используя потенциал "Интернета вещей", а именно подключив лифты к облаку и собирая данные с датчиков и систем, они могут преобразовать данные в ценную бизнес-аналитику, которая позволяет значительно повысить эффективность выполнения операций за счет предложения прогнозируемого и упреждающего обслуживания, которым не могут похвастаться их конкуренты. Бизнес-требование для этого случая заключается в предоставлении прогнозного приложения базы знаний, которое прогнозирует потенциальные причины возникновения неполадок в работе дверей. Данные, необходимые для этой реализации, состоят из трех частей, а именно статические признаки лифта (например, идентификаторы, частота выполнения технического обслуживания по контракту, тип сборки и т. д.), сведения об использовании (например, количество циклов работы дверей, среднее время закрытия и т. д.) и журнал сбоев (т. е. записи журналов о сбоях и их причинах).

Модель многоклассовой логистической регрессии разработана с использованием Машинного обучения Azure для устранения проблем с прогнозированием с использованием интегрированных статических признаков и данных об использовании в качестве признаков, а также причин создания записей журналов о сбоях в качестве меток классов. Эту прогнозную модель используют технические специалисты в соответствующей области с помощью приложений на мобильных устройствах, чтобы повысить эффективность работы. По прибытии на участок для ремонта лифта специалист может использовать это приложение, чтобы узнать возможные причины неполадки и получить рекомендации по ремонту дверей, тем самым сократив время ремонта.

### <a name="transportation-and-logistics"></a>Транспорт и логистика
#### <a name="use-case-1-brake-disc-failures"></a>Сценарий использования 1. Повреждение тормозных дисков
##### <a name="business-problem-and-data-sources"></a>*Бизнес-проблемы и источники данных*
Обычно порядок обслуживания автомобилей предусматривает восстановительный ремонт и плановое техническое обслуживание. Восстановительный ремонт предполагает обслуживание автомобиля при неполадке, что может создавать неудобства для водителя, ввиду возникновения непредвиденной поломки и траты времени на визит к механику. Для большинства автомобилей выполняется плановое техническое обслуживание, требующее планового осмотра, при котором фактическое состояние подсистем автомобилей не принимается во внимание. Ни один из этих подходов не позволяет полностью устранить проблемы. Конкретный сценарий использования, который мы рассмотрим, предполагает прогнозирование повреждений дисков на основе данных, собранных с использованием датчиков, установленных на покрышках автомобиля. Эти датчики отслеживают исторические закономерности движения и другие условия, под влиянием которых может оказаться автомобиль. Самые важные источники данных в этом сценарии — датчики, которые измеряют, например, ускорение, шаблоны торможения, расстояния, скорость и т. д. Эти сведения вместе с другой статической информацией, такой как данные о признаках автомобиля, способствуют созданию подходящего набора предикторов, которые можно использовать в прогнозной модели. Другой набор важных сведений представляет собой данные о сбоях из базы данных заказов на запасные детали (используется для хранения данных о датах заказов запасных частей и их количества при дилерском обслуживании автомобилей).

##### <a name="business-value-of-the-predictive-model"></a>*Ценность прогнозной модели для бизнеса*
Прогнозирование представляет существенную ценность для бизнеса. Система прогнозируемого обслуживания позволяет планировать встречи с дилерами на основе прогнозной модели. Эта модель может работать на основе сведений датчиков, которые предоставляют текущее состояние автомобиля, и журнала движения. Этот подход может уменьшить риск возникновения неожиданных неполадок, которые могут происходить и до предстоящего периодического обслуживания.
Он также позволяет сократить ненужное упреждающее техническое обслуживание. Водителя заранее уведомят о том, что через несколько недель может потребоваться замена частей, и он сообщит об этом дилеру. Дилер, в свою очередь, может заранее подготовить для водителя отдельный комплект для технического обслуживания.

#### <a name="use-case-2-subway-train-door-failures"></a>Сценарий использования 2. Неполадки в работе дверей вагонов метро
##### <a name="business-problem-and-data-sources"></a>*Бизнес-проблемы и источники данных*
Одна из основных причин задержек и проблем в работе метро — сбои в функционировании дверей вагонов. Прогнозирование вероятности сбоя в работе дверей и возможность спрогнозировать количество дней до следующего такого сбоя предоставляет очень важные преимущества. Это позволяет оптимизировать обслуживание дверей вагонов и сократить время простоя поездов.

#### <a name="data-sources"></a>Источники данных
Этот сценарий использования допускает три типа данных: 

* **данные о событиях вагона**, а именно записи журнала о событиях; 
* **данные об обслуживании** , такие как типы обслуживания, типы распоряжений о проведении работ, коды приоритета;  
* **записи о сбоях**.

##### <a name="business-value-of-the-predictive-model"></a>*Ценность прогнозной модели для бизнеса*
Для прогнозирования вероятности сбоев разработаны две модели прогнозирования, которые используют двоичную классификацию и регрессию для определения количества дней до сбоя. Как и в описанных случаях, модели предоставляют превосходные возможности для повышения качества обслуживания и увеличения уровня удовлетворенности клиентов за счет использования режимов регулярного обслуживания.

## <a name="data-preparation"></a>Подготовка данных
### <a name="data-sources"></a>Источники данных
Типичные элементы данных неполадок для прогнозирования обслуживания можно описать следующим образом.

* Журнал поломок. Журнал поломок автомобиля или его детали.
* Журнал обслуживания. Журнал ремонта автомобиля, например коды ошибок, предыдущие операции обслуживания или замены деталей.
* Условия эксплуатации автомобиля. Режим эксплуатации автомобиля, например данные, полученные от датчиков.
* Характеристики автомобиля. Такие характеристики автомобиля, как например, объем двигателя, марка и модель, местонахождение.
* Характеристики водителя. Такие характеристики водителя, как пол, прошлый опыт и т. п.

Журнал сбоев может храниться в журнале обслуживания, например в виде специальных кодов ошибок или дат заказов запасных частей, и это является распространенной практикой. В таких случаях данные о сбоях можно извлечь из журнала обслуживания. Кроме того, у различных бизнес-объектов может быть множество других источников данных, которые влияют на шаблоны сбоев, помимо описанных в этой статье. Их необходимо определять при создании прогнозной модели, проконсультировавшись с экспертами в соответствующей сфере.

Ниже приведены некоторые примеры элементов данных из сценариев использования.

Журнал сбоев: даты задержек рейсов, даты возникновения неполадок элементов конструкции самолетов и их типы, сбои при выдаче наличных из банкомата, сбои в работе дверей вагонов метро и лифтов, даты заказов на замену поврежденных дисков, даты сбоев в работе ветроэлектрической установки и сбои в выполнении команд размыкателя цепи.

Журнал обслуживания. Журналы ошибок рейсов, журналы ошибок операций банкоматов, записи об обслуживании вагонов, в том числе о типах обслуживания, краткое описание и т. д., а также записи об обслуживании размыкателей цепи.

Условия и использование машин. Маршруты полетов и время вылетов, данные, собранные с датчиков двигателей самолетов, показания датчиков операций банкоматов, данные о событиях вагонов, показания датчиков ветроэлектрических установок, лифтов и автомобилей.

Признаки машин. Технические характеристики размыкателей цепи, такие как уровень напряжения и географическое положение, или признаки автомобилей, такие как марка, модель, размер двигателя, типы покрышек, серия и т. д.

Ввиду перечисленных источников данных в сфере прогнозируемого обслуживания можно выделить два основных типа данных: временные и статические.
В журналах сбоев, условиях машин, журналах ремонта и журналах использования почти всегда указываются метки времени сбора каждого фрагмента данных. Признаки машин и операторов в целом носят статический характер, так как они обычно описывают технические характеристики машин или свойства оператора. Со временем эти признаки могут меняться, поэтому их необходимо использовать как источники данных с меткой времени.

### <a name="merging-data-sources"></a>Объединение источников данных
Прежде чем начать проектирование признаков или добавление меток, сначала необходимо подготовить данные, придав им формат, необходимый для создания признаков. Конечной целью является создание записи для каждой единицы измерения времени каждого актива, признаки и метки которого будут включены в алгоритм машинного обучения. Чтобы подготовить правильный окончательный набор данных, следует выполнить некоторые шаги предварительной обработки. На первом шаге необходимо разделить длительность сбора данных по единицам времени, чтобы каждая запись принадлежала отдельной единице измерения времени для актива. Сбор данных также можно разделить на другие единицы измерения, например действия. Тем не менее, чтобы упростить объяснение, далее мы используем единицы измерения времени.

В качестве единицы измерения можно задать секунды, минуты, часы, дни, месяцы, циклы, мили или операции, в зависимости от эффективности подготовки данных и изменений, выявленных в условиях актива, от одной единицы измерения времени до другой, или других факторов, соответствующих сфере. Другими словами, единицы измерения времени должны меняться, в отличие от частоты сбора данных, так как в большинстве случаев данные в промежутке от одной единицы до другой могут не меняться. Например, если сбор значений температуры выполнялся каждые 10 секунд, выбор 10 секунд в качестве единицы измерения времени для всего анализа увеличивает количество примеров, но не предоставляет дополнительных сведений. В качестве примера лучше всего использовать среднее значение — больше часа.

Ниже приведены примеры универсальных схем данных для возможных источников данных, которые описаны в предыдущем разделе.

Записи об обслуживании. Это записи о выполненных мерах по обслуживанию. Необработанные данные об обслуживании обычно поступают с идентификатором актива и меткой времени со сведениями о предпринятых мерах по обслуживанию на текущий момент. Если данные не обработаны, их необходимо преобразовать в столбцы по категориям, где каждая категория соответствует типу меры по обслуживанию. Базовая схема данных для записей об обслуживании будет включать в себя столбец идентификатора актива, времени и меры по обслуживанию.

Записи о сбоях. Это записи, которые являются целью прогнозирования. Мы можем называть их сбоями или причинами сбоев. Они могут представлять собой конкретные коды ошибок или события сбоев, определенные согласно конкретным условиям бизнеса. Иногда данные включают в себя несколько кодов ошибок, некоторые из которых соответствуют интересующим нас сбоям. Не все ошибки используются в прогнозировании. Такие ошибки обычно применяются для проектирования признаков, которые могут быть связаны со сбоями. Базовая схема данных для записей о сбоях включает в себя столбцы идентификатора актива, времени, сбоя или причины сбоя, если она известна.

Условия машин. Это данные мониторинга условий работы, осуществляемого предпочтительно в реальном времени. Например, при сбое в работе дверей отличными показателями условий их работы являются время закрытия и открытия. Базовая схема данных для условий машин включает в себя столбцы идентификатора актива, времени и значений условий.

Данные о машине и операторе. Эти данные можно объединить в одну схему, чтобы определить операторов активов, а также сам актив и свойства оператора. Например, автомобиль обычно принадлежит водителю, для которого характерны такие атрибуты, как возраст, опыт вождения и т. д. Если эти данные со временем меняются, следует включить в них столбец времени и рассматривать их в качестве переменных по времени данных для создания признаков. Базовая схема данных для условий машин включает в себя идентификатор и признаки актива, а также соответствующие данные оператора.

Чтобы сформировать окончательную таблицу, прежде чем создать метки и признаки, можно объединить левую часть таблицы условий машины с записями о сбоях по полям идентификатора актива и времени. Затем эту таблицу можно объединить с записями об обслуживании по полям идентификатора актива и времени и, наконец, с признаками оператора и машины по идентификатору актива. Если машина работает правильно, после первого объединения левой части в столбце сбоя остаются значения null. Это можно считать значением показателя при правильной работе. Этот столбец сбоя используется при создании меток для прогнозной модели.

### <a name="feature-engineering"></a>Проектирование признаков
Первый шаг в создании модели — проектирование признаков. Создание признаков, по сути, заключается в описании и абстрагировании состояния работоспособности машины в определенный момент времени с использованием исторических данных, собранных до текущего момента. В следующем разделе приводится обзор разных методов, которые можно использовать для прогнозируемого обслуживания, и описано то, как создавать метки согласно каждому из них. Выбор используемого метода во многом зависит от данных и бизнес-проблем. Тем не менее методы проектирования признаков ниже можно брать за основу для создания признаков. Далее мы рассмотрим признаки задержек, которые следует создать с использованием источников данных с метками времени, а также статические признаки, формируемые с использованием источников статических данных, и приведем примеры сценариев использования.

#### <a name="lag-features"></a>Признаки задержек
Как упоминалось ранее, исторические данные в прогнозируемом обслуживании обычно включают в себя метки времени, указывающие время сбора каждого фрагмента данных. Существует множество способов создания признаков на основе данных, поступающих с данными меток времени. В этом разделе мы рассмотрим некоторые из методов, которые используются для прогнозируемого обслуживания. Тем не менее не следует ограничиваться только этими методами. Так как проектирование признаков считают одной из самых творческих областей прогнозного моделирования, может существовать множество других способов их создания. Здесь мы предлагаем лишь некоторые общепринятые методы.

##### <a name="rolling-aggregates"></a>*Скользящее агрегирование*
Для каждой записи актива мы выберем скользящее окно размера W, что означает количество единиц измерения времени, для которого необходимо выполнять вычисления исторических агрегатов. Затем мы вычислим признаки для скользящих агрегатов, используя значение W для периодов до даты этой записи. Некоторые примеры скользящих агрегатов могут быть скользящими количествами или значениями, стандартными отклонениями, выбросами на основе стандартных отклонений, измерениями совокупных значений, а также максимальными и минимальными значениями для окна. Другой интересный метод предусматривает выявление изменений тенденций, пиков и уровней с помощью алгоритмов, которые позволяют обнаруживать аномалии в данных.

В качестве примера см. рис. 1, где представлены значения датчика, записанные для каждой единицы измерения времени актива. Они обозначены синими линиями. Здесь также показано вычисление признака скользящей средней W=3 для записей t<sub>1</sub> и t<sub>2</sub>, обозначенных оранжевой и зеленой фигурной скобкой соответственно.

![Рисунок 1. Признаки для скользящих агрегатов](./media/cortana-analytics-playbook-predictive-maintenance/rolling-aggregate-features.png)

Рисунок 1. Признаки для скользящих агрегатов

В качестве примеров для неполадок элементов конструкции самолетов мы использовали значения датчиков за прошлую неделю, последние три дня и последний день, чтобы создать признаки для скользящих средних, стандартного отклонения и суммы. Аналогичным образом для сбоев банкоматов использованы признаки необработанных значений датчиков и скользящих средних, медианы, диапазона, стандартных отклонений, множественных выбросов за пределы трех стандартных отклонений, а также самых высоких и низких совокупных значений.

Чтобы создать признаки для прогнозирования задержек рейсов, использовались счетчики кодов ошибок за прошлую неделю. Для создания признаков задержек при сбоях в работе дверей вагонов метро использовались счетчики событий за последний день, последние две недели и дисперсия счетчиков событий за последние 15 дней. Некоторые подсчеты использовались для обслуживания при связанных событиях.

Кроме того, если выбрать очень большое значение W (например, годы), то можно просмотреть весь журнал ресурса и, например, подсчитать все записи обслуживания, сбоев и т. д. вплоть до времени записи. Этот метод использовался для подсчета сбоев в работе размыкателя цепи за последние три года. Чтобы создать признак, учитывающий долгосрочное влияние обслуживания при сбоях в работе поездов, использовался подсчет всех мер по обслуживанию.

##### <a name="tumbling-aggregates"></a>*Агрегаты для переворачивающихся окон*
Для каждой записи с меткой ресурса мы выбираем окно размера "W-<sub>k</sub>", где k — число окон размера W, которые мы хотим создать для функций задержки. Можно выбрать большое значение k для записи шаблонов долгосрочного замедления или небольшое — для записи краткосрочных воздействий. Затем мы используем переворачивающиеся окна W-<sub>k</sub>, W-<sub>(k-1)</sub>, …, W-<sub>2</sub>, W-<sub>1</sub> для создания признаков для агрегатов в периоде между датой записи и значением времени (см. рис. 2). На рис. 2 не показаны некоторые скользящие окна на уровне записей для единицы измерения времени, но в их отношении действует тот же принцип, что показан на рис. 1, где t<sub>2</sub> используется, чтобы продемонстрировать скольжение.

![Рис. 2. Переворачивающееся статистические функции](./media/cortana-analytics-playbook-predictive-maintenance/tumbling-aggregate-features.png)

Рис. 2. Переворачивающееся статистические функции

Например, чтобы создать признаки задержек за каждый из трех прошедших месяцев для ветроэлектрической установки, применены значения W=1 и k=3 с использованием самого высокого и самого низкого значения выбросов.

#### <a name="static-features"></a>Статические признаки
У оборудования есть такие технические характеристики, как дата изготовления, номер модели, расположение и т. д. Несмотря на то, что для измерения признаков используют числовые показатели, статистические признаки в моделях, как правило, становятся категориальными переменными. Для примера использованы такие свойства размыкателя цепи, как показатели напряжения, тока и питания, а также типы трансформаторов, источники питания и т. д. В качестве статических признаков при повреждениях дисков мы использовали тип, допустив, что они могут быть литыми или стальными.

При создании признаков следует выполнить несколько важных шагов, к которым относятся обработка отсутствующих значений и нормализация. Существует множество методов заполнения отсутствующих значений и нормализации данных, которые не рассматриваются в этой статье. Тем не менее использование различных методов позволяет проверить, можно ли увеличить эффективность прогнозирования.

Если в качестве единицы измерения времени задан один день, окончательная таблица признаков, полученная после проектирования, (описанная в предыдущем разделе) должна соответствовать такому примеру схемы данных:

| Идентификатор актива | Время | Столбцы признаков | Метка |
| --- | --- | --- | --- |
| 1 |День 1 | | |
| 1 |День 2 | | |
| ... |... | | |
| 2 |День 1 | | |
| 2 |День 2 | | |
| ... |... | | |

## <a name="modeling-techniques"></a>Методы создания моделей
Прогнозируемое обслуживание — очень широкая сфера, которая зачастую касается бизнес-задач, для решения которых можно применять множество различных прогнозных моделей. В следующих разделах описаны основные методы создания моделей в отношении различных бизнес-вопросов, ответы на которые можно найти с помощью решений прогнозируемого обслуживания. Несмотря на сходства моделей, для них характерны разные способы проектирования меток, которые подробно описаны здесь. В качестве сопутствующего ресурса можно использовать шаблон прогнозируемого обслуживания, использованный в примерах экспериментов, проводимых в Машинном обучении Azure. Ссылки на онлайн-материалы для этого шаблона указаны в разделе ресурсов. Вы сможете увидеть, каким образом некоторые описанные выше методы проектирования признаков и методы создания моделей, которые описаны в следующих разделах, применяются для прогнозирования неполадок двигателей самолетов с помощью Машинного обучения Azure.

### <a name="binary-classification-for-predictive-maintenance"></a>Двоичная классификация для прогнозируемого обслуживания
Двоичная классификация для прогнозируемого обслуживания используется, чтобы спрогнозировать вероятность сбоя оборудования в определенный период времени в будущем. Период времени определяется на основе бизнес-правил и имеющихся данных. Некоторые распространенные периоды времени представляют собой минимальное время, необходимое чтобы приобрести запасные части для замены компонентов, которые могут повредиться, или время, необходимое для развертывания ресурсов для обслуживания, чтобы принять обычные меры по обслуживанию и устранить проблему, которая может возникнуть в этот период времени. Мы обозначим этот период в будущем X.

Чтобы использовать двоичную классификацию, нужно определить два типа примеров: положительный и отрицательный. Каждый пример — это запись, которая относится к единице измерения времени для актива и фактически описывает и абстрагирует условия его работы до этой единицы времени. Для этого применяется проектирование признаков с использованием уже описанных исторических и других источников данных. Положительные примеры прогнозируемого обслуживания в контексте двоичной классификации предполагают сбои (метка 1), а отрицательные примеры подразумевают обычную работу (метка 0), где метки носят категориальный характер. Целью является модель, которая определяет вероятность сбоя или нормальной работы для каждого нового примера в течение следующих X единиц измерения времени.

#### <a name="label-construction"></a>Проектирование меток
Чтобы создать прогнозную модель, которая позволит узнать, какова вероятность того, что в течение следующих X единиц измерения времени произойдет сбой, необходимо отобрать X записей до сбоя ресурса и отметить их как "вероятен сбой" (метка 1), а другие записи — как "обычная работа" (метка 0). В этом методе метки являются категориальными переменными (см. рис. 3).

![Рис. 3. Создание меток для двоичной классификации](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-binary-classification.png)

Рис. 3. Создание меток для двоичной классификации

Чтобы спрогнозировать задержки и отмены рейсов в течение 24 часов, в качестве значения X задан один день. Всем рейсам в период 24 часов до сбоя присвоена метка 1. Для сбоев выдачи наличных в банкоматах созданы две модели двоичной классификации: чтобы прогнозировать вероятность сбоев операций в течение 10 минут и вероятность сбоя при выдаче следующих 100 купюр. В первой модели всем операциям, осуществленным в течение 10 минут до ошибки, присвоена метка 1. Во второй модели всем купюрам, входящим в последние 100, после которых произошел сбой, присвоена метка 1. Задача в отношении сбоев размыкателя цепи заключается в прогнозировании вероятности того, что при выполнении следующей команды произойдет сбой, где X — будущая команда. Для сбоев в работе дверей вагонов метро модель двоичной классификации предусматривает прогнозирование сбоев в течение следующих 7 дней. При сбое в работе ветроэлектрической установки для X задано значение «3 месяца».

Регрессионный анализ также использовался в отношении сценариев сбоев в работе ветроэлектрической установки и дверей вагонов метро, чтобы спрогнозировать оставшийся период эксплуатации, используя те же данные, но иную стратегию создания меток, которая рассматривается в следующем разделе.

### <a name="regression-for-predictive-maintenance"></a>Регрессии для прогнозируемого обслуживания
Модели регрессии в прогнозируемом обслуживании используются для вычисления оставшегося периода эксплуатации ресурса, определяемого как время работы до следующего сбоя. Как и при двоичной классификации, каждый пример — это запись, относящаяся к единице измерения времени Y актива. Однако в контексте регрессии целью является модель, которая позволит вычислить оставшийся период эксплуатации в виде множества чисел, формирующих период времени, оставшегося до сбоя, в каждом новом примере. Мы назовем этот период времени множеством Y. Каждый пример также предусматривает оставшийся период эксплуатации, который можно вычислить, измерив оставшееся время, например до следующего сбоя.

#### <a name="label-construction"></a>Проектирование меток
Чтобы выяснить, каков оставшийся период эксплуатации оборудования,
и создать метки для модели регрессии, необходимо отобрать все записи до сбоя и присвоить им метки, подсчитав, сколько единиц времени остается до следующего сбоя. В этом методе метки являются непрерывными переменными (см. рис. 4).

![Рис. 4 Создание меток для регрессии](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-regression.png)

Рис. 4 Создание меток для регрессии

В отличие от двоичной классификации, при применении регрессии для моделирования нельзя использовать ресурсы без сбоев в данных, так как создание меток выполняется относительно точки сбоя и вычисление невозможно выполнить, не зная продолжительность работы до сбоя. В этом случае лучше всего применить другой статистический метод, который называется «анализ выживаемости».
Мы не будем подробно рассматривать этот метод в нашем сборнике тренировочных заданий из-за потенциальных сложностей, которые могут возникнуть при применении этого метода к примерам использования прогнозируемого обслуживания с меняющимися во времени данными и частыми интервалами измерений.

### <a name="multi-class-classification-for-predictive-maintenance"></a>Многоклассовая классификация для прогнозируемого обслуживания
Многоклассовую классификацию для прогнозируемого обслуживания можно использовать, чтобы спрогнозировать два будущих результата. Первый из них — диапазон времени до возникновения сбоя для каждого актива, который можно получить путем назначения активу одного из нескольких возможных периодов времени. Второй — вероятность сбоя в будущем по одной из нескольких основных причин. Располагая этими сведениями, обслуживающий персонал может принимать меры для устранения таких проблем заранее. Другой метод многоклассового моделирования ориентирован на определение наиболее вероятной основной причины сбоя. Это позволяет определить основные меры по обслуживанию, которые необходимо предпринять для устранения сбоя.
Благодаря наличию ранжированного списка основных причин и информации касательно соответствующих действий по восстановлению  
технические специалисты могут принимать изначальные меры по восстановлению после сбоя намного эффективнее.

#### <a name="label-construction"></a>Проектирование меток
Рассмотрим два вопроса, первый из которых — какова вероятность сбоя ресурса в течение следующих aZ единиц измерения времени, где а — это количество периодов, а второй — какова вероятность сбоя ресурса в течение следующих X единиц измерения времени из-за проблемы P<sub>i</sub>, где i — это количество возможных основных причин. Чтобы получить ответы на эти вопросы, создание меток выполняется следующим образом.

Что касается первого вопроса, для создания меток используются записи за aZ единиц измерения времени до сбоя актива. Они помечаются как фрагменты времени (3Z, 2Z, Z), а все остальные записи — как «обычная работа» (метка 0). В этом методе метка является категориальной переменной (см. рис. 5).

![Рис. 5. Создание меток для многоклассовой классификации, позволяющей спрогнозировать время сбоя](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-multiclass-classification-for-failure-time-prediction.png)

Рис. 5. Создание меток для многоклассовой классификации, позволяющей спрогнозировать время сбоя

Что касается второго вопроса, для создания меток используются записи за X единиц измерения времени до сбоя актива. Они помечаются как «вероятен сбой из-за проблемы P<sub>i</sub>» (метка P<sub>i</sub>), а все остальные записи помечаются как «обычная работа» (метка 0). В этом методе метки являются категориальными переменными (см. рис. 6).

![Рис. 6. Создание меток для многоклассовой классификации, позволяющей спрогнозировать основную причину](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-multiclass-classification-for-root-cause-prediction.png)

Рис. 6. Создание меток для многоклассовой классификации, позволяющей спрогнозировать основную причину

Эта модель позволяет определить вероятность сбоя из-за каждой проблемы P<sub>i</sub> и вероятность отсутствия сбоев. Эти вероятности можно упорядочить по величине, чтобы спрогнозировать наиболее вероятные будущие проблемы. Пример использования неполадки элемента конструкции самолета рассматривался как задача многоклассовой классификации. Это позволяет спрогнозировать вероятность сбоя из-за неполадок двух различных компонентов клапана давления в течение следующего месяца.

Для рекомендации мер по обслуживанию после сбоев для создания меток не требуется указывать периоды в будущем. Модель не прогнозирует возможность сбоя в будущем, она прогнозирует вероятную основную причину уже после возникновения сбоя. Сбои в функционировании дверей лифта подпадают под третий пример, цель которого — спрогнозировать причину сбоя на основе исторических данных об условиях работы. Затем эта модель используется для прогнозирования наиболее вероятных основных причин после возникновения сбоя. Главное преимущество этой модели заключается в том, что с ее помощью неопытные технические специалисты могут с легкостью диагностировать и устранять проблемы, для решения которых в противном случае потребовался бы многолетний опыт.

## <a name="training-validation-and-testing-methods-in-predictive-maintenance"></a>Методы обучения, проверки и тестирования в прогнозируемом обслуживании
При типичных процедурах обучения и тестирования в прогнозируемом обслуживании аналогично другим решениям, использующим данные меток времени, необходимо учитывать переменные по времени аспекты, чтобы лучше обобщить неучитываемые последующие данные.

### <a name="cross-validation"></a>Перекрестная проверка
Множество алгоритмов машинного обучения зависят от количества гиперпараметров, которые могут существенно повлиять на эффективность модели. Оптимальные значения этих гиперпараметров не вычисляются автоматически во время обучения модели. Их должен указать специалист по обработке данных. Существует несколько способов определения оптимальных значений гиперпараметров. Один из наиболее распространенных способов — это «перекрестная проверка k сверток», которая разбивает примеры на k сверток случайным образом. Для каждого набора значений гиперпараметров алгоритм обучения выполняется k раз. При каждой итерации примеры в текущей свертке используются в качестве набора для проверки, а остальные примеры — в качестве набора для обучения. Алгоритм предусматривает обучение на основе примеров обучения, а метрики эффективности вычисляются на основе примеров проверки. В конце этого цикла для каждого набора значений гиперпараметров вычисляются средние значения метрики эффективности k. Затем выбираются значения гиперпараметров с лучшим средним значением эффективности.

Как упоминалось ранее, для решений прогнозируемого обслуживания данные записываются как временные ряды событий, поступающие из нескольких источников данных. Эти записи можно упорядочить по времени создания метки для записи или примера. Если разделить набор данных на наборы для обучения и проверки случайным образом, время некоторых примеров обучения будет позднее времени некоторых примеров проверки. Таким образом, будущая эффективность значений гиперпараметров оценивается на основе данных, полученных до обучения модели. Такая оценка может быть слишком оптимистичной, особенно в том случае, если временные ряды нестабильны и меняют свое поведение с течением времени. В результате выбранные значения гиперпараметров могут быть неоптимальными.

Лучший метод определения оптимальных значений гиперпараметров — разделить примеры на наборы для обучения и проверки по принципу зависимости от времени, чтобы время всех примеров проверки было позднее времени всех примеров обучения. Затем для каждого набора значений гиперпараметров необходимо выполнить обучение алгоритма по набору для обучения, измерить эффективность модели по тому же набору для проверки и выбрать значения гиперпараметров, которые демонстрируют лучшую эффективность. Если данные временных рядов нестабильны и меняются с течением времени, то значения гиперпараметров, выбранные по методу разделения на наборы для обучения и проверки, обеспечат лучшую будущую эффективность модели, чем значения, выбранные случайным образом по методу перекрестной проверки.

Окончательная модель создается путем обучения алгоритма обучения на основе всех данных с использованием наилучших значений гиперпараметров, определенных по методу разделения на наборы для обучения и проверки или перекрестной проверки.

### <a name="testing-for-model-performance"></a>Тестирование эффективности модели
После создания модели необходимо оценить ее будущую эффективность на основе новых данных. Самый простой показатель оценки — эффективность модели на основе данных для обучения. Но эта оценка слишком оптимистичная, так как модель соответствует данным, которые использовались для оценки эффективности. Лучший показатель оценки — метрика эффективности значений гиперпараметров, вычисленная на основе набора для проверки, или среднее значение метрики эффективности, вычисленное по методу перекрестной проверки. Но по указанным ранее причинам эти оценки по-прежнему слишком оптимистичные. Для измерения эффективности модели нужны более реалистичные подходы.

Один из подходов — случайным образом разделить данные на наборы для обучения, проверки и тестирования. Наборы для обучения и проверки используются для выбора значений гиперпараметров и обучения модели. Эффективность модели измеряется по последнему набору для тестирования.

Другой подход (относящиеся к прогнозируемому обслуживанию) — разделить примеры на наборы для обучения, проверки и тестирования по принципу зависимости от времени, чтобы время всех примеров тестирования было позднее времени всех примеров обучения и проверки. После разделения создание модели и измерение ее эффективности выполняется так же, как описано выше.

Если временные ряды стабильны и их легко спрогнозировать, оба подхода дадут аналогичные оценки будущей эффективности. Но если временные ряды нестабильны или их сложно спрогнозировать, с помощью второго подхода можно получить более реалистичную оценку будущей эффективности в отличие от первого подхода.

### <a name="time-dependent-split"></a>Разделение по принципу зависимости от времени
В этом разделе подробнее рассматривается способ реализации разделения по принципу зависимости от времени. Здесь описывается разделение на наборы для обучения и проверки по принципу зависимости от времени. Для обоих наборов разделения применяется один и тот же принцип.

Предположим, что у нас есть поток событий с метками времени, например измерения с различных датчиков. Признаки примеров обучения и тестирования, а также их метки определяются по временным рамкам, включающим несколько событий.
Например, как описано в разделах «Проектирование признаков» и «Методы создания моделей», для двоичной классификации признаки создаются на основе прошлых событий, а метки — на основе будущих событий в течение X единиц измерения времени в будущем. Таким образом, период времени создания меток примера наступает позже, чем период времени создания его признаков. Для разделения по принципу зависимости от времени нужно выбрать момент времени, по которому выполняется обучение модели с использованием настраиваемых гиперпараметров и исторических данных вплоть до этого момента. Во избежание попадания будущих меток, которые находятся за пределами точки отсечения для обучения, в данные для обучения, нужно выбрать последний период времени, чтобы пометить примеры обучения как X единицы до точки отсечения. На рис. 7 каждая закрашенная точка представляет строку в наборе данных конечных признаков, для которой признаки и метки вычисляются в соответствии с описанным выше методом. С учетом этого на рисунке показаны записи, которые нужно поместить в наборы для обучения и тестирования при реализации разделения по принципу зависимости от времени для X=2 и W=3:

![Рис. 7. Разделение по принципу зависимости от времени для двоичной классификации](./media/cortana-analytics-playbook-predictive-maintenance/time-dependent-split-for-binary-classification.png)

Рис. 7. Разделение по принципу зависимости от времени для двоичной классификации

Зеленые квадраты представляют записи, относящиеся к единицам измерения времени, которые можно использовать для обучения. Как упоминалось ранее, для создания каждого примера обучения в таблице конечных признаков необходимо просмотреть 3 последних периода для создания признаков и 2 будущих периода для создания меток до точки отсечения для обучения. Если какая-либо часть из 2 будущих периодов для примера находится за пределами точки отсечения для обучения, этот пример не используется в наборе для обучения, так как предполагается, что период после точки отсечения находится за пределами видимости. Из-за этого ограничения черные квадраты, которые представляют записи окончательного набора данных с меткой, нельзя использовать в наборе данных для обучения. Эти записи не будут использоваться в данных тестирования, так как они созданы до точки отсечения для обучения и их периоды времени создания меток частично зависят от периода времени обучения. Это недопустимо, так как требуется полностью разделить периоды времени создания меток для обучения и тестирования, чтобы предотвратить возможность учета ненужной информации о создании меток.

Этот метод можно использовать для перекрытия в данных, которые используются для создания признаков между примерами для обучения и тестирования, близкими к точке отсечения для обучения. В зависимости от доступности данных можно применить более жесткое разделение без использования примеров в наборе для тестирования, находящихся в пределах W единиц измерения времени в отношении точки отсечения для обучения.

В результате проделанной работы установлено, что проблема попадания лишних данных серьезно сказывается на эффективности моделей регрессии, которые используются для прогнозирования оставшегося периода эксплуатации, а использование произвольного разделения приводит к существенному переобучению. Аналогичным образом, для задач регрессии необходимо выполнить разделение таким образом, чтобы записи активов, сбои которых произошли до точки отсечения для обучения, использовались для набора для обучения, а активы, сбои которых произошли после этой точки, — для набора для тестирования.

Чтобы разделить данные на наборы для обучения и тестирования, в качестве общего метода также рекомендуется использовать разделение по идентификатору актива. Таким образом, активы, которые использовались для обучения, не будут использоваться для тестирования, так как идея тестирования заключается в том, чтобы убедиться, что при использовании нового актива для прогнозирования модель предоставляет реалистичные результаты.

### <a name="handling-imbalanced-data"></a>Обработка несбалансированных данных
При решении задач классификации данные считаются несбалансированными, если примеров одного класса больше, чем примеров других классов. В идеале, чтобы иметь возможность провести различие между разными классами, требуется достаточное количество представителей каждого класса в данных для обучения. Если один из классов составляет менее 10 % данных, эти данные можно считать несбалансированными, а класс с недостаточным количеством данных будет называться классом меньшинства. Во многих случаях обнаруживаются несбалансированные наборы данных, в которых один класс представлен слишком малым количеством данных по сравнению с другими. К примеру, класс может составлять всего 0,001 % от всех точек данных. Несбалансированность класса — это проблема многих сфер, включая обнаружение мошеннических действий, вторжений в сеть и прогнозируемое обслуживание, в которых обычно редко происходят сбои в течение периода эксплуатации активов, которые составляют примеры классов меньшинства.

В случае несбалансированности класса эффективность большинства стандартных алгоритмов обучения скомпрометирована, так как их задача — свести к минимуму общую частоту ошибок. Например, в наборе данных, где 99 % примеров класса являются отрицательными и 1 % — положительными, можно получить 99 % точности, просто пометив все экземпляры как отрицательные. Несмотря на то, что степень точности очень высока, все положительные примеры неправильно классифицированы, а сам алгоритм — непригоден. Следовательно, для обучения в условиях несбалансированности классов использования традиционных метрик оценки, таких как общая точность частоты ошибок, недостаточно. При наличии несбалансированных наборов данных для оценки используются другие метрики, такие как точность, полнота, показатель F1 и ROC-кривые со скорректированной стоимостью. О них пойдет речь в разделе "Метрики оценки".

Тем не менее существует и ряд методов, с помощью которых можно устранить проблему несбалансированности класса. Два основных из них — выборка и обучение с учетом затрат.

#### <a name="sampling-methods"></a>Методы выборки
Суть методов выборки, которые применяются для обучения в условиях несбалансированности классов, заключается в изменении набора данных с помощью некоторых механизмов, позволяющих обеспечить сбалансированность. Несмотря на большое количество методов выборки, самых эффективных всего два: случайная избыточная выборка и случайная неполная выборка.

Проще говоря, при случайной избыточной выборке из класса меньшинства случайным образом выбираются примеры, которые затем реплицируются и добавляются в набор данных для обучения. Это позволяет увеличить общее количество примеров в классе меньшинства и в конечном счете уравновешивает количество примеров в разных классах. Один из рисков избыточной выборки заключается в том, что из-за наличия нескольких экземпляров некоторых примеров охват классификатора становится слишком узким, что приводит к переобучению.
В результате мы получаем высокую точность обучения, однако эффективность измерения неучитываемых данных тестирования может быть существенно снижена. И наоборот, при случайной неполной выборке из класса большинства случайным образом выбираются примеры, которые затем удаляются из набора данных для обучения. Однако из-за удаления примеров из классов большинства классификатор может пропустить важные аспекты, относящиеся к этому классу. Еще одним эффективным методом является смешанная выборка. При такой выборке в одно и то же время к классу меньшинства применяется избыточная выборка, а к классу большинства — неполная. Для решения задачи несбалансированности классов доступно множество других более сложных методов выборки. Исследование эффективных методов выборки пользуется большой популярностью. Различные организации и исследователи постоянно уделяют внимание этой области и вносят вклад в ее развитие. Задача определения наиболее эффективных методов обычно возлагается на специалистов по обработке данных, которые проводят разного рода анализы и эксперименты для ее решения. Необходимый метод во многом зависит от свойств данных. Кроме того, очень важно убедиться в том, что методы выборки применяются только к набору для обучения и не к набору для тестирования.

#### <a name="cost-sensitive-learning"></a>Обучение с учетом затрат
В прогнозируемом обслуживании сбоям, которые составляют класс меньшинства, уделяется намного больше внимания, чем примерам обычной работы. Поэтому основное внимание уделяется эффективности алгоритма сбоев. Это часто называют неравномерной потерей или асимметричными расходами, связанными с неправильно классифицированными элементами различных классов. В этом случае неправильное прогнозирование положительного примера как отрицательного может повлечь большие затраты, чем в обратном случае. Необходимый классификатор должен обеспечивать высокую точность прогнозирования в отношении класса меньшинства, не оказывая существенного влияния на точность прогнозирования для класса большинства.

Этого можно добиться несколькими способами. Задачу неравномерных потерь можно эффективно решить, назначив высокую стоимость неправильной классификации класса меньшинства и пытаясь уменьшить общую стоимость. Эта идея используется в некоторых алгоритмах машинного обучения, таких как SVM (метод опорных векторов), где стоимость положительных и отрицательных примеров может быть объединена во время обучения. Аналогичным образом, при наличии несбалансированности данных используются методы повышения эффективности, например алгоритмы увеличивающегося дерева принятия решений. Как правило, они демонстрируют хорошую эффективность в таких случаях.

## <a name="evaluation-metrics"></a>Метрики оценки
Как упоминалось ранее, несбалансированность класса приводит к низкой эффектности, так как алгоритмы, как правило, лучше классифицируют примеры класса большинства в ущерб классу меньшинства. Это происходит из-за того, что проблему неправильной классификации намного проще решить, если класс большинства помечен правильно. Как результат, степень полноты снижается, что становится большой проблемой, так как стоимость ложных предупреждений очень высока для бизнеса. Точность является наиболее распространенной метрикой, которая используется для описания эффективности классификатора. Однако, как описано выше, эта метрика неэффективна и не отображает реальную эффективность классификатора, ввиду высокой чувствительности к распределению данных. Вместо этого для оценки проблем обучения в условиях несбалансированности используются другие метрики. В таких случаях при оценке эффективности модели прогнозируемого обслуживания в качестве исходных метрик следует использовать точность, полноту и показатели F1. В прогнозируемом обслуживании степень полноты указывает количество сбоев в наборе для тестирования, которые модель определила правильно. Высокая степень полноты означает, что модель правильно отслеживает сбои. Метрика точности отображает количество ложных сигналов. Низкая степень точности соответствует большему количеству ложных сигналов. Показатель F1 указывает степень точности и полноты (наилучшее значение — 1, а наихудшее — 0).

Кроме того, в двоичной классификации при оценке производительности полезные сведения предоставляют таблицы децилей и диаграммы точности прогнозов. Они сосредоточены только на положительном классе (сбоях) и предоставляют более комплексную картину эффективности алгоритма, чем неподвижная точка режима работы на кривой ROC (соотношение правильного и ложного обнаружения сигналов).
Таблицы децилей создаются путем упорядочивания примеров тестирования в соответствии с прогнозируемой вероятностью сбоев, которая вычисляется с помощью модели до определения порогового значения перед окончательной меткой. Затем упорядоченные примеры группируются на децили (т. е. 10 % примеров с наибольшей вероятностью, затем 20 %, 30 % и т. д). Оценить изменение эффективности алгоритма в каждом дециле можно путем вычисления соотношения истинно положительных результатов каждого дециля и случайной базовой оценки (0,1, 0,2...). Диаграммы точности прогнозов используются для графического отображения децильных значений. На диаграмме отображается соотношение истинно положительных результатов децилей и случайных истинно положительных результатов для всех децилей. Как правило, для результатов учитываются первые децили, так как они показывают наибольшее увеличение. При использовании для прогнозируемого обслуживания первые децили также можно рассматривать в качестве представителей «в зоне риска».

## <a name="sample-solution-architecture"></a>Архитектура примера решения
Развертывая решение прогнозируемого обслуживания, мы хотим получить комплексное решение, которое обеспечивает непрерывный цикл приема данных, хранения данных для обучения модели, создания признаков, прогнозирования и визуализации результатов, а также механизм создания сигналов, такой как панель мониторинга активов. Нам нужен конвейер данных, который автоматически и непрерывно предоставляет данные о будущих событиях. На рис. 8 ниже изображен пример архитектуры прогнозируемого обслуживания для такого конвейера данных IoT. В архитектуре данные телеметрии в реальном времени помещаются в концентратор событий, где хранятся потоковые данные. Эти данные используются решением Stream Analytics для обработки данных в режиме реального времени, например создания признаков. Затем признаки используются для вызова веб-службы прогнозной модели, а результаты отображаются на панели мониторинга. В то же время полученные данные хранятся в базе данных исторических данных и объединяются с внешними источниками данных, такими как локальные базы данных, с целью создания примеров обучения для моделирования.
Для пакетной оценки примеров и хранения результатов, которые можно повторно использовать для предоставления отчетов о прогнозировании на панели мониторинга, можно использовать одни и те же хранилища данных.

![Рис. 8. Архитектура примера решения для прогнозируемого обслуживания](./media/cortana-analytics-playbook-predictive-maintenance/example-solution-architecture-for-predictive-maintenance.png)

Рис. 8. Архитектура примера решения для прогнозируемого обслуживания

Дополнительные сведения о каждом из компонентов архитектуры см. в документации [Azure](https://azure.microsoft.com/).

