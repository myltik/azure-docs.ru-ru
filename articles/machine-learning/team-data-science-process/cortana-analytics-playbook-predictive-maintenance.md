---
title: Руководство по искусственному интеллекту Azure для решений прогнозного обслуживания | Документация Майкрософт
description: Подробное описание технологии обработки и анализа данных, лежащей в основе решений прогнозного обслуживания в нескольких различных отраслях.
services: machine-learning
documentationcenter: ''
author: fboylu
manager: jhubbard
editor: cgronlun
ms.assetid: 2e8b66db-91eb-432b-b305-6abccca25620
ms.service: machine-learning
ms.component: team-data-science-process
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/11/2018
ms.author: fboylu
ms.openlocfilehash: 581e9d586f007fe0cd28d60b5558594777656ca8
ms.sourcegitcommit: e14229bb94d61172046335972cfb1a708c8a97a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2018
---
# <a name="azure-ai-guide-for-predictive-maintenance-solutions"></a>Руководство по искусственному интеллекту Azure для решений прогнозного обслуживания

## <a name="summary"></a>Сводка

Прогнозное обслуживание (**PdM**) — это популярное применение прогнозной аналитики, которое может помочь предприятиям в нескольких отраслях добиться эффективного использования ресурсов и экономии эксплуатационных расходов. В этом руководстве собраны бизнес-рекомендации и аналитические рекомендации, а также рекомендации по успешной разработке и развертыванию решений PdM с использованием технологии [платформы искусственного интеллекта Microsoft Azure](https://azure.microsoft.com/overview/ai-platform).

Для начинающих в этом руководстве представлены отраслевые бизнес-сценарии и процесс определения этих сценариев для PdM, а также требования к данным и методы моделирования для создания решений PdM. Основная часть руководства посвящена процессу обработки и анализа данных, включая этапы их подготовки, разработке функций, созданию моделей и их вводу в эксплуатацию. В дополнение к этим ключевым понятиям в этом руководстве представлен набор шаблонов решений, помогающих ускорить разработку приложений PdM. В руководстве также указаны полезные учебные ресурсы с практическими курсами, чтобы узнать больше об ИИ для обработки и анализа данных. 

### <a name="data-science-guide-overview-and-target-audience"></a>Руководство по обработке и анализу данных и его целевая аудитория
В первой половине этого руководства описываются типичные бизнес-проблемы, преимущества реализации PdM для их решения, а также перечислены некоторые распространенные случаи использования. Это содержимое будет полезно для лиц, принимающих коммерческие решения (BDMs). Во второй части объясняется обработка и анализ данных за PdM и предоставляется список решений PdM, построенных с использованием принципов, изложенных в этом руководстве. В нем также предоставлены схемы обучения и указатели на учебные материалы. Это содержимое будет полезным для лиц, принимающих технические решения (TDMs).

| Начните с этого... | Если вы... |
|:---------------|:---------------|
| [Бизнес-модель для прогнозного обслуживания](#Business-case-for-predictive-maintenance) |лицо, принимающее коммерческие решения (BDM), стремящееся сократить простои и эксплуатационные расходы, а также улучшить эффективность использования оборудования. |
| [Обработка и анализ данных для прогнозного обслуживания](#Data-Science-for-predictive-maintenance) |лицо, принимающее технические решения (TDM), которое рассматривает технологии PdM, чтобы понять уникальные требования к обработке данных и к ИИ для прогнозного обслуживания. |
| [Шаблоны решений для прогнозного обслуживания](#Solution-templates-for-predictive-maintenance)|разработчик программного обеспечения или разработчик ИИ, стремящийся быстро настроить демонстрационную или экспериментальную среду. |
| [Сборник тренировочных заданий для прогнозного обслуживания](#Training-resources-for-predictive-maintenance) | выполняете одну или все вышеперечисленные роли и хотите изучить основополагающие концепции, инструменты и техники обработки и анализа данных.

### <a name="prerequisite-knowledge"></a>Предварительно требуемый набор знаний
Для содержимого BDM не требуются какие-либо предварительные знания в области обработки и анализа данных. Для содержимого TDM полезно базовое представление о статистике, а аткже об обработке и анализе данных. Рекомендуется знание служб данных и ИИ Azure Data, Python, R, XML и JSON. Методы ИИ реализованы в пакетах Python и R. Шаблоны решений реализованы с использованием служб Azure, инструментов разработки и пакетов SDK.

## <a name="business-case-for-predictive-maintenance"></a>Бизнес-модель для прогнозного обслуживания

Предприятиям требуется, чтобы важное оборудование работало и использовалось максимально эффективно для обеспечения окупаемости капиталовложений. Эти ресурсы могут варьироваться от авиадвигателей, турбин, лифтов или промышленных систем охлаждения, которые стоят миллионы, вплоть до бытовых приборов, таких как копировальные аппараты, кофеварки или кулеры.
- По умолчанию большинство предприятий полагаются на _восстановительное обслуживание_, где детали заменяются по мере выхода из строя. Восстановительное обслуживание гарантирует, что детали полностью изнашиваются (истекает срок службы компонентов), но при этом бизнес несет убытки от простоя, трудовых затрат и незапланированного технического обслуживания (часы работы или неудобные расположения).
- На следующем уровне компании практикуют _профилактическое обслуживание_, при котором определяется полезный срок службы компонента. Он обслуживается или заменяется в случае выхода из строя. Профилактическое обслуживание позволяет избежать незапланированных и катастрофических сбоев. Но высокие затраты на запланированное время простоя, неполное использование ресурса компонента до его истечения срока службы и оплата труда по-прежнему остаются.
- Цель _прогнозного обслуживания_ заключается в оптимизации баланса между восстановительным и профилактическим обслуживанием за счет предоставления возможности _моментальной_ замены компонентов. При этом заменяются только те компоненты, срок службы которых подходит к концу. Расширяя срок службы компонентов (по сравнению с профилактическим обслуживанием) и сокращая незапланированные затраты на техническое обслуживание и оплату труда (по сравнению с восстановительным обслуживанием), предприятия могут обеспечить экономию средств и конкурентные преимущества.

## <a name="business-problems-in-pdm"></a>Бизнес-проблемы в PdM
Предприятия сталкиваются с высоким операционным риском из-за неожиданных сбоев и получают неполные сведения об основной причине проблем в сложных системах. Некоторые из ключевых бизнес-вопросов:

- Обнаружение отклонений в производительности и функциональности оборудования или системы.
- Прогноз относительно сбоя ресурса в ближайшем будущем.
- Оценка оставшегося срока периода эксплуатации ресурса.
- Определение основных причин отказа ресурса.
- Определение срока выполнения требуемых действий по техническому обслуживанию ресурса.

Типичные формулировки целей PdM:

- Снизить операционный риск критически важного оборудования.
- Увеличить норму прибыли от ресурсов путем прогнозирования сбоев до их возникновения.
- Контролировать затраты на техническое обслуживание, предоставляя операции по техническому обслуживанию в режиме "точно в срок".
- Уменьшить риск потери клиентов и снижения продаж, улучшить имидж торговой марки.
- Снизить затраты на инвентаризацию, уменьшая уровни запасов благодаря прогнозированию точки повторного заказа.
- Выявлять закономерности, связанные с различными проблемами обслуживания.
- Предоставить ключевые показатели эффективности (КПЭ), такие как показатели работоспособности ресурсов.
- Оценить оставшуюся продолжительность срока службы ресурсов.
- Рекомендовать своевременное выполнение работ по техническому обслуживанию.
- Обеспечить своевременную инвентаризацию, оценив даты заказа для замены деталей.

Эти цели служат отправной точкой для:

- _Специалистов по обработке и анализу данных_ для анализа и устранения возникших проблем прогнозирования.
- _Разработчиков и архитекторов облачных решений_ для создания комплексных решений.

## <a name="qualifying-problems-for-predictive-maintenance"></a>Проблемы классификации прогнозного обслуживания
Важно подчеркнуть, что прогнозное обслуживание применимо не во всех вариантах использования и оно не позволяет эффективно решить все бизнес-проблемы. Существуют три важных критерия классификации, которые необходимо учитывать при выборе проблемы:

- Проблема должна быть прогнозируемой по своей природе (то есть должна иметь прогнозируемую цель или результат). Проблема также должна предполагать четкий перечень действий для предотвращения сбоев при их обнаружении.
- Проблема должна иметь запись в истории эксплуатации оборудования, содержащую _как хорошие, так и плохие результаты_. Набор мер, принятых для предотвращения плохих результатов, также должен быть доступен как часть этих записей. Кроме того, важны журналы обслуживания с записями об ухудшении производительности и ремонте, а также журналы замены компонентов. Помимо прочего полезны ремонтные работы по улучшению производительности, а также записи о замене оборудования.
- В истории записей должны быть отражены _релевантные_ данные _достаточного_ качества для поддержки варианта использования. Дополнительные сведения о релевантности данных см. в статье [Сборник тренировочных заданий для шаблона решения Cortana Intelligence для прогнозируемого обслуживания в аэрокосмических и других компаниях](#Data-requirements-for-predictive-maintenance).
- Наконец, организация должна иметь экспертов в предметной области, которые имеют четкое представление о проблеме. Они должны знать о внутренних процессах и методах, чтобы помочь аналитику понять и интерпретировать данные. Они также должны иметь возможность вносить необходимые изменения в имеющиеся бизнес-процессы, чтобы при необходимости помочь собрать нужные данные о проблемах.

## <a name="sample-pdm-use-cases"></a>Варианты использования PdM
В этом разделе приведен ряд вариантов использования прогнозного обслуживания в некоторых отраслях, например изучение воздушно-космического пространства, техническое оборудование и транспорт. Каждый раздел начинается с бизнес-проблемы, а также в нем обсуждаются преимущества PdM, соответствующие данные, связанные с бизнес-проблемой, и, наконец, преимущества решения PdM.

| Бизнес-проблема | Преимущества PdM |
|:-----------------|-------------------|
|**Авиация**      |                   |
|_Задержка и отмена рейсов_ из-за механических проблем. Сбои, которые не удается устранить вовремя, могут привести к отмене рейсов и нарушению расписания полетов и функционирования. |Решения PdM могут прогнозировать вероятность задержки или отмены рейса из-за механических неисправностей.|
|_Неисправность деталей авиационных двигателей_. Замена деталей двигателя самолета является одной из наиболее распространенных задач обслуживания в авиационной отрасли. Решения обслуживания требуют тщательного управления доступностью, доставкой и планированием запасов компонентов.|Сбор аналитических данных о надежности компонента позволяет значительно сократить издержки инвестирования.|
|**Финансы** |                         |
|_Сбой банкомата_ является распространенной проблемой в отрасли банковских операций. Проблема прогнозирования заключается в вычислении вероятности прерывания операции выдачи наличных из банкомата из-за сбоя в устройстве выдачи наличных, например через застревание бумаги или неполадку компонента. Прогнозирование сбоев операций позволяет выполнять обслуживание банкоматов заранее для предотвращения возникновения сбоев.| Вместо того, чтобы допустить выход оборудования из строя в процессе транзакции, лучше запрограммировать аппарат на отказ в обслуживании на основе прогноза.|
|**Энергетика** |                          |
|_Неисправности ветроэлектрических установок_. Ветроэлектрические установки являются основным источником энергии в экологически ответственных странах и связаны с высокими капитальными затратами. Ключевым компонентом в установках является двигатель генератора. Сбой в его работе приводит к неэффективности установки. Его починка также очень затратна.|Прогнозирование КПЭ, таких как среднее время до сбоя (MTTF), может помочь энергетическим компаниям предотвратить сбои компонентов ветроэлектрической установки и обеспечить минимальное время простоя. При вероятности отказа оборудования технические специалисты будут отслеживать состояние установок, которые, скорее всего, скоро выйдут из строя, и запланируют режимы технического обслуживания с учетом времени. Прогнозные модели дают представление о различных факторах, которые способствуют сбоям, что помогает техническим специалистам лучше понять основные причины проблем.|
|_Отказ автоматических выключателей_. Для распределения электроэнергии между домами и предприятиями требуется бесперебойная работа линий электропередач, чтобы гарантировать подачу энергии. Автоматические выключатели помогают ограничить или избежать повреждения линий электропередач во время перегрузки или неблагоприятных погодных условий. Здесь бизнес-задача заключается в прогнозировании сбоев автоматических выключателей.| Решения прогнозного обслуживания позволяют снизить расходы на ремонт и увеличить жизненный цикл оборудования, например размыкателей цепи. Они помогают улучшить качество работы энергосистемы за счет сокращения непредвиденных сбоев и прерываний обслуживания.|
|**Транспорт и логистика** |    |
|_Неисправности дверей лифта_. Крупные компании по обслуживанию лифтов предоставляют полный набор услуг для миллионов функциональных лифтов по всему миру. Безопасность, надежность и время безотказной работы лифта являются основной проблемой для их клиентов. Такие компании отслеживают эти и другие атрибуты с помощью датчиков, чтобы помочь в ремонтном и профилактическом обслуживании. Наиболее важной проблемой для клиентов является неисправность дверей лифта. Бизнес-проблема в этом случае заключается в предоставлении прогнозного приложения базы знаний, которое прогнозирует потенциальные причины возникновения неполадок в работе дверей.| Лифты — это капиталовложения с жизненным циклом около 20–30 лет. Каждая потенциальная продажа может быть очень конкурентной, поэтому ожидания к обслуживанию и поддержке высоки. Прогнозное обслуживание может предоставить этим компаниям конкурентное преимущество их продуктов и ​​услуг.|
|_Выход из строя колес_. Поломки колес приводят к половине всех крушений поездов и приносят миллиардные убытки мировой железнодорожной отрасли. Поломки колес также приводят к ухудшению рельсов, что иногда приводит к их преждевременному разрыву. Разрывы ведут к катастрофическим событиям, таким как схождение с рельс. Чтобы избежать таких случаев, железные дороги контролируют работу колес и совершают их профилактическую замену. Деловая проблема здесь — прогнозирование поломок колес.| Прогнозное обслуживание поможет вовремя заменять колеса. |
|_Неисправности дверей вагона метро_. Основной причиной задержек в работе метро является отказ дверей вагонов. Здесь бизнес-задача заключается в прогнозировании сбоев дверей.|Ранняя осведомленность о неисправности двери или количества дней до ее отказа поможет бизнесу оптимизировать график обслуживания дверей поездов.|

В следующем разделе рассказывается о том, как реализовать преимущества PdM, о которых говорилось выше.

## <a name="data-science-for-predictive-maintenance"></a>Обработка и анализ данных для прогнозного обслуживания

В этом разделе представлены общие рекомендации по принципам и методам обработки и анализа данных для PdM. Он призван помочь TDM, архитектору или разработчику решения понять предварительные условия и процесс создания комплексных приложений ИИ для PdM. Вы можете прочесть этот раздел и просмотреть шаблоны для демонстрации и экспериментов, перечисленные в статье [Сборник тренировочных заданий для шаблона решения Cortana Intelligence для прогнозируемого обслуживания в аэрокосмических и других компаниях](#Solution-templates-for-predictive-maintenance). Затем вы можете использовать эти принципы и рекомендация для реализации своего решения PdM в Azure.

> [!NOTE]
> Данное руководство НЕ предназначено для обучения обработке и анализу данных. Несколько полезных источников предоставляются в разделе [учебных ресурсов для прогнозного обслуживания](#Training-resources-for-predictive-maintenance). [Шаблоны решений](#Solution-templates-for-predictive-maintenance), перечисленные в руководстве, демонстрируют некоторые из этих методов ИИ для конкретных проблем PdM.

## <a name="data-requirements-for-predictive-maintenance"></a>Требования к данным для прогнозного обслуживания

Успех любого обучения зависит от (а) качества того, чему учат, и (б) способностей учащегося. Прогнозные модели изучают закономерности в исторических данных и прогнозируют будущие результаты с определенной вероятностью на основе этих наблюдаемых закономерностей. Точность прогнозной модели зависит от релевантности, достаточности и качества данных для обучения и тестирования. Новые данные, проанализированные с использованием этой модели, должны иметь те же функции и схему, что и данные для обучения и тестирования. Характеристики функций (тип, плотность, распределение и т. д.) новых данных должны соответствовать характеристикам наборов данных для обучения и тестирования. Основное внимание в этом разделе уделяется таким требованиям к данным.

### <a name="relevant-data"></a>Релевантные данные

Во-первых, данные должны _соответствовать проблеме_. Рассмотрим вариант использования _поломки колеса_. Данные для обучения должны содержать функции, связанные с работой колеса. Если проблема заключалась в прогнозировании поломки _системы тяги_, данные для обучения должны охватывать все различные компоненты этой системы. Первый случай указывает на конкретный компонент, тогда как второй — на отказ большей подсистемы. Общая рекомендация заключается в разработке систем прогнозирования для конкретных компонентов, а не более крупных подсистем, так как последние будут иметь более разобщенные данные. Предметный специалист (см. статью [Сборник тренировочных заданий для шаблона решения Cortana Intelligence для прогнозируемого обслуживания в аэрокосмических и других компаниях](#Qualifying-problems-for-predictive-maintenance)) должен помочь в выборе наиболее релевантных подмножеств данных для анализа. Релевантные источники данных более подробно обсуждаются в статье [Сборник тренировочных заданий для шаблона решения Cortana Intelligence для прогнозируемого обслуживания в аэрокосмических и других компаниях](#Data-preparation-for-predictive-maintenance).

### <a name="sufficient-data"></a>Достаточный объем данных
В отношении данных истории сбоев обычно задают два вопроса: (1) "Сколько событий сбоя требуется для обучения модели?" и (2) "Сколько записей достаточно?". Определенных ответов нет, есть только эмпирические правила. Для первого варианта, чем больше количество неудачных событий, тем лучше модель. Для второго точное количество событий сбоя зависит от данных и контекста решаемой проблемы. Но с другой стороны, если механизм выходит из строя слишком часто, компания заменит его, что сократит число случаев сбоя. Здесь также важны рекомендации предметного специалиста. Однако существуют способы справиться с проблемой _редких событий_. Они обсуждаются в разделе [Обработка несбалансированных данных](#Handling-imbalanced-data).

### <a name="quality-data"></a>Качество данных
Качество данных имеет решающее значение. Каждое значение атрибута прогноза должно быть _точным_ в сочетании со значением целевой переменной. Качество данных — хорошо изученная область статистики и управления данными и, следовательно, выходит за рамки этого руководства.

> [!NOTE]
> Для предоставления качественных данных есть несколько ресурсов и корпоративных продуктов. Ниже приведены ссылки:
> - Dasu, T, Johnson, T., Exploratory Data Mining and Data Cleaning, Wiley, 2003 (Дасу Т., Джонсон Т., Разведочный интеллектуальный анализ данных и очистка данных, Вайли, 2003 год).
> - [Разведочный анализ данных, Википедия](https://en.wikipedia.org/wiki/Exploratory_data_analysis).
> - [Hellerstein, J, Quantitative Data Cleaning for Large Databases](http://db.cs.berkeley.edu/jmh/papers/cleaning-unece.pdf) (Хелерштейн Д., Количественная очистка данных для больших баз данных).
> - [de Jonge, E, van der loo, M, Introduction to Data Cleaning with R](https://cran.r-project.org/doc/contrib/de_Jonge+van_der_Loo-Introduction_to_data_cleaning_with_R.pdf) (Де Джонг Е., Ван дер Лу М., Введение в очистку данных с помощью R).

## <a name="data-preparation-for-predictive-maintenance"></a>Подготовка данных для прогнозного обслуживания

### <a name="data-sources"></a>Источники данных

Источники релевантных данных для прогнозного обслуживания включают в себя помимо прочего:
- Журнал сбоев.
- Журнал обслуживания или восстановления.
- Условия работы компьютера.
- Метаданные оборудования.

#### <a name="failure-history"></a>Журнал сбоев
События сбоев происходят редко в приложениях PdM. Однако при построении прогнозных моделей алгоритм должен знать шаблон нормальной работы компонента, а также его шаблоны отказов. Таким образом, данные для обучения должны содержать достаточное количество примеров из обеих категорий. Журнал обслуживания и замены деталей являются хорошими источниками обнаружения событий сбоя. С применением предметных знаний аномалии в данных для обучения также можно определить как сбои.

#### <a name="maintenancerepair-history"></a>Журнал обслуживания или восстановления
Журнал обслуживания ресурса содержит сведения о замененных компонентах, выполненных ремонтных работах и ​​т. д. Эти события содержат записи шаблонов ухудшения работоспособности. Отсутствие этой важной информации в данных для обучения может привести к ошибочным результатам модели. Журнал сбоев также можно найти в журнале обслуживания в виде специальных кодов ошибок или дат заказа деталей. Дополнительные источники данных, которые влияют на шаблоны отказов, должны быть исследованы и предоставлены экспертами в предметной области.

#### <a name="machine-operating-conditions"></a>Условия работы компьютера
Потоковые данные с датчиков (или из других источников) используемого оборудования являются важным источником данных. Ключевым допущением в PdM является то, что при эксплуатации в обычном режиме состояние работоспособности оборудования со временем ухудшается. Ожидается, что данные содержат изменяющиеся со временем признаки, которые отражают эту временную закономерность, и любые аномалии, которые ведут к ухудшению работоспособности. Временной аспект данных необходим для того, чтобы алгоритм мог изучать шаблоны наличия и отсутствия сбоев с течением времени. Основываясь на этих точках данных, алгоритм учится прогнозировать, сколько еще единиц времени оборудование сможет продолжать работать, до того как выйдет из строя.

#### <a name="static-feature-data"></a>Данные о статических характеристиках
Статические характеристики — это метаданные об оборудовании. Примерами являются модель оборудования, дата изготовления, дата начала службы, местоположение системы и другие технические характеристики.

Примеры релевантных данных для [примеров вариантов использования PdM](#Sample-PdM-use-cases) приведены в таблице ниже:

| Вариант использования | Примеры релевантных данных |
|:---------|---------------------------|
|_Задержка и отмена рейсов_ | Информацию о полете можно найти в маршруте полета и постраничном журнале. Данные о полете включают в себя данные маршрута, такие как дата вылета и прибытия, время, аэропорт, пересадки и т. д. Постраничный журнал содержит ряд кодов ошибок и обслуживания, регистрируемых обслуживающим персоналом на земле.|
|_Неисправность деталей двигателя самолета_ | Данные, собранные с датчиков самолета, которые предоставляют информацию о состоянии различных компонентов. Кроме того, можно использовать записи об обслуживании, позволяющие определить время возникновения неполадок компонента и его замены.|
|_Сбой банкомата_ | Показания датчиков для каждой транзакции (прием наличных средств или чека) и выдачи наличных. Информация об измерении зазора между банкнотами, толщина банкноты, пробег приемного механизма, атрибуты чека и ​​т. д. Отчеты по обслуживанию, которые содержат коды ошибок, информацию о последнем ремонте, когда устройство выдачи наличных было повторно пополнено.|
|_Сбои ветроэлектрической установки_ | Датчики контролируют состояние установки, такие как температура, направление ветра, мощность, скорость генератора и т. д. Данные собираются с нескольких ветроэлектрических установок в ветропарках, расположенных в разных регионах. Как правило, каждая установка передает несколько показаний измерений с фиксированным временным интервалом.|
|_Сбои автоматического выключателя_ | Журналы технического обслуживания, которые включают в себя ремонтные, профилактические и систематические мероприятия. Операционные данные, которые включают в себя автоматические и ручные команды, отправленные на автоматические выключатели, например для включения и отключения. Метаданные устройства, такие как дата изготовления, местоположение, модель и т. д. Спецификации выключателя, такие как уровни напряжения, геолокация, условия окружающей среды.|
|_Сбои в работе дверей лифта_| Метаданные лифта, такие как тип лифта, дата изготовления, частота обслуживания, тип здания и т. д. Оперативная информация, такая как количество и среднее время циклов закрытия и открытия дверей. Журнал сбоев с причинами.|
|_Поломка колес_ | Данные датчиков, которые измеряют ускорение колес, случаи торможения, дальность движения, скорость и т. д. Статические сведения о колесах, такие как производитель и дата изготовления. Данные о сбоях выводятся из базы данных заказа запчастей, которые отслеживают даты и количество заказов.|
|_Неполадки в работе дверей вагонов метро_ | Время открытия и закрытия дверей, другие эксплуатационные данные, такие как текущее состояние дверей поездов. Статические данные будут содержать столбцы значений идентификатора ресурса, времени и состояния.|

### <a name="data-types"></a>Типы данных
Учитывая вышеперечисленные источники данных, двумя основными типами данных, наблюдаемыми в домене PdM, являются:

- _Временные данные_. Операционная телеметрия, состояние оборудования, типы распоряжений о проведении работ, коды приоритета с отметками времени во время записи. Журнал обслуживания, восстановления, ремонта и использования также будут иметь временные метки, связанные с каждым событием.
- _Статические данные_. Признаки машин и операторов в целом носят статический характер, так как они обычно описывают технические характеристики машин или атрибуты оператора. Если эти параметры со временем меняются, они также будут иметь связанные с ними временные метки.

Прогнозируемые и целевые переменные должны быть предварительно обработаны или преобразованы в [числовые, категориальные и другие типы данных](https://www.statsdirect.com/help/basics/measurement_scales.htm) в зависимости от используемого алгоритма.

### <a name="data-preprocessing"></a>Предварительная обработка данных
В качестве предварительного требования для _проектирования признаков_, подготовьте данные из разных потоков, чтобы составить схему, из которой легко создавать признаки. Сначала визуализируйте данные как таблицу записей. Каждая строка в таблице представляет собой учебный экземпляр, а столбцы представляют признаки _прогнозирования_ (также называемые независимыми атрибутами или переменными). Организуйте данные так, чтобы последний столбец был _целевым_ (зависимая переменная). Для каждого учебного экземпляра присвойте _метку_ в качестве значения этого столбца.

Для временных данных разделите продолжительность данных датчика на единицы времени. Каждая запись должна принадлежать единице времени для ресурса _и должна предлагать уникальную информацию_. Единицы времени определяются на основе потребностей бизнеса в секундах, минутах, часах, днях, месяцах и т. д. Единица времени _не должна совпадать с частотой сбора данных_. Если частота высока, данные могут не существенно отличаться между разными единицами. Например, предположим, что температура окружающей среды собиралась каждые 10 секунд. Использование одного интервала для данных обучения только увеличивает количество примеров, не предоставляя дополнительной информации. В этом случае лучше всего использовать усредненные данные за 10 минут или час, в зависимости от бизнес-требований.

Для статических данных:
- _Журналы обслуживания_. Необработанные данные технического обслуживания содержат идентификатор ресурса и временную метку с информацией о действиях по обслуживанию, которые были выполнены в данный момент времени. Преобразуйте операции технического обслуживания в _категориальные_ столбцы, где каждый дескриптор категории уникально соответствует конкретному действию обслуживания. Схема записей об обслуживании будет включать в себя столбец идентификатора ресурса, времени и меры по обслуживанию.

- _Записи о сбоях_. Ошибки или причины сбоя могут быть записаны как конкретные коды ошибок или события сбоя, определенные конкретными бизнес-условиями. В тех случаях, когда в оборудовании возникло несколько кодов ошибок, эксперт в предметной области должен помочь идентифицировать те, которые относятся к целевой переменной. Используйте оставшиеся коды ошибок или условия для создания признаков _прогнозирования_, которые коррелируют с этими сбоями. Схема для записей о сбоях включает в себя столбцы идентификатора ресурса, времени, сбоя или причины сбоя, если она известна.

- _Метаданные оборудования и оператора_. Объедините данные оборудования и оператора в одну схему, чтобы связать ресурс с его оператором и с соответствующими атрибутами. Схема для состояния оборудования включает в себя идентификатор и признаки ресурса, а также соответствующие данные оператора.

Другие шаги предварительной обработки данных включают в себя_обработку отсутствующих значений_ и _нормализацию_ значений атрибутов. Подробное обсуждение выходит за рамки настоящего руководства. Некоторые полезные ссылки см. в следующем разделе.

После предварительной обработки вышеуказанных источников данных перед проектированием признаков следует соединить вышеуказанные таблицы на основе идентификатора ресурсов и метки времени. В результате таблица будет иметь нулевые значения для столбца сбоя, когда оборудование работает в нормальном режиме. Эти нулевые значения можно считать индикатором нормальной работы. Этот столбец сбоя используется при создании _меток для прогнозной модели_. Дополнительные сведения см. в подразделе о [методах моделирования для прогнозного обслуживания](#Modeling-techniques-for-predictive-maintenance).

## <a name="feature-engineering"></a>Проектирование признаков
Проектирование признаков — это первый шаг перед моделированием данных. Его роль в процессе обработки и анализа данных [описана в данном разделе](https://docs.microsoft.com/azure/machine-learning/team-data-science-process/create-features). _Признак_ является прогнозным атрибутом модели, например температурой, давлением, вибрацией и т. д. Для PdM проектирование признаков включает в себя абстрагирование работоспособности оборудования от исторических данных, собранных в течение продолжительного времени. В этом смысле оно отличается от удаленного мониторинга, обнаружения аномалий и сбоев. 

### <a name="time-windows"></a>Временные окна
Удаленный мониторинг подразумевает сообщение о событиях, которые происходят в _точках времени_. Модели обнаружения аномалий оценивают входящие потоки данных для выявления аномалий в точках времени. Обнаружение сбоя классифицирует сбои определенного типа по мере их возникновения в точках времени. С другой стороны, PdM включает в себя прогнозирование сбоев в течение _периода времени в будущем_ на основе признаков, которые представляют поведение оборудования в течение _периода времени в прошлом_. Для PdM данные признаков из отдельных точек времени слишком запутаны для прогнозирования. Таким образом, данные для каждого признака должны быть _выровнены_ путем агрегирования точек данных во временных окнах.

### <a name="lag-features"></a>Признаки задержек
Бизнес-требования определяют период прогнозирования в будущее для модели. В свою очередь, этот показатель помогает определить, какой объем исторических данных должна изучить модель, чтобы сделать эти прогнозы. Этот период называется _задержкой_, а функции, спроектированные за этот период задержки, называются _признаками задержки_. В этом разделе обсуждаются признаки задержки, которые можно создать из источников данных с отметками времени, и создание признаков из источников статических данных. Признаки задержек обычно _числовые_.

> [!IMPORTANT]
> Размер окна определяется путем экспериментов и должен быть завершен при помощи эксперта в предметной области. То же относится к выбору и определению признаков задержек, их агрегации и типу временных окон.

#### <a name="rolling-aggregates"></a>Скользящие агрегаты
Для каждой записи ресурса выберем скользящее окно размера W, что означает количество единиц измерения времени, для которого необходимо выполнять вычисления агрегатов. Затем мы вычислим признаки, используя периоды W _до даты этой записи_. На рис. 1 синими линиями представлены значения датчика, записанные для каждой единицы измерения времени ресурса. Они обозначают скользящее среднее значений признака для окна с размером W=3. Скользящее среднее вычисляется по всем записям с отметками времени в диапазоне от t<sub>1</sub> (оранжевый цвет) до t<sub>2</sub> (зеленый цвет). Значение W обычно исчисляется в минутах или часах в зависимости от характера данных. Но для некоторых проблем выбор большого значения W (скажем, 12 месяцев) позволяет получить всю историю ресурса до момента записи.

![Рис. 1. Признаки для скользящих агрегатов](./media/cortana-analytics-playbook-predictive-maintenance/rolling-aggregate-features.png) Рис. 1. Признаки для скользящих агрегатов

Примерами скользящих агрегатов за временное окно являются количество, средняя продолжительность, общая сумма, минимальные и максимальные значения. Кроме того, часто используются дисперсия, стандартное отклонение и количество выбросов, превышающих N стандартных отклонений. Примеры агрегатов, которые можно применить в [вариантах использования](#Sample-PdM-use-cases) в этом руководстве, перечислены ниже. 
- _Задержка полета_: количество кодов ошибок за последний день или неделю.
- _Неисправность детали двигателя самолета_: признаки для скользящих средних, стандартного отклонения и суммы за последний день, неделю и т. д. Эта метрика должна определяться вместе с экспертом в предметной области бизнеса.
- _Сбои банкоматов_: скользящие средние, медиана, диапазон, стандартные отклонения, множественные выбросы за пределы трех стандартных отклонений, а также самые высокие и низкие совокупные значения.
- _Неисправности дверей вагона поезда метро_: количество событий за прошлый день, неделю, две недели и т. д.
- _Сбой автоматического выключателя_: количество сбоев за прошлую неделю, год, три года и т. д.

Другой интересный метод предусматривает выявление изменений тенденций, пиков и уровней с помощью алгоритмов, которые позволяют обнаруживать аномалии в данных.

#### <a name="tumbling-aggregates"></a>Агрегаты для переворачивающихся окон
Для каждой помеченной записи ресурса определяется окно размера _W-<sub>k</sub>_, где _k_ — это количество окон размера _W_. Затем создаются агрегаты для _k__переворачивающихся окон__Wk, W-<sub>(k-1)</sub>, …, W-<sub>2</sub>, W-<sub>1</sub>_ за периоды до отметки времени записи. Можно выбрать большое значение _k_ для записи шаблонов долгосрочного замедления или небольшое — для записи краткосрочных воздействий (см. рис. 2).

![Рис. 2. Признаки для переворачивающихся агрегатов](./media/cortana-analytics-playbook-predictive-maintenance/tumbling-aggregate-features.png) Рис. 2. Переворачивающееся статистические функции

Например, создать признаки задержек для ветроэлектрической установки можно со значениями W=1 и k=3. Они подразумевают задержку каждого из последних трех месяцев с использованием самого высокого и самого низкого значения выбросов.

### <a name="static-features"></a>Статические признаки

У оборудования есть такие технические характеристики, как дата изготовления, номер модели, расположение. Они рассматриваются как _категориальные_ переменные моделирования. Примерами таких свойств автоматического выключателя могут быть показатели напряжения, тока и питания, а также типы трансформаторов, источники питания. В качестве примера повреждений дисков можно использовать их тип (литые или стальные).

Предложенные усилия по подготовке данных должны привести к упорядочению данных, как показано ниже. Данные для обучения, тестирования и проверки должны соответствовать следующей логической схеме (в этом примере время измеряется в днях).

| Идентификатор актива | Время | <Feature Columns> | Метка |
| ---- | ---- | --- | --- |
| A123 |День 1 | . . . | . |
| A123 |День 2 | . . . | . |
| ...  |...   | . . . | . |
| B234 |День 1 | . . . | . |
| B234 |День 2 | . . . | . |
| ...  |...   | . . . | . |

Последним шагом в создании признаков является **маркировка** целевой переменной. Этот процесс зависит от метода моделирования. В свою очередь, метод моделирования зависит от бизнес-проблемы и характера имеющихся данных. Маркировка рассматривается в следующем разделе.

> [!IMPORTANT]
> Подготовка данных и создание признаков важны, как методы моделирования для создания эффективных решений PdM. Эксперт в предметной области и разработчик должны потратить значительное время на получение правильных признаков и данных для модели. Ниже приведены несколько из множества книг по проектированию признаков:
> - Pyle, D. Data Preparation for Data Mining (The Morgan Kaufmann Series in Data Management Systems), 1999 (Пайл Д. Подготовка данных для интеллектуального анализа данных (серия Морган Кауфман в системах управления данными), 1999 год).
> - Zheng, A., Casari, A. Feature Engineering for Machine Learning: Principles and Techniques for Data Scientists, O'Reilly, 2018 (Чжэн А., Казари А. Создание признаков для машинного обучения: принципы и методы для специалистов по обработке и анализу данных, О'Рейли, 2018 год).
> - Dong, G. Liu, H. (Editors), Feature Engineering for Machine Learning and Data Analytics (Chapman & Hall/CRC Data Mining and Knowledge Discovery Series), CRC Press, 2018 (Донг Г., Лю Х. (редакторы), Разработка признаков для машинного обучения и анализа данных (Чепмен и Холл / Серия "Интеллектуальный анализ данных и получение информации CRC"), CRC Press, 2018 год).

## <a name="modeling-techniques-for-predictive-maintenance"></a>Методы моделирования для прогнозного обслуживания

В этом разделе обсуждаются основные методы моделирования проблем PdM, а также конкретные методы создания меток. Обратите внимание, что один и тот же метод моделирования может использоваться в разных отраслях. Метод моделирования сопряжен с проблемой обработки и анализа данных, а не с контекстом данных.

> [!IMPORTANT]
> Выбор меток для случаев сбоев и стратегию маркировки  
> следует определить после консультации с экспертом в предметной области.

### <a name="binary-classification"></a>Двоичная классификация
Двоичная классификация используется, чтобы _спрогнозировать вероятность сбоя оборудования в определенный период времени в будущем_. Это называется _периодом в будущем X_. X определяется бизнес-проблемой и доступными данными после консультации с экспертом в предметной области. Примеры
- _Минимальное время выполнения_, необходимое для замены компонентов, развертывания ресурсов для обслуживания, выполнения технического обслуживания, чтобы избежать проблемы, которая может возникнуть в этот период.
- _Минимальное количество событий_, которое может произойти до возникновения проблемы.

В этом методе идентифицируются два типа примеров обучения. Положительный пример, _который указывает на сбой_, с меткой = 1. Отрицательный пример, который указывает на нормальный режим работы, с меткой = 0. Целевая переменная и значения меток являются _категориальными_. Модель должна идентифицировать каждый новый пример с вероятностью сбоя или нормальной работы в течение следующих X единиц времени.

#### <a name="label-construction-for-binary-classification"></a>Создание меток для двоичной классификации
Здесь возникает вопрос: "Какова вероятность того, что ресурс выйдет из строя в следующие X единиц времени?" Чтобы ответить на этот вопрос, пометьте записи X до того, как ресурс выйдет из строя (метка = 1), и остальные записи как "нормальные" (метка = 0) (см. рис. 3).

![Рис. 3. Создание меток для двоичной классификации](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-binary-classification.png) Рис. 3. Создание меток для двоичной классификации

Ниже приведены примеры стратегии маркировки для некоторых вариантов использования.
- _Задержки рейсов_: X может иметь значение 1 дня, чтобы предсказать задержки в следующие 24 часа. Всем рейсам в период 24 часов до сбоя присвоена метка 1.
- _Сбои выдачи наличных в банкоматах_: целью может быть определение вероятности сбоя транзакций в течение следующего часа. В этом случае все транзакции, произошедшие за час до сбоя, получают метку 1. Чтобы предсказать вероятность отказа после выдачи следующих N банкнот, все банкноты, выданные за N последних банкнот до сбоя, получают метку 1.
- _Сбои автоматического выключателя_: целью может быть прогнозирование следующего сбоя команды автоматического выключателя. В этом случае X выбирается как одна из будущих команд.
- _Сбой двери поезда_: X может принять значение двух дней.
- _Сбой ветроэлектрической установки_: X может принять значение двух месяцев.

### <a name="regression-for-predictive-maintenance"></a>Регрессии для прогнозируемого обслуживания
Модели регрессии используются для _вычисления оставшегося периода эксплуатации (RUL) ресурса_. RUL определяется как время, в течение которого ресурс работает до следующего сбоя. Каждый пример обучения — это запись, относящаяся к единице времени _nY_ ресурса, где _n_ является кратным. Модель должна рассчитать RUL каждого нового примера как _непрерывное число_. Это число обозначает период времени до возникновения сбоя.

#### <a name="label-construction-for-regression"></a>Проектирование меток для регрессии
Здесь возникает вопрос: "Каков оставшийся период эксплуатации оборудования?" Для каждой записи перед сбоем вычислите метку как количество единиц времени, оставшихся до следующего сбоя. В этом методе метки являются непрерывными переменными (см. рис. 4).

![Рис. 4. Создание меток для регрессии](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-regression.png) Рис. 4. 4 Создание меток для регрессии

Создание меток для регрессии выполняется со ссылкой на точку сбоя. Его вычисление невозможно без знания того, как долго ресурс проработал до сбоя. Таким образом, в отличие от двоичной классификации, ресурсы без каких-либо сбоев в данных не могут использоваться для моделирования. В этом случае лучше всего применить другой статистический метод, который называется [анализ выживаемости](https://en.wikipedia.org/wiki/Survival_analysis). Потенциальные осложнения могут возникнуть при применении этого метода к случаям использования PdM, которые связаны с часто изменяющимися во времени данными. Дополнительные сведения по анализу выживаемости см. на [этой странице](https://www.cscu.cornell.edu/news/statnews/stnews78.pdf).

### <a name="multi-class-classification-for-predictive-maintenance"></a>Многоклассовая классификация для прогнозируемого обслуживания
Методы классификации нескольких классов могут использоваться в решениях PdM в двух сценариях:
- Спрогнозируйте _два будущих результата_: первым результатом является _диапазон времени до сбоя_ для ресурса. Ресурсу присваиваются один из нескольких возможных периодов времени. Второй — вероятность сбоя в будущем по одной из _нескольких основных причин_. Это предсказание позволяет обслуживающему персоналу следить за симптомами и планировать графики технического обслуживания.
- Спрогнозируйте _наиболее вероятную причину_ данного сбоя. Этот результат рекомендует правильный набор действий по техническому обслуживанию для устранения сбоя. Ранжированный список первопричин и рекомендуемых ремонтных работ может помочь специалистам уделять первоочередное внимание действиям по восстановлению после сбоя.

#### <a name="label-construction-for-multi-class-classification"></a>Создание меток для многоклассовой классификации
Здесь возникает вопрос: "Какова вероятность того, что ресурс выйдет из строя в следующие _nZ_ единиц времени, где _n_ является количеством периодов?" Чтобы ответить на этот вопрос, отметьте записи nZ до выхода из строя ресурса, используя фрагменты времени (3Z, 2Z, Z). Пометьте все остальные записи как "нормальные" (метка = 0). В этом методе целевая переменная содержит _категориальные_ значения (см. рис. 5).

![Рис. 5. Создание меток для многоклассовой классификации, позволяющей спрогнозировать время сбоя](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-multiclass-classification-for-failure-time-prediction.png) Рис. 5. Создание меток для многоклассовой классификации, позволяющей спрогнозировать время сбоя

Здесь возникает вопрос: "Какова вероятность того, что ресурс выйдет из строя в следующие X единиц времени из-за первопричины или проблемы _P<sub>i</sub>_?", где _i_ — это число возможных первопричин. Чтобы ответить на этот вопрос, пометьте записи X до выхода ресурса из строя как "те, что скоро выйдут из строя из-за первопричины _P<sub>i</sub>_" (метка = _P<sub>i</sub>_). Пометьте все остальные записи как "нормальные" (метка = 0). В этом методе метки являются категориальными (см. рис. 6).

![Рис. 6. Создание меток для многоклассовой классификации, позволяющей спрогнозировать основную причину](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-multiclass-classification-for-root-cause-prediction.png) Рис. 6. Создание меток для многоклассовой классификации, позволяющей спрогнозировать основную причину

Эта модель позволяет определить вероятность сбоя из-за каждой проблемы _P<sub>i</sub>_ и вероятность отсутствия сбоев. Эти вероятности можно упорядочить по величине, чтобы спрогнозировать наиболее вероятные будущие проблемы.

Здесь возникает такой вопрос: "Какие действия по обслуживанию вы рекомендуете после возникновения сбоя?" Чтобы ответить на этот вопрос, для создания метки _не требуется выбирать период в будущем_, так как модель не прогнозирует возникновение сбоя в будущем. Это просто предсказание наиболее вероятной основной причины _, как только сбой уже произошел_.

## <a name="training-validation-and-testing-methods-for-predictive-maintenance"></a>Методы обучения, проверки и тестирования в прогнозном обслуживании
[Процесс обработки и анализа данных группы](https://docs.microsoft.com/azure/machine-learning/team-data-science-process/overview) обеспечивает полный охват цикла "обучение-тестирование-проверка". В этом разделе рассматриваются аспекты, уникальные для PdM.

### <a name="cross-validation"></a>Перекрестная проверка
Цель [перекрестной проверки](https://en.wikipedia.org/wiki/Cross-validation_(statistics)) заключается в определении набора данных для "тестирования" модели на этапе обучения. Этот набор данных называется _набором для проверки_. Использование перекрестной проверки помогает ограничить такие проблемы, как _лжевзаимосвязи_, и дает представление о том, как модель будет обобщаться на независимом наборе данных, то есть неизвестном наборе данных, который может быть основан на реальной проблеме. Процедура обучения и тестирования для PdM должна учитывать временные аспекты, чтобы лучше обобщить неизвестные будущие данные.

Множество алгоритмов машинного обучения зависят от количества гиперпараметров, которые могут существенно повлиять на эффективность модели. Оптимальные значения этих гиперпараметров не вычисляются автоматически во время обучения модели. Их должен указать специалист по обработке данных. Существует несколько способов определения оптимальных значений гиперпараметров.

Один из наиболее распространенных способов — это _перекрестная проверка k сверток_, которая разбивает примеры на _k_ сверток случайным образом. Для каждого набора значений гиперпараметров алгоритм обучения выполняется _k_ раз. При каждой итерации примеры в текущей свертке используются в качестве набора для проверки, а остальные примеры — в качестве набора для обучения. Алгоритм предусматривает обучение на основе примеров обучения, а метрики эффективности вычисляются на основе примеров проверки. В конце этого цикла вычислите среднее значение _k_ метрик производительности. Для каждого набора значений гиперпараметров выберите значеия с лучшей средней производительностью. Задача выбора гиперпараметров часто носит экспериментальный характер.

Для решений прогнозного обслуживания данные записываются как временные ряды событий, поступающие из нескольких источников данных. Эти записи можно упорядочить по времени создания метки. Если разделить набор данных на наборы для обучения и проверки _случайным образом_, время _некоторых примеров обучения будет позже времени некоторых примеров проверки_. Таким образом, будущая эффективность значений гиперпараметров оценивается на основе данных, полученных _до_ обучения модели. Такая оценка может быть слишком оптимистичной, особенно в том случае, если временные ряды нестабильны и меняют свое поведение с течением времени. В результате выбранные значения гиперпараметров могут быть неоптимальными.

Рекомендуется разделить примеры на наборы для обучения и проверки по принципу _зависимости от времени_, чтобы время всех примеров проверки было позже времени всех примеров обучения. Для каждого набора значений гиперпараметров подготовьте алгоритм по набору данных для обучения. Измерьте эффективность модели по тому же набору для проверки. Выберите значения гиперпараметров, которые демонстрируют лучшую эффективность. Значения гиперпараметров, выбранные по методу разделения на наборы для обучения и проверки, обеспечат более высокую эффективность модели в будущем, чем значения, выбранные случайным образом по методу перекрестной проверки.

Окончательная модель создается путем обучения алгоритма обучения на основе всех данных с использованием лучших значений гиперпараметров.

### <a name="testing-for-model-performance"></a>Тестирование эффективности модели
После создания модели необходимо оценить ее будущую эффективность на основе новых данных. Хороший показатель оценки — метрика эффективности значений гиперпараметров, вычисленная на основе набора для проверки, или среднее значение метрики эффективности, вычисленное по методу перекрестной проверки. Эти оценки часто чрезмерно оптимистичны. Бизнесу часто бывают необходимы дополнительные рекомендации относительно того, как требуется протестировать модель.

Рекомендуемый способ для PdM состоит в том, чтобы разделить примеры на наборы данных для обучения, проверки и тестирования по принципу _зависимости от времени_. Время всех примеров тестирования будет позже времени всех примеров обучения и проверки. После разделения создайте модель и измерьте ее производительность, как описано ранее.

Если временные ряды стабильны и их легко спрогнозировать, оба подхода (произвольный и зависимый от времени) дадут аналогичные оценки будущей эффективности. Но если временные ряды нестабильны или их сложно спрогнозировать, с помощью второго подхода можно получить более реалистичную оценку будущей эффективности.

### <a name="time-dependent-split"></a>Разделение по принципу зависимости от времени
В этом разделе описываются рекомендации для реализации разделения, зависящего от времени. Здесь описывается разделение на наборы для обучения и проверки по принципу зависимости от времени.

Предположим, что у нас есть поток событий с метками времени, например измерения с различных датчиков. Признаки примеров обучения и тестирования, а также их метки определяются по временным рамкам, включающим несколько событий. Например, как описано в разделах [Проектирование признаков](#Feature-engineering) и [Методы создания моделей](#Modeling-techniques-applied-to-PdM-use-cases), для двоичной классификации признаки создаются на основе прошлых событий, а метки — на основе будущих событий в течение X единиц измерения времени в будущем. Таким образом, период времени создания меток примера наступает позже, чем период времени создания его признаков.

Для разделения по принципу зависимости от времени нужно выбрать _момент времени, по которому выполняется обучение T<sub>c</sub>_ модели с использованием настраиваемых гиперпараметров и исторических данных вплоть до T<sub>c</sub>. Во избежание попадания будущих меток, которые находятся за пределами T<sub>c</sub>, в данные для обучения, нужно выбрать последний период времени, чтобы пометить примеры обучения как X единицы до T<sub>c</sub>. В примере, показанном на рисунке 7, каждый квадрат представляет собой запись в наборе данных, где признаки и метки вычисляются, как описано выше. На рисунке показаны записи, которые нужно поместить в наборы для обучения и тестирования для X=2 и W=3:

![Рис. 7. Разделение по принципу зависимости от времени для двоичной классификации](./media/cortana-analytics-playbook-predictive-maintenance/time-dependent-split-for-binary-classification.png) Рис. 7. Разделение по принципу зависимости от времени для двоичной классификации

Зеленые квадраты представляют записи, относящиеся к единицам измерения времени, которые можно использовать для обучения. Для создания каждого примера обучения в таблице конечных признаков необходимо просмотреть 3 последних периода для создания признаков и 2 будущих периода для создания меток до точки T<sub>c</sub>. Если какая-либо часть двух будущих периодов находится за пределами T<sub>c</sub>, исключите этот пример из набора данных обучения, потому что видимость не предполагается за пределами точки T<sub>c</sub>.

Из-за этого ограничения черные квадраты, которые представляют записи окончательного набора данных с меткой, нельзя использовать в наборе данных для обучения. Эти записи также не будут использоваться при тестировании данных, так как они находятся до точки T<sub>с</sub>. Кроме того, их интервалы времени создания меток частично зависят от интервала времени обучения, что не совсем удобно. Обучающие и тестовые данные должны иметь раздельные интервалы времени для предотвращения утечки информации о метках.

Обсуждаемый метод позволяет перекрывать примеры обучения и тестирования с временными метками, близкими к точке T<sub>c</sub>. Для достижения большего разделения следует исключить примеры, которые находятся за W единиц времени от точки T<sub>c</sub> в тестовой выборке. Но такое агрессивное разделение зависит от доступности данных.

Модели регрессии, используемые для прогнозирования RUL, сильнее зависят от проблемы утечки. Использование метода случайного разбиения приводит к высокой вероятности образования лжевзаимосвязей. Для задач регрессии необходимо выполнить разделение таким образом, чтобы записи ресурсов, сбои которых произошли до точки T<sub>c</sub>, использовались для набора для обучения, а записи ресурсов, сбои которых произошли после этой точки, — для набора для тестирования.

Чтобы разделить данные на наборы для обучения и тестирования, в качестве общего метода также рекомендуется использовать разделение по идентификатору ресурса. Таким образом, ресурсы, которые использовались для обучения, не должны использоваться для тестирования эффективности модели. Идея такого подхода заключается в том, чтобы убедиться, что при использовании нового ресурса для прогнозирования модель предоставляет реалистичные результаты.

### <a name="handling-imbalanced-data"></a>Обработка несбалансированных данных
При решении задач классификации данные считаются _несбалансированными_, если примеров одного класса больше, чем примеров других классов. В идеале, чтобы иметь возможность провести различие между разными классами, требуется достаточное количество представителей каждого класса в данных для обучения. Если один класс составляет менее 10 % данных, данные считаются несбалансированными. Класс с недостаточным количеством данных будет называться _классом меньшинства_.

Во многих случаях использования PdM обнаруживаются несбалансированные наборы данных, в которых один класс представлен слишком малым количеством данных по сравнению с другими. К примеру, класс может составлять всего 0,001 % от всех точек данных. Несбалансированность класса не уникальна для PdM. В других областях, где сбои и аномалии случаются редко, возникают аналогичные проблемы, например при обнаружении мошенничества и сетевого вторжения. Эти сбои составляют примеры класса меньшинства.

В случае несбалансированности класса в данных эффективность большинства стандартных алгоритмов обучения скомпрометирована, так как их задача — свести к минимуму общую частоту ошибок. Например, в наборе данных, где 99 % примеров класса являются отрицательными и 1 % — положительным, можно получить 99 % точности, просто пометив все экземпляры как отрицательные. Но модель будет неправильно классифицировать все положительные примеры, поэтому даже если ее точность высока, алгоритм не является полезным. Следовательно, для обучения в условиях несбалансированности классов использования традиционных метрик оценки, таких как _общая точность частоты ошибок_, недостаточно. При наличии несбалансированных наборов данных для оценки используются другие метрики:
- Precision
- полнота;
- показатель F1;
- ROC-кривые со скорректированной стоимостью.

Дополнительные сведения об этих метриках см. в разделе [оценки модели](#Model-evaluation).

Тем не менее существует и ряд методов, с помощью которых можно устранить проблему несбалансированности класса. Два основных из них — _выборка_ и _обучение с учетом затрат_.

#### <a name="sampling-methods"></a>Методы выборки
Суть методов выборки, которые применяются для обучения в условиях несбалансированности классов, заключается в изменении набора данных для обучения с помощью некоторых механизмов, позволяющих обеспечить сбалансированность. Методы выборки не применяются к набору для тестирования. Несмотря на наличие нескольких методов выборки, самых эффективных всего два: _случайная избыточная выборка_ и _случайная неполная выборка_.

При _случайной избыточной выборке_ из класса меньшинства случайным образом выбираются примеры, которые затем реплицируются и добавляются в набор данных для обучения. Это позволяет увеличить общее количество примеров в классе меньшинства и в конечном счете уравновешивает количество примеров в разных классах. Недостатком избыточной выборки является то, что из-за наличия нескольких экземпляров некоторых примеров охват классификатора становится слишком узким, что приводит к переобучению. Модель может демонстрировать высокую точность обучения, но ее производительность с неизвестными тестовыми данными может быть неоптимальной.

И наоборот, при _случайной неполной выборке_ из класса большинства случайным образом выбираются примеры, которые затем удаляются из набора данных для обучения. Однако из-за удаления примеров из классов большинства классификатор может пропустить важные аспекты, относящиеся к этому классу. Еще одним эффективным методом является _смешанная выборка_. При такой выборке в одно и то же время к классу меньшинства применяется избыточная выборка, а к классу большинства — неполная.

Существует много сложных методов выборки. Выбранная методика зависит от свойств данных и результатов итерационных экспериментов, проводимых специалистами по анализу и обработке данных.

#### <a name="cost-sensitive-learning"></a>Обучение с учетом затрат
В прогнозном обслуживании сбоям, которые составляют класс меньшинства, уделяется намного больше внимания, чем примерам обычной работы. Поэтому основное внимание уделяется эффективности алгоритма для сбоев. Неправильное прогнозирование положительного класса как отрицательного может повлечь большие затраты, чем в обратном случае. Это часто называют неравномерной потерей или асимметричными расходами, связанными с неправильно классифицированными элементами различных классов. Необходимый классификатор должен обеспечивать высокую точность прогнозирования в отношении класса меньшинства, не оказывая влияния на точность прогнозирования для класса большинства.

Существует несколько способов достижения этого баланса. Задачу неравномерных потерь можно эффективно решить, назначив высокую стоимость неправильной классификации класса меньшинства и пытаясь уменьшить общую стоимость. В некоторых алгоритмах машинного обучения, таких как _SVM (метод опорных векторов)_, стоимость положительных и отрицательных примеров может быть указана во время обучения. Аналогичным образом, при наличии несбалансированности данных используются методы повышения эффективности, например алгоритмы _увеличивающегося дерева принятия решений_.

## <a name="model-evaluation"></a>Оценка модели.
Неправильная классификация является значительной проблемой для сценариев PdM, так как стоимость ложных предупреждений очень высока для бизнеса. Например, решение о посадке самолета, основанное на неправильном прогнозе возможного отказа двигателя, может нарушить график и планы поездок. Отключение устройства сборочного конвейера может привести к потере дохода. Таким образом, оценка модели с помощью правильных метрик производительности по новым тестовым данным имеет решающее значение.

Распространенные метрики производительности, используемые для оценки моделей PdM, описаны ниже:

- [Точность](https://en.wikipedia.org/wiki/Accuracy_and_precision) является наиболее распространенной метрикой, которая используется для описания эффективности классификатора. Но точность чувствительна к распределению данных и является неэффективной мерой для сценариев с несбалансированными наборами данных. Вместо этого используются другие метрики. Для вычисления и обоснования точности модели используются такие инструменты, как [матрица неточностей](https://en.wikipedia.org/wiki/Confusion_matrix).
- [Точность](https://en.wikipedia.org/wiki/Precision_and_recall) моделей PdM отображает количество ложных сигналов. Низкая степень точности модели соответствует большему количеству ложных сигналов.
- Степень [полноты](https://en.wikipedia.org/wiki/Precision_and_recall) указывает количество сбоев в наборе для тестирования, которые модель определила правильно. Высокая степень полноты означает, что модель правильно отслеживает сбои.
- [Показатель F1](https://en.wikipedia.org/wiki/F1_score) указывает гармоническое среднее точности и полноты (наилучшее значение — 1, а наихудшее — 0).

Двоичная классификация:
- [Кривые ROC](https://en.wikipedia.org/wiki/Receiver_operating_characteristic) также являются популярным методом. В кривых ROC эффективность модели интерпретируется на основе одной фиксированной рабочей точки кривой.
- Но для задач PdM полезные сведения предоставляют _таблицы децилей_ и _диаграммы точности прогнозов_. Они фокусируются только на положительном классе (сбои) и предоставляют более комплексную картину эффективности алгоритма, чем кривые ROC.
  - _Таблицы децилей_ создаются с использованием тестовых примеров в порядке убывания вероятности сбоя. Затем упорядоченные примеры группируются на децили (т. е. 10 % примеров с наибольшей вероятностью, затем 20 %, 30 % и т. д). Оценить изменение эффективности алгоритма в каждом дециле можно путем вычисления соотношения истинно положительных результатов каждого дециля. Случайная базовая оценка принимает значения 0,1, 0,2 и т. д.
  - [Диаграммы точности прогнозов](http://www2.cs.uregina.ca/~dbd/cs831/notes/lift_chart/lift_chart.html) используются для графического отображения соотношения истинно положительных результатов децилей и случайных истинно положительных результатов для всех децилей. Как правило, для результатов учитываются первые децили, так как они показывают наибольшее увеличение. При использовании для прогнозного обслуживания первые децили также можно рассматривать в качестве представителей "в зоне риска".

## <a name="model-operationalization-for-predictive-maintenance"></a>Ввод модели в эксплуатацию для прогнозного обслуживания

Преимущество задачи обработки и анализа данных реализуется только тогда, когда обученная модель становится работоспособной. То есть модель должна быть развернута в бизнес-системах, чтобы делать прогнозы на основе новых ранее неизвестных данных.  Новые данные должны точно соответствовать _сигнатуре обученной модели_ двумя способами:
- Все функции должны присутствовать в каждом логическом экземпляре (например, строке в таблице) новых данных.
- Новые данные должны быть предварительно обработаны, а каждый из признаков спроектирован точно так же, как и данные для обучения.

Вышеупомянутый процесс подробно описан в научной и отраслевой литературе. Все следующие утверждения означают одно и то же:
- _Оценка новых данных_ с использованием модели.
- _Применение модели_ к новым данным.
- _Ввод модели в эксплуатацию_.
- _Развертывание_ модели.
- _Запуск модели_ для обработки новых данных.

Как указывалось ранее, ввод в эксплуатацию модели для PdM отличается от других сценариев. Сценарии, связанные с обнаружением аномалий и сбоев, обычно реализуют _сетевую оценку_ (также называемую_оценкой в реальном времени_). В этом случае модель _оценивает_ каждую входящую запись и возвращает прогноз. При обнаружении аномалий прогноз будет являться признаком того, что возникла аномалия (пример: одноклассовый метод опорных векторов). При обнаружении сбоя это будет тип или класс сбоя.

С другой стороны, PdM включает в себя _пакетную оценку_. Чтобы соответствовать сигнатуре модели, признаки новых данных должны быть спроектированы таким же образом, как и данные обучения. Для больших наборов данных, характерных для новых данных, функции агрегируются по окнам времени и оцениваются в пакетном режиме. Пакетная оценка обычно выполняется в распределенных системах, таких как [Spark](http://spark.apache.org/) или [пакетная служба Azure](https://docs.microsoft.com/azure/batch/batch-api-basics). Существует пара альтернатив, обе из которых являются неоптимальными:
- Модули потоковой передачи данных поддерживают агрегирование по окнам времени в памяти. Поэтому можно утверждать, что они поддерживают оценку в реальном времени. Но эти системы подходят для данных высокой плотности в узких временных окнах или редких элементов в более широких окнах. Они могут плохо масштабироваться для данных высокой плотности в более широких временных окнах, как видно из сценариев PdM.
- Если пакетная оценка недоступна, следует адаптировать оценку в реальном времени для обработки новых данных небольшими пакетами за раз.

## <a name="solution-templates-for-predictive-maintenance"></a>Шаблоны решений для прогнозного обслуживания

В последнем разделе этого руководства представлен список шаблонов решений, руководств и экспериментов PdM, реализованных в Azure. В некоторых случаях эти приложения PdM можно включить в подписку Azure в течение нескольких минут. Они могут использоваться в качестве демонстрации доказательств концепции, песочницы для экспериментов с альтернативными вариантами или ускорителей для реальных рабочих реализаций. Эти шаблоны расположены в [Коллекции решений ИИ Azure](http://gallery.azure.ai) или [Azure GitHub](https://github.com/Azure). Со временем эти примеры будут скопированы в этот шаблон решения.

| # | Название | ОПИСАНИЕ |
|--:|:------|-------------|
| 1 | [Пример прогнозного обслуживания Azure для машинного обучения](https://github.com/Azure/MachineLearningSamples-PredictiveMaintenance) |Пример PdM для прогнозирования сбоев в течение следующих N единиц времени. Этот пример написан как проект Azure ML Workbench и идеально подходит для начинающих в PdM. [Дополнительная документация](https://docs.microsoft.com/azure/machine-learning/desktop-workbench/scenario-predictive-maintenance), относящаяся к этому примеру.|
| 2 | [Шаблон решения для прогнозного обслуживания Azure](https://github.com/Azure/AI-PredictiveMaintenance) | Комплексная платформа для демонстрации нескольких сценариев PdM. В этом шаблоне представлены два сценария: первый — это новый вариант использования классификации отказов в режиме реального времени. Второй сценарий является простой интеграцией решения [1] в этот шаблон. Он демонстрирует, как повторно использовать одну и ту же развернутую инфраструктуру для добавления других новых или имеющихся сценариев.|
| 3 | [Глубокое обучение по прогнозному обслуживанию](https://github.com/Azure/MachineLearningSamples-DeepLearningforPredictiveMaintenance) | Azure Notebook с демонстрационным решением по использованию сетей LSTM (класс рекуррентных нейронных сетей) для прогнозного обслуживания с [записью блога об этом образце](https://azure.microsoft.com/blog/deep-learning-for-predictive-maintenance).|
| 4. | [Руководство по моделированию прогнозного обслуживания на R](https://gallery.azure.ai/Notebook/Predictive-Maintenance-Modelling-Guide-R-Notebook-1) | Руководство по моделированию прогнозного обслуживания с помощью сценариев на R.|
| 5 | [Прогнозное обслуживание Azure для авиакосмической отрасли](https://gallery.azure.ai/Solution/Predictive-Maintenance-for-Aerospace-1) | Один из первых шаблонов решений PdM на основе Машинного обучения Azure версии 1.0 для обслуживания воздушных судов. Это руководство было создано на основе этого проекта. |
| 6 | [Набор средств для работы с искусственным интеллектом для Azure IoT Edge](https://github.com/Azure/ai-toolkit-iot-edge) | ИИ в IoT Edge с использованием TensorFlow. Набор средств позволяет упаковать модели глубокого обучения в контейнеры Docker, совместимые с Azure IoT Edge и предоставить к ним доступ в качестве REST API.
| 7 | [Прогнозное обслуживание Интернета вещей Azure](https://github.com/Azure/azure-iot-predictive-maintenance) | Azure IoT Suite PCS. Предварительно настроенное решение. Шаблон PdM с IoT Suite для обслуживания самолетов. [Еще один документ](https://docs.microsoft.com/azure/iot-suite/iot-suite-predictive-overview) и [пошаговое руководство](https://docs.microsoft.com/azure/iot-suite/iot-suite-predictive-walkthrough), связанное с тем же проектом. |
| 8 | [Шаблон прогнозного обслуживания, использующий SQL Server R Services](https://gallery.azure.ai/Tutorial/Predictive-Maintenance-Template-with-SQL-Server-R-Services-1) | Демонстрационный сценарий оставшегося срока полезного использования на основе служб R. |
| 9 | [Predictive Maintenance Modelling Guide](https://gallery.azure.ai/Collection/Predictive-Maintenance-Modelling-Guide-1) (Руководство по моделированию прогнозного обслуживания) | Признаки набора данных для обслуживания самолетов, созданные с использованием R с [экспериментами](https://gallery.azure.ai/Experiment/Predictive-Maintenance-Modelling-Guide-Experiment-1) и [наборами данных](https://gallery.azure.ai/Experiment/Predictive-Maintenance-Modelling-Guide-Data-Sets-1), а также с использованием [N](https://gallery.azure.ai/Notebook/Predictive-Maintenance-Modelling-Guide-R-Notebook-1) с [экспериментами](https://gallery.azure.ai/Experiment/Predictive-Maintenance-Step-1-of-3-data-preparation-and-feature-engineering-2) в службе "Машинное обучение Azure" версии 1.0.|

## <a name="training-resources-for-predictive-maintenance"></a>Сборник тренировочных заданий для прогнозного обслуживания

[Схема обучения ИИ Azure для прогнозного обслуживания](https://github.com/Azure/AI-PredictiveMaintenance/blob/master/docs/azure-ai-learning-path-for-predictive-maintenance.md) позволяет получить учебный материал для более глубокого понимания концепций и математических моделей, на основе которых созданы алгоритмы и методы, используемые в задачах PdM. 

Microsoft Azure предоставляет бесплатное содержимое и обучающие материалы по общим концепциям и практической работе с ИИ.

| Ресурсы для обучения  | Доступность |
|:-------------------|--------------|
| [Разработка искусственного интеллекта в Azure](http://azure.microsoft.com/training/learning-paths/azure-ai-developer) | Общедоступные |
| [Курсы по изучению искусственного интеллекта Майкрософт](http://aischool.microsoft.com/learning-paths) | Общедоступные |
| [Обучение работе с ИИ Azure на GitHub](http://azure.github.io/learnanalytics/public) | Общедоступные |
| [LinkedIn Learning](http://www.linkedin.com/learning) | Общедоступные |
| [Вебинары по ИИ Майкрософт на YouТube](https://www.youtube.com/watch?v=NvrH7_KKzoM&t=4s) | Общедоступные |
| [Канал об искусственном интеллекте Майкрософт](http://channel9.msdn.com/Shows/AI-Show) | Общедоступные |
| [LearnAI@MS](http://learnanalytics.microsoft.com) | Для партнеров Майкрософт |
| [Microsoft Partner Network](http://learningportal.microsoft.com) | Для партнеров Майкрософт |

Кроме того, доступны бесплатные учебные интернет-программы MOOCS (общедоступные онлайн-курсы) по изучению ИИ, которые проводятся научными учреждениями, такими как Стэнфорд и Массачусетский технологический институт, а также другими образовательными компаниями.