---
title: Использование локального сервера SQL Server в Машинном обучении Azure | Документация Майкрософт
description: Использование данных из локальной базы данных SQL Server для выполнения расширенной аналитики с помощью Машинного обучения Azure.
services: machine-learning
documentationcenter: ''
author: heatherbshapiro
ms.author: hshapiro
manager: hjerez
editor: cgronlun
ms.assetid: 08e4610d-02b6-4071-aad7-a2340ad8e2ea
ms.service: machine-learning
ms.component: studio
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/13/2017
ms.openlocfilehash: c3402c824b70d357b68e71ed7cb5783a7489b2b0
ms.sourcegitcommit: 944d16bc74de29fb2643b0576a20cbd7e437cef2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2018
ms.locfileid: "34837384"
---
# <a name="perform-advanced-analytics-with-azure-machine-learning-using-data-from-an-on-premises-sql-server-database"></a>Выполнение расширенной аналитики с помощью Машинного обучения Azure на основе данных из локальной базы данных SQL Server

[!INCLUDE [import-data-into-aml-studio-selector](../../../includes/machine-learning-import-data-into-aml-studio.md)]

Зачастую на предприятиях, работающих с локальными данными, используются преимущества масштабируемости и гибкости облака для рабочих нагрузок машинного обучения. Но при этом на предприятиях не хотят нарушать свои текущие бизнес-процессы и рабочие процессы, перемещая их локальные данные в облако. Машинное обучение Azure теперь поддерживает чтение данных из локальной базы данных SQL Server с последующим обучением и оценкой модели по этим данным. Больше не требуется вручную копировать и синхронизировать данные между облаком и локальным сервером. Вместо этого модуль **Импорт данных** в Студии машинного обучения Azure теперь может считывать данные для заданий обучения и оценки непосредственно из локальной базы данных SQL Server.

Эта статья содержит общие сведения о вводе локальных данных SQL Server в Машинное обучение Azure. Предполагается, что вы знакомы с такими основными понятиями Машинного обучения Azure, как рабочие области, модули, наборы данных, эксперименты *и т. д.*

> [!NOTE]
> Эта функция недоступна для бесплатных рабочих областей. Дополнительные сведения о ценах на машинное обучение и его уровнях см. [здесь](https://azure.microsoft.com/pricing/details/machine-learning/).
>
>

<!-- -->

[!INCLUDE [machine-learning-free-trial](../../../includes/machine-learning-free-trial.md)]

## <a name="install-the-microsoft-data-management-gateway"></a>Установка шлюза управления данными Майкрософт
Для доступа к локальной базе данных SQL Server из Машинного обучения Azure вам необходимо скачать и установить шлюз управления данными Майкрософт. При настройке подключения шлюза в Студии машинного обучения будет возможность скачать и установить шлюз, используя диалоговое окно **Download and register data gateway** (Скачивание и регистрация шлюза данных), как описано ниже.

Можно также установить шлюз управления данными заранее, скачав и запустив пакет установки MSI из [Центра загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=39717).
Выберите последнюю версию для 32-разрядных или 64-разрядных систем, в зависимости от своего компьютера. Пакет MSI также может использоваться для обновления имеющегося шлюза управления данными до последней версии с сохранением всех параметров.

Предварительные требования для шлюза указаны ниже.

* Поддерживаемые операционные системы Windows: Windows 7, Windows 8, Windows 8.1, Windows 10, Windows Server 2008 R2, Windows Server 2012 и Windows Server 2012 R2.
* Рекомендуемая конфигурация для компьютера шлюза: четырехъядерный процессор с тактовой частотой не менее 2 ГГц, не менее 8 ГБ ОЗУ и 80 ГБ дискового пространства.
* Когда хост-компьютер переходит в режим гибернации, шлюз не отвечает на запросы данных. Поэтому перед установкой шлюза на компьютере следует настроить соответствующую схему управления питанием. Если компьютер настроен для использования режима гибернации, во время установки шлюза отобразится соответствующее сообщение.
* Так как циклы копирования выполняются с определенной частотой, ресурсы компьютера (ЦП, память) используются нерегулярно: есть пиковые нагрузки, и есть время простоя. Использование ресурсов также зависит от объема перемещаемых данных. Когда выполняется несколько заданий копирования, в пиковые периоды уровень использования ресурсов системы повышается. Выше приведены минимальные требования к конфигурации, технически являющейся достаточной. Мы рекомендуем всегда иметь больше ресурсов, чем указано для минимальной конфигурации, так как нагрузка зависит от объема перемещаемых данных.

Учитывайте следующее при настройке и использовании шлюза управления данными.

* На компьютере может быть установлен только один экземпляр шлюза управления данными.
* Можно использовать один шлюз для нескольких локальных источников данных.
* Несколько шлюзов на разных компьютерах можно подключить к одному и тому же локальному источнику данных.
* Шлюз можно настроить только для одной рабочей области одновременно. На данный момент шлюзы нельзя сделать общими для нескольких рабочих областей.
* Для одной рабочей области можно настроить несколько шлюзов. Например, можно использовать шлюз, который подключен к тестовым источникам данных, во время разработки, и рабочий шлюз, когда все будет готово к вводу в эксплуатацию.
* Шлюз не обязательно устанавливать на том же компьютере, что и источник данных. Но если он расположен вблизи источника данных, это ускоряет подключение шлюза к этому источнику. Мы рекомендуем установить шлюз на компьютере, отличном от того, на котором размещен локальный источник данных, чтобы шлюз не конкурировал с источником данных за использование ресурсов.
* Если вы уже установили шлюз на компьютер, который используется для задач Power BI или фабрики данных Azure, установите отдельный шлюз для Машинного обучения Azure на другом компьютере.

  > [!NOTE]
  > Шлюз управления данными и шлюз Power BI не могут работать на одном компьютере.
  >
  >
* Необходимо использовать шлюз управления данными для Машинного обучения Azure, даже если вы используете Azure ExpressRoute для других данных. Источник данных следует считать локальным (то есть защищенным брандмауэром), даже если используется ExpressRoute. А для связи между Машинным обучением Azure и источником данных используется шлюз управления данными.

Дополнительные сведения о необходимых условиях для установки, этапах установки и устранении неполадок см. в статье [Шлюз управления данными](../../data-factory/v1/data-factory-data-management-gateway.md).

## <a name="span-idusing-the-data-gateway-step-by-step-walk-classanchorspan-idtoc450838866-classanchorspanspaningress-data-from-your-on-premises-sql-server-database-into-azure-machine-learning"></a><span id="using-the-data-gateway-step-by-step-walk" class="anchor"><span id="_Toc450838866" class="anchor"></span></span>Ввод данных из локальной базы данных SQL Server в Машинное обучение Azure
В этом пошаговом руководстве описывается, как установить шлюз управления данными в рабочей области Машинного обучения Azure, настроить его, а затем считывать данные из локальной базы данных SQL Server.

> [!TIP]
> Прежде чем начать, отключите блокирование всплывающих окон в браузере для `studio.azureml.net`. Если вы используете браузер Google Chrome, скачайте и установите один из нескольких подключаемых модулей, доступных в интернет-магазине Google Chrome в разделе [расширений для приложений Click Once](https://chrome.google.com/webstore/search/clickonce?_category=extensions).
>
>

### <a name="step-1-create-a-gateway"></a>Шаг 1. Создание шлюза
Первым шагом является создание и настройка шлюза для доступа к локальной базы данных SQL.

1. Войдите в [Студию машинного обучения Azure](https://studio.azureml.net/Home/) и выберите необходимую рабочую область.
2. Щелкните колонку **Параметры** слева и выберите вкладку **Шлюзы данных** вверху.
3. Щелкните **НОВЫЙ ШЛЮЗ ДАННЫХ** в нижней части экрана.

    ![Новый шлюз данных](./media/use-data-from-an-on-premises-sql-server/new-data-gateway-button.png)
4. В диалоговом окне **Новый шлюз данных** введите **имя шлюза** и при необходимости добавьте его **описание**. Щелкните стрелку в нижнем правом углу, чтобы перейти к следующему шагу настройки.

    ![Ввод имени и описания шлюза данных](./media/use-data-from-an-on-premises-sql-server/new-data-gateway-dialog-enter-name.png)
5. В диалоговом окне Download and register data gateway (Скачивание и регистрация шлюза данных) скопируйте ключ регистрации шлюза в буфер обмена.

    ![Download and register data gateway (Скачивание и регистрация шлюза данных)](./media/use-data-from-an-on-premises-sql-server/download-and-register-data-gateway.png)
6. <span id="note-1" class="anchor"></span>Если вы еще не скачали и не установили шлюз управления данными Майкрософт, щелкните **Download data management gateway**(Скачать шлюз управления данными). Вы перейдете в Центр загрузки Майкрософт, где можно выбрать нужную версию шлюза, скачать ее и установить. Дополнительные сведения о необходимых условиях для установки, этапах установки и устранении неполадок можно найти в подразделах в начале статьи [Перемещение данных между локальными источниками и облаком при помощи шлюза управления данными](../../data-factory/v1/data-factory-move-data-between-onprem-and-cloud.md).
7. После установки шлюза откроется диспетчер конфигурации шлюза управления данными и появится диалоговое окно **Регистрация шлюза** . Вставьте **ключ регистрации шлюза**, скопированный в буфер обмена, и нажмите кнопку **Зарегистрировать**.
8. Если вы уже установили шлюз, запустите диспетчер конфигурации шлюза управления данными. Щелкните **Изменить ключ**, вставьте **ключ регистрации шлюза**, скопированный в буфер обмена на предыдущем шаге, и нажмите кнопку **ОК**.
9. Когда установка будет завершена, отобразится диалоговое окно **Регистрация шлюза** для диспетчера конфигурации шлюза управления данными Майкрософт. Вставьте ключ регистрации шлюза, скопированный в буфер обмена на предыдущем шаге, и щелкните **Зарегистрировать**.

    ![Зарегистрировать шлюз](./media/use-data-from-an-on-premises-sql-server/data-gateway-configuration-manager-register-gateway.png)
10. Настройка шлюза будет завершена после задания следующих значений на вкладке **Главная** в диспетчере конфигурации шлюза управления данными Майкрософт.

    * В полях **Имя шлюза** и **Имя экземпляра** указывается имя шлюза.
    * Для параметра **Регистрация** установлено значение **Зарегистрировано**.
    * В поле **Состояние** установлено значение **Запущено**.
    * В строке состояния внизу отображается надпись **Подключение к облачной службе шлюза управления данными установлено** и зеленый флажок.

      ![Диспетчер шлюза управления данными](./media/use-data-from-an-on-premises-sql-server/data-gateway-configuration-manager-registered.png)

      При успешной регистрации также обновляется Студия машинного обучения Azure.

    ![Успешная регистрация шлюза](./media/use-data-from-an-on-premises-sql-server/gateway-registered.png)
11. В диалоговом окне **Download and register data gateway** (Скачивание и регистрация шлюза данных) щелкните галочку, чтобы завершить настройку. На странице **Параметры** отображается состояние шлюза "В сети". В области справа можно просмотреть состояние и другие полезные сведения.

    ![Параметры шлюза](./media/use-data-from-an-on-premises-sql-server/gateway-status.png)
12. В диспетчере конфигурации шлюза управления данными Майкрософт перейдите на вкладку **Сертификат** . Сертификат, указанный на этой вкладке, используется для шифрования и расшифровывания учетных данных локального хранилища данных, указанного на портале. Это созданный по умолчанию сертификат. Корпорация Майкрософт рекомендует заменить его собственным сертификатом, сохраненном в системе управления сертификатами. Чтобы использовать вместо него собственный сертификат, щелкните **Изменить** .

    ![Изменение сертификата шлюза](./media/use-data-from-an-on-premises-sql-server/data-gateway-configuration-manager-certificate.png)
13. (Необязательно.) Если для устранения проблем со шлюзом вы хотите использовать подробное ведение журнала, то в диспетчере конфигурации шлюза управления данными перейдите на вкладку **Диагностика** и установите флажок **Включить запись подробных сведений в журнал для устранения неполадок**. Данные журналов можно изучить в средстве просмотра событий Windows, развернув узел **Журналы приложений и служб** -&gt; **Шлюз управления данными**. На вкладке **Диагностика** можно также проверить подключение к локальному источнику данных через шлюз.

    ![Включение ведения подробного журнала](./media/use-data-from-an-on-premises-sql-server/data-gateway-configuration-manager-verbose-logging.png)

На этом процесс установки шлюза в Машинном обучении Azure завершается.
Теперь все готово к использованию локальных данных.

В Студии машинного обучения можно создать и настроить несколько шлюзов для каждой рабочей области. Например, можно использовать один шлюз, который будет подключаться к тестовым источникам данных во время разработки, и второй шлюз для подключения к рабочим источникам данных. Машинное обучение Azure позволяет настроить несколько шлюзов в соответствии с вашей корпоративной средой. В настоящее время шлюз нельзя совместно использовать между несколькими рабочими областями, и на одном компьютере можно установить только один шлюз. Дополнительные сведения см. в статье [Перемещение данных между локальными источниками и облаком с помощью шлюза управления данными](../../data-factory/v1/data-factory-move-data-between-onprem-and-cloud.md).

### <a name="step-2-use-the-gateway-to-read-data-from-an-on-premises-data-source"></a>Шаг 2. Использование шлюза для чтения данных из локального источника данных
После настройки шлюза можно добавить в эксперимент модуль **Импорт данных** , который вводит данные из локальной базы данных SQL Server.

1. В Студии машинного обучения выберите вкладку **Эксперименты**, щелкните **+Создать** в левом нижнем углу и выберите **пустой эксперимент** (либо один из примеров экспериментов).
2. Найдите и перетащите модуль **Импорт данных** на холст эксперимента.
3. Внизу холста нажмите кнопку **Сохранить как** . Введите название эксперимента "Учебник по использованию локальных данных SQL Server в Машинном обучении Azure", выберите рабочую область и нажмите кнопку **ОК** .

   ![Сохранение эксперимента с новым именем](./media/use-data-from-an-on-premises-sql-server/experiment-save-as.png)
4. Щелкните модуль **Импорт данных**, чтобы выбрать его, а затем в области **Свойства** справа от полотна в раскрывающемся списке **Источник данных** выберите "Локальная база данных SQL".
5. Выберите **шлюз данных** , который вы установили и зарегистрировали. Вы можете установить еще один шлюз, выбрав "(Добавить шлюз данных…)".

   ![Выбор шлюза данных для модуля импорта данных](./media/use-data-from-an-on-premises-sql-server/import-data-select-on-premises-data-source.png)
6. Введите **имя сервера базы данных SQL** и **имя базы данных SQL**, а также **SQL-запрос к базе данных**, который требуется выполнить.
7. Нажмите кнопку **Enter values** (Введите значения) в разделе **Имя пользователя и пароль** и введите учетные данные базы данных. Можно использовать встроенную аутентификацию Windows или аутентификацию SQL Server, в зависимости от настроек локального сервера SQL Server.

   ![Ввод учетных данных базы данных](./media/use-data-from-an-on-premises-sql-server/database-credentials.png)

   Сообщение "values required" (Требуются значения) изменится на "values set" (Значения заданы) с зеленой галочкой. Необходимо только один раз ввести учетные данные, если только не изменится информация о базе данных или пароль. Машинное обучение Azure использует сертификат, предоставленный при установке шлюза, для шифрования учетных данных в облаке. Azure никогда не хранит локальные учетные данные без шифрования.

   ![Свойства модуля "Импорт данных"](./media/use-data-from-an-on-premises-sql-server/import-data-properties-entered.png)
8. Щелкните **ЗАПУСТИТЬ** , чтобы выполнить эксперимент.

После завершения эксперимента можно визуализировать данные, импортированные из базы данных, щелкнув порт вывода модуля **Import Data** (Импорт данных) и выбрав **Visualize** (Визуализировать).

После завершения разработки эксперимента можно развернуть и ввести в эксплуатацию свою модель. С помощью службы выполнения пакетов из локальной базы данных SQL Server, настроенной в модуле **Импорт данных** , будут считываться данные, которые будут использоваться для оценки. Хотя вы можете для оценки локальных данных использовать службу ответа на запросы, вместо нее корпорация Майкрософт рекомендует использовать [надстройку Excel](excel-add-in-for-web-services.md) . В настоящее время запись в локальную базу данных SQL Server через модуль **Экспорт данных** не поддерживается в экспериментах или опубликованных веб-службах.
