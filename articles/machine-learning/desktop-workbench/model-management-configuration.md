---
title: Установка и настройка службы управления моделями Машинного обучения Azure | Документация Майкрософт
description: В этом документе описываются действия и основные понятия, использующиеся при установке и настройке службы управления моделями в Машинном обучении Azure.
services: machine-learning
author: raymondlaghaeian
ms.author: raymondl
manager: hjerez
ms.reviewer: jasonwhowell, mldocs
ms.service: machine-learning
ms.component: desktop-workbench
ms.workload: data-services
ms.topic: article
ms.date: 08/29/2017
ms.openlocfilehash: 6802d1dfc360a48d8085ff07a8d4488ee1751e33
ms.sourcegitcommit: 944d16bc74de29fb2643b0576a20cbd7e437cef2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2018
ms.locfileid: "34832107"
---
# <a name="model-management-setup"></a>Установка службы управления моделями

## <a name="overview"></a>Обзор
Этот документ содержит вводные сведения об использовании службы управления моделями Машинного обучения Azure для развертывания моделей машинного обучения в качестве веб-служб и управления ими. 

Используя управление моделями Машинного обучения Azure, можно эффективно развертывать модели машинного обучения, созданные с помощью нескольких платформ, включая SparkML, Keras, TensorFlow, Microsoft Cognitive Toolkit или Python, а также управлять ими. 

Выполнив инструкции в этом документе, вы сможете настроить среду управления моделями и подготовить ее к развертыванию моделей машинного обучения.

## <a name="what-you-need-to-get-started"></a>Что необходимо для начала работы
Для получения оптимального результата вам понадобятся права владельца на доступ к подписке Azure, в которую вы сможете развернуть модели.
Интерфейс командной строки поставляется предварительно установленным в Azure Machine Learning Workbench и на [виртуальных машинах Azure для обработки и анализа данных](https://docs.microsoft.com/azure/machine-learning/machine-learning-data-science-virtual-machine-overview).

## <a name="using-the-cli"></a>Использование интерфейса командной строки
Чтобы использовать интерфейсы командной строки (CLI) на платформе Workbench, щелкните **Файл** -] **Open CommandLine Interface** (Открыть интерфейс командной строки). 

На виртуальной машине для обработки и анализа данных подключитесь к командной строке и откройте ее. Введите `az ml -h` для просмотра параметров. Чтобы получить дополнительные сведения о командах, используйте параметр --help.

В остальных системах необходимо установить CLI.

### <a name="installing-or-updating-on-windows"></a>Установка (или обновление) в Windows

Установите Python отсюда: https://www.python.org/. Убедитесь, что выбрана установка pip.

Откройте командную строку, используя запуск от имени администратора, а затем выполните следующие команды:

```cmd
pip install azure-cli
pip install azure-cli-ml
```
 
>[!NOTE]
>Если у вас установлена более ранняя версия, сначала удалите ее с помощью следующей команды:
>

```cmd
pip uninstall azure-cli-ml
```

### <a name="installing-or-updating-on-linux"></a>Установка (или обновление) в Linux
Выполните следующую команду из командной строки и следуйте указаниям.

```bash
sudo -i
pip install azure-cli
pip install azure-cli-ml
```

После завершения установки выполните следующую команду:

```bash
sudo /opt/microsoft/azureml/initial_setup.sh
```

>[!NOTE]
>Выйдите из системы и снова войдите в сеанс SSH, чтобы изменения вступили в силу.
>Предыдущие команды можно использовать для обновления предыдущей версии CLI на DSVM.
>

## <a name="deploying-your-model"></a>Развертывание модели
Используйте CLI для развертывания моделей в качестве веб-служб. Их можно развернуть локально или в кластере.

Начните с локального развертывания, убедитесь, что модель и код работают, затем выполните развертывание в кластер для использования в производственных масштабах.

Чтобы начать, необходимо настроить среду развертывания. Это необходимо сделать всего лишь один раз. После настройки среду можно повторно использовать для последующих развертываний. Дополнительные сведения см. в следующем разделе.

Действия после настройки среды:
- Вам будет предложено войти в Azure. Чтобы войти, воспользуйтесь браузером и откройте страницу https://aka.ms/devicelogin. Введите код для проверки подлинности.
- В процессе проверки подлинности вам будет предложена учетная запись, с помощью которой будет выполнена проверка подлинности. Важно! Выберите учетную запись с действительной подпиской Azure и необходимыми разрешениями для создания ресурсов. После входа вам предоставляются сведения о подписке и запрос на продолжение с выбранной учетной записью.

### <a name="environment-setup"></a>Настройка среды
Чтобы начать процесс установки, необходимо зарегистрировать поставщика среды, введя следующую команду:

```azurecli
az provider register -n Microsoft.MachineLearningCompute
```

#### <a name="local-deployment"></a>Локальное развертывание
Чтобы развернуть и протестировать веб-службу на локальном компьютере, настройте локальную среду, используя следующую команду:

```azurecli
az ml env setup -l [location of Azure Region, e.g. eastus2] -n [your environment name] [-g [existing resource group]]
```
>[!NOTE] 
>Для локального развертывания веб-службы необходимо установить Docker на локальном компьютере. 
>

Команда настройки локальной среды создает следующие ресурсы в подписке:
- Группа ресурсов (если не указана).
- Учетная запись хранения.
- Реестр контейнеров Azure (ACR).
- Application Insights

После успешного завершения настройки настройте среду для использования с помощью следующей команды:

```azurecli
az ml env set -n [environment name] -g [resource group]
```

#### <a name="cluster-deployment"></a>Развертывание кластера
Используйте развертывание кластера для крупномасштабных рабочих сред. В этом случае кластер ACS настраивается с Kubernetes в качестве оркестратора. Кластер ACS можно масштабировать для обработки большей пропускной способности для вызовов вашей веб-службы.

Чтобы развернуть веб-службу в рабочей среде, сначала настройте среду, используя следующую команду:

```azurecli
az ml env setup -c --name [your environment name] --location [Azure region e.g. eastus2] [-g [resource group]]
```

Команда установки среды кластера создает следующие ресурсы в подписке:
- Группа ресурсов (если не указана).
- Учетная запись хранения.
- Реестр контейнеров Azure (ACR).
- Развертывание Kubernetes в кластере Службы контейнеров Azure (ACS).
- Application Insights

Группа ресурсов, учетная запись хранения и запись контроля доступа создаются быстро. Развертывание ACS может занять до 20 минут. 

После завершения настройки необходимо настроить среду, которая будет использоваться в этом развертывании. Используйте следующую команду:

```azurecli
az ml env set -n [environment name] -g [resource group]
```

>[!NOTE] 
> После создания среды для последующих развертываний необходимо использовать только приведенную выше команду set.
>

>[!NOTE] 
>Чтобы создать конечную точку HTTPS, укажите SSL-сертификат при создании кластера с помощью параметров --cert-name и --cert-pem в команде az ml env setup. Это позволит настроить кластер для обслуживания HTTPS-запросов, защищенных с помощью указанного сертификата. После завершения настройки создайте запись DNS CNAME, которая указывает на полное доменное имя кластера.

### <a name="create-an-account"></a>Создание учетной записи
Учетная запись необходима для развертывания моделей. Вам понадобится создать одну учетную запись, одну и ту же учетную запись можно использовать в нескольких развертываниях.

Создайте учетную запись с помощью следующей команды:

```azurecli
az ml account modelmanagement create -l [Azure region, e.g. eastus2] -n [your account name] -g [resource group name] --sku-instances [number of instances, e.g. 1] --sku-name [Pricing tier for example S1]
```

Чтобы использовать имеющуюся учетную запись, воспользуйтесь следующей командой:
```azurecli
az ml account modelmanagement set -n [your account name] -g [resource group it was created in]
```

### <a name="deploy-your-model"></a>Развертывание модели
Теперь вы готовы к развертыванию сохраненной модели в качестве веб-службы. 

```azurecli
az ml service create realtime --model-file [model file/folder path] -f [scoring file e.g. score.py] -n [your service name] -s [schema file e.g. service_schema.json] -r [runtime for the Docker container e.g. spark-py or python] -c [conda dependencies file for additional python packages]
```

### <a name="next-steps"></a>Дальнейшие действия
Воспользуйтесь одним из многих примеров в коллекции.
