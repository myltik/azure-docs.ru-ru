---
title: "Создание и установка файлов конфигурации VPN-клиента для подключений типа \"точка — сеть\" с использованием Azure PowerShell для аутентификации Azure на основе сертификата | Документация Майкрософт"
description: "Эта статья поможет вам создать и установить файлы конфигурации VPN-клиента для подключений типа \"точка — сеть\" с использованием аутентификации на основе сертификата."
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/29/2018
ms.author: cherylmc
ms.openlocfilehash: efe5d3db16db83568bb844894198b59a6b39f626
ms.sourcegitcommit: 9d317dabf4a5cca13308c50a10349af0e72e1b7e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2018
---
# <a name="create-and-install-vpn-client-configuration-files-for-native-azure-certificate-authentication-p2s-configurations"></a>Создание и установка файлов конфигурации VPN-клиента для настройки подключений типа "точка — сеть" с использованием собственной аутентификации Azure на основе сертификата

Файлы конфигурации VPN-клиента содержатся в ZIP-файле. Эти файлы содержат параметры, требуемые при подключениях типа "точка — сеть" между собственным VPN-клиентом IKEv2 Windows или Mac и виртуальной сетью с использованием собственной аутентификации Azure на основе сертификата.

### <a name="workflow"></a>Рабочий процесс установки подключения типа "точка — сеть"

  1. Настройте VPN-шлюз Azure для подключения типа "точка — сеть".
  2. Создайте корневой сертификат и сертификаты клиента. Загрузите открытый ключ корневого сертификата в Azure и установите сертификаты клиента на клиентских устройствах. Сертификаты используются для аутентификации пользователей при подключении.
  3. Получите конфигурацию VPN-клиента для выбранного варианта аутентификации и используйте ее для настройки VPN-клиента на устройстве Windows или Mac. Это позволит установить подключение типа "точка — сеть" к виртуальными сетям Azure.

>[!NOTE]
>Файлы конфигурации клиента связаны с VPN-конфигурацией для виртуальной сети. Если вы создали файлы конфигурации VPN-клиента, а затем внесли изменения в конфигурацию VPN-подключения типа "точка — сеть" (например, изменили тип VPN-протокола или аутентификации), создайте новую конфигурацию VPN-клиента на устройствах пользователей.
>
>

## <a name="generate"></a>Создание файлов конфигурации VPN-клиента

Перед подключением убедитесь, что на устройствах всех пользователей установлены действительные сертификаты. См. инструкции по [установке сертификата клиента](point-to-site-how-to-vpn-client-install-azure-cert.md).

Вы можете создать файлы конфигурации клиента с помощью PowerShell или с помощью портала Azure. И в первом, и во втором случае возвращается один и тот же ZIP-файл. Распакуйте файл. Отобразятся следующие папки:

  * **WindowsAmd64** и **WindowsX86**. Эти папки содержат пакеты установщика 32- и 64-разрядной версий Windows. Пакет установщика **WindowsAmd64** предназначен для всех поддерживаемых 64-разрядных клиентов Windows, не только Amd.
  * **Generic**. Эта папка содержит общие сведения для создания собственной конфигурации VPN-клиента. Не используйте эту папку. Эта папка доступна, если для шлюза настроены протоколы IKEv2 и SSTP+IKEv2. Если настроен только протокол SSTP, эта папка отсутствует.

### <a name="zipportal"></a>Создание файлов с помощью портала Azure

1. На портале Azure перейдите в шлюз виртуальной сети, к которой необходимо подключиться.
2. На странице шлюза виртуальной сети щелкните **Point-to-site configuration** (Конфигурации "точка — сеть").
3. В верхней части страницы Point-to-site configuration (Конфигурации "точка — сеть") щелкните **Download VPN client** (Скачать VPN-клиент). Пакет конфигурации клиента создается несколько минут.
4. В браузере появится сообщение о том, что ZIP-файл конфигурации клиента доступен. Он имеет то же имя, что и шлюз. Распакуйте файл. После этого отобразятся папки.

### <a name="zipps"></a>Создание файлов с помощью PowerShell

1. При создании файлов конфигурации VPN-клиента установите для параметра AuthenticationMethod значение EapTls. Создайте конфигурацию VPN-клиента с помощью следующей команды:

  ```powershell
  $profile=New-AzureRmVpnClientConfiguration -ResourceGroupName "TestRG" -Name "VNet1GW" -AuthenticationMethod "EapTls"

  $profile.VPNProfileSASUrl
  ```
2. Скопируйте URL-адрес в браузер, чтобы скачать ZIP-файл, а затем распакуйте файл для просмотра папок.

## <a name="installwin"></a>Установка пакета конфигурации VPN-клиента Windows

На каждом клиентском компьютере Windows можно использовать один и тот же пакет конфигурации VPN-клиента, если его версия соответствует архитектуре клиента. Список поддерживаемых клиентских операционных систем см. в разделе с описанием подключений типа "точка — сеть" в статье [VPN-шлюз: вопросы и ответы](vpn-gateway-vpn-faq.md#P2S).

Чтобы настроить в Windows собственный VPN-клиент для аутентификации на основе сертификата, сделайте следующее:

1. Выберите файлы конфигурации VPN-клиента, которые соответствуют архитектуре компьютера Windows. Для 64-разрядной архитектуры процессора выберите пакет установщика VpnClientSetupAmd64. Для 32-разрядной архитектуры процессора выберите пакет установщика VpnClientSetupX86. 
2. Дважды щелкните пакет, чтобы установить его. При появлении всплывающего окна SmartScreen щелкните **Дополнительно**, а затем выберите **Выполнить в любом случае**.
3. На клиентском компьютере перейдите в раздел **Параметры сети** и щелкните **VPN**. Для VPN-подключения отображается имя виртуальной сети, к которой оно устанавливается. 

## <a name="installmac"></a>Настройка VPN-клиента на компьютерах Mac (OSX)

Azure не предоставляет файл mobileconfig для собственной аутентификации Azure на основе сертификата. Необходимо вручную настроить VPN-клиент IKEv2 на каждом компьютере Mac, который будет подключаться к Azure. В папке **Generic** содержатся все сведения, необходимые для настройки. Если папки Generic нет в скачанных файлах, вполне вероятно, что IKEv2 не был выбран в качестве типа туннеля. Выбрав IKEv2, создайте ZIP-файл еще раз для получения папки Generic. Эта папка содержит следующие файлы:

* Файл **VpnSettings.xml** — содержит такие важные параметры, как адрес сервера и тип туннеля. 
* Файл **VpnServerRoot.cer** — содержит корневой сертификат, который требуется для проверки VPN-шлюза Azure при настройке подключения типа "точка — сеть".

Чтобы настроить на устройстве Mac собственный VPN-клиент для аутентификации на основе сертификата, сделайте следующее: Выполните следующие действия на каждом компьютере Mac, который будет подключаться к Azure:

1. Импортируйте корневой сертификат **VpnServerRoot** на компьютер Mac. Для этого скопируйте файл на устройство Mac и дважды щелкните его.  
Чтобы выполнить импорт, щелкните **Add** (Добавить).

  ![Добавление сертификата](./media/point-to-site-vpn-client-configuration-azure-cert/addcert.png)
  
    >[!NOTE]
    >При двойном щелчке сертификата диалоговое окно **добавления** может не отобразиться, но сертификат устанавливается в надлежащее хранилище. Вы можете проверить наличие сертификата в цепочке ключей входа по категории сертификатов.
  
2. Откройте диалоговое окно **Network** (Сеть) и в разделе **Network Preferences** (Параметры сети) щелкните **+**, чтобы создать профиль подключения типа "точка — сеть" между VPN-клиентом и виртуальной сетью Azure.

  Установите следующие значения: для параметра **Interface** (Интерфейс) — VPN, для **VPN Type** (Тип VPN) — IKEv2. Укажите имя профиля в поле **Service Name** (Имя службы), а затем нажмите кнопку **Create** (Создать), чтобы создать профиль подключения VPN-клиента.

  ![Сеть](./media/point-to-site-vpn-client-configuration-azure-cert/network.png)
3. В папке **Generic** из файла **VpnSettings.xml** скопируйте значение тега **VpnServer**. Вставьте это значение в поля профиля **Server Address** (Адрес сервера) и **Remote ID** (Удаленный ИД).

  ![Сведения о сервере](./media/point-to-site-vpn-client-configuration-azure-cert/server.png)
4. Щелкните **Authentication Settings** (Параметры аутентификации) и выберите **Certificate** (Сертификат). 

  ![Параметры аутентификации](./media/point-to-site-vpn-client-configuration-azure-cert/authsettings.png)
5. Щелкните **Select…** (Выбрать), чтобы выбрать сертификат клиента, который будет использоваться для аутентификации. Сертификат клиента должен быть установлен на компьютере (см. шаг 2 в разделе **Рабочий процесс установки подключения типа "точка — сеть"** выше).

  ![на основе сертификата.](./media/point-to-site-vpn-client-configuration-azure-cert/certificate.png)
6. В окне **Choose An Identity** (Выбор удостоверения) отобразится список доступных сертификатов. Выберите нужный сертификат, а затем щелкните **Continue** (Продолжить).

  ![identity](./media/point-to-site-vpn-client-configuration-azure-cert/identity.png)
7. В поле **Local ID** (Локальный идентификатор) укажите имя сертификата (из шага 6). В нашем примере это ikev2Client.com. Щелкните **Apply** (Применить), чтобы сохранить изменения.

  ![apply](./media/point-to-site-vpn-client-configuration-azure-cert/applyconnect.png)
8. В диалоговом окне **Network** (Сеть) щелкните **Apply** (Применить), чтобы сохранить все изменения. Затем щелкните **Connect** (Подключиться), чтобы установить подключение типа "точка — сеть" к виртуальной сети Azure.

## <a name="next-steps"></a>Дальнейшие действия

Вернитесь к статье, чтобы [завершить настройку подключения типа "точка — сеть"](vpn-gateway-howto-point-to-site-rm-ps.md).
