---
title: Подключение виртуальной сети Azure к другой виртуальной сети с помощью портала | Документация Майкрософт
description: Создайте подключение VPN-шлюза между виртуальными сетями с использованием Resource Manager и портала Azure.
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: jpconnock
editor: ''
tags: azure-resource-manager
ms.assetid: a7015cfc-764b-46a1-bfac-043d30a275df
ms.service: vpn-gateway
ms.devlang: na
ms.topic: hero-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/21/2018
ms.author: cherylmc
ms.openlocfilehash: 7e72e9ff9be0b092bc9425828bab46ffd60f0822
ms.sourcegitcommit: 59914a06e1f337399e4db3c6f3bc15c573079832
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/19/2018
---
# <a name="configure-a-vnet-to-vnet-vpn-gateway-connection-using-the-azure-portal"></a>Настройка подключения VPN-шлюза между виртуальными сетями на портале Azure

Эта статья поможет установить подключение "виртуальная сеть — виртуальная сеть" между виртуальными сетями. Виртуальные сети могут относиться к одному или разным регионам и к одной или разным подпискам. При подключении виртуальных сетей из разных подписок подписки не обязательно должны быть связаны с одним и тем же клиентом Active Directory. 

Приведенные в этой статье инструкции относятся к модели развертывания с помощью Resource Manager и используют портал Azure. Эту конфигурацию также можно создать с помощью разных средств или моделей развертывания, выбрав вариант из следующего списка:

> [!div class="op_single_selector"]
> * [портал Azure](vpn-gateway-howto-vnet-vnet-resource-manager-portal.md)
> * [PowerShell](vpn-gateway-vnet-vnet-rm-ps.md)
> * [интерфейс командной строки Azure](vpn-gateway-howto-vnet-vnet-cli.md)
> * [Портал Azure (классический)](vpn-gateway-howto-vnet-vnet-portal-classic.md)
> * [Подключение с использованием разных моделей развертывания — портал Azure](vpn-gateway-connect-different-deployment-models-portal.md)
> * [Подключение с использованием разных моделей развертывания — PowerShell](vpn-gateway-connect-different-deployment-models-powershell.md)
>
>

![Схема подключения между виртуальными сетями](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/v2vrmps.png)

## <a name="about"></a>Сведения о подключении виртуальных сетей

Подключить виртуальные сети можно несколькими способами. В следующих разделах описаны различные способы подключения виртуальных сетей.

### <a name="vnet-to-vnet"></a>Подключение типа "виртуальная сеть — виртуальная сеть"

Чтобы легко подключать виртуальные сети, рекомендуем настроить подключение "виртуальная сеть — виртуальная сеть". Подключение "виртуальная сеть — виртуальная сеть" (VNet2VNet) между виртуальными сетями похоже на создание подключения "сеть — сеть" (IPsec) к локальному расположению. В обоих типах подключений применяется VPN-шлюз для создания защищенного туннеля, использующего IPsec/IKE. При обмене данными оба типа подключений работают одинаково. Различие между этими типами заключается в способе настройки шлюза локальной сети. При создании подключения "виртуальная сеть — виртуальная сеть" диапазон адресов для шлюза локальной сети не отображается. Он создается и заполняется автоматически. Если вы обновите диапазон адресов для одной виртуальной сети, другая виртуальная сеть автоматически определит маршрут к обновленному диапазону адресов. Как правило, намного проще и быстрее создать подключение "виртуальная сеть — виртуальная сеть", чем подключение "сеть — сеть" между виртуальными сетями.

### <a name="site-to-site-ipsec"></a>Подключение "сеть — сеть" (IPsec)

При работе со сложной конфигурацией сети можно подключить виртуальные сети с помощью подключения [сеть — сеть](vpn-gateway-howto-site-to-site-resource-manager-portal.md) в качестве альтернативы. Используя подключение "сеть — сеть" (IPsec), вы вручную создаете и настраиваете локальные сетевые шлюзы. Шлюз локальной сети для каждой виртуальной сети воспринимает другую виртуальную сеть как локальный сайт. Это позволит вам указать дополнительный диапазон адресов для шлюза локальной сети, чтобы маршрутизировать трафик. Если диапазон адресов для виртуальной сети изменится, вам потребуется обновить соответствующий шлюз локальной сети для отражения этих изменений. Он не обновляется автоматически.

### <a name="vnet-peering"></a>Пиринговая связь между виртуальными сетями

Вы можете подключить виртуальные сети с помощью пиринга виртуальных сетей. При пиринге виртуальных сетей не используется VPN-шлюз и применяются другие ограничения. Кроме того, [цены на пиринг виртуальных сетей](https://azure.microsoft.com/pricing/details/virtual-network) рассчитываются не так, как [цены на VPN-шлюз "виртуальная сеть — виртуальная сеть"](https://azure.microsoft.com/pricing/details/vpn-gateway). Дополнительную информацию см. в статье [Пиринговая связь между виртуальными сетями](../virtual-network/virtual-network-peering-overview.md).

## <a name="why"></a>Зачем создавать подключение "виртуальная сеть — виртуальная сеть"

Возможно, вам потребуется подключить виртуальные сети с помощью подключения "виртуальная сеть — виртуальная сеть" по следующим причинам.

* **Межрегиональная географическая избыточность и географическое присутствие**

  * Вы можете настроить собственную георепликацию или синхронизацию с безопасной связью без прохождения трафика через конечные точки с выходом в Интернет.
  * С помощью Azure Load Balancer и диспетчера трафика можно настроить высокодоступную рабочую нагрузку с геоизбыточностью в нескольких регионах Azure. Одним из важных примеров является настройка SQL Always On с группами доступности, распределенными между несколькими регионами Azure.
* **Региональные многоуровневые приложения с изоляцией или административной границей**

  * В одном регионе можно настроить многоуровневые приложения с несколькими виртуальными сетями, которые связаны друг с другом из-за требований к изоляции или административных требований.

Подключение типа "виртуальная сеть — виртуальная сеть" можно комбинировать с многосайтовыми конфигурациями. Это позволяет устанавливать топологии сети, совмещающие распределенные подключения с подключениями между виртуальными сетями, как показано на схеме ниже.

![Сведения о подключениях](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/aboutconnections.png "Сведения о подключениях")

Из этой статьи вы узнаете, как подключить виртуальные сети, используя подключение "виртуальная сеть — виртуальная сеть". При выполнении этих шагов в качестве упражнения можно использовать следующие примеры значений. В нашем примере виртуальные сети находятся в одной подписке, но в разных группах ресурсов. Если виртуальные сети связаны с разными подписками, вам не удастся создать подключение на портале. Вы можете использовать [PowerShell](vpn-gateway-vnet-vnet-rm-ps.md) или [интерфейс командной строки](vpn-gateway-howto-vnet-vnet-cli.md). Дополнительные сведения о подключениях типа "виртуальная сеть — виртуальная сеть" см. в разделе [Часто задаваемые вопросы о подключениях типа "виртуальная сеть — виртуальная сеть"](#faq) в конце этой статьи.

### <a name="values"></a>Примеры настроек

**Значения для TestVNet1:**

* Имя виртуальной сети: TestVNet1
* Адресное пространство: 10.11.0.0/16.
* Подписка: подписка, которая будет использоваться.
* Группа ресурсов: TestRG1
* Расположение: восточная часть США
* Имя подсети: FrontEnd.
* Диапазон адресов подсети: 10.11.0.0/24.
* Имя подсети шлюза: GatewaySubnet (автоматически заполняется на портале).
* Диапазон адресов шлюза подсети: 10.11.255.0/27.
* DNS-сервер: используйте IP-адрес вашего DNS-сервера.
* Имя шлюза виртуальной сети: TestVNet1GW.
* Тип шлюза: VPN
* Тип VPN: на основе маршрутов.
* SKU: выберите номер SKU шлюза, который нужно использовать.
* Имя общедоступного IP-адреса: TestVNet1GWIP.
* Имя подключения: TestVNet1toTestVNet4.
* Общий ключ: его можно создать самостоятельно. В этом примере мы используем abc123. Важно отметить, что при создании подключения между виртуальными сетями значение должно совпадать.

**Значения для TestVNet4:**

* Имя виртуальной сети: TestVNet4
* Адресное пространство: 10.41.0.0/16.
* Подписка: подписка, которая будет использоваться.
* Группа ресурсов: TestRG4
* Расположение: Запад США
* Имя подсети: FrontEnd.
* Диапазон адресов подсети: 10.41.0.0/24.
* Имя подсети шлюза: GatewaySubnet (автоматически заполняется на портале).
* Диапазон адресов подсети шлюза: 10.41.255.0/27.
* DNS-сервер: используйте IP-адрес вашего DNS-сервера.
* Имя шлюза виртуальной сети: TestVNet4GW.
* Тип шлюза: VPN
* Тип VPN: на основе маршрутов.
* SKU: выберите номер SKU шлюза, который нужно использовать.
* Имя общедоступного IP-адреса: TestVNet4GWIP.
* Имя подключения: TestVNet4toTestVNet1.
* Общий ключ: его можно создать самостоятельно. В этом примере мы используем abc123. Важно отметить, что при создании подключения между виртуальными сетями значение должно совпадать.

## <a name="CreatVNet"></a>1. Создание и настройка TestVNet1
Если у вас уже есть виртуальная сеть, проверьте совместимость параметров со структурой VPN-шлюза. Обратите особое внимание на подсети, которые могут пересекаться с другими сетями. В таком случае подключение не будет работать правильно. Если виртуальная сеть настроена правильно, переходите к действиям из раздела [Выбор DNS-сервера](#dns) .

### <a name="to-create-a-virtual-network"></a>Создание виртуальной сети
[!INCLUDE [vpn-gateway-basic-vnet-rm-portal](../../includes/vpn-gateway-basic-vnet-rm-portal-include.md)]

## <a name="subnets"></a>2. Добавление дополнительного адресного пространства и создание подсетей
После создания виртуальной сети в нее можно добавить дополнительное адресное пространство и подсети.

[!INCLUDE [vpn-gateway-additional-address-space](../../includes/vpn-gateway-additional-address-space-include.md)]

## <a name="gatewaysubnet"></a>3. Создание подсети шлюза
Чтобы создать шлюз виртуальной сети, сначала нужно создать подсеть шлюза. Подсеть шлюза содержит IP-адреса, которые используются шлюзом виртуальной сети. По возможности рекомендуется создать подсеть шлюза с использованием блока CIDR с маской /28 или /27, чтобы обеспечить достаточно IP-адресов для удовлетворения дополнительных будущих требований к конфигурации.

Если вы создаете эту конфигурацию в качестве упражнения, при создании подсети шлюза можно использовать эти [примеры параметров](#values).

[!INCLUDE [vpn-gateway-no-nsg](../../includes/vpn-gateway-no-nsg-include.md)]

### <a name="to-create-a-gateway-subnet"></a>Создание подсети шлюза
[!INCLUDE [vpn-gateway-add-gwsubnet-rm-portal](../../includes/vpn-gateway-add-gwsubnet-rm-portal-include.md)]

## <a name="dns"></a>4. Выбор DNS-сервера (необязательно)
DNS не требуется при создании подключений между виртуальными сетями. Но если для ресурсов, развернутых в вашей виртуальной сети, требуется разрешение имен, необходимо указать DNS-сервер. Этот параметр позволяет указать DNS-сервер, который вы хотите использовать для разрешения имен в этой виртуальной сети. Он не приводит к созданию DNS-сервера.

[!INCLUDE [vpn-gateway-add-dns-rm-portal](../../includes/vpn-gateway-add-dns-rm-portal-include.md)]

## <a name="VNetGateway"></a>5. Создание шлюза виртуальной сети
На этом шаге вы создадите шлюз для своей виртуальной сети. Создание шлюза часто занимает 45 минут и более, в зависимости от выбранного SKU шлюза. Если вы создаете эту конфигурацию в качестве упражнения, можно использовать [примеры параметров](#values).

### <a name="to-create-a-virtual-network-gateway"></a>Создание шлюза виртуальной сети
[!INCLUDE [vpn-gateway-add-gw-rm-portal](../../includes/vpn-gateway-add-gw-rm-portal-include.md)]

## <a name="CreateTestVNet4"></a>6. Создание и настройка TestVNet4
После настройки TestVNet1 создайте TestVNet4. Для этого выполните предыдущие действия, используя значения для TestVNet4. Настройку TestVNet4 можно начинать до завершения создания шлюза виртуальной сети для TestVNet1. При использовании собственных значений убедитесь, что адресные пространства не перекрываются с другими виртуальными сетями, к которым нужно подключиться.

## <a name="TestVNet1Connection"></a>7. Настройка подключения TestVNet1 к шлюзу
После создания шлюзов виртуальной сети для TestVNet1 и TestVNet4 между ними можно создать подключение. В этом разделе мы создадим подключение между VNet1 и VNet4. Эти действия выполняются только для виртуальных сетей в одной подписке. Если виртуальные сети связаны с разными подписками, для подключения необходимо использовать PowerShell. См. статью, посвященную использованию [PowerShell](vpn-gateway-vnet-vnet-rm-ps.md). Но если виртуальные сети находятся в разных группах ресурсов в одной подписке, их можно подключить с помощью портала.

1. Выберите **Все ресурсы**, а затем перейдите к шлюзу для своей виртуальной сети. Например, **TestVNet1GW**. Щелкните **TestVNet1GW**, чтобы открыть страницу шлюза виртуальной сети.

  ![Страница "Подключения"](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/1to4connect2.png "Connections page")
2. Щелкните **+ Добавить**, чтобы открыть страницу **Добавление подключения**.

  ![Добавление подключения](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/add.png "Добавление подключения")
3. На странице **Добавление подключения** в поле имени введите имя подключения. Например, **TestVNet1toTestVNet4**.
4. Для параметра **Тип подключения** выберите значение **Виртуальная сеть — виртуальная сеть** из раскрывающегося списка.
5. Так как это подключение создается с указанного шлюза виртуальной сети, поле **Шлюз первой виртуальной сети** заполняется автоматически.
6. В поле **Шлюз второй виртуальной сети** укажите значение шлюза виртуальной сети, к которой нужно создать подключение. Щелкните **Выберите другой шлюз виртуальной сети**, чтобы открыть страницу **Выбор шлюза виртуальной сети**.
7. Просмотрите список шлюзов виртуальной сети на этой странице. Обратите внимание, что отображаются только те шлюзы виртуальной сети, которые относятся к вашей подписке. Дополнительные сведения о подключении к шлюзу виртуальной сети, который не относится к вашей подписке, см. в статье [Настройка подключения между виртуальными сетями в развертывании Resource Manager с помощью PowerShell](vpn-gateway-vnet-vnet-rm-ps.md).
8. Щелкните шлюз виртуальной сети, к которому нужно подключиться.
9. В поле **Общий ключ** введите общий ключ для подключения. Этот ключ можно сгенерировать или создать самостоятельно. В подключении типа "сеть — сеть" один и тот же ключ используется и для локального устройства, и для подключения шлюза виртуальной сети. То же самое и здесь, но вместо подключения к VPN-устройству выполняется подключение к шлюзу виртуальной сети.
10. В нижней части страницы нажмите кнопку **ОК**, чтобы сохранить изменения.

## <a name="TestVNet4Connection"></a>8. Настройка подключения TestVNet4 к шлюзу
Далее создайте подключение между TestVNet4 и TestVNet1. На портале найдите шлюз виртуальной сети, связанный с TestVNet4. Выполните шаги из предыдущего раздела, заменив значения с TestVNet4 на TestVNet1 для создания подключения. Используйте тот же общий ключ.

## <a name="VerifyConnection"></a>9. Проверка подключений

Найдите шлюз виртуальной сети на портале. На странице шлюза виртуальной сети щелкните **Подключения**, чтобы просмотреть соответствующую страницу для шлюза виртуальной сети. Когда подключение будет установлено, для параметра "Состояние" значения изменятся на **Успешно** и **Подключено**. Вы можете дважды щелкнуть имя подключения, чтобы открыть страницу **Основное** и просмотреть дополнительные сведения.

![Успешно](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/connected.png "Успешно")

Когда начнется передача данных, появятся значения для параметров "Входящие данные" и "Исходящие данные".

![Основные компоненты](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/essentials.png "Основные компоненты")

## <a name="to-add-additional-connections"></a>Добавление дополнительных подключений

Если нужно добавить дополнительные подключения, перейдите к шлюзу виртуальной сети, от которого нужно создать подключение, а затем щелкните **Подключения**. Вы можете создать другое подключение "виртуальная сеть — виртуальная сеть" или подключение "сеть — сеть" (IPsec) к локальному расположению. Укажите **тип подключения** в соответствии с типом создаваемого подключения. Прежде чем создавать дополнительные подключения, убедитесь, что диапазон адресов для виртуальной сети не пересекается с другими диапазонами адресов, к которым вы планируете подключаться. Инструкции по созданию подключения "сеть — сеть" см. в статье [Создание подключения типа "сеть — сеть" на портале Azure](vpn-gateway-howto-site-to-site-resource-manager-portal.md).

## <a name="faq"></a>Часто задаваемые вопросы о подключениях типа "виртуальная сеть — виртуальная сеть"
Дополнительные сведения см. в ответах на часто задаваемые вопросы о подключениях типа "виртуальная сеть — виртуальная сеть".

[!INCLUDE [vpn-gateway-vnet-vnet-faq](../../includes/vpn-gateway-faq-vnet-vnet-include.md)]

## <a name="next-steps"></a>Дополнительная информация

Сведения об ограничении сетевого трафика к ресурсам в виртуальной сети см. в статье [Безопасность сети](../virtual-network/security-overview.md).

Сведения о том, как Azure маршрутизирует трафик между средой Azure, локальной средой и интернет-ресурсами, см. в статье [Маршрутизация трафика в виртуальной сети](../virtual-network/virtual-networks-udr-overview.md).
