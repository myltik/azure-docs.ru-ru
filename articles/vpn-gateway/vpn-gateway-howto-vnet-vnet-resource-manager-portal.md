---
title: "Подключение виртуальной сети Azure к другой виртуальной сети с помощью портала | Документация Майкрософт"
description: "Создайте подключение VPN-шлюза между виртуальными сетями с использованием Resource Manager и портала Azure."
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: a7015cfc-764b-46a1-bfac-043d30a275df
ms.service: vpn-gateway
ms.devlang: na
ms.topic: hero-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/23/2017
ms.author: cherylmc
translationtype: Human Translation
ms.sourcegitcommit: 4f2230ea0cc5b3e258a1a26a39e99433b04ffe18
ms.openlocfilehash: 102eab0e2e915521f8702b526dda886a2502f40b
ms.lasthandoff: 03/25/2017


---
# <a name="configure-a-vnet-to-vnet-connection-using-the-azure-portal"></a>Настройка подключения между виртуальными сетями на портале Azure
> [!div class="op_single_selector"]
> * [Resource Manager — портал Azure](vpn-gateway-howto-vnet-vnet-resource-manager-portal.md)
> * [Resource Manager — PowerShell](vpn-gateway-vnet-vnet-rm-ps.md)
> * [Классическая модель — классический портал](virtual-networks-configure-vnet-to-vnet-connection.md)
> 
> 

Эта статья содержит инструкции по созданию подключения между виртуальными сетями в модели развертывания Resource Manager с помощью VPN-шлюза и портала Azure.

Виртуальные сети, между которыми устанавливается подключение на портале Azure, должны относиться к одной подписке. Если виртуальные сети относятся к разным подпискам, подключение между ними можно настроить с помощью [PowerShell](vpn-gateway-vnet-vnet-rm-ps.md).

![Схема подключения между виртуальными сетями](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/v2vrmps.png)

### <a name="deployment-models-and-methods-for-vnet-to-vnet-connections"></a>Модели и методы развертывания для подключений между виртуальными сетями
[!INCLUDE [deployment models](../../includes/vpn-gateway-deployment-models-include.md)]

В следующей таблице показаны модели развертывания, доступные в настоящее время, и методы для конфигурации типа "сеть — сеть". Когда появится статья с руководством по конфигурации, мы разместим прямую ссылку на нее в этой таблице.

[!INCLUDE [vpn-gateway-table-vnet-vnet](../../includes/vpn-gateway-table-vnet-to-vnet-include.md)]

**Пиринговая связь между виртуальными сетями**

[!INCLUDE [vpn-gateway-vnetpeeringlink](../../includes/vpn-gateway-vnetpeeringlink-include.md)]

## <a name="about-vnet-to-vnet-connections"></a>О подключениях "виртуальная сеть — виртуальная сеть"
Подключение типа "виртуальная сеть — виртуальная сеть" похоже на подключение виртуальной сети к локальному сайту. В обоих типах подключений используется VPN-шлюз Azure для создания защищенного туннеля, использующего IPsec/IKE. Подключаемые виртуальные сети могут находиться в разных регионах и иметь разные подписки.

Можно даже комбинировать подключение виртуальных сетей с многосайтовыми конфигурациями. Это позволяет устанавливать топологии сети, совмещающие распределенные подключения с подключениями между виртуальными сетями, как показано на схеме ниже.

![Сведения о подключениях](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/aboutconnections.png "Сведения о подключениях")

### <a name="why-connect-virtual-networks"></a>Что может дать связь между виртуальными сетями
Вам может потребоваться подключить виртуальные сети по следующим причинам.

* **Межрегиональная географическая избыточность и географическое присутствие**
  
  * Вы можете настроить собственную георепликацию или синхронизацию с безопасной связью без прохождения трафика через конечные точки с выходом в Интернет.
  * С помощью Azure Load Balancer и диспетчера трафика можно настроить высокодоступную рабочую нагрузку с геоизбыточностью в нескольких регионах Azure. Одним из важных примеров является настройка SQL Always On с группами доступности, распределенными между несколькими регионами Azure.
* **Региональные многоуровневые приложения с изоляцией или административной границей**
  
  * В одном регионе можно настроить многоуровневые приложения с несколькими виртуальными сетями, которые связаны друг с другом из-за требований к изоляции или административных требований.

См. дополнительные сведения в разделе с [часто задаваемыми вопросами о подключениях типа "виртуальная сеть — виртуальная сеть"](#faq) в конце этой статьи.

### <a name="values"></a>Примеры настроек
Выполняя эти шаги в качестве упражнения, используйте следующие значения. В качестве примера для каждой виртуальной сети используется несколько адресных пространств. Однако для конфигураций типа "сеть — сеть" несколько адресных пространств не требуется.

**Значения для TestVNet1:**

* Имя виртуальной сети: TestVNet1
* Адресное пространство: 10.11.0.0/16.
  * Имя подсети: FrontEnd.
  * Диапазон адресов подсети: 10.11.0.0/24.
* Группа ресурсов: TestRG1
* Расположение: восточная часть США
* Адресное пространство: 10.12.0.0/16.
  * Имя подсети: BackEnd.
  * Диапазон адресов подсети: 10.12.0.0/24.
* Имя подсети шлюза: GatewaySubnet (автоматически заполняется на портале).
  * Диапазон адресов шлюза подсети: 10.11.255.0/27.
* DNS-сервер: используйте IP-адрес вашего DNS-сервера.
* Имя шлюза виртуальной сети: TestVNet1GW.
* Тип шлюза: VPN
* Тип VPN: на основе маршрутов.
* SKU: выберите номер SKU шлюза, который нужно использовать.
* Имя общедоступного IP-адреса: TestVNet1GWIP.
* Значения подключений:
  * Имя: TestVNet1toTestVNet4.
  * Общий ключ: его можно создать самостоятельно. В этом примере мы используем abc123. Важно отметить, что при создании подключения между виртуальными сетями значение должно совпадать.

**Значения для TestVNet4:**

* Имя виртуальной сети: TestVNet4
* Адресное пространство: 10.41.0.0/16.
  * Имя подсети: FrontEnd.
  * Диапазон адресов подсети: 10.41.0.0/24.
* Группа ресурсов: TestRG1
* Расположение: Запад США
* Адресное пространство: 10.42.0.0/16.
  * Имя подсети: BackEnd.
  * Диапазон адресов подсети: 10.42.0.0/24.
* Имя подсети шлюза: GatewaySubnet (автоматически заполняется на портале).
  * Диапазон адресов подсети шлюза: 10.41.255.0/27.
* DNS-сервер: используйте IP-адрес вашего DNS-сервера.
* Имя шлюза виртуальной сети: TestVNet4GW.
* Тип шлюза: VPN
* Тип VPN: на основе маршрутов.
* SKU: выберите номер SKU шлюза, который нужно использовать.
* Имя общедоступного IP-адреса: TestVNet4GWIP.
* Значения подключений:
  * Имя: TestVNet4toTestVNet1.
  * Общий ключ: его можно создать самостоятельно. В этом примере мы используем abc123. Важно отметить, что при создании подключения между виртуальными сетями значение должно совпадать.

## <a name="CreatVNet"></a>1. Создание и настройка TestVNet1
Если у вас уже есть виртуальная сеть, проверьте совместимость параметров со структурой VPN-шлюза. Обратите особое внимание на подсети, которые могут пересекаться с другими сетями. В таком случае подключение не будет работать правильно. Если виртуальная сеть настроена правильно, переходите к действиям из раздела [Выбор DNS-сервера](#dns) .

### <a name="to-create-a-virtual-network"></a>Создание виртуальной сети
[!INCLUDE [vpn-gateway-basic-vnet-rm-portal](../../includes/vpn-gateway-basic-vnet-rm-portal-include.md)]

## <a name="subnets"></a>2. Добавление дополнительного адресного пространства и создание подсетей
После создания виртуальной сети в нее можно добавить дополнительное адресное пространство и подсети.

[!INCLUDE [vpn-gateway-additional-address-space](../../includes/vpn-gateway-additional-address-space-include.md)]

## <a name="gatewaysubnet"></a>3. Создание подсети шлюза
Прежде чем подключать шлюз к виртуальной сети, нужно создать подсеть шлюза для виртуальной сети, к которой необходимо подключиться. По возможности рекомендуется создать подсеть шлюза с использованием блока CIDR с маской /28 или /27, чтобы обеспечить достаточно IP-адресов для удовлетворения дополнительных будущих требований к конфигурации.

Если вы создаете эту конфигурацию в качестве упражнения, при создании подсети шлюза можно использовать эти [примеры параметров](#values).

[!INCLUDE [vpn-gateway-no-nsg](../../includes/vpn-gateway-no-nsg-include.md)]

### <a name="to-create-a-gateway-subnet"></a>Создание подсети шлюза
[!INCLUDE [vpn-gateway-add-gwsubnet-rm-portal](../../includes/vpn-gateway-add-gwsubnet-rm-portal-include.md)]

## <a name="DNSServer"></a>4. Выбор DNS-сервера (необязательно)
DNS не требуется при создании подключений между виртуальными сетями. Но если для ресурсов, развернутых в вашей виртуальной сети, требуется разрешение имен, необходимо указать DNS-сервер. Этот параметр позволяет указать DNS-сервер, который вы хотите использовать для разрешения имен в этой виртуальной сети. Он не приводит к созданию DNS-сервера.

[!INCLUDE [vpn-gateway-add-dns-rm-portal](../../includes/vpn-gateway-add-dns-rm-portal-include.md)]

## <a name="VNetGateway"></a>5. Создание шлюза виртуальной сети
На этом шаге вы создадите шлюз для своей виртуальной сети. Этот шаг может занять до 45 минут. Если вы создаете эту конфигурацию в качестве упражнения, можно использовать [примеры параметров](#values).

### <a name="to-create-a-virtual-network-gateway"></a>Создание шлюза виртуальной сети
[!INCLUDE [vpn-gateway-add-gw-rm-portal](../../includes/vpn-gateway-add-gw-rm-portal-include.md)]

## <a name="CreateTestVNet4"></a>6. Создание и настройка TestVNet4
После настройки TestVNet1 создайте TestVNet4. Для этого выполните предыдущие действия, используя значения для TestVNet4. Настройку TestVNet4 можно начинать до завершения создания шлюза виртуальной сети для TestVNet1. При использовании собственных значений убедитесь, что адресные пространства не перекрываются с другими виртуальными сетями, к которым нужно подключиться.

## <a name="TestVNet1Connection"></a>7. Настройка подключения TestVNet1
После создания шлюзов виртуальной сети для TestVNet1 и TestVNet4 между ними можно создать подключение. В этом разделе мы создадим подключение между VNet1 и VNet4.

1. Выберите **Все ресурсы**, а затем перейдите к шлюзу для своей виртуальной сети. Например, **TestVNet1GW**. Щелкните **TestVNet1GW**, чтобы открыть колонку шлюза виртуальной сети.
   
    ![Колонка подключений](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/settings_connection.png "Колонка подключений")
2. Щелкните **Добавить**, чтобы открыть колонку **Добавление подключения**.
3. В колонке **Добавление подключения** в поле имени введите имя подключения. Например, **TestVNet1toTestVNet4**.
   
    ![Имя подключения](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/v1tov4.png "Имя подключения")
4. В раскрывающемся списке **Тип подключения** выберите **Виртуальная сеть — виртуальная сеть**.
5. Так как это подключение создается с указанного шлюза виртуальной сети, поле **Шлюз первой виртуальной сети** заполняется автоматически.
6. В поле **Шлюз второй виртуальной сети** укажите значение шлюза виртуальной сети, к которой нужно создать подключение. Щелкните **Выберите другой шлюз виртуальной сети**, чтобы открыть колонку **Выбор шлюза виртуальной сети**.
   
    ![Добавление подключения](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/add_connection.png "Добавление подключения")
7. Просмотрите список шлюзов виртуальной сети в этой колонке. Обратите внимание, что отображаются только те шлюзы виртуальной сети, которые относятся к вашей подписке. Дополнительные сведения о подключении к шлюзу виртуальной сети, который не относится к вашей подписке, см. в статье [Настройка подключения между виртуальными сетями в развертывании Resource Manager с помощью PowerShell](vpn-gateway-vnet-vnet-rm-ps.md). 
8. Щелкните шлюз виртуальной сети, к которому нужно подключиться.
9. В поле **Общий ключ** введите общий ключ для подключения. Этот ключ можно сгенерировать или создать самостоятельно. В подключении типа "сеть — сеть" один и тот же ключ используется и для локального устройства, и для подключения шлюза виртуальной сети. То же самое и здесь, но вместо подключения к VPN-устройству выполняется подключение к шлюзу виртуальной сети.
   
    ![Общий ключ](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/sharedkey.png "Общий ключ")
10. В нижней части колонки нажмите кнопку **ОК**, чтобы сохранить изменения.

## <a name="TestVNet4Connection"></a>8. Настройка подключения TestVNet4
Далее создайте подключение между TestVNet4 и TestVNet1. Используйте тот же метод, что и для создания подключения междуTestVNet1 и TestVNet4. Используйте тот же общий ключ.

## <a name="VerifyConnection"></a>9. Проверка подключения
Проверьте подключение. Для каждого шлюза виртуальной сети выполните следующие действия:

1. Найдите колонку для шлюза виртуальной сети. Например, **TestVNet4GW**. 
2. В колонке шлюза виртуальной сети щелкните **Подключения**, чтобы просмотреть соответствующую колонку для шлюза виртуальной сети.

Просмотрите подключения и проверьте их состояния. После создания подключения для параметра "Состояние" будут отображаться значения **Успешно** и **Подключено**.

![Успешно](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/connected.png "Успешно")

Чтобы просмотреть дополнительные сведения об отдельном подключении, дважды щелкните его.

![Основные компоненты](./media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/essentials.png "Основные компоненты")

## <a name="faq"></a>Рекомендации по работе с подключением типа "виртуальная сеть — виртуальная сеть"
Дополнительные сведения см. в ответах на часто задаваемые вопросы о подключениях типа "виртуальная сеть — виртуальная сеть".

[!INCLUDE [vpn-gateway-vnet-vnet-faq](../../includes/vpn-gateway-vnet-vnet-faq-include.md)]

## <a name="next-steps"></a>Дальнейшие действия
Установив подключение, можно добавить виртуальные машины в виртуальные сети. Дополнительную информацию см. в [документации по виртуальным машинам](https://docs.microsoft.com/azure/#pivot=services&panel=Compute).

